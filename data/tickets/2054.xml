<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">4</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-23T22:46:41+00:00</created-at>
  <creator-id type="integer">42756</creator-id>
  <milestone-due-on type="datetime">2009-01-31T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">2054</number>
  <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
  <priority type="integer">10</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>action_controller resources</tag>
  <title>:requirements not passed to named_route generated by :member</title>
  <updated-at type="datetime">2009-04-05T16:31:11+01:00</updated-at>
  <user-id type="integer">10378</user-id>
  <version type="integer">15</version>
  <user-name>David Krmpotic</user-name>
  <creator-name>Marc Bowes</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
  <priority-name nil="true"></priority-name>
  <original-body># Example

## routes.rb

&gt; map.resources :users, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }, :member =&gt; { :baz =&gt; :get }

## user.rb

&gt; def to_param
&gt;  self.name
&gt; end

## The error

### Assume @user.name == 'foo'

&gt; user_path(@user) # =&gt; /users/foo
&gt; baz_user_path(@user) # =&gt; /users/foo/baz

Both work, and would without the :requirements option on the named resource.

### Now, with @user.name == 'foo.bar'

&gt; user_path(@user) # =&gt; /users/foo.bar
&gt; baz_user_path(@user) # =&gt; /users/foo.bar/baz

While the generated route seems legitimate, Rails will fail to respond properly to the baz path. While the first path (/users/foo.bar) works, thanks to :requirements specifying the legal formats of params[:id], :requirements doesn't seem to be passed down to the member function.

## Workarounds

One could do the follow above the users resource in routes.rb:

&gt; map.baz_user &quot;/users/:id/baz&quot;, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }

.. and then remove the member function. While the requirement RE can be moved into a constant, this is obviously an imperfect solution.

## Conclusion

I hope this is a legitimate bug as I have spent some time searching both the Web and Lighthouse for similar bugs but haven't found anything.</original-body>
  <latest-body># Example

## routes.rb

&gt; map.resources :users, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }, :member =&gt; { :baz =&gt; :get }

## user.rb

&gt; def to_param
&gt;  self.name
&gt; end

## The error

### Assume @user.name == 'foo'

&gt; user_path(@user) # =&gt; /users/foo
&gt; baz_user_path(@user) # =&gt; /users/foo/baz

Both work, and would without the :requirements option on the named resource.

### Now, with @user.name == 'foo.bar'

&gt; user_path(@user) # =&gt; /users/foo.bar
&gt; baz_user_path(@user) # =&gt; /users/foo.bar/baz

While the generated route seems legitimate, Rails will fail to respond properly to the baz path. While the first path (/users/foo.bar) works, thanks to :requirements specifying the legal formats of params[:id], :requirements doesn't seem to be passed down to the member function.

## Workarounds

One could do the follow above the users resource in routes.rb:

&gt; map.baz_user &quot;/users/:id/baz&quot;, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }

.. and then remove the member function. While the requirement RE can be moved into a constant, this is obviously an imperfect solution.

## Conclusion

I hope this is a legitimate bug as I have spent some time searching both the Web and Lighthouse for similar bugs but haven't found anything.</latest-body>
  <original-body-html>&lt;div&gt;&lt;h1&gt;Example&lt;/h1&gt;
&lt;h2&gt;routes.rb&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;map.resources :users, :requirements =&amp;gt; { :id =&amp;gt;
%r([^/;,?]+) }, :member =&amp;gt; { :baz =&amp;gt; :get }&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;user.rb&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;def to_param self.name end&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;The error&lt;/h2&gt;
&lt;h3&gt;Assume @user.name == 'foo'&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;user_path(@user) # =&amp;gt; /users/foo baz_user_path(@user) # =&amp;gt;
/users/foo/baz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Both work, and would without the :requirements option on the
named resource.&lt;/p&gt;
&lt;h3&gt;Now, with @user.name == 'foo.bar'&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;user_path(@user) # =&amp;gt; /users/foo.bar baz_user_path(@user) #
=&amp;gt; /users/foo.bar/baz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;While the generated route seems legitimate, Rails will fail to
respond properly to the baz path. While the first path
(/users/foo.bar) works, thanks to :requirements specifying the
legal formats of params[:id], :requirements doesn't seem to be
passed down to the member function.&lt;/p&gt;
&lt;h2&gt;Workarounds&lt;/h2&gt;
&lt;p&gt;One could do the follow above the users resource in
routes.rb:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;map.baz_user &quot;/users/:id/baz&quot;, :requirements =&amp;gt; { :id =&amp;gt;
%r([^/;,?]+) }&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;.. and then remove the member function. While the requirement RE
can be moved into a constant, this is obviously an imperfect
solution.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I hope this is a legitimate bug as I have spent some time
searching both the Web and Lighthouse for similar bugs but haven't
found anything.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body># Example

## routes.rb

&gt; map.resources :users, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }, :member =&gt; { :baz =&gt; :get }

## user.rb

&gt; def to_param
&gt;  self.name
&gt; end

## The error

### Assume @user.name == 'foo'

&gt; user_path(@user) # =&gt; /users/foo
&gt; baz_user_path(@user) # =&gt; /users/foo/baz

Both work, and would without the :requirements option on the named resource.

### Now, with @user.name == 'foo.bar'

&gt; user_path(@user) # =&gt; /users/foo.bar
&gt; baz_user_path(@user) # =&gt; /users/foo.bar/baz

While the generated route seems legitimate, Rails will fail to respond properly to the baz path. While the first path (/users/foo.bar) works, thanks to :requirements specifying the legal formats of params[:id], :requirements doesn't seem to be passed down to the member function.

## Workarounds

One could do the follow above the users resource in routes.rb:

&gt; map.baz_user &quot;/users/:id/baz&quot;, :requirements =&gt; { :id =&gt; %r([^/;,?]+) }

.. and then remove the member function. While the requirement RE can be moved into a constant, this is obviously an imperfect solution.

## Conclusion

I hope this is a legitimate bug as I have spent some time searching both the Web and Lighthouse for similar bugs but haven't found anything.</body>
      <body-html>&lt;div&gt;&lt;h1&gt;Example&lt;/h1&gt;
&lt;h2&gt;routes.rb&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;map.resources :users, :requirements =&amp;gt; { :id =&amp;gt;
%r([^/;,?]+) }, :member =&amp;gt; { :baz =&amp;gt; :get }&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;user.rb&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;def to_param self.name end&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;The error&lt;/h2&gt;
&lt;h3&gt;Assume @user.name == 'foo'&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;user_path(@user) # =&amp;gt; /users/foo baz_user_path(@user) # =&amp;gt;
/users/foo/baz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Both work, and would without the :requirements option on the
named resource.&lt;/p&gt;
&lt;h3&gt;Now, with @user.name == 'foo.bar'&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;user_path(@user) # =&amp;gt; /users/foo.bar baz_user_path(@user) #
=&amp;gt; /users/foo.bar/baz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;While the generated route seems legitimate, Rails will fail to
respond properly to the baz path. While the first path
(/users/foo.bar) works, thanks to :requirements specifying the
legal formats of params[:id], :requirements doesn't seem to be
passed down to the member function.&lt;/p&gt;
&lt;h2&gt;Workarounds&lt;/h2&gt;
&lt;p&gt;One could do the follow above the users resource in
routes.rb:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;map.baz_user &quot;/users/:id/baz&quot;, :requirements =&amp;gt; { :id =&amp;gt;
%r([^/;,?]+) }&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;.. and then remove the member function. While the requirement RE
can be moved into a constant, this is obviously an imperfect
solution.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I hope this is a legitimate bug as I have spent some time
searching both the Web and Lighthouse for similar bugs but haven't
found anything.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-23T22:46:41+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-02-23T22:46:43+00:00</updated-at>
      <user-id type="integer">42756</user-id>
      <version type="integer">1</version>
      <user-name>Marc Bowes</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Oh dddear. The blockquotes didn't work so well for the example code, it seems to have been squished onto one line. Sorry :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Oh dddear. The blockquotes didn't work so well for the example
code, it seems to have been squished onto one line. Sorry :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-23T22:48:46+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-02-23T22:48:48+00:00</updated-at>
      <user-id type="integer">42756</user-id>
      <version type="integer">2</version>
      <user-name>Marc Bowes</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-27T13:58:08+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-02-27T13:58:10+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">3</version>
      <user-name>DHH</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The problem is in resources.rb, in action_options_for. This method comes up with the options for a route, including which requirements to use, by looking at the action name. The baz route falls into the else:

default_options.merge(add_conditions_for(resource.conditions, method)).merge(resource.requirements)

That's correct for an added collection route (no ID required in the route), but for an added member route it ought to be:

default_options.merge(add_conditions_for(resource.conditions, method)).merge(resource.requirements(require_id))

One possible fix would be to change the else to:

resource.member_methods.include?(method) ? default_options.merge(add_conditions_for(resource.conditions, method)).merge(resource.requirements(require_id)) : default_options.merge(add_conditions_for(resource.conditions, method)).merge(resource.requirements)</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem is in resources.rb, in action_options_for. This
method comes up with the options for a route, including which
requirements to use, by looking at the action name. The baz route
falls into the else:&lt;/p&gt;
&lt;p&gt;default_options.merge(add_conditions_for(resource.conditions,
method)).merge(resource.requirements)&lt;/p&gt;
&lt;p&gt;That's correct for an added collection route (no ID required in
the route), but for an added member route it ought to be:&lt;/p&gt;
&lt;p&gt;default_options.merge(add_conditions_for(resource.conditions,
method)).merge(resource.requirements(require_id))&lt;/p&gt;
&lt;p&gt;One possible fix would be to change the else to:&lt;/p&gt;
&lt;p&gt;resource.member_methods.include?(method) ?
default_options.merge(add_conditions_for(resource.conditions,
method)).merge(resource.requirements(require_id)) :
default_options.merge(add_conditions_for(resource.conditions,
method)).merge(resource.requirements)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-04T12:05:44+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-04T12:05:49+00:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">4</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Mike that seems to cause a bunch of other problems with routes with name prefixes.

Please attach some failing unit tests otherwise punting till 2.x</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Mike that seems to cause a bunch of other problems with routes
with name prefixes.&lt;/p&gt;
&lt;p&gt;Please attach some failing unit tests otherwise punting till
2.x&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-04T19:15:29+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 24544
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-04T19:15:32+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Here's a failing test that passes with the fix I made (though as you point out that fix has other issues). I'll spend a bit more time looking at a possible patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's a failing test that passes with the fix I made (though as
you point out that fix has other issues). I'll spend a bit more
time looking at a possible patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-04T23:00:18+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-04T23:00:22+00:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">6</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>And...here's a patch that passes the test, and doesn't fail any other tests. (this patch includes the tests as well)</body>
      <body-html>&lt;div&gt;&lt;p&gt;And...here's a patch that passes the test, and doesn't fail any
other tests. (this patch includes the tests as well)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-04T23:59:52+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: wontfix
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-04T23:59:55+00:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">7</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [5b7527ca44521edf9782b3d7f449bf09a29267f2]) Failing test for routes with member &amp; requirement [#2054 state:resolved]

Signed-off-by: Joshua Peek &lt;josh@joshpeek.com&gt;
http://github.com/rails/rails/commit/5b7527ca44521edf9782b3d7f449bf09a29267f2</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [5b7527ca44521edf9782b3d7f449bf09a29267f2]) Failing test
for routes with member &amp;amp; requirement [&lt;a href=&quot;/projects/8994/tickets/2054&quot; title=&quot;Ticket #2054&quot;&gt;#2054&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Joshua Peek &lt;a href=&quot;mailto:josh@joshpeek.com&quot;&gt;josh@joshpeek.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/5b7527ca44521edf9782b3d7f449bf09a29267f2&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-06T00:49:41+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-06T00:49:44+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">8</version>
      <user-name>Repository</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This change breaks collection routes when a resource has a collection action and member action named the same. Attached is a failing test demonstrating as much. In the context of action_options_for, there is not enough information to determine whether to add the ID resource requirement or not.

Given we're close to 2.3, I'd recommend rolling back this commit to the previous broken behavior, rather than moving the problem, but perhaps someone can come up with a solution quickly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This change breaks collection routes when a resource has a
collection action and member action named the same. Attached is a
failing test demonstrating as much. In the context of
action_options_for, there is not enough information to determine
whether to add the ID resource requirement or not.&lt;/p&gt;
&lt;p&gt;Given we're close to 2.3, I'd recommend rolling back this commit
to the previous broken behavior, rather than moving the problem,
but perhaps someone can come up with a solution quickly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-13T21:37:06+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-13T21:37:09+00:00</updated-at>
      <user-id type="integer">17150</user-id>
      <version type="integer">9</version>
      <user-name>Luke Melia</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-13T22:07:46+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-13T22:07:50+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">10</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [5b025a1d119eaf09f5376209da212b76725747f8]) Revert 5b7527ca &quot;Failing test for routes with member &amp; requirement&quot; [#2054 state:wontfix]
http://github.com/rails/rails/commit/5b025a1d119eaf09f5376209da212b76725747f8</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [5b025a1d119eaf09f5376209da212b76725747f8]) Revert
5b7527ca &quot;Failing test for routes with member &amp;amp; requirement&quot;
[&lt;a href=&quot;/projects/8994/tickets/2054&quot; title=&quot;Ticket #2054&quot;&gt;#2054&lt;/a&gt; state:wontfix] &lt;a href=&quot;http://github.com/rails/rails/commit/5b025a1d119eaf09f5376209da212b76725747f8&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-13T23:14:56+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-13T23:14:59+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">11</version>
      <user-name>Repository</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Attached patch handles both cases (the original and the breakage that Luke spotted) by passing additional information into action_options_for. I'd like a more elegant solution, but I believe this one is safe.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached patch handles both cases (the original and the breakage
that Luke spotted) by passing additional information into
action_options_for. I'd like a more elegant solution, but I believe
this one is safe.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-14T01:55:28+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: wontfix
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-14T01:55:31+00:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">12</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I can confirm that Mike's new patch not only passes the test but also works properly in the real-world app that surfaced this issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that Mike's new patch not only passes the test but
also works properly in the real-world app that surfaced this
issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-14T04:04:33+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-14T04:04:35+00:00</updated-at>
      <user-id type="integer">17150</user-id>
      <version type="integer">13</version>
      <user-name>Luke Melia</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [07710fd3e0c5c84521b7929738ba33cea99bc108]) Fix requirements for additional member/collection routes [#2054 state:resolved]

Signed-off-by: Joshua Peek &lt;josh@joshpeek.com&gt;
http://github.com/rails/rails/commit/07710fd3e0c5c84521b7929738ba33cea99bc108</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [07710fd3e0c5c84521b7929738ba33cea99bc108]) Fix
requirements for additional member/collection routes [&lt;a href=&quot;/projects/8994/tickets/2054&quot; title=&quot;Ticket #2054&quot;&gt;#2054&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Joshua Peek &lt;a href=&quot;mailto:josh@joshpeek.com&quot;&gt;josh@joshpeek.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/07710fd3e0c5c84521b7929738ba33cea99bc108&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-14T15:06:14+00:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-03-14T15:06:15+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Before the change this (minimal case):

class Spot
  def to_param
    id
  end
end

worked. After the change, I got:

app.spot_path(Spot.first)
TypeError: can't convert Fixnum into String
	from generated code (/Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route.rb:160):6:in `generate_raw'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route.rb:131:in `generate'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route_set.rb:384:in `generate'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:205:in `rewrite_path'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:184:in `rewrite_url'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:162:in `rewrite'
	from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/integration.rb:243:in `url_for'
	from (eval):16:in `spot_path'
	from (irb):3


I realize that I should have returned id.to_s in the first place, but I'm not sure if is/was expected to work with integers too... All in all now it doesn't anymore... Don't know enough about this subject to contribute a patch, but would love to learn more - especially if it's ok as it is or it does need to be patched.

Thank you
david</body>
      <body-html>&lt;div&gt;&lt;p&gt;Before the change this (minimal case):&lt;/p&gt;
&lt;p&gt;class Spot def to_param&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;id
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end end&lt;/p&gt;
&lt;p&gt;worked. After the change, I got:&lt;/p&gt;
&lt;p&gt;app.spot_path(Spot.first) TypeError: can't convert Fixnum into
String&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;from generated code (/Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route.rb:160):6:in `generate_raw'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route.rb:131:in `generate'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/routing/route_set.rb:384:in `generate'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:205:in `rewrite_path'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:184:in `rewrite_url'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/url_rewriter.rb:162:in `rewrite'
from /Users/david/Projects/oc/vendor/rails/actionpack/lib/action_controller/integration.rb:243:in `url_for'
from (eval):16:in `spot_path'
from (irb):3
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I realize that I should have returned id.to_s in the first
place, but I'm not sure if is/was expected to work with integers
too... All in all now it doesn't anymore... Don't know enough about
this subject to contribute a patch, but would love to learn more -
especially if it's ok as it is or it does need to be patched.&lt;/p&gt;
&lt;p&gt;Thank you david&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-05T16:31:07+01:00</created-at>
      <creator-id type="integer">42756</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2054</number>
      <permalink>requirements-not-passed-to-named_route-generated-by-member</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>action_controller resources</tag>
      <title>:requirements not passed to named_route generated by :member</title>
      <updated-at type="datetime">2009-04-05T16:31:11+01:00</updated-at>
      <user-id type="integer">10378</user-id>
      <version type="integer">15</version>
      <user-name>David Krmpotic</user-name>
      <creator-name>Marc Bowes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2054</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>1335708c7747a5f8e2fa24abfb60e580dc78653d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-04T23:00:18+00:00</created-at>
      <filename>member_requirement.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">96130</id>
      <size type="integer">1252</size>
      <uploader-id type="integer">7211</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/96130/member_requirement.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>7936c5923cab068f6bffb7ce7dc5ca6aa0322e90</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-04T23:59:52+00:00</created-at>
      <filename>member_requirement.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">96173</id>
      <size type="integer">3096</size>
      <uploader-id type="integer">7211</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/96173/member_requirement.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>e8ff4fc2b8ae7d4deb3c646a8b496164855dcc83</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-13T21:37:06+00:00</created-at>
      <filename>test_showing_problem_with_routing_change.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">99763</id>
      <size type="integer">1423</size>
      <uploader-id type="integer">17150</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/99763/test_showing_problem_with_routing_change.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>1f5b8a6c702889c6fe91a91a1344f269933461f3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-14T01:55:28+00:00</created-at>
      <filename>member_routes.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">99827</id>
      <size type="integer">5574</size>
      <uploader-id type="integer">7211</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/99827/member_routes.diff</url>
    </attachment>
  </attachments>
</ticket>
