<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-12-30T01:30:11+00:00</created-at>
  <creator-id type="integer">8944</creator-id>
  <milestone-due-on type="datetime">2009-01-31T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1668</number>
  <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
  <priority type="integer">89</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>multipart rack</tag>
  <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
  <updated-at type="datetime">2009-01-04T18:13:52+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">11</version>
  <user-name>Repository</user-name>
  <creator-name>Bence Nagy</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
  <priority-name nil="true"></priority-name>
  <original-body>Rails does not handle multipart forms unless I disable 'use ActionController::VerbPiggybacking' in middlewares.rb. Platform: Ubuntu 8.10 with the latest REE, Passenger 2.0.6 and 2.1.0 (Edge).

/!\ FAILSAFE /!\  2008. december 30., 01:37
  Status: 500 Internal Server Error
  no content body
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /opt/ruby-enterprise-1.8.6-20081215/lib/ruby/gems/1.8/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:95:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:81:in `call'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/rack/request_handler.rb:65:in `process_request'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_request_handler.rb:204:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:331:in `start_request_handler'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:294:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/utils.rb:180:in `safe_fork'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:292:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:149:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:187:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:260:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:121:in `lookup_or_add'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:254:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:75:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:74:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:253:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:148:in `spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:285:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/bin/passenger-spawn-server:46</original-body>
  <latest-body>Rails does not handle multipart forms unless I disable 'use ActionController::VerbPiggybacking' in middlewares.rb. Platform: Ubuntu 8.10 with the latest REE, Passenger 2.0.6 and 2.1.0 (Edge).

/!\ FAILSAFE /!\  2008. december 30., 01:37
  Status: 500 Internal Server Error
  no content body
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /opt/ruby-enterprise-1.8.6-20081215/lib/ruby/gems/1.8/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:95:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:81:in `call'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/rack/request_handler.rb:65:in `process_request'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_request_handler.rb:204:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:331:in `start_request_handler'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:294:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/utils.rb:180:in `safe_fork'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:292:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:149:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:187:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:260:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:121:in `lookup_or_add'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:254:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:75:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:74:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:253:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:148:in `spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:285:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/bin/passenger-spawn-server:46</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Rails does not handle multipart forms unless I disable 'use
ActionController::VerbPiggybacking' in middlewares.rb. Platform:
Ubuntu 8.10 with the latest REE, Passenger 2.0.6 and 2.1.0
(Edge).&lt;/p&gt;
&lt;p&gt;/!\ FAILSAFE /!\ 2008. december 30., 01:37 Status: 500 Internal
Server Error no content body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
/opt/ruby-enterprise-1.8.6-20081215/lib/ruby/gems/1.8/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
/home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
/home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:95:in `call'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:81:in `call'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/rack/request_handler.rb:65:in `process_request'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_request_handler.rb:204:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:331:in `start_request_handler'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:294:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/utils.rb:180:in `safe_fork'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:292:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:149:in `start'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:187:in `start'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:260:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:121:in `lookup_or_add'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:254:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:75:in `synchronize'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:74:in `synchronize'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:253:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:148:in `spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:285:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/bin/passenger-spawn-server:46
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Rails does not handle multipart forms unless I disable 'use ActionController::VerbPiggybacking' in middlewares.rb. Platform: Ubuntu 8.10 with the latest REE, Passenger 2.0.6 and 2.1.0 (Edge).

/!\ FAILSAFE /!\  2008. december 30., 01:37
  Status: 500 Internal Server Error
  no content body
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /opt/ruby-enterprise-1.8.6-20081215/lib/ruby/gems/1.8/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:95:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
    /home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
    /home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:81:in `call'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/rack/request_handler.rb:65:in `process_request'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_request_handler.rb:204:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:331:in `start_request_handler'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:294:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/utils.rb:180:in `safe_fork'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:292:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:149:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:187:in `start'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:260:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:121:in `lookup_or_add'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:254:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:75:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:74:in `synchronize'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:253:in `spawn_rails_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:148:in `spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:285:in `handle_spawn_application'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
    /opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/bin/passenger-spawn-server:46</body>
      <body-html>&lt;div&gt;&lt;p&gt;Rails does not handle multipart forms unless I disable 'use
ActionController::VerbPiggybacking' in middlewares.rb. Platform:
Ubuntu 8.10 with the latest REE, Passenger 2.0.6 and 2.1.0
(Edge).&lt;/p&gt;
&lt;p&gt;/!\ FAILSAFE /!\ 2008. december 30., 01:37 Status: 500 Internal
Server Error no content body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
/opt/ruby-enterprise-1.8.6-20081215/lib/ruby/gems/1.8/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
/home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
/home/nagybence/dev/moly/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:95:in `call'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
/home/nagybence/dev/moly/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
/home/nagybence/dev/moly/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:81:in `call'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/rack/request_handler.rb:65:in `process_request'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_request_handler.rb:204:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:331:in `start_request_handler'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:294:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/utils.rb:180:in `safe_fork'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:292:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:149:in `start'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/railz/application_spawner.rb:187:in `start'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:260:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:121:in `lookup_or_add'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:254:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:75:in `synchronize'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server_collection.rb:74:in `synchronize'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:253:in `spawn_rails_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:148:in `spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/spawn_manager.rb:285:in `handle_spawn_application'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `__send__'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:332:in `main_loop'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/lib/passenger/abstract_server.rb:182:in `start_synchronously'
/opt/ruby-enterprise/lib/ruby/gems/1.8/gems/passenger-2.1.0/bin/passenger-spawn-server:46
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-30T01:30:11+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>passenger</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2008-12-30T01:30:12+00:00</updated-at>
      <user-id type="integer">8944</user-id>
      <version type="integer">1</version>
      <user-name>Bence Nagy</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is a critical bug and I want to get it fixed ASAP. I just need a little bit more information. Is there anyway you can put together a unit test case?</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is a critical bug and I want to get it fixed ASAP. I just
need a little bit more information. Is there anyway you can put
together a unit test case?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-30T03:48:24+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>passenger</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2008-12-30T03:48:28+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">2</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sorry I can not say more closer. It works if I delete 'req.parameters[:_method]' in verb_piggybacking.rb (line: #13), so it fails at Request.parameters. And I do not know how to write and run a test under Passenger...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry I can not say more closer. It works if I delete
'req.parameters[:_method]' in verb_piggybacking.rb (line: &lt;a href=&quot;/projects/8994/tickets/13&quot; title=&quot;Ticket #13&quot;&gt;#13&lt;/a&gt;), so it
fails at Request.parameters. And I do not know how to write and run
a test under Passenger...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-30T09:59:09+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>passenger</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2008-12-30T09:59:10+00:00</updated-at>
      <user-id type="integer">8944</user-id>
      <version type="integer">3</version>
      <user-name>Bence Nagy</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I met the same issue with rails edge &amp; passenger, but work very well under mongrel at my localhost</body>
      <body-html>&lt;div&gt;&lt;p&gt;I met the same issue with rails edge &amp;amp; passenger, but work
very well under mongrel at my localhost&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-31T08:07:32+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>passenger</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2008-12-31T08:07:36+00:00</updated-at>
      <user-id type="integer">35064</user-id>
      <version type="integer">4</version>
      <user-name>Suave Su</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Added a test to prove this bug:
http://github.com/rails/rails/commit/f7ee082bb3cde977a199b81207e5d12e1d7101b3

I still don't have a solid fix yet.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Added a test to prove this bug: &lt;a href=&quot;http://github.com/rails/rails/commit/f7ee082bb3cde977a199b81207e5d12e1d7101b3&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I still don't have a solid fix yet.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-03T00:46:12+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: passenger
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-03T00:46:15+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I assume the Body got read once and since it's an UnixSocket on some systems this renders the whole POST body invalid (no .rewind) when ActionController tries to dispatch.

@@@
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:303:in `read_multipart'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:15:in `call'
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I assume the Body got read once and since it's an UnixSocket on
some systems this renders the whole POST body invalid (no .rewind)
when ActionController tries to dispatch.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:303:in `read_multipart'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /Users/florian/dev/farmfacts/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:15:in `call'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T11:41:02+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T11:41:05+00:00</updated-at>
      <user-id type="integer">17655</user-id>
      <version type="integer">6</version>
      <user-name>Florian A&#223;mann</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I got a MethodNotAllowed from ActionController::Routing::RouteSet[64] so I learning some more Rails internals where I found something far away from VerbPiggybacking.

polymorphic_path currently generates wrong paths, imho:

create_path = polymorphic_path [:admin, record, record.attachments.new]
# Before: /admin/articles/2/attachments
# After: /admin/articles/2

Well, when an exception is raised at this point the @env got lost somehow in
ActionController::Dispatcher[66] and I must correct my habit to first look into the log where, in this case, no information about the requested url can be found, but to look in the browser address bar.

Now I'll try to get @env inplace...</body>
      <body-html>&lt;div&gt;&lt;p&gt;I got a MethodNotAllowed from
ActionController::Routing::RouteSet[64] so I learning some more
Rails internals where I found something far away from
VerbPiggybacking.&lt;/p&gt;
&lt;p&gt;polymorphic_path currently generates wrong paths, imho:&lt;/p&gt;
&lt;p&gt;create_path = polymorphic_path [:admin, record,
record.attachments.new]&lt;/p&gt;
&lt;h1&gt;Before: /admin/articles/2/attachments&lt;/h1&gt;
&lt;h1&gt;After: /admin/articles/2&lt;/h1&gt;
&lt;p&gt;Well, when an exception is raised at this point the @env got
lost somehow in ActionController::Dispatcher[66] and I must correct
my habit to first look into the log where, in this case, no
information about the requested url can be found, but to look in
the browser address bar.&lt;/p&gt;
&lt;p&gt;Now I'll try to get @env inplace...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T12:21:24+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T12:21:26+00:00</updated-at>
      <user-id type="integer">17655</user-id>
      <version type="integer">7</version>
      <user-name>Florian A&#223;mann</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Ok, I extended the global rescue hack to get the response back in place.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ok, I extended the global rescue hack to get the response back
in place.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T12:50:42+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T12:50:44+00:00</updated-at>
      <user-id type="integer">17655</user-id>
      <version type="integer">8</version>
      <user-name>Florian A&#223;mann</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>polymorphic_path works correctly</body>
      <body-html>&lt;div&gt;&lt;p&gt;polymorphic_path works correctly&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T13:13:11+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T13:13:15+00:00</updated-at>
      <user-id type="integer">17655</user-id>
      <version type="integer">9</version>
      <user-name>Florian A&#223;mann</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The problem with the already read body still exists:

@@@
/!\ FAILSAFE /!\  Sun Jan 04 16:24:33 +0100 2009
  Status: 500 Internal Server Error
  no content body
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
    /var/www/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
    /var/www/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /var/www/vendor/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /var/www/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
    /var/www/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /var/www/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /var/www/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem with the already read body still exists:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
/!\ FAILSAFE /!\  Sun Jan 04 16:24:33 +0100 2009
  Status: 500 Internal Server Error
  no content body
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:225:in `read_multipart'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:153:in `parse_multipart_form_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:67:in `parse_formatted_request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request_parser.rb:8:in `request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request.rb:438:in `request_parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/request.rb:397:in `parameters'
    /var/www/vendor/rails/actionpack/lib/action_controller/base.rb:1221:in `assign_shortcuts'
    /var/www/vendor/rails/actionpack/lib/action_controller/base.rb:521:in `process_without_filters'
    /var/www/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /var/www/vendor/gems/haml-2.0.6/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /var/www/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:66:in `dispatch'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:86:in `_call'
    /var/www/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:57:in `initialize'
    /var/www/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /var/www/vendor/rails/railties/lib/rails/rack/metal.rb:32:in `call'
    /var/www/vendor/rails/actionpack/lib/action_controller/verb_piggybacking.rb:21:in `call'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T15:49:29+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T15:49:32+00:00</updated-at>
      <user-id type="integer">17655</user-id>
      <version type="integer">10</version>
      <user-name>Florian A&#223;mann</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [f00e86d7e9c7a4689a49fc085bcb757c5a2c0b03]) Memoize request accessors on the Rack env so other request objects have access to the same cache [#1668 state:resolved]
http://github.com/rails/rails/commit/f00e86d7e9c7a4689a49fc085bcb757c5a2c0b03</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [f00e86d7e9c7a4689a49fc085bcb757c5a2c0b03]) Memoize
request accessors on the Rack env so other request objects have
access to the same cache [&lt;a href=&quot;/projects/8994/tickets/1668&quot; title=&quot;Ticket #1668&quot;&gt;#1668&lt;/a&gt; state:resolved] &lt;a href=&quot;http://github.com/rails/rails/commit/f00e86d7e9c7a4689a49fc085bcb757c5a2c0b03&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-04T18:13:51+00:00</created-at>
      <creator-id type="integer">8944</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1668</number>
      <permalink>use-actioncontrollerverbpiggybacking-brakes-multipart-forms-with-passenger</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart rack</tag>
      <title>'use ActionController::VerbPiggybacking' brakes multipart forms with Passenger</title>
      <updated-at type="datetime">2009-01-04T18:13:52+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">11</version>
      <user-name>Repository</user-name>
      <creator-name>Bence Nagy</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1668</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>13da7e3a27ddbde8454bde8eb9b1a4e23d11a7d3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-01-04T12:50:42+00:00</created-at>
      <filename>extended_global_rescue_hack.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">75219</id>
      <size type="integer">2136</size>
      <uploader-id type="integer">17655</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/75219/extended_global_rescue_hack.diff</url>
    </attachment>
  </attachments>
</ticket>
