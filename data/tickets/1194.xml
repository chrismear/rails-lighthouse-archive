<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">17393</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-10-08T22:01:25+01:00</created-at>
  <creator-id type="integer">22589</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">1194</number>
  <permalink>console-sandbox-does-not-work</permalink>
  <priority type="integer">602</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>bug bug console patch</tag>
  <title>Console --sandbox 2.1.2 not fixed?</title>
  <updated-at type="datetime">2008-11-18T07:45:40+00:00</updated-at>
  <user-id type="integer">38014</user-id>
  <version type="integer">5</version>
  <user-name>MarcD</user-name>
  <creator-name>Matt Jones</creator-name>
  <assigned-user-name>Repository</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>As first described [on Rails talk](http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/cf9aaccd5c3057c7), script/console -s
gives the error:

@@@ ruby
.../vendor/rails/activerecord/lib/active_record/base.rb:1824:in `method_missing':NoMethodError: undefined method `increment_open_transactions' for ActiveRecord::Base:Class

@@@

on Edge. I'll also add that it doesn't roll back transactions.

The attached patch fixes the problem.</original-body>
  <latest-body>As first described [on Rails talk](http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/cf9aaccd5c3057c7), script/console -s
gives the error:

@@@ ruby
.../vendor/rails/activerecord/lib/active_record/base.rb:1824:in `method_missing':NoMethodError: undefined method `increment_open_transactions' for ActiveRecord::Base:Class

@@@

on Edge. I'll also add that it doesn't roll back transactions.

The attached patch fixes the problem.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;As first described &lt;a href=&quot;http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/cf9aaccd5c3057c7&quot;&gt;
on Rails talk&lt;/a&gt;, script/console -s gives the error:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
.../vendor/rails/activerecord/lib/active_record/base.rb:1824:in `method_missing':NoMethodError: undefined method `increment_open_transactions' for ActiveRecord::Base:Class

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;on Edge. I'll also add that it doesn't roll back
transactions.&lt;/p&gt;
&lt;p&gt;The attached patch fixes the problem.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>As first described [on Rails talk](http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/cf9aaccd5c3057c7), script/console -s
gives the error:

@@@ ruby
.../vendor/rails/activerecord/lib/active_record/base.rb:1824:in `method_missing':NoMethodError: undefined method `increment_open_transactions' for ActiveRecord::Base:Class

@@@

on Edge. I'll also add that it doesn't roll back transactions.

The attached patch fixes the problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;As first described &lt;a href=&quot;http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/cf9aaccd5c3057c7&quot;&gt;
on Rails talk&lt;/a&gt;, script/console -s gives the error:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
.../vendor/rails/activerecord/lib/active_record/base.rb:1824:in `method_missing':NoMethodError: undefined method `increment_open_transactions' for ActiveRecord::Base:Class

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;on Edge. I'll also add that it doesn't roll back
transactions.&lt;/p&gt;
&lt;p&gt;The attached patch fixes the problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-10-08T22:01:25+01:00</created-at>
      <creator-id type="integer">22589</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1194</number>
      <permalink>console-sandbox-does-not-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug bug console patch</tag>
      <title>Console --sandbox does not work</title>
      <updated-at type="datetime">2008-10-08T22:01:27+01:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">1</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Matt Jones</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [aa4a7c35309ff95ef1165844d637f7e583ac20dd]) Fix script/console --sandbox warning. [#1194 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/aa4a7c35309ff95ef1165844d637f7e583ac20dd</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [aa4a7c35309ff95ef1165844d637f7e583ac20dd]) Fix
script/console --sandbox warning. [&lt;a href=&quot;/projects/8994/tickets/1194&quot; title=&quot;Ticket #1194&quot;&gt;#1194&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a href=&quot;mailto:pratiknaik@gmail.com&quot;&gt;pratiknaik@gmail.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/aa4a7c35309ff95ef1165844d637f7e583ac20dd&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-09T01:36:24+01:00</created-at>
      <creator-id type="integer">22589</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1194</number>
      <permalink>console-sandbox-does-not-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bug bug console patch</tag>
      <title>Console --sandbox does not work</title>
      <updated-at type="datetime">2008-10-09T01:36:28+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">2</version>
      <user-name>Repository</user-name>
      <creator-name>Matt Jones</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [bbb2fda11564b2d40c6c07c5a3c91cccb77fb653]) Fix script/console --sandbox warning. [#1194 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/bbb2fda11564b2d40c6c07c5a3c91cccb77fb653</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [bbb2fda11564b2d40c6c07c5a3c91cccb77fb653]) Fix
script/console --sandbox warning. [&lt;a href=&quot;/projects/8994/tickets/1194&quot; title=&quot;Ticket #1194&quot;&gt;#1194&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a href=&quot;mailto:pratiknaik@gmail.com&quot;&gt;pratiknaik@gmail.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/bbb2fda11564b2d40c6c07c5a3c91cccb77fb653&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-09T01:41:52+01:00</created-at>
      <creator-id type="integer">22589</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1194</number>
      <permalink>console-sandbox-does-not-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bug bug console patch</tag>
      <title>Console --sandbox does not work</title>
      <updated-at type="datetime">2008-10-09T01:41:56+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">3</version>
      <user-name>Repository</user-name>
      <creator-name>Matt Jones</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [197e61c5b1df89260ee5077c7e3c94e61a51b6a2]) Revert &quot;Fix script/console --sandbox warning. [#1194 state:resolved]&quot;

This reverts commit bbb2fda11564b2d40c6c07c5a3c91cccb77fb653.
http://github.com/rails/rails/commit/197e61c5b1df89260ee5077c7e3c94e61a51b6a2</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [197e61c5b1df89260ee5077c7e3c94e61a51b6a2]) Revert &quot;Fix
script/console --sandbox warning. [&lt;a href=&quot;/projects/8994/tickets/1194&quot; title=&quot;Ticket #1194&quot;&gt;#1194&lt;/a&gt;
state:resolved]&quot;&lt;/p&gt;
&lt;p&gt;This reverts commit bbb2fda11564b2d40c6c07c5a3c91cccb77fb653.
&lt;a href=&quot;http://github.com/rails/rails/commit/197e61c5b1df89260ee5077c7e3c94e61a51b6a2&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-24T21:15:26+01:00</created-at>
      <creator-id type="integer">22589</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1194</number>
      <permalink>console-sandbox-does-not-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bug bug console patch</tag>
      <title>Console --sandbox does not work</title>
      <updated-at type="datetime">2008-10-24T21:15:29+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Matt Jones</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17393</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Even though it seems there is a patch for this in rails 2.1.2, I am still getting this error.  Any ideas why?  Maybe this ticket should be reopened?  I have a clean install of rails 2.1.2, mysql-2.7.  I should not be getting this error.  


Loading development environment in sandbox (Rails 2.1.2)
Any modifications you make will be rolled back on exit
/usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/console_sandbox.rb:2:NoMethodError: undefined method `increment_open_transactions' for #&lt;ActiveRecord::ConnectionAdapters::MysqlAdapter:0xb6e89fe8&gt;


If I revert the diff back to the way it was in rails 2.1.0 then the warning goes away.  Here is the revert of the diff.

+ActiveRecord::Base.send :increment_open_transactions
-ActiveRecord::Base.connection.increment_open_transactions
 ActiveRecord::Base.connection.begin_db_transaction
 at_exit do
   ActiveRecord::Base.connection.rollback_db_transaction
+  ActiveRecord::Base.send :decrement_open_transactions
-  ActiveRecord::Base.connection.decrement_open_transactions
 end


For some reason I am getting errors on transactions in the console.    With 2.1.2 as is and with 2.1.2 reverting console_sandbox.rb.  I get the same error for both:

ArgumentError: wrong number of arguments (0 for 1)
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/timestamp.rb:33:in `changed?'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/timestamp.rb:33:in `update'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/base.rb:2483:in `create_or_update_without_callbacks'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/callbacks.rb:207:in `create_or_update'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/base.rb:2217:in `save_without_validation!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/validations.rb:921:in `save_without_dirty!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/dirty.rb:83:in `save_without_transactions!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:79:in `transaction'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:98:in `transaction'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:118:in `rollback_active_record_state!'
        from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
        from /home/marc/rails_projects/fb_app/vendor/plugins/facebooker/lib/facebooker/rails/publisher.rb:116:in `register'
        from /home/marc/rails_projects/fb_app/vendor/plugins/facebooker/lib/facebooker/rails/publisher.rb:423:in `method_missing'
        from (irb):4&gt;&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;Even though it seems there is a patch for this in rails 2.1.2, I
am still getting this error. Any ideas why? Maybe this ticket
should be reopened? I have a clean install of rails 2.1.2,
mysql-2.7. I should not be getting this error.&lt;/p&gt;
&lt;p&gt;Loading development environment in sandbox (Rails 2.1.2) Any
modifications you make will be rolled back on exit
/usr/lib/ruby/gems/1.8/gems/rails-2.1.2/lib/console_sandbox.rb:2:NoMethodError:
undefined method &lt;code&gt;increment_open_transactions' for
#&amp;lt;ActiveRecord::ConnectionAdapters::MysqlAdapter:0xb6e89fe8&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If I revert the diff back to the way it was in rails 2.1.0 then
the warning goes away. Here is the revert of the diff.&lt;/p&gt;
&lt;p&gt;+ActiveRecord::Base.send :increment_open_transactions
-ActiveRecord::Base.connection.increment_open_transactions
ActiveRecord::Base.connection.begin_db_transaction at_exit do
ActiveRecord::Base.connection.rollback_db_transaction +
ActiveRecord::Base.send :decrement_open_transactions -
ActiveRecord::Base.connection.decrement_open_transactions end&lt;/p&gt;
&lt;p&gt;For some reason I am getting errors on transactions in the
console. With 2.1.2 as is and with 2.1.2 reverting
console_sandbox.rb. I get the same error for both:&lt;/p&gt;
&lt;p&gt;ArgumentError: wrong number of arguments (0 for 1)&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/timestamp.rb:33:in `changed?'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/timestamp.rb:33:in `update'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/base.rb:2483:in `create_or_update_without_callbacks'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/callbacks.rb:207:in `create_or_update'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/base.rb:2217:in `save_without_validation!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/validations.rb:921:in `save_without_dirty!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/dirty.rb:83:in `save_without_transactions!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:79:in `transaction'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:98:in `transaction'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:118:in `rollback_active_record_state!'
    from /usr/lib/ruby/gems/1.8/gems/activerecord-2.1.2/lib/active_record/transactions.rb:110:in `save!'
    from /home/marc/rails_projects/fb_app/vendor/plugins/facebooker/lib/facebooker/rails/publisher.rb:116:in `register'
    from /home/marc/rails_projects/fb_app/vendor/plugins/facebooker/lib/facebooker/rails/publisher.rb:423:in `method_missing'
    from (irb):4&amp;gt;&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-18T07:45:39+00:00</created-at>
      <creator-id type="integer">22589</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
:title: Console --sandbox does not work
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1194</number>
      <permalink>console-sandbox-does-not-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bug bug console patch</tag>
      <title>Console --sandbox 2.1.2 not fixed?</title>
      <updated-at type="datetime">2008-11-18T07:45:40+00:00</updated-at>
      <user-id type="integer">38014</user-id>
      <version type="integer">5</version>
      <user-name>MarcD</user-name>
      <creator-name>Matt Jones</creator-name>
      <assigned-user-name>Repository</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1194</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>40dc65cb2d1549ef119741f2994f4032f63d8a43</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-10-08T22:01:25+01:00</created-at>
      <filename>fix-console.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">52564</id>
      <size type="integer">855</size>
      <uploader-id type="integer">22589</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/52564/fix-console.diff</url>
    </attachment>
  </attachments>
</ticket>
