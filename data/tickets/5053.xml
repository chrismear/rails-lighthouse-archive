<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">15</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-10-25T03:19:12+01:00</created-at>
  <creator-id type="integer">87199</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">73534</milestone-id>
  <number type="integer">5053</number>
  <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>child/grandchild associations reload from db after nested attributes assignment</title>
  <updated-at type="datetime">2010-11-08T08:54:58+00:00</updated-at>
  <user-id type="integer">94458</user-id>
  <version type="integer">72</version>
  <user-name>Jeff Kreeftmeijer</user-name>
  <creator-name>szetobo</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
  <milestone-title>2.3.9</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>When validating fails on updating record by nested attributes, the child/grandchild associations collection will be reload from database.

@@@ ruby
  @ship = Ship.create!(:name =&gt; &quot;The good ship Dollypop&quot;)
  @part = @ship.parts.create!(:name =&gt; &quot;Mast&quot;)
  @trinket = @part.trinkets.create!(:name =&gt; &quot;Necklace&quot;)

  @ship.attributes = {:name =&gt; nil, :parts_attributes =&gt; [{:id =&gt; @part.id, :name =&gt; 'Deck', :trinkets_attributes =&gt; [{:id =&gt; @trinket.id, :name =&gt; &quot;Ruby&quot;}]}]}
  @ship.save
@@@

Then

    @ship.parts.first.name == &quot;Mast&quot;
    @ship.parts.first.trinkets.first.name == &quot;Necklace&quot;</original-body>
  <latest-body>When validating fails on updating record by nested attributes, the child/grandchild associations collection will be reload from database.

@@@ ruby
  @ship = Ship.create!(:name =&gt; &quot;The good ship Dollypop&quot;)
  @part = @ship.parts.create!(:name =&gt; &quot;Mast&quot;)
  @trinket = @part.trinkets.create!(:name =&gt; &quot;Necklace&quot;)

  @ship.attributes = {:name =&gt; nil, :parts_attributes =&gt; [{:id =&gt; @part.id, :name =&gt; 'Deck', :trinkets_attributes =&gt; [{:id =&gt; @trinket.id, :name =&gt; &quot;Ruby&quot;}]}]}
  @ship.save
@@@

Then

    @ship.parts.first.name == &quot;Mast&quot;
    @ship.parts.first.trinkets.first.name == &quot;Necklace&quot;</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When validating fails on updating record by nested attributes,
the child/grandchild associations collection will be reload from
database.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;  @ship = Ship.create!(:name =&amp;gt; &quot;The good ship Dollypop&quot;)
  @part = @ship.parts.create!(:name =&amp;gt; &quot;Mast&quot;)
  @trinket = @part.trinkets.create!(:name =&amp;gt; &quot;Necklace&quot;)

  @ship.attributes = {:name =&amp;gt; nil, :parts_attributes =&amp;gt; [{:id =&amp;gt; @part.id, :name =&amp;gt; 'Deck', :trinkets_attributes =&amp;gt; [{:id =&amp;gt; @trinket.id, :name =&amp;gt; &quot;Ruby&quot;}]}]}
  @ship.save&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Then&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@ship.parts.first.name == &quot;Mast&quot;
@ship.parts.first.trinkets.first.name == &quot;Necklace&quot;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When validating fails on updating record by nested attributes, the child/grandchild associations collection will be reload from database.

@@@ ruby
  @ship = Ship.create!(:name =&gt; &quot;The good ship Dollypop&quot;)
  @part = @ship.parts.create!(:name =&gt; &quot;Mast&quot;)
  @trinket = @part.trinkets.create!(:name =&gt; &quot;Necklace&quot;)

  @ship.attributes = {:name =&gt; nil, :parts_attributes =&gt; [{:id =&gt; @part.id, :name =&gt; 'Deck', :trinkets_attributes =&gt; [{:id =&gt; @trinket.id, :name =&gt; &quot;Ruby&quot;}]}]}
  @ship.save
@@@

Then

    @ship.parts.first.name == &quot;Mast&quot;
    @ship.parts.first.trinkets.first.name == &quot;Necklace&quot;</body>
      <body-html>&lt;div&gt;&lt;p&gt;When validating fails on updating record by nested attributes,
the child/grandchild associations collection will be reload from
database.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;  @ship = Ship.create!(:name =&amp;gt; &quot;The good ship Dollypop&quot;)
  @part = @ship.parts.create!(:name =&amp;gt; &quot;Mast&quot;)
  @trinket = @part.trinkets.create!(:name =&amp;gt; &quot;Necklace&quot;)

  @ship.attributes = {:name =&amp;gt; nil, :parts_attributes =&amp;gt; [{:id =&amp;gt; @part.id, :name =&amp;gt; 'Deck', :trinkets_attributes =&amp;gt; [{:id =&amp;gt; @trinket.id, :name =&amp;gt; &quot;Ruby&quot;}]}]}
  @ship.save&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Then&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@ship.parts.first.name == &quot;Mast&quot;
@ship.parts.first.trinkets.first.name == &quot;Necklace&quot;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-06T12:10:34+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;nested attributes&quot;</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-06T12:10:37+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">1</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is what's happening based on my analysis. Here is how I setup the models.

@@@ ruby
ActiveRecord::Schema.define(:version =&gt; 20100706145311) do
  create_table &quot;ship_parts&quot;, :force =&gt; true do |t|
    t.string  &quot;name&quot;
    t.integer &quot;ship_id&quot;
  end
  create_table &quot;ships&quot;, :force =&gt; true do |t|
    t.string &quot;name&quot;
  end
end

class Ship &lt; ActiveRecord::Base
  has_many :parts , :class_name =&gt; 'ShipPart'
  accepts_nested_attributes_for :parts, :allow_destroy =&gt; true

  validates_presence_of :name

  def self.lab
    @ship = Ship.create!(:name =&gt; &quot;The good ship Dollypop&quot;)
    @part = @ship.parts.create!(:name =&gt; &quot;Mast&quot;)
    @ship.reload
    @ship.attributes = {:name =&gt; nil, :parts_attributes =&gt; [{:id =&gt; @part.id, :name =&gt; 'Deck' }]}
    @ship.save
    puts @ship.parts.first.name
    #puts @ship.parts[0].name
  end

end
class ShipPart &lt; ActiveRecord::Base
  belongs_to :ship
  validates_presence_of :name
end
@@@

First thing is that we need to have @ship.reload. without that @ship thinks that children are already loaded and never really looks into the updated children values.

Second thing is that when you invoke @ship.parts.first.name rails invokes a query to the database even if @ship.parts is already loaded. In order to inquire about the loaded child you need to do 
puts @ship.parts[0].name . 

And with these two changes a) @ship.reload and b)@ship.parts[0].name you get 'Deck' as the final output.

I do think that @ship.reload issue should be fixed. Looked at code but not sure where to fix. I am marking this ticket as open because of the reload issue. Someone else might know the fix.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is what's happening based on my analysis. Here is how I
setup the models.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;ActiveRecord::Schema.define(:version =&amp;gt; 20100706145311) do
  create_table &quot;ship_parts&quot;, :force =&amp;gt; true do |t|
    t.string  &quot;name&quot;
    t.integer &quot;ship_id&quot;
  end
  create_table &quot;ships&quot;, :force =&amp;gt; true do |t|
    t.string &quot;name&quot;
  end
end

class Ship &amp;lt; ActiveRecord::Base
  has_many :parts , :class_name =&amp;gt; 'ShipPart'
  accepts_nested_attributes_for :parts, :allow_destroy =&amp;gt; true

  validates_presence_of :name

  def self.lab
    @ship = Ship.create!(:name =&amp;gt; &quot;The good ship Dollypop&quot;)
    @part = @ship.parts.create!(:name =&amp;gt; &quot;Mast&quot;)
    @ship.reload
    @ship.attributes = {:name =&amp;gt; nil, :parts_attributes =&amp;gt; [{:id =&amp;gt; @part.id, :name =&amp;gt; 'Deck' }]}
    @ship.save
    puts @ship.parts.first.name
    #puts @ship.parts[0].name
  end

end
class ShipPart &amp;lt; ActiveRecord::Base
  belongs_to :ship
  validates_presence_of :name
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;First thing is that we need to have @ship.reload. without that
@ship thinks that children are already loaded and never really
looks into the updated children values.&lt;/p&gt;
&lt;p&gt;Second thing is that when you invoke @ship.parts.first.name
rails invokes a query to the database even if @ship.parts is
already loaded. In order to inquire about the loaded child you need
to do&lt;br&gt;
puts @ship.parts[0].name .&lt;/p&gt;
&lt;p&gt;And with these two changes a) @ship.reload and
b)@ship.parts[0].name you get 'Deck' as the final output.&lt;/p&gt;
&lt;p&gt;I do think that @ship.reload issue should be fixed. Looked at
code but not sure where to fix. I am marking this ticket as open
because of the reload issue. Someone else might know the fix.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-07T04:53:49+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;nested attributes\&quot;&quot;
:state: new
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-07T04:53:51+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">2</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>If I call reload before assigning attributes, it seems that @ship.parts[0].name and @ship.parts.first.name behave the same. You are correct that the issue is related to reloading association before nested attributes assignment.</body>
      <body-html>&lt;div&gt;&lt;p&gt;If I call reload before assigning attributes, it seems that
@ship.parts[0].name and @ship.parts.first.name behave the same. You
are correct that the issue is related to reloading association
before nested attributes assignment.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-07T07:44:54+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-07T07:44:56+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">3</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>it is nothing to do with validation failure.

it is due optimization present in nested_attributes.


if you look into nested attributes line 358 (nested_attributes.rb)

@@@ ruby

      existing_records = if association.loaded?
        association.to_a
      else
        attribute_ids = attributes_collection.map {|a| a['id'] || a[:id] }.compact
        attribute_ids.present? ? association.all(:conditions =&gt; {association.primary_key =&gt; attribute_ids}) : []
      end
@@@

from above code snippet nested attributes will only select objects if the association is not loaded 
but partially selecting ids will not cause loaded flag to be set in association_collection


so any subsequent call to association after update_attributes will
load_target will trigger call database wiping out all the association changes except new records line number 391) association_collection.rb

below is 2-3-8 version of load target

@@@ ruby

      def load_target
          if !@owner.new_record? || foreign_key_present
            begin
              if !loaded?
                if @target.is_a?(Array) &amp;&amp; @target.any?
                  @target = find_target + @target.find_all {|t| t.new_record? }
                else
                  @target = find_target
                end
              end
            rescue ActiveRecord::RecordNotFound
              reset
            end
          end

          loaded if target
          target
        end
@@@

 2-3-stable version fixes this

@@@ ruby

      def load_target
          if !@owner.new_record? || foreign_key_present
            begin
              if !loaded?
                if @target.is_a?(Array) &amp;&amp; @target.any?
                  @target = find_target.map do |f|
                    i = @target.index(f)
                    t = @target.delete_at(i) if i
                    if t &amp;&amp; t.changed?
                      t
                    else
                      f.mark_for_destruction if t &amp;&amp; t.marked_for_destruction?
                      f
                    end
                  end + @target
                else
                  @target = find_target
                end
              end
            rescue ActiveRecord::RecordNotFound
              reset
            end
          end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;it is nothing to do with validation failure.&lt;/p&gt;
&lt;p&gt;it is due optimization present in nested_attributes.&lt;/p&gt;
&lt;p&gt;if you look into nested attributes line 358
(nested_attributes.rb)&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
      existing_records = if association.loaded?
        association.to_a
      else
        attribute_ids = attributes_collection.map {|a| a['id'] || a[:id] }.compact
        attribute_ids.present? ? association.all(:conditions =&amp;gt; {association.primary_key =&amp;gt; attribute_ids}) : []
      end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;from above code snippet nested attributes will only select
objects if the association is not loaded&lt;br&gt;
but partially selecting ids will not cause loaded flag to be set in
association_collection&lt;/p&gt;
&lt;p&gt;so any subsequent call to association after update_attributes
will&lt;br&gt;
load_target will trigger call database wiping out all the
association changes except new records line number 391)
association_collection.rb&lt;/p&gt;
&lt;p&gt;below is 2-3-8 version of load target&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
      def load_target
          if !@owner.new_record? || foreign_key_present
            begin
              if !loaded?
                if @target.is_a?(Array) &amp;amp;&amp;amp; @target.any?
                  @target = find_target + @target.find_all {|t| t.new_record? }
                else
                  @target = find_target
                end
              end
            rescue ActiveRecord::RecordNotFound
              reset
            end
          end

          loaded if target
          target
        end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;2-3-stable version fixes this&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
      def load_target
          if !@owner.new_record? || foreign_key_present
            begin
              if !loaded?
                if @target.is_a?(Array) &amp;amp;&amp;amp; @target.any?
                  @target = find_target.map do |f|
                    i = @target.index(f)
                    t = @target.delete_at(i) if i
                    if t &amp;amp;&amp;amp; t.changed?
                      t
                    else
                      f.mark_for_destruction if t &amp;amp;&amp;amp; t.marked_for_destruction?
                      f
                    end
                  end + @target
                else
                  @target = find_target
                end
              end
            rescue ActiveRecord::RecordNotFound
              reset
            end
          end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-07T14:00:45+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-07T14:00:46+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">4</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>thanks for the explanation Subba. That's some complicated code.</body>
      <body-html>&lt;div&gt;&lt;p&gt;thanks for the explanation Subba. That's some complicated
code.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-07T14:14:45+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-07T14:14:49+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">5</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I still think that we should not have to reload to get the right behavior.

@@@ ruby
@part = @ship.parts.create!(:name =&gt; &quot;Mast&quot;)
@@@

From the above code one can't be sure if parts is part of nested_attributes or a simple has_many. However if it is part of nested_attributes then @ship.reset (or something equivalent ) should be called so that later operations do not interfere with already loaded children.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I still think that we should not have to reload to get the right
behavior.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;@part = @ship.parts.create!(:name =&amp;gt; &quot;Mast&quot;)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;From the above code one can't be sure if parts is part of
nested_attributes or a simple has_many. However if it is part of
nested_attributes then @ship.reset (or something equivalent )
should be called so that later operations do not interfere with
already loaded children.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-07T14:19:43+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db upon validation error for nested attributes</title>
      <updated-at type="datetime">2010-07-07T14:19:47+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">6</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I agree with Neeraj that it should not need to reload before every nested_attributes assignment. It is sometimes very difficult to issue reload statement for every associations as the relationship can be few levels deep involving 10+ associated objects.

Actually direct update through association proxy should have the same effect as nested_attributes assignment. Should the association be loaded before nested_attributes assignment, i.e. replace the code segment with

    existing_records = if association.loaded?
      association.to_a
    else
      attribute_ids = attributes_collection.map {|a| a['id'] || a[:id]}.compact
      attribute_ids.present? association.all(:conditions =&gt; {association.primary_key =&gt; attribute_ids}) : []
    end

with
    existing_records = (association.loaded? ? association.to_a : association.all)

Not sure this change has any other side effect but the test case passed without any compliant.

BTW, when I look carefully into the existing test case about nested_attributes, I find that the use of send(:load_target). It seems solve the problem I'm facing. I just need to make function call as:

    @ship.parts.send(:load_target).first.name
    @ship.parts.send(:load_target).first.trinkets.send(:load_target).first.name

It is a bit clumsy but it works. However :load_target is a protected method, although send() can bypass to invoke it, it seems not a good practice to call it from our application, right?!</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree with Neeraj that it should not need to reload before
every nested_attributes assignment. It is sometimes very difficult
to issue reload statement for every associations as the
relationship can be few levels deep involving 10+ associated
objects.&lt;/p&gt;
&lt;p&gt;Actually direct update through association proxy should have the
same effect as nested_attributes assignment. Should the association
be loaded before nested_attributes assignment, i.e. replace the
code segment with&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;existing_records = if association.loaded?
  association.to_a
else
  attribute_ids = attributes_collection.map {|a| a['id'] || a[:id]}.compact
  attribute_ids.present? association.all(:conditions =&amp;gt; {association.primary_key =&amp;gt; attribute_ids}) : []
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;with&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;existing_records = (association.loaded? ? association.to_a : association.all)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Not sure this change has any other side effect but the test case
passed without any compliant.&lt;/p&gt;
&lt;p&gt;BTW, when I look carefully into the existing test case about
nested_attributes, I find that the use of send(:load_target). It
seems solve the problem I'm facing. I just need to make function
call as:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@ship.parts.send(:load_target).first.name
@ship.parts.send(:load_target).first.trinkets.send(:load_target).first.name&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;It is a bit clumsy but it works. However :load_target is a
protected method, although send() can bypass to invoke it, it seems
not a good practice to call it from our application, right?!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T07:52:58+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:title: child/grandchild associations reload from db upon validation error for nested attributes
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T07:52:59+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">7</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@szetobo thanks for the investigation. Which version of rails you are working with.

Just to let you know nested_attributes in rails 2.3.8 is totally broken. Also there are unexplained differences between rails edge version and rails 2-3-stable version.

Just looking at the code it seems some edge cases like new_record etc have been missed out.

We are in the process of writing detailed test cases for both 2-3-stable and rails edge. And then hopefully the code fix should resolve some of the issues mentioned in this thread.

Will update this thread when we have more details.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@szetobo thanks for the investigation. Which version of rails
you are working with.&lt;/p&gt;
&lt;p&gt;Just to let you know nested_attributes in rails 2.3.8 is totally
broken. Also there are unexplained differences between rails edge
version and rails 2-3-stable version.&lt;/p&gt;
&lt;p&gt;Just looking at the code it seems some edge cases like
new_record etc have been missed out.&lt;/p&gt;
&lt;p&gt;We are in the process of writing detailed test cases for both
2-3-stable and rails edge. And then hopefully the code fix should
resolve some of the issues mentioned in this thread.&lt;/p&gt;
&lt;p&gt;Will update this thread when we have more details.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T11:25:07+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T11:25:12+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">8</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Some discussion regarded nested_attribute took place on #4830 . So just mentioning that ticket here in case someone wants to get full picture.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Some discussion regarded nested_attribute took place on &lt;a href=
&quot;/projects/8994/tickets/4830&quot; title=&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt; . So
just mentioning that ticket here in case someone wants to get full
picture.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T11:34:37+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T11:34:39+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">9</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm working on edge version. Nested attributes for edge version also broken badly. Apps migrate from 2.3.5 just broken without major code changes, especially on nested_attributes part.

I'll submit another test case shortly about duplicate entry on the association collection with same id right after nested_attributes assignment. Hope that can help a little bit to speed up the debugging process.

Anyway, thanks for looking into the issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm working on edge version. Nested attributes for edge version
also broken badly. Apps migrate from 2.3.5 just broken without
major code changes, especially on nested_attributes part.&lt;/p&gt;
&lt;p&gt;I'll submit another test case shortly about duplicate entry on
the association collection with same id right after
nested_attributes assignment. Hope that can help a little bit to
speed up the debugging process.&lt;/p&gt;
&lt;p&gt;Anyway, thanks for looking into the issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T11:52:44+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 40263
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T11:52:47+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">10</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T11:53:23+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T11:53:26+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">11</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Forgive me if I missed anything, but the reason you can use methods like #first on a collection association without the full collection being loaded first, is because #first doesn't cache the object. Thus, if its values are updated/marked for destruction, then autosave won't find the object in the &#8216;target&#8217; when save time comes.

This is why in the tests I explicitly load the target first. (In other tests they used #class to make sure the target was loaded, I opted for the private but more declarative load_target.)

The only way to make using #first, without first loading the complete target, work would be to finally have a full identity map, and NOT replace objects already loaded through #first.

I did make a patch for this once, but since it's not a full identity map it was rejected, which I agreed with in the end. Someone that really needs this should simply sit down and implement a proper identity map.

Finally, autosave does NOT need this behavior for nested attributes, because nested attributes operates on the loaded target, or loads it. It does NOT use #first.

HTH</body>
      <body-html>&lt;div&gt;&lt;p&gt;Forgive me if I missed anything, but the reason you can use
methods like #first on a collection association without the full
collection being loaded first, is because #first doesn't cache the
object. Thus, if its values are updated/marked for destruction,
then autosave won't find the object in the &amp;#8216;target&amp;#8217;
when save time comes.&lt;/p&gt;
&lt;p&gt;This is why in the tests I explicitly load the target first. (In
other tests they used #class to make sure the target was loaded, I
opted for the private but more declarative load_target.)&lt;/p&gt;
&lt;p&gt;The only way to make using #first, without first loading the
complete target, work would be to finally have a full identity map,
and NOT replace objects already loaded through #first.&lt;/p&gt;
&lt;p&gt;I did make a patch for this once, but since it's not a full
identity map it was rejected, which I agreed with in the end.
Someone that really needs this should simply sit down and implement
a proper identity map.&lt;/p&gt;
&lt;p&gt;Finally, autosave does NOT need this behavior for nested
attributes, because nested attributes operates on the loaded
target, or loads it. It does NOT use #first.&lt;/p&gt;
&lt;p&gt;HTH&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T12:50:54+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T12:50:56+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">12</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached is a test patch which really tests the intent.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a test patch which really tests the intent.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T16:11:04+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T16:11:06+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">13</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Eloy I am looking at the tests and it is full of @ship.reload._do_something.

The reason why this ticket was opened gets resolved is user does a model.reload after populating children but before starting nested_attributes activities.

Is there a way to get the whole thing working without forcing one to do reload because while working in rails console this is not the most intuitive thing to do. I am looking into it but so far no luck. 

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Eloy I am looking at the tests and it is full of
@ship.reload._do_something.&lt;/p&gt;
&lt;p&gt;The reason why this ticket was opened gets resolved is user does
a model.reload after populating children but before starting
nested_attributes activities.&lt;/p&gt;
&lt;p&gt;Is there a way to get the whole thing working without forcing
one to do reload because while working in rails console this is not
the most intuitive thing to do. I am looking into it but so far no
luck.&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T18:17:51+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T18:17:53+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">14</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Neeraj Well, I can think of two options. Either create/merge a patch like the one I mentioned earlier: #1751.

Or add something like this to your ~/.irbrc, because I'm assuming that's really the only place one would use #first in combination with autosave:

@@@ ruby
if defined?(ActiveRecord)
  class ActiveRecord::AssociationCollection
    alias_method :first_before_load_target, :first
    def first(*args)
      load_target
      first_before_load_target(*args)
    end
  end
end
@@@

Effectively always loading the target when in the console. (Don't forget to do the same for #last.)</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Neeraj Well, I can think of two options. Either create/merge a
patch like the one I mentioned earlier: &lt;a href=
&quot;/projects/8994/tickets/1751&quot; title=&quot;Ticket #1751&quot;&gt;#1751&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Or add something like this to your ~/.irbrc, because I'm
assuming that's really the only place one would use #first in
combination with autosave:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;if defined?(ActiveRecord)
  class ActiveRecord::AssociationCollection
    alias_method :first_before_load_target, :first
    def first(*args)
      load_target
      first_before_load_target(*args)
    end
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Effectively always loading the target when in the console.
(Don't forget to do the same for #last.)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T18:31:41+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T18:31:43+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">15</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I hope I got the class etc right, I haven't looked at AR internals for a while :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I hope I got the class etc right, I haven't looked at AR
internals for a while :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T18:32:32+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T18:32:35+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">16</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Thanks Eloy.

I will take a look at #1751 and the other option you suggested. In the meantime wanted to add that without that reload both of the following cases do not work. Just to clear the air that it is not just about 'first'.

@@@ ruby
puts @ship.parts[0].name
puts @ship.parts.name
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Eloy.&lt;/p&gt;
&lt;p&gt;I will take a look at &lt;a href=&quot;/projects/8994/tickets/1751&quot;
title=&quot;Ticket #1751&quot;&gt;#1751&lt;/a&gt; and the other option you suggested.
In the meantime wanted to add that without that reload both of the
following cases do not work. Just to clear the air that it is not
just about 'first'.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;puts @ship.parts[0].name
puts @ship.parts.name&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-08T19:11:44+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-08T19:11:46+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">17</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@szetobo I believe we have a fix for this issue. 

My buddy is going to upload the fix in a moment. However since .first gets the data from the database I would suggest you to update your test. A fixed version might look something like this  http://pastie.org/1036943 .</body>
      <body-html>&lt;div&gt;&lt;p&gt;@szetobo I believe we have a fix for this issue.&lt;/p&gt;
&lt;p&gt;My buddy is going to upload the fix in a moment. However since
.first gets the data from the database I would suggest you to
update your test. A fixed version might look something like this
&lt;a href=&quot;http://pastie.org/1036943&quot;&gt;http://pastie.org/1036943&lt;/a&gt;
.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T03:18:35+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T03:18:37+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">18</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>attached is code fix.

This is what is currently happening.

- a new @ship record is created.
- @ship.parts.create(:name =&gt; 'part_name') creates a new part in the database. However this @part instance is added to @target. Note that @ship.parts.loaded? is NOT set to true.
- next nested_attributes assignment happens
- rails gets existing_records by pulling data from the database for the @part.id
- next assocation.send(:add_record_to_target_with_callbacks, existing_record) unless association.loaded?
- when above code is executed then the database representation of @part gets added to @target.
- so the end result is that @target ends up with two different instances of same @part.
- everything goes downhill from there

If I explained the problem correctly then fix should be obvious. And that is not to add to @target if @target already has an instance of same @part. My fix replaces the instance held by @target with new instance. 

I am attaching patch for both 2-3-stable and rails edge.</body>
      <body-html>&lt;div&gt;&lt;p&gt;attached is code fix.&lt;/p&gt;
&lt;p&gt;This is what is currently happening.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a new @ship record is created.&lt;/li&gt;
&lt;li&gt;@ship.parts.create(:name =&amp;gt; 'part_name') creates a new part
in the database. However this @part instance is added to @target.
Note that @ship.parts.loaded? is NOT set to true.&lt;/li&gt;
&lt;li&gt;next nested_attributes assignment happens&lt;/li&gt;
&lt;li&gt;rails gets existing_records by pulling data from the database
for the @part.id&lt;/li&gt;
&lt;li&gt;next assocation.send(:add_record_to_target_with_callbacks,
existing_record) unless association.loaded?&lt;/li&gt;
&lt;li&gt;when above code is executed then the database representation of
@part gets added to @target.&lt;/li&gt;
&lt;li&gt;so the end result is that @target ends up with two different
instances of same @part.&lt;/li&gt;
&lt;li&gt;everything goes downhill from there&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If I explained the problem correctly then fix should be obvious.
And that is not to add to @target if @target already has an
instance of same @part. My fix replaces the instance held by
@target with new instance.&lt;/p&gt;
&lt;p&gt;I am attaching patch for both 2-3-stable and rails edge.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T03:32:37+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T03:32:40+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">19</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Attached is patch which strengthens the test cases further and it has minor code refactoring.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is patch which strengthens the test cases further and
it has minor code refactoring.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T03:52:43+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T03:52:48+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">20</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>The patch work!! Thanks so much for the prompt responses. It is a show stopper in our project and now it is gone.

I've updated the test case in a way that help me understand the effect of different way to access the data. A funny finding is that even target[0] &amp; target.first is a little bit difference internally, the association @target seems already catered and the result is consistency no matter it is access through [] or .first. In the test case, I added a lot of checking assertion to see when the association get loaded and will the load target respect partial loaded subset produced by nested attributes assignment. It just work as expected.

I agree that the identity map Eloy mention is a better solution as a whole, but since it is not yet there and still sometime before it will be added into the code base, I have to live with a workable solution at this moment.

Looking forward to get this patch commit into the edge master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The patch work!! Thanks so much for the prompt responses. It is
a show stopper in our project and now it is gone.&lt;/p&gt;
&lt;p&gt;I've updated the test case in a way that help me understand the
effect of different way to access the data. A funny finding is that
even target[0] &amp;amp; target.first is a little bit difference
internally, the association @target seems already catered and the
result is consistency no matter it is access through [] or .first.
In the test case, I added a lot of checking assertion to see when
the association get loaded and will the load target respect partial
loaded subset produced by nested attributes assignment. It just
work as expected.&lt;/p&gt;
&lt;p&gt;I agree that the identity map Eloy mention is a better solution
as a whole, but since it is not yet there and still sometime before
it will be added into the code base, I have to live with a workable
solution at this moment.&lt;/p&gt;
&lt;p&gt;Looking forward to get this patch commit into the edge
master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T07:57:03+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T07:57:04+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">21</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>Sorry, forgot to include the test case fyr.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry, forgot to include the test case fyr.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T07:57:54+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T07:57:59+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">22</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Neeraj, your &quot;refactoring&quot; of my changes in load_target doesn't have the same behaviour. If a record is marked for destruction but otherwise unchanged, it should use the newly fetched record and mark that for destruction.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj, your &quot;refactoring&quot; of my changes in load_target doesn't
have the same behaviour. If a record is marked for destruction but
otherwise unchanged, it should use the newly fetched record and
mark that for destruction.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T09:15:31+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T09:15:36+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">23</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>@James I agree that as per my code change the old record would be marked for destruction and not the newly fetched one. However does that really matter? In the end an existing record is marked for destruction and that's what counts. However I am not averse to reverting back to the way code was.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@James I agree that as per my code change the old record would
be marked for destruction and not the newly fetched one. However
does that really matter? In the end an existing record is marked
for destruction and that's what counts. However I am not averse to
reverting back to the way code was.&lt;/p&gt;
&lt;p&gt;Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T10:41:58+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T10:42:00+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">24</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>If the changes aren't saved due to a validation error and the form is redisplayed in such a way that you can still see some details about the record to be deleted, I think it would be worthwhile showing the most up-to-date details about that record in case someone else has changed it in the meantime. You may then decide not to delete it after all. Both approaches would work sufficiently but given the choice, I think I prefer this one.</body>
      <body-html>&lt;div&gt;&lt;p&gt;If the changes aren't saved due to a validation error and the
form is redisplayed in such a way that you can still see some
details about the record to be deleted, I think it would be
worthwhile showing the most up-to-date details about that record in
case someone else has changed it in the meantime. You may then
decide not to delete it after all. Both approaches would work
sufficiently but given the choice, I think I prefer this one.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T11:01:21+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T11:01:23+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">25</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>makes sense. I will revert my changes. Thanks for the feedback.</body>
      <body-html>&lt;div&gt;&lt;p&gt;makes sense. I will revert my changes. Thanks for the
feedback.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T11:05:54+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T11:05:57+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">26</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>attached is modified test patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;attached is modified test patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-09T11:10:02+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-09T11:10:04+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">27</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>What should I do to make my rails app reference the latest rails source directory, including the patch, instead of the gem installed on my system. Just want to try it out before the patch has been commit into the master head.

(I know it may not be the right place to ask a question like this, but most of the post I've searched seems outdated and not working.)</body>
      <body-html>&lt;div&gt;&lt;p&gt;What should I do to make my rails app reference the latest rails
source directory, including the patch, instead of the gem installed
on my system. Just want to try it out before the patch has been
commit into the master head.&lt;/p&gt;
&lt;p&gt;(I know it may not be the right place to ask a question like
this, but most of the post I've searched seems outdated and not
working.)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-10T06:13:38+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-10T06:13:39+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">28</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>In your Gemfile comment out the beta reference to rails and refer to git version.

@@@ ruby
#gem 'rails', '3.0.0.beta4'
gem 'rails', :git =&gt; 'git://github.com/rails/rails.git'
@@@

Then run following command and you will have rails edge in your vendor/bundler directory.

@@@ ruby
bundle install vendor --disable-shared-gems
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;In your Gemfile comment out the beta reference to rails and
refer to git version.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;#gem 'rails', '3.0.0.beta4'
gem 'rails', :git =&amp;gt; 'git://github.com/rails/rails.git'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Then run following command and you will have rails edge in your
vendor/bundler directory.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;bundle install vendor --disable-shared-gems&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-10T08:30:35+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-10T08:30:39+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">29</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>Thanks a lot, really appreciate that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks a lot, really appreciate that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-10T08:40:48+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-10T08:40:52+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">30</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>updating patch with optimized code and test.</body>
      <body-html>&lt;div&gt;&lt;p&gt;updating patch with optimized code and test.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-10T17:34:17+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; rails3</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-10T17:34:21+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">31</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">9</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-10T17:44:13+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;nested attributes\&quot; rails3&quot;
:assigned_user: 40263
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-10T17:44:16+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">32</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">9</attachments-count>
      <body>I've found another problem when applied the patch into my app. It happens when Parts doesn't change and one of its Trinket has updated, the changes on Trinket will be replaced with db image when part.trinkets reload. That's because load_target of association_collection will only retain @target record when it has been changed, otherwise it will be replaced by a freshly loaded record form db. Doing so will wipe out the next level associations collection, if any, and that's caused the problem.

I've attached a patch with additional fix which alter load_target in order to maintain the loaded record with its unchanged attributes updated by the freshly load instance return by find_target. An additional test case has been added as well to guard against this case.

    test &quot;if association is not loaded and child doesn't change and I am saving a grandchild then in memory record should be used&quot; do
      @ship.parts_attributes=[{:id =&gt; @part.id,:trinkets_attributes =&gt;[{:id =&gt; @trinket.id, :name =&gt; 'Ruby'}]}]
      assert_equal 1, @ship.parts.proxy_target.size
      assert_equal 'Mast', @ship.parts[0].name
      assert_equal 1, @ship.parts[0].trinkets.proxy_target.size
      assert_equal 'Ruby', @ship.parts[0].trinkets[0].name
    end

During the testing by running my app on top of the rails patch installed into vendor/bundle, I found that rails framework doesn't reload automatically if source code updated. So that a server restart is needed on every code change attempt, anything to do with this situation, or is it a limitation that can't be solved currently?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've found another problem when applied the patch into my app.
It happens when Parts doesn't change and one of its Trinket has
updated, the changes on Trinket will be replaced with db image when
part.trinkets reload. That's because load_target of
association_collection will only retain @target record when it has
been changed, otherwise it will be replaced by a freshly loaded
record form db. Doing so will wipe out the next level associations
collection, if any, and that's caused the problem.&lt;/p&gt;
&lt;p&gt;I've attached a patch with additional fix which alter
load_target in order to maintain the loaded record with its
unchanged attributes updated by the freshly load instance return by
find_target. An additional test case has been added as well to
guard against this case.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;test &quot;if association is not loaded and child doesn't change and I am saving a grandchild then in memory record should be used&quot; do
  @ship.parts_attributes=[{:id =&amp;gt; @part.id,:trinkets_attributes =&amp;gt;[{:id =&amp;gt; @trinket.id, :name =&amp;gt; 'Ruby'}]}]
  assert_equal 1, @ship.parts.proxy_target.size
  assert_equal 'Mast', @ship.parts[0].name
  assert_equal 1, @ship.parts[0].trinkets.proxy_target.size
  assert_equal 'Ruby', @ship.parts[0].trinkets[0].name
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;During the testing by running my app on top of the rails patch
installed into vendor/bundle, I found that rails framework doesn't
reload automatically if source code updated. So that a server
restart is needed on every code change attempt, anything to do with
this situation, or is it a limitation that can't be solved
currently?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-11T23:28:00+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-11T23:28:03+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">33</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">10</attachments-count>
      <body>@szetobo your patch looks good. However I will spend some more time tomorrow testing it.

Could you please attach your patch again in such a manner that you do not include the code provided by Subba. In this way Subba will get credit for the work he has done and you would get credit for the work your work.

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;@szetobo your patch looks good. However I will spend some more
time tomorrow testing it.&lt;/p&gt;
&lt;p&gt;Could you please attach your patch again in such a manner that
you do not include the code provided by Subba. In this way Subba
will get credit for the work he has done and you would get credit
for the work your work.&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T00:29:59+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T00:30:01+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">34</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">10</attachments-count>
      <body>Here's the patch. Thanks a lot.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's the patch. Thanks a lot.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T03:11:11+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T03:11:16+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">35</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">11</attachments-count>
      <body>Sorry for my careless mistake. Here's another minor fix for excluding &quot;id&quot; when copying attributes in the load_target of association_collection.rb. Otherwise `WARNING: Can't mass-assign protected attributes: id` will blow up in the log.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry for my careless mistake. Here's another minor fix for
excluding &quot;id&quot; when copying attributes in the load_target of
association_collection.rb. Otherwise &lt;code&gt;WARNING: Can't
mass-assign protected attributes: id&lt;/code&gt; will blow up in the
log.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T09:37:33+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T09:37:36+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">36</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>I am not able to follow the logic of removing this line

@@@ ruby
f.mark_for_destruction if t &amp;&amp; t.marked_for_destruction?
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am not able to follow the logic of removing this line&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;f.mark_for_destruction if t &amp;amp;&amp;amp; t.marked_for_destruction?&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T21:08:57+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T21:09:00+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">37</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>Please don't remove that line.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Please don't remove that line.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T21:57:10+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T21:57:16+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">38</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>I have not run the tests. However if all tests are passing after removing that line the I would add a test for that case.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have not run the tests. However if all tests are passing after
removing that line the I would add a test for that case.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-12T21:59:34+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-12T21:59:39+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">39</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>`f.mark_for_destruction` is need in original code segment because `f` will be used instead of `t` if `t &amp;&amp; t.changed?`. As I stated above, doing so will remove all association collection of t, if any, even if `t.changed?` is false.

The latest patch will not replace t but will update attributes from db, so if t already mark_for_destruction, it will still marked. For f freshly loaded from db, mark_for_destruction should be cleared. Therefore I just remove this line from my patch. I've run all the test in nested attribute test case and all passed without failure. Please let me know if my understanding is correct or not.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;code&gt;f.mark_for_destruction&lt;/code&gt; is need in original code
segment because &lt;code&gt;f&lt;/code&gt; will be used instead of
&lt;code&gt;t&lt;/code&gt; if &lt;code&gt;t &amp;amp;&amp;amp; t.changed?&lt;/code&gt;. As I stated
above, doing so will remove all association collection of t, if
any, even if &lt;code&gt;t.changed?&lt;/code&gt; is false.&lt;/p&gt;
&lt;p&gt;The latest patch will not replace t but will update attributes
from db, so if t already mark_for_destruction, it will still
marked. For f freshly loaded from db, mark_for_destruction should
be cleared. Therefore I just remove this line from my patch. I've
run all the test in nested attribute test case and all passed
without failure. Please let me know if my understanding is correct
or not.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T02:42:24+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-13T02:42:26+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">40</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>That sounds okay except that marked_for_destruction isn't an attribute, it's an instance variable.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That sounds okay except that marked_for_destruction isn't an
attribute, it's an instance variable.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T09:05:09+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-13T09:05:29+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">41</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>szetobo's changes propogating the changes to destroyed records below test case proves this.
his code is much shorter than current code.

@@@ ruby

  test &quot;if association is loaded before saving parent destroyed in memory children should be destroyed&quot; do
      @ship.parts_attributes=[{:id =&gt; @part.id,:_destroy =&gt;'1'}]
      @part.update_attribute(:name, 'Deck')
      assert @ship.parts.proxy_target[0].marked_for_destruction?
      assert_equal 'Deck', @part.name

      @ship.parts.to_ary

      assert @ship.parts[0].marked_for_destruction?
      assert_equal 'Deck', @part.name

      @ship.save
      assert_nil ShipPart.find_by_id(@part.id)
    end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;szetobo's changes propogating the changes to destroyed records
below test case proves this.&lt;br&gt;
his code is much shorter than current code.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
  test &quot;if association is loaded before saving parent destroyed in memory children should be destroyed&quot; do
      @ship.parts_attributes=[{:id =&amp;gt; @part.id,:_destroy =&amp;gt;'1'}]
      @part.update_attribute(:name, 'Deck')
      assert @ship.parts.proxy_target[0].marked_for_destruction?
      assert_equal 'Deck', @part.name

      @ship.parts.to_ary

      assert @ship.parts[0].marked_for_destruction?
      assert_equal 'Deck', @part.name

      @ship.save
      assert_nil ShipPart.find_by_id(@part.id)
    end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T11:28:42+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-13T11:28:44+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">42</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">12</attachments-count>
      <body>the last test case patch</body>
      <body-html>&lt;div&gt;&lt;p&gt;the last test case patch&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T03:50:32+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T03:50:37+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">43</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">13</attachments-count>
      <body>ignore the last one here is the better patch</body>
      <body-html>&lt;div&gt;&lt;p&gt;ignore the last one here is the better patch&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T04:03:46+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T04:03:51+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">44</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>There has been a lot of patches attached to this ticket to the point where it is starting to get a bit confusing.

I have consolidated all the patches and have applied them on my forked branch of rails.

Please take a look at http://github.com/neerajdotname/rails/commits/ticket_5053 . Last 4 committs are related to this ticket.

Please have a look and do chime in with your thoughts.

once again in the forked copy look for branch ticket_5053 . 

thanks everyone.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There has been a lot of patches attached to this ticket to the
point where it is starting to get a bit confusing.&lt;/p&gt;
&lt;p&gt;I have consolidated all the patches and have applied them on my
forked branch of rails.&lt;/p&gt;
&lt;p&gt;Please take a look at &lt;a href=
&quot;http://github.com/neerajdotname/rails/commits/ticket_5053&quot;&gt;http://github.com/neerajdotname/rails/commits/ticket_5053&lt;/a&gt;
. Last 4 committs are related to this ticket.&lt;/p&gt;
&lt;p&gt;Please have a look and do chime in with your thoughts.&lt;/p&gt;
&lt;p&gt;once again in the forked copy look for branch ticket_5053 .&lt;/p&gt;
&lt;p&gt;thanks everyone.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T04:54:11+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T04:54:13+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">45</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Thanks Neeraj for organize the patches submitted so far. May I know what is missing before the patches will be committed into edge? Thanks again for everyone.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Neeraj for organize the patches submitted so far. May I
know what is missing before the patches will be committed into
edge? Thanks again for everyone.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T07:38:50+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T07:38:54+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">46</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>@Eloy Duran and @James Le Cuirot : Could you +1 the work done so far at http://github.com/neerajdotname/rails/commits/ticket_5053 (last 4 comitts) so that we could be sure that patches make sense.

@szetobo once we have the sign off from them then it would be committed to edge.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Eloy Duran and @James Le Cuirot : Could you +1 the work done so
far at &lt;a href=
&quot;http://github.com/neerajdotname/rails/commits/ticket_5053&quot;&gt;http://github.com/neerajdotname/rails/commits/ticket_5053&lt;/a&gt;
(last 4 comitts) so that we could be sure that patches make
sense.&lt;/p&gt;
&lt;p&gt;@szetobo once we have the sign off from them then it would be
committed to edge.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T09:37:13+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T09:37:19+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">47</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Sure thing, added comments to each commit.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sure thing, added comments to each commit.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T11:17:04+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T11:17:08+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">48</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Sorry if I'm holding this up but I'd like a chance to review this. I'll try to do it tomorrow.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry if I'm holding this up but I'd like a chance to review
this. I'll try to do it tomorrow.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-15T23:34:17+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-15T23:34:22+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">49</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Eloy provided his comments on committs. Tonight I will work on his feedback and will provide a new codebase to look at. So hold your review until I post a new link.

thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;Eloy provided his comments on committs. Tonight I will work on
his feedback and will provide a new codebase to look at. So hold
your review until I post a new link.&lt;/p&gt;
&lt;p&gt;thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-16T01:38:53+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-16T01:38:57+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">50</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Feedback provided by Eloy has been incorporated at a new branch http://github.com/neerajdotname/rails/commits/5053_v4 .

Please take a look at last 4 committs in that branch and provide your feedback.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Feedback provided by Eloy has been incorporated at a new branch
&lt;a href=
&quot;http://github.com/neerajdotname/rails/commits/5053_v4&quot;&gt;http://github.com/neerajdotname/rails/commits/5053_v4&lt;/a&gt;
.&lt;/p&gt;
&lt;p&gt;Please take a look at last 4 committs in that branch and provide
your feedback.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-19T02:38:38+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-19T02:38:40+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">51</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Looks good. Just one note for which I left a comment: http://github.com/neerajdotname/rails/commit/12794678c84185f6a8751ed58f552a394c2f61e7#L1R871</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks good. Just one note for which I left a comment: &lt;a href=
&quot;http://github.com/neerajdotname/rails/commit/12794678c84185f6a8751ed58f552a394c2f61e7#L1R871&quot;&gt;
http://github.com/neerajdotname/rails/commit/12794678c84185f6a8751e...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-19T08:57:31+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-19T08:57:35+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">52</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>I have pushed a new branch (again) http://github.com/neerajdotname/rails/commits/5053_v5 . This has feedback provided by Eloy. 

Eloy: thanks for all your feedback.

szetobo: I made two minor changes to the test file you had attached. Both were based on the feedback provided by Eloy. I have retained you as the author of the commit.

Others please take a look at the above mentioned branch. Let's try to wrap it up soon.  :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have pushed a new branch (again) &lt;a href=
&quot;http://github.com/neerajdotname/rails/commits/5053_v5&quot;&gt;http://github.com/neerajdotname/rails/commits/5053_v5&lt;/a&gt;
. This has feedback provided by Eloy.&lt;/p&gt;
&lt;p&gt;Eloy: thanks for all your feedback.&lt;/p&gt;
&lt;p&gt;szetobo: I made two minor changes to the test file you had
attached. Both were based on the feedback provided by Eloy. I have
retained you as the author of the commit.&lt;/p&gt;
&lt;p&gt;Others please take a look at the above mentioned branch. Let's
try to wrap it up soon. :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-19T20:54:25+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;nested attributes\&quot; patch&quot;
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-19T20:54:27+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">53</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Look good, I admitted that assert_no_difference has better semantic than assert_equal.

Neeraj: It doesn't matter you retained me as the author or not, I just want the issue fixed because it is a show stopper to us. I really appreciate the work done so far by rails community. My work just so minor and can't really compare to what I have got from it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Look good, I admitted that assert_no_difference has better
semantic than assert_equal.&lt;/p&gt;
&lt;p&gt;Neeraj: It doesn't matter you retained me as the author or not,
I just want the issue fixed because it is a show stopper to us. I
really appreciate the work done so far by rails community. My work
just so minor and can't really compare to what I have got from
it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-20T02:42:14+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-20T02:42:16+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">54</version>
      <user-name>szetobo</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>@szetobo I believe we are quite close to finish line :-)

A few more eyes , a few +1 and it will be good to go.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@szetobo I believe we are quite close to finish line :-)&lt;/p&gt;
&lt;p&gt;A few more eyes , a few +1 and it will be good to go.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-20T02:48:46+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-20T02:48:50+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">55</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Made one minor comment but okay other than that. I realise now that my earlier comment about marked_for_destruction being an instance variable doesn't actually apply.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Made one minor comment but okay other than that. I realise now
that my earlier comment about marked_for_destruction being an
instance variable doesn't actually apply.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-20T22:53:27+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-20T22:53:30+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">56</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Left some feedback on http://github.com/neerajdotname/rails/commit/49cc2d682f17dcf74e11b56c19cf504d11b439a7.

As a final note, it seems that some of these patches are written because of an issue encountered when using nested attributes. However, they are not *specifically* about nested attributes. For instance the one mentioned above, which is really about association collection. So I would expect at least a test added to the association collection test, and _maybe_ a regression one to the nested attributes tests. I especially was a bit surprised to find that there are a whole bunch of these &#8216;lost&#8217; tests in the nested attributes tests.

All tests from line 811 down should *not* be there at all: http://github.com/neerajdotname/rails/blob/49cc2d682f17dcf74e11b56c19cf504d11b439a7/activerecord/test/cases/nested_attributes_test.rb#L811

They should either be in the autosave association tests, or in the association collection tests, as far as I have studied them. Furthermore, they should *not* use the nested attributes API, as again, it's unrelated and only adds noise.

Having said that, I think the patches can go in. But I would appreciate a test refactoring next, improving the descriptions and moving them to the correct test file.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Left some feedback on &lt;a href=
&quot;http://github.com/neerajdotname/rails/commit/49cc2d682f17dcf74e11b56c19cf504d11b439a7&quot;&gt;
http://github.com/neerajdotname/rails/commit/49cc2d682f17dcf74e11b5...&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;As a final note, it seems that some of these patches are written
because of an issue encountered when using nested attributes.
However, they are not &lt;em&gt;specifically&lt;/em&gt; about nested
attributes. For instance the one mentioned above, which is really
about association collection. So I would expect at least a test
added to the association collection test, and &lt;em&gt;maybe&lt;/em&gt; a
regression one to the nested attributes tests. I especially was a
bit surprised to find that there are a whole bunch of these
&amp;#8216;lost&amp;#8217; tests in the nested attributes tests.&lt;/p&gt;
&lt;p&gt;All tests from line 811 down should &lt;em&gt;not&lt;/em&gt; be there at
all: &lt;a href=
&quot;http://github.com/neerajdotname/rails/blob/49cc2d682f17dcf74e11b56c19cf504d11b439a7/activerecord/test/cases/nested_attributes_test.rb#L811&quot;&gt;
http://github.com/neerajdotname/rails/blob/49cc2d682f17dcf74e11b56c...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;They should either be in the autosave association tests, or in
the association collection tests, as far as I have studied them.
Furthermore, they should &lt;em&gt;not&lt;/em&gt; use the nested attributes
API, as again, it's unrelated and only adds noise.&lt;/p&gt;
&lt;p&gt;Having said that, I think the patches can go in. But I would
appreciate a test refactoring next, improving the descriptions and
moving them to the correct test file.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-21T11:24:31+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T11:24:33+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">57</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>(from [c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d]) In nested_attributes when association is not loaded and association
record is saved and then in memory record attributes should be saved

[#5053 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d&quot;
title=
&quot;Changeset [c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d]&quot;&gt;[c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d]&lt;/a&gt;)
In nested_attributes when association is not loaded and association
record is saved and then in memory record attributes should be
saved&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5053&quot; title=
&quot;Ticket #5053&quot;&gt;#5053&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/c0bfa0bfc17f4aa615cd9d1006509e0d84b5692d&quot;&gt;
http://github.com/rails/rails/commit/c0bfa0bfc17f4aa615cd9d1006509e...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-21T13:26:22+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T13:26:23+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">58</version>
      <user-name>Repository</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>(from [0057d2df71ec7c2a788acd3b4bade263fc0fe361]) association load target shouldn't replace records
from db if it is already loaded by nested attributes assignment

[#5053 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/0057d2df71ec7c2a788acd3b4bade263fc0fe361</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/0057d2df71ec7c2a788acd3b4bade263fc0fe361&quot;
title=
&quot;Changeset [0057d2df71ec7c2a788acd3b4bade263fc0fe361]&quot;&gt;[0057d2df71ec7c2a788acd3b4bade263fc0fe361]&lt;/a&gt;)
association load target shouldn't replace records from db if it is
already loaded by nested attributes assignment&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5053&quot; title=
&quot;Ticket #5053&quot;&gt;#5053&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/0057d2df71ec7c2a788acd3b4bade263fc0fe361&quot;&gt;
http://github.com/rails/rails/commit/0057d2df71ec7c2a788acd3b4bade2...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-21T13:26:27+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T13:26:29+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">59</version>
      <user-name>Repository</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>http://github.com/neerajdotname/rails/commits/5053_v5 is getting committed. I am going to create two more tickets.

* for uniq change : In that ticket I would post all the discussions that happened on my personal branch. Do not want to lose the history. And then we will commit the uniq change.

* second ticket would be to take care of tests refactoring Eloy mentioned.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://github.com/neerajdotname/rails/commits/5053_v5&quot;&gt;http://github.com/neerajdotname/rails/commits/5053_v5&lt;/a&gt;
is getting committed. I am going to create two more tickets.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;for uniq change : In that ticket I would post all the
discussions that happened on my personal branch. Do not want to
lose the history. And then we will commit the uniq change.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;second ticket would be to take care of tests refactoring Eloy
mentioned.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-21T13:28:57+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T13:28:59+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">60</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-21T13:29:29+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T13:29:31+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">61</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>@Neeraj Thanks for your continued work :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Neeraj Thanks for your continued work :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-21T14:09:51+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T14:09:53+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">62</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Two tickets have been created as follow up tasks. Please follow these tickets if you are interested.

#5171

#5170</body>
      <body-html>&lt;div&gt;&lt;p&gt;Two tickets have been created as follow up tasks. Please follow
these tickets if you are interested.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/projects/8994/tickets/5171&quot; title=
&quot;Ticket #5171&quot;&gt;#5171&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/projects/8994/tickets/5170&quot; title=
&quot;Ticket #5170&quot;&gt;#5170&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-21T14:52:47+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch &quot;rails 3&quot;</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T14:52:48+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">63</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>Given that nested_attributes is totally broken in 2.3.8 and 2-3-stable has fixes for nested_attributes, I would say that some part of the fix should go to 2-3-stable too. Subba is working on backporting some part of the fix.

Marking the milestone as 2.3.9 and assigning it to myself until the patch is ready.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Given that nested_attributes is totally broken in 2.3.8 and
2-3-stable has fixes for nested_attributes, I would say that some
part of the fix should go to 2-3-stable too. Subba is working on
backporting some part of the fix.&lt;/p&gt;
&lt;p&gt;Marking the milestone as 2.3.9 and assigning it to myself until
the patch is ready.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-21T15:15:31+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;nested attributes\&quot; patch \&quot;rails 3\&quot;&quot;
:state: resolved
:milestone: 71472
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-21T15:15:34+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">64</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">14</attachments-count>
      <body>i am attaching 2-3-stable patch. neeraj can you verify it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;i am attaching 2-3-stable patch. neeraj can you verify it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-23T02:56:52+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-23T02:56:54+01:00</updated-at>
      <user-id type="integer">54456</user-id>
      <version type="integer">65</version>
      <user-name>Subba</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>patch for 2-3-stable looks good. All tests are passing.

+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;patch for 2-3-stable looks good. All tests are passing.&lt;/p&gt;
&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-23T21:43:36+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 40263
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-07-23T21:43:39+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">66</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>(from [12bbc34aca509aba5032e8cc8859ef0c0c845cca]) In nested_attributes when association is not loaded and association record is saved then in memory record attributes should be saved

[#5053 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/12bbc34aca509aba5032e8cc8859ef0c0c845cca</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/12bbc34aca509aba5032e8cc8859ef0c0c845cca&quot;
title=
&quot;Changeset [12bbc34aca509aba5032e8cc8859ef0c0c845cca]&quot;&gt;[12bbc34aca509aba5032e8cc8859ef0c0c845cca]&lt;/a&gt;)
In nested_attributes when association is not loaded and association
record is saved then in memory record attributes should be
saved&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5053&quot; title=
&quot;Ticket #5053&quot;&gt;#5053&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/12bbc34aca509aba5032e8cc8859ef0c0c845cca&quot;&gt;
http://github.com/rails/rails/commit/12bbc34aca509aba5032e8cc8859ef...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-03T09:57:09+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-08-03T09:57:10+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">67</version>
      <user-name>Repository</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>Since upgrading to 2.3.9 I have this errors when I try and do some simple things with collections:

@@@
NoMethodError: undefined method `keys' for false:FalseClass
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:357:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:356:in `tap'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:356:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:353:in `map'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:353:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:149:in `delete_all'
    test/unit/assignment_test.rb:127:in `__bind_1283838340_803300'
@@@

TEST CODE

@@@
Line # 127: up.assignments.delete_all
@@@

MODEL CODE

has_many :assignments, :dependent =&gt; :delete_all 


Another example that causes the same error in the same place:

@@@
return unless self.assignments.any? { |x| x.changes? and x.user_id == current_user.id }
@@@

Same exact error... I'm posting to this ticket since the error falls inside it's changes... and this was not an issue on 2.3.8.  Seems t.changes is returning true/false instead of a hash?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Since upgrading to 2.3.9 I have this errors when I try and do
some simple things with collections:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;NoMethodError: undefined method `keys' for false:FalseClass
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:357:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:356:in `tap'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:356:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:353:in `map'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:353:in `load_target'
    development/ruby/1.8/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:149:in `delete_all'
    test/unit/assignment_test.rb:127:in `__bind_1283838340_803300'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;TEST CODE&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Line # 127: up.assignments.delete_all&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;MODEL CODE&lt;/p&gt;
&lt;p&gt;has_many :assignments, :dependent =&amp;gt; :delete_all&lt;/p&gt;
&lt;p&gt;Another example that causes the same error in the same
place:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;return unless self.assignments.any? { |x| x.changes? and x.user_id == current_user.id }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Same exact error... I'm posting to this ticket since the error
falls inside it's changes... and this was not an issue on 2.3.8.
Seems t.changes is returning true/false instead of a hash?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-09-07T07:01:12+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-09-07T07:01:17+01:00</updated-at>
      <user-id type="integer">10</user-id>
      <version type="integer">68</version>
      <user-name>Josh Goebel</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>Ah, changes is reserved (dirty tracking, duh)... and my model has a changes column... hasn't hurt anything until now because I guess Rails itself was not dependent on the changes column and after this update it is.

My problem to go and fix. :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ah, changes is reserved (dirty tracking, duh)... and my model
has a changes column... hasn't hurt anything until now because I
guess Rails itself was not dependent on the changes column and
after this update it is.&lt;/p&gt;
&lt;p&gt;My problem to go and fix. :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-09-07T07:23:31+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-09-07T07:23:33+01:00</updated-at>
      <user-id type="integer">10</user-id>
      <version type="integer">69</version>
      <user-name>Josh Goebel</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>The&lt;a href=&quot;http://www.egacn.com/Watches-Ladies Chopard Replica.aspx&quot;&gt;Ladies Chopard Replica&lt;/a&gt;has the soft pliable skin of the sheep facing out as &lt;a href=&quot;http://www.egacn.com/Watches-Mens Hublot Replica.aspx&quot;&gt;Mens Hublot Replica&lt;/a&gt; has the woollen part of the skin facing in. This &lt;a href=&quot;http://www.egacn.com/Watches-Ladies Hublot Replica.aspx&quot;&gt;Ladies Hublot Replica&lt;/a&gt; results in a soft outer or exterior skin to the &lt;a href=&quot;http://www.egacn.com/Watches-Mens IWC Replica.aspx&quot;&gt;Mens IWC Replica&lt;/a&gt; that means that &lt;a href=&quot;http://www.egacn.com/Watches-Ladies IWC Replica.aspx&quot;&gt;Ladies IWC Replica&lt;/a&gt;can be a damageUGG&lt;a href=&quot;http://www.egacn.com/Watches-Mens Patek Philippe Replica.aspx&quot;&gt;Mens Patek Philippe Replica&lt;/a&gt; and wear when used in wet weather or inclement, dirty or muddy conditions. The&lt;a href=&quot;http://www.egacn.com/Watches-Ladies Patek Philippe Replica.aspx&quot;&gt;Ladies Patek Philippe Replica&lt;/a&gt;not the most hard wearing of &lt;a href=&quot;http://www.egacn.com/Watches-Mens Audemars Piguet Replica.aspx&quot;&gt;Mens Audemars Piguet Replica&lt;/a&gt;, and so wearers of&lt;a href=&quot;http://www.egacn.com/Watches-Ladies Audemars Piguet Replica.aspx&quot;&gt;Ladies Audemars Piguet Replica&lt;/a&gt; quickly that they need to use some &lt;a href=&quot;http://www.egacn.com/Watches-watches large women.aspx&quot;&gt;large women&lt;/a&gt;when selecting which day to wear their &lt;a href=&quot;http://www.egacn.com/Watches-deals on mens watches.aspx&quot;&gt;deals on mens watches&lt;/a&gt;.
The &lt;a href=&quot;http://www.egacn.com/Watches-omega automatic watches.aspx&quot;&gt;omega automatic watches&lt;/a&gt; is usually sewn onto a plastic sole,&lt;a href=&quot;http://www.egacn.com/Watches-discount designer watches women.aspx&quot;&gt;discount designer watches women&lt;/a&gt;and so the &lt;a href=&quot;http://www.egacn.com/Watches-tag carrera watches manufacturers.aspx&quot;&gt;tag carrera watches manufacturers&lt;/a&gt; is not entirely waterproof. Water can enter around the sole, and although &lt;a href=&quot;http://www.egacn.com/Watches-ulysse nardin marine chronograph w.aspx&quot;&gt;ulysse nardin marine chronograph w&lt;/a&gt; is possible to buy&lt;a href=&quot;http://www.egacn.com/Watches-inexpensive wrist watches.aspx&quot;&gt;inexpensive wrist watches&lt;/a&gt; waterproofing &lt;a href=&quot;http://www.egacn.com/Watches-cheap wrist watches.aspx&quot;&gt;cheap wrist watches&lt;/a&gt;is not a total solution. If you own a pair of Ugg Sale it&#8217;s better to treat your &lt;a href=&quot;http://www.egacn.com/Watches-discount wrist watches.aspx&quot;&gt;discount wrist watches&lt;/a&gt;care and respect and understand that even the best &lt;a href=&quot;http://www.egacn.com/Watches-omega watches price list.aspx&quot;&gt;omega watches price list&lt;/a&gt; are not ideal for hard outdoor get dirty quite quickly if &lt;a href=&quot;http://www.egacn.com/Watches-stainless steel mens watches.aspx&quot;&gt;stainless steel mens watches&lt;/a&gt;too harshly.Despite the comfort&lt;a href=&quot;http://www.egacn.com/Watches-stainless steel womens watches.aspx&quot;&gt;stainless steel womens watches&lt;/a&gt;, many people will still not wear these &lt;a href=&quot;http://www.egacn.com/Watches-iwc watches replica.aspx&quot;&gt;iwc watches replica&lt;/a&gt;because of their &lt;a href=&quot;http://www.egacn.com/Watches-Cartier gentle men watches.aspx&quot;&gt;Cartier gentle men watches&lt;/a&gt;. But &lt;a href=&quot;http://www.egacn.com/Watches-discount zenith watches.aspx&quot;&gt;discount zenith watches&lt;/a&gt; now come in a variety of &lt;a href=&quot;http://www.egacn.com/Watches-chinese mechanical watches.aspx&quot;&gt;chinese mechanical watches&lt;/a&gt;, sizes and colors &lt;a href=&quot;http://www.egacn.com/Watches-top brand watches.aspx&quot;&gt;top brand watches&lt;/a&gt; and can generally be incorporated in any kind of apparel you on wearing. Typically since these &lt;a href=&quot;http://www.egacn.com/Watches-most expensive women watches.aspx&quot;&gt;most expensive women watches&lt;/a&gt; are usually worn in the winter for thermal insulation, you can wear any kind of Ski wear or even &lt;a href=&quot;http://www.egacn.com/Watches-brand name watches women.aspx&quot;&gt;brand name watches women&lt;/a&gt;.
Those who want to become most beautiful in the world should try them. Just ones can make you different. Girls who want to grab your boyfriends's heart is necessary to use&lt;a href=&quot;http://www.egacn.com/Watches-designer watches women.aspx&quot;&gt;designer watches women&lt;/a&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The&lt;a href=
&quot;http://www.egacn.com/Watches-Ladies%20Chopard%20Replica.aspx&quot;&gt;Ladies
Chopard Replica&lt;/a&gt;has the soft pliable skin of the sheep facing
out as &lt;a href=
&quot;http://www.egacn.com/Watches-Mens%20Hublot%20Replica.aspx&quot;&gt;Mens
Hublot Replica&lt;/a&gt; has the woollen part of the skin facing in. This
&lt;a href=
&quot;http://www.egacn.com/Watches-Ladies%20Hublot%20Replica.aspx&quot;&gt;Ladies
Hublot Replica&lt;/a&gt; results in a soft outer or exterior skin to the
&lt;a href=
&quot;http://www.egacn.com/Watches-Mens%20IWC%20Replica.aspx&quot;&gt;Mens IWC
Replica&lt;/a&gt; that means that &lt;a href=
&quot;http://www.egacn.com/Watches-Ladies%20IWC%20Replica.aspx&quot;&gt;Ladies
IWC Replica&lt;/a&gt;can be a damageUGG&lt;a href=
&quot;http://www.egacn.com/Watches-Mens%20Patek%20Philippe%20Replica.aspx&quot;&gt;Mens
Patek Philippe Replica&lt;/a&gt; and wear when used in wet weather or
inclement, dirty or muddy conditions. The&lt;a href=
&quot;http://www.egacn.com/Watches-Ladies%20Patek%20Philippe%20Replica.aspx&quot;&gt;Ladies
Patek Philippe Replica&lt;/a&gt;not the most hard wearing of &lt;a href=
&quot;http://www.egacn.com/Watches-Mens%20Audemars%20Piguet%20Replica.aspx&quot;&gt;
Mens Audemars Piguet Replica&lt;/a&gt;, and so wearers of&lt;a href=
&quot;http://www.egacn.com/Watches-Ladies%20Audemars%20Piguet%20Replica.aspx&quot;&gt;Ladies
Audemars Piguet Replica&lt;/a&gt; quickly that they need to use some
&lt;a href=
&quot;http://www.egacn.com/Watches-watches%20large%20women.aspx&quot;&gt;large
women&lt;/a&gt;when selecting which day to wear their &lt;a href=
&quot;http://www.egacn.com/Watches-deals%20on%20mens%20watches.aspx&quot;&gt;deals
on mens watches&lt;/a&gt;.&lt;br&gt;
The &lt;a href=
&quot;http://www.egacn.com/Watches-omega%20automatic%20watches.aspx&quot;&gt;omega
automatic watches&lt;/a&gt; is usually sewn onto a plastic sole,&lt;a href=
&quot;http://www.egacn.com/Watches-discount%20designer%20watches%20women.aspx&quot;&gt;discount
designer watches women&lt;/a&gt;and so the &lt;a href=
&quot;http://www.egacn.com/Watches-tag%20carrera%20watches%20manufacturers.aspx&quot;&gt;
tag carrera watches manufacturers&lt;/a&gt; is not entirely waterproof.
Water can enter around the sole, and although &lt;a href=
&quot;http://www.egacn.com/Watches-ulysse%20nardin%20marine%20chronograph%20w.aspx&quot;&gt;
ulysse nardin marine chronograph w&lt;/a&gt; is possible to buy&lt;a href=
&quot;http://www.egacn.com/Watches-inexpensive%20wrist%20watches.aspx&quot;&gt;inexpensive
wrist watches&lt;/a&gt; waterproofing &lt;a href=
&quot;http://www.egacn.com/Watches-cheap%20wrist%20watches.aspx&quot;&gt;cheap
wrist watches&lt;/a&gt;is not a total solution. If you own a pair of Ugg
Sale it&amp;#8217;s better to treat your &lt;a href=
&quot;http://www.egacn.com/Watches-discount%20wrist%20watches.aspx&quot;&gt;discount
wrist watches&lt;/a&gt;care and respect and understand that even the best
&lt;a href=
&quot;http://www.egacn.com/Watches-omega%20watches%20price%20list.aspx&quot;&gt;omega
watches price list&lt;/a&gt; are not ideal for hard outdoor get dirty
quite quickly if &lt;a href=
&quot;http://www.egacn.com/Watches-stainless%20steel%20mens%20watches.aspx&quot;&gt;
stainless steel mens watches&lt;/a&gt;too harshly.Despite the
comfort&lt;a href=
&quot;http://www.egacn.com/Watches-stainless%20steel%20womens%20watches.aspx&quot;&gt;stainless
steel womens watches&lt;/a&gt;, many people will still not wear these
&lt;a href=
&quot;http://www.egacn.com/Watches-iwc%20watches%20replica.aspx&quot;&gt;iwc
watches replica&lt;/a&gt;because of their &lt;a href=
&quot;http://www.egacn.com/Watches-Cartier%20gentle%20men%20watches.aspx&quot;&gt;
Cartier gentle men watches&lt;/a&gt;. But &lt;a href=
&quot;http://www.egacn.com/Watches-discount%20zenith%20watches.aspx&quot;&gt;discount
zenith watches&lt;/a&gt; now come in a variety of &lt;a href=
&quot;http://www.egacn.com/Watches-chinese%20mechanical%20watches.aspx&quot;&gt;chinese
mechanical watches&lt;/a&gt;, sizes and colors &lt;a href=
&quot;http://www.egacn.com/Watches-top%20brand%20watches.aspx&quot;&gt;top brand
watches&lt;/a&gt; and can generally be incorporated in any kind of
apparel you on wearing. Typically since these &lt;a href=
&quot;http://www.egacn.com/Watches-most%20expensive%20women%20watches.aspx&quot;&gt;
most expensive women watches&lt;/a&gt; are usually worn in the winter for
thermal insulation, you can wear any kind of Ski wear or even
&lt;a href=
&quot;http://www.egacn.com/Watches-brand%20name%20watches%20women.aspx&quot;&gt;brand
name watches women&lt;/a&gt;.&lt;br&gt;
Those who want to become most beautiful in the world should try
them. Just ones can make you different. Girls who want to grab your
boyfriends's heart is necessary to use&lt;a href=
&quot;http://www.egacn.com/Watches-designer%20watches%20women.aspx&quot;&gt;designer
watches women&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-25T00:30:49+01:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;nested attributes&quot; patch</tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-10-25T03:19:12+01:00</updated-at>
      <user-id type="integer">121592</user-id>
      <version type="integer">70</version>
      <user-name>weifeng</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">15</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T08:54:54+00:00</created-at>
      <creator-id type="integer">87199</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;nested attributes\&quot; patch&quot;
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">5053</number>
      <permalink>childgrandchild-associations-reload-from-db-upon-validation-error-for-nested-attributes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>child/grandchild associations reload from db after nested attributes assignment</title>
      <updated-at type="datetime">2010-11-08T08:54:57+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">72</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>szetobo</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5053</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>2bbad8edb482c8c44ccdd58586bbdfbc992d8bca</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-06T12:10:34+01:00</created-at>
      <filename>nested_attribute_test_case.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">586565</id>
      <size type="integer">1774</size>
      <uploader-id type="integer">87199</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/586565/nested_attribute_test_case.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>9268bdc2c56c7fc03a1c39d57d470723e17f2e23</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-08T16:11:04+01:00</created-at>
      <filename>test_patch.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">588813</id>
      <size type="integer">1020</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/588813/test_patch.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>9e2fd1ca07626a4be6f845950c49e22863545d77</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-09T03:32:37+01:00</created-at>
      <filename>patch_against_2-3-stable.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">589493</id>
      <size type="integer">1459</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/589493/patch_against_2-3-stable.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>5b19da1b12c275b21945384805f1e2fb4034965f</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-09T03:32:37+01:00</created-at>
      <filename>patch_against_rails3_edge.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">589494</id>
      <size type="integer">1288</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/589494/patch_against_rails3_edge.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>6d9f929808104bee96c15bc72e212f228f2c50dc</code>
      <content-type>application/octet-stream</content-type>
      <created-at type="datetime">2010-07-09T03:52:43+01:00</created-at>
      <filename>better_tests.fix</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">589500</id>
      <size type="integer">5495</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/589500/better_tests.fix</url>
    </attachment>
    <attachment type="Attachment">
      <code>59e5296b934b334732fe1c48015bf805a0526960</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-09T07:57:54+01:00</created-at>
      <filename>updated_test_case.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">589554</id>
      <size type="integer">2041</size>
      <uploader-id type="integer">87199</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/589554/updated_test_case.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>d7b9f7324fbf3e04097a538b1e05446f396a0d7b</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-09T11:10:02+01:00</created-at>
      <filename>better_tests.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">589603</id>
      <size type="integer">4464</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/589603/better_tests.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>87bd636c9b9df4eef9c132dfcdaef12600c678ae</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-10T17:34:17+01:00</created-at>
      <filename>5053_rails3.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">590442</id>
      <size type="integer">2302</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/590442/5053_rails3.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f1f53b1e81e9ff68a42ab7f9f6638a3f0d12b12c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-10T17:34:18+01:00</created-at>
      <filename>5053_2-3-stable.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">590443</id>
      <size type="integer">2293</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/590443/5053_2-3-stable.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f22e9d6dbfd107bbe8cfecc4fe1a46a6071d89f5</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-11T23:28:00+01:00</created-at>
      <filename>5053_rails3_extra_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">590607</id>
      <size type="integer">3361</size>
      <uploader-id type="integer">87199</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/590607/5053_rails3_extra_fix.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>ca451734ce70e99266dbe83ad1ad73d2d58656f5</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-12T03:11:11+01:00</created-at>
      <filename>5053_rails3_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">590632</id>
      <size type="integer">2603</size>
      <uploader-id type="integer">87199</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/590632/5053_rails3_fix.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>935e857f4076ec3f5b69941ea9a650d40d11dff9</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-12T09:37:33+01:00</created-at>
      <filename>5053_rails3_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">590723</id>
      <size type="integer">2612</size>
      <uploader-id type="integer">87199</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/590723/5053_rails3_fix.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>6dfb42f32ea9afc13ee67a88c028040e33e93d5d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-15T03:50:32+01:00</created-at>
      <filename>better_tests_for_5053.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">593666</id>
      <size type="integer">1925</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/593666/better_tests_for_5053.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>cfd42faa3719d0a364acb4f79c5daacdba27889f</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-15T04:03:46+01:00</created-at>
      <filename>better_tests_for_5053.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">593671</id>
      <size type="integer">1896</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/593671/better_tests_for_5053.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>b8553418dbd27bfc8de7e6063adb4bc57456f80d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-23T02:56:52+01:00</created-at>
      <filename>5053.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">600026</id>
      <size type="integer">4876</size>
      <uploader-id type="integer">54456</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/600026/5053.diff</url>
    </attachment>
  </attachments>
</ticket>
