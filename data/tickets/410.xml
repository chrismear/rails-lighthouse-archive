<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">85</assigned-user-id>
  <attachments-count type="integer">5</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2008-06-13T18:25:12+01:00</created-at>
  <creator-id type="integer">23333</creator-id>
  <milestone-due-on type="datetime">2011-03-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">103410</milestone-id>
  <number type="integer">410</number>
  <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>open</state>
  <tag>activesupport bug patch</tag>
  <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
  <updated-at type="datetime">2011-02-27T03:15:37+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">32</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>enebo</creator-name>
  <assigned-user-name>Jeremy Kemper</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
  <milestone-title>3.0.6</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>constantize in lib/active_support/inflector.rb uses eval which is slow in both JRuby and Ruby 1.9.  This patch passes all tests and also significantly speeds up constantize on these ruby impl (without hurting perf of Ruby 1.8).</original-body>
  <latest-body>constantize in lib/active_support/inflector.rb uses eval which is slow in both JRuby and Ruby 1.9.  This patch passes all tests and also significantly speeds up constantize on these ruby impl (without hurting perf of Ruby 1.8).</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
constantize in lib/active_support/inflector.rb uses eval which is slow in both JRuby and Ruby 1.9.  This patch passes all tests and also significantly speeds up constantize on these ruby impl (without hurting perf of Ruby 1.8).
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>constantize in lib/active_support/inflector.rb uses eval which is slow in both JRuby and Ruby 1.9.  This patch passes all tests and also significantly speeds up constantize on these ruby impl (without hurting perf of Ruby 1.8).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
constantize in lib/active_support/inflector.rb uses eval which is slow in both JRuby and Ruby 1.9.  This patch passes all tests and also significantly speeds up constantize on these ruby impl (without hurting perf of Ruby 1.8).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-13T18:25:12+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-06-13T18:25:12+01:00</updated-at>
      <user-id type="integer">23333</user-id>
      <version type="integer">1</version>
      <user-name>enebo</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1

Passes all tests. I've attached a benchmark which shows this is actually slightly faster with simple constant names running 1.8.6.

It slows down with multiple namespaces. Parity occurs with 3 nested namespaces (A::B::C) but the perf. difference on even up to 7 nested namespaces is minimal. Looks good.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Passes all tests. I've attached a benchmark which shows this is actually slightly faster with simple constant names running 1.8.6.&lt;/p&gt;

&lt;p&gt;It slows down with multiple namespaces. Parity occurs with 3 nested namespaces (A::B::C) but the perf. difference on even up to 7 nested namespaces is minimal. Looks good.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T00:24:59+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-08-07T00:24:59+01:00</updated-at>
      <user-id type="integer">5450</user-id>
      <version type="integer">2</version>
      <user-name>Chris Lloyd</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [88eec8327b179cd41314e85868879b46bcf2530e]) JRuby: improve constantize performance.  [#410 state:resolved]
http://github.com/rails/rails/commit/88eec8327b179cd41314e85868879b46bcf2530e</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [88eec8327b179cd41314e85868879b46bcf2530e]) JRuby: improve constantize performance.  [&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:resolved]
&lt;a href=&quot;http://github.com/rails/rails/commit/88eec8327b179cd41314e85868879b46bcf2530e&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-07T01:34:14+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-08-07T01:34:14+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">3</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [ed8a882e47e07b470b71cacd8cd50e251dca4d27]) JRuby: improve constantize performance.  [#410 state:resolved]
http://github.com/rails/rails/commit/ed8a882e47e07b470b71cacd8cd50e251dca4d27</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [ed8a882e47e07b470b71cacd8cd50e251dca4d27]) JRuby: improve constantize performance.  [&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:resolved]
&lt;a href=&quot;http://github.com/rails/rails/commit/ed8a882e47e07b470b71cacd8cd50e251dca4d27&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-07T01:34:17+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-08-07T01:34:17+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-07T01:36:24+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-08-07T01:36:24+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">5</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This fails (after about 30 rounds of constantize / const_missing / parent)

@@@ruby
class Outer
  TOM=5
end

module Bob
  class Mary
    class Foo &lt; ::Outer
    end
    def self.doit
      i = ::Bob::Mary::Foo.new   
      puts &quot;dereference: #{::Bob::Mary::Foo::TOM}&quot;
      puts &quot;constantize: #{&quot;::Bob::Mary::Foo::TOM&quot;.constantize}&quot;
    end
  end
end

Bob::Mary.doit
@@@

for an example in the wild see the init function of picnic</body>
      <body-html>&lt;div&gt;&lt;p&gt;This fails (after about 30 rounds of constantize / const_missing
/ parent)&lt;/p&gt;
&lt;p&gt;@@@ruby class Outer TOM=5 end&lt;/p&gt;
&lt;p&gt;module Bob class Mary&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Foo &amp;lt; ::Outer
end
def self.doit
  i = ::Bob::Mary::Foo.new
  puts &quot;dereference: #{::Bob::Mary::Foo::TOM}&quot;
  puts [constantize: #{](:Bob::Mary::Foo::TOM&quot;.constantize}&quot;)
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end end&lt;/p&gt;
&lt;p&gt;Bob::Mary.doit&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;

for an example in the wild see the init function of picnic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-11T08:36:18+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-09-11T08:37:08+01:00</updated-at>
      <user-id type="integer">29836</user-id>
      <version type="integer">6</version>
      <user-name>Michael Johnston</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>sigh. lets try that again. 

@@@ ruby
class Outer
  TOM=5
end

module Bob
  class Mary
    class Foo &lt; ::Outer
    end
    def self.doit
      i = ::Bob::Mary::Foo.new   
      puts &quot;dereference: #{::Bob::Mary::Foo::TOM}&quot;
      puts &quot;constantize: #{&quot;::Bob::Mary::Foo::TOM&quot;.constantize}&quot;
    end
  end
end

Bob::Mary.doit
@@@

for an example in the wild see the init function of picnic</body>
      <body-html>&lt;div&gt;&lt;p&gt;sigh. lets try that again.&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
class Outer
  TOM=5
end

module Bob
  class Mary
    class Foo &amp;lt; ::Outer
    end
    def self.doit
      i = ::Bob::Mary::Foo.new
      puts &amp;quot;dereference: #{::Bob::Mary::Foo::TOM}&amp;quot;
      puts &amp;quot;constantize: #{&amp;quot;::Bob::Mary::Foo::TOM&amp;quot;.constantize}&amp;quot;
    end
  end
end

Bob::Mary.doit
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;for an example in the wild see the init function of picnic&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-11T08:37:46+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-09-11T08:38:48+01:00</updated-at>
      <user-id type="integer">29836</user-id>
      <version type="integer">7</version>
      <user-name>Michael Johnston</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>actually, this fails too:

@@@ ruby
class Outer2
  module Why
    TOM2 = 5
  end
  include Why
end

&quot;Outer2::TOM2&quot;.constantize
@@@

which is why &quot;Logger::INFO&quot;.constantize fails which is (another reason) why picnic fails.</body>
      <body-html>&lt;div&gt;&lt;p&gt;actually, this fails too:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
class Outer2
  module Why
    TOM2 = 5
  end
  include Why
end

&amp;quot;Outer2::TOM2&amp;quot;.constantize
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which is why &quot;Logger::INFO&quot;.constantize fails which is (another
reason) why picnic fails.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-11T08:51:06+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-09-11T08:51:42+01:00</updated-at>
      <user-id type="integer">29836</user-id>
      <version type="integer">8</version>
      <user-name>Michael Johnston</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Michael, could you add a failing test case? Do you have a workaround that doesn't use eval?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Michael, could you add a failing test case? Do you have a
workaround that doesn't use eval?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T17:08:24+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-09-11T17:08:31+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">9</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-10-24T03:19:51+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9901
</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-10-24T03:19:56+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">10</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>It's been awhile, so attached is my own attempt a failing test case. I added an &quot;Extension&quot; module to Ace::Base; it's the simplest I could come up with that fails. The &quot;Extension&quot; doesn't break the rest of the test cases.</body>
      <body-html>&lt;div&gt;&lt;p&gt;It's been awhile, so attached is my own attempt a failing test
case. I added an &quot;Extension&quot; module to Ace::Base; it's the simplest
I could come up with that fails. The &quot;Extension&quot; doesn't break the
rest of the test cases.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-03T16:46:34+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-03T16:46:38+00:00</updated-at>
      <user-id type="integer">25517</user-id>
      <version type="integer">11</version>
      <user-name>Ripta Pasay</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>This seems to do the trick, speed seems on par with the previous implementation. Not 100% sure about the ruby 1.9 specific changes, the inflector tests do still pass but I'm not quite up to date on how const\_defined? etc.. have  changed</body>
      <body-html>&lt;div&gt;&lt;p&gt;This seems to do the trick, speed seems on par with the previous
implementation. Not 100% sure about the ruby 1.9 specific changes,
the inflector tests do still pass but I'm not quite up to date on
how const_defined? etc.. have changed&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-13T18:24:15+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-13T18:24:18+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">12</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Oops, ruby 1.9 changes were a bit off. This should be better</body>
      <body-html>&lt;div&gt;&lt;p&gt;Oops, ruby 1.9 changes were a bit off. This should be better&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-14T10:08:48+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-14T10:08:50+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">13</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [eca79e6bf052041c018c7ba08750238f8b2ecb7a]) Make constantize look into ancestors

[#410 state:resolved]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;

Conflicts:

	activesupport/lib/active_support/inflector.rb
http://github.com/rails/rails/commit/eca79e6bf052041c018c7ba08750238f8b2ecb7a</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [eca79e6bf052041c018c7ba08750238f8b2ecb7a]) Make
constantize look into ancestors&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Conflicts:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;activesupport/lib/active_support/inflector.rb
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=&quot;http://github.com/rails/rails/commit/eca79e6bf052041c018c7ba08750238f8b2ecb7a&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-15T19:05:55+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-15T19:05:56+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [262fef7ed57520b857605a0105fe7ba9265654f6]) Make constantize look into ancestors

[#410 state:resolved]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/262fef7ed57520b857605a0105fe7ba9265654f6</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [262fef7ed57520b857605a0105fe7ba9265654f6]) Make
constantize look into ancestors&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/262fef7ed57520b857605a0105fe7ba9265654f6&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-15T19:05:56+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-15T19:05:57+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">15</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [87790e00ec4a0b24146de3757d1d6892689b05e4]) Make constantize look into ancestors

[#410 state:resolved]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/87790e00ec4a0b24146de3757d1d6892689b05e4</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [87790e00ec4a0b24146de3757d1d6892689b05e4]) Make
constantize look into ancestors&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/87790e00ec4a0b24146de3757d1d6892689b05e4&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-15T19:05:56+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-15T19:05:58+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">16</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [d7b7ff0556ea5a66aeda455141ba06b558671e3d]) Revert &quot;Make constantize look into ancestors&quot;

[#410 state:open]

This reverts commit 87790e00ec4a0b24146de3757d1d6892689b05e4.
http://github.com/rails/rails/commit/d7b7ff0556ea5a66aeda455141ba06b558671e3d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [d7b7ff0556ea5a66aeda455141ba06b558671e3d]) Revert &quot;Make
constantize look into ancestors&quot;&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:open]&lt;/p&gt;
&lt;p&gt;This reverts commit 87790e00ec4a0b24146de3757d1d6892689b05e4.
&lt;a href=&quot;http://github.com/rails/rails/commit/d7b7ff0556ea5a66aeda455141ba06b558671e3d&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-16T02:22:12+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-16T02:22:13+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">17</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [981314f45cbb42d1b5403ac0d984f37c82226438]) Revert &quot;Make constantize look into ancestors&quot;

[#410 state:open]

This reverts commit eca79e6bf052041c018c7ba08750238f8b2ecb7a.
http://github.com/rails/rails/commit/981314f45cbb42d1b5403ac0d984f37c82226438</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [981314f45cbb42d1b5403ac0d984f37c82226438]) Revert &quot;Make
constantize look into ancestors&quot;&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:open]&lt;/p&gt;
&lt;p&gt;This reverts commit eca79e6bf052041c018c7ba08750238f8b2ecb7a.
&lt;a href=&quot;http://github.com/rails/rails/commit/981314f45cbb42d1b5403ac0d984f37c82226438&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-16T02:22:12+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-16T02:22:14+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">18</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [19be3d35b38b6685789d8d343617d465a3652717]) Revert &quot;Make constantize look into ancestors&quot;

[#410 state:open]

This reverts commit 262fef7ed57520b857605a0105fe7ba9265654f6.
http://github.com/rails/rails/commit/19be3d35b38b6685789d8d343617d465a3652717</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [19be3d35b38b6685789d8d343617d465a3652717]) Revert &quot;Make
constantize look into ancestors&quot;&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/410&quot; title=&quot;Ticket #410&quot;&gt;#410&lt;/a&gt; state:open]&lt;/p&gt;
&lt;p&gt;This reverts commit 262fef7ed57520b857605a0105fe7ba9265654f6.
&lt;a href=&quot;http://github.com/rails/rails/commit/19be3d35b38b6685789d8d343617d465a3652717&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-16T02:22:55+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2008-12-16T02:22:56+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">19</version>
      <user-name>Repository</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>What does this patch need to be accepted? It appears from some discussion [here](http://www.ruby-forum.com/topic/51795) and [here](http://osdir.com/ml/lang.ruby.devel/2006-01/msg00026.html)
that the second argument to const_defined? was specifically added to make the test included here pass.

Also ran into this in a Picnic situation; &quot;Logger::DEBUG&quot;.constantize wasn't finding the constant.

The 1.9 case in the current code overrides this behavior and restores the (somewhat hard to understand) behavior of Ruby 1.8. I know I was amazed when &quot;Logger::DEBUG&quot;.constantize didn't work even though Logger::DEBUG evaluated without error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;What does this patch need to be accepted? It appears from some
discussion &lt;a href=&quot;http://www.ruby-forum.com/topic/51795&quot;&gt;here&lt;/a&gt;
and &lt;a href=&quot;http://osdir.com/ml/lang.ruby.devel/2006-01/msg00026.html&quot;&gt;here&lt;/a&gt;
that the second argument to const_defined? was specifically added
to make the test included here pass.&lt;/p&gt;
&lt;p&gt;Also ran into this in a Picnic situation;
&quot;Logger::DEBUG&quot;.constantize wasn't finding the constant.&lt;/p&gt;
&lt;p&gt;The 1.9 case in the current code overrides this behavior and
restores the (somewhat hard to understand) behavior of Ruby 1.8. I
know I was amazed when &quot;Logger::DEBUG&quot;.constantize didn't work even
though Logger::DEBUG evaluated without error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-09T01:17:13+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport patch
:milestone: 22038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2009-01-09T01:17:14+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">20</version>
      <user-name>Matt Jones</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-27T17:04:35+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 24544
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2009-01-27T17:04:38+00:00</updated-at>
      <user-id type="integer">12714</user-id>
      <version type="integer">21</version>
      <user-name>Yehuda Katz (wycats)</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Any updates in this ticket? is this still a issue on Rails master?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any updates in this ticket? is this still a issue on Rails
master?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T07:31:48+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-06-17T07:31:55+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">22</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>The original ticket title no longer applies as eval is no longer used in constantize however Michael Johnston's failing example still fails on master.

The actual problem now is that const_defined? doesn't look for constants in included modules in 1.8.7 but it does in 1.9.x. There's an optional second parameter that turns it off - which is what constantize does. The last patch tries to fix it by searching the ancestors list, however it's probably best to use the optimised behavior on 1.9.x and only search ancestors on 1.8.7.

I can come up with a new patch if you want me to.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The original ticket title no longer applies as eval is no longer
used in constantize however Michael Johnston's failing example
still fails on master.&lt;/p&gt;
&lt;p&gt;The actual problem now is that const_defined? doesn't look for
constants in included modules in 1.8.7 but it does in 1.9.x.
There's an optional second parameter that turns it off - which is
what constantize does. The last patch tries to fix it by searching
the ancestors list, however it's probably best to use the optimised
behavior on 1.9.x and only search ancestors on 1.8.7.&lt;/p&gt;
&lt;p&gt;I can come up with a new patch if you want me to.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T10:50:10+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-06-17T10:50:23+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">23</version>
      <user-name>Andrew White</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>+1 for Andrew's idea.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 for Andrew's idea.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T12:43:40+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-06-17T12:43:51+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">24</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>+1 from me too</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 from me too&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-20T03:59:18+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-06-20T03:59:27+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">25</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Andrew, have you been able to work on that patch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Andrew, have you been able to work on that patch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-03T07:50:19+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-08-03T07:50:21+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">26</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I've looked at it and unfortunately using the optimized const_defined? in 1.9.2 returns top level constants which is different to the required behavior. I looked at using constant.constants.member? but it's unbearably slow. Therefore the technique in Fredrick's patch is about as good as it'll get and it results in about a 33% slowdown for a constant like ActiveSupport::Routing::Mapper. The same is true for 1.8.7 and 1.9.2 and const_defined? is slower by about 33% in 1.9.2 than 1.8.7 anyway.

This may or may not be acceptable - the attached patch is basically an update of Frederick's patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've looked at it and unfortunately using the optimized
const_defined? in 1.9.2 returns top level constants which is
different to the required behavior. I looked at using
constant.constants.member? but it's unbearably slow. Therefore the
technique in Fredrick's patch is about as good as it'll get and it
results in about a 33% slowdown for a constant like
ActiveSupport::Routing::Mapper. The same is true for 1.8.7 and
1.9.2 and const_defined? is slower by about 33% in 1.9.2 than 1.8.7
anyway.&lt;/p&gt;
&lt;p&gt;This may or may not be acceptable - the attached patch is
basically an update of Frederick's patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T18:15:52+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-08-19T18:15:56+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">27</version>
      <user-name>Andrew White</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:29+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-08-30T04:10:29+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">28</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:28+01:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-10-15T23:01:28+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">29</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/34353)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/34353&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:15:11+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2010-11-15T21:15:11+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">30</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/42275)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/42275&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-12T21:58:20+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 92071
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2011-02-12T21:58:20+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">31</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/43692)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/43692&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-27T03:15:37+00:00</created-at>
      <creator-id type="integer">23333</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 101623
</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">410</number>
      <permalink>inflector-constantize-uses-eval-which-is-slow-in-jruby-and-ruby-1-9</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bug patch</tag>
      <title>Inflector.constantize uses eval which is slow in JRuby and Ruby 1.9</title>
      <updated-at type="datetime">2011-02-27T03:15:37+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">32</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>enebo</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/410</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>5bc88822d454d47b10de655f2403c56fa171eccc</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-13T18:25:12+01:00</created-at>
      <filename>constantize.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">27365</id>
      <size type="integer">907</size>
      <uploader-id type="integer">23333</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/27365/constantize.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>397f72feddc5f6281735eb61bff0748c02c94c30</code>
      <content-type>text/x-ruby-script</content-type>
      <created-at type="datetime">2008-08-07T00:24:59+01:00</created-at>
      <filename>constantize.patch.benchmark.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">37507</id>
      <size type="integer">1081</size>
      <uploader-id type="integer">5450</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/37507/constantize.patch.benchmark.rb</url>
    </attachment>
    <attachment type="Attachment">
      <code>1ea33ba60d965cc3da362827019c74999f13474e</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-03T16:46:34+00:00</created-at>
      <filename>0001-Add-failing-lexical-lookup-test-case.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">67660</id>
      <size type="integer">1339</size>
      <uploader-id type="integer">25517</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/67660/0001-Add-failing-lexical-lookup-test-case.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>2f1e05a883020aa28a90b931bf0465425dd53721</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-14T10:08:48+00:00</created-at>
      <filename>fix_constantize.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">71042</id>
      <size type="integer">2723</size>
      <uploader-id type="integer">17477</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/71042/fix_constantize.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>e6deaca0869373b0fb70697d0238109ddc899690</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-08-19T18:15:52+01:00</created-at>
      <filename>0001-search-ancestors-in-constantize.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">636677</id>
      <size type="integer">2735</size>
      <uploader-id type="integer">7697</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/636677/0001-search-ancestors-in-constantize.diff</url>
    </attachment>
  </attachments>
</ticket>
