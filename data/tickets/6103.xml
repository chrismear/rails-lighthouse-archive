<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">40272</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-17T06:48:11+00:00</created-at>
  <creator-id type="integer">77317</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">6103</number>
  <permalink>average-returns-integer-values-instead-of-decimals</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
  <title>average() returns integer values instead of decimals</title>
  <updated-at type="datetime">2011-02-17T06:48:11+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">18</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Andreas Mayer</creator-name>
  <assigned-user-name>Santiago Pastorino</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
  <priority-name>Low</priority-name>
  <original-body>I have a table &quot;comments&quot; with column &quot;rating&quot;.

To get the average:

    &gt; t.comments.calculate(:average, 'rating')
    =&gt; 4
    &gt; t.comments.calculate(:average, 'rating').class
    =&gt; Fixnum

which is WRONG!

Expected result:
4.6667


When I have a look at the logs, the generated command is:

SQL (0.1ms)  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial')


When I run this command manually:

    mysql&gt;  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial');
    +--------+
    | avg_id |
    +--------+
    | 4.6667 |
    +--------+

which is correct. So, the generated SQL command is correct, but the result is converted to a decimal somehow.


Maybe related to #4514?</original-body>
  <latest-body>I have a table &quot;comments&quot; with column &quot;rating&quot;.

To get the average:

    &gt; t.comments.calculate(:average, 'rating')
    =&gt; 4
    &gt; t.comments.calculate(:average, 'rating').class
    =&gt; Fixnum

which is WRONG!

Expected result:
4.6667


When I have a look at the logs, the generated command is:

SQL (0.1ms)  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial')


When I run this command manually:

    mysql&gt;  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial');
    +--------+
    | avg_id |
    +--------+
    | 4.6667 |
    +--------+

which is correct. So, the generated SQL command is correct, but the result is converted to a decimal somehow.


Maybe related to #4514?</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I have a table &quot;comments&quot; with column &quot;rating&quot;.&lt;/p&gt;
&lt;p&gt;To get the average:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt; t.comments.calculate(:average, 'rating')
=&amp;gt; 4
&amp;gt; t.comments.calculate(:average, 'rating').class
=&amp;gt; Fixnum&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;which is WRONG!&lt;/p&gt;
&lt;p&gt;Expected result:&lt;br&gt;
4.6667&lt;/p&gt;
&lt;p&gt;When I have a look at the logs, the generated command is:&lt;/p&gt;
&lt;p&gt;SQL (0.1ms) SELECT
AVG(&lt;code&gt;comments&lt;/code&gt;.&lt;code&gt;rating&lt;/code&gt;) AS avg_id FROM
&lt;code&gt;comments&lt;/code&gt; WHERE (&lt;code&gt;comments&lt;/code&gt;.commentable_id =
74 AND &lt;code&gt;comments&lt;/code&gt;.commentable_type = 'Tutorial')&lt;/p&gt;
&lt;p&gt;When I run this command manually:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt;  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial');
+--------+
| avg_id |
+--------+
| 4.6667 |
+--------+&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;which is correct. So, the generated SQL command is correct, but
the result is converted to a decimal somehow.&lt;/p&gt;
&lt;p&gt;Maybe related to &lt;a href=&quot;/projects/8994/tickets/4514&quot; title=
&quot;Ticket #4514&quot;&gt;#4514&lt;/a&gt;?&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have a table &quot;comments&quot; with column &quot;rating&quot;.

To get the average:

    &gt; t.comments.calculate(:average, 'rating')
    =&gt; 4
    &gt; t.comments.calculate(:average, 'rating').class
    =&gt; Fixnum

which is WRONG!

Expected result:
4.6667


When I have a look at the logs, the generated command is:

SQL (0.1ms)  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial')


When I run this command manually:

    mysql&gt;  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial');
    +--------+
    | avg_id |
    +--------+
    | 4.6667 |
    +--------+

which is correct. So, the generated SQL command is correct, but the result is converted to a decimal somehow.


Maybe related to #4514?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have a table &quot;comments&quot; with column &quot;rating&quot;.&lt;/p&gt;
&lt;p&gt;To get the average:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt; t.comments.calculate(:average, 'rating')
=&amp;gt; 4
&amp;gt; t.comments.calculate(:average, 'rating').class
=&amp;gt; Fixnum&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;which is WRONG!&lt;/p&gt;
&lt;p&gt;Expected result:&lt;br&gt;
4.6667&lt;/p&gt;
&lt;p&gt;When I have a look at the logs, the generated command is:&lt;/p&gt;
&lt;p&gt;SQL (0.1ms) SELECT
AVG(&lt;code&gt;comments&lt;/code&gt;.&lt;code&gt;rating&lt;/code&gt;) AS avg_id FROM
&lt;code&gt;comments&lt;/code&gt; WHERE (&lt;code&gt;comments&lt;/code&gt;.commentable_id =
74 AND &lt;code&gt;comments&lt;/code&gt;.commentable_type = 'Tutorial')&lt;/p&gt;
&lt;p&gt;When I run this command manually:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt;  SELECT AVG(`comments`.`rating`) AS avg_id FROM `comments` WHERE (`comments`.commentable_id = 74 AND `comments`.commentable_type = 'Tutorial');
+--------+
| avg_id |
+--------+
| 4.6667 |
+--------+&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;which is correct. So, the generated SQL command is correct, but
the result is converted to a decimal somehow.&lt;/p&gt;
&lt;p&gt;Maybe related to &lt;a href=&quot;/projects/8994/tickets/4514&quot; title=
&quot;Ticket #4514&quot;&gt;#4514&lt;/a&gt;?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-02T17:05:31+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>aggregations arel &quot;rails 3.0.3&quot;</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-02T17:10:44+00:00</updated-at>
      <user-id type="integer">77317</user-id>
      <version type="integer">1</version>
      <user-name>Andreas Mayer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Soon &lt;a href=&quot;http://www.guccishoeshandbags.com/louis-vuitton-shoes-c-23_34.html&quot;&gt;louis vuitton shoes for men&lt;/a&gt;  after Mr Chavez &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-wallets-c-35_53.html&quot;&gt;gucci wallets for women&lt;/a&gt;  &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-dress-shoes-c-23_32.html&quot;&gt;gucci dress shoes&lt;/a&gt;  &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-sneakers-c-23_26.html&quot;&gt;gucci sneakers for men&lt;/a&gt;  refused &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;gucci slipper for men&lt;/a&gt;  &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-hoodies-c-23_49.html&quot;&gt;gucci clothing&lt;/a&gt;  to send a warning &lt;a href=&quot;http://www.guccishoeshandbags.com/louis-vuitton-belts-c-35_44.html&quot;&gt;cheap louis vuitton belt&lt;/a&gt;  from the &lt;a href=&quot;http://www.guccishoeshandbags.com&quot;&gt;gucci shoes for men&lt;/a&gt;  Secretary &lt;a href=&quot;http://www.guccishoeshandbags.com/&quot;&gt;gucci shoes for cheap&lt;/a&gt;  of tanks &lt;a href=&quot;http://www.guccishoeshandbags.com&quot;&gt;cheap gucci sneakers&lt;/a&gt;  Hillary &lt;a href=&quot;http://www.guccishoeshandbags.com/louis-vuitton-sneakers-c-24_41.html&quot;&gt;women louis vuitton sneakers&lt;/a&gt;  &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-sandals-c-24_40.html&quot;&gt;gucci sandal&lt;/a&gt;  Clinton &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-boots-c-24_51.html&quot;&gt;gucci boots for women&lt;/a&gt;  on Friday &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-sneakers-c-24_29.html&quot;&gt;women gucci shoes&lt;/a&gt;  to think &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-pumps-c-24_39.html&quot;&gt;women gucci pumps&lt;/a&gt;  that Latin &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-loafers-c-23_30.html&quot;&gt;gucci loafers&lt;/a&gt;  America, &lt;a href=&quot;http://www.guccishoeshandbags.com/prada-sneakers-c-23_33.html&quot;&gt;prada sneakers for men&lt;/a&gt;  twice &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;mens gucci slipper&lt;/a&gt;  needed to &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-high-tops-c-23_27.html&quot;&gt;gucci high tops&lt;/a&gt;  promote &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-belts-c-35_43.html&quot;&gt;gucci belts&lt;/a&gt;  &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;cheap gucci slipper&lt;/a&gt;  relations &lt;a href=&quot;http://www.guccishoeshandbags.com/gucci-jeans-c-23_48.html&quot;&gt;cheap gucci jeans&lt;/a&gt;  with Iran. Iranian President Mahmoud Ahmadinejad last month to visit Brazil, Venezuela and Bolivia, support the right of Iran has expressed a nuclear program.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Soon &lt;a href=
&quot;http://www.guccishoeshandbags.com/louis-vuitton-shoes-c-23_34.html&quot;&gt;
louis vuitton shoes for men&lt;/a&gt; after Mr Chavez &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-wallets-c-35_53.html&quot;&gt;gucci
wallets for women&lt;/a&gt; &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-dress-shoes-c-23_32.html&quot;&gt;gucci
dress shoes&lt;/a&gt; &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-sneakers-c-23_26.html&quot;&gt;gucci
sneakers for men&lt;/a&gt; refused &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;gucci
slipper for men&lt;/a&gt; &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-hoodies-c-23_49.html&quot;&gt;gucci
clothing&lt;/a&gt; to send a warning &lt;a href=
&quot;http://www.guccishoeshandbags.com/louis-vuitton-belts-c-35_44.html&quot;&gt;
cheap louis vuitton belt&lt;/a&gt; from the &lt;a href=
&quot;http://www.guccishoeshandbags.com&quot;&gt;gucci shoes for men&lt;/a&gt;
Secretary &lt;a href=&quot;http://www.guccishoeshandbags.com/&quot;&gt;gucci shoes
for cheap&lt;/a&gt; of tanks &lt;a href=
&quot;http://www.guccishoeshandbags.com&quot;&gt;cheap gucci sneakers&lt;/a&gt;
Hillary &lt;a href=
&quot;http://www.guccishoeshandbags.com/louis-vuitton-sneakers-c-24_41.html&quot;&gt;
women louis vuitton sneakers&lt;/a&gt; &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-sandals-c-24_40.html&quot;&gt;gucci
sandal&lt;/a&gt; Clinton &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-boots-c-24_51.html&quot;&gt;gucci
boots for women&lt;/a&gt; on Friday &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-sneakers-c-24_29.html&quot;&gt;women
gucci shoes&lt;/a&gt; to think &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-pumps-c-24_39.html&quot;&gt;women
gucci pumps&lt;/a&gt; that Latin &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-loafers-c-23_30.html&quot;&gt;gucci
loafers&lt;/a&gt; America, &lt;a href=
&quot;http://www.guccishoeshandbags.com/prada-sneakers-c-23_33.html&quot;&gt;prada
sneakers for men&lt;/a&gt; twice &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;mens
gucci slipper&lt;/a&gt; needed to &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-high-tops-c-23_27.html&quot;&gt;gucci
high tops&lt;/a&gt; promote &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-belts-c-35_43.html&quot;&gt;gucci
belts&lt;/a&gt; &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-slippers-c-23_59.html&quot;&gt;cheap
gucci slipper&lt;/a&gt; relations &lt;a href=
&quot;http://www.guccishoeshandbags.com/gucci-jeans-c-23_48.html&quot;&gt;cheap
gucci jeans&lt;/a&gt; with Iran. Iranian President Mahmoud Ahmadinejad
last month to visit Brazil, Venezuela and Bolivia, support the
right of Iran has expressed a nuclear program.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-03T01:44:45+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>aggregations arel &quot;rails 3.0.3&quot;</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-04T04:17:52+00:00</updated-at>
      <user-id type="integer">127648</user-id>
      <version type="integer">2</version>
      <user-name>cheap gucci shoes</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-03T21:22:19+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: aggregations arel &quot;rails 3.0.3&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot;</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-03T21:22:23+00:00</updated-at>
      <user-id type="integer">77317</user-id>
      <version type="integer">3</version>
      <user-name>Andreas Mayer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-03T21:23:18+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activerecord aggregations &quot;rails 3.0.3&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-03T21:23:21+00:00</updated-at>
      <user-id type="integer">77317</user-id>
      <version type="integer">4</version>
      <user-name>Andreas Mayer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>It works for me in edge for postgres.

@@@
ree-1.8.7-2010.02 &gt; Post.calculate(:average, 'rating')
 =&gt; #&lt;BigDecimal:102740628,'0.125E2',18(27)&gt; 
ree-1.8.7-2010.02 &gt; 
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;It works for me in edge for postgres.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ree-1.8.7-2010.02 &amp;gt; Post.calculate(:average, 'rating')
 =&amp;gt; #&amp;lt;BigDecimal:102740628,'0.125E2',18(27)&amp;gt; 
ree-1.8.7-2010.02 &amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-18T15:50:53+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-18T15:50:59+00:00</updated-at>
      <user-id type="integer">65953</user-id>
      <version type="integer">5</version>
      <user-name>2kan</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>It works for me in edge for postgres.

@@@
ree-1.8.7-2010.02 &gt; Post.calculate(:average, 'rating')
 =&gt; #&lt;BigDecimal:102740628,'0.125E2',18(27)&gt; 
ree-1.8.7-2010.02 &gt; 
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;It works for me in edge for postgres.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ree-1.8.7-2010.02 &amp;gt; Post.calculate(:average, 'rating')
 =&amp;gt; #&amp;lt;BigDecimal:102740628,'0.125E2',18(27)&amp;gt; 
ree-1.8.7-2010.02 &amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-18T15:52:02+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-18T15:52:07+00:00</updated-at>
      <user-id type="integer">65953</user-id>
      <version type="integer">6</version>
      <user-name>2kan</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Maybe a MySQL driver-related issue? Or could this have been fixed in edge, shall I try?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Maybe a MySQL driver-related issue? Or could this have been
fixed in edge, shall I try?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-18T18:20:27+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-18T18:20:28+00:00</updated-at>
      <user-id type="integer">77317</user-id>
      <version type="integer">7</version>
      <user-name>Andreas Mayer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Think this bug is related with the type cast of the calculated value. the activerecord tries to cast the value based on the type of the column. 

If the rating column is of type integer it should calculate integer/integer = integer. If raging is of type float, it calculates float/integer = float.

What is the type of your rating column ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Think this bug is related with the type cast of the calculated
value. the activerecord tries to cast the value based on the type
of the column.&lt;/p&gt;
&lt;p&gt;If the rating column is of type integer it should calculate
integer/integer = integer. If raging is of type float, it
calculates float/integer = float.&lt;/p&gt;
&lt;p&gt;What is the type of your rating column ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T01:10:13+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T01:10:18+00:00</updated-at>
      <user-id type="integer">72621</user-id>
      <version type="integer">8</version>
      <user-name>Tiago Fernandes</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Did a quick test with a fresh rails install and sqlite3, and the calculated value is different for columns of type integer and float.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Did a quick test with a fresh rails install and sqlite3, and the
calculated value is different for columns of type integer and
float.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T01:11:43+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T01:11:49+00:00</updated-at>
      <user-id type="integer">72621</user-id>
      <version type="integer">9</version>
      <user-name>Tiago Fernandes</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>My :ratings are integer. Maybe this is the problem because the avg() of integer values still can be float - the avg() of 1 and 2 is not 1 but 1.5</body>
      <body-html>&lt;div&gt;&lt;p&gt;My :ratings are integer. Maybe this is the problem because the
avg() of integer values still can be float - the avg() of 1 and 2
is not 1 but 1.5&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T12:34:39+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T12:34:44+00:00</updated-at>
      <user-id type="integer">77317</user-id>
      <version type="integer">10</version>
      <user-name>Andreas Mayer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In ticket 6158 ( https://rails.lighthouseapp.com/projects/8994/tickets/6158-count-on-decimal-column-returns-bigdecimal ), performing a COUNT() operation on a decimal column is returning a decimal, event though a count should always be a whole integer. I've already added a unit test and patch for that particular patch. I suppose this is the inverse of that issue.

There's a method in /lib/active_record/relation/calculations.rb that coerces the type returned to be the same as the column type.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In ticket 6158 ( &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/6158-count-on-decimal-column-returns-bigdecimal&quot;&gt;
https://rails.lighthouseapp.com/projects/8994/tickets/6158-count-on...&lt;/a&gt;
), performing a COUNT() operation on a decimal column is returning
a decimal, event though a count should always be a whole integer.
I've already added a unit test and patch for that particular patch.
I suppose this is the inverse of that issue.&lt;/p&gt;
&lt;p&gt;There's a method in /lib/active_record/relation/calculations.rb
that coerces the type returned to be the same as the column
type.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T22:18:06+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T22:18:12+00:00</updated-at>
      <user-id type="integer">128879</user-id>
      <version type="integer">11</version>
      <user-name>Jarrett Meyer</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Think that the bug is related with type_cast method in the schema_definitions.rb

If you create a second field rating2 of type float, and test Post.average(:rating) vs Post.average(:rating2), you will notice that the value class in on both Float, but the class of type is integer and float respectively.

From the comment in the code i think that value is supposed to be String, but as you can test, it can be also a float. A small fix can be: &quot;return value if !value.is_a?(String)&quot; in the beginning of the type_cast method.

&lt;code&gt;
# Casts value (which is a String) to an appropriate instance.
def type_cast(value)
  return nil if value.nil?
  puts &quot;Class: #{type.class}&quot;
  puts &quot;Type: #{type}&quot;
  puts &quot;Value class: #{value.class}&quot;
  puts &quot;Value: #{value}&quot;
  case type
      when :string    then value
      when :text      then value
      when :integer   then value.to_i rescue value ? 1 : 0
      when :float     then value.to_f
      when :decimal   then self.class.value_to_decimal(value)
      when :datetime  then self.class.string_to_time(value)
      when :timestamp then self.class.string_to_time(value)
      when :time      then self.class.string_to_dummy_time(value)
      when :date      then self.class.string_to_date(value)
      when :binary    then self.class.binary_to_string(value)
      when :boolean   then self.class.value_to_boolean(value)
      else value
  end
end
&lt;/code&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;Think that the bug is related with type_cast method in the
schema_definitions.rb&lt;/p&gt;
&lt;p&gt;If you create a second field rating2 of type float, and test
Post.average(:rating) vs Post.average(:rating2), you will notice
that the value class in on both Float, but the class of type is
integer and float respectively.&lt;/p&gt;
&lt;p&gt;From the comment in the code i think that value is supposed to
be String, but as you can test, it can be also a float. A small fix
can be: &quot;return value if !value.is_a?(String)&quot; in the beginning of
the type_cast method.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;br&gt;&lt;/code&gt;&lt;/p&gt;
&lt;h1&gt;Casts value (which is a String) to an appropriate
instance.&lt;/h1&gt;
&lt;p&gt;def type_cast(value)&lt;br&gt;
return nil if value.nil? puts &quot;Class: #{type.class}&quot; puts &quot;Type:
#{type}&quot; puts &quot;Value class: #{value.class}&quot; puts &quot;Value: #{value}&quot;
case type&lt;/p&gt;
{mkd-extraction-02893f2974f2d821de0529f9bcc610de}
&lt;p&gt;end end&lt;br&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T23:52:19+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T23:52:28+00:00</updated-at>
      <user-id type="integer">72621</user-id>
      <version type="integer">12</version>
      <user-name>Tiago Fernandes</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;pre&gt;
     # Casts value (which is a String) to an appropriate instance.
      def type_cast(value)
        return nil if value.nil?
        puts &quot;Class: #{type.class}&quot;
        puts &quot;Type: #{type}&quot;
        puts &quot;Value class: #{value.class}&quot;
        puts &quot;Value: #{value}&quot;
        case type
          when :string    then value
          when :text      then value
          when :integer   then value.to_i rescue value ? 1 : 0
          when :float     then value.to_f
          when :decimal   then self.class.value_to_decimal(value)
          when :datetime  then self.class.string_to_time(value)
          when :timestamp then self.class.string_to_time(value)
          when :time      then self.class.string_to_dummy_time(value)
          when :date      then self.class.string_to_date(value)
          when :binary    then self.class.binary_to_string(value)
          when :boolean   then self.class.value_to_boolean(value)
          else value
        end
      end
&lt;/pre&gt;</body>
      <body-html>&lt;div&gt;&lt;pre&gt;
     # Casts value (which is a String) to an appropriate instance.
      def type_cast(value)
        return nil if value.nil?
        puts &quot;Class: #{type.class}&quot;
        puts &quot;Type: #{type}&quot;
        puts &quot;Value class: #{value.class}&quot;
        puts &quot;Value: #{value}&quot;
        case type
          when :string    then value
          when :text      then value
          when :integer   then value.to_i rescue value ? 1 : 0
          when :float     then value.to_f
          when :decimal   then self.class.value_to_decimal(value)
          when :datetime  then self.class.string_to_time(value)
          when :timestamp then self.class.string_to_time(value)
          when :time      then self.class.string_to_dummy_time(value)
          when :date      then self.class.string_to_date(value)
          when :binary    then self.class.binary_to_string(value)
          when :boolean   then self.class.value_to_boolean(value)
          else value
        end
      end
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-19T23:53:37+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2010-12-19T23:53:47+00:00</updated-at>
      <user-id type="integer">72621</user-id>
      <version type="integer">13</version>
      <user-name>Tiago Fernandes</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;a href=&quot;http://www.sinomart.com/wholesale-Animal-Paintings_c167&quot;&gt;Wholesale Animal Paintings&lt;/a&gt; and &lt;a href=&quot;http://www.sinomart.com/wholesale-Still-Life-Paintings_c168&quot;&gt;Wholesale Still Life Paintings&lt;/a&gt; are available now,you can choose all kinds of &lt;a href=&quot;http://www.sinomart.com/wholesale-Animal-Paintings_c167&quot;&gt;Animal Paintngs online&lt;/a&gt; and &lt;a href=&quot;http://www.sinomart.com/wholesale-Still-Life-Paintings_c168&quot;&gt;Still Life Paintings online&lt;/a&gt;.And we will supply you the best service.
Except this,our Sinomart have &lt;a href=&quot;http://www.sinomart.com/wholesale-Hiphone_c18&quot;&gt;Wholesale Hiphone&lt;/a&gt; and &lt;a href=&quot;http://www.sinomart.com/wholesale-Accessories_c19&quot;&gt;Wholesale Accessories&lt;/a&gt;,also you can order 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Hiphone_c18&quot;&gt;Hiphone online&lt;/a&gt; and 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Accessories_c19&quot;&gt;Accessories online&lt;/a&gt;.In the meanwhile,the cellphones has many style,such as &lt;a href=&quot;http://www.sinomart.com/wholesale-Multi-Function-Cell-Phones_c22&quot;&gt;wholesale Multi Function Cell Phones&lt;/a&gt;, 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Bar-Phone_c23&quot;&gt;wholesale Bar Phone&lt;/a&gt;, 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Slide-Phone_c24&quot;&gt;wholesale Slide Phone&lt;/a&gt;, 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Flip-Phone_c25&quot;&gt;wholesale Flip Phone&lt;/a&gt; and so on.Every kinds of these cellphones you can get just through your credit card.In other words,only move your finger you can get any one you want,because 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Multi-Function-Cell-Phones_c22&quot;&gt;Multi Function Cell Phones online&lt;/a&gt;, 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Bar-Phone_c23&quot;&gt;Bar Phone online&lt;/a&gt;,and the 
&lt;a href=&quot;http://www.sinomart.com/wholesale-Slide-Phone_c24&quot;&gt;Slide Phone online&lt;/a&gt; too.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://www.sinomart.com/wholesale-Animal-Paintings_c167&quot;&gt;Wholesale
Animal Paintings&lt;/a&gt; and &lt;a href=
&quot;http://www.sinomart.com/wholesale-Still-Life-Paintings_c168&quot;&gt;Wholesale
Still Life Paintings&lt;/a&gt; are available now,you can choose all kinds
of &lt;a href=
&quot;http://www.sinomart.com/wholesale-Animal-Paintings_c167&quot;&gt;Animal
Paintngs online&lt;/a&gt; and &lt;a href=
&quot;http://www.sinomart.com/wholesale-Still-Life-Paintings_c168&quot;&gt;Still
Life Paintings online&lt;/a&gt;.And we will supply you the best
service.&lt;br&gt;
Except this,our Sinomart have &lt;a href=
&quot;http://www.sinomart.com/wholesale-Hiphone_c18&quot;&gt;Wholesale
Hiphone&lt;/a&gt; and &lt;a href=
&quot;http://www.sinomart.com/wholesale-Accessories_c19&quot;&gt;Wholesale
Accessories&lt;/a&gt;,also you can order&lt;br&gt;
&lt;a href=&quot;http://www.sinomart.com/wholesale-Hiphone_c18&quot;&gt;Hiphone
online&lt;/a&gt; and&lt;br&gt;
&lt;a href=
&quot;http://www.sinomart.com/wholesale-Accessories_c19&quot;&gt;Accessories
online&lt;/a&gt;.In the meanwhile,the cellphones has many style,such as
&lt;a href=
&quot;http://www.sinomart.com/wholesale-Multi-Function-Cell-Phones_c22&quot;&gt;wholesale
Multi Function Cell Phones&lt;/a&gt;,&lt;br&gt;
&lt;a href=&quot;http://www.sinomart.com/wholesale-Bar-Phone_c23&quot;&gt;wholesale
Bar Phone&lt;/a&gt;,&lt;br&gt;
&lt;a href=
&quot;http://www.sinomart.com/wholesale-Slide-Phone_c24&quot;&gt;wholesale Slide
Phone&lt;/a&gt;,&lt;br&gt;
&lt;a href=
&quot;http://www.sinomart.com/wholesale-Flip-Phone_c25&quot;&gt;wholesale Flip
Phone&lt;/a&gt; and so on.Every kinds of these cellphones you can get
just through your credit card.In other words,only move your finger
you can get any one you want,because&lt;br&gt;
&lt;a href=
&quot;http://www.sinomart.com/wholesale-Multi-Function-Cell-Phones_c22&quot;&gt;Multi
Function Cell Phones online&lt;/a&gt;,&lt;br&gt;
&lt;a href=&quot;http://www.sinomart.com/wholesale-Bar-Phone_c23&quot;&gt;Bar Phone
online&lt;/a&gt;,and the&lt;br&gt;
&lt;a href=&quot;http://www.sinomart.com/wholesale-Slide-Phone_c24&quot;&gt;Slide
Phone online&lt;/a&gt; too.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-06T08:03:23+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-01-13T01:18:32+00:00</updated-at>
      <user-id type="integer">131447</user-id>
      <version type="integer">14</version>
      <user-name>cheap wholesale products</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This bug comes form commit - we should always cast the value based on the column 	October 11, 2010 when  calculations type casts was changed.

in module Calculations method:

    def type_cast_calculated_value(value, column, operation = nil)
      if value.is_a?(String) || value.nil?
        case operation
          when 'count' then value.to_i
          when 'sum' then type_cast_using_column(value || '0', column)
          when 'average' then value.try(:to_d)
          else type_cast_using_column(value, column)
        end
      else
        value
      end
    end

was changed to:

def type_cast_calculated_value(value, column, operation = nil)
      if value.is_a?(String) || value.nil?
        case operation
          when 'count' then value.to_i
          when 'sum' then type_cast_using_column(value || '0', column)
          when 'average' then value.try(:to_d)
          else type_cast_using_column(value, column)
        end
      else
        type_cast_using_column(value, column)
      end
    end

new method is not working any more as described in documentation for Calculate method (AVG should return Float)</body>
      <body-html>&lt;div&gt;&lt;p&gt;This bug comes form commit - we should always cast the value
based on the column October 11, 2010 when calculations type casts
was changed.&lt;/p&gt;
&lt;p&gt;in module Calculations method:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def type_cast_calculated_value(value, column, operation = nil)
  if value.is_a?(String) || value.nil?
    case operation
      when 'count' then value.to_i
      when 'sum' then type_cast_using_column(value || '0', column)
      when 'average' then value.try(:to_d)
      else type_cast_using_column(value, column)
    end
  else
    value
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;was changed to:&lt;/p&gt;
&lt;p&gt;def type_cast_calculated_value(value, column, operation =
nil)&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;  if value.is_a?(String) || value.nil?
    case operation
      when 'count' then value.to_i
      when 'sum' then type_cast_using_column(value || '0', column)
      when 'average' then value.try(:to_d)
      else type_cast_using_column(value, column)
    end
  else
    type_cast_using_column(value, column)
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;new method is not working any more as described in documentation
for Calculate method (AVG should return Float)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-10T14:01:12+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-01-10T14:01:24+00:00</updated-at>
      <user-id type="integer">14386</user-id>
      <version type="integer">15</version>
      <user-name>Janis Vitums</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I created pull request with fix for this issue

https://github.com/rails/rails/pull/160</body>
      <body-html>&lt;div&gt;&lt;p&gt;I created pull request with fix for this issue&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;https://github.com/rails/rails/pull/160&quot;&gt;https://github.com/rails/rails/pull/160&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-10T17:10:59+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-01-10T17:11:15+00:00</updated-at>
      <user-id type="integer">3839</user-id>
      <version type="integer">16</version>
      <user-name>Raimonds Simanovskis</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue can be closed as it is already in master</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue can be closed as it is already in master&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-09T23:12:03+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-02-09T23:12:19+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">17</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-10T12:21:55+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-02-10T12:22:13+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">18</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Good &lt;a href=http://www.sale-puma.com&gt;Puma shoes sale&lt;/a&gt; information for &lt;a href=http://www.sale-puma.com&gt;Puma shoes&lt;/a&gt; fans: Yesterday, German sportswear maker Cheap Running Shoes purchased effectively lot of money Brands. The transaction entails the Cobra brand, too as linked inventory, intellectual house and endorsement contracts. It also helps make &lt;a href=http://www.sale-puma.com&gt;puma speed cat&lt;/a&gt; Shoes . They provide you with the utmost game and support all through the feet.You can happen around several types of basketball sneakers such as high-top,low-top and mid-top.The &lt;a href=http://www.sale-puma.com&gt;Puma shoes online&lt;/a&gt; and boots give you best ankle support will support want you to obtain steadiness.
As we konw,Trail &lt;a href=http://www.sale-puma.com&gt;Puma Drift Cat&lt;/a&gt; Shoes black, Trail &lt;a href=http://www.sale-puma.com&gt;Puma future cat&lt;/a&gt; ShoesWhite Black? 50 many years backshore are actually released within a great accomplishment. Trail Running Shoes speed cat shoes?go in add-on to King Pele into planet tournament finals, bottom tennis discs matchrs within pasture inhabit an vital area in hold out in Wimbledon Dun; Its working firms have premier manufacturers and major marketplace positions in distilled spirits, residence and security, and golf products. The reply go all through the &lt;a href=http://www.sale-puma.com&gt;Cheap puma shoes&lt;/a&gt; on sale-here you are able to happen around several distcoun.&lt;a href=http://www.sale-puma.com&gt;puma shoes on sale &lt;/a&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Good &lt;a href=&quot;http:&quot;&gt;Puma shoes sale information for &lt;a href=
&quot;http:&quot;&gt;Puma shoes fans: Yesterday, German sportswear maker Cheap
Running Shoes purchased effectively lot of money Brands. The
transaction entails the Cobra brand, too as linked inventory,
intellectual house and endorsement contracts. It also helps make
&lt;a href=&quot;http:&quot;&gt;puma speed cat Shoes . They provide you with the
utmost game and support all through the feet.You can happen around
several types of basketball sneakers such as high-top,low-top and
mid-top.The &lt;a href=&quot;http:&quot;&gt;Puma shoes online and boots give you
best ankle support will support want you to obtain steadiness.&lt;br&gt;
As we konw,Trail &lt;a href=&quot;http:&quot;&gt;Puma Drift Cat Shoes black, Trail
&lt;a href=&quot;http:&quot;&gt;Puma future cat ShoesWhite Black? 50 many years
backshore are actually released within a great accomplishment.
Trail Running Shoes speed cat shoes?go in add-on to King Pele into
planet tournament finals, bottom tennis discs matchrs within
pasture inhabit an vital area in hold out in Wimbledon Dun; Its
working firms have premier manufacturers and major marketplace
positions in distilled spirits, residence and security, and golf
products. The reply go all through the &lt;a href=&quot;http:&quot;&gt;Cheap puma
shoes on sale-here you are able to happen around several
distcoun.&lt;a href=&quot;http:&quot;&gt;puma shoes on sale .&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-17T06:08:31+00:00</created-at>
      <creator-id type="integer">77317</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6103</number>
      <permalink>average-returns-integer-values-instead-of-decimals</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activerecord aggregations &quot;rails 3.0.3&quot; rails3</tag>
      <title>average() returns integer values instead of decimals</title>
      <updated-at type="datetime">2011-02-17T06:48:11+00:00</updated-at>
      <user-id type="integer">137442</user-id>
      <version type="integer">19</version>
      <user-name>gfh</user-name>
      <creator-name>Andreas Mayer</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6103</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
