<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-03-25T13:19:37+00:00</created-at>
  <creator-id type="integer">9435</creator-id>
  <milestone-due-on type="datetime">2010-01-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">50064</milestone-id>
  <number type="integer">2338</number>
  <permalink>actionmailer-mailer-views-and-content-type</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>duplicate</state>
  <tag>2-3-stable actionmailer layout multipart</tag>
  <title>ActionMailer Mailer Views and Content Type</title>
  <updated-at type="datetime">2010-10-21T20:56:54+01:00</updated-at>
  <user-id type="integer">121198</user-id>
  <version type="integer">28</version>
  <user-name>jnimety</user-name>
  <creator-name>Vidal Graupera</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
  <milestone-title>2.3.6</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>I upgraded from Rails 2.2 to 2.3.2.

I have mailer views, e.g. message.text.html.erb and message.text.plain.erb. Before, this use to automatically pick up both and set the content type correctly per the documentation at http://guides.rubyonrails.org/action_mailer_basics.html.

Now, it is rendering the HTML .text.html.erb but setting Content-Type: text/plain. This results in emails that show all the html markup in the display.

To get this to work now, I have to set 

    content_type &quot;text/html&quot;

in the methods in my UserMailer class. Did not need to do this before.

Did something change between previous versions of rails and 2.3, or is this broken in 2.3?

Thanks</original-body>
  <latest-body>I upgraded from Rails 2.2 to 2.3.2.

I have mailer views, e.g. message.text.html.erb and message.text.plain.erb. Before, this use to automatically pick up both and set the content type correctly per the documentation at http://guides.rubyonrails.org/action_mailer_basics.html.

Now, it is rendering the HTML .text.html.erb but setting Content-Type: text/plain. This results in emails that show all the html markup in the display.

To get this to work now, I have to set 

    content_type &quot;text/html&quot;

in the methods in my UserMailer class. Did not need to do this before.

Did something change between previous versions of rails and 2.3, or is this broken in 2.3?

Thanks</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I upgraded from Rails 2.2 to 2.3.2.&lt;/p&gt;
&lt;p&gt;I have mailer views, e.g. message.text.html.erb and
message.text.plain.erb. Before, this use to automatically pick up
both and set the content type correctly per the documentation at
&lt;a href=&quot;http://guides.rubyonrails.org/action_mailer_basics.html.%3C/p&quot;&gt;http://guides.rubyonrails.org/ac...&lt;/a&gt;&amp;gt;&lt;/p&gt;
&lt;p&gt;Now, it is rendering the HTML .text.html.erb but setting
Content-Type: text/plain. This results in emails that show all the
html markup in the display.&lt;/p&gt;
&lt;p&gt;To get this to work now, I have to set&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;content_type &quot;text/html&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;in the methods in my UserMailer class. Did not need to do this
before.&lt;/p&gt;
&lt;p&gt;Did something change between previous versions of rails and 2.3,
or is this broken in 2.3?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I upgraded from Rails 2.2 to 2.3.2.

I have mailer views, e.g. message.text.html.erb and message.text.plain.erb. Before, this use to automatically pick up both and set the content type correctly per the documentation at http://guides.rubyonrails.org/action_mailer_basics.html.

Now, it is rendering the HTML .text.html.erb but setting Content-Type: text/plain. This results in emails that show all the html markup in the display.

To get this to work now, I have to set 

    content_type &quot;text/html&quot;

in the methods in my UserMailer class. Did not need to do this before.

Did something change between previous versions of rails and 2.3, or is this broken in 2.3?

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;I upgraded from Rails 2.2 to 2.3.2.&lt;/p&gt;
&lt;p&gt;I have mailer views, e.g. message.text.html.erb and
message.text.plain.erb. Before, this use to automatically pick up
both and set the content type correctly per the documentation at
&lt;a href=&quot;http://guides.rubyonrails.org/action_mailer_basics.html.%3C/p&quot;&gt;http://guides.rubyonrails.org/ac...&lt;/a&gt;&amp;gt;&lt;/p&gt;
&lt;p&gt;Now, it is rendering the HTML .text.html.erb but setting
Content-Type: text/plain. This results in emails that show all the
html markup in the display.&lt;/p&gt;
&lt;p&gt;To get this to work now, I have to set&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;content_type &quot;text/html&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;in the methods in my UserMailer class. Did not need to do this
before.&lt;/p&gt;
&lt;p&gt;Did something change between previous versions of rails and 2.3,
or is this broken in 2.3?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-25T13:19:37+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-03-25T13:19:38+00:00</updated-at>
      <user-id type="integer">9435</user-id>
      <version type="integer">1</version>
      <user-name>Vidal Graupera</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi Vidal,

is this still a problem on master (past v2.3.2.1 tag)?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Vidal,&lt;/p&gt;
&lt;p&gt;is this still a problem on master (past v2.3.2.1 tag)?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-25T16:28:17+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-03-25T16:28:20+00:00</updated-at>
      <user-id type="integer">46643</user-id>
      <version type="integer">2</version>
      <user-name>thedarkone</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'll just chime in and mention that I've been fighting some issues with implicit multipart email, layouts, and content type.  I'm seeing the *.text.html.erb layout being used for the &quot;text/plain&quot; part.  Issue seems to be around ActionView::PathSet#find_template returning the wrong template when called for format :text.

Strangely, the problem only occurs in a staging environment -- everything works as expected in my dev environment.

I'm using v2.3.2.1 tag.

If I can get a repro, I'll update here and/or file a new ticket.

- Blake</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'll just chime in and mention that I've been fighting some
issues with implicit multipart email, layouts, and content type.
I'm seeing the *.text.html.erb layout being used for the
&quot;text/plain&quot; part. Issue seems to be around
ActionView::PathSet#find_template returning the wrong template when
called for format :text.&lt;/p&gt;
&lt;p&gt;Strangely, the problem only occurs in a staging environment --
everything works as expected in my dev environment.&lt;/p&gt;
&lt;p&gt;I'm using v2.3.2.1 tag.&lt;/p&gt;
&lt;p&gt;If I can get a repro, I'll update here and/or file a new
ticket.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Blake&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-26T00:59:43+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-03-26T00:59:47+00:00</updated-at>
      <user-id type="integer">51934</user-id>
      <version type="integer">3</version>
      <user-name>Blake Carlson</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm also seeing this problem... and also strangely only in our production environment.

Even weirder is this:  In our production environemnt, the mailer is creating proper multipart emails when I trigger them using a rake task, but when they are fired off by our background workling process... I get the text/plain problem.

Still trying to diagnose.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm also seeing this problem... and also strangely only in our
production environment.&lt;/p&gt;
&lt;p&gt;Even weirder is this: In our production environemnt, the mailer
is creating proper multipart emails when I trigger them using a
rake task, but when they are fired off by our background workling
process... I get the text/plain problem.&lt;/p&gt;
&lt;p&gt;Still trying to diagnose.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-19T01:44:47+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-04-19T01:44:52+01:00</updated-at>
      <user-id type="integer">26425</user-id>
      <version type="integer">4</version>
      <user-name>Joshua Krall</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Update:
I can get my emails to use the text/html content-type, by ensuring that my emailing process runs with the current directory set to RAILS_ROOT.

Now... however, I'm seeing the same problem as Blake.  My emails are coming through with 2 parts:  my HTML layout as text/html, and my HTML layout as text/plain.

(...despite having a .text.plain.erb layout in /layouts)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Update: I can get my emails to use the text/html content-type,
by ensuring that my emailing process runs with the current
directory set to RAILS_ROOT.&lt;/p&gt;
&lt;p&gt;Now... however, I'm seeing the same problem as Blake. My emails
are coming through with 2 parts: my HTML layout as text/html, and
my HTML layout as text/plain.&lt;/p&gt;
&lt;p&gt;(...despite having a .text.plain.erb layout in /layouts)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-19T04:40:48+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-04-19T04:40:50+01:00</updated-at>
      <user-id type="integer">26425</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Krall</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>OK... I tracked this down for me at least.  Unfortunately, I don't have time to check out rails, run the tests, and submit a proper patch.

To get this working for me... I modified ActionMailer::Base#default_template_format as follows:
@@@ ruby
def default_template_format
   if @current_template_content_type
      @current_template_content_type.sub('/','.')          
      # Mime::Type.lookup(@current_template_content_type).to_sym
   else
      :html
   end
end
@@@

As best I can tell, the problem is that the Mime::Type.lookup returns :text for &quot;text/plain&quot;.  Unfortunately, the template loading code maps paths such as:
@@@
layouts/my_mailer.text.html.erb
layouts/my_mailer.text.html
layouts/my_mailer.text
layouts/my_mailer.html
@@@
for template.paths like: layouts/my_mailer.text.html.erb

So, the my_mailer.text mapping is created for :html as well as :text.  When the Mime::Type method is used, the :text symbol is not sufficient to distinguish the text.plain template from text.html.

I'm not sure what the purpose of Mime::Type.lookup is... but my fix seems to work for me anyway.</body>
      <body-html>&lt;div&gt;&lt;p&gt;OK... I tracked this down for me at least. Unfortunately, I
don't have time to check out rails, run the tests, and submit a
proper patch.&lt;/p&gt;
&lt;p&gt;To get this working for me... I modified
ActionMailer::Base#default_template_format as follows:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
def default_template_format
   if @current_template_content_type
      @current_template_content_type.sub('/','.')          
      # Mime::Type.lookup(@current_template_content_type).to_sym
   else
      :html
   end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As best I can tell, the problem is that the Mime::Type.lookup
returns :text for &quot;text/plain&quot;. Unfortunately, the template loading
code maps paths such as:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
layouts/my_mailer.text.html.erb
layouts/my_mailer.text.html
layouts/my_mailer.text
layouts/my_mailer.html
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;for template.paths like: layouts/my_mailer.text.html.erb&lt;/p&gt;
&lt;p&gt;So, the my_mailer.text mapping is created for :html as well as
:text. When the Mime::Type method is used, the :text symbol is not
sufficient to distinguish the text.plain template from
text.html.&lt;/p&gt;
&lt;p&gt;I'm not sure what the purpose of Mime::Type.lookup is... but my
fix seems to work for me anyway.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-19T08:20:27+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-04-19T08:20:32+01:00</updated-at>
      <user-id type="integer">26425</user-id>
      <version type="integer">6</version>
      <user-name>Joshua Krall</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>OK... here's a patch.  It should apply on top of the 2-3-stable branch.

Note: All mailer tests pass, but in order to do so, I had to change the &quot;autolayout&quot; layouts so that they were named according to the docs here: http://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-layouts

They were named like this:
@@@
layouts/auto_layout_mailer.html.erb
layouts/auto_layout_mailer.text.erb
@@@
And I changed them to:
@@@
layouts/auto_layout_mailer.text.html.erb
layouts/auto_layout_mailer.text.plain.erb
@@@

I'm not sure what implication this has for backwards compatibility... so this is up for discussion.  But, it seems more consistent to me, and it has the bonus feature of conforming to the official rails docs :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;OK... here's a patch. It should apply on top of the 2-3-stable
branch.&lt;/p&gt;
&lt;p&gt;Note: All mailer tests pass, but in order to do so, I had to
change the &quot;autolayout&quot; layouts so that they were named according
to the docs here: &lt;a href=&quot;http://guides.rubyonrails.org/action_mailer_basics.html#action-mailer-layouts&quot;&gt;
http://guides.rubyonrails.org/ac...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;They were named like this:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
layouts/auto_layout_mailer.html.erb
layouts/auto_layout_mailer.text.erb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And I changed them to:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
layouts/auto_layout_mailer.text.html.erb
layouts/auto_layout_mailer.text.plain.erb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I'm not sure what implication this has for backwards
compatibility... so this is up for discussion. But, it seems more
consistent to me, and it has the bonus feature of conforming to the
official rails docs :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-19T11:23:17+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-04-19T11:23:20+01:00</updated-at>
      <user-id type="integer">26425</user-id>
      <version type="integer">7</version>
      <user-name>Joshua Krall</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looks like this is because ActionMailer::Base uses #template_path to build the list of templates to render. This interpolates an ActionView::Template::Path, which calls #to_s, which turns the path relative (instead of absolute) if RAILS_ROOT is defined. If you're like us and have mailer jobs run from cron, this relative path probably doesn't mean much to Dir.glob, and ActionMailer can't find its templates. 

The attached patch changes template_path to use Path#to_str instead of #to_s, which fixed our problem by making template_path return an absolute path.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks like this is because ActionMailer::Base uses
#template_path to build the list of templates to render. This
interpolates an ActionView::Template::Path, which calls #to_s,
which turns the path relative (instead of absolute) if RAILS_ROOT
is defined. If you're like us and have mailer jobs run from cron,
this relative path probably doesn't mean much to Dir.glob, and
ActionMailer can't find its templates.&lt;/p&gt;
&lt;p&gt;The attached patch changes template_path to use Path#to_str
instead of #to_s, which fixed our problem by making template_path
return an absolute path.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-13T22:14:58+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-05-13T22:15:03+01:00</updated-at>
      <user-id type="integer">31194</user-id>
      <version type="integer">8</version>
      <user-name>Justin Weiss</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Justin, I posted a similar patch in #2263 more than a month ago. Good luck :).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Justin, I posted a similar patch in &lt;a href=
&quot;/projects/8994/tickets/2263&quot; title=&quot;Ticket #2263&quot;&gt;#2263&lt;/a&gt; more
than a month ago. Good luck :).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-14T08:11:27+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-05-14T08:11:32+01:00</updated-at>
      <user-id type="integer">46643</user-id>
      <version type="integer">9</version>
      <user-name>thedarkone</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I am so glad I found this!  I thought I was losing my mind!  I am having the exact same problem, but ONLY when the emails are generated from Workling on my production server.  The HTML template is used to populate a single-part plain text email.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am so glad I found this! I thought I was losing my mind! I am
having the exact same problem, but ONLY when the emails are
generated from Workling on my production server. The HTML template
is used to populate a single-part plain text email.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-20T23:28:00+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-05-20T23:28:02+01:00</updated-at>
      <user-id type="integer">5867</user-id>
      <version type="integer">10</version>
      <user-name>Tom</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Justin, thanks for the patch. It solved my problem where emails didn't work right when sent from Workling.

The question now is whether this will make it into Rails 2.3.3.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Justin, thanks for the patch. It solved my problem where emails
didn't work right when sent from Workling.&lt;/p&gt;
&lt;p&gt;The question now is whether this will make it into Rails
2.3.3.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-21T17:57:07+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-05-21T17:57:08+01:00</updated-at>
      <user-id type="integer">16797</user-id>
      <version type="integer">11</version>
      <user-name>gobigdave</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>On a Rails 2.3.3 ActionMailer test application I have the same problem if I try to run the test not on the RAILS_ROOT dir, but works if I run the test from the RAILS_ROOT dir:

http://github.com/fguillen/ActionMailerTest

@@@ bash
ActionMailerTest $ ruby test/unit/mailer_test.rb -n test_wadus_mail
Loaded suite test/unit/mailer_test
Started
.
Finished in 0.16397 seconds.

1 tests, 2 assertions, 0 failures, 0 errors


ActionMailerTest $ cd test/unit/
ActionMailerTest/test/unit $ ruby mailer_test.rb -n test_wadus_mail
Loaded suite mailer_test
Started
F
Finished in 0.445245 seconds.

  1) Failure:
test_wadus_mail(MailerTest) [mailer_test.rb:6]:
&lt;&quot;multipart/alternative&quot;&gt; expected but was
&lt;&quot;text/plain&quot;&gt;.

1 tests, 1 assertions, 1 failures, 0 errors
@@@

I think this is because the test fails when I try to run it with Texmate Ctrl+R bundle.</body>
      <body-html>&lt;div&gt;&lt;p&gt;On a Rails 2.3.3 ActionMailer test application I have the same
problem if I try to run the test not on the RAILS_ROOT dir, but
works if I run the test from the RAILS_ROOT dir:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/fguillen/ActionMailerTest&quot;&gt;http://github.com/fguillen/ActionMailerTest&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;bash&quot;&gt;ActionMailerTest $ ruby test/unit/mailer_test.rb -n test_wadus_mail
Loaded suite test/unit/mailer_test
Started
.
Finished in 0.16397 seconds.

1 tests, 2 assertions, 0 failures, 0 errors


ActionMailerTest $ cd test/unit/
ActionMailerTest/test/unit $ ruby mailer_test.rb -n test_wadus_mail
Loaded suite mailer_test
Started
F
Finished in 0.445245 seconds.

  1) Failure:
test_wadus_mail(MailerTest) [mailer_test.rb:6]:
&amp;lt;&quot;multipart/alternative&quot;&amp;gt; expected but was
&amp;lt;&quot;text/plain&quot;&amp;gt;.

1 tests, 1 assertions, 1 failures, 0 errors&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I think this is because the test fails when I try to run it with
Texmate Ctrl+R bundle.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-31T10:08:37+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2-3-stable actionmailer layout multipart
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-07-31T10:08:41+01:00</updated-at>
      <user-id type="integer">23794</user-id>
      <version type="integer">12</version>
      <user-name>Fernando Guillen</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-03T05:59:32+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-08-03T05:59:34+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">13</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.4</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Justin's patch does solves the problem. But shouldn't be .to_s return the same result as to_str? Sounds like a source for future bugs to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Justin's patch does solves the problem. But shouldn't be .to_s
return the same result as to_str? Sounds like a source for future
bugs to me.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-07T15:52:44+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-08-07T15:52:48+01:00</updated-at>
      <user-id type="integer">18453</user-id>
      <version type="integer">14</version>
      <user-name>iGEL</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.4</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Experiencing the same bug in 2.3.2, but it only happens sometimes, a situation making me mad since I send over 200.000 emailings a week and I sometimes have to restart the rails application to make the template detection work !!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Experiencing the same bug in 2.3.2, but it only happens
sometimes, a situation making me mad since I send over 200.000
emailings a week and I sometimes have to restart the rails
application to make the template detection work !!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-05T14:11:11+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-09-05T14:11:16+01:00</updated-at>
      <user-id type="integer">14415</user-id>
      <version type="integer">15</version>
      <user-name>J&#233;r&#244;me</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.4</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[milestone:id#50064 bulk edit command]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[milestone:id#50064 bulk edit command]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-11T23:04:35+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 41987
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-09-11T23:04:35+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've had this problem for quite some time now. Thanks everyone for putting in the work to figure it all out. I hope it gets stomped out for 2.3.5. Seems like such a huge bug, I'm not sure how there couldn't have been tests for it :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've had this problem for quite some time now. Thanks everyone
for putting in the work to figure it all out. I hope it gets
stomped out for 2.3.5. Seems like such a huge bug, I'm not sure how
there couldn't have been tests for it :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-15T09:34:11+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-09-15T09:34:19+01:00</updated-at>
      <user-id type="integer">34659</user-id>
      <version type="integer">17</version>
      <user-name>Brendon</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Just thought I'd add, I tried the patch above and HTML emails still get sent as plaintext.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just thought I'd add, I tried the patch above and HTML emails
still get sent as plaintext.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-15T09:51:53+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-09-15T09:51:56+01:00</updated-at>
      <user-id type="integer">34659</user-id>
      <version type="integer">18</version>
      <user-name>Brendon</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>FYI, I upgraded to 2.3.5 and these problem persist. Please fix in 2.3.6 as this has been open a long time. Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;FYI, I upgraded to 2.3.5 and these problem persist. Please fix
in 2.3.6 as this has been open a long time. Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-08T06:26:19+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2009-12-08T06:26:20+00:00</updated-at>
      <user-id type="integer">9435</user-id>
      <version type="integer">19</version>
      <user-name>Vidal Graupera</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I agree, this bug has been around for a long time. And I would think it'd affect a whole lot of people? I've been holding off deploying until a fix arrives but have given up. Just in case anyone wants to get their setup going again, it's actually pretty easy to just explicitly declare the different templates like so:

    content_type    &quot;multipart/alternative&quot;

    part &quot;text/plain&quot; do |p|
      p.body = render_message(&quot;invoice.text.plain&quot;, :order =&gt; order)
    end

    part :content_type =&gt; &quot;text/html&quot;,
      :body =&gt; render_message(&quot;invoice.text.html&quot;, :order =&gt; order)

So instead of having your body hash as an option, you just pass that hash into each of the render_message functions. Make sure you put the HTML one last if you want to show that one by default in an email client.

By the way, I appreciate all the hard work the team members are putting to Rails 3 and know that that is their number one priority :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree, this bug has been around for a long time. And I would
think it'd affect a whole lot of people? I've been holding off
deploying until a fix arrives but have given up. Just in case
anyone wants to get their setup going again, it's actually pretty
easy to just explicitly declare the different templates like
so:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;content_type    &quot;multipart/alternative&quot;

part &quot;text/plain&quot; do |p|
  p.body = render_message(&quot;invoice.text.plain&quot;, :order =&amp;gt; order)
end

part :content_type =&amp;gt; &quot;text/html&quot;,
  :body =&amp;gt; render_message(&quot;invoice.text.html&quot;, :order =&amp;gt; order)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So instead of having your body hash as an option, you just pass
that hash into each of the render_message functions. Make sure you
put the HTML one last if you want to show that one by default in an
email client.&lt;/p&gt;
&lt;p&gt;By the way, I appreciate all the hard work the team members are
putting to Rails 3 and know that that is their number one priority
:)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-13T03:45:41+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-3 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-01-13T03:45:43+00:00</updated-at>
      <user-id type="integer">34659</user-id>
      <version type="integer">20</version>
      <user-name>Brendon</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Yike, just now found out about this bug, too (upgraded from 2.1.x to 2.3.5 a while ago but only now a user emailed me about it).  Quite unfortunate to have to experience and see this (perhaps regression tests, or lack thereof, on this failed?).  When people ask me these days what I dislike about RoR, this inconsistency/breakage across versions without warning (i.e. not mentioned at all in the release note) is a main one.  Thanks for fixing.  But hope that the community can help better the practice of not breaking or at least warn developers about inconsistency/difference in design/assumption in the version release note if the breakage/inconsistency is intentional.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yike, just now found out about this bug, too (upgraded from
2.1.x to 2.3.5 a while ago but only now a user emailed me about
it). Quite unfortunate to have to experience and see this (perhaps
regression tests, or lack thereof, on this failed?). When people
ask me these days what I dislike about RoR, this
inconsistency/breakage across versions without warning (i.e. not
mentioned at all in the release note) is a main one. Thanks for
fixing. But hope that the community can help better the practice of
not breaking or at least warn developers about
inconsistency/difference in design/assumption in the version
release note if the breakage/inconsistency is intentional.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-13T06:44:03+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2-3-3 actionmailer layout multipart
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-01-13T06:44:05+00:00</updated-at>
      <user-id type="integer">52811</user-id>
      <version type="integer">21</version>
      <user-name>tsailipu</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Guys, we have two patches, but we cannot ensure that the problem won't come back again, because they don't have tests. If someone attach a patch with tests, I will apply it and try to solve the problem ASAP.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Guys, we have two patches, but we cannot ensure that the problem
won't come back again, because they don't have tests. If someone
attach a patch with tests, I will apply it and try to solve the
problem ASAP.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-13T08:03:32+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-01-13T08:03:37+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">22</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Duplicate of #2263.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Duplicate of &lt;a href=&quot;/projects/8994/tickets/2263&quot; title=
&quot;Ticket #2263&quot;&gt;#2263&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-03-19T23:55:02+00:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-03-19T23:55:06+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">23</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>We're in the process of evaluating 2.3.8 (still on 2.3.2 in production) and Joshua's monkeypatch for default_template_format is still needed to properly send implicit multi-part emails.

This doesn't appear to be resolved.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We're in the process of evaluating 2.3.8 (still on 2.3.2 in
production) and Joshua's monkeypatch for default_template_format is
still needed to properly send implicit multi-part emails.&lt;/p&gt;
&lt;p&gt;This doesn't appear to be resolved.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-01T19:48:09+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-07-01T19:48:22+01:00</updated-at>
      <user-id type="integer">105462</user-id>
      <version type="integer">24</version>
      <user-name>Zack Hubert</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm on 2.3.8 and still experiencing this. Why hasn't this been patched yet in trunk? Super annoying.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm on 2.3.8 and still experiencing this. Why hasn't this been
patched yet in trunk? Super annoying.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-09-12T01:11:49+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2 actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-09-12T01:11:51+01:00</updated-at>
      <user-id type="integer">25075</user-id>
      <version type="integer">25</version>
      <user-name>subimage</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-16T23:37:36+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2 actionmailer layout multipart
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-10-16T23:37:42+01:00</updated-at>
      <user-id type="integer">81551</user-id>
      <version type="integer">26</version>
      <user-name>Andrea Campi</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've been able to reproduce this bug on 2.3.10, using delayed_job to deliver a multipart email.

 1. start delayed_job from Rails.root
 1. schedule an email delivery via delayed job.  wait for delayed_job to process and verify that the email is delivered as multipart/alternative
 1. move/rename your Rails.root directory
 1. schedule an email delivery via delayed job.  wait for delayed_job to process.  When testing in development I receive a template missing error, when testing in production the email is delivered as text/plain, using the html template as the body.

I'm guessing that the email is still delivered in production because the multipart templates are cached.  However, the code that determines the mimetype looks for files on disk, doesn't find anything, and defaults to text/plain.  I don't know enough about ActionMailer internals to know if this is a correct assessment.  Should create! check the cache when searching for templates to add to @parts?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've been able to reproduce this bug on 2.3.10, using
delayed_job to deliver a multipart email.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;start delayed_job from Rails.root&lt;/li&gt;
&lt;li&gt;schedule an email delivery via delayed job. wait for
delayed_job to process and verify that the email is delivered as
multipart/alternative&lt;/li&gt;
&lt;li&gt;move/rename your Rails.root directory&lt;/li&gt;
&lt;li&gt;schedule an email delivery via delayed job. wait for
delayed_job to process. When testing in development I receive a
template missing error, when testing in production the email is
delivered as text/plain, using the html template as the body.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I'm guessing that the email is still delivered in production
because the multipart templates are cached. However, the code that
determines the mimetype looks for files on disk, doesn't find
anything, and defaults to text/plain. I don't know enough about
ActionMailer internals to know if this is a correct assessment.
Should create! check the cache when searching for templates to add
to @parts?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-21T20:08:02+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-10-21T20:08:11+01:00</updated-at>
      <user-id type="integer">121198</user-id>
      <version type="integer">27</version>
      <user-name>jnimety</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I forgot to mention that we use Capistrano for deployment on production.  I believe when Capistrano recreates symlinks to point to the current release that it is causing a situation similar to my above steps.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I forgot to mention that we use Capistrano for deployment on
production. I believe when Capistrano recreates symlinks to point
to the current release that it is causing a situation similar to my
above steps.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-21T20:56:47+01:00</created-at>
      <creator-id type="integer">9435</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">2338</number>
      <permalink>actionmailer-mailer-views-and-content-type</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>2-3-stable actionmailer layout multipart</tag>
      <title>ActionMailer Mailer Views and Content Type</title>
      <updated-at type="datetime">2010-10-21T20:56:54+01:00</updated-at>
      <user-id type="integer">121198</user-id>
      <version type="integer">28</version>
      <user-name>jnimety</user-name>
      <creator-name>Vidal Graupera</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2338</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>640b3c367e2d9caa8b26df970386e98462d8ea01</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-04-19T11:23:17+01:00</created-at>
      <filename>fix-multipart-layouts.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">112728</id>
      <size type="integer">3010</size>
      <uploader-id type="integer">26425</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/112728/fix-multipart-layouts.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>b5cdf80a56fc0ed898139a173988130790411f26</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-05-13T22:14:58+01:00</created-at>
      <filename>0001-Modified-ActionMailer-Base-to-use-an-absolute-path-t.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">122282</id>
      <size type="integer">814</size>
      <uploader-id type="integer">31194</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/122282/0001-Modified-ActionMailer-Base-to-use-an-absolute-path-t.patch</url>
    </attachment>
  </attachments>
</ticket>
