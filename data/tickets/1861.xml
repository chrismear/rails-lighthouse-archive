<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-03T16:49:20+00:00</created-at>
  <creator-id type="integer">19954</creator-id>
  <milestone-due-on type="datetime">2009-01-31T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1861</number>
  <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
  <priority type="integer">12</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>2.3 attributes nested patch</tag>
  <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
  <updated-at type="datetime">2009-02-06T00:48:58+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">10</version>
  <user-name>Repository</user-name>
  <creator-name>Pascal Ehlert</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
  <priority-name nil="true"></priority-name>
  <original-body>Currently when you supply a _delete attribute on *new* nested records, it will be passed through to the actual model's build method and raise an UnknownArgumentError there.

In my opinion those records should simply be ignored, so that you can delete newly added records the same way that you delete existing ones without much JS or controller magic.</original-body>
  <latest-body>Currently when you supply a _delete attribute on *new* nested records, it will be passed through to the actual model's build method and raise an UnknownArgumentError there.

In my opinion those records should simply be ignored, so that you can delete newly added records the same way that you delete existing ones without much JS or controller magic.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Currently when you supply a _delete attribute on &lt;em&gt;new&lt;/em&gt;
nested records, it will be passed through to the actual model's
build method and raise an UnknownArgumentError there.&lt;/p&gt;
&lt;p&gt;In my opinion those records should simply be ignored, so that
you can delete newly added records the same way that you delete
existing ones without much JS or controller magic.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Currently when you supply a _delete attribute on *new* nested records, it will be passed through to the actual model's build method and raise an UnknownArgumentError there.

In my opinion those records should simply be ignored, so that you can delete newly added records the same way that you delete existing ones without much JS or controller magic.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Currently when you supply a _delete attribute on &lt;em&gt;new&lt;/em&gt;
nested records, it will be passed through to the actual model's
build method and raise an UnknownArgumentError there.&lt;/p&gt;
&lt;p&gt;In my opinion those records should simply be ignored, so that
you can delete newly added records the same way that you delete
existing ones without much JS or controller magic.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T16:49:20+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-03T16:49:21+00:00</updated-at>
      <user-id type="integer">19954</user-id>
      <version type="integer">1</version>
      <user-name>Pascal Ehlert</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I would suggest to change the test test_should_remove_delete_key_from_arguments_hash_of_new_records to use '0' for the '_delete' key. Right now the record is rejected because _delete has a truthy value, if you use '0' it will build and actually test what you intended to.

Other then that I agree with the patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I would suggest to change the test
test_should_remove_delete_key_from_arguments_hash_of_new_records to
use '0' for the '&lt;em&gt;delete' key. Right now the record is rejected
because&lt;/em&gt; delete has a truthy value, if you use '0' it will
build and actually test what you intended to.&lt;/p&gt;
&lt;p&gt;Other then that I agree with the patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T17:55:27+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-03T17:55:28+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">2</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Arg, don't mind the formatting you get the point :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Arg, don't mind the formatting you get the point :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T17:58:05+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-03T17:58:06+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">3</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T18:34:17+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-03T18:34:18+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">4</version>
      <user-name>DHH</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Haha yes, I've been pretty tired when I did the patch.
Thanks for the review and please find attached the updated version.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Haha yes, I've been pretty tired when I did the patch. Thanks
for the review and please find attached the updated version.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T18:47:51+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-03T18:47:52+00:00</updated-at>
      <user-id type="integer">19954</user-id>
      <version type="integer">5</version>
      <user-name>Pascal Ehlert</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I have added some documentation and fixed a few whitespace errors. I'm a whitespace fanatic :)

+1 The patch indeed tests the expected behaviour.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have added some documentation and fixed a few whitespace
errors. I'm a whitespace fanatic :)&lt;/p&gt;
&lt;p&gt;+1 The patch indeed tests the expected behaviour.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T08:27:08+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-04T08:27:14+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">6</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Excellent, thanks a lot.
I thought it would be obvious that a _delete key on new records rejects them, but it's certainly good to clearly state it in the documentation.

Where have you found a whitespace error?
I'm using TextMate with two spaces indentation, so there shouldn't be any.
I suppose we just have a different idea of how it should be done here, because I'm usually careful with whitespaces as well. ;-)


Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Excellent, thanks a lot. I thought it would be obvious that a
_delete key on new records rejects them, but it's certainly good to
clearly state it in the documentation.&lt;/p&gt;
&lt;p&gt;Where have you found a whitespace error? I'm using TextMate with
two spaces indentation, so there shouldn't be any. I suppose we
just have a different idea of how it should be done here, because
I'm usually careful with whitespaces as well. ;-)&lt;/p&gt;
&lt;p&gt;Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T10:27:02+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-04T10:27:08+00:00</updated-at>
      <user-id type="integer">19954</user-id>
      <version type="integer">7</version>
      <user-name>Pascal Ehlert</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>The Rails source in general uses no spaces at all for empty lines. Textmate, however, adds spaces up-to the current indentation level. I myself prefer Textmate's style, but we should follow the general Rails convention.

The &#8220;whitespace errors&#8221; I mentioned were around your test method :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;The Rails source in general uses no spaces at all for empty
lines. Textmate, however, adds spaces up-to the current indentation
level. I myself prefer Textmate's style, but we should follow the
general Rails convention.&lt;/p&gt;
&lt;p&gt;The &amp;#8220;whitespace errors&amp;#8221; I mentioned were around your
test method :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T10:42:22+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-04T10:42:25+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">8</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Totally agree and having no meaningless characters in the code does actually make more sense to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Totally agree and having no meaningless characters in the code
does actually make more sense to me.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T10:51:41+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-04T10:51:46+00:00</updated-at>
      <user-id type="integer">19954</user-id>
      <version type="integer">9</version>
      <user-name>Pascal Ehlert</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [455a7633dbdb295de828eb2657433d47d85eb0bc]) Nested attribute accessors should ignore new records with truthy _delete key.

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
[#1861 state:committed]
http://github.com/rails/rails/commit/455a7633dbdb295de828eb2657433d47d85eb0bc</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [455a7633dbdb295de828eb2657433d47d85eb0bc]) Nested
attribute accessors should ignore new records with truthy _delete
key.&lt;/p&gt;
&lt;p&gt;Signed-off-by: Michael Koziarski &lt;a href=&quot;mailto:michael@koziarski.com&quot;&gt;michael@koziarski.com&lt;/a&gt; [&lt;a href=&quot;/projects/8994/tickets/1861&quot; title=&quot;Ticket #1861&quot;&gt;#1861&lt;/a&gt;
state:committed] &lt;a href=&quot;http://github.com/rails/rails/commit/455a7633dbdb295de828eb2657433d47d85eb0bc&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T00:48:55+00:00</created-at>
      <creator-id type="integer">19954</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1861</number>
      <permalink>nested-attribute-accessors-should-ignore-new-records-with-truthy-_delete-key</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>2.3 attributes nested patch</tag>
      <title>Nested attribute accessors should ignore new records with truthy _delete key</title>
      <updated-at type="datetime">2009-02-06T00:48:58+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">10</version>
      <user-name>Repository</user-name>
      <creator-name>Pascal Ehlert</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1861</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>4a4e3c29864e79b224ff47f679a768187d43f5c4</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-03T16:49:20+00:00</created-at>
      <filename>new_records_with_delete_key.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">84521</id>
      <size type="integer">2498</size>
      <uploader-id type="integer">19954</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/84521/new_records_with_delete_key.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>3c03eda0d0cbadd498bb28d93546f33acd0bb90f</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-03T18:47:51+00:00</created-at>
      <filename>new_records_with_delete_key.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">84591</id>
      <size type="integer">2498</size>
      <uploader-id type="integer">19954</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/84591/new_records_with_delete_key.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>dc6e8ba22929cf15f79379738ec2580ed3e832bd</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-04T08:27:08+00:00</created-at>
      <filename>new_records_with_delete_key.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">84865</id>
      <size type="integer">3448</size>
      <uploader-id type="integer">8406</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/84865/new_records_with_delete_key.diff</url>
    </attachment>
  </attachments>
</ticket>
