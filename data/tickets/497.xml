<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">15316</assigned-user-id>
  <attachments-count type="integer">6</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-06-27T03:30:17+01:00</created-at>
  <creator-id type="integer">24643</creator-id>
  <milestone-due-on type="datetime">2011-02-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">101623</milestone-id>
  <number type="integer">497</number>
  <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>activerecord calculations group patch</tag>
  <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
  <updated-at type="datetime">2011-05-02T15:36:47+01:00</updated-at>
  <user-id type="integer">115087</user-id>
  <version type="integer">35</version>
  <user-name>Ludovic Gasc</user-name>
  <creator-name>gix</creator-name>
  <assigned-user-name>Aaron Patterson</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
  <milestone-title>3.0.5</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>The docs to ActiveRecord#calculate state:

  :group - An attribute name by which the result should 
           be grouped. Uses the GROUP BY SQL-clause. 

Most likely to be compatible to finders. But this statement is only partially true. The method's algorithm assumes that :group contains only one field. When specifying multiple values -- e.g. :group =&gt; 'foo, bar' -- this does not work anymore.

The created intermediate result set is -- by coincidence -- nearly correct but the final result array with grouped key =&gt; aggregated value pairs is totally broken because keys are overwritten:

  &gt;&gt; Item.count(:group =&gt; 'item_id').size
  =&gt; 687
  &gt;&gt; Item.count(:group =&gt; 'quality').size
  =&gt; 2
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality').size
  =&gt; 2 # item_id is primary key, should return 687
  &gt;&gt; Item.count(:group =&gt; 'quality')
  =&gt; [[5, 2], [4, 685]]
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality')
  =&gt; [[4, 1], [5, 1]]

I do not know how this should or can be fixed. Ideally every field in :group should be taken into account and used as some sort of combined key. The major problem I see here is splitting the :group string into fields because a simple split(/\s*,\s*/) won't work for more advanced things like  'COALESCE(col1, col2)'.
Another solution would be to allow :group being an array, thus putting the splitting in the hands of the caller:
  Model.calculate(:op, :group =&gt; ['c', 'COALESCE(c1, c2)'])
This should be changed for finders as well then.

Otherwise the docs should be changed to reflect that multiple fields are not possible.</original-body>
  <latest-body>The docs to ActiveRecord#calculate state:

  :group - An attribute name by which the result should 
           be grouped. Uses the GROUP BY SQL-clause. 

Most likely to be compatible to finders. But this statement is only partially true. The method's algorithm assumes that :group contains only one field. When specifying multiple values -- e.g. :group =&gt; 'foo, bar' -- this does not work anymore.

The created intermediate result set is -- by coincidence -- nearly correct but the final result array with grouped key =&gt; aggregated value pairs is totally broken because keys are overwritten:

  &gt;&gt; Item.count(:group =&gt; 'item_id').size
  =&gt; 687
  &gt;&gt; Item.count(:group =&gt; 'quality').size
  =&gt; 2
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality').size
  =&gt; 2 # item_id is primary key, should return 687
  &gt;&gt; Item.count(:group =&gt; 'quality')
  =&gt; [[5, 2], [4, 685]]
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality')
  =&gt; [[4, 1], [5, 1]]

I do not know how this should or can be fixed. Ideally every field in :group should be taken into account and used as some sort of combined key. The major problem I see here is splitting the :group string into fields because a simple split(/\s*,\s*/) won't work for more advanced things like  'COALESCE(col1, col2)'.
Another solution would be to allow :group being an array, thus putting the splitting in the hands of the caller:
  Model.calculate(:op, :group =&gt; ['c', 'COALESCE(c1, c2)'])
This should be changed for finders as well then.

Otherwise the docs should be changed to reflect that multiple fields are not possible.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
The docs to ActiveRecord#calculate state:
&lt;/p&gt;&lt;p&gt;
:group - An attribute name by which the result should
&lt;/p&gt;&lt;p&gt;
be grouped. Uses the GROUP BY SQL-clause.
&lt;/p&gt;&lt;p&gt;
Most likely to be compatible to finders. But this statement is only partially true. The method's algorithm assumes that :group contains only one field. When specifying multiple values -- e.g. :group =&gt; 'foo, bar' -- this does not work anymore.
&lt;/p&gt;&lt;p&gt;
The created intermediate result set is -- by coincidence -- nearly correct but the final result array with grouped key =&gt; aggregated value pairs is totally broken because keys are overwritten:
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id').size
&lt;/p&gt;&lt;p&gt;
=&gt; 687
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'quality').size
&lt;/p&gt;&lt;p&gt;
=&gt; 2
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id, quality').size
&lt;/p&gt;&lt;p&gt;
=&gt; 2 # item_id is primary key, should return 687
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'quality')
&lt;/p&gt;&lt;p&gt;
=&gt; [[5, 2], [4, 685]]
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id, quality')
&lt;/p&gt;&lt;p&gt;
=&gt; [[4, 1], [5, 1]]
&lt;/p&gt;&lt;p&gt;
I do not know how this should or can be fixed. Ideally every field in :group should be taken into account and used as some sort of combined key. The major problem I see here is splitting the :group string into fields because a simple split(/\s*,\s*/) won't work for more advanced things like  'COALESCE(col1, col2)'.
&lt;/p&gt;&lt;p&gt;
Another solution would be to allow :group being an array, thus putting the splitting in the hands of the caller:
&lt;/p&gt;&lt;p&gt;
Model.calculate(:op, :group =&gt; ['c', 'COALESCE(c1, c2)'])
&lt;/p&gt;&lt;p&gt;
This should be changed for finders as well then.
&lt;/p&gt;&lt;p&gt;
Otherwise the docs should be changed to reflect that multiple fields are not possible.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The docs to ActiveRecord#calculate state:

  :group - An attribute name by which the result should 
           be grouped. Uses the GROUP BY SQL-clause. 

Most likely to be compatible to finders. But this statement is only partially true. The method's algorithm assumes that :group contains only one field. When specifying multiple values -- e.g. :group =&gt; 'foo, bar' -- this does not work anymore.

If one were to use ActiveRecord#count to get only the size of a result set (as the will_paginate-plugin does for example) this used to work in Rails 2.0 and was broken by http://preview.tinyurl.com/3l77f7 [Rails-Changeset]. Now the final result array with grouped key =&gt; aggregated value pairs is totally broken because keys are overwritten:

  &gt;&gt; Item.count(:group =&gt; 'item_id').size
  =&gt; 687
  &gt;&gt; Item.count(:group =&gt; 'quality').size
  =&gt; 2
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality').size
  =&gt; 2 # item_id is primary key, should return 687
  &gt;&gt; Item.count(:group =&gt; 'quality')
  =&gt; [[5, 2], [4, 685]]
  &gt;&gt; Item.count(:group =&gt; 'item_id, quality')
  =&gt; [[4, 1], [5, 1]]

I do not know how this should or can be fixed. Ideally every field in :group should be taken into account and used as some sort of combined key. The major problem I see here is splitting the :group string into fields because a simple split(/\s*,\s*/) won't work for more advanced things like  'COALESCE(col1, col2)'.
Another solution would be to allow :group being an array, thus putting the splitting in the hands of the caller:
  Model.calculate(:op, :group =&gt; ['c', 'COALESCE(c1, c2)'])
This should be changed for finders as well then.

Otherwise the docs should be changed to reflect that multiple fields are not possible.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
The docs to ActiveRecord#calculate state:
&lt;/p&gt;&lt;p&gt;
:group - An attribute name by which the result should
&lt;/p&gt;&lt;p&gt;
be grouped. Uses the GROUP BY SQL-clause.
&lt;/p&gt;&lt;p&gt;
Most likely to be compatible to finders. But this statement is only partially true. The method's algorithm assumes that :group contains only one field. When specifying multiple values -- e.g. :group =&gt; 'foo, bar' -- this does not work anymore.
&lt;/p&gt;&lt;p&gt;
If one were to use ActiveRecord#count to get only the size of a result set (as the will_paginate-plugin does for example) this used to work in Rails 2.0 and was broken by &lt;a href=&quot;http://preview.tinyurl.com/3l77f7&quot;&gt;http://preview.tinyurl.com/3l77f7&lt;/a&gt; [Rails-Changeset]. Now the final result array with grouped key =&gt; aggregated value pairs is totally broken because keys are overwritten:
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id').size
&lt;/p&gt;&lt;p&gt;
=&gt; 687
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'quality').size
&lt;/p&gt;&lt;p&gt;
=&gt; 2
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id, quality').size
&lt;/p&gt;&lt;p&gt;
=&gt; 2 # item_id is primary key, should return 687
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'quality')
&lt;/p&gt;&lt;p&gt;
=&gt; [[5, 2], [4, 685]]
&lt;/p&gt;&lt;p&gt;
&gt;&gt; Item.count(:group =&gt; 'item_id, quality')
&lt;/p&gt;&lt;p&gt;
=&gt; [[4, 1], [5, 1]]
&lt;/p&gt;&lt;p&gt;
I do not know how this should or can be fixed. Ideally every field in :group should be taken into account and used as some sort of combined key. The major problem I see here is splitting the :group string into fields because a simple split(/\s*,\s*/) won't work for more advanced things like  'COALESCE(col1, col2)'.
&lt;/p&gt;&lt;p&gt;
Another solution would be to allow :group being an array, thus putting the splitting in the hands of the caller:
&lt;/p&gt;&lt;p&gt;
Model.calculate(:op, :group =&gt; ['c', 'COALESCE(c1, c2)'])
&lt;/p&gt;&lt;p&gt;
This should be changed for finders as well then.
&lt;/p&gt;&lt;p&gt;
Otherwise the docs should be changed to reflect that multiple fields are not possible.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-27T03:45:07+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2008-06-27T03:45:07+01:00</updated-at>
      <user-id type="integer">24643</user-id>
      <version type="integer">1</version>
      <user-name>gix</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-30T17:53:21+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2008-09-30T17:53:24+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">2</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 for fixing this issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 for fixing this issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T01:30:00+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-02-06T01:30:02+00:00</updated-at>
      <user-id type="integer">27403</user-id>
      <version type="integer">3</version>
      <user-name>Sebastian</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 for addressing this issue. or being much more explicit in the docs.  I would want multiple group by support, achieved via an array as the original post suggests.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 for addressing this issue. or being much more explicit in the
docs. I would want multiple group by support, achieved via an array
as the original post suggests.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-27T22:22:18+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-03-27T22:22:20+00:00</updated-at>
      <user-id type="integer">20594</user-id>
      <version type="integer">4</version>
      <user-name>Seth Ladd</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 for having a way to group by multiple fields.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 for having a way to group by multiple fields.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-06T22:39:26+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-05-06T22:39:29+01:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">5</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 In the meantime, see my ugly hack: poor_mans_group_by.rb http://pastie.org/471055
coalesce deals with nulls and delimitters are chosen to be unicode values unlikely to be used in your code.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 In the meantime, see my ugly hack: poor_mans_group_by.rb
&lt;a href=&quot;http://pastie.org/471055&quot;&gt;http://pastie.org/471055&lt;/a&gt;
coalesce deals with nulls and delimitters are chosen to be unicode
values unlikely to be used in your code.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-07T13:13:48+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-05-07T13:13:51+01:00</updated-at>
      <user-id type="integer">19611</user-id>
      <version type="integer">6</version>
      <user-name>jdwyah</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Couldn't we use the returned row-hash (minus count_all) as the key?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Couldn't we use the returned row-hash (minus count_all) as the
key?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-14T22:40:37+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-05-14T22:40:40+01:00</updated-at>
      <user-id type="integer">27403</user-id>
      <version type="integer">7</version>
      <user-name>Sebastian</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 for getting this fixed...</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 for getting this fixed...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-22T02:04:53+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-06-22T02:04:55+01:00</updated-at>
      <user-id type="integer">60665</user-id>
      <version type="integer">8</version>
      <user-name>Matt White</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Here's another +1</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's another +1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-25T04:21:18+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-06-25T04:21:24+01:00</updated-at>
      <user-id type="integer">1600</user-id>
      <version type="integer">9</version>
      <user-name>Scott Brown</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have found a patch by Eric Lindvall here http://tinyurl.com/luas8x it is an attachment to another lighthouse ticket which I am unable to find.

The patch works against ActiveRecord v2.3.2 (For v2.1.0 check this gist http://gist.github.com/142343)

I have corrected a tiny error in it and attached it to this ticket.

From the test:
@@@ Ruby
def test_should_group_by_multiple_fields
  c = Account.count(1, :group =&gt; [:credit_limit, :firm_id])
  assert_equal [[50, nil], [50, 1], [50, 6], [53, 9], [55, 6], [60, 2]], c.keys
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have found a patch by Eric Lindvall here &lt;a href=
&quot;http://tinyurl.com/luas8x&quot;&gt;http://tinyurl.com/luas8x&lt;/a&gt; it is an
attachment to another lighthouse ticket which I am unable to
find.&lt;/p&gt;
&lt;p&gt;The patch works against ActiveRecord v2.3.2 (For v2.1.0 check
this gist &lt;a href=
&quot;http://gist.github.com/142343&quot;&gt;http://gist.github.com/142343&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;I have corrected a tiny error in it and attached it to this
ticket.&lt;/p&gt;
&lt;p&gt;From the test:&lt;br&gt;
@@@ Ruby def test_should_group_by_multiple_fields&lt;br&gt;
c = Account.count(1, :group =&amp;gt; [:credit_limit, :firm_id])
assert_equal [[50, nil], [50, 1], [50, 6], [53, 9], [55, 6], [60,
2]], c.keys end&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;

&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-07-08T15:26:37+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-07-08T15:26:42+01:00</updated-at>
      <user-id type="integer">35764</user-id>
      <version type="integer">10</version>
      <user-name>Jacob Kjeldahl</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Another +1. This patch would be very useful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Another +1. This patch would be very useful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-12-01T02:51:50+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2009-12-01T02:51:52+00:00</updated-at>
      <user-id type="integer">78116</user-id>
      <version type="integer">11</version>
      <user-name>Gavin Stark</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Another +1.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Another +1.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-03T08:31:38+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-02-03T08:31:40+00:00</updated-at>
      <user-id type="integer">13287</user-id>
      <version type="integer">12</version>
      <user-name>Chris Taggart</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-09T06:19:12+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-02-09T06:19:14+00:00</updated-at>
      <user-id type="integer">23099</user-id>
      <version type="integer">13</version>
      <user-name>James Brooks</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1 

for those looking for temporary support of this, there is a plugin i tracked down from some other references in this thread:  http://github.com/patientslikeme/multi_field_group_by</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;
&lt;p&gt;for those looking for temporary support of this, there is a
plugin i tracked down from some other references in this thread:
&lt;a href=
&quot;http://github.com/patientslikeme/multi_field_group_by&quot;&gt;http://github.com/patientslikeme/multi_field_group_by&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-19T16:35:53+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-02-19T16:35:56+00:00</updated-at>
      <user-id type="integer">87250</user-id>
      <version type="integer">14</version>
      <user-name>Paul Holzberger</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-19T10:33:40+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-05-19T10:33:42+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">15</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Just created a patch that resolves this issue https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/5182. It also works with COALESCE and other SQL functions. Please help verify the patch (see link above) if you guys are still interested in a solution.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just created a patch that resolves this issue &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/5182&quot;&gt;
https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets...&lt;/a&gt;.
It also works with COALESCE and other SQL functions. Please help
verify the patch (see link above) if you guys are still interested
in a solution.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-22T23:42:47+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-07-22T23:42:51+01:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">16</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Uploading a patch here in case any of you guys want to verify it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Uploading a patch here in case any of you guys want to verify
it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-23T16:39:33+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-08-23T16:39:40+01:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">17</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I verified your patch and made it work against the 3-0-stable branch. I also added one more test case for using sql-functions in the group clause.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I verified your patch and made it work against the 3-0-stable
branch. I also added one more test case for using sql-functions in
the group clause.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-09-11T03:24:58+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-09-11T03:25:03+01:00</updated-at>
      <user-id type="integer">27403</user-id>
      <version type="integer">18</version>
      <user-name>Sebastian</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-12T18:27:21+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-12T18:27:27+00:00</updated-at>
      <user-id type="integer">16152</user-id>
      <version type="integer">19</version>
      <user-name>Rafael Cardoso</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-12T19:57:01+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:state: stale
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-12T19:57:05+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">20</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I updated the patch to work against master branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I updated the patch to work against master branch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-13T22:52:25+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-13T22:52:29+00:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">21</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/34349)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/34349&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:04:48+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-15T21:04:48+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">22</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Hi everyone!  I'd really like to push rails to do *less* SQL parsing.  Parsing SQL is a dangerous game.

If we could support this via a list passed to the :group clause (as @gix suggests), would that be OK with everyone?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi everyone! I'd really like to push rails to do &lt;em&gt;less&lt;/em&gt;
SQL parsing. Parsing SQL is a dangerous game.&lt;/p&gt;
&lt;p&gt;If we could support this via a list passed to the :group clause
(as @gix suggests), would that be OK with everyone?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-16T00:07:12+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T00:07:15+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">23</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I agree that is better. The only reason it was done that way was because the documentation when this issue was first opened hinted that the correct usage was to pass in a SQL frag. I updated the patches for master and 2-3-stable such that there is no SQL parsing. They are attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree that is better. The only reason it was done that way was
because the documentation when this issue was first opened hinted
that the correct usage was to pass in a SQL frag. I updated the
patches for master and 2-3-stable such that there is no SQL
parsing. They are attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-16T03:18:51+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T03:18:57+00:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">24</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>Forgot to attach 2-3-stable patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Forgot to attach 2-3-stable patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-16T03:19:40+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T03:19:45+00:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">25</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>@Alex excellent, thank you.  I'll apply and push after verifying everything.  Thanks for the patches!</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Alex excellent, thank you. I'll apply and push after verifying
everything. Thanks for the patches!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-16T18:34:56+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T18:35:01+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">26</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Applied and pushed.  Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Applied and pushed. Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-16T19:10:42+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T19:10:48+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">27</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Great news! Thank you.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Great news! Thank you.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-16T19:55:58+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2010-11-16T19:56:01+00:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">28</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Are you sure this bug is fixed ?

I've tested with AR 3.0.3+your patch and AR 3.0.4.rc built with the Git repository, the SQL query is correct but not the response of the method.

code: &lt;pre&gt;pp SavedForm.count(:group =&gt; 'agent_id, code_dispo')&lt;/pre&gt;

result: &lt;pre&gt;DEBUG -- :   SQL (1.4ms)  SELECT COUNT(*) AS count_all, agent_id, code_dispo AS agent_id_code_dispo FROM `saved_forms` GROUP BY agent_id, code_dispo
{&quot;bte_vocale&quot;=&gt;3, &quot;CB&quot;=&gt;1, &quot;nc&quot;=&gt;1, &quot;pasok&quot;=&gt;4, &quot;wln&quot;=&gt;2, &quot;ok&quot;=&gt;3}&lt;/pre&gt;

&lt;pre&gt;# gem list

*** LOCAL GEMS ***

activemodel (3.0.4.rc)
activerecord (3.0.4.rc)
activesupport (3.0.4.rc)&lt;/pre&gt;

I can't test with the master branch, I've this error:
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:169:in `perform_calculation': undefined method `grep' for #&lt;Arel::Nodes::SelectStatement:0x0000000ece3688&gt; (NoMethodError)
        from /usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:152:in `calculate'
        from /usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:147:in `calculate'
        from /usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:58:in `count'
        from /usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/base.rb:430:in `count'

Thanks for your feedback.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Are you sure this bug is fixed ?&lt;/p&gt;
&lt;p&gt;I've tested with AR 3.0.3+your patch and AR 3.0.4.rc built with
the Git repository, the SQL query is correct but not the response
of the method.&lt;/p&gt;
&lt;p&gt;code:&lt;/p&gt;
&lt;pre&gt;
pp SavedForm.count(:group =&amp;gt; 'agent_id, code_dispo')
&lt;/pre&gt;
&lt;p&gt;result:&lt;/p&gt;
&lt;pre&gt;
DEBUG -- :   SQL (1.4ms)  SELECT COUNT(*) AS count_all, agent_id, code_dispo AS agent_id_code_dispo FROM &lt;code&gt;saved_forms&lt;/code&gt; GROUP BY agent_id, code_dispo
{&quot;bte_vocale&quot;=&amp;gt;3, &quot;CB&quot;=&amp;gt;1, &quot;nc&quot;=&amp;gt;1, &quot;pasok&quot;=&amp;gt;4, &quot;wln&quot;=&amp;gt;2, &quot;ok&quot;=&amp;gt;3}
&lt;/pre&gt;
&lt;pre&gt;
# gem list

*** LOCAL GEMS ***

activemodel (3.0.4.rc)
activerecord (3.0.4.rc)
activesupport (3.0.4.rc)
&lt;/pre&gt;
I can't test with the master branch, I've this error:
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:169:in
`perform_calculation': undefined method `grep' for #
(NoMethodError) from
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:152:in
`calculate' from
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:147:in
`calculate' from
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/relation/calculations.rb:58:in
`count' from
/usr/local/lib/ruby/gems/1.9.1/gems/activerecord-3.1.0.beta/lib/active_record/base.rb:430:in
`count' Thanks for your feedback.&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-04T11:06:10+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-01-04T11:17:47+00:00</updated-at>
      <user-id type="integer">115087</user-id>
      <version type="integer">29</version>
      <user-name>Ludovic Gasc</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Alex, I've just tested with your patch of November 13th, 2010 @ 10:52 PM, it runs correctly.

Only your latest patch has a problem.

If I can help, don't hesitate to contact me.

Yours.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Alex, I've just tested with your patch of November 13th, 2010 @
10:52 PM, it runs correctly.&lt;/p&gt;
&lt;p&gt;Only your latest patch has a problem.&lt;/p&gt;
&lt;p&gt;If I can help, don't hesitate to contact me.&lt;/p&gt;
&lt;p&gt;Yours.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-04T11:17:49+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-01-04T11:21:19+00:00</updated-at>
      <user-id type="integer">115087</user-id>
      <version type="integer">30</version>
      <user-name>Ludovic Gasc</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>The usage should be &lt;tt&gt;pp SavedForm.count(:group =&gt; [ 'agent_id', 'code_dispo'])&lt;/tt&gt;. The reason we do this is to avoid SQL parsing. This is not documented anywhere yet, so eventually we should be adding this to the rails doc.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The usage should be &lt;tt&gt;pp SavedForm.count(:group =&amp;gt; [
'agent_id', 'code_dispo'])&lt;/tt&gt;. The reason we do this is to avoid
SQL parsing. This is not documented anywhere yet, so eventually we
should be adding this to the rails doc.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-04T17:45:11+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-01-04T17:45:52+00:00</updated-at>
      <user-id type="integer">25170</user-id>
      <version type="integer">31</version>
      <user-name>Alex</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/42275)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/42275&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-12T21:58:20+00:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 92071
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-02-12T21:58:20+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">32</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I can confirm this isn't fixed.  And +1 for getting it fixed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm this isn't fixed. And +1 for getting it fixed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-04-02T21:18:21+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-04-02T21:19:02+01:00</updated-at>
      <user-id type="integer">16475</user-id>
      <version type="integer">33</version>
      <user-name>Ben Woosley</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Also, I'll be taking another look at it this weekend.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Also, I'll be taking another look at it this weekend.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-04-02T21:20:29+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-04-02T21:21:01+01:00</updated-at>
      <user-id type="integer">16475</user-id>
      <version type="integer">34</version>
      <user-name>Ben Woosley</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I confirm this bug isn't fixed in 3.0.7.

I don't understand why the patch isn't applied on the source code since 6 months, what's the problem ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I confirm this bug isn't fixed in 3.0.7.&lt;/p&gt;
&lt;p&gt;I don't understand why the patch isn't applied on the source
code since 6 months, what's the problem ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-05-02T15:36:02+01:00</created-at>
      <creator-id type="integer">24643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">497</number>
      <permalink>activerecord-calculate-broken-for-multiple-fields-in-group-option</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord calculations group patch</tag>
      <title>ActiveRecord#calculate broken for multiple fields in :group option</title>
      <updated-at type="datetime">2011-05-02T15:36:47+01:00</updated-at>
      <user-id type="integer">115087</user-id>
      <version type="integer">35</version>
      <user-name>Ludovic Gasc</user-name>
      <creator-name>gix</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/497</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>7cd30140d43f6ebd281303838d8637170a8ef5eb</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-07-08T15:26:37+01:00</created-at>
      <filename>multiple_group_columns_in_calculations.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">216459</id>
      <size type="integer">5703</size>
      <uploader-id type="integer">35764</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/216459/multiple_group_columns_in_calculations.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>b761eabfacf6e3d7ffcf1fc4e67e58846c3114f0</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-08-23T16:39:33+01:00</created-at>
      <filename>group_by_multiple_fields_in_calculations.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">640696</id>
      <size type="integer">5244</size>
      <uploader-id type="integer">25170</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/640696/group_by_multiple_fields_in_calculations.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>1107103ad36d539fb636b71967efd7e42e4f5eff</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-09-11T03:24:58+01:00</created-at>
      <filename>fixed_activerecord_calculations_when_grouped_by_multiple_fields.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">669033</id>
      <size type="integer">4503</size>
      <uploader-id type="integer">27403</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/669033/fixed_activerecord_calculations_when_grouped_by_multiple_fields.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>c46a130007afd81411e27fe240039375fc98878b</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-13T22:52:25+00:00</created-at>
      <filename>group_by_multiple_fields_in_calculations.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">769503</id>
      <size type="integer">4879</size>
      <uploader-id type="integer">25170</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/769503/group_by_multiple_fields_in_calculations.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>0227179829d3ea6e490c5947f7d5bba049ffbbec</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-16T03:18:52+00:00</created-at>
      <filename>group_by_multiple_fields_in_calculations.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">772179</id>
      <size type="integer">4776</size>
      <uploader-id type="integer">25170</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/772179/group_by_multiple_fields_in_calculations.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>d5e079ec30b6c8d99972ca100d9edc212398727a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-16T03:19:40+00:00</created-at>
      <filename>group_by_multiple_fields_in_calculations-2-3-stable.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">772182</id>
      <size type="integer">5502</size>
      <uploader-id type="integer">25170</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/772182/group_by_multiple_fields_in_calculations-2-3-stable.diff</url>
    </attachment>
  </attachments>
</ticket>
