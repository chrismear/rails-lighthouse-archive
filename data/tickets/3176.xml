<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-09-09T18:55:28+01:00</created-at>
  <creator-id type="integer">31932</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">3176</number>
  <permalink>fixtures-data-should-be-reset-between-tests</permalink>
  <priority type="integer">140129</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
  <title>Fixtures data should be reset between tests</title>
  <updated-at type="datetime">2010-10-15T23:01:35+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">21</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Levin Alexander</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When I have two Tests:

@@@
class FirstTest &lt; ActiveSupport::TestCase
  fixtures :foo

  test &quot;some test case&quot; do
    assert(Foo.count &gt; 0)
  end
end

class SecondTest &lt; ActiveSupport::TestCase
  # no fixtures loaded

  test &quot;some other test&quot; do
    assert(Foo.count == 0)
  end
end
@@@

When SecondTest is run after FirstTest, then the fixtures loaded in FirstTest are not reset after the test is run and they cause SecondTest to fail.

This gist demonstrates the problem in more detail:

http://gist.github.com/183881


The tests should be isolated against each other (especially when use_transactional_fixtures is set) and therefore the Fixture data should be reset after each test.</original-body>
  <latest-body>When I have two Tests:

@@@
class FirstTest &lt; ActiveSupport::TestCase
  fixtures :foo

  test &quot;some test case&quot; do
    assert(Foo.count &gt; 0)
  end
end

class SecondTest &lt; ActiveSupport::TestCase
  # no fixtures loaded

  test &quot;some other test&quot; do
    assert(Foo.count == 0)
  end
end
@@@

When SecondTest is run after FirstTest, then the fixtures loaded in FirstTest are not reset after the test is run and they cause SecondTest to fail.

This gist demonstrates the problem in more detail:

http://gist.github.com/183881


The tests should be isolated against each other (especially when use_transactional_fixtures is set) and therefore the Fixture data should be reset after each test.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When I have two Tests:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class FirstTest &amp;lt; ActiveSupport::TestCase
  fixtures :foo

  test &quot;some test case&quot; do
    assert(Foo.count &amp;gt; 0)
  end
end

class SecondTest &amp;lt; ActiveSupport::TestCase
  # no fixtures loaded

  test &quot;some other test&quot; do
    assert(Foo.count == 0)
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;When SecondTest is run after FirstTest, then the fixtures loaded
in FirstTest are not reset after the test is run and they cause
SecondTest to fail.&lt;/p&gt;
&lt;p&gt;This gist demonstrates the problem in more detail:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://gist.github.com/183881&quot;&gt;http://gist.github.com/183881&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The tests should be isolated against each other (especially when
use_transactional_fixtures is set) and therefore the Fixture data
should be reset after each test.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When I have two Tests:

@@@
class FirstTest &lt; ActiveSupport::TestCase
  fixtures :foo

  test &quot;some test case&quot; do
    assert(Foo.count &gt; 0)
  end
end

class SecondTest &lt; ActiveSupport::TestCase
  # no fixtures loaded

  test &quot;some other test&quot; do
    assert(Foo.count == 0) # this can fail if FirstTest is run first
  end
end
@@@

When SecondTest is run after FirstTest, then the fixtures loaded in FirstTest are not reset after the test is run and they cause SecondTest to fail.

This gist demonstrates the problem in more detail:

http://gist.github.com/183881


The tests should be isolated against each other (especially when use_transactional_fixtures is set) and therefore the Fixture data should be reset after each test.</body>
      <body-html>&lt;div&gt;&lt;p&gt;When I have two Tests:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class FirstTest &amp;lt; ActiveSupport::TestCase
  fixtures :foo

  test &quot;some test case&quot; do
    assert(Foo.count &amp;gt; 0)
  end
end

class SecondTest &amp;lt; ActiveSupport::TestCase
  # no fixtures loaded

  test &quot;some other test&quot; do
    assert(Foo.count == 0) # this can fail if FirstTest is run first
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;When SecondTest is run after FirstTest, then the fixtures loaded
in FirstTest are not reset after the test is run and they cause
SecondTest to fail.&lt;/p&gt;
&lt;p&gt;This gist demonstrates the problem in more detail:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://gist.github.com/183881&quot;&gt;http://gist.github.com/183881&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The tests should be isolated against each other (especially when
use_transactional_fixtures is set) and therefore the Fixture data
should be reset after each test.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-09T18:55:28+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activecord fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2009-09-15T13:06:52+01:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">1</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This appears to have become even worse under 2.3.5.  I have self.use_transactional_fixtures = true &amp; fixtures :all in my test_helper.rb file.  With no other change other than 2.3.5 in environment.rb &amp; running rake rails:update, tests which have passed before now fail.  Switching back to 2.3.4, enables the tests to pass.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This appears to have become even worse under 2.3.5. I have
self.use_transactional_fixtures = true &amp;amp; fixtures :all in my
test_helper.rb file. With no other change other than 2.3.5 in
environment.rb &amp;amp; running rake rails:update, tests which have
passed before now fail. Switching back to 2.3.4, enables the tests
to pass.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-30T17:51:29+00:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activecord fixtures testunit
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 activecord fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2009-11-30T17:51:35+00:00</updated-at>
      <user-id type="integer">26521</user-id>
      <version type="integer">2</version>
      <user-name>Niels Meersschaert</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>After further investigation, it looks like 2.3.5 actually is working correctly, possibly solving this issue.  It actually exposed bugs in my tests, causing the failures.</body>
      <body-html>&lt;div&gt;&lt;p&gt;After further investigation, it looks like 2.3.5 actually is
working correctly, possibly solving this issue. It actually exposed
bugs in my tests, causing the failures.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-30T18:58:19+00:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 activecord fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2009-11-30T18:58:20+00:00</updated-at>
      <user-id type="integer">26521</user-id>
      <version type="integer">3</version>
      <user-name>Niels Meersschaert</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can't verify that the issue is fixed in 2.3.5. 

The test code in [the gist](http://gist.github.com/183881) still shows that Fixtures are not purged after tests are run.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can't verify that the issue is fixed in 2.3.5.&lt;/p&gt;
&lt;p&gt;The test code in &lt;a href=&quot;http://gist.github.com/183881&quot;&gt;the
gist&lt;/a&gt; still shows that Fixtures are not purged after tests are
run.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-30T19:09:44+00:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 activecord fixtures testunit
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2009-11-30T19:09:46+00:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">4</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-30T19:10:50+00:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.x activerecord fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2009-11-30T19:10:53+00:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">5</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In my application, the transactional fixtures were working under 2.3.2, but broke on 2.3.3, 4, and 5.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In my application, the transactional fixtures were working under
2.3.2, but broke on 2.3.3, 4, and 5.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-30T17:14:13+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.x activerecord fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-04-30T17:14:16+01:00</updated-at>
      <user-id type="integer">29307</user-id>
      <version type="integer">6</version>
      <user-name>Tim Morton</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can confirm this issue still exists in 2.3.8.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm this issue still exists in 2.3.8.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-25T10:03:16+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.x activerecord fixtures testunit
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-05-25T10:03:23+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">7</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can confirm that this problem exists in 2-3-stable (latest) and rails3 master(latest).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that this problem exists in 2-3-stable (latest)
and rails3 master(latest).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T04:45:22+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T04:45:32+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">8</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>LH can (and should) do better than that. Priority changed from &#8220;&#8221; to &#8220;&#8221; :-) 

I did not even change priority.</body>
      <body-html>&lt;div&gt;&lt;p&gt;LH can (and should) do better than that. Priority changed from
&amp;#8220;&amp;#8221; to &amp;#8220;&amp;#8221; :-)&lt;/p&gt;
&lt;p&gt;I did not even change priority.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T04:48:14+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T04:48:23+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">9</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T04:48:44+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.x activerecord bugmash fixtures testunit
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T04:48:54+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">10</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T05:01:46+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T05:01:54+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">11</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can anyone work on a patch please?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can anyone work on a patch please?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T08:06:36+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T08:06:46+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">12</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I spent some time looking at it and ,I think, rails is working as expected. However it might not be what user is expecting.

Here is how test is run with self.use_transactional_fixtures = true .

- test database has no records
- fixture data is loaded into the database. transaction is committed.
- before the test starts a transcation is started because of self.use_transactional_fixtures = true
- tests are run
- all the data created during test are stored in the database (note transaction is not yet committed)
- tests finish
- since self.use_transactional_fixtures = true is used transaction is rolled back.
- note that data created during tests are rolled back. Not the data created by fixtures.
- when the next time this fixture is used then fixture data is wiped out before fixture data is inserted.

Note that when fixture data is loaded then first all the data is wiped out.

In this case the second test created by Levin is not loading fixtures. It means the data created by previous fixtures are still there in database even though use is using self.use_transactional_fixtures = true .

Fixing this issue would be mean that if self.use_transactional_fixtures = true is used then put fixture data also within transaction. This could have strong impact on the way a lot of tests are written.

In order to run tests faster a lot of time users load all the fixture data at once in database and then the data created by tests are rollbacked. In this case one does not have to create data from fixtures time and again and this results in faster tests.

If we bring loading of fixture data within transaction then tests will run much much slower because then fixture data would be loaded in every single test.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I spent some time looking at it and ,I think, rails is working
as expected. However it might not be what user is expecting.&lt;/p&gt;
&lt;p&gt;Here is how test is run with self.use_transactional_fixtures =
true .&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;test database has no records&lt;/li&gt;
&lt;li&gt;fixture data is loaded into the database. transaction is
committed.&lt;/li&gt;
&lt;li&gt;before the test starts a transcation is started because of
self.use_transactional_fixtures = true&lt;/li&gt;
&lt;li&gt;tests are run&lt;/li&gt;
&lt;li&gt;all the data created during test are stored in the database
(note transaction is not yet committed)&lt;/li&gt;
&lt;li&gt;tests finish&lt;/li&gt;
&lt;li&gt;since self.use_transactional_fixtures = true is used
transaction is rolled back.&lt;/li&gt;
&lt;li&gt;note that data created during tests are rolled back. Not the
data created by fixtures.&lt;/li&gt;
&lt;li&gt;when the next time this fixture is used then fixture data is
wiped out before fixture data is inserted.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that when fixture data is loaded then first all the data is
wiped out.&lt;/p&gt;
&lt;p&gt;In this case the second test created by Levin is not loading
fixtures. It means the data created by previous fixtures are still
there in database even though use is using
self.use_transactional_fixtures = true .&lt;/p&gt;
&lt;p&gt;Fixing this issue would be mean that if
self.use_transactional_fixtures = true is used then put fixture
data also within transaction. This could have strong impact on the
way a lot of tests are written.&lt;/p&gt;
&lt;p&gt;In order to run tests faster a lot of time users load all the
fixture data at once in database and then the data created by tests
are rollbacked. In this case one does not have to create data from
fixtures time and again and this results in faster tests.&lt;/p&gt;
&lt;p&gt;If we bring loading of fixture data within transaction then
tests will run much much slower because then fixture data would be
loaded in every single test.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-27T18:42:23+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T18:42:33+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">13</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Neeraj, awesome explanation about the issue. I'm marking this as won't fix, according to Neeraj information.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj, awesome explanation about the issue. I'm marking this as
won't fix, according to Neeraj information.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T19:13:08+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T19:13:18+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">14</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am not convinced that this would slow down tests much. The fixtures need to be loaded in either case.
I think (but don't know yet) that the slowdown should not be all that big. I'll try to investigate and get some numbers.

Jos&#233;: would you accept a patch for this ticket if the slowdown is small?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am not convinced that this would slow down tests much. The
fixtures need to be loaded in either case.&lt;br&gt;
I think (but don't know yet) that the slowdown should not be all
that big. I'll try to investigate and get some numbers.&lt;/p&gt;
&lt;p&gt;Jos&amp;eacute;: would you accept a patch for this ticket if the
slowdown is small?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T19:26:42+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T19:26:51+01:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">15</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Avoid fixtures to be loaded is exactly the reason why we have transactional fixtures.

http://clarkware.com/cgi/blosxom/2005/10/24

That said, I cannot accept a patch that removes fixtures after running each test.

My advice is: a solution that will always make the data be deleted, even if you don't want to, is going to make your tests slow. So my advice is: just do Foo.delete_all in the few tests you want to ensure it's empty.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Avoid fixtures to be loaded is exactly the reason why we have
transactional fixtures.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://clarkware.com/cgi/blosxom/2005/10/24&quot;&gt;http://clarkware.com/cgi/blosxom/2005/10/24&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;That said, I cannot accept a patch that removes fixtures after
running each test.&lt;/p&gt;
&lt;p&gt;My advice is: a solution that will always make the data be
deleted, even if you don't want to, is going to make your tests
slow. So my advice is: just do Foo.delete_all in the few tests you
want to ensure it's empty.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T19:37:58+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T19:38:08+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">16</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Got it, thanks.

right now, if you're writing `fixtures :table` you are deleting fixtures also. The fix for this ticket would just need to shift this work from before each test is run to after.  The total amount of work should remain the same.

Could be that I'm wrong about that, though.  I'll try to get some data.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Got it, thanks.&lt;/p&gt;
&lt;p&gt;right now, if you're writing &lt;code&gt;fixtures :table&lt;/code&gt; you
are deleting fixtures also. The fix for this ticket would just need
to shift this work from before each test is run to after. The total
amount of work should remain the same.&lt;/p&gt;
&lt;p&gt;Could be that I'm wrong about that, though. I'll try to get some
data.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T19:50:18+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T19:50:36+01:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">17</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&quot;If you're writing fixtures :table you are deleting fixtures also.&quot;

This just happens once and just before running tests. Maybe is ok to delete the whole data after all tests executed, but it needs to be after *all* tests. And that is not going to solve your issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&quot;If you're writing fixtures :table you are deleting fixtures
also.&quot;&lt;/p&gt;
&lt;p&gt;This just happens once and just before running tests. Maybe is
ok to delete the whole data after all tests executed, but it needs
to be after &lt;em&gt;all&lt;/em&gt; tests. And that is not going to solve your
issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T19:54:47+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T19:54:59+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">18</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Great analysis, Neeraj. This is precisely why fixtures are inserted outside the transaction.

Since then, we added support for savepoints, though. We could begin a transaction for the whole test run, insert the fixtures, the mark a savepoint and rollback to it around each test case.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Great analysis, Neeraj. This is precisely why fixtures are
inserted outside the transaction.&lt;/p&gt;
&lt;p&gt;Since then, we added support for savepoints, though. We could
begin a transaction for the whole test run, insert the fixtures,
the mark a savepoint and rollback to it around each test case.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T20:12:30+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T20:12:41+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">19</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The reason I think this ticket is a problem is that different test files can influence each other in unexpected ways. (running FooTest before BarTest will cause BarTest to fail)

Only rolling back to a known state after each TestCase would be enough to fix that particular problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The reason I think this ticket is a problem is that different
test files can influence each other in unexpected ways. (running
FooTest before BarTest will cause BarTest to fail)&lt;/p&gt;
&lt;p&gt;Only rolling back to a known state after each TestCase would be
enough to fix that particular problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-27T20:17:05+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-06-27T20:17:13+01:00</updated-at>
      <user-id type="integer">31932</user-id>
      <version type="integer">20</version>
      <user-name>Levin Alexander</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:35+01:00</created-at>
      <creator-id type="integer">31932</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">3176</number>
      <permalink>fixtures-data-should-be-reset-between-tests</permalink>
      <priority type="integer">140129</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3.x activerecord bugmash fixtures rails3 testunit</tag>
      <title>Fixtures data should be reset between tests</title>
      <updated-at type="datetime">2010-10-15T23:01:35+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">21</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Levin Alexander</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3176</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
  </versions>
</ticket>
