<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-03-17T15:34:31+00:00</created-at>
  <creator-id type="integer">50981</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">2273</number>
  <permalink>activesupportjsondecode-dies-on-long-file</permalink>
  <priority type="integer">1450</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>duplicate</state>
  <tag>date json</tag>
  <title>ActiveSupport::JSON.decode dies on double escaped string</title>
  <updated-at type="datetime">2009-08-08T23:34:17+01:00</updated-at>
  <user-id type="integer">7211</user-id>
  <version type="integer">12</version>
  <user-name>CancelProfileIsBroken</user-name>
  <creator-name>Harm Aarts</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Parsing a long file with ActiveSupport::JSON.decode dies with ActiveSupport::JSON::ParseError: Invalid JSON string.
The underlying error is an ArgumentError. Running the decode with the attached file yields the error.

I believe the date extraction places the wrong marks or uses them prematurely. Inspecting the error showed: '... &quot;ranAt&quot;: &quot;2009-02-19 21:48:05&quot;  &quot;encoding&quot;: &quot;UTF-8 , ...'. This is clearly wrong with a missing comma and the UTF-8 string not correctly closed.</original-body>
  <latest-body>Parsing a long file with ActiveSupport::JSON.decode dies with ActiveSupport::JSON::ParseError: Invalid JSON string.
The underlying error is an ArgumentError. Running the decode with the attached file yields the error.

I believe the date extraction places the wrong marks or uses them prematurely. Inspecting the error showed: '... &quot;ranAt&quot;: &quot;2009-02-19 21:48:05&quot;  &quot;encoding&quot;: &quot;UTF-8 , ...'. This is clearly wrong with a missing comma and the UTF-8 string not correctly closed.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Parsing a long file with ActiveSupport::JSON.decode dies with
ActiveSupport::JSON::ParseError: Invalid JSON string. The
underlying error is an ArgumentError. Running the decode with the
attached file yields the error.&lt;/p&gt;
&lt;p&gt;I believe the date extraction places the wrong marks or uses
them prematurely. Inspecting the error showed: '... &quot;ranAt&quot;:
&quot;2009-02-19 21:48:05&quot; &quot;encoding&quot;: &quot;UTF-8 , ...'. This is clearly
wrong with a missing comma and the UTF-8 string not correctly
closed.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Parsing a long file with ActiveSupport::JSON.decode dies with ActiveSupport::JSON::ParseError: Invalid JSON string.
The underlying error is an ArgumentError. Running the decode with the attached file yields the error.

I believe the date extraction places the wrong marks or uses them prematurely. Inspecting the error showed: '... &quot;ranAt&quot;: &quot;2009-02-19 21:48:05&quot;  &quot;encoding&quot;: &quot;UTF-8 , ...'. This is clearly wrong with a missing comma and the UTF-8 string not correctly closed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Parsing a long file with ActiveSupport::JSON.decode dies with
ActiveSupport::JSON::ParseError: Invalid JSON string. The
underlying error is an ArgumentError. Running the decode with the
attached file yields the error.&lt;/p&gt;
&lt;p&gt;I believe the date extraction places the wrong marks or uses
them prematurely. Inspecting the error showed: '... &quot;ranAt&quot;:
&quot;2009-02-19 21:48:05&quot; &quot;encoding&quot;: &quot;UTF-8 , ...'. This is clearly
wrong with a missing comma and the UTF-8 string not correctly
closed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-17T15:34:31+00:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>date json</tag>
      <title>ActiveSupport::JSON.decode dies on long file</title>
      <updated-at type="datetime">2009-03-17T15:34:37+00:00</updated-at>
      <user-id type="integer">50981</user-id>
      <version type="integer">1</version>
      <user-name>Harm Aarts</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I believe the marks are counted wrong in the file activesupport-2.3.2/lib/active_support/json/decoding.rb line 41. The datetime field contains colons (:) and these are incorrectly counted. The same holds true for fields holding urls (http://).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I believe the marks are counted wrong in the file
activesupport-2.3.2/lib/active_support/json/decoding.rb line 41.
The datetime field contains colons (:) and these are incorrectly
counted. The same holds true for fields holding urls (http://).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-17T16:26:34+00:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>date json</tag>
      <title>ActiveSupport::JSON.decode dies on long file</title>
      <updated-at type="datetime">2009-03-17T16:26:36+00:00</updated-at>
      <user-id type="integer">50981</user-id>
      <version type="integer">2</version>
      <user-name>Harm Aarts</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Say the content of a file is this:
{&quot;a&quot;:&quot;\/\/\/\/\/&quot;,&quot;b&quot;:&quot;2009-03-17 14:20:42&quot;,&quot;some_key&quot;:&quot;some_value&quot;}
Then reading that string with File.open(&quot;file_name&quot;).read yields this string:
&quot;{&quot;a&quot;:&quot;\\/\\/\\/\\/\\/&quot;,&quot;b&quot;:&quot;2009-03-17 14:20:42&quot;,&quot;some_key&quot;:&quot;some_value&quot;}\n&quot;
Decoding this string with ActiveSupport::JSON.decode goes wrong, the resulting hash:
{&quot;a&quot;=&gt;&quot;/////&quot;, &quot;b&quot;=&gt;&quot;2009 03-17 14:20:42&quot;, &quot;s me_key&quot;=&gt;&quot;some_value&quot;}

Notice the hyphen between 2009-03 is missing as well as the 'o' in the 'some_key' word.

I believe this is due to the fact that the string read from the file is double escaped. The in combination with the date matching causes the wrong characters to be replaced with a space which in some cases leads to a mangled result and in other cases in invalid JSON strings.

A quick fix is to replace the '\\/' sequences in the string which resulted from the file read with '/'. Example:
ActiveSupport::JSON.decode(File.open(&quot;some_file&quot;).gsub!('\\/','/'))

I still believe this is a bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Say the content of a file is this:
{&quot;a&quot;:&quot;\/\/\/\/\/&quot;,&quot;b&quot;:&quot;2009-03-17 14:20:42&quot;,&lt;a href=&quot;%22some_value%22%7D&quot;&gt;some_key&lt;/a&gt; Then reading that string with
File.open(&quot;file_name&quot;).read yields this string:
&quot;{&quot;a&quot;:&quot;\/\/\/\/\/&quot;,&quot;b&quot;:&quot;2009-03-17 14:20:42&quot;,&lt;a href=&quot;%22some_value%22%7D%5Cn%22&quot;&gt;some_key&lt;/a&gt; Decoding this string with
ActiveSupport::JSON.decode goes wrong, the resulting hash:
{&quot;a&quot;=&amp;gt;&quot;/////&quot;, &quot;b&quot;=&amp;gt;&quot;2009 03-17 14:20:42&quot;, &quot;s
me_key&quot;=&amp;gt;&quot;some_value&quot;}&lt;/p&gt;
&lt;p&gt;Notice the hyphen between 2009-03 is missing as well as the 'o'
in the 'some_key' word.&lt;/p&gt;
&lt;p&gt;I believe this is due to the fact that the string read from the
file is double escaped. The in combination with the date matching
causes the wrong characters to be replaced with a space which in
some cases leads to a mangled result and in other cases in invalid
JSON strings.&lt;/p&gt;
&lt;p&gt;A quick fix is to replace the '\/' sequences in the string which
resulted from the file read with '/'. Example:
ActiveSupport::JSON.decode(File.open(&quot;some_file&quot;).gsub!('\/','/'))&lt;/p&gt;
&lt;p&gt;I still believe this is a bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-18T10:24:09+00:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- 
:title: ActiveSupport::JSON.decode dies on long file
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-03-18T10:24:14+00:00</updated-at>
      <user-id type="integer">50981</user-id>
      <version type="integer">3</version>
      <user-name>Harm Aarts</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think this is a bug, too.

I found reproduceable code, but it uses multibyte characters.

  &gt;&gt; h = { &quot;data&quot; =&gt; [{&quot;key&quot; =&gt; &quot;&#28450;&#23383;&quot;, &quot;date&quot; =&gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&gt; &quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot; =&gt; &quot;2009-01-01&quot;, &quot;date2&quot; =&gt; &quot;2009-01-02&quot;}]}
  &gt;&gt; ActiveSupport::JSON.decode(h.to_json)
  #=&gt; {&quot;data&quot;=&gt;[{&quot;date&quot;=&gt;Tue, 01 Jan 2008, &quot;key&quot;=&gt;&quot;&#28450;&#23383;&quot;}, {&quot;k y&quot;=&gt;&quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot;=&gt;&quot;2009- 1-01&quot;, &quot;d te2&quot;=&gt;&quot;2009- 1-02&quot;}]}

I think this is a bug in ActiveSupport::JSON#convert_json_to_yaml.

In convert_json_to_yaml, the local variable named 'times' is constructed in wrong timing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think this is a bug, too.&lt;/p&gt;
&lt;p&gt;I found reproduceable code, but it uses multibyte
characters.&lt;/p&gt;
&lt;p&gt;&amp;gt;&amp;gt; h = { &quot;data&quot; =&amp;gt; [{&quot;key&quot; =&amp;gt; &quot;&amp;#28450;&amp;#23383;&quot;,
&quot;date&quot; =&amp;gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&amp;gt;
&quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot; =&amp;gt; &quot;2009-01-01&quot;, &quot;date2&quot;
=&amp;gt; &quot;2009-01-02&quot;}]} &amp;gt;&amp;gt;
ActiveSupport::JSON.decode(h.to_json) #=&amp;gt;
{&quot;data&quot;=&amp;gt;[{&quot;date&quot;=&amp;gt;Tue, 01 Jan 2008,
&quot;key&quot;=&amp;gt;&quot;&amp;#28450;&amp;#23383;&quot;}, {&quot;k
y&quot;=&amp;gt;&quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot;=&amp;gt;&quot;2009- 1-01&quot;, &quot;d
te2&quot;=&amp;gt;&quot;2009- 1-02&quot;}]}&lt;/p&gt;
&lt;p&gt;I think this is a bug in
ActiveSupport::JSON#convert_json_to_yaml.&lt;/p&gt;
&lt;p&gt;In convert_json_to_yaml, the local variable named 'times' is
constructed in wrong timing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-20T08:40:25+00:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-03-20T08:40:27+00:00</updated-at>
      <user-id type="integer">51354</user-id>
      <version type="integer">4</version>
      <user-name>okkez</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Please have a look at #2831, which is very similar to this ticket. I submitted a patch to #2831 which should solve this ticket as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Please have a look at &lt;a href=&quot;/projects/8994/tickets/2831&quot;
title=&quot;Ticket #2831&quot;&gt;#2831&lt;/a&gt;, which is very similar to this
ticket. I submitted a patch to &lt;a href=
&quot;/projects/8994/tickets/2831&quot; title=&quot;Ticket #2831&quot;&gt;#2831&lt;/a&gt; which
should solve this ticket as well.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-01T01:43:06+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-01T01:43:08+01:00</updated-at>
      <user-id type="integer">64701</user-id>
      <version type="integer">5</version>
      <user-name>Bas van Klinkenberg</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-03T05:59:44+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: date json
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-03T05:59:50+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">6</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>bug by Harm Aarts is &quot;not reproducible&quot; .

Can reproduce bug by okkez

Before patch by Bas van Klinkenberg (https://rails.lighthouseapp.com/projects/8994/tickets/2831)

&lt;pre&gt;
h = { &quot;data&quot; =&gt; [{&quot;key&quot; =&gt; &quot;&#28450;&#23383;&quot;, &quot;date&quot; =&gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&gt; &quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot; =&gt; &quot;2009-01-01&quot;, &quot;date2&quot; =&gt; &quot;2009-01-02&quot;}]}
=&gt; {&quot;data&quot;=&gt;[{&quot;key&quot;=&gt;&quot;&#28450;&#23383;&quot;, &quot;date&quot;=&gt;&quot;2008-01-01&quot;}, {&quot;key&quot;=&gt;&quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot;=&gt;&quot;2009-01-01&quot;, &quot;date2&quot;=&gt;&quot;2009-01-02&quot;}]}
&gt;&gt; ActiveSupport::JSON.decode(h.to_json)
IndexError: index 118 out of string
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `[]='
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `block in convert_json_to_yaml'
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `each'
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `convert_json_to_yaml'
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:16:in `decode'
	from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/decoding.rb:11:in `decode'
	from (irb):45
	from /usr/local/bin/irb:12:in `&lt;main&gt;'

&lt;/pre&gt;

After patch:
&lt;pre&gt;h = { &quot;data&quot; =&gt; [{&quot;key&quot; =&gt; &quot;&#28450;&#23383;&quot;, &quot;date&quot; =&gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&gt; &quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot; =&gt; &quot;2009-01-01&quot;, &quot;date2&quot; =&gt; &quot;2009-01-02&quot;}]}
=&gt; {&quot;data&quot;=&gt;[{&quot;key&quot;=&gt;&quot;&#28450;&#23383;&quot;, &quot;date&quot;=&gt;&quot;2008-01-01&quot;}, {&quot;key&quot;=&gt;&quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot;=&gt;&quot;2009-01-01&quot;, &quot;date2&quot;=&gt;&quot;2009-01-02&quot;}]}
&gt;&gt; ActiveSupport::JSON.decode(h.to_json)
=&gt; {&quot;data&quot;=&gt;[{&quot;key&quot;=&gt;&quot;&#28450;&#23383;&quot;, &quot;date&quot;=&gt;Tue, 01 Jan 2008}, {&quot;key&quot;=&gt;&quot;&#12354;&#12356;&#12358;&quot;, &quot;date&quot;=&gt;Thu, 01 Jan 2009, &quot;date2&quot;=&gt;Fri, 02 Jan 2009}]}
&lt;/pre&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;bug by Harm Aarts is &quot;not reproducible&quot; .&lt;/p&gt;
&lt;p&gt;Can reproduce bug by okkez&lt;/p&gt;
&lt;p&gt;Before patch by Bas van Klinkenberg (&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/2831&quot;&gt;https://rails.lighthouseapp.com/projects/8994/tickets/2831&lt;/a&gt;)&lt;/p&gt;
&lt;pre&gt;
h = { &quot;data&quot; =&amp;gt; [{&quot;key&quot; =&amp;gt; &quot;&amp;#28450;&amp;#23383;&quot;, &quot;date&quot; =&amp;gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&amp;gt; &quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot; =&amp;gt; &quot;2009-01-01&quot;, &quot;date2&quot; =&amp;gt; &quot;2009-01-02&quot;}]}
=&amp;gt; {&quot;data&quot;=&amp;gt;[{&quot;key&quot;=&amp;gt;&quot;&amp;#28450;&amp;#23383;&quot;, &quot;date&quot;=&amp;gt;&quot;2008-01-01&quot;}, {&quot;key&quot;=&amp;gt;&quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot;=&amp;gt;&quot;2009-01-01&quot;, &quot;date2&quot;=&amp;gt;&quot;2009-01-02&quot;}]}
&amp;gt;&amp;gt; ActiveSupport::JSON.decode(h.to_json)
IndexError: index 118 out of string
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `[]='
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `block in convert_json_to_yaml'
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `each'
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:77:in `convert_json_to_yaml'
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/backends/yaml.rb:16:in `decode'
    from /home/jastix/projects/bugmash/bookclub/vendor/rails/activesupport/lib/active_support/json/decoding.rb:11:in `decode'
    from (irb):45
    from /usr/local/bin/irb:12:in `'

&lt;/pre&gt;
&lt;p&gt;After patch:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
h = { &quot;data&quot; =&amp;gt; [{&quot;key&quot; =&amp;gt; &quot;&amp;#28450;&amp;#23383;&quot;, &quot;date&quot; =&amp;gt; &quot;2008-01-01&quot;}, {&quot;key&quot; =&amp;gt; &quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot; =&amp;gt; &quot;2009-01-01&quot;, &quot;date2&quot; =&amp;gt; &quot;2009-01-02&quot;}]}
=&amp;gt; {&quot;data&quot;=&amp;gt;[{&quot;key&quot;=&amp;gt;&quot;&amp;#28450;&amp;#23383;&quot;, &quot;date&quot;=&amp;gt;&quot;2008-01-01&quot;}, {&quot;key&quot;=&amp;gt;&quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot;=&amp;gt;&quot;2009-01-01&quot;, &quot;date2&quot;=&amp;gt;&quot;2009-01-02&quot;}]}

&lt;/pre&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;ActiveSupport::JSON.decode(h.to_json) =&amp;gt;
{&quot;data&quot;=&amp;gt;[{&quot;key&quot;=&amp;gt;&quot;&amp;#28450;&amp;#23383;&quot;, &quot;date&quot;=&amp;gt;Tue, 01 Jan
2008}, {&quot;key&quot;=&amp;gt;&quot;&amp;#12354;&amp;#12356;&amp;#12358;&quot;, &quot;date&quot;=&amp;gt;Thu, 01
Jan 2009, &quot;date2&quot;=&amp;gt;Fri, 02 Jan 2009}]}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;pre&gt;

&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T13:34:05+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T13:34:10+01:00</updated-at>
      <user-id type="integer">64156</user-id>
      <version type="integer">7</version>
      <user-name>Nikolay Petrachkov </user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>not reproducible

-1 I wasn't able to reproduce the error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;not reproducible&lt;/p&gt;
&lt;p&gt;-1 I wasn't able to reproduce the error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T22:51:51+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T22:51:55+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">8</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Should be marked as &quot;resolved, duplicate&quot;. Fix merged in by Yehuda in [#2831].</body>
      <body-html>&lt;div&gt;&lt;p&gt;Should be marked as &quot;resolved, duplicate&quot;. Fix merged in by
Yehuda in [&lt;a href=&quot;/projects/8994/tickets/2831&quot; title=
&quot;Ticket #2831&quot;&gt;#2831&lt;/a&gt;].&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T23:00:28+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T23:00:31+01:00</updated-at>
      <user-id type="integer">10900</user-id>
      <version type="integer">9</version>
      <user-name>Dan Croak</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>uhhh...  hardbap told me to say this is &quot;verified&quot;</body>
      <body-html>&lt;div&gt;&lt;p&gt;uhhh... hardbap told me to say this is &quot;verified&quot;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T23:02:55+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T23:02:59+01:00</updated-at>
      <user-id type="integer">10900</user-id>
      <version type="integer">10</version>
      <user-name>Dan Croak</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Duplicate of #2831</body>
      <body-html>&lt;div&gt;&lt;p&gt;Duplicate of &lt;a href=&quot;/projects/8994/tickets/2831&quot; title=
&quot;Ticket #2831&quot;&gt;#2831&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-08T23:33:59+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>bugmash date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T23:34:06+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">11</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-08T23:34:15+01:00</created-at>
      <creator-id type="integer">50981</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: bugmash date json
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2273</number>
      <permalink>activesupportjsondecode-dies-on-long-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>&quot;&quot; date json</tag>
      <title>ActiveSupport::JSON.decode dies on double escaped string</title>
      <updated-at type="datetime">2009-08-08T23:34:17+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">12</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Harm Aarts</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2273</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>88f85b04faa1194c411cd6e08b4d1a6fb2478c93</code>
      <content-type>application/octet-stream</content-type>
      <created-at type="datetime">2009-03-17T15:34:31+00:00</created-at>
      <filename>tweakers_page_1.json</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">100750</id>
      <size type="integer">32344</size>
      <uploader-id type="integer">50981</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/100750/tweakers_page_1.json</url>
    </attachment>
  </attachments>
</ticket>
