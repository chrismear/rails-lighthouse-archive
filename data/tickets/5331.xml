<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">40272</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-10T06:31:08+01:00</created-at>
  <creator-id type="integer">86792</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">5331</number>
  <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>columns query_cache rails3rc</tag>
  <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
  <updated-at type="datetime">2010-10-15T23:02:00+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">16</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>rafmagana</creator-name>
  <assigned-user-name>Santiago Pastorino</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>http://bit.ly/rails3_query_cache_L60

    def columns(*)
      if @query_cache_enabled
        @query_cache[&quot;SHOW FIELDS FROM #{args.first}&quot;] ||= super
      else
       super
      end
    end</original-body>
  <latest-body>http://bit.ly/rails3_query_cache_L60

    def columns(*)
      if @query_cache_enabled
        @query_cache[&quot;SHOW FIELDS FROM #{args.first}&quot;] ||= super
      else
       super
      end
    end</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://bit.ly/rails3_query_cache_L60&quot;&gt;http://bit.ly/rails3_query_cache_L60&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def columns(*)
  if @query_cache_enabled
    @query_cache[&quot;SHOW FIELDS FROM #{args.first}&quot;] ||= super
  else
   super
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>http://bit.ly/rails3_query_cache_L60

    def columns(*)
      if @query_cache_enabled
        @query_cache[&quot;SHOW FIELDS FROM #{args.first}&quot;] ||= super
      else
       super
      end
    end</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://bit.ly/rails3_query_cache_L60&quot;&gt;http://bit.ly/rails3_query_cache_L60&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def columns(*)
  if @query_cache_enabled
    @query_cache[&quot;SHOW FIELDS FROM #{args.first}&quot;] ||= super
  else
   super
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-07T20:21:15+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-07T20:21:18+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">1</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>How did you find this? Did you encounter an error or were you browsing the code?

Well it certainly is wrong, so I've provided a patch that adds the args to parameters but I don't know how to write a test for this. Does this even need a test?</body>
      <body-html>&lt;div&gt;&lt;p&gt;How did you find this? Did you encounter an error or were you
browsing the code?&lt;/p&gt;
&lt;p&gt;Well it certainly is wrong, so I've provided a patch that adds
the args to parameters but I don't know how to write a test for
this. Does this even need a test?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-08T06:13:27+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:priority: 0
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-08T06:13:31+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">2</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey Rohit, I was browsing the code because I was writing a post in my blog about the splat operator (http://bit.ly/raflabs_foo_splat), so I was looking for code to show the readers real-world usages. 

I didn't provide any patch because I hadn't time to run the tests, I only tried to find out if there were any tests on this but I only wasn't able to find this:

    Task.cache do
      assert Task.connection.query_cache_enabled
      Task.find(1)
      ...
    end

which doesn't seem to call the &quot;columns&quot; method so it doesn't fail.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey Rohit, I was browsing the code because I was writing a post
in my blog about the splat operator (&lt;a href=
&quot;http://bit.ly/raflabs_foo_splat)&quot;&gt;http://bit.ly/raflabs_foo_splat)&lt;/a&gt;,
so I was looking for code to show the readers real-world
usages.&lt;/p&gt;
&lt;p&gt;I didn't provide any patch because I hadn't time to run the
tests, I only tried to find out if there were any tests on this but
I only wasn't able to find this:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Task.cache do
  assert Task.connection.query_cache_enabled
  Task.find(1)
  ...
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;which doesn't seem to call the &quot;columns&quot; method so it doesn't
fail.&lt;/p&gt;
&lt;p&gt;Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-08T08:20:07+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-08T08:20:11+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">3</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>oops, it should be:

...but I only was able to find this:

sorry</body>
      <body-html>&lt;div&gt;&lt;p&gt;oops, it should be:&lt;/p&gt;
&lt;p&gt;...but I only was able to find this:&lt;/p&gt;
&lt;p&gt;sorry&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-08T08:21:12+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-08T08:21:13+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">4</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm having a hard time figuring out if the .columns is even used correctly in the current implementation.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm having a hard time figuring out if the .columns is even used
correctly in the current implementation.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-09T21:46:07+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-09T21:46:11+01:00</updated-at>
      <user-id type="integer">30535</user-id>
      <version type="integer">5</version>
      <user-name>Mark Turner</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey Mark, I am not sure, I was doing some testing on that and I wasn't able to make Rails to call that method in any way. Look:

    Task.cache do
      # calls ActiveRecord::Base#columns which calls SQLiteAdapter#columns
      Topic.columns

      # calls SQLiteAdapter#columns directly
      Topic.connection.columns :topics
      ActiveRecord::Base.connection.columns :topics
    end

So, it never calls the QueryCache#columns method but:

    Task.cache do
      Task.find(1) # =&gt; calls QueryCache#select_all
    end

The QueryCache#columns method is defined just below the QueryCache#select_all and now I'm confused :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey Mark, I am not sure, I was doing some testing on that and I
wasn't able to make Rails to call that method in any way. Look:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Task.cache do
  # calls ActiveRecord::Base#columns which calls SQLiteAdapter#columns
  Topic.columns

  # calls SQLiteAdapter#columns directly
  Topic.connection.columns :topics
  ActiveRecord::Base.connection.columns :topics
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So, it never calls the QueryCache#columns method but:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Task.cache do
  Task.find(1) # =&amp;gt; calls QueryCache#select_all
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The QueryCache#columns method is defined just below the
QueryCache#select_all and now I'm confused :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-09T23:52:18+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-09T23:52:21+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">6</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey guys can someone provide a test with this patch?.
Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey guys can someone provide a test with this patch?.&lt;br&gt;
Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T04:48:39+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T04:48:41+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>QueryCache is included in AbstractAdapter which forms the base to all the DB adapters. I took a look at the columns method in mySQL and SQLite3 (defined in SQLite adapter) adapters and none of them call super.

If you call super in the columns method of mySQL or SQLite adapters then the error is raised &amp;mdash;

@@@ ruby
NameError: undefined local variable or method `args' for #&lt;ActiveRecord::ConnectionAdapters::SQLite3Adapter:0x00000002664980&gt;
    /home/rohit/projects/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:62:in `columns'
@@@

I haven't looked deeper but it seems to me that caching won't be available unless you call super inside the columns method. How can this be checked?

Since at present none of the adapters are calling super inside the supplied colums method, the error is not caught. So if the correct implementation is right then how can this method be tested? Or more importantly is this implementation right?</body>
      <body-html>&lt;div&gt;&lt;p&gt;QueryCache is included in AbstractAdapter which forms the base
to all the DB adapters. I took a look at the columns method in
mySQL and SQLite3 (defined in SQLite adapter) adapters and none of
them call super.&lt;/p&gt;
&lt;p&gt;If you call super in the columns method of mySQL or SQLite
adapters then the error is raised &amp;mdash;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;NameError: undefined local variable or method `args' for #&amp;lt;ActiveRecord::ConnectionAdapters::SQLite3Adapter:0x00000002664980&amp;gt;
    /home/rohit/projects/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:62:in `columns'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I haven't looked deeper but it seems to me that caching won't be
available unless you call super inside the columns method. How can
this be checked?&lt;/p&gt;
&lt;p&gt;Since at present none of the adapters are calling super inside
the supplied colums method, the error is not caught. So if the
correct implementation is right then how can this method be tested?
Or more importantly is this implementation right?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T08:41:16+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T08:41:17+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">8</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>What is happening is something like the following &amp;mdash;

@@@ ruby
ruby-1.9.2-rc1 &gt; module QueryCache
ruby-1.9.2-rc1 ?&gt;  def columns(*)
ruby-1.9.2-rc1 ?&gt;    puts args.inspect
ruby-1.9.2-rc1 ?&gt;  end
ruby-1.9.2-rc1 ?&gt;end
 =&gt; nil 

ruby-1.9.2-rc1 &gt; class AdapterBase
ruby-1.9.2-rc1 ?&gt;  include QueryCache
ruby-1.9.2-rc1 ?&gt;end
 =&gt; AdapterBase 

ruby-1.9.2-rc1 &gt; class Sqlite &lt; AdapterBase
ruby-1.9.2-rc1 ?&gt;  def columns(sql, arg_b)
ruby-1.9.2-rc1 ?&gt;    puts &quot;hello&quot;
ruby-1.9.2-rc1 ?&gt;  end
ruby-1.9.2-rc1 ?&gt;end
 =&gt; nil 

ruby-1.9.2-rc1 &gt; class Mysql &lt; AdapterBase
ruby-1.9.2-rc1 ?&gt;  def columns(sql, arg_b)
ruby-1.9.2-rc1 ?&gt;    super
ruby-1.9.2-rc1 ?&gt;    puts &quot;hello&quot;
ruby-1.9.2-rc1 ?&gt;  end
ruby-1.9.2-rc1 ?&gt;end
 =&gt; nil 

ruby-1.9.2-rc1 &gt; Sqlite.new.columns(1 ,2)
hello
 =&gt; nil 

ruby-1.9.2-rc1 &gt; Mysql.new.columns(1, 2)
NameError: undefined local variable or method `args' for #&lt;Mysql:0x00000001e41348&gt;
	from (irb):3:in `columns'
	from (irb):19:in `columns'
	from (irb):24
	from /home/rohit/.rvm/rubies/ruby-1.9.2-rc1/bin/irb:17:in `&lt;main&gt;'
@@@

Which means that either the adapters are not calling super when they are supposed to or they shouldn't call them, meaning that the AbstractAdapter and its modules don't have proper test coverage.</body>
      <body-html>&lt;div&gt;&lt;p&gt;What is happening is something like the following &amp;mdash;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;ruby-1.9.2-rc1 &amp;gt; module QueryCache
ruby-1.9.2-rc1 ?&amp;gt;  def columns(*)
ruby-1.9.2-rc1 ?&amp;gt;    puts args.inspect
ruby-1.9.2-rc1 ?&amp;gt;  end
ruby-1.9.2-rc1 ?&amp;gt;end
 =&amp;gt; nil 

ruby-1.9.2-rc1 &amp;gt; class AdapterBase
ruby-1.9.2-rc1 ?&amp;gt;  include QueryCache
ruby-1.9.2-rc1 ?&amp;gt;end
 =&amp;gt; AdapterBase 

ruby-1.9.2-rc1 &amp;gt; class Sqlite &amp;lt; AdapterBase
ruby-1.9.2-rc1 ?&amp;gt;  def columns(sql, arg_b)
ruby-1.9.2-rc1 ?&amp;gt;    puts &quot;hello&quot;
ruby-1.9.2-rc1 ?&amp;gt;  end
ruby-1.9.2-rc1 ?&amp;gt;end
 =&amp;gt; nil 

ruby-1.9.2-rc1 &amp;gt; class Mysql &amp;lt; AdapterBase
ruby-1.9.2-rc1 ?&amp;gt;  def columns(sql, arg_b)
ruby-1.9.2-rc1 ?&amp;gt;    super
ruby-1.9.2-rc1 ?&amp;gt;    puts &quot;hello&quot;
ruby-1.9.2-rc1 ?&amp;gt;  end
ruby-1.9.2-rc1 ?&amp;gt;end
 =&amp;gt; nil 

ruby-1.9.2-rc1 &amp;gt; Sqlite.new.columns(1 ,2)
hello
 =&amp;gt; nil 

ruby-1.9.2-rc1 &amp;gt; Mysql.new.columns(1, 2)
NameError: undefined local variable or method `args' for #&amp;lt;Mysql:0x00000001e41348&amp;gt;
    from (irb):3:in `columns'
    from (irb):19:in `columns'
    from (irb):24
    from /home/rohit/.rvm/rubies/ruby-1.9.2-rc1/bin/irb:17:in `&amp;lt;main&amp;gt;'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Which means that either the adapters are not calling super when
they are supposed to or they shouldn't call them, meaning that the
AbstractAdapter and its modules don't have proper test
coverage.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T08:56:29+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T08:56:33+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">9</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Maybe I'm wrong, but as far as I understand, the caching of the columns names is always[?] done by the *ActiveRecord::Base.columns* method via *@columns*:

http://bit.ly/9NxQY6 &lt; Line 677 of ActiveRecord::Base

If we do

    User.find(1)

the *ActiveRecord::Base#find* method hits the *ActiveRecord::Base.columns* and caches the columns in @columns, the second time we call *ActiveRecord::Base#find* the columns are already cached so it doesn't hit *connection.columns*, so it wouldn't matter if we call *super* in the adapters' column method, at least not the subsequent times.

Of course, the caching is done anyways, but not by the QueryCache#columns method, I'm not saying this is wrong, just that it doesn't work as I'd expect.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Maybe I'm wrong, but as far as I understand, the caching of the
columns names is always[?] done by the
&lt;em&gt;ActiveRecord::Base.columns&lt;/em&gt; method via
&lt;em&gt;@columns&lt;/em&gt;:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://bit.ly/9NxQY6&quot;&gt;http://bit.ly/9NxQY6&lt;/a&gt; &amp;lt;
Line 677 of ActiveRecord::Base&lt;/p&gt;
&lt;p&gt;If we do&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;User.find(1)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;the &lt;em&gt;ActiveRecord::Base#find&lt;/em&gt; method hits the
&lt;em&gt;ActiveRecord::Base.columns&lt;/em&gt; and caches the columns in
@columns, the second time we call &lt;em&gt;ActiveRecord::Base#find&lt;/em&gt;
the columns are already cached so it doesn't hit
&lt;em&gt;connection.columns&lt;/em&gt;, so it wouldn't matter if we call
&lt;em&gt;super&lt;/em&gt; in the adapters' column method, at least not the
subsequent times.&lt;/p&gt;
&lt;p&gt;Of course, the caching is done anyways, but not by the
QueryCache#columns method, I'm not saying this is wrong, just that
it doesn't work as I'd expect.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T16:36:29+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T16:36:31+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">10</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yeah I was just forming the same explanations in my head before posting it here.

My thoughts:
1. The QueryCache#columns method is wrong and should be fixed with the above patch, its clear what the method is trying to do, its a typo. 
2. It appears that the current implementation of QueryCache#columns is not used by the connection adapters. Even if we looked at using super, each adapter has a slightly different implementation of columns and might need some refactoring.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yeah I was just forming the same explanations in my head before
posting it here.&lt;/p&gt;
&lt;p&gt;My thoughts:&lt;br&gt;
1. The QueryCache#columns method is wrong and should be fixed with
the above patch, its clear what the method is trying to do, its a
typo.&lt;br&gt;
2. It appears that the current implementation of QueryCache#columns
is not used by the connection adapters. Even if we looked at using
super, each adapter has a slightly different implementation of
columns and might need some refactoring.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T18:43:05+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T18:43:06+01:00</updated-at>
      <user-id type="integer">30535</user-id>
      <version type="integer">11</version>
      <user-name>Mark Turner</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Maybe we should ask Yehuda how this actually works or should work:

git show d916c62c connection_adapters/abstract/query_cache.rb</body>
      <body-html>&lt;div&gt;&lt;p&gt;Maybe we should ask Yehuda how this actually works or should
work:&lt;/p&gt;
&lt;p&gt;git show d916c62c
connection_adapters/abstract/query_cache.rb&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T19:15:42+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-11T19:15:43+01:00</updated-at>
      <user-id type="integer">86792</user-id>
      <version type="integer">12</version>
      <user-name>rafmagana</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [27fb88aa22d7887138ec02f34eeb01f78043642d]) This method is actually not used, it's implemented on the concrete adapters

[#5331 state:committed]
http://github.com/rails/rails/commit/27fb88aa22d7887138ec02f34eeb01f78043642d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/27fb88aa22d7887138ec02f34eeb01f78043642d&quot;
title=
&quot;Changeset [27fb88aa22d7887138ec02f34eeb01f78043642d]&quot;&gt;[27fb88aa22d7887138ec02f34eeb01f78043642d]&lt;/a&gt;)
This method is actually not used, it's implemented on the concrete
adapters&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5331&quot; title=
&quot;Ticket #5331&quot;&gt;#5331&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/27fb88aa22d7887138ec02f34eeb01f78043642d&quot;&gt;
http://github.com/rails/rails/commit/27fb88aa22d7887138ec02f34eeb01...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-14T01:20:16+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-14T01:20:18+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">13</version>
      <user-name>Repository</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [6373dd466f5c87da51051a4fa427c222c962e46b]) This method is actually not used, it's implemented on the concrete adapters

[#5331 state:committed]
http://github.com/rails/rails/commit/6373dd466f5c87da51051a4fa427c222c962e46b</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/6373dd466f5c87da51051a4fa427c222c962e46b&quot;
title=
&quot;Changeset [6373dd466f5c87da51051a4fa427c222c962e46b]&quot;&gt;[6373dd466f5c87da51051a4fa427c222c962e46b]&lt;/a&gt;)
This method is actually not used, it's implemented on the concrete
adapters&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5331&quot; title=
&quot;Ticket #5331&quot;&gt;#5331&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/6373dd466f5c87da51051a4fa427c222c962e46b&quot;&gt;
http://github.com/rails/rails/commit/6373dd466f5c87da51051a4fa427c2...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-14T01:21:08+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-14T01:21:09+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [48c7ad17b0e87d315b68c0075046fd29e8802e93]) This method is actually not used, it's implemented on the concrete adapters

[#5331 state:committed]
http://github.com/rails/rails/commit/48c7ad17b0e87d315b68c0075046fd29e8802e93</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/48c7ad17b0e87d315b68c0075046fd29e8802e93&quot;
title=
&quot;Changeset [48c7ad17b0e87d315b68c0075046fd29e8802e93]&quot;&gt;[48c7ad17b0e87d315b68c0075046fd29e8802e93]&lt;/a&gt;)
This method is actually not used, it's implemented on the concrete
adapters&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5331&quot; title=
&quot;Ticket #5331&quot;&gt;#5331&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/48c7ad17b0e87d315b68c0075046fd29e8802e93&quot;&gt;
http://github.com/rails/rails/commit/48c7ad17b0e87d315b68c0075046fd...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-14T12:23:28+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-08-14T12:23:34+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">15</version>
      <user-name>Repository</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:02:00+01:00</created-at>
      <creator-id type="integer">86792</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5331</number>
      <permalink>the-columns-method-in-activerecordconnectionadaptersquerycache-module-calls-an-inexistent-args-argument</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>columns query_cache rails3rc</tag>
      <title>The &quot;columns&quot; method in ActiveRecord::ConnectionAdapters::QueryCache module calls an inexistent &quot;args&quot; argument </title>
      <updated-at type="datetime">2010-10-15T23:02:00+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>rafmagana</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5331</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>3421ebbadb73f1710db6c58fe388c11003955688</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-08-08T06:13:27+01:00</created-at>
      <filename>args_param.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">619323</id>
      <size type="integer">958</size>
      <uploader-id type="integer">89656</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/619323/args_param.diff</url>
    </attachment>
  </attachments>
</ticket>
