<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1366</assigned-user-id>
  <attachments-count type="integer">4</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-05-18T17:05:40+01:00</created-at>
  <creator-id type="integer">10014</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4642</number>
  <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
  <title>Unsaved changes to nested attribute collections are lost when using collection</title>
  <updated-at type="datetime">2010-10-15T23:01:54+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">28</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>James Le Cuirot</creator-name>
  <assigned-user-name>Pratik</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>High</priority-name>
  <original-body>&quot;Commit 5efb1503dd88b59fe491dade92790c3f06293445&quot;:http://github.com/rails/rails/commit/5efb1503dd88b59fe491dade92790c3f06293445 causes unsaved changes to records in nested attribute collections to be lost when the collection is used afterwards. This is because the collection is no longer loaded when the update occurs and any subsequent loading afterwards erases the changes.

I tried to find some reasonable way to work around this but even using the new association callbacks doesn't work. If I load the collection with the before_add callback, the record then appears in the collection twice, once from the load and once from the update. Having to load the collection explicitly before any update is just a pain.

I think this feature is fundamentally broken unless some extra code is written to append the records that haven't been updated instead. I therefore would like to see this commit reverted. Attached is a failing test case.

Assigning this to Pratik as it was his commit.</original-body>
  <latest-body>&quot;Commit 5efb1503dd88b59fe491dade92790c3f06293445&quot;:http://github.com/rails/rails/commit/5efb1503dd88b59fe491dade92790c3f06293445 causes unsaved changes to records in nested attribute collections to be lost when the collection is used afterwards. This is because the collection is no longer loaded when the update occurs and any subsequent loading afterwards erases the changes.

I tried to find some reasonable way to work around this but even using the new association callbacks doesn't work. If I load the collection with the before_add callback, the record then appears in the collection twice, once from the load and once from the update. Having to load the collection explicitly before any update is just a pain.

I think this feature is fundamentally broken unless some extra code is written to append the records that haven't been updated instead. I therefore would like to see this commit reverted. Attached is a failing test case.

Assigning this to Pratik as it was his commit.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/5efb1503dd88b59fe491dade92790c3f06293445&quot;&gt;
Commit 5efb1503dd88b59fe491dade92790c3f06293445&lt;/a&gt; causes unsaved
changes to records in nested attribute collections to be lost when
the collection is used afterwards. This is because the collection
is no longer loaded when the update occurs and any subsequent
loading afterwards erases the changes.&lt;/p&gt;
&lt;p&gt;I tried to find some reasonable way to work around this but even
using the new association callbacks doesn't work. If I load the
collection with the before_add callback, the record then appears in
the collection twice, once from the load and once from the update.
Having to load the collection explicitly before any update is just
a pain.&lt;/p&gt;
&lt;p&gt;I think this feature is fundamentally broken unless some extra
code is written to append the records that haven't been updated
instead. I therefore would like to see this commit reverted.
Attached is a failing test case.&lt;/p&gt;
&lt;p&gt;Assigning this to Pratik as it was his commit.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&quot;Commit 5efb1503dd88b59fe491dade92790c3f06293445&quot;:http://github.com/rails/rails/commit/5efb1503dd88b59fe491dade92790c3f06293445 causes unsaved changes to records in nested attribute collections to be lost when the collection is used afterwards. This is because the collection is no longer loaded when the update occurs and any subsequent loading afterwards erases the changes.

I tried to find some reasonable way to work around this but even using the new association callbacks doesn't work. If I load the collection with the before_add callback, the record then appears in the collection twice, once from the load and once from the update. Having to load the collection explicitly before any update is just a pain.

I think this feature is fundamentally broken unless some extra code is written to append the records that haven't been updated instead. I therefore would like to see this commit reverted. Attached is a failing test case.

Assigning this to Pratik as it was his commit.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/5efb1503dd88b59fe491dade92790c3f06293445&quot;&gt;
Commit 5efb1503dd88b59fe491dade92790c3f06293445&lt;/a&gt; causes unsaved
changes to records in nested attribute collections to be lost when
the collection is used afterwards. This is because the collection
is no longer loaded when the update occurs and any subsequent
loading afterwards erases the changes.&lt;/p&gt;
&lt;p&gt;I tried to find some reasonable way to work around this but even
using the new association callbacks doesn't work. If I load the
collection with the before_add callback, the record then appears in
the collection twice, once from the load and once from the update.
Having to load the collection explicitly before any update is just
a pain.&lt;/p&gt;
&lt;p&gt;I think this feature is fundamentally broken unless some extra
code is written to append the records that haven't been updated
instead. I therefore would like to see this commit reverted.
Attached is a failing test case.&lt;/p&gt;
&lt;p&gt;Assigning this to Pratik as it was his commit.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-18T17:05:40+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-05-18T17:05:43+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">1</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-18T17:06:46+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-05-18T17:06:49+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">2</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-21T00:49:35+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-05-21T00:49:37+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">3</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Same problem here and no good workaround.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same problem here and no good workaround.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-26T22:52:40+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-05-26T22:52:45+01:00</updated-at>
      <user-id type="integer">43598</user-id>
      <version type="integer">4</version>
      <user-name>Raphael Emourgeon</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I&quot;m not sure if my problem is exactly the same as reported here, but I've narrowed the cause down to the same commit.  My issue is that the _destroy attributes in my nested collection hashes aren't causing ActiveRecord to remove the referenced members from the collection.  It doesn't happen for all of my models using nested attribute, though.

I'll try to squash it down to a simple example soon.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I&quot;m not sure if my problem is exactly the same as reported here,
but I've narrowed the cause down to the same commit. My issue is
that the _destroy attributes in my nested collection hashes aren't
causing ActiveRecord to remove the referenced members from the
collection. It doesn't happen for all of my models using nested
attribute, though.&lt;/p&gt;
&lt;p&gt;I'll try to squash it down to a simple example soon.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T23:38:46+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-03T23:38:55+01:00</updated-at>
      <user-id type="integer">18094</user-id>
      <version type="integer">5</version>
      <user-name>Pete Deffendol</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think that would happen if you're somehow loading (i.e. accessing) the collection before the parent record is finally saved.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think that would happen if you're somehow loading (i.e.
accessing) the collection before the parent record is finally
saved.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T23:51:56+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-03T23:52:04+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">6</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I stripped down my model and controller to pinpoint the problem, and it turns out that I have a custom validation method that is accessing the collection before it is being saved.  So, yes, I have the same problem as the other commenters to this ticket.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I stripped down my model and controller to pinpoint the problem,
and it turns out that I have a custom validation method that is
accessing the collection before it is being saved. So, yes, I have
the same problem as the other commenters to this ticket.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-04T17:13:47+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-04T17:13:54+01:00</updated-at>
      <user-id type="integer">18094</user-id>
      <version type="integer">7</version>
      <user-name>Pete Deffendol</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Here's a possible fix that doesn't involve removing the feature. Records that are already present in the collection are removed from the records that are loaded. I tried to make it not load these existings records in the first place but I couldn't get it to work.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's a possible fix that doesn't involve removing the feature.
Records that are already present in the collection are removed from
the records that are loaded. I tried to make it not load these
existings records in the first place but I couldn't get it to
work.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-06T13:05:21+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-06T13:05:31+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">8</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Oh and I wasn't sure if it was worth preserving the order of the loaded records. With the above patch, updated records would appear on the end. Does this matter? Maybe it does for things like acts_as_list. If so, I'll adjust it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Oh and I wasn't sure if it was worth preserving the order of the
loaded records. With the above patch, updated records would appear
on the end. Does this matter? Maybe it does for things like
acts_as_list. If so, I'll adjust it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-06T13:11:08+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-06T13:11:17+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">9</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Is #4766 duplicate of this one?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Is &lt;a href=&quot;/projects/8994/tickets/4766&quot; title=
&quot;Ticket #4766&quot;&gt;#4766&lt;/a&gt; duplicate of this one?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-07T20:48:27+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-07T20:48:36+01:00</updated-at>
      <user-id type="integer">55442</user-id>
      <version type="integer">10</version>
      <user-name>Jarl Friis</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Yes!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-07T21:18:07+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-07T21:18:19+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">11</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hey James,

Yeah, I think it'll be good to preserve the order. Could you also use git-format-patch for generating the patch so that you're credited when it gets committed. Might be a good idea to combine test and fix too.

Thanks !</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey James,&lt;/p&gt;
&lt;p&gt;Yeah, I think it'll be good to preserve the order. Could you
also use git-format-patch for generating the patch so that you're
credited when it gets committed. Might be a good idea to combine
test and fix too.&lt;/p&gt;
&lt;p&gt;Thanks !&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T23:30:08+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-08T23:30:17+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">12</version>
      <user-name>Pratik</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Here you go. I thought it might be as simple as `find_target.map { |r| @target.delete(r) || r } + @target` but to my surprise, Array#delete returns the object you give it, not the object that was actually deleted.

I haven't tried this with _destroy but it should work just the same.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here you go. I thought it might be as simple as
&lt;code&gt;find_target.map { |r| @target.delete(r) || r } +
@target&lt;/code&gt; but to my surprise, Array#delete returns the object
you give it, not the object that was actually deleted.&lt;/p&gt;
&lt;p&gt;I haven't tried this with _destroy but it should work just the
same.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-09T12:40:26+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: active_record &quot;nested attributes&quot; testcase
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-09T12:40:35+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">13</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [0265c708b9696c3943518ad5f3dabdc22c5eba11]) Don't overwrite unsaved updates when loading an association but preserve the order of the loaded records. [#4642 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/0265c708b9696c3943518ad5f3dabdc22c5eba11</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11&quot;
title=
&quot;Changeset [0265c708b9696c3943518ad5f3dabdc22c5eba11]&quot;&gt;[0265c708b9696c3943518ad5f3dabdc22c5eba11]&lt;/a&gt;)
Don't overwrite unsaved updates when loading an association but
preserve the order of the loaded records. [&lt;a href=
&quot;/projects/8994/tickets/4642&quot; title=&quot;Ticket #4642&quot;&gt;#4642&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a&gt;pratiknaik@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/0265c708b9696c3943518ad5f3dabdc22c5eba11&quot;&gt;
http://github.com/rails/rails/commit/0265c708b9696c3943518ad5f3dabd...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-09T13:48:56+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-09T13:49:10+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [b41c3ba154c2038ecc7b230693662257833869b8]) Don't overwrite unsaved updates when loading an association but preserve the order of the loaded records. [#4642 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/b41c3ba154c2038ecc7b230693662257833869b8</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/b41c3ba154c2038ecc7b230693662257833869b8&quot;
title=
&quot;Changeset [b41c3ba154c2038ecc7b230693662257833869b8]&quot;&gt;[b41c3ba154c2038ecc7b230693662257833869b8]&lt;/a&gt;)
Don't overwrite unsaved updates when loading an association but
preserve the order of the loaded records. [&lt;a href=
&quot;/projects/8994/tickets/4642&quot; title=&quot;Ticket #4642&quot;&gt;#4642&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a&gt;pratiknaik@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/b41c3ba154c2038ecc7b230693662257833869b8&quot;&gt;
http://github.com/rails/rails/commit/b41c3ba154c2038ecc7b2306936622...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-09T13:50:49+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-09T13:51:03+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">15</version>
      <user-name>Repository</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [85cc1fa657f441417f36998a32a6a158c2697aad]) Revert &quot;Don't overwrite unsaved updates when loading an association but preserve the order of the loaded records. [#4642 state:open]&quot;

This commit introduced a regression described in ticket [#4830].

This reverts commit 0265c708b9696c3943518ad5f3dabdc22c5eba11.
http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a158c2697aad</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/85cc1fa657f441417f36998a32a6a158c2697aad&quot;
title=
&quot;Changeset [85cc1fa657f441417f36998a32a6a158c2697aad]&quot;&gt;[85cc1fa657f441417f36998a32a6a158c2697aad]&lt;/a&gt;)
Revert &quot;Don't overwrite unsaved updates when loading an association
but preserve the order of the loaded records. [&lt;a href=
&quot;/projects/8994/tickets/4642&quot; title=&quot;Ticket #4642&quot;&gt;#4642&lt;/a&gt;
state:open]&quot;&lt;/p&gt;
&lt;p&gt;This commit introduced a regression described in ticket
[&lt;a href=&quot;/projects/8994/tickets/4830&quot; title=
&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt;].&lt;/p&gt;
&lt;p&gt;This reverts commit
0265c708b9696c3943518ad5f3dabdc22c5eba11.&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a158c2697aad&quot;&gt;
http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a1...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-11T16:07:16+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-11T16:07:28+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">16</version>
      <user-name>Repository</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Guys,

This commit was reverted because it make Sam's Ruby test suite (that runs the Depot web application for the Agile Web Development with Rails) fail.

Sam attached a failing scenario at ticket #4830. Could someone please work on it?

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Guys,&lt;/p&gt;
&lt;p&gt;This commit was reverted because it make Sam's Ruby test suite
(that runs the Depot web application for the Agile Web Development
with Rails) fail.&lt;/p&gt;
&lt;p&gt;Sam attached a failing scenario at ticket &lt;a href=
&quot;/projects/8994/tickets/4830&quot; title=&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt;. Could
someone please work on it?&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-11T17:25:03+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-11T17:25:15+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">17</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>On a side note, rolling back this commit prevents nested attributes that are not mapped to database fields from being updated.</body>
      <body-html>&lt;div&gt;&lt;p&gt;On a side note, rolling back this commit prevents nested
attributes that are not mapped to database fields from being
updated.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T15:47:51+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-17T15:48:04+01:00</updated-at>
      <user-id type="integer">86706</user-id>
      <version type="integer">18</version>
      <user-name>Jeff Bigler</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Don't worry, I have fixed the above failure in a way that satisfies both issues. See #4830.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Don't worry, I have fixed the above failure in a way that
satisfies both issues. See &lt;a href=&quot;/projects/8994/tickets/4830&quot;
title=&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T16:00:49+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-17T16:05:09+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">19</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-17T18:41:37+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-17T18:42:27+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">20</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>at :allow_destroy -&gt; true, I'm still loosing _destroy attribute</body>
      <body-html>&lt;div&gt;&lt;p&gt;at :allow_destroy -&amp;gt; true, I'm still loosing _destroy
attribute&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-30T00:37:35+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-30T00:37:46+01:00</updated-at>
      <user-id type="integer">101835</user-id>
      <version type="integer">21</version>
      <user-name>helg</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Damn. Sorry. I should have tested that explicitly. Now I have and here's a patch with a fix. Note that this will still load any outside updates to the record if there haven't been any locally. The key difference is that the destruction property is carried across.

Devs, please apply this to master and 2-3-stable ASAP.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Damn. Sorry. I should have tested that explicitly. Now I have
and here's a patch with a fix. Note that this will still load any
outside updates to the record if there haven't been any locally.
The key difference is that the destruction property is carried
across.&lt;/p&gt;
&lt;p&gt;Devs, please apply this to master and 2-3-stable ASAP.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-30T23:40:09+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>duplicate</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-06-30T23:40:25+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">22</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [f3fedd7f84c25d1d99a70af1e21e20abb48f100f]) Don't remove scheduled destroys when loading an association. [#4642 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/f3fedd7f84c25d1d99a70af1e21e20abb48f100f</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f3fedd7f84c25d1d99a70af1e21e20abb48f100f&quot;
title=
&quot;Changeset [f3fedd7f84c25d1d99a70af1e21e20abb48f100f]&quot;&gt;[f3fedd7f84c25d1d99a70af1e21e20abb48f100f]&lt;/a&gt;)
Don't remove scheduled destroys when loading an association.
[&lt;a href=&quot;/projects/8994/tickets/4642&quot; title=
&quot;Ticket #4642&quot;&gt;#4642&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a href=
&quot;mailto:jose.valim@gmail.com&quot;&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/f3fedd7f84c25d1d99a70af1e21e20abb48f100f&quot;&gt;
http://github.com/rails/rails/commit/f3fedd7f84c25d1d99a70af1e21e20...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-01T00:07:24+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:state: duplicate
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-07-01T00:07:34+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">23</version>
      <user-name>Repository</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Why is Milestone not set to 2.3.9 on this ticket (as it is on ticket #4766) when it apparently is high-priority? Version 2.3.8 is seriously broken with this bug.

Further when milestone is set to 2.3.9 (please...), then the patch should also be applied to 2-3-stable. I am still stuck with 2.3.5 due to this bug... Hoping to see the fix in 2.3.9 before being forced to upgrade to 3.x one day.

Jarl</body>
      <body-html>&lt;div&gt;&lt;p&gt;Why is Milestone not set to 2.3.9 on this ticket (as it is on
ticket &lt;a href=&quot;/projects/8994/tickets/4766&quot; title=
&quot;Ticket #4766&quot;&gt;#4766&lt;/a&gt;) when it apparently is high-priority?
Version 2.3.8 is seriously broken with this bug.&lt;/p&gt;
&lt;p&gt;Further when milestone is set to 2.3.9 (please...), then the
patch should also be applied to 2-3-stable. I am still stuck with
2.3.5 due to this bug... Hoping to see the fix in 2.3.9 before
being forced to upgrade to 3.x one day.&lt;/p&gt;
&lt;p&gt;Jarl&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-03T11:43:23+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-08-03T11:43:26+01:00</updated-at>
      <user-id type="integer">55442</user-id>
      <version type="integer">24</version>
      <user-name>Jarl Friis</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>This was also applied on 2-3-stable. Please check the commits on Github.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This was also applied on 2-3-stable. Please check the commits on
Github.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-03T11:45:51+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-08-03T11:45:53+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">25</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Thanks for the info, I really tried to find the info myself (I really did), but lack of experience with github and git made me run a 
    git branch --contains f3fedd7f84c25d1d99a70af1e21e20abb48f100f
but that only revealed the master branch (because the commit on the 2-3-stable was a different commit). I would have expcted a commit on one branch and the a cherry-pick merge from one to the other... 

Thanks and sorry for the inconvenience.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for the info, I really tried to find the info myself (I
really did), but lack of experience with github and git made me run
a&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;git branch --contains f3fedd7f84c25d1d99a70af1e21e20abb48f100f&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but that only revealed the master branch (because the commit on
the 2-3-stable was a different commit). I would have expcted a
commit on one branch and the a cherry-pick merge from one to the
other...&lt;/p&gt;
&lt;p&gt;Thanks and sorry for the inconvenience.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-03T12:19:36+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-08-03T12:19:38+01:00</updated-at>
      <user-id type="integer">55442</user-id>
      <version type="integer">26</version>
      <user-name>Jarl Friis</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>No problem! I usually cherry pick commits from one branch to another but that is not always possible. :(</body>
      <body-html>&lt;div&gt;&lt;p&gt;No problem! I usually cherry pick commits from one branch to
another but that is not always possible. :(&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-03T12:22:43+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-08-03T12:22:46+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">27</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:54+01:00</created-at>
      <creator-id type="integer">10014</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4642</number>
      <permalink>unsaved-changes-to-nested-attribute-collections-are-lost-when-using-collection</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record &quot;nested attributes&quot; patch testcase</tag>
      <title>Unsaved changes to nested attribute collections are lost when using collection</title>
      <updated-at type="datetime">2010-10-15T23:01:54+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">28</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>James Le Cuirot</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4642</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>7f8994756815960727595afe7b739e9eef44c400</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-18T17:05:40+01:00</created-at>
      <filename>test_should_not_overwrite_unsaved_updates_when_loading_association.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">525141</id>
      <size type="integer">946</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/525141/test_should_not_overwrite_unsaved_updates_when_loading_association.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>5a0c1ab76069b233466a90b06cb060901f26d7ca</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-06T13:05:22+01:00</created-at>
      <filename>no_overwrite_on_load_target.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">548666</id>
      <size type="integer">1405</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/548666/no_overwrite_on_load_target.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>a7697cf7288dff8f3d45117e1a1da3e3ff3567ca</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-09T12:40:26+01:00</created-at>
      <filename>0001-don-t-overwrite-unsaved-updates-when-loading-an-asso.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">552159</id>
      <size type="integer">3649</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/552159/0001-don-t-overwrite-unsaved-updates-when-loading-an-asso.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>144cd94ca50ddf8eba8fa4f3beac5812b039cefc</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-30T23:40:09+01:00</created-at>
      <filename>0001-don-t-remove-scheduled-destroys-when-loading-an-asso.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">582696</id>
      <size type="integer">2245</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/582696/0001-don-t-remove-scheduled-destroys-when-loading-an-asso.patch</url>
    </attachment>
  </attachments>
</ticket>
