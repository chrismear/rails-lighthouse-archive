<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">12714</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-07-01T10:41:49+01:00</created-at>
  <creator-id type="integer">54884</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5025</number>
  <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>mysql rails3 ruby-192 utf8</tag>
  <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
  <updated-at type="datetime">2011-02-02T18:57:32+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">7</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>humancopy</creator-name>
  <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
  <priority-name>Low</priority-name>
  <original-body>There seems to be a problem with UTF8 strings loaded from a file and inserted with ActiveRecord.
This is only a problem with MySQL, with SQLite it works fine.

Create a database in mysql:
@@@ sql
CREATE DATABASE `example` CHARACTER SET 'utf8';
GRANT ALL PRIVILEGES ON `example`.* TO 'example'@'localhost' IDENTIFIED BY 'example';
FLUSH PRIVILEGES;
@@@

Then extract the attached app, migrate and seed:
@@@
rake db:migrate &amp;&amp; rake db:seed
@@@

You'll see the error:
&quot;\xC3&quot; from ASCII-8BIT to UTF-8

Using rails3-beta4 and ruby-1.9.2.

Thanks. :)</original-body>
  <latest-body>There seems to be a problem with UTF8 strings loaded from a file and inserted with ActiveRecord.
This is only a problem with MySQL, with SQLite it works fine.

Create a database in mysql:
@@@ sql
CREATE DATABASE `example` CHARACTER SET 'utf8';
GRANT ALL PRIVILEGES ON `example`.* TO 'example'@'localhost' IDENTIFIED BY 'example';
FLUSH PRIVILEGES;
@@@

Then extract the attached app, migrate and seed:
@@@
rake db:migrate &amp;&amp; rake db:seed
@@@

You'll see the error:
&quot;\xC3&quot; from ASCII-8BIT to UTF-8

Using rails3-beta4 and ruby-1.9.2.

Thanks. :)</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;There seems to be a problem with UTF8 strings loaded from a file
and inserted with ActiveRecord.&lt;br&gt;
This is only a problem with MySQL, with SQLite it works fine.&lt;/p&gt;
&lt;p&gt;Create a database in mysql:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;CREATE DATABASE &lt;/code&gt;example CHARACTER SET 'utf8';
GRANT ALL PRIVILEGES ON &lt;code&gt;example&lt;/code&gt;.* TO 'example'@'localhost' IDENTIFIED BY 'example';
FLUSH PRIVILEGES;
&lt;/pre&gt;
&lt;p&gt;Then extract the attached app, migrate and seed:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;rake db:migrate &amp;amp;&amp;amp; rake db:seed&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;You'll see the error:&lt;br&gt;
&quot;\xC3&quot; from ASCII-8BIT to UTF-8&lt;/p&gt;
&lt;p&gt;Using rails3-beta4 and ruby-1.9.2.&lt;/p&gt;
&lt;p&gt;Thanks. :)&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>There seems to be a problem with UTF8 strings loaded from a file and inserted with ActiveRecord.
This is only a problem with MySQL, with SQLite it works fine.

Create a database in mysql:
@@@ sql
CREATE DATABASE `example` CHARACTER SET 'utf8';
GRANT ALL PRIVILEGES ON `example`.* TO 'example'@'localhost' IDENTIFIED BY 'example';
FLUSH PRIVILEGES;
@@@

Then extract the attached app, migrate and seed:
@@@
rake db:migrate &amp;&amp; rake db:seed
@@@

You'll see the error:
&quot;\xC3&quot; from ASCII-8BIT to UTF-8

Using rails3-beta4 and ruby-1.9.2.

Thanks. :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;There seems to be a problem with UTF8 strings loaded from a file
and inserted with ActiveRecord.&lt;br&gt;
This is only a problem with MySQL, with SQLite it works fine.&lt;/p&gt;
&lt;p&gt;Create a database in mysql:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;CREATE DATABASE &lt;/code&gt;example CHARACTER SET 'utf8';
GRANT ALL PRIVILEGES ON &lt;code&gt;example&lt;/code&gt;.* TO 'example'@'localhost' IDENTIFIED BY 'example';
FLUSH PRIVILEGES;
&lt;/pre&gt;
&lt;p&gt;Then extract the attached app, migrate and seed:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;rake db:migrate &amp;amp;&amp;amp; rake db:seed&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;You'll see the error:&lt;br&gt;
&quot;\xC3&quot; from ASCII-8BIT to UTF-8&lt;/p&gt;
&lt;p&gt;Using rails3-beta4 and ruby-1.9.2.&lt;/p&gt;
&lt;p&gt;Thanks. :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T10:41:49+01:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3 ruby-1.9.2 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2010-07-01T10:41:59+01:00</updated-at>
      <user-id type="integer">54884</user-id>
      <version type="integer">1</version>
      <user-name>humancopy</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>If you can add unicode data into the Database via the MySQL console then I think this is a problem with the mysql gem and not Rails. Can you try opening a similar issue here http://rubyforge.org/tracker/?group_id=4550 ?

In the mean time can somebody confirm if this is indeed a Rails issue or not?</body>
      <body-html>&lt;div&gt;&lt;p&gt;If you can add unicode data into the Database via the MySQL
console then I think this is a problem with the mysql gem and not
Rails. Can you try opening a similar issue here &lt;a href=
&quot;http://rubyforge.org/tracker/?group_id=4550&quot;&gt;http://rubyforge.org/tracker/?group_id=4550&lt;/a&gt;
?&lt;/p&gt;
&lt;p&gt;In the mean time can somebody confirm if this is indeed a Rails
issue or not?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T13:16:54+01:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: rails3 ruby-1.9.2 utf8
:state: new
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql rails3 ruby-1.9.2 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2010-07-01T13:16:59+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">2</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I can confirm that without rails it works. :)
For example, this works fine:

@@@ ruby
require 'mysql'

c = Mysql.init
# host, username, password, database
c.connect(nil, &quot;example&quot;, &quot;example&quot;, &quot;example&quot;)
insert_new_country = c.prepare &quot;INSERT INTO `countries` (name, code2, code3) VALUES (?, ? ,?)&quot;
  
open('countries.csv', 'r:UTF-8') do |countries|
  countries.read.each_line do |country|
    code2, code3, name = country.chomp.split(&quot;|&quot;)
    insert_new_country.execute name, code2, code3
  end
end

c.close
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that without rails it works. :)&lt;br&gt;
For example, this works fine:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;require 'mysql'

c = Mysql.init
# host, username, password, database
c.connect(nil, &quot;example&quot;, &quot;example&quot;, &quot;example&quot;)
insert_new_country = c.prepare &quot;INSERT INTO `countries` (name, code2, code3) VALUES (?, ? ,?)&quot;
  
open('countries.csv', 'r:UTF-8') do |countries|
  countries.read.each_line do |country|
    code2, code3, name = country.chomp.split(&quot;|&quot;)
    insert_new_country.execute name, code2, code3
  end
end

c.close&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T13:57:10+01:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql rails3 ruby-1.9.2 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2010-07-01T13:57:16+01:00</updated-at>
      <user-id type="integer">54884</user-id>
      <version type="integer">3</version>
      <user-name>humancopy</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Your example works fine outside Rails because your code is not iterating with any other IO or String. This is a bug in MySQL gem which is not marking the encoding of the strings.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Your example works fine outside Rails because your code is not
iterating with any other IO or String. This is a bug in MySQL gem
which is not marking the encoding of the strings.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T14:07:53+01:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql rails3 ruby-1.9.2 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2010-07-01T14:07:58+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">4</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T14:16:30+01:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql rails3 ruby-1.9.2 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2010-07-01T14:16:38+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">5</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T17:01:12+00:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: mysql rails3 ruby-1.9.2 utf8
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql rails3 ruby-192 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2011-02-02T18:56:09+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">6</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T17:01:13+00:00</created-at>
      <creator-id type="integer">54884</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5025</number>
      <permalink>from-ascii-8bit-to-utf-8-error-with-mysql-seed-from-csv-file</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>mysql rails3 ruby-192 utf8</tag>
      <title>from ASCII-8BIT to UTF-8 error with MySQL seed from CSV file</title>
      <updated-at type="datetime">2011-02-02T18:57:32+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>humancopy</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5025</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>5a462a23f28af8afbeab727ea2411d89ffa8d6ee</code>
      <content-type>application/zip</content-type>
      <created-at type="datetime">2010-07-01T10:41:49+01:00</created-at>
      <filename>example-utf8.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">583154</id>
      <size type="integer">97181</size>
      <uploader-id type="integer">54884</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/583154/example-utf8.zip</url>
    </attachment>
  </attachments>
</ticket>
