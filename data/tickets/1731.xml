<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-08T23:12:08+00:00</created-at>
  <creator-id type="integer">19965</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1731</number>
  <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>2-3-stable actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
  <title>Make enable_starttls_auto opt-in in ActionMailer</title>
  <updated-at type="datetime">2010-11-08T23:12:08+00:00</updated-at>
  <user-id type="integer">81551</user-id>
  <version type="integer">20</version>
  <user-name>Andrea Campi</user-name>
  <creator-name>Jos&#233; Valim</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
  <priority-name nil="true"></priority-name>
  <original-body>This commit:

http://github.com/rails/rails/commit/732c724df61bc8b780dc42817625b25a321908e4

Enabled automatically STARTTLS in SMPT server making some applications break.

This patch makes enable_starttls_auto opt-in.</original-body>
  <latest-body>This commit:

http://github.com/rails/rails/commit/732c724df61bc8b780dc42817625b25a321908e4

Enabled automatically STARTTLS in SMPT server making some applications break.

This patch makes enable_starttls_auto opt-in.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;This commit:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://github.com/rails/rails/commit/732c724df61bc8b780dc42817625b25a321908e4&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Enabled automatically STARTTLS in SMPT server making some
applications break.&lt;/p&gt;
&lt;p&gt;This patch makes enable_starttls_auto opt-in.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This commit:

http://github.com/rails/rails/commit/732c724df61bc8b780dc42817625b25a321908e4

Enabled automatically STARTTLS in SMPT server making some applications break.

This patch makes enable_starttls_auto opt-in.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This commit:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://github.com/rails/rails/commit/732c724df61bc8b780dc42817625b25a321908e4&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Enabled automatically STARTTLS in SMPT server making some
applications break.&lt;/p&gt;
&lt;p&gt;This patch makes enable_starttls_auto opt-in.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-11T10:14:58+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-01-11T18:18:38+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">1</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-11T14:52:47+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-01-11T18:20:25+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">2</version>
      <user-name>Pratik</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Pushed with default to true.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Pushed with default to true.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-18T04:18:48+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-01-18T04:18:50+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [c2e7851fb20d24f49b55b5276cc3056082721dc4]) Add ActionMailer::Base#enable_starttls_auto option for enabling/disabling STARTTLS. [#1731 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/c2e7851fb20d24f49b55b5276cc3056082721dc4</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [c2e7851fb20d24f49b55b5276cc3056082721dc4]) Add
ActionMailer::Base#enable_starttls_auto option for
enabling/disabling STARTTLS. [&lt;a href=&quot;/projects/8994/tickets/1731&quot; title=&quot;Ticket #1731&quot;&gt;#1731&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a href=&quot;mailto:pratiknaik@gmail.com&quot;&gt;pratiknaik@gmail.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/c2e7851fb20d24f49b55b5276cc3056082721dc4&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-18T04:19:35+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-01-18T04:19:36+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Pratik,

I just let it false because some applications were breaking.

I wanted to avoid the situation that someone is complaining that something is not working and then we had to reply that he have to set something to false in order to make everything work.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Pratik,&lt;/p&gt;
&lt;p&gt;I just let it false because some applications were breaking.&lt;/p&gt;
&lt;p&gt;I wanted to avoid the situation that someone is complaining that
something is not working and then we had to reply that he have to
set something to false in order to make everything work.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-18T08:02:14+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-01-18T08:02:17+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">5</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>hi,
em, I'm just trying to get my website to use actionmailer.  I've not been successful.  The error I get is always getaddrinfo: Name or service not known.

the 500 error I get throws the following information into the logfile:

SocketError (getaddrinfo: Name or service not known):
    /usr/lib/ruby/1.8/net/protocol.rb:206:in `initialize'
    /usr/lib/ruby/1.8/net/protocol.rb:206:in `new'
    /usr/lib/ruby/1.8/net/protocol.rb:206:in `old_open'
    /usr/lib/ruby/1.8/timeout.rb:62:in `timeout'
    /usr/lib/ruby/1.8/timeout.rb:93:in `timeout'
    /usr/lib/ruby/1.8/net/protocol.rb:206:in `old_open'
    /usr/lib/ruby/1.8/net/smtp.rb:392:in `do_start'
    /usr/lib/ruby/1.8/net/smtp.rb:377:in `start'
    /usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:671:in `perform_delivery_smtp'
    /usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:526:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:526:in `deliver!'
    /usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:392:in `method_missing'
    /app/controllers/contact_controller.rb:26:in `contact_me'

I did a search on base.rb:392:in `method_missing' and found this site.

my smtp settings in production.rb are as follows:
config.action_mailer.smtp_settings = {
        :domain         =&gt; 'domain.com',
        :address        =&gt; 'localhost',
        :port           =&gt; 25,
        :user_name      =&gt; 'user',
        :password       =&gt; 'passwd',        
        :authentication =&gt; :login
}

my production smtp server doesn't require tls.. 

Will the diff patch fix my problem?

How do I apply it?

thanx!
L</body>
      <body-html>&lt;div&gt;&lt;p&gt;hi, em, I'm just trying to get my website to use actionmailer.
I've not been successful. The error I get is always getaddrinfo:
Name or service not known.&lt;/p&gt;
&lt;p&gt;the 500 error I get throws the following information into the
logfile:&lt;/p&gt;
&lt;p&gt;SocketError (getaddrinfo: Name or service not known):&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/usr/lib/ruby/1.8/net/protocol.rb:206:in `initialize'
/usr/lib/ruby/1.8/net/protocol.rb:206:in `new'
/usr/lib/ruby/1.8/net/protocol.rb:206:in `old_open'
/usr/lib/ruby/1.8/timeout.rb:62:in `timeout'
/usr/lib/ruby/1.8/timeout.rb:93:in `timeout'
/usr/lib/ruby/1.8/net/protocol.rb:206:in `old_open'
/usr/lib/ruby/1.8/net/smtp.rb:392:in `do_start'
/usr/lib/ruby/1.8/net/smtp.rb:377:in `start'
/usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:671:in `perform_delivery_smtp'
/usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:526:in `__send__'
/usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:526:in `deliver!'
/usr/lib/ruby/gems/1.8/gems/actionmailer-2.2.2/lib/action_mailer/base.rb:392:in `method_missing'
/app/controllers/contact_controller.rb:26:in `contact_me'
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I did a search on base.rb:392:in &lt;code&gt;method_missing' and found
this site.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;my smtp settings in production.rb are as follows:
config.action_mailer.smtp_settings = {&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    :domain         =&amp;gt; 'domain.com',
    :address        =&amp;gt; 'localhost',
    :port           =&amp;gt; 25,
    :user_name      =&amp;gt; 'user',
    :password       =&amp;gt; 'passwd',        
    :authentication =&amp;gt; :login
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;my production smtp server doesn't require tls..&lt;/p&gt;
&lt;p&gt;Will the diff patch fix my problem?&lt;/p&gt;
&lt;p&gt;How do I apply it?&lt;/p&gt;
&lt;p&gt;thanx! L&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-05T01:50:09+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-05T01:50:11+00:00</updated-at>
      <user-id type="integer">46279</user-id>
      <version type="integer">6</version>
      <user-name>jts</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>jts,

The patch was already applied into core.

Try changing your configurations to:

  config.action_mailer.smtp_settings = {
    :domain               =&gt; 'domain.com',
    :address              =&gt; 'localhost',
    :port                 =&gt; 25,
    :user_name            =&gt; 'user',
    :password             =&gt; 'passwd',        
    :authentication       =&gt; :login,
    :enable_starttls_auto =&gt; false
  }

The problem is that enable_starttls_auto comes true by default.

Tell us if that worked! :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;jts,&lt;/p&gt;
&lt;p&gt;The patch was already applied into core.&lt;/p&gt;
&lt;p&gt;Try changing your configurations to:&lt;/p&gt;
&lt;p&gt;config.action_mailer.smtp_settings = {&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;:domain               =&amp;gt; 'domain.com',
:address              =&amp;gt; 'localhost',
:port                 =&amp;gt; 25,
:user_name            =&amp;gt; 'user',
:password             =&amp;gt; 'passwd',        
:authentication       =&amp;gt; :login,
:enable_starttls_auto =&amp;gt; false
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;The problem is that enable_starttls_auto comes true by
default.&lt;/p&gt;
&lt;p&gt;Tell us if that worked! :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-05T09:23:55+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-05T09:24:00+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">7</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hi Jose,
thanks for your response, much appreciated.

Unfortunately, I'd already tried :enable_starttls_auto =&gt; false in the configuration seetings and no joy, I'm still receiving the _same_ error message.

The production log file looks like this for the POST to the controller responsible for mailing
Parameters: {&quot;name&quot;=&gt;&quot;test user&quot;, &quot;message&quot;=&gt;&quot;testing&quot;, &quot;commit&quot;=&gt;&quot;send message&quot;, &quot;authenticity_token&quot;=&gt;&quot;a550eb2ff258d7fef0018lfkdofijd3388961d5&quot;, &quot;website&quot;=&gt;&quot;test message&quot;, &quot;email&quot;=&gt;&quot;jts@gmail.com&quot;}
Sent mail to jts@gmail.com
getaddrinfo: Name or service not known

The fact that I'm getting the message &quot;Sent mail to jts@gmail.com&quot; suggests that the call to UserMailer.deliver_contact_form is working correctly, but that something fails in communicating with the smtp service.

I've tried POP auth before SMTP too, no luck.. And my hosting provider support is useless.  They've suggested trying localhost as the domain twice now !!!

Is there anything else I might check?

for your info, here's the versions of ruby &amp; rails I have installed on production, dunno if it'll help..

ruby 1.8.6 (2008-08-11 patchlevel 287) [x86_64-linux]
Rails 2.2.2
local gems:

actionmailer (2.2.2, 2.1.2)
actionpack (2.2.2, 2.1.2)
activerecord (2.2.2, 2.1.2)
activeresource (2.2.2, 2.1.2)
activesupport (2.2.2, 2.1.2)
builder (2.1.2)
cgi_multipart_eof_fix (2.5.0)
daemons (1.0.10)
fastthread (1.0.1)
fcgi (0.8.7)
gem_plugin (0.2.3)
hpricot (0.6.164)
login_generator (1.2.2)
mislav-will_paginate (2.3.6, 2.2.3)
mongrel (1.1.5)
mongrel_cluster (1.0.5)
mysql (2.7)
radiant (0.6.9)
rails (2.2.2, 2.1.2)
rake (0.8.3)
RedCloth (4.1.1)
rmagick (1.15.17)
sqlite3-ruby (1.2.4)
tzinfo (0.3.12)
will_paginate (2.2.2)

thanks for any advice you might be able to think of!
L</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Jose, thanks for your response, much appreciated.&lt;/p&gt;
&lt;p&gt;Unfortunately, I'd already tried :enable_starttls_auto =&amp;gt;
false in the configuration seetings and no joy, I'm still receiving
the &lt;em&gt;same&lt;/em&gt; error message.&lt;/p&gt;
&lt;p&gt;The production log file looks like this for the POST to the
controller responsible for mailing Parameters: {&quot;name&quot;=&amp;gt;&quot;test
user&quot;, &quot;message&quot;=&amp;gt;&quot;testing&quot;, &quot;commit&quot;=&amp;gt;&quot;send message&quot;,
&quot;authenticity_token&quot;=&amp;gt;&quot;a550eb2ff258d7fef0018lfkdofijd3388961d5&quot;,
&quot;website&quot;=&amp;gt;&quot;test message&quot;, &quot;email&quot;=&amp;gt;&quot;&lt;a href=&quot;mailto:jts@gmail.com&quot;&gt;jts@gmail.com&lt;/a&gt;&quot;} Sent mail to &lt;a href=&quot;mailto:jts@gmail.com&quot;&gt;jts@gmail.com&lt;/a&gt; getaddrinfo: Name or
service not known&lt;/p&gt;
&lt;p&gt;The fact that I'm getting the message &quot;Sent mail to &lt;a href=&quot;mailto:jts@gmail.com&quot;&gt;jts@gmail.com&lt;/a&gt;&quot; suggests that the call to
UserMailer.deliver_contact_form is working correctly, but that
something fails in communicating with the smtp service.&lt;/p&gt;
&lt;p&gt;I've tried POP auth before SMTP too, no luck.. And my hosting
provider support is useless. They've suggested trying localhost as
the domain twice now !!!&lt;/p&gt;
&lt;p&gt;Is there anything else I might check?&lt;/p&gt;
&lt;p&gt;for your info, here's the versions of ruby &amp;amp; rails I have
installed on production, dunno if it'll help..&lt;/p&gt;
&lt;p&gt;ruby 1.8.6 (2008-08-11 patchlevel 287) [x86_64-linux] Rails
2.2.2 local gems:&lt;/p&gt;
&lt;p&gt;actionmailer (2.2.2, 2.1.2) actionpack (2.2.2, 2.1.2)
activerecord (2.2.2, 2.1.2) activeresource (2.2.2, 2.1.2)
activesupport (2.2.2, 2.1.2) builder (2.1.2) cgi_multipart_eof_fix
(2.5.0) daemons (1.0.10) fastthread (1.0.1) fcgi (0.8.7) gem_plugin
(0.2.3) hpricot (0.6.164) login_generator (1.2.2)
mislav-will_paginate (2.3.6, 2.2.3) mongrel (1.1.5) mongrel_cluster
(1.0.5) mysql (2.7) radiant (0.6.9) rails (2.2.2, 2.1.2) rake
(0.8.3) RedCloth (4.1.1) rmagick (1.15.17) sqlite3-ruby (1.2.4)
tzinfo (0.3.12) will_paginate (2.2.2)&lt;/p&gt;
&lt;p&gt;thanks for any advice you might be able to think of! L&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-05T20:59:07+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-05T20:59:09+00:00</updated-at>
      <user-id type="integer">46279</user-id>
      <version type="integer">8</version>
      <user-name>jts</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Correct me if I am wrong, but it appears that the patch was applied for 2.3, so this option is not available in 2.2.2.

I got this working by monkey patching 2.2.2.

I added this to environment.rb:

@@@
if RAILS_GEM_VERSION == '2.2.2'
  module ActionMailer
    class Base

      def perform_delivery_smtp(mail)
        destinations = mail.destinations
        mail.ready_to_send
        sender = mail['return-path'] || mail.from

        smtp = Net::SMTP.new(smtp_settings[:address], smtp_settings[:port])
        smtp.enable_starttls_auto if smtp_settings[:enable_starttls_auto] &amp;&amp; smtp.respond_to?(:enable_starttls_auto)
        smtp.start(smtp_settings[:domain], smtp_settings[:user_name], smtp_settings[:password],
              smtp_settings[:authentication]) do |smtp|
                smtp.sendmail(mail.encoded, sender, destinations)
              end
       end
    end
  end
else
  raise &quot;you forgot to remove the ActionMailer monkey patch!&quot;
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Correct me if I am wrong, but it appears that the patch was
applied for 2.3, so this option is not available in 2.2.2.&lt;/p&gt;
&lt;p&gt;I got this working by monkey patching 2.2.2.&lt;/p&gt;
&lt;p&gt;I added this to environment.rb:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
if RAILS_GEM_VERSION == '2.2.2'
  module ActionMailer
    class Base

      def perform_delivery_smtp(mail)
        destinations = mail.destinations
        mail.ready_to_send
        sender = mail['return-path'] || mail.from

        smtp = Net::SMTP.new(smtp_settings[:address], smtp_settings[:port])
        smtp.enable_starttls_auto if smtp_settings[:enable_starttls_auto] &amp;amp;&amp;amp; smtp.respond_to?(:enable_starttls_auto)
        smtp.start(smtp_settings[:domain], smtp_settings[:user_name], smtp_settings[:password],
              smtp_settings[:authentication]) do |smtp|
                smtp.sendmail(mail.encoded, sender, destinations)
              end
       end
    end
  end
else
  raise &amp;quot;you forgot to remove the ActionMailer monkey patch!&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T04:17:55+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-06T04:18:00+00:00</updated-at>
      <user-id type="integer">9382</user-id>
      <version type="integer">9</version>
      <user-name>Ken Liu</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm a bit apprehensive about upgrading to 2.2.3 on the production server - I dimly remember how much of a pain it was to upgrade to 2.2.2 (on bluehost), so I'd like to avoid that if possible.

I put the &quot;monkey patch&quot; at the end of my environment.rb and the application died, so I quickly removed it again!

Should I put monkey patch into or outside of the 

Rails::Initializer.run do |config| block?

thanks for your input ken!</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm a bit apprehensive about upgrading to 2.2.3 on the
production server - I dimly remember how much of a pain it was to
upgrade to 2.2.2 (on bluehost), so I'd like to avoid that if
possible.&lt;/p&gt;
&lt;p&gt;I put the &quot;monkey patch&quot; at the end of my environment.rb and the
application died, so I quickly removed it again!&lt;/p&gt;
&lt;p&gt;Should I put monkey patch into or outside of the&lt;/p&gt;
&lt;p&gt;Rails::Initializer.run do |config| block?&lt;/p&gt;
&lt;p&gt;thanks for your input ken!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T15:48:06+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-06T15:48:07+00:00</updated-at>
      <user-id type="integer">46279</user-id>
      <version type="integer">10</version>
      <user-name>jts</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>2.2.2 is the latest release, 2.3 (where the fix was committed) hasn't been released yet.

I put the patch at the end of environment.rb.</body>
      <body-html>&lt;div&gt;&lt;p&gt;2.2.2 is the latest release, 2.3 (where the fix was committed)
hasn't been released yet.&lt;/p&gt;
&lt;p&gt;I put the patch at the end of environment.rb.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-08T02:00:44+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-08T02:00:48+00:00</updated-at>
      <user-id type="integer">9382</user-id>
      <version type="integer">11</version>
      <user-name>Ken Liu</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks Ken,
I've managed to &quot;monkey patch&quot; my environment.rb.

Alas, after this failed to fix the issue, I did a telnet session with my hosts SMTP service and it's failing to transmit a message with an SMTP status code 550.

So I've mailed support about this and I hope they'll (finally) be able to solve the issue...

thanks for all your help everyone!  Will let you know if/when the issue is resolved!!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Ken, I've managed to &quot;monkey patch&quot; my
environment.rb.&lt;/p&gt;
&lt;p&gt;Alas, after this failed to fix the issue, I did a telnet session
with my hosts SMTP service and it's failing to transmit a message
with an SMTP status code 550.&lt;/p&gt;
&lt;p&gt;So I've mailed support about this and I hope they'll (finally)
be able to solve the issue...&lt;/p&gt;
&lt;p&gt;thanks for all your help everyone! Will let you know if/when the
issue is resolved!!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-08T22:21:57+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-08T22:21:59+00:00</updated-at>
      <user-id type="integer">46279</user-id>
      <version type="integer">12</version>
      <user-name>jts</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@jts

sorry, now reading through the description of your issue again, I'm not sure that this particular patch addresses your problem. Good luck in getting your mail problems solved!</body>
      <body-html>&lt;div&gt;&lt;p&gt;@jts&lt;/p&gt;
&lt;p&gt;sorry, now reading through the description of your issue again,
I'm not sure that this particular patch addresses your problem.
Good luck in getting your mail problems solved!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-09T02:04:14+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-09T02:04:19+00:00</updated-at>
      <user-id type="integer">9382</user-id>
      <version type="integer">13</version>
      <user-name>Ken Liu</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I've found something quite strange.

I've got in my user_mailer.rb a function to fire off a mail to the user via the contact form...

def contact_form(name, email, website, message)
                recipients      &quot;app@domain.com&quot;
                from            &quot;app@domain.com&quot;
                subject         &quot;your contact form&quot;
                sent_on         Time.now
                content_type    &quot;text/html&quot;
                body            :name =&gt; name, :email =&gt; email, :website =&gt; website, :message =&gt; message
                template        &quot;contact_form&quot;
        end

If I specify the body variables as a hash, like the documentation states, my application fails (error code 500).

If I specify the body variables as I have above, the program works, but I'm getting this getaddrinfo: Name or service not known error.

The documentation on ActionMailer that I'm referring to is here: 
http://guides.rubyonrails.org/action_mailer_basics.html

Could I be doing something wrong that's causing the program to return a 500 status code? 

thanx!
j</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've found something quite strange.&lt;/p&gt;
&lt;p&gt;I've got in my user_mailer.rb a function to fire off a mail to
the user via the contact form...&lt;/p&gt;
&lt;p&gt;def contact_form(name, email, website, message)&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;            recipients      &quot;&lt;a href=&quot;mailto:app@domain.com&quot;&gt;app@domain.com&lt;/a&gt;&quot;
            from            &quot;&lt;a href=&quot;mailto:app@domain.com&quot;&gt;app@domain.com&lt;/a&gt;&quot;
            subject         &quot;your contact form&quot;
            sent_on         Time.now
            content_type    &quot;text/html&quot;
            body            :name =&amp;gt; name, :email =&amp;gt; email, :website =&amp;gt; website, :message =&amp;gt; message
            template        &quot;contact_form&quot;
    end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If I specify the body variables as a hash, like the
documentation states, my application fails (error code 500).&lt;/p&gt;
&lt;p&gt;If I specify the body variables as I have above, the program
works, but I'm getting this getaddrinfo: Name or service not known
error.&lt;/p&gt;
&lt;p&gt;The documentation on ActionMailer that I'm referring to is here:
&lt;a href=&quot;http://guides.rubyonrails.org/action_mailer_basics.html&quot;&gt;http://guides.rubyonrails.org/ac...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Could I be doing something wrong that's causing the program to
return a 500 status code?&lt;/p&gt;
&lt;p&gt;thanx! j&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-09T02:19:45+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-09T02:19:46+00:00</updated-at>
      <user-id type="integer">46279</user-id>
      <version type="integer">14</version>
      <user-name>jts</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name>Pratik</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>how to apply this patch, i'm quite new to rails
thx</body>
      <body-html>&lt;div&gt;&lt;p&gt;how to apply this patch, i'm quite new to rails thx&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-09T06:07:15+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 1366
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-09T06:07:20+00:00</updated-at>
      <user-id type="integer">46697</user-id>
      <version type="integer">15</version>
      <user-name>marzocchi</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>re: Ken Liu's monkey patch to get it working in 2.2.2

I'd like to verify Ken's monkey patch mentioned above.  It fixed this issue on my shared host that was showing this problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;re: Ken Liu's monkey patch to get it working in 2.2.2&lt;/p&gt;
&lt;p&gt;I'd like to verify Ken's monkey patch mentioned above. It fixed
this issue on my shared host that was showing this problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-19T20:37:41+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-02-19T20:37:44+00:00</updated-at>
      <user-id type="integer">18668</user-id>
      <version type="integer">16</version>
      <user-name>Randy</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'll also confirm Ken's monkey patch as working; fixed this somewhat insidious problem when setting up email, using Redmine 0.8.x on Dreamhost.

The main indicator of the problem is the error &quot;hostname was not match with the server certificate&quot; - without trawling through the ActionMailer source, I'm guessing that there's a problem in AM when the SSL cert name doesn't match the SMTP server name [relatively common for wildcard SSL certs in shared hosting environments]. Potentially should be an option for ignoring certificate mismatch errors, but I guess that's open to abuse, and I'm not about to make a request for it since I'm not prepared to cobble a patch together myself.

Still, hopefully helps someone else stumbling through google results.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'll also confirm Ken's monkey patch as working; fixed this
somewhat insidious problem when setting up email, using Redmine
0.8.x on Dreamhost.&lt;/p&gt;
&lt;p&gt;The main indicator of the problem is the error &quot;hostname was not
match with the server certificate&quot; - without trawling through the
ActionMailer source, I'm guessing that there's a problem in AM when
the SSL cert name doesn't match the SMTP server name [relatively
common for wildcard SSL certs in shared hosting environments].
Potentially should be an option for ignoring certificate mismatch
errors, but I guess that's open to abuse, and I'm not about to make
a request for it since I'm not prepared to cobble a patch together
myself.&lt;/p&gt;
&lt;p&gt;Still, hopefully helps someone else stumbling through google
results.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-06T01:10:28+01:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2009-05-06T01:10:32+01:00</updated-at>
      <user-id type="integer">56167</user-id>
      <version type="integer">17</version>
      <user-name>Mark Glossop</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think this patch solves the problem of sending mail via TLS but will fail for SSL. The problem with SMTP over SSL (or SMTPS) is the moment you send an EHLO in clear case, the mail server will terminate the connection. So, the capability check with starttls_auto? will never happen.

I am using Ruby 1.8.7 and net/smtp.rb has the following code:

@@@
s = timeout(@open_timeout) { TCPSocket.open(@address, @port) }   
logging &quot;Connection opened: #{@address}:#{@port}&quot;
@socket = new_internet_message_io(tls? ? tlsconnect(s) : s) # *1
check_response critical { recv_response() }
do_helo helo_domain
# control never reaches here
if starttls_always? or (capable_starttls? and starttls_auto?)
@@@

We want tls? to return true (line marked with *1), so that an SSL connection is obtained at the beginning itself. I added the following code to action_mailer#base.rb:perform_delivery_smtp(mail) -

@@@
if smtp_settings[:ssl]
  smtp.enable_tls()
else
  smtp.enable_starttls_auto if smtp_settings[:enable_starttls_auto] &amp;&amp; smtp.respond_to?(:enable_starttls_auto)
end
@@@

Full patch is attached. Needs to be dropped into config/initializers and add :ssl =&gt; true in config.action_mailer.smtp_settings hash.

I read through the 3.0.0 beta code, but could not make out if the issue is fixed or not.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think this patch solves the problem of sending mail via TLS
but will fail for SSL. The problem with SMTP over SSL (or SMTPS) is
the moment you send an EHLO in clear case, the mail server will
terminate the connection. So, the capability check with
starttls_auto? will never happen.&lt;/p&gt;
&lt;p&gt;I am using Ruby 1.8.7 and net/smtp.rb has the following
code:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;s = timeout(@open_timeout) { TCPSocket.open(@address, @port) }   
logging &quot;Connection opened: #{@address}:#{@port}&quot;
@socket = new_internet_message_io(tls? ? tlsconnect(s) : s) # *1
check_response critical { recv_response() }
do_helo helo_domain
# control never reaches here
if starttls_always? or (capable_starttls? and starttls_auto?)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;We want tls? to return true (line marked with *1), so that an
SSL connection is obtained at the beginning itself. I added the
following code to action_mailer#base.rb:perform_delivery_smtp(mail)
-&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;if smtp_settings[:ssl]
  smtp.enable_tls()
else
  smtp.enable_starttls_auto if smtp_settings[:enable_starttls_auto] &amp;amp;&amp;amp; smtp.respond_to?(:enable_starttls_auto)
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Full patch is attached. Needs to be dropped into
config/initializers and add :ssl =&amp;gt; true in
config.action_mailer.smtp_settings hash.&lt;/p&gt;
&lt;p&gt;I read through the 3.0.0 beta code, but could not make out if
the issue is fixed or not.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-15T13:22:35+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;2.2 actionmailer \&quot;getaddrinfo: name or service not known\&quot; smtp socketerror&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2010-02-15T13:22:45+00:00</updated-at>
      <user-id type="integer">86620</user-id>
      <version type="integer">18</version>
      <user-name>Sayantam Dey</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>o exercise &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com&quot;&gt;replica omega&lt;/a&gt;&lt;/b&gt; caution and wisdom before &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/omega-deville-prestige-steel-ladies-watch-4570-33-794-3864.html&quot;&gt;Omega DeVille Prestige DeVille Prestige Steel Ladies 4570.33-794&lt;/a&gt;&lt;/b&gt; you buy. If the &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/rado-diastar-sintra-unisex-watch-r13336162-3452-2721.html&quot;&gt;fake DiaStar Sintra Unisex R13336162-3452&lt;/a&gt;&lt;/b&gt; Rolex brand were not &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/tag-heuer-formula-1-steel-black-rubber-mens-watch-wah1111-bt0714-1687-760.html&quot;&gt;fake Formula 1 Steel Black Rubber Mens WAH1111.BT0714-1687&lt;/a&gt;&lt;/b&gt; so celebrated in the &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/audemars-piguet-royal-oak-mens-watch-15300st-00-1220st-03-2094-1213.html&quot;&gt;Royal Oak Mens 15300ST.00.1220ST.03-2094&lt;/a&gt;&lt;/b&gt; world &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/corum-bubble-xl-steel-silver-mens-watch-396-250-20-b100-eb30r-2578-1750.html&quot;&gt;Corum Bubble XL Bubble XL Steel Silver Mens 396-250-20-B100-EB30R-2578&lt;/a&gt;&lt;/b&gt;  &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/paris-pairs-mens-watch-black-strap-5532-3976-3302.html&quot;&gt;Pairs Mens Black Strap 5532-3976&lt;/a&gt;&lt;/b&gt;  &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com&quot;&gt;designer omega watches&lt;/a&gt;&lt;/b&gt;  &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com&quot;&gt;omega watches&lt;/a&gt;&lt;/b&gt;  &lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com/watches/omega-speedmaster-legend-limited-edition-black-mens-watch-3507-51-426-3456.html&quot;&gt;replica Speedmaster Legend Limited Edition Black Mens 3507.51-426&lt;/a&gt;&lt;/b&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;o exercise &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com&quot;&gt;replica omega&lt;/a&gt;&lt;/b&gt; caution
and wisdom before &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/omega-deville-prestige-steel-ladies-watch-4570-33-794-3864.html&quot;&gt;
Omega DeVille Prestige DeVille Prestige Steel Ladies
4570.33-794&lt;/a&gt;&lt;/b&gt; you buy. If the &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/rado-diastar-sintra-unisex-watch-r13336162-3452-2721.html&quot;&gt;
fake DiaStar Sintra Unisex R13336162-3452&lt;/a&gt;&lt;/b&gt; Rolex brand were
not &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/tag-heuer-formula-1-steel-black-rubber-mens-watch-wah1111-bt0714-1687-760.html&quot;&gt;
fake Formula 1 Steel Black Rubber Mens WAH1111.BT0714-1687&lt;/a&gt;&lt;/b&gt;
so celebrated in the &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/audemars-piguet-royal-oak-mens-watch-15300st-00-1220st-03-2094-1213.html&quot;&gt;
Royal Oak Mens 15300ST.00.1220ST.03-2094&lt;/a&gt;&lt;/b&gt; world &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/corum-bubble-xl-steel-silver-mens-watch-396-250-20-b100-eb30r-2578-1750.html&quot;&gt;
Corum Bubble XL Bubble XL Steel Silver Mens
396-250-20-B100-EB30R-2578&lt;/a&gt;&lt;/b&gt; &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/paris-pairs-mens-watch-black-strap-5532-3976-3302.html&quot;&gt;
Pairs Mens Black Strap 5532-3976&lt;/a&gt;&lt;/b&gt; &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com&quot;&gt;designer omega watches&lt;/a&gt;&lt;/b&gt;
&lt;b&gt;&lt;a href=&quot;http://www.omegawatchesforsale.com&quot;&gt;omega
watches&lt;/a&gt;&lt;/b&gt; &lt;b&gt;&lt;a href=
&quot;http://www.omegawatchesforsale.com/watches/omega-speedmaster-legend-limited-edition-black-mens-watch-3507-51-426-3456.html&quot;&gt;
replica Speedmaster Legend Limited Edition Black Mens
3507.51-426&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-19T08:08:16+01:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2 actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2010-07-21T01:46:04+01:00</updated-at>
      <user-id type="integer">107771</user-id>
      <version type="integer">19</version>
      <user-name>zhuzhu</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-16T23:39:38+01:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;2 actionmailer \&quot;getaddrinfo: name or service not known\&quot; smtp socketerror&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2-3-stable actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2010-10-16T23:39:44+01:00</updated-at>
      <user-id type="integer">81551</user-id>
      <version type="integer">20</version>
      <user-name>Andrea Campi</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were inspired by   baseball glove design and they created discount handbags with similar qualities.&lt;strong&gt;&lt;a href=&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come along until years later. The original handbag collection   had twelve designs, and they were made from supple, tan, top-quality leathers,   and showed the same excellent craftsmanship and stitching that we still expect   today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought new looks to   Coach bags. She used many new fabrics and organic materials like jersey and   wool. She created the brass hardware that is symbolic of &lt;strong&gt;&lt;a href=&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;. When   Lew Frankfort came aboard in 1979, he brought Coach to the next level, and they   became a name known the world over. Affordable luxury was not a concept that   many people knew, but now they would. Soon after Frankfort joined Coach, they   came out with a catalog, and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought its brand   relevance and strength. They designed watches starting in 1988, and also   expanded their company to Tokyo. Japan still counts among the leading purchasers   of &lt;strong&gt;&lt;a href=&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach heels. The manufacture of Coach shoes began in the mid   90's, and Reed Krakoff, the lead designer, loaned his talents to help put Coach   heels and &lt;a href=&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as their   handbags, but they are well worth the money invested in their purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that don't have   this height. &lt;strong&gt;&lt;a href=&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to style and   pizzazz. Coach platforms come in many styles, from gold loafers to slingbacks   with open toes. You may be able to find Coach shoes at discount prices online,   but be sure that you are buying genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous, Coach   shoes and &lt;a href=&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will make you   feel sporty, too. When selecting pumps or sandals to wear, you'll be happy to   count on the long-standing quality and service of the Coach company. They have   many styles to choose from, including chic and glamorous Coach boots and Coach   heels. Whether you are looking for sports shoes like Coach sneakers or sexy   shoes like Coach boots, the Coach name will never let you down.&lt;/p&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were
inspired by baseball glove design and they created discount
handbags with similar qualities.&lt;strong&gt;&lt;a href=
&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come
along until years later. The original handbag collection had twelve
designs, and they were made from supple, tan, top-quality leathers,
and showed the same excellent craftsmanship and stitching that we
still expect today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought
new looks to Coach bags. She used many new fabrics and organic
materials like jersey and wool. She created the brass hardware that
is symbolic of &lt;strong&gt;&lt;a href=
&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;.
When Lew Frankfort came aboard in 1979, he brought Coach to the
next level, and they became a name known the world over. Affordable
luxury was not a concept that many people knew, but now they would.
Soon after Frankfort joined Coach, they came out with a catalog,
and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought
its brand relevance and strength. They designed watches starting in
1988, and also expanded their company to Tokyo. Japan still counts
among the leading purchasers of &lt;strong&gt;&lt;a href=
&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach
heels. The manufacture of Coach shoes began in the mid 90's, and
Reed Krakoff, the lead designer, loaned his talents to help put
Coach heels and &lt;a href=
&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags
outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as
their handbags, but they are well worth the money invested in their
purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that
don't have this height. &lt;strong&gt;&lt;a href=
&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans
outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to
style and pizzazz. Coach platforms come in many styles, from gold
loafers to slingbacks with open toes. You may be able to find Coach
shoes at discount prices online, but be sure that you are buying
genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=
&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler
jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous,
Coach shoes and &lt;a href=
&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel
purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will
make you feel sporty, too. When selecting pumps or sandals to wear,
you'll be happy to count on the long-standing quality and service
of the Coach company. They have many styles to choose from,
including chic and glamorous Coach boots and Coach heels. Whether
you are looking for sports shoes like Coach sneakers or sexy shoes
like Coach boots, the Coach name will never let you down.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T01:19:15+00:00</created-at>
      <creator-id type="integer">19965</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1731</number>
      <permalink>make-enable_starttls_auto-opt-in-in-actionmailer</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2-3-stable actionmailer &quot;getaddrinfo: name or service not known&quot; smtp socketerror</tag>
      <title>Make enable_starttls_auto opt-in in ActionMailer</title>
      <updated-at type="datetime">2010-11-08T23:12:08+00:00</updated-at>
      <user-id type="integer">123546</user-id>
      <version type="integer">21</version>
      <user-name>jim123456</user-name>
      <creator-name>Jos&#233; Valim</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1731</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>d74b26169d2a761c745ac233f914b97c05a4f074</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-01-11T10:14:59+00:00</created-at>
      <filename>enable_starttls_auto.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">77185</id>
      <size type="integer">5237</size>
      <uploader-id type="integer">19965</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/77185/enable_starttls_auto.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>79c21fdfa92d0b102057aa84fcc4090990ea7979</code>
      <content-type>application/x-ruby</content-type>
      <created-at type="datetime">2010-02-15T13:22:35+00:00</created-at>
      <filename>mailer_ext.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">411967</id>
      <size type="integer">646</size>
      <uploader-id type="integer">86620</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/411967/mailer_ext.rb</url>
    </attachment>
  </attachments>
</ticket>
