<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-04T15:26:47+00:00</created-at>
  <creator-id type="integer">3685</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1875</number>
  <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
  <priority type="integer">50</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>failsafe multipart rack upload</tag>
  <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
  <updated-at type="datetime">2011-01-16T02:20:38+00:00</updated-at>
  <user-id type="integer">88731</user-id>
  <version type="integer">32</version>
  <user-name>Jim Haungs</user-name>
  <creator-name>Jonathan Sutherland</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
  <priority-name nil="true"></priority-name>
  <original-body>When posting a multipart form to create a record, posted attributes are not being included in the controller's params hash.

Example:

POST a Contact with a photo file and a name attribute;
the :name key is not found in params =&gt; { contact =&gt; { ... } }


### Steps to reproduce ###

1) Create a new rails project (Rails 2.3.0)

@@@
  $ rails -v
  Rails 2.3.0

  $ rails test
  $ cd test
@@@


2) Create a Contact scaffold with a &quot;name&quot;

@@@
  $ script/generate scaffold Contact name:string
@@@


3) Migrate the db

@@@
  $ rake db:migrate
@@@


4) Add a photo attr_accessor to the model for testing multipart posting

@@@
  # app/models/contact.rb
  class Contact &lt; ActiveRecord::Base
    attr_accessor :photo
  end
@@@


5) Update the &quot;new&quot; view: (1) specify multipart, and (2) add file_field for the photo file (NOTE: photo file_field must come BEFORE name field in order to reproduce this issue!)
 
@@@
  # app/views/contacts/new.html.erb
  &lt;% form_for(@contact, :html =&gt; { :multipart =&gt; true }) do |f| %&gt;

    ...

    &lt;p&gt;
      &lt;%= f.label :photo %&gt;&lt;br /&gt;
      &lt;%= f.file_field :photo %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;%= f.label :name %&gt;&lt;br /&gt;
      &lt;%= f.text_field :name %&gt;
    &lt;/p&gt;

    ...
@@@


6) Run the server

@@@
  $ script/server
@@@


7) Load the view (http://localhost:3000/contacts/new) and submit the form with a photo file and a name specified


8) Examine the server log: the name attribute is NOT included in the parameters hash and is NOT saved to the DB... FAIL!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:06:27) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/RackMultipart.2795.1&gt;}}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES(NULL, '2009-02-04 14:06:27', '2009-02-04 14:06:27')
  Redirected to #&lt;Contact:0x244d534&gt;
  Completed in 85ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@


9) Try resubmitting the form without a photo file; the name attribute IS included in the parameters hash and saved to the DB... SUCCESS!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:26:06) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;nil, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;}
    Contact Create (0.4ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:26:06', '2009-02-04 14:26:06')
  Redirected to #&lt;Contact:0x249d1b0&gt;
  Completed in 21ms (DB: 0) | 302 Found [http://localhost/contacts]
@@@


10) Try reverting to Rails 2.2.2, and submit the form with a photo file and name specified... SUCCESS!

@@@
  # config/environment.rb
  RAILS_GEM_VERSION = '2.2.2' unless defined? RAILS_GEM_VERSION

  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:29:46) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/CGI.2855.1&gt;, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;27198d70b52a49b60cdc8c6e722bc945da344f63&quot;}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:29:46', '2009-02-04 14:29:46')
  Redirected to #&lt;Contact:0x22dbcf0&gt;
  Completed in 21ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@</original-body>
  <latest-body>When posting a multipart form to create a record, posted attributes are not being included in the controller's params hash.

Example:

POST a Contact with a photo file and a name attribute;
the :name key is not found in params =&gt; { contact =&gt; { ... } }


### Steps to reproduce ###

1) Create a new rails project (Rails 2.3.0)

@@@
  $ rails -v
  Rails 2.3.0

  $ rails test
  $ cd test
@@@


2) Create a Contact scaffold with a &quot;name&quot;

@@@
  $ script/generate scaffold Contact name:string
@@@


3) Migrate the db

@@@
  $ rake db:migrate
@@@


4) Add a photo attr_accessor to the model for testing multipart posting

@@@
  # app/models/contact.rb
  class Contact &lt; ActiveRecord::Base
    attr_accessor :photo
  end
@@@


5) Update the &quot;new&quot; view: (1) specify multipart, and (2) add file_field for the photo file (NOTE: photo file_field must come BEFORE name field in order to reproduce this issue!)
 
@@@
  # app/views/contacts/new.html.erb
  &lt;% form_for(@contact, :html =&gt; { :multipart =&gt; true }) do |f| %&gt;

    ...

    &lt;p&gt;
      &lt;%= f.label :photo %&gt;&lt;br /&gt;
      &lt;%= f.file_field :photo %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;%= f.label :name %&gt;&lt;br /&gt;
      &lt;%= f.text_field :name %&gt;
    &lt;/p&gt;

    ...
@@@


6) Run the server

@@@
  $ script/server
@@@


7) Load the view (http://localhost:3000/contacts/new) and submit the form with a photo file and a name specified


8) Examine the server log: the name attribute is NOT included in the parameters hash and is NOT saved to the DB... FAIL!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:06:27) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/RackMultipart.2795.1&gt;}}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES(NULL, '2009-02-04 14:06:27', '2009-02-04 14:06:27')
  Redirected to #&lt;Contact:0x244d534&gt;
  Completed in 85ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@


9) Try resubmitting the form without a photo file; the name attribute IS included in the parameters hash and saved to the DB... SUCCESS!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:26:06) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;nil, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;}
    Contact Create (0.4ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:26:06', '2009-02-04 14:26:06')
  Redirected to #&lt;Contact:0x249d1b0&gt;
  Completed in 21ms (DB: 0) | 302 Found [http://localhost/contacts]
@@@


10) Try reverting to Rails 2.2.2, and submit the form with a photo file and name specified... SUCCESS!

@@@
  # config/environment.rb
  RAILS_GEM_VERSION = '2.2.2' unless defined? RAILS_GEM_VERSION

  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:29:46) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/CGI.2855.1&gt;, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;27198d70b52a49b60cdc8c6e722bc945da344f63&quot;}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:29:46', '2009-02-04 14:29:46')
  Redirected to #&lt;Contact:0x22dbcf0&gt;
  Completed in 21ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When posting a multipart form to create a record, posted
attributes are not being included in the controller's params
hash.&lt;/p&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;p&gt;POST a Contact with a photo file and a name attribute; the :name
key is not found in params =&amp;gt; { contact =&amp;gt; { ... } }&lt;/p&gt;
&lt;h3&gt;Steps to reproduce&lt;/h3&gt;
&lt;p&gt;1) Create a new rails project (Rails 2.3.0)&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ rails -v
  Rails 2.3.0

  $ rails test
  $ cd test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2) Create a Contact scaffold with a &quot;name&quot;&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ script/generate scaffold Contact name:string
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3) Migrate the db&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ rake db:migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4) Add a photo attr_accessor to the model for testing multipart
posting&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # app/models/contact.rb
  class Contact &amp;lt; ActiveRecord::Base
    attr_accessor :photo
  end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5) Update the &quot;new&quot; view: (1) specify multipart, and (2) add
file_field for the photo file (NOTE: photo file_field must come
BEFORE name field in order to reproduce this issue!)&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # app/views/contacts/new.html.erb
  &amp;lt;% form_for(@contact, :html =&amp;gt; { :multipart =&amp;gt; true }) do |f| %&amp;gt;

    ...

    &amp;lt;p&amp;gt;
      &amp;lt;%= f.label :photo %&amp;gt;&amp;lt;br /&amp;gt;
      &amp;lt;%= f.file_field :photo %&amp;gt;
    &amp;lt;/p&amp;gt;

    &amp;lt;p&amp;gt;
      &amp;lt;%= f.label :name %&amp;gt;&amp;lt;br /&amp;gt;
      &amp;lt;%= f.text_field :name %&amp;gt;
    &amp;lt;/p&amp;gt;

    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6) Run the server&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ script/server
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7) Load the view (&lt;a href=&quot;http://localhost:3000/contacts/new)&quot;&gt;http://localhost:3000/contacts/new)&lt;/a&gt;
and submit the form with a photo file and a name specified&lt;/p&gt;
&lt;p&gt;8) Examine the server log: the name attribute is NOT included in
the parameters hash and is NOT saved to the DB... FAIL!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:06:27) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;#&amp;lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/RackMultipart.2795.1&amp;gt;}}
    Contact Create (0.6ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES(NULL, '2009-02-04 14:06:27', '2009-02-04 14:06:27')
  Redirected to #&amp;lt;Contact:0x244d534&amp;gt;
  Completed in 85ms (DB: 1) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;9) Try resubmitting the form without a photo file; the name
attribute IS included in the parameters hash and saved to the DB...
SUCCESS!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:26:06) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;nil, &amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jonathan&amp;quot;}, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&amp;quot;}
    Contact Create (0.4ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES('Jonathan', '2009-02-04 14:26:06', '2009-02-04 14:26:06')
  Redirected to #&amp;lt;Contact:0x249d1b0&amp;gt;
  Completed in 21ms (DB: 0) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;10) Try reverting to Rails 2.2.2, and submit the form with a
photo file and name specified... SUCCESS!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # config/environment.rb
  RAILS_GEM_VERSION = '2.2.2' unless defined? RAILS_GEM_VERSION

  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:29:46) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;#&amp;lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/CGI.2855.1&amp;gt;, &amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jonathan&amp;quot;}, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;27198d70b52a49b60cdc8c6e722bc945da344f63&amp;quot;}
    Contact Create (0.6ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES('Jonathan', '2009-02-04 14:29:46', '2009-02-04 14:29:46')
  Redirected to #&amp;lt;Contact:0x22dbcf0&amp;gt;
  Completed in 21ms (DB: 1) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When posting a multipart form to create a record, posted attributes are not being included in the controller's params hash.

Example:

POST a Contact with a photo file and a name attribute;
the :name key is not found in params =&gt; { contact =&gt; { ... } }


### Update ###

I've found this issue occurs only when uploading .jpg files (thus far).
No issues testing with .gif, .pdf, .ppt and .mov.

Possibly relevant: I'm running Mac OS X 10.5.6.


### Steps to reproduce ###

1) Create a new rails project (Rails 2.3.0)

@@@
  $ rails -v
  Rails 2.3.0

  $ rails test
  $ cd test
@@@


2) Create a Contact scaffold with a &quot;name&quot;

@@@
  $ script/generate scaffold Contact name:string
@@@


3) Migrate the db

@@@
  $ rake db:migrate
@@@


4) Add a photo attr_accessor to the model for testing multipart posting

@@@
  # app/models/contact.rb
  class Contact &lt; ActiveRecord::Base
    attr_accessor :photo
  end
@@@


5) Update the &quot;new&quot; view: (1) specify multipart, and (2) add file_field for the photo file (NOTE: photo file_field must come BEFORE name field in order to reproduce this issue!)
 
@@@
  # app/views/contacts/new.html.erb
  &lt;% form_for(@contact, :html =&gt; { :multipart =&gt; true }) do |f| %&gt;

    ...

    &lt;p&gt;
      &lt;%= f.label :photo %&gt;&lt;br /&gt;
      &lt;%= f.file_field :photo %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;%= f.label :name %&gt;&lt;br /&gt;
      &lt;%= f.text_field :name %&gt;
    &lt;/p&gt;

    ...
@@@


6) Run the server

@@@
  $ script/server
@@@


7) Load the view (http://localhost:3000/contacts/new) and submit the form with a photo file and a name specified


8) Examine the server log: the name attribute is NOT included in the parameters hash and is NOT saved to the DB... FAIL!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:06:27) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/RackMultipart.2795.1&gt;}}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES(NULL, '2009-02-04 14:06:27', '2009-02-04 14:06:27')
  Redirected to #&lt;Contact:0x244d534&gt;
  Completed in 85ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@


9) Try resubmitting the form without a photo file; the name attribute IS included in the parameters hash and saved to the DB... SUCCESS!

@@@
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:26:06) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;nil, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&quot;}
    Contact Create (0.4ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:26:06', '2009-02-04 14:26:06')
  Redirected to #&lt;Contact:0x249d1b0&gt;
  Completed in 21ms (DB: 0) | 302 Found [http://localhost/contacts]
@@@


10) Try reverting to Rails 2.2.2, and submit the form with a photo file and name specified... SUCCESS!

@@@
  # config/environment.rb
  RAILS_GEM_VERSION = '2.2.2' unless defined? RAILS_GEM_VERSION

  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:29:46) [POST]
    Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/CGI.2855.1&gt;, &quot;name&quot;=&gt;&quot;Jonathan&quot;}, &quot;authenticity_token&quot;=&gt;&quot;27198d70b52a49b60cdc8c6e722bc945da344f63&quot;}
    Contact Create (0.6ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('Jonathan', '2009-02-04 14:29:46', '2009-02-04 14:29:46')
  Redirected to #&lt;Contact:0x22dbcf0&gt;
  Completed in 21ms (DB: 1) | 302 Found [http://localhost/contacts]
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;When posting a multipart form to create a record, posted
attributes are not being included in the controller's params
hash.&lt;/p&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;p&gt;POST a Contact with a photo file and a name attribute; the :name
key is not found in params =&amp;gt; { contact =&amp;gt; { ... } }&lt;/p&gt;
&lt;h3&gt;Update&lt;/h3&gt;
&lt;p&gt;I've found this issue occurs only when uploading .jpg files
(thus far). No issues testing with .gif, .pdf, .ppt and .mov.&lt;/p&gt;
&lt;p&gt;Possibly relevant: I'm running Mac OS X 10.5.6.&lt;/p&gt;
&lt;h3&gt;Steps to reproduce&lt;/h3&gt;
&lt;p&gt;1) Create a new rails project (Rails 2.3.0)&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ rails -v
  Rails 2.3.0

  $ rails test
  $ cd test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2) Create a Contact scaffold with a &quot;name&quot;&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ script/generate scaffold Contact name:string
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3) Migrate the db&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ rake db:migrate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4) Add a photo attr_accessor to the model for testing multipart
posting&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # app/models/contact.rb
  class Contact &amp;lt; ActiveRecord::Base
    attr_accessor :photo
  end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5) Update the &quot;new&quot; view: (1) specify multipart, and (2) add
file_field for the photo file (NOTE: photo file_field must come
BEFORE name field in order to reproduce this issue!)&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # app/views/contacts/new.html.erb
  &amp;lt;% form_for(@contact, :html =&amp;gt; { :multipart =&amp;gt; true }) do |f| %&amp;gt;

    ...

    &amp;lt;p&amp;gt;
      &amp;lt;%= f.label :photo %&amp;gt;&amp;lt;br /&amp;gt;
      &amp;lt;%= f.file_field :photo %&amp;gt;
    &amp;lt;/p&amp;gt;

    &amp;lt;p&amp;gt;
      &amp;lt;%= f.label :name %&amp;gt;&amp;lt;br /&amp;gt;
      &amp;lt;%= f.text_field :name %&amp;gt;
    &amp;lt;/p&amp;gt;

    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;6) Run the server&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  $ script/server
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;7) Load the view (&lt;a href=&quot;http://localhost:3000/contacts/new)&quot;&gt;http://localhost:3000/contacts/new)&lt;/a&gt;
and submit the form with a photo file and a name specified&lt;/p&gt;
&lt;p&gt;8) Examine the server log: the name attribute is NOT included in
the parameters hash and is NOT saved to the DB... FAIL!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:06:27) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;#&amp;lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/RackMultipart.2795.1&amp;gt;}}
    Contact Create (0.6ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES(NULL, '2009-02-04 14:06:27', '2009-02-04 14:06:27')
  Redirected to #&amp;lt;Contact:0x244d534&amp;gt;
  Completed in 85ms (DB: 1) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;9) Try resubmitting the form without a photo file; the name
attribute IS included in the parameters hash and saved to the DB...
SUCCESS!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:26:06) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;nil, &amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jonathan&amp;quot;}, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;nsn4WHo9KPvWqiA4a8PPkELmeJVHKeLtXx9Dz1CVtTs=&amp;quot;}
    Contact Create (0.4ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES('Jonathan', '2009-02-04 14:26:06', '2009-02-04 14:26:06')
  Redirected to #&amp;lt;Contact:0x249d1b0&amp;gt;
  Completed in 21ms (DB: 0) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;10) Try reverting to Rails 2.2.2, and submit the form with a
photo file and name specified... SUCCESS!&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # config/environment.rb
  RAILS_GEM_VERSION = '2.2.2' unless defined? RAILS_GEM_VERSION

  # server output
  Processing ContactsController#create (for 127.0.0.1 at 2009-02-04 09:29:46) [POST]
    Parameters: {&amp;quot;commit&amp;quot;=&amp;gt;&amp;quot;Create&amp;quot;, &amp;quot;contact&amp;quot;=&amp;gt;{&amp;quot;photo&amp;quot;=&amp;gt;#&amp;lt;File:/var/folders/Ot/OtD86Bd4GzuaRTn9EQb1NE+++TI/-Tmp-/CGI.2855.1&amp;gt;, &amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jonathan&amp;quot;}, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;27198d70b52a49b60cdc8c6e722bc945da344f63&amp;quot;}
    Contact Create (0.6ms)   INSERT INTO &amp;quot;contacts&amp;quot; (&amp;quot;name&amp;quot;, &amp;quot;updated_at&amp;quot;, &amp;quot;created_at&amp;quot;) VALUES('Jonathan', '2009-02-04 14:29:46', '2009-02-04 14:29:46')
  Redirected to #&amp;lt;Contact:0x22dbcf0&amp;gt;
  Completed in 21ms (DB: 1) | 302 Found [http://localhost/contacts]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T15:26:47+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-04T17:46:00+00:00</updated-at>
      <user-id type="integer">3685</user-id>
      <version type="integer">1</version>
      <user-name>Jonathan Sutherland</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi,

I tested in edge rails (clone from github), can't reproduce the problem.

Processing ContactsController#create (for 127.0.0.1 at 2009-02-05 00:28:22) [POST]
  Parameters: {&quot;commit&quot;=&gt;&quot;Create&quot;, &quot;contact&quot;=&gt;{&quot;photo&quot;=&gt;#&lt;File:/tmp/RackMultipart.32439.3&gt;, &quot;name&quot;=&gt;&quot;234&quot;}, &quot;authenticity_token&quot;=&gt;&quot;WUrkOOZ9iTsGR9CGvL3zuoQJvAYoc3DD7G4eeNkaTpU=&quot;}
  Contact Create (0.7ms)   INSERT INTO &quot;contacts&quot; (&quot;name&quot;, &quot;updated_at&quot;, &quot;created_at&quot;) VALUES('234', '2009-02-04 16:28:22', '2009-02-04 16:28:22')
Redirected to #&lt;Contact:0x7f67a1c28de0&gt;
Completed in 29ms (DB: 1) | 302 Found [http://localhost/contacts]</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;I tested in edge rails (clone from github), can't reproduce the
problem.&lt;/p&gt;
&lt;p&gt;Processing ContactsController#create (for 127.0.0.1 at
2009-02-05 00:28:22) [POST] Parameters: {&quot;commit&quot;=&amp;gt;&quot;Create&quot;,
&quot;contact&quot;=&amp;gt;{&quot;photo&quot;=&amp;gt;#&amp;lt;File:/tmp/RackMultipart.32439.3&amp;gt;,
&quot;name&quot;=&amp;gt;&quot;234&quot;},
&quot;authenticity_token&quot;=&amp;gt;&quot;WUrkOOZ9iTsGR9CGvL3zuoQJvAYoc3DD7G4eeNkaTpU=&quot;}
Contact Create (0.7ms) INSERT INTO &quot;contacts&quot; (&quot;name&quot;,
&quot;updated_at&quot;, &quot;created_at&quot;) VALUES('234', '2009-02-04 16:28:22',
'2009-02-04 16:28:22') Redirected to
#&amp;lt;Contact:0x7f67a1c28de0&amp;gt; Completed in 29ms (DB: 1) | 302
Found [&lt;a href=&quot;http://localhost/contacts&quot;&gt;http://localhost/contacts&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T16:30:06+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-04T16:30:09+00:00</updated-at>
      <user-id type="integer">24538</user-id>
      <version type="integer">2</version>
      <user-name>Jan Xie</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Jan,

Ensure you test with &lt;%= f.file_field ... %&gt; appearing BEFORE &lt;%= f.text_field ... %&gt; in your view.

Reproducing this issue is dependent on the order in which form parameters are posted.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Jan,&lt;/p&gt;
&lt;p&gt;Ensure you test with &amp;lt;%= f.file_field ... %&amp;gt; appearing
BEFORE &amp;lt;%= f.text_field ... %&amp;gt; in your view.&lt;/p&gt;
&lt;p&gt;Reproducing this issue is dependent on the order in which form
parameters are posted.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T17:19:42+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-04T17:19:47+00:00</updated-at>
      <user-id type="integer">3685</user-id>
      <version type="integer">3</version>
      <user-name>Jonathan Sutherland</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Also,

Appears to occur for .jpg files only (thus far).
No issues testing with .gif, .pdf, .ppt and .mov.

Possibly relevant: I'm running Mac OS X 10.5.6.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Also,&lt;/p&gt;
&lt;p&gt;Appears to occur for .jpg files only (thus far). No issues
testing with .gif, .pdf, .ppt and .mov.&lt;/p&gt;
&lt;p&gt;Possibly relevant: I'm running Mac OS X 10.5.6.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T17:39:09+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-04T17:39:14+00:00</updated-at>
      <user-id type="integer">3685</user-id>
      <version type="integer">4</version>
      <user-name>Jonathan Sutherland</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I also see this behaviour on Mac OS X 10.5.6. 

I have used rake rails:freeze:edge to obtain the latest copy of edge.

As far as I can see, something about jpg files causes the issue of missing form fields after the first f.file_field, whether it is uploaded in Firefox, Safari and Firefox on windows.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I also see this behaviour on Mac OS X 10.5.6.&lt;/p&gt;
&lt;p&gt;I have used rake rails:freeze:edge to obtain the latest copy of
edge.&lt;/p&gt;
&lt;p&gt;As far as I can see, something about jpg files causes the issue
of missing form fields after the first f.file_field, whether it is
uploaded in Firefox, Safari and Firefox on windows.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T10:49:26+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-06T10:49:27+00:00</updated-at>
      <user-id type="integer">46215</user-id>
      <version type="integer">5</version>
      <user-name>Simon Lau</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T13:40:16+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-06T13:40:21+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">6</version>
      <user-name>DHH</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Appears it may be a parsing issue in Rack's Utils::Multipart.parse_multipart.

For a posted JPEG, use debugger to examine Utils::Multipart.parse_multipart as it parses through the posted data:

@@@
  /usr/local/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/utils.rb:341
  break  if buf.empty? || content_length == -1

  (rdb:4) head
  &quot;ntent-Disposition: form-data; name=\&quot;contact[name]\&quot;\r\n&quot;

  (rdb:4) name
  nil
@@@

Looks like the header got parsed wrong:  it's missing &quot;Co&quot; from &quot;Content-Disposition&quot;.
Thus, contact[name] isn't added to params as it's not matched by the corresponding regex:

@@@
  # rack-0.9.1/lib/rack/utils.rb:293
  name = head[/Content-Disposition:.* name=&quot;?([^\&quot;;]*)&quot;?/ni, 1]
@@@

====

For other posted file types (e.g. PDF), there's no issue:

@@@
  (rdb:5) head
  &quot;Content-Disposition: form-data; name=\&quot;contact[name]\&quot;\r\n&quot;

  (rdb:5) name
  &quot;contact[name]&quot;
 
  (rdb:5) params
  {&quot;contact[name]&quot;=&gt;&quot;Jonathan&quot;, &quot;authenticity_token&quot;=&gt;&quot;sd76bBiUOGsmSW... etc.
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Appears it may be a parsing issue in Rack's
Utils::Multipart.parse_multipart.&lt;/p&gt;
&lt;p&gt;For a posted JPEG, use debugger to examine
Utils::Multipart.parse_multipart as it parses through the posted
data:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  /usr/local/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/utils.rb:341
  break  if buf.empty? || content_length == -1

  (rdb:4) head
  &amp;quot;ntent-Disposition: form-data; name=\&amp;quot;contact[name]\&amp;quot;\r\n&amp;quot;

  (rdb:4) name
  nil
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Looks like the header got parsed wrong: it's missing &quot;Co&quot; from
&quot;Content-Disposition&quot;. Thus, contact[name] isn't added to params as
it's not matched by the corresponding regex:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  # rack-0.9.1/lib/rack/utils.rb:293
  name = head[/Content-Disposition:.* name=&amp;quot;?([^\&amp;quot;;]*)&amp;quot;?/ni, 1]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;====&lt;/p&gt;
&lt;p&gt;For other posted file types (e.g. PDF), there's no issue:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
  (rdb:5) head
  &amp;quot;Content-Disposition: form-data; name=\&amp;quot;contact[name]\&amp;quot;\r\n&amp;quot;

  (rdb:5) name
  &amp;quot;contact[name]&amp;quot;
 
  (rdb:5) params
  {&amp;quot;contact[name]&amp;quot;=&amp;gt;&amp;quot;Jonathan&amp;quot;, &amp;quot;authenticity_token&amp;quot;=&amp;gt;&amp;quot;sd76bBiUOGsmSW... etc.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T17:58:38+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-06T17:58:39+00:00</updated-at>
      <user-id type="integer">3685</user-id>
      <version type="integer">7</version>
      <user-name>Jonathan Sutherland</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Handing off to josh who was making changes to our parser</body>
      <body-html>&lt;div&gt;&lt;p&gt;Handing off to josh who was making changes to our parser&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-07T22:15:50+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 141
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-07T22:15:53+00:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">8</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can you please test this issue against rack/master.

I vendor it for the moment so we can test Rails against it before Rack 1.0 is released.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you please test this issue against rack/master.&lt;/p&gt;
&lt;p&gt;I vendor it for the moment so we can test Rails against it
before Rack 1.0 is released.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-07T23:10:55+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-07T23:10:57+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">9</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I verified this affects jpg files on OSX 10.5.6 with Firefox 2.0.0.12 and Safari 3.1.2.  I tried to test against rack/master but I am unsure if I did it correctly.

I did git submodule add git://github.com/chneukirchen/rack.git vendor/plugins/rack

restarted my server and re-tested, the results were the same

How do I tell if my application is using the rack installed in vendor/plugins?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I verified this affects jpg files on OSX 10.5.6 with Firefox
2.0.0.12 and Safari 3.1.2. I tried to test against rack/master but
I am unsure if I did it correctly.&lt;/p&gt;
&lt;p&gt;I did git submodule add git://github.com/chneukirchen/rack.git
vendor/plugins/rack&lt;/p&gt;
&lt;p&gt;restarted my server and re-tested, the results were the same&lt;/p&gt;
&lt;p&gt;How do I tell if my application is using the rack installed in
vendor/plugins?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-09T19:12:38+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-09T19:12:42+00:00</updated-at>
      <user-id type="integer">46781</user-id>
      <version type="integer">10</version>
      <user-name>Chris Barnes</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>O, my mistake. I meant to say with edge rails.

I bundled rack into edge rails. You should be able to do `rake rails:freeze:edge` and try again.</body>
      <body-html>&lt;div&gt;&lt;p&gt;O, my mistake. I meant to say with edge rails.&lt;/p&gt;
&lt;p&gt;I bundled rack into edge rails. You should be able to do
&lt;code&gt;rake rails:freeze:edge&lt;/code&gt; and try again.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-09T20:06:07+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-09T20:06:11+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">11</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Ok, I created a new app, froze to edge and tested again exactly as Johnathan did in his example and I get a 500 error &quot;bad content body&quot;  You can find the full error at http://www.pastie.org/384389.  

Anything I can do to help, let me know.  I would love to get this working.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ok, I created a new app, froze to edge and tested again exactly
as Johnathan did in his example and I get a 500 error &quot;bad content
body&quot; You can find the full error at &lt;a href=&quot;http://www.pastie.org/384389.%3Cbr/&quot;&gt;http://www.pastie.org/384389.&lt;br&gt;
&lt;/a&gt;&amp;gt;&lt;/p&gt;
&lt;p&gt;Anything I can do to help, let me know. I would love to get this
working.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-09T21:35:29+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-09T21:35:33+00:00</updated-at>
      <user-id type="integer">46781</user-id>
      <version type="integer">12</version>
      <user-name>Chris Barnes</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This looks like a bug in Rack core.

If your dying to jump on this, you can write a failing unit test against rack (http://github.com/rack/rack/blob/4d5485b52cf465f4a23e20e9ed35f453b5c3beff/test/spec_rack_utils.rb) and submit it to http://rack.lighthouseapp.com/. You can actually still assign the ticket to me :)

Otherwise I'll take a look at the issue closer towards the end of the week.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This looks like a bug in Rack core.&lt;/p&gt;
&lt;p&gt;If your dying to jump on this, you can write a failing unit test
against rack (&lt;a href=&quot;http://github.com/rack/rack/blob/4d5485b52cf465f4a23e20e9ed35f453b5c3beff/test/spec_rack_utils.rb)&quot;&gt;http://github.com/rack/rack/blob...&lt;/a&gt;
and submit it to &lt;a href=&quot;http://rack.lighthouseapp.com/&quot;&gt;http://rack.lighthouseapp.com/&lt;/a&gt;.
You can actually still assign the ticket to me :)&lt;/p&gt;
&lt;p&gt;Otherwise I'll take a look at the issue closer towards the end
of the week.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-09T21:40:56+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-09T21:40:57+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">13</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>BINGO! Your on the 0.9.1 rack release. /Users/chris/.gem/ruby/1.8/gems/rack-0.9.1

I think I fixed the vendored rack load path. Please try again, I suspect it will work fine.</body>
      <body-html>&lt;div&gt;&lt;p&gt;BINGO! Your on the 0.9.1 rack release.
/Users/chris/.gem/ruby/1.8/gems/rack-0.9.1&lt;/p&gt;
&lt;p&gt;I think I fixed the vendored rack load path. Please try again, I
suspect it will work fine.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-10T19:51:08+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-10T19:51:11+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">14</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Looks good Josh.

Don't see this issue anymore with Rails edge + vendored Rack.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks good Josh.&lt;/p&gt;
&lt;p&gt;Don't see this issue anymore with Rails edge + vendored
Rack.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-10T20:04:18+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-10T20:04:22+00:00</updated-at>
      <user-id type="integer">3685</user-id>
      <version type="integer">15</version>
      <user-name>Jonathan Sutherland</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Awesome!

I don't see this issues anymore with edge rails also.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Awesome!&lt;/p&gt;
&lt;p&gt;I don't see this issues anymore with edge rails also.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-11T19:49:47+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-11T19:49:52+00:00</updated-at>
      <user-id type="integer">46781</user-id>
      <version type="integer">16</version>
      <user-name>Chris Barnes</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I just ran into this issue myself, I had 2 file fields on the page and a textarea. Submitting the form with one or no files made Rails recognize the textarea, but submitting both file fields would make the textarea disappear from the params. After checking out the POST parameters to ensure it wasn't a browser issue, I figured it had to be an issue with Rails. 

Luckily, I found this thread but I have a feeling most developers won't. I can definitely make a blog post about it but perhaps something more public should be made known about this issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just ran into this issue myself, I had 2 file fields on the
page and a textarea. Submitting the form with one or no files made
Rails recognize the textarea, but submitting both file fields would
make the textarea disappear from the params. After checking out the
POST parameters to ensure it wasn't a browser issue, I figured it
had to be an issue with Rails.&lt;/p&gt;
&lt;p&gt;Luckily, I found this thread but I have a feeling most
developers won't. I can definitely make a blog post about it but
perhaps something more public should be made known about this
issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-12T03:37:57+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-12T03:38:01+00:00</updated-at>
      <user-id type="integer">30873</user-id>
      <version type="integer">17</version>
      <user-name>Nick Quaranto</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Nick,  the fixes in this thread will be shipped as part of the second
RC for rails 2.3,  it'll be fixed before the releases are 'in the
wild'</body>
      <body-html>&lt;div&gt;&lt;p&gt;Nick, the fixes in this thread will be shipped as part of the
second RC for rails 2.3, it'll be fixed before the releases are 'in
the wild'&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-12T05:38:07+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-02-12T05:38:08+00:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">18</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm getting strange errors still with the latest Rails edge.

http://gist.github.com/77057

I've tried digging through the code, but I can't quite figure it out.
It's happening in this file:
rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/utils.rb on line 298 and 330. It looks like rack.input.read is nil.

I've tested this both using Passenger and Litespeed with the same effect.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm getting strange errors still with the latest Rails edge.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://gist.github.com/77057&quot;&gt;http://gist.github.com/77057&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I've tried digging through the code, but I can't quite figure it
out. It's happening in this file:
rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/utils.rb
on line 298 and 330. It looks like rack.input.read is nil.&lt;/p&gt;
&lt;p&gt;I've tested this both using Passenger and Litespeed with the
same effect.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-10T18:53:15+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-03-10T18:58:00+00:00</updated-at>
      <user-id type="integer">30197</user-id>
      <version type="integer">19</version>
      <user-name>Russ Smith</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm still getting this but it is hard to reproduce, I have one safari browser that is getting the errors. I am on a frozen v2.3.2.1 and passenger 2.1.3. Here is my stack trace

/!\ FAILSAFE /!\  Tue Apr 07 21:19:30 +0000 2009
  Status: 500 Internal Server Error
  bad content body
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/utils.rb:311:in `parse_multipart'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/request.rb:125:in `POST'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/request.rb:428:in `request_parameters'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/request.rb:381:in `parameters'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/base.rb:1279:in `assign_shortcuts'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/base.rb:518:in `process_without_filters'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
    /mnt/app/releases/20090407190947/vendor/gems/haml-2.0.9/rails/../lib/sass/plugin/rails.rb:19:in `process'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:91:in `dispatch'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:111:in `_call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:82:in `initialize'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/head.rb:9:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/methodoverride.rb:24:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/params_parser.rb:15:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/rewindable_input.rb:25:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:93:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `synchronize'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
    /mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:106:in `call'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/rack/request_handler.rb:65:in `process_request'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_request_handler.rb:197:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:340:in `start_request_handler'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:298:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/utils.rb:176:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:296:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:182:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:149:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:192:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:260:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:121:in `lookup_or_add'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:254:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:75:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:74:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:253:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:148:in `spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:285:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:182:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/bin/passenger-spawn-server:50</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm still getting this but it is hard to reproduce, I have one
safari browser that is getting the errors. I am on a frozen
v2.3.2.1 and passenger 2.1.3. Here is my stack trace&lt;/p&gt;
&lt;p&gt;/!\ FAILSAFE /!\ Tue Apr 07 21:19:30 +0000 2009 Status: 500
Internal Server Error bad content body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/utils.rb:311:in `parse_multipart'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/request.rb:125:in `POST'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/request.rb:428:in `request_parameters'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/request.rb:381:in `parameters'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/base.rb:1279:in `assign_shortcuts'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/base.rb:518:in `process_without_filters'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/filters.rb:606:in `sass_old_process'
/mnt/app/releases/20090407190947/vendor/gems/haml-2.0.9/rails/../lib/sass/plugin/rails.rb:19:in `process'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/rescue.rb:65:in `call_with_exception'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:91:in `dispatch'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:111:in `_call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:82:in `initialize'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:29:in `call'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:9:in `cache'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/query_cache.rb:28:in `call'
/mnt/app/releases/20090407190947/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/head.rb:9:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/methodoverride.rb:24:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/params_parser.rb:15:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/rewindable_input.rb:25:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/session/cookie_store.rb:93:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/failsafe.rb:11:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `synchronize'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
/mnt/app/releases/20090407190947/vendor/rails/actionpack/lib/action_controller/dispatcher.rb:106:in `call'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/rack/request_handler.rb:65:in `process_request'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_request_handler.rb:197:in `main_loop'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:340:in `start_request_handler'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:298:in `handle_spawn_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/utils.rb:176:in `safe_fork'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:296:in `handle_spawn_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `__send__'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `main_loop'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:182:in `start_synchronously'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:149:in `start'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/railz/application_spawner.rb:192:in `start'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:260:in `spawn_rails_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:121:in `lookup_or_add'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:254:in `spawn_rails_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:75:in `synchronize'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server_collection.rb:74:in `synchronize'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:253:in `spawn_rails_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:148:in `spawn_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/spawn_manager.rb:285:in `handle_spawn_application'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `__send__'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:332:in `main_loop'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/lib/phusion_passenger/abstract_server.rb:182:in `start_synchronously'
/usr/lib/ruby/gems/1.8/gems/passenger-2.1.3/bin/passenger-spawn-server:50
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-07T22:32:03+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-04-07T22:32:07+01:00</updated-at>
      <user-id type="integer">10285</user-id>
      <version type="integer">20</version>
      <user-name>Steve Martocci</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I don't have Rack 0.9.1 installed and this has been marked as resolved?  Does that mean there is a fix in edge/rack?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I don't have Rack 0.9.1 installed and this has been marked as
resolved? Does that mean there is a fix in edge/rack?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-08T14:58:14+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-04-08T14:58:20+01:00</updated-at>
      <user-id type="integer">10285</user-id>
      <version type="integer">21</version>
      <user-name>Steve Martocci</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The problem was inside the Rack v0.9.1
utils.rb

rx = /(?:#{EOL})?#{Regexp.quote boundary}(#{EOL}|--)/


version 1.0
announced on Apr 25

http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/334996

has this regexp fixed
rx = /(?:#{EOL})?#{Regexp.quote boundary}(#{EOL}|--)/n

the last modifier tells ruby to use regexp on a binary stream, rather then on the default kcode (which is utf8 under rails).

and as a result the last byte in the jpg was joined with \r byte and it generates wrong match for 

i = buf.index(rx)

and two extra-bytes where cut from stream and added to the file

uploaded file

 ls -l /home/epirogov/469792-20090427134009-945951-328497.jpeg
-rw-r--r-- 1 epirogov epirogov 577926 2009-04-27 08:02 /home/epirogov/469792-20090427134009-945951-328497.jpeg



temp rack file
epirogov@ep:/opt/ror/uping$ ls -l /tmp/RackMultipart.28044.0
-rw------- 1 epirogov epirogov 577928 2009-04-27 16:54 /tmp/RackMultipart.28044.0

the left over of the buf becomes

&quot;-----------------------------16244688581190744854224487137\r\nContent-Disposition: form-data; name=\&quot;tags\&quot;\r\n\r\n12 12 12 12 \r\n-----------------------------16244688581190744854224487137\r\nContent-Disposition: form-data; name=\&quot;submit\&quot;\r\n\r\nSubmit\r\n-----------------------------16244688581190744854224487137--\r\n&quot;

Notice absence of \r\n in front, and 
after
buf.slice!(0, boundary_size+2)

buf lost 'Co'.


after updating rack to 1.0 and restarting passenger
problem went away</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem was inside the Rack v0.9.1 utils.rb&lt;/p&gt;
&lt;p&gt;rx = /(?:#{EOL})?#{Regexp.quote boundary}(#{EOL}|--)/&lt;/p&gt;
&lt;p&gt;version 1.0 announced on Apr 25&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/334996&quot;&gt;
http://blade.nagaokaut.ac.jp/cgi...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;has this regexp fixed rx = /(?:#{EOL})?#{Regexp.quote
boundary}(#{EOL}|--)/n&lt;/p&gt;
&lt;p&gt;the last modifier tells ruby to use regexp on a binary stream,
rather then on the default kcode (which is utf8 under rails).&lt;/p&gt;
&lt;p&gt;and as a result the last byte in the jpg was joined with \r byte
and it generates wrong match for&lt;/p&gt;
&lt;p&gt;i = buf.index(rx)&lt;/p&gt;
&lt;p&gt;and two extra-bytes where cut from stream and added to the
file&lt;/p&gt;
&lt;p&gt;uploaded file&lt;/p&gt;
&lt;p&gt;ls -l /home/epirogov/469792-20090427134009-945951-328497.jpeg
-rw-r--r-- 1 epirogov epirogov 577926 2009-04-27 08:02
/home/epirogov/469792-20090427134009-945951-328497.jpeg&lt;/p&gt;
&lt;p&gt;temp rack file epirogov@ep:/opt/ror/uping$ ls -l
/tmp/RackMultipart.28044.0 -rw------- 1 epirogov epirogov 577928
2009-04-27 16:54 /tmp/RackMultipart.28044.0&lt;/p&gt;
&lt;p&gt;the left over of the buf becomes&lt;/p&gt;
&lt;p&gt;
&quot;-----------------------------16244688581190744854224487137\r\nContent-Disposition:
form-data; name=&quot;tags&quot;\r\n\r\n12 12 12 12
\r\n-----------------------------16244688581190744854224487137\r\nContent-Disposition:
form-data;
name=&quot;submit&quot;\r\n\r\nSubmit\r\n-----------------------------16244688581190744854224487137--\r\n&quot;&lt;/p&gt;
&lt;p&gt;Notice absence of \r\n in front, and after buf.slice!(0,
boundary_size+2)&lt;/p&gt;
&lt;p&gt;buf lost 'Co'.&lt;/p&gt;
&lt;p&gt;after updating rack to 1.0 and restarting passenger problem went
away&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-27T22:15:08+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-04-27T22:15:13+01:00</updated-at>
      <user-id type="integer">38089</user-id>
      <version type="integer">22</version>
      <user-name>Evgeniy Pirogov</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Seems, that the error is still in Rack 1.0. 
I have a multipart Form for video-file-upload. The upload runs into errors on a Linux Gentoo Machine. On Max OS X all is fine.

Rails Version is 2.3.2, Mongrel 1.5. Ruby 1.8.

Has anybody a solution for this issue?

Best Regards.
Simon


Trace:
[09.06.09 12:04:12] [FATAL] /!\ FAILSAFE /!\  Tue Jun 09 12:04:12 +0000 2009
  Status: 500 Internal Server Error
  bad content body
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/utils.rb:311:in `parse_multipart'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/request.rb:125:in `POST'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/methodoverride.rb:15:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/params_parser.rb:15:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rewindable_input.rb:25:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/session/cookie_store.rb:93:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/failsafe.rb:11:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `synchronize'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:106:in `call'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/cgi_process.rb:44:in `dispatch_cgi'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:102:in `dispatch_cgi'
    /usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:28:in `dispatch'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:76:in `process'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `synchronize'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `process'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:159:in `process_client'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:158:in `each'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:158:in `process_client'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `initialize'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `new'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `initialize'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `new'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:282:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:281:in `each'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:281:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:128:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/command.rb:212:in `run'
    /usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:281
    /usr/bin/mongrel_rails:19:in `load'
    /usr/bin/mongrel_rails:19</body>
      <body-html>&lt;div&gt;&lt;p&gt;Seems, that the error is still in Rack 1.0.&lt;br&gt;
I have a multipart Form for video-file-upload. The upload runs into
errors on a Linux Gentoo Machine. On Max OS X all is fine.&lt;/p&gt;
&lt;p&gt;Rails Version is 2.3.2, Mongrel 1.5. Ruby 1.8.&lt;/p&gt;
&lt;p&gt;Has anybody a solution for this issue?&lt;/p&gt;
&lt;p&gt;Best Regards.&lt;br&gt;
Simon&lt;/p&gt;
&lt;p&gt;Trace:&lt;br&gt;
[09.06.09 12:04:12] &lt;a href=&quot;/projects/8994/changesets/FATAL&quot;
title=&quot;Changeset [FATAL]&quot;&gt;[FATAL]&lt;/a&gt; /!\ FAILSAFE /!\ Tue Jun 09
12:04:12 +0000 2009 Status: 500 Internal Server Error bad content
body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/utils.rb:311:in `parse_multipart'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/request.rb:125:in `POST'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/methodoverride.rb:15:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/params_parser.rb:15:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rewindable_input.rb:25:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/session/cookie_store.rb:93:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/failsafe.rb:11:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `synchronize'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/lock.rb:11:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:106:in `call'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/cgi_process.rb:44:in `dispatch_cgi'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:102:in `dispatch_cgi'
/usr/lib64/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:28:in `dispatch'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:76:in `process'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `synchronize'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `process'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:159:in `process_client'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:158:in `each'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:158:in `process_client'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `initialize'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `new'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:285:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `initialize'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `new'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel.rb:268:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:282:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:281:in `each'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/configurator.rb:281:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:128:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/command.rb:212:in `run'
/usr/lib64/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:281
/usr/bin/mongrel_rails:19:in `load'
/usr/bin/mongrel_rails:19&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-09T13:13:33+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-06-09T13:13:34+01:00</updated-at>
      <user-id type="integer">59013</user-id>
      <version type="integer">23</version>
      <user-name>Simon</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I don't think this is resolved.

In Rack1.0, I still have issues where the multi-part parser incorrectly handles &quot;\r\n--&lt;boundary&gt;\r\n&quot;.  Rack doesn't like the leading &quot;\r\n&quot;, but only on internal boundaries, the ends still need the proper leading and trailing \r\n's.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I don't think this is resolved.&lt;/p&gt;
&lt;p&gt;In Rack1.0, I still have issues where the multi-part parser
incorrectly handles &quot;\r\n--\r\n&quot;. Rack doesn't like the leading
&quot;\r\n&quot;, but only on internal boundaries, the ends still need the
proper leading and trailing \r\n's.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-18T19:41:14+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-06-18T19:41:17+01:00</updated-at>
      <user-id type="integer">34502</user-id>
      <version type="integer">24</version>
      <user-name>Andrew Cantino</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have the same issue as well. Rails 2.3.2, Ruby 1.8.6. 
I get the following error with multipart post, and it only happens with Safari3. I used Rack 1.0.0 tag from github. 

/!\ FAILSAFE /!\  Wed Jun 17 13:25:51 -0400 2009
  Status: 500 Internal Server Error
  bad content body
    /Users/akweon/workspace_dev/testme/vendor/gems/rack-1.0.0/lib/rack/utils.rb:315:in `parse_multipart'
    /Users/akweon/workspace_dev/testme/vendor/gems/rack-1.0.0/lib/rack/request.rb:150:in `POST'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/request.rb:428:in `request_parameters'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/request.rb:381:in `parameters'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/base.rb:1279:in `assign_shortcuts'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/base.rb:518:in `process_without_filters'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/filters.rb:606:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rescue.rb:65:in `call_with_exception'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:91:in `dispatch'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:111:in `_call'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:82:in `initialize'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:9:in `cache'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:28:in `call'
    /Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have the same issue as well. Rails 2.3.2, Ruby 1.8.6.&lt;br&gt;
I get the following error with multipart post, and it only happens
with Safari3. I used Rack 1.0.0 tag from github.&lt;/p&gt;
&lt;p&gt;/!\ FAILSAFE /!\ Wed Jun 17 13:25:51 -0400 2009 Status: 500
Internal Server Error bad content body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/Users/akweon/workspace_dev/testme/vendor/gems/rack-1.0.0/lib/rack/utils.rb:315:in `parse_multipart'
/Users/akweon/workspace_dev/testme/vendor/gems/rack-1.0.0/lib/rack/request.rb:150:in `POST'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/request.rb:428:in `request_parameters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/request.rb:381:in `parameters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/base.rb:1279:in `assign_shortcuts'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/base.rb:518:in `process_without_filters'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/filters.rb:606:in `process'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rescue.rb:65:in `call_with_exception'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:91:in `dispatch'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:111:in `_call'
/Library/Ruby/Gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:82:in `initialize'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:9:in `cache'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:28:in `call'
/Users/akweon/.gem/ruby/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-19T01:07:52+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-06-19T01:07:54+01:00</updated-at>
      <user-id type="integer">22860</user-id>
      <version type="integer">25</version>
      <user-name>Amie</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Same problem here as well. But It doesn't occur with Apache/Passenger.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same problem here as well. But It doesn't occur with
Apache/Passenger.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-06-23T12:05:28+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-06-23T12:05:32+01:00</updated-at>
      <user-id type="integer">39626</user-id>
      <version type="integer">26</version>
      <user-name>Rishav Rastogi</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have the same problem too and I'm running Passenger! I have a multiple-files flash up-loader and for some jpg files (generally small size files) I receive this error:

@@@

/!\ FAILSAFE /!\  Thu Jul 23 16:08:38 +0200 2009
  Status: 500 Internal Server Error
  bad content body
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/utils.rb:315:in `parse_multipart'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/request.rb:141:in `POST'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/methodoverride.rb:15:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/params_parser.rb:15:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rewindable_input.rb:25:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/session/abstract_store.rb:122:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:9:in `cache'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:28:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/failsafe.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:106:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/cgi_process.rb:44:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:102:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:28:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/request_handler.rb:38:in `process_request'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_request_handler.rb:165:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:313:in `start_request_handler'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:281:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:163:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:279:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:163:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:278:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:135:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:178:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:270:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:263:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:263:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:135:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:87:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:218:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:213:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:213:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:122:in `spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:247:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/bin/passenger-spawn-server:46

@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have the same problem too and I'm running Passenger! I have a
multiple-files flash up-loader and for some jpg files (generally
small size files) I receive this error:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;
/!\ FAILSAFE /!\  Thu Jul 23 16:08:38 +0200 2009
  Status: 500 Internal Server Error
  bad content body
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/utils.rb:315:in `parse_multipart'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/request.rb:141:in `POST'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/methodoverride.rb:15:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/params_parser.rb:15:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/rewindable_input.rb:25:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/session/abstract_store.rb:122:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:29:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/query_cache.rb:34:in `cache'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:9:in `cache'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/query_cache.rb:28:in `call'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:361:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/failsafe.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.0/lib/rack/lock.rb:11:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:106:in `call'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/cgi_process.rb:44:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:102:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/dispatcher.rb:28:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/request_handler.rb:38:in `process_request'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_request_handler.rb:165:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:313:in `start_request_handler'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:281:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:163:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:279:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:163:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/utils.rb:161:in `safe_fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:278:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:135:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/application_spawner.rb:178:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:270:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:263:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:263:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:135:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `fork'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:112:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/railz/framework_spawner.rb:87:in `start'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:218:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:213:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:213:in `spawn_rails_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:122:in `spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/spawn_manager.rb:247:in `handle_spawn_application'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `__send__'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:317:in `main_loop'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/lib/passenger/abstract_server.rb:168:in `start_synchronously'
    /usr/lib/ruby/gems/1.8/gems/passenger-2.0.4/bin/passenger-spawn-server:46&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-07-23T18:20:52+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-07-23T18:20:53+01:00</updated-at>
      <user-id type="integer">63804</user-id>
      <version type="integer">27</version>
      <user-name>Carlo Schiesaro</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>We're seeing this as well, but only on Safari 3.0.4.  3.1.2 and 3.2.1 and 4.x work fine.

Seems that the multipart POST goes through fine but the subsequent 302 redirect maintains the multipart form boundary even though there is not multipart.

I've attached a http dump of what's happening on our side.  Notice there's a boundary declaration in the content-type but no actual boundary.  Hence the bad content body message.

GET /account/profile HTTP/1.1
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en-us) AppleWebKit/523.10.3 (KHTML, like Gecko) Version/3.0.4 Safari/523.10
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarywOlQsi2bYiV5wZZ9
Accept-Encoding: gzip, deflate
Referer: http://example.com/account/profile
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language: en-us
Cookie: __utmz=101394963.1249421411.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); example-feedback=shown; user_credentials=a3ceda139fe0814524ca5f790364b69720c9d127424fb6224dbfd158a5fbec891f858d6f95567b174c7e445084f4dc2be4eb4b809d459fa052d9ed2626beec43%3A%3A501; __utma=101394963.46971259123285960.1249421411.1250182330.1250187248.9; __utmc=101394963; __utmb=101394963.2.10.1250187248; _example_session=BAh7CzoQX2NzcmZfdG9rZW4iMXR6bXdGRWZFMk1lbXVWOTF3NSs0OVJqekxpMkdrK3VHSVZScmdOWkVud3c9IhV1c2VyX2NyZWRlbnRpYWxzIgGAYTNjZWRhMTM5ZmUwODE0NTI0Y2E1Zjc5MDM2NGI2OTcyMGM5ZDEyNzQyNGZiNjIyNGRiZmQxNThhNWZiZWM4OTFmODU4ZDZmOTU1NjdiMTc0YzdlNDQ1MDg0ZjRkYzJiZTRlYjRiODA5ZDQ1OWZhMDUyZDllZDI2MjZiZWVjNDM6D3Nlc3Npb25faWQiJWNiNTQ2YTZjOTdiNjdiZmM0YTFhNmNkMzNiNDliYTdjOgxwcm9kdWN0aQI1FyIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsGOgtub3RpY2UiFUFjY291bnQgdXBkYXRlZCEGOgpAdXNlZHsGOwlGIhh1c2VyX2NyZWRlbnRpYWxzX2lkaQL1AQ%3D%3D--40ef23bc3fc8d6d549fc809e1c623a252e842c74
Pragma: no-cache
Connection: keep-alive
Host: example.com</body>
      <body-html>&lt;div&gt;&lt;p&gt;We're seeing this as well, but only on Safari 3.0.4. 3.1.2 and
3.2.1 and 4.x work fine.&lt;/p&gt;
&lt;p&gt;Seems that the multipart POST goes through fine but the
subsequent 302 redirect maintains the multipart form boundary even
though there is not multipart.&lt;/p&gt;
&lt;p&gt;I've attached a http dump of what's happening on our side.
Notice there's a boundary declaration in the content-type but no
actual boundary. Hence the bad content body message.&lt;/p&gt;
&lt;p&gt;GET /account/profile HTTP/1.1&lt;br&gt;
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en-us)
AppleWebKit/523.10.3 (KHTML, like Gecko) Version/3.0.4
Safari/523.10&lt;br&gt;
Content-Type: multipart/form-data;
boundary=----WebKitFormBoundarywOlQsi2bYiV5wZZ9&lt;br&gt;
Accept-Encoding: gzip, deflate&lt;br&gt;
Referer: &lt;a href=
&quot;http://example.com/account/profile&quot;&gt;http://example.com/account/profile&lt;/a&gt;&lt;br&gt;
Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,&lt;em&gt;/&lt;/em&gt;;q=0.5&lt;br&gt;
Accept-Language: en-us&lt;br&gt;
Cookie:
&lt;strong&gt;utmz=101394963.1249421411.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
example-feedback=shown;
user_credentials=a3ceda139fe0814524ca5f790364b69720c9d127424fb6224dbfd158a5fbec891f858d6f95567b174c7e445084f4dc2be4eb4b809d459fa052d9ed2626beec43%3A%3A501;&lt;/strong&gt;
utma=101394963.46971259123285960.1249421411.1250182330.1250187248.9;
&lt;strong&gt;utmc=101394963;&lt;/strong&gt; utmb=101394963.2.10.1250187248;
_example_session=BAh7CzoQX2NzcmZfdG9rZW4iMXR6bXdGRWZFMk1lbXVWOTF3NSs0OVJqekxpMkdrK3VHSVZScmdOWkVud3c9IhV1c2VyX2NyZWRlbnRpYWxzIgGAYTNjZWRhMTM5ZmUwODE0NTI0Y2E1Zjc5MDM2NGI2OTcyMGM5ZDEyNzQyNGZiNjIyNGRiZmQxNThhNWZiZWM4OTFmODU4ZDZmOTU1NjdiMTc0YzdlNDQ1MDg0ZjRkYzJiZTRlYjRiODA5ZDQ1OWZhMDUyZDllZDI2MjZiZWVjNDM6D3Nlc3Npb25faWQiJWNiNTQ2YTZjOTdiNjdiZmM0YTFhNmNkMzNiNDliYTdjOgxwcm9kdWN0aQI1FyIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsGOgtub3RpY2UiFUFjY291bnQgdXBkYXRlZCEGOgpAdXNlZHsGOwlGIhh1c2VyX2NyZWRlbnRpYWxzX2lkaQL1AQ%3D%3D--40ef23bc3fc8d6d549fc809e1c623a252e842c74&lt;br&gt;
Pragma: no-cache&lt;br&gt;
Connection: keep-alive&lt;br&gt;
Host: example.com&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-13T20:41:04+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-08-13T20:41:08+01:00</updated-at>
      <user-id type="integer">58492</user-id>
      <version type="integer">28</version>
      <user-name>ian (at cocodot)</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm having this issue with Safari 4.0.4. Firefox is fine. Any idea? 

I'm on Rails 2.3.4, rack 1.0.1, and ruby 1.8.6 using Mac os x leopard and mongrel in development mode</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm having this issue with Safari 4.0.4. Firefox is fine. Any
idea?&lt;/p&gt;
&lt;p&gt;I'm on Rails 2.3.4, rack 1.0.1, and ruby 1.8.6 using Mac os x
leopard and mongrel in development mode&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-12-05T19:34:08+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>multipart upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2009-12-05T19:34:11+00:00</updated-at>
      <user-id type="integer">59923</user-id>
      <version type="integer">29</version>
      <user-name>Manish Shah</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi,

I am having this as well, with GET requests that may or may not subsequently get redirected by a login before_filter. The error always ocurs in rack-1..1/lib/rack/utils.rb:319 in &quot;parse_multipart&quot;, although with a simple GET request, there should be no multipart to parse (right?).

It is also strange that in rack/request.rb, the POST method is called, although there was never a POST. Also, most(!) requests I receive that trigger this error come from Googlebots. But not all.

Running Passenger 2.2.5 and Rails 2.3.5, with Rack 1.0.1 on Apache 2.2.3 on Debian 5.0. 

Any help would be appreciated. Root path for the output below is /opt/ruby-enterprise-1.8.7-2010.02/lib/ruby/gems/1.8/gems/ (cropped for better readability).

@@@
/!\ FAILSAFE /!\  30.07.2010  06:28  Status: 500 Internal Server Error
  bad content body
rack-1.0.1/lib/rack/utils.rb:319:in `parse_multipart'
rack-1.0.1/lib/rack/request.rb:133:in `POST'
rack-1.0.1/lib/rack/methodoverride.rb:15:in `call'
actionpack-2.3.5/lib/action_controller/params_parser.rb:15:in `call'
actionpack-2.3.5/lib/action_controller/session/cookie_store.rb:93:in `call'
actionpack-2.3.5/lib/action_controller/failsafe.rb:26:in `call'
rack-1.0.1/lib/rack/lock.rb:11:in `call'
rack-1.0.1/lib/rack/lock.rb:11:in `synchronize'
rack-1.0.1/lib/rack/lock.rb:11:in `call'
actionpack-2.3.5/lib/action_controller/dispatcher.rb:106:in `call'
passenger-2.2.15/lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;I am having this as well, with GET requests that may or may not
subsequently get redirected by a login before_filter. The error
always ocurs in rack-1..1/lib/rack/utils.rb:319 in
&quot;parse_multipart&quot;, although with a simple GET request, there should
be no multipart to parse (right?).&lt;/p&gt;
&lt;p&gt;It is also strange that in rack/request.rb, the POST method is
called, although there was never a POST. Also, most(!) requests I
receive that trigger this error come from Googlebots. But not
all.&lt;/p&gt;
&lt;p&gt;Running Passenger 2.2.5 and Rails 2.3.5, with Rack 1.0.1 on
Apache 2.2.3 on Debian 5.0.&lt;/p&gt;
&lt;p&gt;Any help would be appreciated. Root path for the output below is
/opt/ruby-enterprise-1.8.7-2010.02/lib/ruby/gems/1.8/gems/ (cropped
for better readability).&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/!\ FAILSAFE /!\  30.07.2010  06:28  Status: 500 Internal Server Error
  bad content body
rack-1.0.1/lib/rack/utils.rb:319:in `parse_multipart'
rack-1.0.1/lib/rack/request.rb:133:in `POST'
rack-1.0.1/lib/rack/methodoverride.rb:15:in `call'
actionpack-2.3.5/lib/action_controller/params_parser.rb:15:in `call'
actionpack-2.3.5/lib/action_controller/session/cookie_store.rb:93:in `call'
actionpack-2.3.5/lib/action_controller/failsafe.rb:26:in `call'
rack-1.0.1/lib/rack/lock.rb:11:in `call'
rack-1.0.1/lib/rack/lock.rb:11:in `synchronize'
rack-1.0.1/lib/rack/lock.rb:11:in `call'
actionpack-2.3.5/lib/action_controller/dispatcher.rb:106:in `call'
passenger-2.2.15/lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-30T06:21:12+01:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: multipart upload
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">50</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>failsafe multipart rack upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2010-07-30T06:21:16+01:00</updated-at>
      <user-id type="integer">81520</user-id>
      <version type="integer">30</version>
      <user-name>Jens</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am seeing this problem as well with Rails 2.3.5.  Has there been a solution?


!\ FAILSAFE /!\  Thu Nov 11 23:51:39 CET 2010
  Status: 500 Internal Server Error
  bad content body
    /usr/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/utils.rb:319:in `parse_multipart'</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am seeing this problem as well with Rails 2.3.5. Has there
been a solution?&lt;/p&gt;
&lt;p&gt;!\ FAILSAFE /!\ Thu Nov 11 23:51:39 CET 2010 Status: 500
Internal Server Error bad content body&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/usr/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/utils.rb:319:in `parse_multipart'&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-12T02:38:16+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">50</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>failsafe multipart rack upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2010-11-12T02:38:29+00:00</updated-at>
      <user-id type="integer">124642</user-id>
      <version type="integer">31</version>
      <user-name>aerende</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm seeing this error again in production under rails 2.3.10 and passenger 3.0.3 under apache. The upgrade from passenger 2 is the only thing that has changed.

Users are attempting to upload largish files (2-8mb). Most work, some fail; it's intermittent.  The Rack version in use is 1.1.0.  

I don't know how to test Rails with Rack 1.2.1 to see if this is resolved in that version, as rack is loaded before environment.rb is run.  If I try to force it by uninstalling Rack 1.1, I get the warning that the dependencies for rails 2.3.10 will break.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm seeing this error again in production under rails 2.3.10 and
passenger 3.0.3 under apache. The upgrade from passenger 2 is the
only thing that has changed.&lt;/p&gt;
&lt;p&gt;Users are attempting to upload largish files (2-8mb). Most work,
some fail; it's intermittent. The Rack version in use is
1.1.0.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I don't know how to test Rails with Rack 1.2.1 to see if this is
resolved in that version, as rack is loaded before environment.rb
is run. If I try to force it by uninstalling Rack 1.1, I get the
warning that the dependencies for rails 2.3.10 will break.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-16T02:20:16+00:00</created-at>
      <creator-id type="integer">3685</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1875</number>
      <permalink>posting-a-multipart-form-with-file-data-can-break-params-assignment-in-23</permalink>
      <priority type="integer">50</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>failsafe multipart rack upload</tag>
      <title>Posting a multipart form with file data can break params assignment (in 2.3)</title>
      <updated-at type="datetime">2011-01-16T02:20:38+00:00</updated-at>
      <user-id type="integer">88731</user-id>
      <version type="integer">32</version>
      <user-name>Jim Haungs</user-name>
      <creator-name>Jonathan Sutherland</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1875</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
</ticket>
