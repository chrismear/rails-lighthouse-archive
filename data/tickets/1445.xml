<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-11-23T11:11:18+00:00</created-at>
  <creator-id type="integer">15012</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">1445</number>
  <permalink>actionmailer-subclass-renders-view-when-perform_deliveries-false</permalink>
  <priority type="integer">823</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag nil="true"></tag>
  <title>ActionMailer subclass renders view when @@perform_deliveries = false</title>
  <updated-at type="datetime">2009-03-12T19:29:45+00:00</updated-at>
  <user-id type="integer">15012</user-id>
  <version type="integer">3</version>
  <user-name>Ryan Lowe</user-name>
  <creator-name>Ryan Lowe</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1445</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>I'm updating to Rails 2.2 and ActionMailer has changed behavior, specifically with its treatment of @@perform_deliveries.

I'm using a sort of clever &quot;hack&quot; in my ActionMailer subclass I found on a blog post: bailing out of sending the email if the user has set a preference not to receive it.  I'm looking at the user's preference data in the mailer's action, setting @@perform_deliveries according to the user's preference (if no preference, it is true).  If @@perform_deliveries is false I expect the template not to be rendered and the email not to be sent.

The code is here:
http://gist.github.com/28090
I've included the mailer, the view, the test that is failing and its output.

This has worked up to and including Rails 2.1.0 and it does not with Rails 2.2.2

Is there a new way to do this kind of thing in Rails 2.2.x and that's why the old way is now broken?</original-body>
  <latest-body>I'm updating to Rails 2.2 and ActionMailer has changed behavior, specifically with its treatment of @@perform_deliveries.

I'm using a sort of clever &quot;hack&quot; in my ActionMailer subclass I found on a blog post: bailing out of sending the email if the user has set a preference not to receive it.  I'm looking at the user's preference data in the mailer's action, setting @@perform_deliveries according to the user's preference (if no preference, it is true).  If @@perform_deliveries is false I expect the template not to be rendered and the email not to be sent.

The code is here:
http://gist.github.com/28090
I've included the mailer, the view, the test that is failing and its output.

This has worked up to and including Rails 2.1.0 and it does not with Rails 2.2.2

Is there a new way to do this kind of thing in Rails 2.2.x and that's why the old way is now broken?</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I'm updating to Rails 2.2 and ActionMailer has changed behavior,
specifically with its treatment of @@perform_deliveries.&lt;/p&gt;
&lt;p&gt;I'm using a sort of clever &quot;hack&quot; in my ActionMailer subclass I
found on a blog post: bailing out of sending the email if the user
has set a preference not to receive it. I'm looking at the user's
preference data in the mailer's action, setting
@@perform_deliveries according to the user's preference (if no
preference, it is true). If @@perform_deliveries is false I expect
the template not to be rendered and the email not to be sent.&lt;/p&gt;
&lt;p&gt;The code is here: &lt;a href=&quot;http://gist.github.com/28090&quot;&gt;http://gist.github.com/28090&lt;/a&gt;
I've included the mailer, the view, the test that is failing and
its output.&lt;/p&gt;
&lt;p&gt;This has worked up to and including Rails 2.1.0 and it does not
with Rails 2.2.2&lt;/p&gt;
&lt;p&gt;Is there a new way to do this kind of thing in Rails 2.2.x and
that's why the old way is now broken?&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm updating to Rails 2.2 and ActionMailer has changed behavior, specifically with its treatment of @@perform_deliveries.

I'm using a sort of clever &quot;hack&quot; in my ActionMailer subclass I found on a blog post: bailing out of sending the email if the user has set a preference not to receive it.  I'm looking at the user's preference data in the mailer's action, setting @@perform_deliveries according to the user's preference (if no preference, it is true).  If @@perform_deliveries is false I expect the template not to be rendered and the email not to be sent.

The code is here:
http://gist.github.com/28090
I've included the mailer, the view, the test that is failing and its output.

This has worked up to and including Rails 2.1.0 and it does not with Rails 2.2.2

Is there a new way to do this kind of thing in Rails 2.2.x and that's why the old way is now broken?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm updating to Rails 2.2 and ActionMailer has changed behavior,
specifically with its treatment of @@perform_deliveries.&lt;/p&gt;
&lt;p&gt;I'm using a sort of clever &quot;hack&quot; in my ActionMailer subclass I
found on a blog post: bailing out of sending the email if the user
has set a preference not to receive it. I'm looking at the user's
preference data in the mailer's action, setting
@@perform_deliveries according to the user's preference (if no
preference, it is true). If @@perform_deliveries is false I expect
the template not to be rendered and the email not to be sent.&lt;/p&gt;
&lt;p&gt;The code is here: &lt;a href=&quot;http://gist.github.com/28090&quot;&gt;http://gist.github.com/28090&lt;/a&gt;
I've included the mailer, the view, the test that is failing and
its output.&lt;/p&gt;
&lt;p&gt;This has worked up to and including Rails 2.1.0 and it does not
with Rails 2.2.2&lt;/p&gt;
&lt;p&gt;Is there a new way to do this kind of thing in Rails 2.2.x and
that's why the old way is now broken?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-23T11:11:18+00:00</created-at>
      <creator-id type="integer">15012</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1445</number>
      <permalink>actionmailer-subclass-renders-view-when-perform_deliveries-false</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer subclass renders view when @@perform_deliveries = false</title>
      <updated-at type="datetime">2008-11-23T11:11:20+00:00</updated-at>
      <user-id type="integer">15012</user-id>
      <version type="integer">1</version>
      <user-name>Ryan Lowe</user-name>
      <creator-name>Ryan Lowe</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1445</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Should really ask in the mailing list - http://groups.google.com/group/rubyonrails-talk

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;Should really ask in the mailing list - &lt;a href=&quot;http://groups.google.com/group/rubyonrails-talk&quot;&gt;http://groups.google.com/group/r...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-12T17:37:35+00:00</created-at>
      <creator-id type="integer">15012</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1445</number>
      <permalink>actionmailer-subclass-renders-view-when-perform_deliveries-false</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>ActionMailer subclass renders view when @@perform_deliveries = false</title>
      <updated-at type="datetime">2009-03-12T17:37:36+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">2</version>
      <user-name>Pratik</user-name>
      <creator-name>Ryan Lowe</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1445</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I disagree, this is a regression of behaviour in Rails that's been around for a while.

If this was meant to be a deprecation of behaviour, where's the alternative?  How can I stop a mail from being sent from within a mailer method (action)?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I disagree, this is a regression of behaviour in Rails that's
been around for a while.&lt;/p&gt;
&lt;p&gt;If this was meant to be a deprecation of behaviour, where's the
alternative? How can I stop a mail from being sent from within a
mailer method (action)?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-12T19:29:42+00:00</created-at>
      <creator-id type="integer">15012</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1445</number>
      <permalink>actionmailer-subclass-renders-view-when-perform_deliveries-false</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>ActionMailer subclass renders view when @@perform_deliveries = false</title>
      <updated-at type="datetime">2009-03-12T19:29:45+00:00</updated-at>
      <user-id type="integer">15012</user-id>
      <version type="integer">3</version>
      <user-name>Ryan Lowe</user-name>
      <creator-name>Ryan Lowe</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1445</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
