<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-08-06T18:25:07+01:00</created-at>
  <creator-id type="integer">26228</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">766</number>
  <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
  <priority type="integer">6</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack edge patch tests</tag>
  <title>Adding some more tests for the new behaviour of partial collection counters</title>
  <updated-at type="datetime">2008-08-09T16:49:39+01:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">9</version>
  <user-name>Repository</user-name>
  <creator-name>Cameron Yule</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
  <priority-name nil="true"></priority-name>
  <original-body>There's been changes made to partial collection counters between Rails 2.1 and Edge which haven't been fully tested.

In Rails 2.1, render :partial =&gt; 'sometemplate', with no collection parameter being passed in, still results in sometemplate_counter being set as a local variable with a value of 0.

This behaviour is no longer the same in Edge rails, where the counter is only generated for partials with a collection. This is a good change, as it allows for the counter to be over-ridden by passing in your own local variable (e.g. when you're adding new elements to a pre-rendered list via AJAX).

See this thread on the the Rails Core mailing list for more information;

http://groups.google.com/group/rubyonrails-core/browse_thread/thread/d94569c6ef9520e7

I've attempted to write a few tests to check for this behaviour.</original-body>
  <latest-body>There's been changes made to partial collection counters between Rails 2.1 and Edge which haven't been fully tested.

In Rails 2.1, render :partial =&gt; 'sometemplate', with no collection parameter being passed in, still results in sometemplate_counter being set as a local variable with a value of 0.

This behaviour is no longer the same in Edge rails, where the counter is only generated for partials with a collection. This is a good change, as it allows for the counter to be over-ridden by passing in your own local variable (e.g. when you're adding new elements to a pre-rendered list via AJAX).

See this thread on the the Rails Core mailing list for more information;

http://groups.google.com/group/rubyonrails-core/browse_thread/thread/d94569c6ef9520e7

I've attempted to write a few tests to check for this behaviour.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
There's been changes made to partial collection counters between Rails 2.1 and Edge which haven't been fully tested.
&lt;/p&gt;&lt;p&gt;
In Rails 2.1, render :partial =&gt; 'sometemplate', with no collection parameter being passed in, still results in sometemplate_counter being set as a local variable with a value of 0.
&lt;/p&gt;&lt;p&gt;
This behaviour is no longer the same in Edge rails, where the counter is only generated for partials with a collection. This is a good change, as it allows for the counter to be over-ridden by passing in your own local variable (e.g. when you're adding new elements to a pre-rendered list via AJAX).
&lt;/p&gt;&lt;p&gt;
See this thread on the the Rails Core mailing list for more information;
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://groups.google.com/group/rubyonrails-core/browse_thread/thread/d94569c6ef9520e7&quot;&gt;http://groups.google.com/group/r...&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
I've attempted to write a few tests to check for this behaviour.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>There's been changes made to partial collection counters between Rails 2.1 and Edge which haven't been fully tested.

In Rails 2.1, render :partial =&gt; 'sometemplate', with no collection parameter being passed in, still results in sometemplate_counter being set as a local variable with a value of 0.

This behaviour is no longer the same in Edge rails, where the counter is only generated for partials with a collection. This is a good change, as it allows for the counter to be over-ridden by passing in your own local variable (e.g. when you're adding new elements to a pre-rendered list via AJAX).

See this thread on the the Rails Core mailing list for more information;

http://groups.google.com/group/rubyonrails-core/browse_thread/thread/d94569c6ef9520e7

I've attempted to write a few tests to check for this behaviour.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
There's been changes made to partial collection counters between Rails 2.1 and Edge which haven't been fully tested.
&lt;/p&gt;&lt;p&gt;
In Rails 2.1, render :partial =&gt; 'sometemplate', with no collection parameter being passed in, still results in sometemplate_counter being set as a local variable with a value of 0.
&lt;/p&gt;&lt;p&gt;
This behaviour is no longer the same in Edge rails, where the counter is only generated for partials with a collection. This is a good change, as it allows for the counter to be over-ridden by passing in your own local variable (e.g. when you're adding new elements to a pre-rendered list via AJAX).
&lt;/p&gt;&lt;p&gt;
See this thread on the the Rails Core mailing list for more information;
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://groups.google.com/group/rubyonrails-core/browse_thread/thread/d94569c6ef9520e7&quot;&gt;http://groups.google.com/group/r...&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
I've attempted to write a few tests to check for this behaviour.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-06T18:25:07+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack edge patch tests</tag>
      <title>[PATCH] Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-06T18:25:07+01:00</updated-at>
      <user-id type="integer">26228</user-id>
      <version type="integer">1</version>
      <user-name>Cameron Yule</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Am I missing something or is the second test not duplicating the already existing test test_partial_collection_with_counter ?

Also would it not be preferable if the first test asserted what we're really interested in: that the value from :locals is taken into account, rather a side effect of it (an error being raised if :locals doesn't specify a value ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Am I missing something or is the second test not duplicating the already existing test test_partial_collection_with_counter ?
&lt;/p&gt;&lt;p&gt;
Also would it not be preferable if the first test asserted what we're really interested in: that the value from :locals is taken into account, rather a side effect of it (an error being raised if :locals doesn't specify a value ?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-06T19:04:46+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack edge patch tests</tag>
      <title>[PATCH] Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-06T19:04:46+01:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">2</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hi Frederick, thanks for the reply. You're entirely correct, I'd duped another test, and the value from :locals being taken into account is of course the logical thing to test as opposed to the error being raised.

Updated the patch with changes to reflect your suggestions, hopefully it's more suitable.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hi Frederick, thanks for the reply. You're entirely correct, I'd duped another test, and the value from :locals being taken into account is of course the logical thing to test as opposed to the error being raised.
&lt;/p&gt;&lt;p&gt;
Updated the patch with changes to reflect your suggestions, hopefully it's more suitable.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-06T19:58:37+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack edge patch tests</tag>
      <title>[PATCH] Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-06T19:58:37+01:00</updated-at>
      <user-id type="integer">26228</user-id>
      <version type="integer">3</version>
      <user-name>Cameron Yule</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-06T20:41:17+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- 
:title: &quot;[PATCH] Adding some more tests for the new behaviour of partial collection counters&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-06T20:41:17+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">4</version>
      <user-name>Pratik</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T03:31:55+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-07T03:31:55+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Its really awesome that you found this. I also surprised to &quot;good&quot; features accidentally added by the refactoring.

However, I do get a test failure after I applied it.

@@@
test_render_partial_with_locals(ViewRenderTest):
NoMethodError: undefined method `controller_path' for NilClass:Class
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Its really awesome that you found this. I also surprised to &quot;good&quot; features accidentally added by the refactoring.&lt;/p&gt;

&lt;p&gt;However, I do get a test failure after I applied it.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
test_render_partial_with_locals(ViewRenderTest):
NoMethodError: undefined method `controller_path' for NilClass:Class
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T03:47:10+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-07T03:47:10+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">6</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T06:49:14+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-07T06:49:14+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">7</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Hi Joshua, thanks for pointing that out!

Updated to correct the failing test (was simply an incorrect path).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Joshua, thanks for pointing that out!&lt;/p&gt;

&lt;p&gt;Updated to correct the failing test (was simply an incorrect path).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T08:19:58+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-07T08:19:58+01:00</updated-at>
      <user-id type="integer">26228</user-id>
      <version type="integer">8</version>
      <user-name>Cameron Yule</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [2faf35cea9846fdfa1099f5dfd1589d53a3daf3b]) Added tests for partial collection counters [#766 state:resolved]
Signed-off-by: Joshua Peek &lt;josh@joshpeek.com&gt;
http://github.com/rails/rails/commit/2faf35cea9846fdfa1099f5dfd1589d53a3daf3b</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [2faf35cea9846fdfa1099f5dfd1589d53a3daf3b]) Added tests for partial collection counters [&lt;a href=&quot;/projects/8994/tickets/766&quot; title=&quot;Ticket #766&quot;&gt;#766&lt;/a&gt; state:resolved]
Signed-off-by: Joshua Peek &lt;a&gt;&amp;#x6a;&amp;#111;&amp;#x73;&amp;#104;&amp;#64;&amp;#x6a;&amp;#x6f;&amp;#115;&amp;#x68;&amp;#x70;&amp;#101;&amp;#x65;&amp;#x6b;&amp;#46;&amp;#99;&amp;#x6f;&amp;#109;&lt;/a&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/2faf35cea9846fdfa1099f5dfd1589d53a3daf3b&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-09T16:49:39+01:00</created-at>
      <creator-id type="integer">26228</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">766</number>
      <permalink>patch-adding-some-more-tests-for-the-new-behaviour-of-partial-collection-counters</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack edge patch tests</tag>
      <title>Adding some more tests for the new behaviour of partial collection counters</title>
      <updated-at type="datetime">2008-08-09T16:49:39+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">9</version>
      <user-name>Repository</user-name>
      <creator-name>Cameron Yule</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/766</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>68b14f2eeedba19116acdea4bbbf0ff68d51c9fc</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-06T18:25:07+01:00</created-at>
      <filename>partial_collection_counter_tests.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">37432</id>
      <size type="integer">2419</size>
      <uploader-id type="integer">26228</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/37432/partial_collection_counter_tests.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>c664d272c6839a22b1dd0c01c5e8baed3a8581fe</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-06T19:58:37+01:00</created-at>
      <filename>partial_collection_counter_tests.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">37456</id>
      <size type="integer">2860</size>
      <uploader-id type="integer">26228</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/37456/partial_collection_counter_tests.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>34335a7dabb07c7288d9cab368247df26ee5c85c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-07T08:19:58+01:00</created-at>
      <filename>partial_collection_counter_tests.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">37553</id>
      <size type="integer">2432</size>
      <uploader-id type="integer">26228</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/37553/partial_collection_counter_tests.diff</url>
    </attachment>
  </attachments>
</ticket>
