<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-06-11T16:04:57+01:00</created-at>
  <creator-id type="integer">23341</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4830</number>
  <permalink>updates-to-relationship-resources-are-lost</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>Updates to relationship resources are lost</title>
  <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">13</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Sam Ruby</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>High</priority-name>
  <original-body>Updates to a line_item resource which relates a product to a cart are lost.

Broken by commit [0265c708b9696c3943518ad5f3dabdc22c5eba11](https://rails.lighthouseapp.com/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11)

[testcase](http://intertwingly.net/stories/2010/06/11/modify_association_test.rb), [output](http://intertwingly.net/stories/2010/06/11/modify_association_test.html), [git bisect](http://intertwingly.net/stories/2010/06/11/bisect.out)</original-body>
  <latest-body>Updates to a line_item resource which relates a product to a cart are lost.

Broken by commit [0265c708b9696c3943518ad5f3dabdc22c5eba11](https://rails.lighthouseapp.com/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11)

[testcase](http://intertwingly.net/stories/2010/06/11/modify_association_test.rb), [output](http://intertwingly.net/stories/2010/06/11/modify_association_test.html), [git bisect](http://intertwingly.net/stories/2010/06/11/bisect.out)</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Updates to a line_item resource which relates a product to a
cart are lost.&lt;/p&gt;
&lt;p&gt;Broken by commit &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11&quot;&gt;
0265c708b9696c3943518ad5f3dabdc22c5eba11&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/modify_association_test.rb&quot;&gt;
testcase&lt;/a&gt;, &lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/modify_association_test.html&quot;&gt;
output&lt;/a&gt;, &lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/bisect.out&quot;&gt;git
bisect&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Updates to a line_item resource which relates a product to a cart are lost.

Broken by commit [0265c708b9696c3943518ad5f3dabdc22c5eba11](https://rails.lighthouseapp.com/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11)

[testcase](http://intertwingly.net/stories/2010/06/11/modify_association_test.rb), [output](http://intertwingly.net/stories/2010/06/11/modify_association_test.html), [git bisect](http://intertwingly.net/stories/2010/06/11/bisect.out)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Updates to a line_item resource which relates a product to a
cart are lost.&lt;/p&gt;
&lt;p&gt;Broken by commit &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/changesets/0265c708b9696c3943518ad5f3dabdc22c5eba11&quot;&gt;
0265c708b9696c3943518ad5f3dabdc22c5eba11&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/modify_association_test.rb&quot;&gt;
testcase&lt;/a&gt;, &lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/modify_association_test.html&quot;&gt;
output&lt;/a&gt;, &lt;a href=
&quot;http://intertwingly.net/stories/2010/06/11/bisect.out&quot;&gt;git
bisect&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-11T16:04:57+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-11T16:05:05+01:00</updated-at>
      <user-id type="integer">23341</user-id>
      <version type="integer">1</version>
      <user-name>Sam Ruby</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [85cc1fa657f441417f36998a32a6a158c2697aad]) Revert &quot;Don't overwrite unsaved updates when loading an association but preserve the order of the loaded records. [#4642 state:open]&quot;

This commit introduced a regression described in ticket [#4830].

This reverts commit 0265c708b9696c3943518ad5f3dabdc22c5eba11.
http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a158c2697aad</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/85cc1fa657f441417f36998a32a6a158c2697aad&quot;
title=
&quot;Changeset [85cc1fa657f441417f36998a32a6a158c2697aad]&quot;&gt;[85cc1fa657f441417f36998a32a6a158c2697aad]&lt;/a&gt;)
Revert &quot;Don't overwrite unsaved updates when loading an association
but preserve the order of the loaded records. [&lt;a href=
&quot;/projects/8994/tickets/4642&quot; title=&quot;Ticket #4642&quot;&gt;#4642&lt;/a&gt;
state:open]&quot;&lt;/p&gt;
&lt;p&gt;This commit introduced a regression described in ticket
[&lt;a href=&quot;/projects/8994/tickets/4830&quot; title=
&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt;].&lt;/p&gt;
&lt;p&gt;This reverts commit
0265c708b9696c3943518ad5f3dabdc22c5eba11.&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a158c2697aad&quot;&gt;
http://github.com/rails/rails/commit/85cc1fa657f441417f36998a32a6a1...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-11T16:07:18+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-11T16:07:32+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">2</version>
      <user-name>Repository</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hmm sorry about that. I was trying to fix another bug. I'll look into it as soon as I can.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hmm sorry about that. I was trying to fix another bug. I'll look
into it as soon as I can.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-11T16:15:25+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-11T16:15:31+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">3</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Figured it out and have a fix. I'll post it with an AR testcase shortly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Figured it out and have a fix. I'll post it with an AR testcase
shortly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-12T10:35:50+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-12T10:35:56+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">4</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The updates were not lost entirely as they were still saved to the database. They just weren't reflected in the model immediately afterwards. By keeping my previous fix but allowing already-saved records to be refreshed, everything is okay.

The first attachment is against 2-3-stable where my original commit was not reverted.

The second attachment is against master and reapplies the original commit along with the new fix. I have not got Rails 3 going yet and don't have time to do that today (had trouble when I last tried) so please run the tests to ensure it works.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The updates were not lost entirely as they were still saved to
the database. They just weren't reflected in the model immediately
afterwards. By keeping my previous fix but allowing already-saved
records to be refreshed, everything is okay.&lt;/p&gt;
&lt;p&gt;The first attachment is against 2-3-stable where my original
commit was not reverted.&lt;/p&gt;
&lt;p&gt;The second attachment is against master and reapplies the
original commit along with the new fix. I have not got Rails 3
going yet and don't have time to do that today (had trouble when I
last tried) so please run the tests to ensure it works.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-12T12:03:00+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-12T12:03:04+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">5</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T16:34:27+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-17T16:34:31+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">6</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [f664c57fe854c230d25c448b941569b81860fa79]) Don't overwrite unsaved updates when loading an association but preserve the order of the loaded records. Reapplied from before but now allows already-saved records to be refreshed.

[#4830 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/f664c57fe854c230d25c448b941569b81860fa79</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f664c57fe854c230d25c448b941569b81860fa79&quot;
title=
&quot;Changeset [f664c57fe854c230d25c448b941569b81860fa79]&quot;&gt;[f664c57fe854c230d25c448b941569b81860fa79]&lt;/a&gt;)
Don't overwrite unsaved updates when loading an association but
preserve the order of the loaded records. Reapplied from before but
now allows already-saved records to be refreshed.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/4830&quot; title=
&quot;Ticket #4830&quot;&gt;#4830&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/f664c57fe854c230d25c448b941569b81860fa79&quot;&gt;
http://github.com/rails/rails/commit/f664c57fe854c230d25c448b941569...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-19T23:33:02+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-19T23:33:07+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">7</version>
      <user-name>Repository</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm still loosing _destroy attribute after accessing to collection</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm still loosing _destroy attribute after accessing to
collection&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-30T11:02:14+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-30T11:02:21+01:00</updated-at>
      <user-id type="integer">101835</user-id>
      <version type="integer">8</version>
      <user-name>helg</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm having a crisis this morning but I'll try and look into this tonight.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm having a crisis this morning but I'll try and look into this
tonight.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-30T11:09:02+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-06-30T11:09:09+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">9</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>By looking into the test case, the protected function :load_target must be called using send(:load_target) in order to retrieve the association collection together with the changes made by nested attributes assignment. Is it a desirable way to interact with Rails framework?

Since I need to re-display the record (with nested attributes) on the input form upon validation error, I can only calling send(:load_target) all around in order to prevent the association collection reload from db and wipe out any changes. My problem case described here #5053.</body>
      <body-html>&lt;div&gt;&lt;p&gt;By looking into the test case, the protected function
:load_target must be called using send(:load_target) in order to
retrieve the association collection together with the changes made
by nested attributes assignment. Is it a desirable way to interact
with Rails framework?&lt;/p&gt;
&lt;p&gt;Since I need to re-display the record (with nested attributes)
on the input form upon validation error, I can only calling
send(:load_target) all around in order to prevent the association
collection reload from db and wipe out any changes. My problem case
described here &lt;a href=&quot;/projects/8994/tickets/5053&quot; title=
&quot;Ticket #5053&quot;&gt;#5053&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-08T08:13:04+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-07-08T08:13:07+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">10</version>
      <user-name>szetobo</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>You don't have to call `send(:load_target)`. I think we only do that in the tests because we need to call `find` on the array itself, not ActiveRecord's find. If we were to do `target.find` instead, it wouldn't actually load the collection.

I haven't looked at your particular case but it sounds like the same problem I have already fixed. It should work fine with master or 2-3-stable now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;You don't have to call &lt;code&gt;send(:load_target)&lt;/code&gt;. I think
we only do that in the tests because we need to call
&lt;code&gt;find&lt;/code&gt; on the array itself, not ActiveRecord's find. If
we were to do &lt;code&gt;target.find&lt;/code&gt; instead, it wouldn't
actually load the collection.&lt;/p&gt;
&lt;p&gt;I haven't looked at your particular case but it sounds like the
same problem I have already fixed. It should work fine with master
or 2-3-stable now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-08T09:22:14+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-07-08T09:22:17+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">11</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>We have a form to edit master-child-grandchild record at the same time using nested_attributes. When the form submit, I call  master.update_attributes(params[:master]) and the validation callback is invoked. During the validation handler, I must access the submit data instead of data reload from db and that's why I need to access the association array instead of ActiveRecord's find from db.

Also, if validation failed, I need to re-display the whole form together with error message and with error field highlight. Doing so also need to access the association array instead of refresh data from db.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We have a form to edit master-child-grandchild record at the
same time using nested_attributes. When the form submit, I call
master.update_attributes(params[:master]) and the validation
callback is invoked. During the validation handler, I must access
the submit data instead of data reload from db and that's why I
need to access the association array instead of ActiveRecord's find
from db.&lt;/p&gt;
&lt;p&gt;Also, if validation failed, I need to re-display the whole form
together with error message and with error field highlight. Doing
so also need to access the association array instead of refresh
data from db.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-08T10:18:31+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-07-08T10:18:35+01:00</updated-at>
      <user-id type="integer">87199</user-id>
      <version type="integer">12</version>
      <user-name>szetobo</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:56+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4830</number>
      <permalink>updates-to-relationship-resources-are-lost</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Updates to relationship resources are lost</title>
      <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">13</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4830</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>5e476d842a5a8fcabb681cd6953e5379bc427323</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-12T12:03:00+01:00</created-at>
      <filename>0001-when-not-overwriting-unsaved-updates-in-nested-attri.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">557043</id>
      <size type="integer">3174</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/557043/0001-when-not-overwriting-unsaved-updates-in-nested-attri.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>c9904a6f2882824f9272d3d22e4bc0979fafc5aa</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-12T12:03:00+01:00</created-at>
      <filename>0001-don-t-overwrite-unsaved-updates-when-loading-an-asso.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">557044</id>
      <size type="integer">4200</size>
      <uploader-id type="integer">10014</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/557044/0001-don-t-overwrite-unsaved-updates-when-loading-an-asso.patch</url>
    </attachment>
  </attachments>
</ticket>
