<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-02T22:20:01+00:00</created-at>
  <creator-id type="integer">18156</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1850</number>
  <permalink>wrong-content-type-when-using-localized-templates</permalink>
  <priority type="integer">59</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>2.3 i18n localization templates</tag>
  <title>Wrong Content-Type when using localized templates</title>
  <updated-at type="datetime">2010-07-14T08:46:58+01:00</updated-at>
  <user-id type="integer">10014</user-id>
  <version type="integer">10</version>
  <user-name>James Le Cuirot</user-name>
  <creator-name>Nicolas Blanco</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
  <priority-name nil="true"></priority-name>
  <original-body>Hi,

when I use localized template like : index.fr.html.erb, the Content-Type header sent by the server becomes &quot;fr.html; charset=utf-8&quot; instead of the standard &quot;text/html; charset=utf-8&quot;.

Because of this problem, my browser (Firefox 3) sets a bad character decoder (ISO instead of UTF-8) and my views are broken.</original-body>
  <latest-body>Hi,

when I use localized template like : index.fr.html.erb, the Content-Type header sent by the server becomes &quot;fr.html; charset=utf-8&quot; instead of the standard &quot;text/html; charset=utf-8&quot;.

Because of this problem, my browser (Firefox 3) sets a bad character decoder (ISO instead of UTF-8) and my views are broken.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;when I use localized template like : index.fr.html.erb, the
Content-Type header sent by the server becomes &quot;fr.html;
charset=utf-8&quot; instead of the standard &quot;text/html;
charset=utf-8&quot;.&lt;/p&gt;
&lt;p&gt;Because of this problem, my browser (Firefox 3) sets a bad
character decoder (ISO instead of UTF-8) and my views are
broken.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi,

when I use localized template like : index.fr.html.erb, the Content-Type header sent by the server becomes &quot;fr.html; charset=utf-8&quot; instead of the standard &quot;text/html; charset=utf-8&quot;.

Because of this problem, my browser (Firefox 3) sets a bad character decoder (ISO instead of UTF-8) and my views are broken.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;when I use localized template like : index.fr.html.erb, the
Content-Type header sent by the server becomes &quot;fr.html;
charset=utf-8&quot; instead of the standard &quot;text/html;
charset=utf-8&quot;.&lt;/p&gt;
&lt;p&gt;Because of this problem, my browser (Firefox 3) sets a bad
character decoder (ISO instead of UTF-8) and my views are
broken.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-02T22:20:01+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-02-02T22:20:03+00:00</updated-at>
      <user-id type="integer">18156</user-id>
      <version type="integer">1</version>
      <user-name>Nicolas Blanco</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>OK.

More information : the bad Content-Type is only sent when the locale is not properly loaded/valid (for example in a new Rails application, you set the locale to :fr in the environment.rb file but you don't put a fr.yml file).

But IMHO, the Content-Type sent by Rails should be valid even if the locale is not valid/loaded.</body>
      <body-html>&lt;div&gt;&lt;p&gt;OK.&lt;/p&gt;
&lt;p&gt;More information : the bad Content-Type is only sent when the
locale is not properly loaded/valid (for example in a new Rails
application, you set the locale to :fr in the environment.rb file
but you don't put a fr.yml file).&lt;/p&gt;
&lt;p&gt;But IMHO, the Content-Type sent by Rails should be valid even if
the locale is not valid/loaded.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T10:07:15+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-02-03T10:07:18+00:00</updated-at>
      <user-id type="integer">18156</user-id>
      <version type="integer">2</version>
      <user-name>Nicolas Blanco</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You can register more extensions without adding more configs to locales with

@@@ ruby
I18n.backend.store_translations 'fr', {}
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;You can register more extensions without adding more configs to
locales with&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
I18n.backend.store_translations 'fr', {}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-03T23:24:10+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-02-03T23:24:13+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">3</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Strongly disagree with above &quot;wontfix&quot;. The current behaviour is to half-work, with an incorrect content-type, causing insidious and confusing hard-to-troubleshoot errors. I spent a couple of hours tracking this nasty bug down before finally arriving here.

The &quot;fix&quot; is undocumented and obscure. The localised templates otherwise work, just silently include a completely wrong content-type. What excuse is there for that kind of hideous bug?

This ticket needs to be re-opened immediately.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Strongly disagree with above &quot;wontfix&quot;. The current behaviour is
to half-work, with an incorrect content-type, causing insidious and
confusing hard-to-troubleshoot errors. I spent a couple of hours
tracking this nasty bug down before finally arriving here.&lt;/p&gt;
&lt;p&gt;The &quot;fix&quot; is undocumented and obscure. The localised templates
otherwise work, just silently include a completely wrong
content-type. What excuse is there for that kind of hideous
bug?&lt;/p&gt;
&lt;p&gt;This ticket needs to be re-opened immediately.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-17T11:58:06+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-02-17T12:14:02+00:00</updated-at>
      <user-id type="integer">23238</user-id>
      <version type="integer">4</version>
      <user-name>hkstar</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hmm, we had this issue too, but while I was investigating the issue it was fixed, for at least our case, in edge by another commit.

@hkstar: I would suggest you write some failing unit tests for Template#split, which is most probably where the problem lies.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hmm, we had this issue too, but while I was investigating the
issue it was fixed, for at least our case, in edge by another
commit.&lt;/p&gt;
&lt;p&gt;@hkstar: I would suggest you write some failing unit tests for
Template#split, which is most probably where the problem lies.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-17T12:30:10+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-02-17T13:14:42+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">5</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Strongly disagree with &quot;wontfix&quot;, too!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Strongly disagree with &quot;wontfix&quot;, too!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-24T11:26:55+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-03-24T11:26:57+00:00</updated-at>
      <user-id type="integer">22073</user-id>
      <version type="integer">6</version>
      <user-name>Robert Glaser</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I also disagree with the &quot;wontfix&quot;- I've just run into this bug, and I most definitely have my locale loaded and set correctly. Other parts of the Rails I18n system are working fine, strings are being loaded from my locale file on other templates, etc... but anything that tries to load a localized view displays the above-described behavior. The correct (i.e., localized) view loads, is rendered, and is then sent down to the browser with a content-type of &quot;#{locale}.html&quot;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I also disagree with the &quot;wontfix&quot;- I've just run into this bug,
and I most definitely have my locale loaded and set correctly.
Other parts of the Rails I18n system are working fine, strings are
being loaded from my locale file on other templates, etc... but
anything that tries to load a localized view displays the
above-described behavior. The correct (i.e., localized) view loads,
is rendered, and is then sent down to the browser with a
content-type of &quot;#{locale}.html&quot;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-28T01:43:00+01:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2009-08-28T01:43:03+01:00</updated-at>
      <user-id type="integer">67905</user-id>
      <version type="integer">7</version>
      <user-name>Steven Bedrick</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This also happens if you use a template filename such as edit.default.html.erb, the content-type in this case is set to edit.html, not text/html.

Changing to edit_default.html.erb or manually setting the correct content-type header prevents this problem but imposes a naming scheme on your templates or additional work.


Rails 2.3.5</body>
      <body-html>&lt;div&gt;&lt;p&gt;This also happens if you use a template filename such as
edit.default.html.erb, the content-type in this case is set to
edit.html, not text/html.&lt;/p&gt;
&lt;p&gt;Changing to edit_default.html.erb or manually setting the
correct content-type header prevents this problem but imposes a
naming scheme on your templates or additional work.&lt;/p&gt;
&lt;p&gt;Rails 2.3.5&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-18T12:05:16+00:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2010-02-18T12:05:20+00:00</updated-at>
      <user-id type="integer">70786</user-id>
      <version type="integer">8</version>
      <user-name>Kris Leech</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>With rails 2.3.8, I don't seem to be able to fix this issue with the workaround given.

As far as I can tell, the I18n backend is correctly initialized (dumping it indeed shows that :ja has translations). But still, the content type for a &quot;support.ja.html.haml&quot; template is set to &quot;ja.html; charset=utf-8&quot;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;With rails 2.3.8, I don't seem to be able to fix this issue with
the workaround given.&lt;/p&gt;
&lt;p&gt;As far as I can tell, the I18n backend is correctly initialized
(dumping it indeed shows that :ja has translations). But still, the
content type for a &quot;support.ja.html.haml&quot; template is set to
&quot;ja.html; charset=utf-8&quot;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-14T03:02:27+01:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">59</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2010-07-14T03:02:29+01:00</updated-at>
      <user-id type="integer">107166</user-id>
      <version type="integer">9</version>
      <user-name>Michael Reinsch</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>It works for me with a more recent 2-3-stable but my workaround is to actually create empty locale files like this.

@@@ yaml
ja:
  activerecord:
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;It works for me with a more recent 2-3-stable but my workaround
is to actually create empty locale files like this.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;yaml&quot;&gt;ja:
  activerecord:&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-14T08:46:56+01:00</created-at>
      <creator-id type="integer">18156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1850</number>
      <permalink>wrong-content-type-when-using-localized-templates</permalink>
      <priority type="integer">59</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.3 i18n localization templates</tag>
      <title>Wrong Content-Type when using localized templates</title>
      <updated-at type="datetime">2010-07-14T08:46:58+01:00</updated-at>
      <user-id type="integer">10014</user-id>
      <version type="integer">10</version>
      <user-name>James Le Cuirot</user-name>
      <creator-name>Nicolas Blanco</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1850</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
</ticket>
