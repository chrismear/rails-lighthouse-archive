<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-07-02T16:31:34+01:00</created-at>
  <creator-id type="integer">25124</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">536</number>
  <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
  <priority type="integer">32</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack controller patch tiny</tag>
  <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
  <updated-at type="datetime">2010-11-28T23:52:57+00:00</updated-at>
  <user-id type="integer">126989</user-id>
  <version type="integer">13</version>
  <user-name>dawson17</user-name>
  <creator-name>Mike Subelsky</creator-name>
  <assigned-user-name>Rick</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Currently Rails only recognizes &quot;application/json&quot; as a valid MIME type for JSON requests, but according to the &quot;JSON spec&quot;:http://www.json.org/JSONRequest.html the MIME type should be &quot;application/jsonrequest&quot;.  

This patch merely adds &quot;application/jsonrequest&quot; as a synonym for &quot;application/json&quot;, and also reworks the JSON parsing test slightly so that alternate MIME types can be passed in.</original-body>
  <latest-body>Currently Rails only recognizes &quot;application/json&quot; as a valid MIME type for JSON requests, but according to the &quot;JSON spec&quot;:http://www.json.org/JSONRequest.html the MIME type should be &quot;application/jsonrequest&quot;.  

This patch merely adds &quot;application/jsonrequest&quot; as a synonym for &quot;application/json&quot;, and also reworks the JSON parsing test slightly so that alternate MIME types can be passed in.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
Currently Rails only recognizes &quot;application/json&quot; as a valid MIME type for JSON requests, but according to the &lt;a href=&quot;http://www.json.org/JSONRequest.html&quot;&gt;JSON spec&lt;/a&gt; the MIME type should be &quot;application/jsonrequest&quot;.
&lt;/p&gt;&lt;p&gt;
This patch merely adds &quot;application/jsonrequest&quot; as a synonym for &quot;application/json&quot;, and also reworks the JSON parsing test slightly so that alternate MIME types can be passed in.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Currently Rails only recognizes &quot;application/json&quot; as a valid MIME type for JSON requests, but according to the &quot;JSON spec&quot;:http://www.json.org/JSONRequest.html the MIME type should be &quot;application/jsonrequest&quot;.  

This patch merely adds &quot;application/jsonrequest&quot; as a synonym for &quot;application/json&quot;, and also reworks the JSON parsing test slightly so that alternate MIME types can be passed in.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Currently Rails only recognizes &quot;application/json&quot; as a valid MIME type for JSON requests, but according to the &lt;a href=&quot;http://www.json.org/JSONRequest.html&quot;&gt;JSON spec&lt;/a&gt; the MIME type should be &quot;application/jsonrequest&quot;.
&lt;/p&gt;&lt;p&gt;
This patch merely adds &quot;application/jsonrequest&quot; as a synonym for &quot;application/json&quot;, and also reworks the JSON parsing test slightly so that alternate MIME types can be passed in.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T16:31:35+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T16:31:35+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">1</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>For some reason Lighthouse is not upload the patch as an attachment (in Firefox and Safari) so I am pasting it below.

diff --git a/actionpack/lib/action_controller/mime_types.rb b/actionpack/lib/action_controller/mime_types.rb
index 01a266d..2d7fba1 100644
--- a/actionpack/lib/action_controller/mime_types.rb
+++ b/actionpack/lib/action_controller/mime_types.rb
@@ -17,4 +17,5 @@ Mime::Type.register &quot;multipart/form-data&quot;, :multipart_form
 Mime::Type.register &quot;application/x-www-form-urlencoded&quot;, :url_encoded_form
 
 # http://www.ietf.org/rfc/rfc4627.txt
-Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json )
\ No newline at end of file
+# http://www.json.org/JSONRequest.html
+Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json application/jsonrequest )
\ No newline at end of file
diff --git a/actionpack/test/controller/request_test.rb b/actionpack/test/controller/request_test.rb
index 2bd489b..5d677ca 100644
--- a/actionpack/test/controller/request_test.rb
+++ b/actionpack/test/controller/request_test.rb
@@ -909,15 +909,21 @@ class LegacyXmlParamsParsingTest &lt; XmlParamsParsingTest
 end
 
 class JsonParamsParsingTest &lt; Test::Unit::TestCase
-  def test_hash_params
-    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json)[:person]
+  def test_hash_params_for_application_json
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/json')[:person]
+    assert_kind_of Hash, person
+    assert_equal 'David', person['name']
+  end
+
+  def test_hash_params_for_application_jsonrequest
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/jsonrequest')[:person]
     assert_kind_of Hash, person
     assert_equal 'David', person['name']
   end
 
   private
-    def parse_body(body)
-      env = { 'CONTENT_TYPE'   =&gt; 'application/json',
+    def parse_body(body, content_type)
+      env = { 'CONTENT_TYPE'   =&gt; content_type,
               'CONTENT_LENGTH' =&gt; body.size.to_s }
       cgi = ActionController::Integration::Session::StubCGI.new(env, body)
       ActionController::CgiRequest.new(cgi).request_parameters</body>
      <body-html>&lt;div&gt;&lt;p&gt;
For some reason Lighthouse is not upload the patch as an attachment (in Firefox and Safari) so I am pasting it below.
&lt;/p&gt;&lt;p&gt;
diff --git a/actionpack/lib/action_controller/mime_types.rb b/actionpack/lib/action_controller/mime_types.rb
&lt;/p&gt;&lt;p&gt;
index 01a266d..2d7fba1 100644
&lt;/p&gt;&lt;p&gt;
--- a/actionpack/lib/action_controller/mime_types.rb
&lt;/p&gt;&lt;p&gt;
+++ b/actionpack/lib/action_controller/mime_types.rb
&lt;/p&gt;&lt;p&gt;
@@ -17,4 +17,5 @@ Mime::Type.register &quot;multipart/form-data&quot;, :multipart_form
&lt;/p&gt;&lt;p&gt;
Mime::Type.register &quot;application/x-www-form-urlencoded&quot;, :url_encoded_form
&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;
&lt;a href=&quot;http://www.ietf.org/rfc/rfc4627.txt&quot;&gt;http://www.ietf.org/rfc/rfc4627.txt&lt;/a&gt;
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;
-Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json )
&lt;/p&gt;&lt;p&gt;
\ No newline at end of file
&lt;/p&gt;&lt;p&gt;
+# &lt;a href=&quot;http://www.json.org/JSONRequest.html&quot;&gt;http://www.json.org/JSONRequest....&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
+Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json application/jsonrequest )
&lt;/p&gt;&lt;p&gt;
\ No newline at end of file
&lt;/p&gt;&lt;p&gt;
diff --git a/actionpack/test/controller/request_test.rb b/actionpack/test/controller/request_test.rb
&lt;/p&gt;&lt;p&gt;
index 2bd489b..5d677ca 100644
&lt;/p&gt;&lt;p&gt;
--- a/actionpack/test/controller/request_test.rb
&lt;/p&gt;&lt;p&gt;
+++ b/actionpack/test/controller/request_test.rb
&lt;/p&gt;&lt;p&gt;
@@ -909,15 +909,21 @@ class LegacyXmlParamsParsingTest &amp;lt; XmlParamsParsingTest
&lt;/p&gt;&lt;p&gt;
end
&lt;/p&gt;&lt;p&gt;
class JsonParamsParsingTest &amp;lt; Test::Unit::TestCase
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
 def test_hash_params
&lt;/li&gt;&lt;li&gt;
   person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json)[:person]
&lt;/li&gt;&lt;li&gt;
 def test_hash_params_for_application_json
&lt;/li&gt;&lt;li&gt;
   person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/json')[:person]
&lt;/li&gt;&lt;li&gt;
   assert_kind_of Hash, person
&lt;/li&gt;&lt;li&gt;
   assert_equal 'David', person['name']
&lt;/li&gt;&lt;li&gt;
 end
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;
+
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
 def test_hash_params_for_application_jsonrequest
&lt;/li&gt;&lt;li&gt;
   person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/jsonrequest')[:person]
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;
assert_kind_of Hash, person
&lt;/p&gt;&lt;p&gt;
assert_equal 'David', person['name']
&lt;/p&gt;&lt;p&gt;
end
&lt;/p&gt;&lt;p&gt;
private
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
   def parse_body(body)
&lt;/li&gt;&lt;li&gt;
     env = { 'CONTENT_TYPE'   =&gt; 'application/json',
&lt;/li&gt;&lt;li&gt;
   def parse_body(body, content_type)
&lt;/li&gt;&lt;li&gt;
     env = { 'CONTENT_TYPE'   =&gt; content_type,
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;
'CONTENT_LENGTH' =&gt; body.size.to_s }
&lt;/p&gt;&lt;p&gt;
cgi = ActionController::Integration::Session::StubCGI.new(env, body)
&lt;/p&gt;&lt;p&gt;
ActionController::CgiRequest.new(cgi).request_parameters
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T16:34:56+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T16:34:56+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">2</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>That was nasty; try this one: &quot;http://pastie.org/226332&quot;:http://pastie.org/226332</body>
      <body-html>&lt;div&gt;&lt;p&gt;
That was nasty; try this one: &lt;a href=&quot;http://pastie.org/226332&quot;&gt;http://pastie.org/226332&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T16:36:42+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T16:36:42+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">3</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>@@@

From 644571c993b9baf3ff73e0b423a924dcbc2ffeef Mon Sep 17 00:00:00 2001
From: Mike Subelsky &lt;github@mikeshop.net&gt;
Date: Wed, 2 Jul 2008 14:15:43 -0400
Subject: [PATCH] Added application/jsonrequest as a synonym for application/json

---
 actionpack/lib/action_controller/mime_types.rb |    3 ++-
 actionpack/test/controller/request_test.rb     |   14 ++++++++++----
 2 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/actionpack/lib/action_controller/mime_types.rb b/actionpack/lib/action_controller/mime_types.rb
index 01a266d..2d7fba1 100644
--- a/actionpack/lib/action_controller/mime_types.rb
+++ b/actionpack/lib/action_controller/mime_types.rb
@@ -17,4 +17,5 @@ Mime::Type.register &quot;multipart/form-data&quot;, :multipart_form
 Mime::Type.register &quot;application/x-www-form-urlencoded&quot;, :url_encoded_form
 
 # http://www.ietf.org/rfc/rfc4627.txt
-Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json )
\ No newline at end of file
+# http://www.json.org/JSONRequest.html
+Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json application/jsonrequest )
\ No newline at end of file
diff --git a/actionpack/test/controller/request_test.rb b/actionpack/test/controller/request_test.rb
index 2bd489b..81794a5 100644
--- a/actionpack/test/controller/request_test.rb
+++ b/actionpack/test/controller/request_test.rb
@@ -909,15 +909,21 @@ class LegacyXmlParamsParsingTest &lt; XmlParamsParsingTest
 end
 
 class JsonParamsParsingTest &lt; Test::Unit::TestCase
-  def test_hash_params
-    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json)[:person]
+  def test_hash_params_for_application_json
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/json')[:person]
+    assert_kind_of Hash, person
+    assert_equal 'David', person['name']
+  end
+
+  def test_hash_params_for_application_jsonrequest
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/jsonrequest')[:person]    
     assert_kind_of Hash, person
     assert_equal 'David', person['name']
   end
 
   private
-    def parse_body(body)
-      env = { 'CONTENT_TYPE'   =&gt; 'application/json',
+    def parse_body(body,content_type)
+      env = { 'CONTENT_TYPE'   =&gt; content_type,
               'CONTENT_LENGTH' =&gt; body.size.to_s }
       cgi = ActionController::Integration::Session::StubCGI.new(env, body)
       ActionController::CgiRequest.new(cgi).request_parameters
-- 
1.5.5.3</body>
      <body-html>&lt;div&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:20:06+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:20:06+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">4</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Updated patch: http://pastie.org/226332

(file uploading and @@@ still not working for me, sorry to gum up the works)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Updated patch: &lt;a href=&quot;http://pastie.org/226332&quot;&gt;http://pastie.org/226332&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
(file uploading and @@@ still not working for me, sorry to gum up the works)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:21:17+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:21:17+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">5</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>@@@
From 644571c993b9baf3ff73e0b423a924dcbc2ffeef Mon Sep 17 00:00:00 2001
From: Mike Subelsky &lt;github@mikeshop.net&gt;
Date: Wed, 2 Jul 2008 14:15:43 -0400
Subject: [PATCH] Added application/jsonrequest as a synonym for application/json

---
 actionpack/lib/action_controller/mime_types.rb |    3 ++-
 actionpack/test/controller/request_test.rb     |   14 ++++++++++----
 2 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/actionpack/lib/action_controller/mime_types.rb b/actionpack/lib/action_controller/mime_types.rb
index 01a266d..2d7fba1 100644
--- a/actionpack/lib/action_controller/mime_types.rb
+++ b/actionpack/lib/action_controller/mime_types.rb
@@ -17,4 +17,5 @@ Mime::Type.register &quot;multipart/form-data&quot;, :multipart_form
 Mime::Type.register &quot;application/x-www-form-urlencoded&quot;, :url_encoded_form
 
 # http://www.ietf.org/rfc/rfc4627.txt
-Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json )
\ No newline at end of file
+# http://www.json.org/JSONRequest.html
+Mime::Type.register &quot;application/json&quot;, :json, %w( text/x-json application/jsonrequest )
\ No newline at end of file
diff --git a/actionpack/test/controller/request_test.rb b/actionpack/test/controller/request_test.rb
index 2bd489b..81794a5 100644
--- a/actionpack/test/controller/request_test.rb
+++ b/actionpack/test/controller/request_test.rb
@@ -909,15 +909,21 @@ class LegacyXmlParamsParsingTest &lt; XmlParamsParsingTest
 end
 
 class JsonParamsParsingTest &lt; Test::Unit::TestCase
-  def test_hash_params
-    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json)[:person]
+  def test_hash_params_for_application_json
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/json')[:person]
+    assert_kind_of Hash, person
+    assert_equal 'David', person['name']
+  end
+
+  def test_hash_params_for_application_jsonrequest
+    person = parse_body({:person =&gt; {:name =&gt; &quot;David&quot;}}.to_json,'application/jsonrequest')[:person]    
     assert_kind_of Hash, person
     assert_equal 'David', person['name']
   end
 
   private
-    def parse_body(body)
-      env = { 'CONTENT_TYPE'   =&gt; 'application/json',
+    def parse_body(body,content_type)
+      env = { 'CONTENT_TYPE'   =&gt; content_type,
               'CONTENT_LENGTH' =&gt; body.size.to_s }
       cgi = ActionController::Integration::Session::StubCGI.new(env, body)
       ActionController::CgiRequest.new(cgi).request_parameters
-- 
1.5.5.3

@@@</body>
      <body-html>&lt;div&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;From 644571c993b9baf3ff73e0b423a924dcbc2ffeef Mon Sep 17 00:00:00 2001
From: Mike Subelsky &amp;lt;&lt;a href=&quot;mailto:github@mikeshop.net&quot;&gt;github@mikeshop.net&lt;/a&gt;&amp;gt;
Date: Wed, 2 Jul 2008 14:15:43 -0400
Subject: [PATCH] Added application/jsonrequest as a synonym for application/json

---
 actionpack/lib/action_controller/mime_types.rb |    3 ++-
 actionpack/test/controller/request_test.rb     |   14 ++++++++++----
 2 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/actionpack/lib/action_controller/mime_types.rb b/actionpack/lib/action_controller/mime_types.rb
index 01a266d..2d7fba1 100644
--- a/actionpack/lib/action_controller/mime_types.rb
+++ b/actionpack/lib/action_controller/mime_types.rb
@@ -17,4 +17,5 @@ Mime::Type.register &amp;quot;multipart/form-data&amp;quot;, :multipart_form
 Mime::Type.register &amp;quot;application/x-www-form-urlencoded&amp;quot;, :url_encoded_form
 
 # &lt;a href=&quot;http://www.ietf.org/rfc/rfc4627.txt&quot;&gt;http://www.ietf.org/rfc/rfc4627.txt&lt;/a&gt;
-Mime::Type.register &amp;quot;application/json&amp;quot;, :json, %w( text/x-json )
\ No newline at end of file
+# &lt;a href=&quot;http://www.json.org/JSONRequest.html&quot;&gt;http://www.json.org/JSONRequest....&lt;/a&gt;
+Mime::Type.register &amp;quot;application/json&amp;quot;, :json, %w( text/x-json application/jsonrequest )
\ No newline at end of file
diff --git a/actionpack/test/controller/request_test.rb b/actionpack/test/controller/request_test.rb
index 2bd489b..81794a5 100644
--- a/actionpack/test/controller/request_test.rb
+++ b/actionpack/test/controller/request_test.rb
@@ -909,15 +909,21 @@ class LegacyXmlParamsParsingTest &amp;lt; XmlParamsParsingTest
 end
 
 class JsonParamsParsingTest &amp;lt; Test::Unit::TestCase
-  def test_hash_params
-    person = parse_body({:person =&amp;gt; {:name =&amp;gt; &amp;quot;David&amp;quot;}}.to_json)[:person]
+  def test_hash_params_for_application_json
+    person = parse_body({:person =&amp;gt; {:name =&amp;gt; &amp;quot;David&amp;quot;}}.to_json,'application/json')[:person]
+    assert_kind_of Hash, person
+    assert_equal 'David', person['name']
+  end
+
+  def test_hash_params_for_application_jsonrequest
+    person = parse_body({:person =&amp;gt; {:name =&amp;gt; &amp;quot;David&amp;quot;}}.to_json,'application/jsonrequest')[:person]    
     assert_kind_of Hash, person
     assert_equal 'David', person['name']
   end
 
   private
-    def parse_body(body)
-      env = { 'CONTENT_TYPE'   =&amp;gt; 'application/json',
+    def parse_body(body,content_type)
+      env = { 'CONTENT_TYPE'   =&amp;gt; content_type,
               'CONTENT_LENGTH' =&amp;gt; body.size.to_s }
       cgi = ActionController::Integration::Session::StubCGI.new(env, body)
       ActionController::CgiRequest.new(cgi).request_parameters
-- 
1.5.5.3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:22:47+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:22:47+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">6</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>test</body>
      <body-html>&lt;div&gt;&lt;p&gt;
test
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:23:48+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:23:48+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">7</version>
      <user-name>Rick</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@@@
test_line_offset(RenderTest)
    [./test/controller/render_test.rb:247:in `test_line_offset'
     ./test/../lib/../../activesupport/lib/active_support/testing/setup_and_teardown.rb:91:in `__send__'
     ./test/../lib/../../activesupport/lib/active_support/testing/setup_and_teardown.rb:91:in `run']:
&lt;&quot;1&quot;&gt; expected but was
&lt;&quot;75&quot;&gt;.
@@@</body>
      <body-html>&lt;div&gt;&lt;pre&gt;&lt;code class=&quot;&quot;&gt;test_line_offset(RenderTest)
    [./test/controller/render_test.rb:247:in `test_line_offset'
     ./test/../lib/../../activesupport/lib/active_support/testing/setup_and_teardown.rb:91:in `__send__'
     ./test/../lib/../../activesupport/lib/active_support/testing/setup_and_teardown.rb:91:in `run']:
&amp;lt;&amp;quot;1&amp;quot;&amp;gt; expected but was
&amp;lt;&amp;quot;75&amp;quot;&amp;gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:27:02+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:27:02+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">8</version>
      <user-name>Rick</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [8f640c381d9d1b74f6a0fc3648c21da373661914]) Added application/jsonrequest as a synonym for application/json

[#536 state:resolved]
http://github.com/rails/rails/commit/8f640c381d9d1b74f6a0fc3648c21da373661914</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [8f640c381d9d1b74f6a0fc3648c21da373661914]) Added application/jsonrequest as a synonym for application/json
&lt;/p&gt;&lt;p&gt;
[#536 state:resolved]
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/8f640c381d9d1b74f6a0fc3648c21da373661914&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-02T19:41:11+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-02T19:41:11+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">9</version>
      <user-name>Repository</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The &quot;spec&quot; referred to by the opener of this ticket is not the JSON spec. It is a proposal by Douglas Crockford, that, as far as I know, has not been submitted to any standards body.

More important are the specs that have actually been accepted by standards bodies, which *contradict* this &quot;spec&quot;.

RFC 4627 (The application/json Media Type for JavaScript Object Notation) also written by Douglas Crockford, is a registered IANA mime-type.

The HTTP spec defines the Accept header:

&quot;The Accept request-header field can be used to specify certain media types which are acceptable for the response.&quot;

application/jsonrequest is *not* a media type. It is a hack to get around some perceived security issues. Additionally, JSONRequest has *not* been accepted by any major browser at the current time. Instead, Firefox and Safari are implementing the Access Control spec at the W3C (http://www.w3.org/TR/access-control/) and IE is implementing its own XDR spec (some elucidated at http://code.msdn.microsoft.com/Release/ProjectReleases.aspx?ProjectName=ie8whitepapers&amp;ReleaseId=581).

In other words, it's fine to add this synonym, but it's frankly not an Accept type that is currently in use, nor part of any accepted spec.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
The &quot;spec&quot; referred to by the opener of this ticket is not the JSON spec. It is a proposal by Douglas Crockford, that, as far as I know, has not been submitted to any standards body.
&lt;/p&gt;&lt;p&gt;
More important are the specs that have actually been accepted by standards bodies, which &lt;strong&gt;contradict&lt;/strong&gt; this &quot;spec&quot;.
&lt;/p&gt;&lt;p&gt;
RFC 4627 (The application/json Media Type for JavaScript Object Notation) also written by Douglas Crockford, is a registered IANA mime-type.
&lt;/p&gt;&lt;p&gt;
The HTTP spec defines the Accept header:
&lt;/p&gt;&lt;p&gt;
&quot;The Accept request-header field can be used to specify certain media types which are acceptable for the response.&quot;
&lt;/p&gt;&lt;p&gt;
application/jsonrequest is &lt;strong&gt;not&lt;/strong&gt; a media type. It is a hack to get around some perceived security issues. Additionally, JSONRequest has &lt;strong&gt;not&lt;/strong&gt; been accepted by any major browser at the current time. Instead, Firefox and Safari are implementing the Access Control spec at the W3C (&lt;a href=&quot;http://www.w3.org/TR/access-control/)&quot;&gt;http://www.w3.org/TR/access-cont...&lt;/a&gt; and IE is implementing its own XDR spec (some elucidated at &lt;a href=&quot;http://code.msdn.microsoft.com/Release/ProjectReleases.aspx?ProjectName=ie8whitepapers&amp;ReleaseId=581&quot;&gt;http://code.msdn.microsoft.com/R...&lt;/a&gt;).
&lt;/p&gt;&lt;p&gt;
In other words, it's fine to add this synonym, but it's frankly not an Accept type that is currently in use, nor part of any accepted spec.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-03T20:19:27+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-03T20:19:27+01:00</updated-at>
      <user-id type="integer">7560</user-id>
      <version type="integer">10</version>
      <user-name>Yehuda Katz</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yehuda, that makes a lot of sense.  I didn't have a lot of JSON background before starting this project, but I am assuming that if I mistakenly put too much authority into Crockford's document, a few other people after me might as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Yehuda, that makes a lot of sense.  I didn't have a lot of JSON background before starting this project, but I am assuming that if I mistakenly put too much authority into Crockford's document, a few other people after me might as well.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-04T13:15:02+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-04T13:15:02+01:00</updated-at>
      <user-id type="integer">25124</user-id>
      <version type="integer">11</version>
      <user-name>Mike Subelsky</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@mike the beauty is that only browsers have to implement this. Since no browser implemented it, there's no risk of the bizzaro content-type being requested.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
@mike the beauty is that only browsers have to implement this. Since no browser implemented it, there's no risk of the bizzaro content-type being requested.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-04T21:45:30+01:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2008-07-04T21:45:30+01:00</updated-at>
      <user-id type="integer">7560</user-id>
      <version type="integer">12</version>
      <user-name>Yehuda Katz</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks for clarifying these things about [mime application/json](http://www.driversdownloadhub.com/registry.php?fix=mime &quot;mime application/json&quot;). It was interesting and helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for clarifying these things about &lt;a href=
&quot;http://www.driversdownloadhub.com/registry.php?fix=mime&quot; title=
&quot;mime application/json&quot;&gt;mime application/json&lt;/a&gt;. It was
interesting and helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-28T23:52:42+00:00</created-at>
      <creator-id type="integer">25124</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">536</number>
      <permalink>add-mime-type-application-jsonrequest-for-compliance-with-json-spec</permalink>
      <priority type="integer">32</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack controller patch tiny</tag>
      <title>Add MIME type &quot;application/jsonrequest&quot; for compliance with JSON spec</title>
      <updated-at type="datetime">2010-11-28T23:52:57+00:00</updated-at>
      <user-id type="integer">126989</user-id>
      <version type="integer">13</version>
      <user-name>dawson17</user-name>
      <creator-name>Mike Subelsky</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/536</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ed735fb94695b3fdbc679dc8e36fb532b33a04a2</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-07-02T19:19:38+01:00</created-at>
      <filename>json_synonym.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">30566</id>
      <size type="integer">2422</size>
      <uploader-id type="integer">25124</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/30566/json_synonym.diff</url>
    </attachment>
  </attachments>
</ticket>
