<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">85</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-09-15T21:53:44+01:00</created-at>
  <creator-id type="integer">23341</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">3214</number>
  <permalink>transactions-dont-fail-in-30</permalink>
  <priority type="integer">10</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>3.0 transaction</tag>
  <title>transactions don't fail in 3.0</title>
  <updated-at type="datetime">2010-10-15T23:01:35+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">7</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Sam Ruby</creator-name>
  <assigned-user-name>Jeremy Kemper</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Section 20.4 of Agile Web Development with Rails describes how transactions can be used to prevent things such as negative balances from being stored in a database.  Doing so fails (as expected) in Rails 2.3.4 (and all prior versions of Rails), but doesn't fail (as you would hope it would) with Rails 3.0

Full scenario: http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20

The script itself is standalone, and I'm attaching it here.  To run from a checked out version of Rails, set RUBYLIB as appropriate (see comment in the script); otherwise it will attempt to use the gem version of Rails installed on your system.

Run the script, passing in a single argument of '2' to see the behavior, thus:

  ruby transactions.rb 2</original-body>
  <latest-body>Section 20.4 of Agile Web Development with Rails describes how transactions can be used to prevent things such as negative balances from being stored in a database.  Doing so fails (as expected) in Rails 2.3.4 (and all prior versions of Rails), but doesn't fail (as you would hope it would) with Rails 3.0

Full scenario: http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20

The script itself is standalone, and I'm attaching it here.  To run from a checked out version of Rails, set RUBYLIB as appropriate (see comment in the script); otherwise it will attempt to use the gem version of Rails installed on your system.

Run the script, passing in a single argument of '2' to see the behavior, thus:

  ruby transactions.rb 2</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Section 20.4 of Agile Web Development with Rails describes how
transactions can be used to prevent things such as negative
balances from being stored in a database. Doing so fails (as
expected) in Rails 2.3.4 (and all prior versions of Rails), but
doesn't fail (as you would hope it would) with Rails 3.0&lt;/p&gt;
&lt;p&gt;Full scenario: &lt;a href=
&quot;http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20&quot;&gt;
http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The script itself is standalone, and I'm attaching it here. To
run from a checked out version of Rails, set RUBYLIB as appropriate
(see comment in the script); otherwise it will attempt to use the
gem version of Rails installed on your system.&lt;/p&gt;
&lt;p&gt;Run the script, passing in a single argument of '2' to see the
behavior, thus:&lt;/p&gt;
&lt;p&gt;ruby transactions.rb 2&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Section 20.4 of Agile Web Development with Rails describes how transactions can be used to prevent things such as negative balances from being stored in a database.  Doing so fails (as expected) in Rails 2.3.4 (and all prior versions of Rails), but doesn't fail (as you would hope it would) with Rails 3.0

Full scenario: http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20

The script itself is standalone, and I'm attaching it here.  To run from a checked out version of Rails, set RUBYLIB as appropriate (see comment in the script); otherwise it will attempt to use the gem version of Rails installed on your system.

Run the script, passing in a single argument of '2' to see the behavior, thus:

  ruby transactions.rb 2</body>
      <body-html>&lt;div&gt;&lt;p&gt;Section 20.4 of Agile Web Development with Rails describes how
transactions can be used to prevent things such as negative
balances from being stored in a database. Doing so fails (as
expected) in Rails 2.3.4 (and all prior versions of Rails), but
doesn't fail (as you would hope it would) with Rails 3.0&lt;/p&gt;
&lt;p&gt;Full scenario: &lt;a href=
&quot;http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20&quot;&gt;
http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-20&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The script itself is standalone, and I'm attaching it here. To
run from a checked out version of Rails, set RUBYLIB as appropriate
(see comment in the script); otherwise it will attempt to use the
gem version of Rails installed on your system.&lt;/p&gt;
&lt;p&gt;Run the script, passing in a single argument of '2' to see the
behavior, thus:&lt;/p&gt;
&lt;p&gt;ruby transactions.rb 2&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-15T21:53:44+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2009-09-15T21:53:48+01:00</updated-at>
      <user-id type="integer">23341</user-id>
      <version type="integer">1</version>
      <user-name>Sam Ruby</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The root problem here is that the 'validate' method isn't being called, so the record saves. Looking into it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The root problem here is that the 'validate' method isn't being
called, so the record saves. Looking into it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-16T05:45:15+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2009-09-16T05:45:18+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">2</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The reason why this is failing is because validate is a private method and overriding 'validate' is a deprecated callback. So this calls 'deprecated_callback_method' which checks if the object responds to the passed method. If the method is private it will return false and 'validate' is never executed. If the method is not private validation works fine.
It also works if the new syntax Account.validate(:balance_positive) is used. There it doesn't matter if the method is private or not.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The reason why this is failing is because validate is a private
method and overriding 'validate' is a deprecated callback. So this
calls 'deprecated_callback_method' which checks if the object
responds to the passed method. If the method is private it will
return false and 'validate' is never executed. If the method is not
private validation works fine.&lt;br&gt;
It also works if the new syntax Account.validate(:balance_positive)
is used. There it doesn't matter if the method is private or
not.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-18T04:55:05+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2010-01-18T04:55:06+00:00</updated-at>
      <user-id type="integer">2529</user-id>
      <version type="integer">3</version>
      <user-name>Daniel Guettler</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Upps, this should say: 'validate is defined as private in the given example'...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Upps, this should say: 'validate is defined as private in the
given example'...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-18T04:57:12+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2010-01-18T04:57:13+00:00</updated-at>
      <user-id type="integer">2529</user-id>
      <version type="integer">4</version>
      <user-name>Daniel Guettler</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [40c4a0036a690b2e0e3157520f1851efc77fbef7]) Ensure deprecated validate methods are invoked when they are private [#3214 status:resolved]
http://github.com/rails/rails/commit/40c4a0036a690b2e0e3157520f1851efc77fbef7</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/40c4a0036a690b2e0e3157520f1851efc77fbef7&quot;
title=
&quot;Changeset [40c4a0036a690b2e0e3157520f1851efc77fbef7]&quot;&gt;[40c4a0036a690b2e0e3157520f1851efc77fbef7]&lt;/a&gt;)
Ensure deprecated validate methods are invoked when they are
private [&lt;a href=&quot;/projects/8994/tickets/3214&quot; title=
&quot;Ticket #3214&quot;&gt;#3214&lt;/a&gt; status:resolved] &lt;a href=
&quot;http://github.com/rails/rails/commit/40c4a0036a690b2e0e3157520f1851efc77fbef7&quot;&gt;
http://github.com/rails/rails/commit/40c4a0036a690b2e0e3157520f1851...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-18T08:57:17+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2010-01-18T08:57:18+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">5</version>
      <user-name>Repository</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks Daniel, the information you provided helped fix the issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Daniel, the information you provided helped fix the
issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-01-18T08:59:11+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2010-01-18T08:59:13+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">6</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:35+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">3214</number>
      <permalink>transactions-dont-fail-in-30</permalink>
      <priority type="integer">10</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>3.0 transaction</tag>
      <title>transactions don't fail in 3.0</title>
      <updated-at type="datetime">2010-10-15T23:01:35+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3214</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>1b1449af101006ce782f777ce0802335b4c3423e</code>
      <content-type>application/x-ruby</content-type>
      <created-at type="datetime">2009-09-15T21:53:46+01:00</created-at>
      <filename>transactions.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">269835</id>
      <size type="integer">2435</size>
      <uploader-id type="integer">23341</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/269835/transactions.rb</url>
    </attachment>
  </attachments>
</ticket>
