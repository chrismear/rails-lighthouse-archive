<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">14998</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-04-21T02:15:39+01:00</created-at>
  <creator-id type="integer">36252</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4446</number>
  <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>functional invalid &quot;routing error&quot; routingerror testing</tag>
  <title>multiple nested routes for same resource doesn't work in functional tests?</title>
  <updated-at type="datetime">2010-04-21T21:25:55+01:00</updated-at>
  <user-id type="integer">14998</user-id>
  <version type="integer">8</version>
  <user-name>Ryan Bigg</user-name>
  <creator-name>jemminger</creator-name>
  <assigned-user-name>Ryan Bigg</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
  <priority-name>Low</priority-name>
  <original-body>Say I have routes like so:

    ActionController::Routing::Routes.draw do |map|

      map.resources :tabs do |tab|
        tab.resources :contacts, :collection =&gt; {
          :bar =&gt; :get
        }
      end

      map.resources :clients do |client|
        client.resources :contacts, :collection =&gt; {
          :foo =&gt; :get
        }
      end

      map.root :controller =&gt; 'clients', :action =&gt; 'root'

    end

These routes will work as expected via the webserver, but they will fail in functional tests.  Example app attached.</original-body>
  <latest-body>Say I have routes like so:

    ActionController::Routing::Routes.draw do |map|

      map.resources :tabs do |tab|
        tab.resources :contacts, :collection =&gt; {
          :bar =&gt; :get
        }
      end

      map.resources :clients do |client|
        client.resources :contacts, :collection =&gt; {
          :foo =&gt; :get
        }
      end

      map.root :controller =&gt; 'clients', :action =&gt; 'root'

    end

These routes will work as expected via the webserver, but they will fail in functional tests.  Example app attached.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Say I have routes like so:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActionController::Routing::Routes.draw do |map|

  map.resources :tabs do |tab|
    tab.resources :contacts, :collection =&amp;gt; {
      :bar =&amp;gt; :get
    }
  end

  map.resources :clients do |client|
    client.resources :contacts, :collection =&amp;gt; {
      :foo =&amp;gt; :get
    }
  end

  map.root :controller =&amp;gt; 'clients', :action =&amp;gt; 'root'

end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;These routes will work as expected via the webserver, but they
will fail in functional tests. Example app attached.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Say I have routes like so:

    ActionController::Routing::Routes.draw do |map|

      map.resources :tabs do |tab|
        tab.resources :contacts, :collection =&gt; {
          :bar =&gt; :get
        }
      end

      map.resources :clients do |client|
        client.resources :contacts, :collection =&gt; {
          :foo =&gt; :get
        }
      end

      map.root :controller =&gt; 'clients', :action =&gt; 'root'

    end

These routes will work as expected via the webserver, but they will fail in functional tests.  Example app attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Say I have routes like so:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActionController::Routing::Routes.draw do |map|

  map.resources :tabs do |tab|
    tab.resources :contacts, :collection =&amp;gt; {
      :bar =&amp;gt; :get
    }
  end

  map.resources :clients do |client|
    client.resources :contacts, :collection =&amp;gt; {
      :foo =&amp;gt; :get
    }
  end

  map.root :controller =&amp;gt; 'clients', :action =&amp;gt; 'root'

end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;These routes will work as expected via the webserver, but they
will fail in functional tests. Example app attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T02:15:39+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>multiple nested routes for same route doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T02:25:43+01:00</updated-at>
      <user-id type="integer">36252</user-id>
      <version type="integer">1</version>
      <user-name>jemminger</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T02:19:07+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same route doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T02:19:08+01:00</updated-at>
      <user-id type="integer">36252</user-id>
      <version type="integer">2</version>
      <user-name>jemminger</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T02:25:23+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- 
:title: multiple nested routes for same route doesn't work in functional tests?
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T02:25:26+01:00</updated-at>
      <user-id type="integer">36252</user-id>
      <version type="integer">3</version>
      <user-name>jemminger</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Your functional test has code like:

@@@ ruby
class ContactsControllerTest &lt; ActionController::TestCase

  test 'should get foo' do
    get :foo
    assert_response :success
  end

  test 'should get bar' do
    get :bar
    assert_response :success
  end
end
@@@

but in your routes.rb, you have marked contacts as nested resource and hence isn't accessible directly. In short, accessing contacts resource directly doesn't work from browser, doesn't work from functional tests. There ain't anything wrong with behavior.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Your functional test has code like:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;class ContactsControllerTest &amp;lt; ActionController::TestCase

  test 'should get foo' do
    get :foo
    assert_response :success
  end

  test 'should get bar' do
    get :bar
    assert_response :success
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but in your routes.rb, you have marked contacts as nested
resource and hence isn't accessible directly. In short, accessing
contacts resource directly doesn't work from browser, doesn't work
from functional tests. There ain't anything wrong with
behavior.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T05:32:28+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T05:32:29+01:00</updated-at>
      <user-id type="integer">2053</user-id>
      <version type="integer">4</version>
      <user-name>gnufied</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T05:34:13+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: functional &quot;routing error&quot; routingerror testing
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional invalid &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T05:34:18+01:00</updated-at>
      <user-id type="integer">2053</user-id>
      <version type="integer">5</version>
      <user-name>gnufied</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Doh, you're right. Changing the tests like so fixes it:



    test 'should get foo' do
      get :foo, :client_id =&gt; 1
      assert_response :success
    end
  
    test 'should get bar' do
      get :bar, :tab_id =&gt; 1
      assert_response :success
    end

And this is how I've set up all my other tests, but for whatever reason brainfarted here and forgot.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Doh, you're right. Changing the tests like so fixes it:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;test 'should get foo' do
  get :foo, :client_id =&amp;gt; 1
  assert_response :success
end

test 'should get bar' do
  get :bar, :tab_id =&amp;gt; 1
  assert_response :success
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And this is how I've set up all my other tests, but for whatever
reason brainfarted here and forgot.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T14:14:27+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional invalid &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T14:14:29+01:00</updated-at>
      <user-id type="integer">36252</user-id>
      <version type="integer">6</version>
      <user-name>jemminger</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Please close this one.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Please close this one.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-21T19:10:57+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>functional invalid &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T19:11:01+01:00</updated-at>
      <user-id type="integer">2053</user-id>
      <version type="integer">7</version>
      <user-name>gnufied</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-21T21:25:51+01:00</created-at>
      <creator-id type="integer">36252</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4446</number>
      <permalink>multiple-nested-routes-for-same-route-doesnt-work-in-functional-tests</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>functional invalid &quot;routing error&quot; routingerror testing</tag>
      <title>multiple nested routes for same resource doesn't work in functional tests?</title>
      <updated-at type="datetime">2010-04-21T21:25:55+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">8</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>jemminger</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4446</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>940fda7e23d2c8141987e4996ffdeac2fc053389</code>
      <content-type>binary/octet-stream</content-type>
      <created-at type="datetime">2010-04-21T02:15:39+01:00</created-at>
      <filename>routing_error.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">490699</id>
      <size type="integer">105993</size>
      <uploader-id type="integer">36252</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/490699/routing_error.zip</url>
    </attachment>
  </attachments>
</ticket>
