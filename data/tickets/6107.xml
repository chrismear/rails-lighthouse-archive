<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-12-13T13:08:31+00:00</created-at>
  <creator-id type="integer">73543</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">6107</number>
  <permalink>update_counters_with_lock-does-not-call-observers</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>activerecordlockingoptimisticclassmethods callback observer update_counters_with_locks</tag>
  <title>update_counters_with_lock does not call observers</title>
  <updated-at type="datetime">2011-03-14T00:00:52+00:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">7</version>
  <user-name>rails</user-name>
  <creator-name>coffeeaddict_nl</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
  <priority-name>Low</priority-name>
  <original-body>update_counters_with_lock from ActiveRecord::Locking::Optimistic::ClassMethods does not trigger the observer callbacks on the model.

I am not really sure whether this is a bug... But from my point of view this is not the expected behaviour.

Feel free to elaborate as to why this *is* expected behaviour and promptly close this ticket. If this is considered a bug I would be happy to render and provide a patch.

I've (manually) tested this to be true in both Rails 2.3.8 and 3.0.3</original-body>
  <latest-body>update_counters_with_lock from ActiveRecord::Locking::Optimistic::ClassMethods does not trigger the observer callbacks on the model.

I am not really sure whether this is a bug... But from my point of view this is not the expected behaviour.

Feel free to elaborate as to why this *is* expected behaviour and promptly close this ticket. If this is considered a bug I would be happy to render and provide a patch.

I've (manually) tested this to be true in both Rails 2.3.8 and 3.0.3</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;update_counters_with_lock from
ActiveRecord::Locking::Optimistic::ClassMethods does not trigger
the observer callbacks on the model.&lt;/p&gt;
&lt;p&gt;I am not really sure whether this is a bug... But from my point
of view this is not the expected behaviour.&lt;/p&gt;
&lt;p&gt;Feel free to elaborate as to why this &lt;em&gt;is&lt;/em&gt; expected
behaviour and promptly close this ticket. If this is considered a
bug I would be happy to render and provide a patch.&lt;/p&gt;
&lt;p&gt;I've (manually) tested this to be true in both Rails 2.3.8 and
3.0.3&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>update_counters_with_lock from ActiveRecord::Locking::Optimistic::ClassMethods does not trigger the observer callbacks on the model.

I am not really sure whether this is a bug... But from my point of view this is not the expected behaviour.

Feel free to elaborate as to why this *is* expected behaviour and promptly close this ticket. If this is considered a bug I would be happy to render and provide a patch.

I've (manually) tested this to be true in both Rails 2.3.8 and 3.0.3</body>
      <body-html>&lt;div&gt;&lt;p&gt;update_counters_with_lock from
ActiveRecord::Locking::Optimistic::ClassMethods does not trigger
the observer callbacks on the model.&lt;/p&gt;
&lt;p&gt;I am not really sure whether this is a bug... But from my point
of view this is not the expected behaviour.&lt;/p&gt;
&lt;p&gt;Feel free to elaborate as to why this &lt;em&gt;is&lt;/em&gt; expected
behaviour and promptly close this ticket. If this is considered a
bug I would be happy to render and provide a patch.&lt;/p&gt;
&lt;p&gt;I've (manually) tested this to be true in both Rails 2.3.8 and
3.0.3&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-03T08:21:25+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2010-12-03T08:21:30+00:00</updated-at>
      <user-id type="integer">73543</user-id>
      <version type="integer">1</version>
      <user-name>coffeeaddict_nl</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think it is a bug. Please feel free to attach a patch for 3.0.3. Patches for 2.3 branch is a littler harder to get accepted since that is a maintenance branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think it is a bug. Please feel free to attach a patch for
3.0.3. Patches for 2.3 branch is a littler harder to get accepted
since that is a maintenance branch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-04T04:13:37+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2010-12-04T04:13:45+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">2</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>After some further investigation as to where to place this patch, it turns out that update_counters in ActiveRecord::Locking::Optimistic::ClassMethods overrides the version from ActiveRecord::CounterCache and just inserts the lock_column as one of the counters.

This brings to light the question whether it is valid to call the observers on counters...

Imho it is. I use counters for stock and it would seem only natural that a change in stock would trigger orders to be placed in backorder (or released from it) but there could be counter arguments; The behaviour is no longer expected as it hasn't occurred before and people rely on the fact the update_counters does **not** call observers.</body>
      <body-html>&lt;div&gt;&lt;p&gt;After some further investigation as to where to place this
patch, it turns out that update_counters in
ActiveRecord::Locking::Optimistic::ClassMethods overrides the
version from ActiveRecord::CounterCache and just inserts the
lock_column as one of the counters.&lt;/p&gt;
&lt;p&gt;This brings to light the question whether it is valid to call
the observers on counters...&lt;/p&gt;
&lt;p&gt;Imho it is. I use counters for stock and it would seem only
natural that a change in stock would trigger orders to be placed in
backorder (or released from it) but there could be counter
arguments; The behaviour is no longer expected as it hasn't
occurred before and people rely on the fact the update_counters
does &lt;strong&gt;not&lt;/strong&gt; call observers.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-06T18:08:47+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2010-12-06T18:08:55+00:00</updated-at>
      <user-id type="integer">73543</user-id>
      <version type="integer">3</version>
      <user-name>coffeeaddict_nl</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can you attach a failing test. I think it is a bug. It is not documented and updating counter should fire callback. Client can do whatever it wants to do.

No need to provide patch for 2.3.x branch . Just work on rails edge.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you attach a failing test. I think it is a bug. It is not
documented and updating counter should fire callback. Client can do
whatever it wants to do.&lt;/p&gt;
&lt;p&gt;No need to provide patch for 2.3.x branch . Just work on rails
edge.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-09T02:30:00+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2010-12-09T02:30:06+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">4</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Customized not expensive &lt;a href=&quot;http://www.nikedunks2011.com/&quot;&gt;nike shoes&lt;/a&gt; Air &lt;a href=&quot;http://www.nikedunks2011.com/&quot;&gt;nike sneaker&lt;/a&gt; are a popular method for expressing your love with the style. You can customize everything on your &lt;a href=&quot;http://www.nikedunks2011.com/nike-dunks-c-155.html&quot;&gt;dunks shoes&lt;/a&gt;, design and color to the texture and substance. Way faster and design your &lt;a href=&quot;http://www.nikedunks2011.com/nike-dunks-nike-dunk-high-c-155_212.html&quot;&gt;nike dunk high&lt;/a&gt; staff would be to buy on the Internet at nike .com and use the site, the participant customization resources.
  Click on the topic customize your own option directly under &lt;a href=&quot;http://www.nikedunks2011.com/nike-air-max-c-215.html&quot;&gt;nike air max&lt;/a&gt;.And click on each region of footwear (sole, a tip, Nike, symbol of the language) and you will be prompted to choose both substance and color for each area. &lt;a href=&quot;http://www.nikedunks2011.com/nike-air-griffey-max-c-213.html&quot;&gt;Nike Air Griffey Max&lt;/a&gt; Based on the region you selected, you have up to 6 choice of substances and &lt;a href=&quot;http://www.nikedunks2011.com/nike-air-max-nike-air-max-90-c-215_220.html&quot;&gt;air max 90&lt;/a&gt; 10 choices.
  Simply click on the size tab on the right side of the Cheap &lt;a href=&quot;http://www.nikedunks2011.com/nike-basketball-shoes-c-235.html&quot;&gt;nike basketball shoes&lt;/a&gt; that you chose. You will be prompted to choose AM men or women, sizes of the participant,&lt;a href=&quot;http://www.nikedunks2011.com/nike-air-force-1-c-18.html&quot;&gt;nike air force 1&lt;/a&gt; a size quantity between 4 and 14, as well as the number of pairs you click like.Just Aod Add to cart everything you&#8217;&lt;a href=&quot;http://www.nikedunks2011.com/nike-basketball-shoes-nike-lebron-james-c-235_242.html&quot;&gt;lebron james shoes&lt;/a&gt; ll probably invited to enter into a personal text that might suit you on the heel of each &lt;a href=&quot;http://www.nikedunks2011.com/nike-air-jordan-c-17.html&quot;&gt;nike air jordan&lt;/a&gt; with an optimum 6 characters.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Customized not expensive &lt;a href=
&quot;http://www.nikedunks2011.com/&quot;&gt;nike shoes&lt;/a&gt; Air &lt;a href=
&quot;http://www.nikedunks2011.com/&quot;&gt;nike sneaker&lt;/a&gt; are a popular
method for expressing your love with the style. You can customize
everything on your &lt;a href=
&quot;http://www.nikedunks2011.com/nike-dunks-c-155.html&quot;&gt;dunks
shoes&lt;/a&gt;, design and color to the texture and substance. Way
faster and design your &lt;a href=
&quot;http://www.nikedunks2011.com/nike-dunks-nike-dunk-high-c-155_212.html&quot;&gt;
nike dunk high&lt;/a&gt; staff would be to buy on the Internet at nike
.com and use the site, the participant customization resources.&lt;br&gt;
Click on the topic customize your own option directly under
&lt;a href=&quot;http://www.nikedunks2011.com/nike-air-max-c-215.html&quot;&gt;nike
air max&lt;/a&gt;.And click on each region of footwear (sole, a tip,
Nike, symbol of the language) and you will be prompted to choose
both substance and color for each area. &lt;a href=
&quot;http://www.nikedunks2011.com/nike-air-griffey-max-c-213.html&quot;&gt;Nike
Air Griffey Max&lt;/a&gt; Based on the region you selected, you have up
to 6 choice of substances and &lt;a href=
&quot;http://www.nikedunks2011.com/nike-air-max-nike-air-max-90-c-215_220.html&quot;&gt;
air max 90&lt;/a&gt; 10 choices. Simply click on the size tab on the
right side of the Cheap &lt;a href=
&quot;http://www.nikedunks2011.com/nike-basketball-shoes-c-235.html&quot;&gt;nike
basketball shoes&lt;/a&gt; that you chose. You will be prompted to choose
AM men or women, sizes of the participant,&lt;a href=
&quot;http://www.nikedunks2011.com/nike-air-force-1-c-18.html&quot;&gt;nike air
force 1&lt;/a&gt; a size quantity between 4 and 14, as well as the number
of pairs you click like.Just Aod Add to cart everything
you&amp;#8217;&lt;a href=
&quot;http://www.nikedunks2011.com/nike-basketball-shoes-nike-lebron-james-c-235_242.html&quot;&gt;lebron
james shoes&lt;/a&gt; ll probably invited to enter into a personal text
that might suit you on the heel of each &lt;a href=
&quot;http://www.nikedunks2011.com/nike-air-jordan-c-17.html&quot;&gt;nike air
jordan&lt;/a&gt; with an optimum 6 characters.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-13T10:07:49+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2010-12-13T13:08:31+00:00</updated-at>
      <user-id type="integer">128794</user-id>
      <version type="integer">5</version>
      <user-name>nike dunks</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-14T00:00:11+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:tag: activerecord::locking::optimistic::classmethods callback observer update_counters_with_locks
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecordlockingoptimisticclassmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2011-03-14T00:00:48+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">6</version>
      <user-name>rails</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-14T00:00:11+00:00</created-at>
      <creator-id type="integer">73543</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6107</number>
      <permalink>update_counters_with_lock-does-not-call-observers</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecordlockingoptimisticclassmethods callback observer update_counters_with_locks</tag>
      <title>update_counters_with_lock does not call observers</title>
      <updated-at type="datetime">2011-03-14T00:00:52+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">7</version>
      <user-name>rails</user-name>
      <creator-name>coffeeaddict_nl</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6107</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
