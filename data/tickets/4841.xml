<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">40272</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-08T23:12:14+00:00</created-at>
  <creator-id type="integer">100767</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4841</number>
  <permalink>multiple-select-only-keep-the-last-one</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>&quot;arel rails3&quot; select</tag>
  <title>multiple select only keep the last one</title>
  <updated-at type="datetime">2010-11-08T23:12:14+00:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">27</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Cedric Fung</creator-name>
  <assigned-user-name>Santiago Pastorino</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>I use rails 3b4

this will return location_title
@@@ ruby
irb(main):001:0&gt; Event.select('title').select('location_title').limit(1)
=&gt; [#&lt;Event location_title: &quot;Shanghai&quot;&gt;]
@@@

but this
@@@ ruby
irb(main):002:0&gt; Event.select('location_title').select('title').limit(1)
=&gt; [#&lt;Event title: &quot;Party ON&quot;&gt;]
@@@</original-body>
  <latest-body>I use rails 3b4

this will return location_title
@@@ ruby
irb(main):001:0&gt; Event.select('title').select('location_title').limit(1)
=&gt; [#&lt;Event location_title: &quot;Shanghai&quot;&gt;]
@@@

but this
@@@ ruby
irb(main):002:0&gt; Event.select('location_title').select('title').limit(1)
=&gt; [#&lt;Event title: &quot;Party ON&quot;&gt;]
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I use rails 3b4&lt;/p&gt;
&lt;p&gt;this will return location_title&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;irb(main):001:0&amp;gt; Event.select('title').select('location_title').limit(1)
=&amp;gt; [#&amp;lt;Event location_title: &quot;Shanghai&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but this&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;irb(main):002:0&amp;gt; Event.select('location_title').select('title').limit(1)
=&amp;gt; [#&amp;lt;Event title: &quot;Party ON&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I use rails 3b4

this will return location_title
@@@ ruby
irb(main):001:0&gt; Event.select('title').select('location_title').limit(1)
=&gt; [#&lt;Event location_title: &quot;Shanghai&quot;&gt;]
@@@

but this
@@@ ruby
irb(main):002:0&gt; Event.select('location_title').select('title').limit(1)
=&gt; [#&lt;Event title: &quot;Party ON&quot;&gt;]
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I use rails 3b4&lt;/p&gt;
&lt;p&gt;this will return location_title&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;irb(main):001:0&amp;gt; Event.select('title').select('location_title').limit(1)
=&amp;gt; [#&amp;lt;Event location_title: &quot;Shanghai&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but this&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;irb(main):002:0&amp;gt; Event.select('location_title').select('title').limit(1)
=&amp;gt; [#&amp;lt;Event title: &quot;Party ON&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-12T10:18:49+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-12T10:18:50+01:00</updated-at>
      <user-id type="integer">100767</user-id>
      <version type="integer">1</version>
      <user-name>Cedric Fung</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Combine those two selects into one: &lt;code&gt;Event.select('title, location_title').limit(1)&lt;/code&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;Combine those two selects into one: &lt;code&gt;Event.select('title,
location_title').limit(1)&lt;/code&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-14T14:13:16+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-14T14:13:20+01:00</updated-at>
      <user-id type="integer">100266</user-id>
      <version type="integer">2</version>
      <user-name>U&#291;is Ozols</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>this just a demo.
I won't use Event.select('title').select('location_title') directly. I just demonstrate the situation.</body>
      <body-html>&lt;div&gt;&lt;p&gt;this just a demo.&lt;br&gt;
I won't use Event.select('title').select('location_title')
directly. I just demonstrate the situation.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-14T14:28:08+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-14T14:28:12+01:00</updated-at>
      <user-id type="integer">100767</user-id>
      <version type="integer">3</version>
      <user-name>Cedric Fung</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Cedric, take a look at the following:

@@@ ruby
ruby-1.9.2-head &gt; Post
 =&gt; Post(id: integer, title: string, content: text, created_at: datetime, updated_at: datetime) 
ruby-1.9.2-head &gt; a = Post.select('title')
 =&gt; [#&lt;Post title: &quot;Test&quot;&gt;, #&lt;Post title: &quot;blah&quot;&gt;, #&lt;Post title: &quot;123&quot;&gt;] 
ruby-1.9.2-head &gt; a.select('content')
 =&gt; [#&lt;Post content: &quot;Testing threadsafe&quot;&gt;, #&lt;Post content: &quot;blah blah&quot;&gt;, #&lt;Post content: &quot;amazing&quot;&gt;] 
@@@

And can you explain why you want to use select('title').select('location_title') instead of select('title, location_title')?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Cedric, take a look at the following:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;ruby-1.9.2-head &amp;gt; Post
 =&amp;gt; Post(id: integer, title: string, content: text, created_at: datetime, updated_at: datetime) 
ruby-1.9.2-head &amp;gt; a = Post.select('title')
 =&amp;gt; [#&amp;lt;Post title: &quot;Test&quot;&amp;gt;, #&amp;lt;Post title: &quot;blah&quot;&amp;gt;, #&amp;lt;Post title: &quot;123&quot;&amp;gt;] 
ruby-1.9.2-head &amp;gt; a.select('content')
 =&amp;gt; [#&amp;lt;Post content: &quot;Testing threadsafe&quot;&amp;gt;, #&amp;lt;Post content: &quot;blah blah&quot;&amp;gt;, #&amp;lt;Post content: &quot;amazing&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And can you explain why you want to use
select('title').select('location_title') instead of select('title,
location_title')?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T08:21:46+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T08:21:50+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">4</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have two named scope

I don't wanna transfer all attributes through the mobile network, so I create a 'simple' scope
@@@ ruby
scope :tiny, select('title, location')
@@@



if the client parameters include 'latitude' and 'longitude', then I'd like get a distance
@@@ ruby
scope :near, lambda { |lat, lon| select(&quot;((latitude-#{lat})*(latitude-#{lat}) + (longitude-#{lon})*(longitude-#{lon})) AS distance&quot;).order('distance DESC') }
@@@


now, I wanna tiny and near(30, 120)
@@@ ruby
irb(main):008:0&gt; e = Event.tiny.near(30,120).first
=&gt; #&lt;Event &gt;
irb(main):009:0&gt; e.distance
=&gt; 1660.7118672780507
irb(main):010:0&gt; e.title
ActiveModel::MissingAttributeError: missing attribute: title
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have two named scope&lt;/p&gt;
&lt;p&gt;I don't wanna transfer all attributes through the mobile
network, so I create a 'simple' scope&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;scope :tiny, select('title, location')&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;if the client parameters include 'latitude' and 'longitude',
then I'd like get a distance&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;scope :near, lambda { |lat, lon| select(&quot;((latitude-#{lat})&lt;em&gt;(latitude-#{lat}) + (longitude-#{lon})&lt;/em&gt;(longitude-#{lon})) AS distance&quot;).order('distance DESC') }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;now, I wanna tiny and near(30, 120)&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;irb(main):008:0&amp;gt; e = Event.tiny.near(30,120).first
=&amp;gt; #&amp;lt;Event &amp;gt;
irb(main):009:0&amp;gt; e.distance
=&amp;gt; 1660.7118672780507
irb(main):010:0&amp;gt; e.title
ActiveModel::MissingAttributeError: missing attribute: title&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T08:59:24+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T08:59:28+01:00</updated-at>
      <user-id type="integer">100767</user-id>
      <version type="integer">5</version>
      <user-name>Cedric Fung</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Shouldn't this

@@@ ruby
select(&quot;((latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)
@@@

be

@@@ ruby
select(&quot;(title, location, (latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)
@@@

Because as the example I gave above, select overrides previous select. Can you try the above and see if it works?

Also are you using some gem/plugin?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Shouldn't this&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;select(&quot;((latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;be&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;select(&quot;(title, location, (latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Because as the example I gave above, select overrides previous
select. Can you try the above and see if it works?&lt;/p&gt;
&lt;p&gt;Also are you using some gem/plugin?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T09:07:43+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T09:07:50+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">6</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>yes, this work
@@@ ruby
select(&quot;(title, location, (latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)
@@@

but if I have many scope, very_tiny, tiny, fast, slow

then I wanna 'very_tiny and near', 'tiny and near', 'fast and tiny and near'...

I must duplicate so many times in select, why I can't combine select just like combine where?</body>
      <body-html>&lt;div&gt;&lt;p&gt;yes, this work&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;select(&quot;(title, location, (latitude-#{lat})(latitude-#{lat}) + (longitude-#{lon})(longitude-#{lon})) AS distance&quot;)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but if I have many scope, very_tiny, tiny, fast, slow&lt;/p&gt;
&lt;p&gt;then I wanna 'very_tiny and near', 'tiny and near', 'fast and
tiny and near'...&lt;/p&gt;
&lt;p&gt;I must duplicate so many times in select, why I can't combine
select just like combine where?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T09:13:27+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T09:13:34+01:00</updated-at>
      <user-id type="integer">100767</user-id>
      <version type="integer">7</version>
      <user-name>Cedric Fung</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T10:27:23+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T10:27:28+01:00</updated-at>
      <user-id type="integer">100767</user-id>
      <version type="integer">8</version>
      <user-name>Cedric Fung</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can someone provide a test case?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can someone provide a test case?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T15:39:41+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
:assigned_user: 89656
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T15:39:47+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">9</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Attached is failing test.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is failing test.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T16:56:55+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T16:57:07+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">10</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Neeraj what about this ...

&lt;pre&gt;+  def test_multiple_selects
+    post = Post.scoped.select('comments_count').select('title').first
+    assert_equal &quot;Welcome to the weblog&quot;, post.title
+    assert_equal 2, post.comments_count
+  end&lt;/pre&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj what about this ...&lt;/p&gt;
&lt;pre&gt;
+  def test_multiple_selects
+    post = Post.scoped.select('comments_count').select('title').first
+    assert_equal &quot;Welcome to the weblog&quot;, post.title
+    assert_equal 2, post.comments_count
+  end
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T18:02:26+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T18:02:59+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">11</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>of course that will do and it is much concise.</body>
      <body-html>&lt;div&gt;&lt;p&gt;of course that will do and it is much concise.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T18:53:02+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T18:53:09+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">12</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Neeraj do you want to upload the patch? is yours ;)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj do you want to upload the patch? is yours ;)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T19:37:08+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-17T19:37:14+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">13</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Ignore me if I'm wrong but isn't this an Arel issue?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ignore me if I'm wrong but isn't this an Arel issue?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-18T01:33:39+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-18T01:33:46+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">14</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>In arel this is what you need to do

@@@ ruby
Table(:users).predicate(users[:id],users[:name])
@@@

AR needs to be fixed to pass columns in the right way.

I am working on a fix. The fix so far I have is

@@@ ruby
last = selects.last
if last.is_a?(Arel::Count) || (last.is_a?(String) &amp;&amp; last.downcase[0,5] =~ /count/)
  arel = arel.project(selects.last)
else          
  arel = arel.project(*selects)
end
@@@

Above fix is passing all the tests (old and new) except one. 

@@@ ruby
 Developer.send(:with_scope, :find =&gt; { :select =&gt; &quot;id, name&quot; }) do
    developer = Developer.find(:first, :select =&gt; 'id, salary', :conditions =&gt; &quot;name = 'David'&quot;)
    assert_equal 80000, developer.salary
    assert !developer.has_attribute?(:name)
  end
end
@@@

I have a feeling that fixing the above test would require a lot of effort. 

Will update on my findings soon.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In arel this is what you need to do&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;Table(:users).predicate(users[:id],users[:name])&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;AR needs to be fixed to pass columns in the right way.&lt;/p&gt;
&lt;p&gt;I am working on a fix. The fix so far I have is&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;last = selects.last
if last.is_a?(Arel::Count) || (last.is_a?(String) &amp;amp;&amp;amp; last.downcase[0,5] =~ /count/)
  arel = arel.project(selects.last)
else          
  arel = arel.project(*selects)
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Above fix is passing all the tests (old and new) except one.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt; Developer.send(:with_scope, :find =&amp;gt; { :select =&amp;gt; &quot;id, name&quot; }) do
    developer = Developer.find(:first, :select =&amp;gt; 'id, salary', :conditions =&amp;gt; &quot;name = 'David'&quot;)
    assert_equal 80000, developer.salary
    assert !developer.has_attribute?(:name)
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I have a feeling that fixing the above test would require a lot
of effort.&lt;/p&gt;
&lt;p&gt;Will update on my findings soon.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-18T03:23:23+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-18T03:23:31+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">15</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Nice work Neeraj :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Nice work Neeraj :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-18T03:29:12+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-18T03:29:18+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">16</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-18T21:30:25+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-18T21:30:32+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">17</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached is a patch which fixes the issue and the test provided by Santiago(with order column added for postgresql).

However the patch is failing following test.

@@@ ruby
  def test_options_select_replaces_scope_select
    Developer.send(:with_scope, :find =&gt; { :select =&gt; &quot;id, name&quot; }) do
      developer = Developer.find(:first, :select =&gt; 'id, salary', :conditions =&gt; &quot;name = 'David'&quot;)
      assert_equal 80000, developer.salary
      assert !developer.has_attribute?(:name)
    end
  end
@@@

This brings to question that I would like to discuss with larger community. Take a look at following two cases.

@@@ ruby
Post.select('title').select('author_name').first
@@@

@@@ ruby
Post.send(:with_scope, :find =&gt; {:select =&gt; 'title'}) do
  Post.find(:first, :select =&gt; 'author_name')
end
@@@

In the first case we would like to have both the selects. In the second case we would like to have only the second select. 
  
When the execution for second select starts then all there is to act upon is a relation object which is already built using first select. Now there is no way to know if the second select should override the first select or should it be appeneded. 

Current code only picks up the last select and hence the above mentioned test passes. However my patch picks up all the selects and test fails.

In order to fix this issue ,it seems, relation object needs to be aware of in what context a select was built into relation object. 

In my first example relation object is being built using standard way and in that case second select should add to the first select.
  
In the second example relation object is being built using 'with_scope' and in that case second select should override first select. Howver in order to do that relation object needs to be aware that select was built using 'with_scope'. And given the level of indirection that is no easy task.
  
Would like to know thoughts of others on this issue. I just started looking whole AR, AM and Arel . So others are likely to have more insight into this issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a patch which fixes the issue and the test provided
by Santiago(with order column added for postgresql).&lt;/p&gt;
&lt;p&gt;However the patch is failing following test.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  def test_options_select_replaces_scope_select
    Developer.send(:with_scope, :find =&amp;gt; { :select =&amp;gt; &quot;id, name&quot; }) do
      developer = Developer.find(:first, :select =&amp;gt; 'id, salary', :conditions =&amp;gt; &quot;name = 'David'&quot;)
      assert_equal 80000, developer.salary
      assert !developer.has_attribute?(:name)
    end
  end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This brings to question that I would like to discuss with larger
community. Take a look at following two cases.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;Post.select('title').select('author_name').first&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;Post.send(:with_scope, :find =&amp;gt; {:select =&amp;gt; 'title'}) do
  Post.find(:first, :select =&amp;gt; 'author_name')
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In the first case we would like to have both the selects. In the
second case we would like to have only the second select.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;When the execution for second select starts then all there is to
act upon is a relation object which is already built using first
select. Now there is no way to know if the second select should
override the first select or should it be appeneded.&lt;/p&gt;
&lt;p&gt;Current code only picks up the last select and hence the above
mentioned test passes. However my patch picks up all the selects
and test fails.&lt;/p&gt;
&lt;p&gt;In order to fix this issue ,it seems, relation object needs to
be aware of in what context a select was built into relation
object.&lt;/p&gt;
&lt;p&gt;In my first example relation object is being built using
standard way and in that case second select should add to the first
select.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;In the second example relation object is being built using
'with_scope' and in that case second select should override first
select. Howver in order to do that relation object needs to be
aware that select was built using 'with_scope'. And given the level
of indirection that is no easy task.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Would like to know thoughts of others on this issue. I just
started looking whole AR, AM and Arel . So others are likely to
have more insight into this issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T20:23:12+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T20:23:23+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">18</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Neeraj,

I discussed this issue with JK and we agreed on the following methods:

* select - should always concatenate
* order - should always concatenate
* reorder - overwrite order

We decided not to provide something as &quot;reselect&quot; yet, because we would like to wait a real use case coming from it. That said, it's ok to break the case in your example above. And we can provide a solution in the future if required.

Just one note, Pastorino is also working on a solution so I would love if you guys could sync. I'm also available if you guys need help.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj,&lt;/p&gt;
&lt;p&gt;I discussed this issue with JK and we agreed on the following
methods:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;select - should always concatenate&lt;/li&gt;
&lt;li&gt;order - should always concatenate&lt;/li&gt;
&lt;li&gt;reorder - overwrite order&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We decided not to provide something as &quot;reselect&quot; yet, because
we would like to wait a real use case coming from it. That said,
it's ok to break the case in your example above. And we can provide
a solution in the future if required.&lt;/p&gt;
&lt;p&gt;Just one note, Pastorino is also working on a solution so I
would love if you guys could sync. I'm also available if you guys
need help.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T20:41:14+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T20:41:22+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">19</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Neeraj i was digging on this bug and the issue is on ARel.
I will fix this thing on ARel and then we need to apply only this patch on Rails.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj i was digging on this bug and the issue is on ARel.&lt;br&gt;
I will fix this thing on ARel and then we need to apply only this
patch on Rails.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T20:44:59+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T20:45:19+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">20</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I've done the new reorder method and i'm working on the order and select concatenation that's an ARel issue so perhaps Neeraj we can chat and see if you have a nice advance on the issue we can merge and if not i don't know :P. Perhaps try to solve another one or keep digging on this :D.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've done the new reorder method and i'm working on the order
and select concatenation that's an ARel issue so perhaps Neeraj we
can chat and see if you have a nice advance on the issue we can
merge and if not i don't know :P. Perhaps try to solve another one
or keep digging on this :D.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T21:10:33+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T21:11:27+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">21</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Santiago: Can you briefly outline what kind of change is forthcoming in Arel.

It seems that your arel patch will support both select cases I outlined in my previous comment. 

When a select is invoked on an existing relation object then how are you going to decide whether to append or to override given that a relation object does not carry the context in which it applied 'select'.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Santiago: Can you briefly outline what kind of change is
forthcoming in Arel.&lt;/p&gt;
&lt;p&gt;It seems that your arel patch will support both select cases I
outlined in my previous comment.&lt;/p&gt;
&lt;p&gt;When a select is invoked on an existing relation object then how
are you going to decide whether to append or to override given that
a relation object does not carry the context in which it applied
'select'.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T21:16:08+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T21:16:16+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">22</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>A new and simpler API of ARel will be really nice. In this way people not using rails will be able to take advantage of good stuff ARel has to offer. 

However I have a different question.

Jos&#233; Valim suggested that we can drop the offending test. You are suggesting that with your Arel fix that test does not need to be dropped. 

@@@ ruby
# case 1
Post.select('title').select('author_name').first

# case 2
Post.send(:with_scope, :find =&gt; {:select =&gt; 'title'}) do
  Post.find(:first, :select =&gt; 'author_name')
end
@@@

In case 1 we need concatenation. In case 2 the second select should override. 

What I would like to know is how would you find out that in case2 the relation object is built within 'with_scope' given that relation object does not carry the context in which it was create.

Yes we should do further talking offline :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;A new and simpler API of ARel will be really nice. In this way
people not using rails will be able to take advantage of good stuff
ARel has to offer.&lt;/p&gt;
&lt;p&gt;However I have a different question.&lt;/p&gt;
&lt;p&gt;Jos&amp;eacute; Valim suggested that we can drop the offending test.
You are suggesting that with your Arel fix that test does not need
to be dropped.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;# case 1
Post.select('title').select('author_name').first

# case 2
Post.send(:with_scope, :find =&amp;gt; {:select =&amp;gt; 'title'}) do
  Post.find(:first, :select =&amp;gt; 'author_name')
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In case 1 we need concatenation. In case 2 the second select
should override.&lt;/p&gt;
&lt;p&gt;What I would like to know is how would you find out that in
case2 the relation object is built within 'with_scope' given that
relation object does not carry the context in which it was
create.&lt;/p&gt;
&lt;p&gt;Yes we should do further talking offline :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T21:39:46+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T21:39:57+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">23</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Neeraj in both cases we need to concatenate</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj in both cases we need to concatenate&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T22:34:28+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-21T22:35:01+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">24</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>(from [0ebb5bf6590b8ac62c53538ade7095676baec3d4]) Support for multiple selects added

[#4841 state:committed]
http://github.com/rails/rails/commit/0ebb5bf6590b8ac62c53538ade7095676baec3d4</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/0ebb5bf6590b8ac62c53538ade7095676baec3d4&quot;
title=
&quot;Changeset [0ebb5bf6590b8ac62c53538ade7095676baec3d4]&quot;&gt;[0ebb5bf6590b8ac62c53538ade7095676baec3d4]&lt;/a&gt;)
Support for multiple selects added&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/4841&quot; title=
&quot;Ticket #4841&quot;&gt;#4841&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/0ebb5bf6590b8ac62c53538ade7095676baec3d4&quot;&gt;
http://github.com/rails/rails/commit/0ebb5bf6590b8ac62c53538ade7095...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-25T20:07:44+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-25T20:07:50+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">25</version>
      <user-name>Repository</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I've created another ticket to push the order related things here https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/4972-order-method-should-concatenate-and-reorder-should-overwrite
I'm about to finish it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've created another ticket to push the order related things
here &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/4972-order-method-should-concatenate-and-reorder-should-overwrite&quot;&gt;
https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets...&lt;/a&gt;&lt;br&gt;
I'm about to finish it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-25T20:18:09+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-06-25T20:18:15+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">26</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:56+01:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">27</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were inspired by   baseball glove design and they created discount handbags with similar qualities.&lt;strong&gt;&lt;a href=&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come along until years later. The original handbag collection   had twelve designs, and they were made from supple, tan, top-quality leathers,   and showed the same excellent craftsmanship and stitching that we still expect   today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought new looks to   Coach bags. She used many new fabrics and organic materials like jersey and   wool. She created the brass hardware that is symbolic of &lt;strong&gt;&lt;a href=&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;. When   Lew Frankfort came aboard in 1979, he brought Coach to the next level, and they   became a name known the world over. Affordable luxury was not a concept that   many people knew, but now they would. Soon after Frankfort joined Coach, they   came out with a catalog, and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought its brand   relevance and strength. They designed watches starting in 1988, and also   expanded their company to Tokyo. Japan still counts among the leading purchasers   of &lt;strong&gt;&lt;a href=&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach heels. The manufacture of Coach shoes began in the mid   90's, and Reed Krakoff, the lead designer, loaned his talents to help put Coach   heels and &lt;a href=&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as their   handbags, but they are well worth the money invested in their purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that don't have   this height. &lt;strong&gt;&lt;a href=&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to style and   pizzazz. Coach platforms come in many styles, from gold loafers to slingbacks   with open toes. You may be able to find Coach shoes at discount prices online,   but be sure that you are buying genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous, Coach   shoes and &lt;a href=&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will make you   feel sporty, too. When selecting pumps or sandals to wear, you'll be happy to   count on the long-standing quality and service of the Coach company. They have   many styles to choose from, including chic and glamorous Coach boots and Coach   heels. Whether you are looking for sports shoes like Coach sneakers or sexy   shoes like Coach boots, the Coach name will never let you down.&lt;/p&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were
inspired by baseball glove design and they created discount
handbags with similar qualities.&lt;strong&gt;&lt;a href=
&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come
along until years later. The original handbag collection had twelve
designs, and they were made from supple, tan, top-quality leathers,
and showed the same excellent craftsmanship and stitching that we
still expect today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought
new looks to Coach bags. She used many new fabrics and organic
materials like jersey and wool. She created the brass hardware that
is symbolic of &lt;strong&gt;&lt;a href=
&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;.
When Lew Frankfort came aboard in 1979, he brought Coach to the
next level, and they became a name known the world over. Affordable
luxury was not a concept that many people knew, but now they would.
Soon after Frankfort joined Coach, they came out with a catalog,
and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought
its brand relevance and strength. They designed watches starting in
1988, and also expanded their company to Tokyo. Japan still counts
among the leading purchasers of &lt;strong&gt;&lt;a href=
&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach
heels. The manufacture of Coach shoes began in the mid 90's, and
Reed Krakoff, the lead designer, loaned his talents to help put
Coach heels and &lt;a href=
&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags
outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as
their handbags, but they are well worth the money invested in their
purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that
don't have this height. &lt;strong&gt;&lt;a href=
&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans
outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to
style and pizzazz. Coach platforms come in many styles, from gold
loafers to slingbacks with open toes. You may be able to find Coach
shoes at discount prices online, but be sure that you are buying
genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=
&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler
jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous,
Coach shoes and &lt;a href=
&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel
purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will
make you feel sporty, too. When selecting pumps or sandals to wear,
you'll be happy to count on the long-standing quality and service
of the Coach company. They have many styles to choose from,
including chic and glamorous Coach boots and Coach heels. Whether
you are looking for sports shoes like Coach sneakers or sexy shoes
like Coach boots, the Coach name will never let you down.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T01:32:32+00:00</created-at>
      <creator-id type="integer">100767</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4841</number>
      <permalink>multiple-select-only-keep-the-last-one</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;arel rails3&quot; select</tag>
      <title>multiple select only keep the last one</title>
      <updated-at type="datetime">2010-11-08T23:12:14+00:00</updated-at>
      <user-id type="integer">123546</user-id>
      <version type="integer">28</version>
      <user-name>jim123456</user-name>
      <creator-name>Cedric Fung</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4841</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>a7f70278d261fba6a828f95d5f99235de4c330ce</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-17T16:56:55+01:00</created-at>
      <filename>4841_test_failure.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">563710</id>
      <size type="integer">964</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/563710/4841_test_failure.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>099e8f9c7b31fab72f064992c64d9defdd864220</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-21T20:23:12+01:00</created-at>
      <filename>wip.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">567650</id>
      <size type="integer">1842</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/567650/wip.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>7462250cca01f55e3b21b4d3ed40a9c20aaf73d3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-21T20:44:59+01:00</created-at>
      <filename>multiple_selects_test.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">567716</id>
      <size type="integer">939</size>
      <uploader-id type="integer">40272</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/567716/multiple_selects_test.patch</url>
    </attachment>
  </attachments>
</ticket>
