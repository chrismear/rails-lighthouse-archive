<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">40263</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-29T05:58:16+00:00</created-at>
  <creator-id type="integer">8551</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">6022</number>
  <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>Content negotiation fails for some */* headers (regression)</title>
  <updated-at type="datetime">2011-04-02T03:11:53+01:00</updated-at>
  <user-id type="integer">137607</user-id>
  <version type="integer">19</version>
  <user-name>William Denniss</user-name>
  <creator-name>Fjan</creator-name>
  <assigned-user-name>Neeraj Singh</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
  <priority-name>Low</priority-name>
  <original-body>On Rails 3.0.3 clients that have an accept header with `*/*` in it will not get a response iff there is an unrecognized mime type in the header and there is no html/text mime type. For example (headers taken from actual production log)

These clients see a &quot;template missing&quot;:

* `HTTP_ACCEPT: text/*`
* `HTTP_ACCEPT: */*, auth/sicily`
* `HTTP_ACCEPT: */*, application/youtube-client`

These clients get the proper response:

* `HTTP_ACCEPT: */*`
* `HTTP_ACCEPT: */*, text/html, application/youtube-client`

These odd headers are pretty rare (Windows CE phone, down jones spider, etc), about 3 per day on a high traffic site, but according to specs they should still receive an HTML response as [this ticket](https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression) discusses.</original-body>
  <latest-body>On Rails 3.0.3 clients that have an accept header with `*/*` in it will not get a response iff there is an unrecognized mime type in the header and there is no html/text mime type. For example (headers taken from actual production log)

These clients see a &quot;template missing&quot;:

* `HTTP_ACCEPT: text/*`
* `HTTP_ACCEPT: */*, auth/sicily`
* `HTTP_ACCEPT: */*, application/youtube-client`

These clients get the proper response:

* `HTTP_ACCEPT: */*`
* `HTTP_ACCEPT: */*, text/html, application/youtube-client`

These odd headers are pretty rare (Windows CE phone, down jones spider, etc), about 3 per day on a high traffic site, but according to specs they should still receive an HTML response as [this ticket](https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression) discusses.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;On Rails 3.0.3 clients that have an accept header with
&lt;code&gt;*/*&lt;/code&gt; in it will not get a response iff there is an
unrecognized mime type in the header and there is no html/text mime
type. For example (headers taken from actual production log)&lt;/p&gt;
&lt;p&gt;These clients see a &quot;template missing&quot;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: text/*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, auth/sicily&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, application/youtube-client&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These clients get the proper response:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, text/html,
application/youtube-client&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These odd headers are pretty rare (Windows CE phone, down jones
spider, etc), about 3 per day on a high traffic site, but according
to specs they should still receive an HTML response as &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression&quot;&gt;
this ticket&lt;/a&gt; discusses.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>On Rails 3.0.3 clients that have an accept header with `*/*` in it will not get a response iff there is an unrecognized mime type in the header and there is no html/text mime type. For example (headers taken from actual production log)

These clients see a &quot;template missing&quot;:

* `HTTP_ACCEPT: text/*`
* `HTTP_ACCEPT: */*, auth/sicily`
* `HTTP_ACCEPT: */*, application/youtube-client`

These clients get the proper response:

* `HTTP_ACCEPT: */*`
* `HTTP_ACCEPT: */*, text/html, application/youtube-client`

These odd headers are pretty rare (Windows CE phone, down jones spider, etc), about 3 per day on a high traffic site, but according to specs they should still receive an HTML response as [this ticket](https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression) discusses.</body>
      <body-html>&lt;div&gt;&lt;p&gt;On Rails 3.0.3 clients that have an accept header with
&lt;code&gt;*/*&lt;/code&gt; in it will not get a response iff there is an
unrecognized mime type in the header and there is no html/text mime
type. For example (headers taken from actual production log)&lt;/p&gt;
&lt;p&gt;These clients see a &quot;template missing&quot;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: text/*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, auth/sicily&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, application/youtube-client&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These clients get the proper response:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*, text/html,
application/youtube-client&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These odd headers are pretty rare (Windows CE phone, down jones
spider, etc), about 3 per day on a high traffic site, but according
to specs they should still receive an HTML response as &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression&quot;&gt;
this ticket&lt;/a&gt; discusses.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T20:37:18+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-20T20:37:20+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">1</version>
      <user-name>Fjan</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Here is a monkey patch that you can drop into your rails initializers if you are in a hurry to fix this because you have a client with a mobile phone who really needs access. I'm fully aware this is not a proper solution but it might help someone.

@@@ ruby

module ActionDispatch
  module Http
    module MimeNegotiation

      # Patched to always accept at least HTML
      def accepts
        @env[&quot;action_dispatch.request.accepts&quot;] ||= begin
          header = @env['HTTP_ACCEPT'].to_s.strip

          if header.empty?
            [content_mime_type]
          else
            Mime::Type.parse(header) &lt;&lt; Mime::HTML
          end
        end
      end

    end
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here is a monkey patch that you can drop into your rails
initializers if you are in a hurry to fix this because you have a
client with a mobile phone who really needs access. I'm fully aware
this is not a proper solution but it might help someone.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
module ActionDispatch
  module Http
    module MimeNegotiation

      # Patched to always accept at least HTML
      def accepts
        @env[&quot;action_dispatch.request.accepts&quot;] ||= begin
          header = @env['HTTP_ACCEPT'].to_s.strip

          if header.empty?
            [content_mime_type]
          else
            Mime::Type.parse(header) &amp;lt;&amp;lt; Mime::HTML
          end
        end
      end

    end
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T20:43:15+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-20T20:43:17+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">2</version>
      <user-name>Fjan</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T23:55:38+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-20T23:55:41+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">3</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This patch takes care of all the three cases you outlined. https://github.com/rails/rails/compare/c937ddb...21fd93c

HTTP_ACCEPT: text/*
HTTP_ACCEPT: */*, auth/sicily
HTTP_ACCEPT: */*, application/youtube-client

More work is needed. But that's a start. Please check if that patch fixes your problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch takes care of all the three cases you outlined.
&lt;a href=
&quot;https://github.com/rails/rails/compare/c937ddb...21fd93c&quot;&gt;https://github.com/rails/rails/compare/c937ddb...21fd93c&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HTTP_ACCEPT: text/&lt;em&gt;&lt;br&gt;
HTTP_ACCEPT:&lt;/em&gt; /&lt;em&gt;, auth/sicily&lt;br&gt;
HTTP_ACCEPT:&lt;/em&gt; /*, application/youtube-client&lt;/p&gt;
&lt;p&gt;More work is needed. But that's a start. Please check if that
patch fixes your problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-22T22:42:46+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-22T22:42:49+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">4</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thank you for that, that does indeed seem to cover all the cases.

I've never seen a browser ask for image/* or application/* though, so we could make it easier on ourselves and assume any client that asks for a page with an HTML view can accept an HTML view. Simplifies the code and might be a bit more robust in serving clients that have an accept header that is plain/wrong. (&quot;Do we want to be right or do we want to be pragmatic?&quot;). Since you've gone through the trouble of creating this patch already I say being right is fine :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thank you for that, that does indeed seem to cover all the
cases.&lt;/p&gt;
&lt;p&gt;I've never seen a browser ask for image/ &lt;em&gt;or
application/&lt;/em&gt; though, so we could make it easier on ourselves
and assume any client that asks for a page with an HTML view can
accept an HTML view. Simplifies the code and might be a bit more
robust in serving clients that have an accept header that is
plain/wrong. (&quot;Do we want to be right or do we want to be
pragmatic?&quot;). Since you've gone through the trouble of creating
this patch already I say being right is fine :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-23T10:34:56+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-23T10:35:07+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">5</version>
      <user-name>Fjan</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [d33dcba72d19beffc4a359f2fb89659f24122e9a]) Do not send id for quoting twice if the primary key is string.

[#6022 state:resolved]
https://github.com/rails/rails/commit/d33dcba72d19beffc4a359f2fb89659f24122e9a</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/d33dcba72d19beffc4a359f2fb89659f24122e9a&quot;
title=
&quot;Changeset [d33dcba72d19beffc4a359f2fb89659f24122e9a]&quot;&gt;[d33dcba72d19beffc4a359f2fb89659f24122e9a]&lt;/a&gt;)
Do not send id for quoting twice if the primary key is string.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/6022&quot; title=
&quot;Ticket #6022&quot;&gt;#6022&lt;/a&gt; state:resolved] &lt;a href=
&quot;https://github.com/rails/rails/commit/d33dcba72d19beffc4a359f2fb89659f24122e9a&quot;&gt;
https://github.com/rails/rails/commit/d33dcba72d19beffc4a359f2fb896...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-23T22:33:56+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-23T22:33:57+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">6</version>
      <user-name>Repository</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I guess I put in wrong ticket # in the previous fix. Opening this ticket.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I guess I put in wrong ticket # in the previous fix. Opening
this ticket.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-24T01:28:37+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-24T01:28:38+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">7</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I believe this can be closed, right Neeraj?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I believe this can be closed, right Neeraj?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-25T09:46:46+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-25T09:46:48+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">8</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-25T17:52:58+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-25T17:53:00+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">9</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Just listing the list of changes done as part of second set of changes. 

https://github.com/rails/rails/compare/c6030e8...fa2a5ae</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just listing the list of changes done as part of second set of
changes.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;https://github.com/rails/rails/compare/c6030e8...fa2a5ae&quot;&gt;https://github.com/rails/rails/compare/c6030e8...fa2a5ae&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-26T21:49:54+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-26T21:50:02+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">10</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Shoes are the most important equipment for basketball players. I don't want to risk any &lt;A  href=&quot;http://www.evogueplus.com/gucci-shoes-c-23_25.html&quot;&gt;gucci loafers for men&lt;/A&gt; kind of injury and sprain or break my ankle, so I have &lt;A  href=&quot;http://www.evogueplus.com/louis-vuitton-flip-flops-c-23_28.html&quot;&gt;louis vuitton flip flops&lt;/A&gt; to examine the catalogs of shoes
to know which ones offer the best ankle support &lt;A  href=&quot;http://www.evogueplus.com/gucci-slippers-c-24_44.html&quot;&gt;gucci slippers&lt;/A&gt; and best fit for my feet. What with the constant starting, stopping, &lt;A  href=&quot;http://www.evogueplus.com&quot;&gt;gucci shoes for cheap&lt;/A&gt; jumping, and lateral movements that basketball play &lt;A  href=&quot;http://www.evogueplus.com/louis-vuitton-shoes-c-23_27.html&quot;&gt;louis vuitton loafers for men&lt;/A&gt; requires, I have to prioritize support, foot stability, and shock absorption. Also, the shoes must have good traction.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Shoes are the most important equipment for basketball players. I
don't want to risk any &lt;a href=
&quot;http://www.evogueplus.com/gucci-shoes-c-23_25.html&quot;&gt;gucci loafers
for men&lt;/a&gt; kind of injury and sprain or break my ankle, so I have
&lt;a href=
&quot;http://www.evogueplus.com/louis-vuitton-flip-flops-c-23_28.html&quot;&gt;louis
vuitton flip flops&lt;/a&gt; to examine the catalogs of shoes&lt;br&gt;
to know which ones offer the best ankle support &lt;a href=
&quot;http://www.evogueplus.com/gucci-slippers-c-24_44.html&quot;&gt;gucci
slippers&lt;/a&gt; and best fit for my feet. What with the constant
starting, stopping, &lt;a href=&quot;http://www.evogueplus.com&quot;&gt;gucci shoes
for cheap&lt;/a&gt; jumping, and lateral movements that basketball play
&lt;a href=
&quot;http://www.evogueplus.com/louis-vuitton-shoes-c-23_27.html&quot;&gt;louis
vuitton loafers for men&lt;/a&gt; requires, I have to prioritize support,
foot stability, and shock absorption. Also, the shoes must have
good traction.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-29T01:26:19+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-11-29T05:58:16+00:00</updated-at>
      <user-id type="integer">126997</user-id>
      <version type="integer">11</version>
      <user-name>nacy</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [d67464a160bf2a5ef899a14cff93756aad374a6a]) Do not send id for quoting twice if the primary key is string.

[#6022 state:resolved]
https://github.com/rails/rails/commit/d67464a160bf2a5ef899a14cff93756aad374a6a</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/d67464a160bf2a5ef899a14cff93756aad374a6a&quot;
title=
&quot;Changeset [d67464a160bf2a5ef899a14cff93756aad374a6a]&quot;&gt;[d67464a160bf2a5ef899a14cff93756aad374a6a]&lt;/a&gt;)
Do not send id for quoting twice if the primary key is string.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/6022&quot; title=
&quot;Ticket #6022&quot;&gt;#6022&lt;/a&gt; state:resolved] &lt;a href=
&quot;https://github.com/rails/rails/commit/d67464a160bf2a5ef899a14cff93756aad374a6a&quot;&gt;
https://github.com/rails/rails/commit/d67464a160bf2a5ef899a14cff937...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-12-09T17:53:25+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2010-12-09T17:53:36+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">12</version>
      <user-name>Repository</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have another case for the same error that still fails with [this commit](https://github.com/rails/rails/blob/92f49b5f1ebf42514c58e1fda87c0b8a1b33d08f/actionpack/lib/action_dispatch/http/mime_negotiation.rb)

* `HTTP_ACCEPT: */*;q=0.01`

There's a semicolon in the string, the user agent was `Mozilla/4.0 (PSP (PlayStation Portable); 2.00)`.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have another case for the same error that still fails with
&lt;a href=
&quot;https://github.com/rails/rails/blob/92f49b5f1ebf42514c58e1fda87c0b8a1b33d08f/actionpack/lib/action_dispatch/http/mime_negotiation.rb&quot;&gt;
this commit&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: */*;q=0.01&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There's a semicolon in the string, the user agent was
&lt;code&gt;Mozilla/4.0 (PSP (PlayStation Portable); 2.00)&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-08T06:14:38+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-01-08T06:14:50+00:00</updated-at>
      <user-id type="integer">120128</user-id>
      <version type="integer">13</version>
      <user-name>Kenn Ejima</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This one should fall back to html (or plain text), too. It was sent from `Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)`.

* `HTTP_ACCEPT: text/*`</body>
      <body-html>&lt;div&gt;&lt;p&gt;This one should fall back to html (or plain text), too. It was
sent from &lt;code&gt;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;
SV1)&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTTP_ACCEPT: text/*&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-08T08:29:29+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-01-08T08:29:40+00:00</updated-at>
      <user-id type="integer">120128</user-id>
      <version type="integer">14</version>
      <user-name>Kenn Ejima</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>can you describe what error msg you are getting and what's the setup?</body>
      <body-html>&lt;div&gt;&lt;p&gt;can you describe what error msg you are getting and what's the
setup?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-09T00:07:14+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-01-09T00:07:31+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">15</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>On Rails 3.0.3 + Ruby 1.9.2, the same &quot;template missing&quot; error as Fjan described.

Now my patch has the following regex in `ActionDispatch::Http::MimeNegotiation`:

`BROWSER_LIKE_ACCEPTS = /,\s*\*\/\*|\*\/\*\s*,|\*\/\*;|text\/\*/`

however I'm not sure if it's a good idea to keep adding exceptions in this manner - probably we should just at least try to find html template rather than throwing an exception? I don't know if there's a good reason when &quot;template missing&quot; is useful on production.</body>
      <body-html>&lt;div&gt;&lt;p&gt;On Rails 3.0.3 + Ruby 1.9.2, the same &quot;template missing&quot; error
as Fjan described.&lt;/p&gt;
&lt;p&gt;Now my patch has the following regex in
&lt;code&gt;ActionDispatch::Http::MimeNegotiation&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;BROWSER_LIKE_ACCEPTS =
/,\s*\*\/\*|\*\/\*\s*,|\*\/\*;|text\/\*/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;however I'm not sure if it's a good idea to keep adding
exceptions in this manner - probably we should just at least try to
find html template rather than throwing an exception? I don't know
if there's a good reason when &quot;template missing&quot; is useful on
production.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-09T02:17:03+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-01-09T02:17:17+00:00</updated-at>
      <user-id type="integer">120128</user-id>
      <version type="integer">16</version>
      <user-name>Kenn Ejima</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Yes, I actually ended up using the monkey patch above that just return the HTML template if no other is available. There are just to many odd headers out there.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, I actually ended up using the monkey patch above that just
return the HTML template if no other is available. There are just
to many odd headers out there.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-09T09:13:56+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-01-09T09:14:11+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">17</version>
      <user-name>Fjan</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Keen Ejima,

The bug you mentioned with

    HTTP_ACCEPT: */*;q=0.01

Is covered by #5833 which includes a patch to fix.

J.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Keen Ejima,&lt;/p&gt;
&lt;p&gt;The bug you mentioned with&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;HTTP_ACCEPT: */*;q=0.01&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Is covered by &lt;a href=&quot;/projects/8994/tickets/5833&quot; title=
&quot;Ticket #5833&quot;&gt;#5833&lt;/a&gt; which includes a patch to fix.&lt;/p&gt;
&lt;p&gt;J.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-07T12:59:19+00:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-02-07T12:59:35+00:00</updated-at>
      <user-id type="integer">23779</user-id>
      <version type="integer">18</version>
      <user-name>Joel Chippindale</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think the monkey patch above isn't a bad idea actually &#8211; as a fallback.  Maybe an option like this could actually be considered for inclusion? Otherwise, aren't we forever having to patch rails for every obscure accepts header found in the wild?

Does returning status code 500 even make sense for these &quot;bad&quot; (in ruby's eyes) requests?

I'm pretty happy with the idea &quot;clients that know what they are doing can request alternative formats &#8211;&#160;everyone else gets html&quot;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think the monkey patch above isn't a bad idea actually &amp;#8211;
as a fallback. Maybe an option like this could actually be
considered for inclusion? Otherwise, aren't we forever having to
patch rails for every obscure accepts header found in the wild?&lt;/p&gt;
&lt;p&gt;Does returning status code 500 even make sense for these &quot;bad&quot;
(in ruby's eyes) requests?&lt;/p&gt;
&lt;p&gt;I'm pretty happy with the idea &quot;clients that know what they are
doing can request alternative formats &amp;#8211;&amp;nbsp;everyone else
gets html&quot;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-04-02T03:11:39+01:00</created-at>
      <creator-id type="integer">8551</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6022</number>
      <permalink>content-negotiation-fails-for-some-headers-regression</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Content negotiation fails for some */* headers (regression)</title>
      <updated-at type="datetime">2011-04-02T03:11:53+01:00</updated-at>
      <user-id type="integer">137607</user-id>
      <version type="integer">19</version>
      <user-name>William Denniss</user-name>
      <creator-name>Fjan</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6022</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
