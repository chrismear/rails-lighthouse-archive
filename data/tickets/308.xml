<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-06-03T00:08:10+01:00</created-at>
  <creator-id type="integer">8505</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">308</number>
  <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
  <priority type="integer">15149</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack patch</tag>
  <title>Fix assert_redirected_to for nested controllers</title>
  <updated-at type="datetime">2008-07-09T19:13:39+01:00</updated-at>
  <user-id type="integer">17505</user-id>
  <version type="integer">9</version>
  <user-name>Andrew Vit</user-name>
  <creator-name>Gabe da Silveira</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
  <priority-name nil="true"></priority-name>
  <original-body>Hey Koz,

This is a forward port of the &quot;fix you applied for me&quot;:http://dev.rubyonrails.org/ticket/10812 on on the 2.0-stable branch.  I applied it to current HEAD and tests are passing.  Have you made any more progress on your refactoring of assert_redirected_to?  Let me know and I'll help you QA it.</original-body>
  <latest-body>Hey Koz,

This is a forward port of the &quot;fix you applied for me&quot;:http://dev.rubyonrails.org/ticket/10812 on on the 2.0-stable branch.  I applied it to current HEAD and tests are passing.  Have you made any more progress on your refactoring of assert_redirected_to?  Let me know and I'll help you QA it.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
Hey Koz,
&lt;/p&gt;&lt;p&gt;
This is a forward port of the &lt;a href=&quot;http://dev.rubyonrails.org/ticket/10812&quot;&gt;fix you applied for me&lt;/a&gt; on on the 2.0-stable branch.  I applied it to current HEAD and tests are passing.  Have you made any more progress on your refactoring of assert_redirected_to?  Let me know and I'll help you QA it.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hey Koz,

This is a forward port of the &quot;fix you applied for me&quot;:http://dev.rubyonrails.org/ticket/10812 on on the 2.0-stable branch.  I applied it to current HEAD and tests are passing.  Have you made any more progress on your refactoring of assert_redirected_to?  Let me know and I'll help you QA it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hey Koz,
&lt;/p&gt;&lt;p&gt;
This is a forward port of the &lt;a href=&quot;http://dev.rubyonrails.org/ticket/10812&quot;&gt;fix you applied for me&lt;/a&gt; on on the 2.0-stable branch.  I applied it to current HEAD and tests are passing.  Have you made any more progress on your refactoring of assert_redirected_to?  Let me know and I'll help you QA it.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T00:08:10+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-06-03T00:08:10+01:00</updated-at>
      <user-id type="integer">8505</user-id>
      <version type="integer">1</version>
      <user-name>Gabe da Silveira</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [55e5219f9912860abdb28636749c0cb2d8b6a809]) Fix assert_redirected_to for nested controllers and named routes

[#308 state:resolved]

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
http://github.com/rails/rails/commit/55e5219f9912860abdb28636749c0cb2d8b6a809</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [55e5219f9912860abdb28636749c0cb2d8b6a809]) Fix assert_redirected_to for nested controllers and named routes
&lt;/p&gt;&lt;p&gt;
[#308 state:resolved]
&lt;/p&gt;&lt;p&gt;
Signed-off-by: Michael Koziarski 
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/55e5219f9912860abdb28636749c0cb2d8b6a809&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-04T00:10:37+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-06-04T00:10:37+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">2</version>
      <user-name>Repository</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [025515b234d8380f195e3de3818d076302605b12]) Fix assert_redirected_to for nested controllers and named routes

[#308 state:resolved]

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
http://github.com/rails/rails/commit/025515b234d8380f195e3de3818d076302605b12</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [025515b234d8380f195e3de3818d076302605b12]) Fix assert_redirected_to for nested controllers and named routes
&lt;/p&gt;&lt;p&gt;
[#308 state:resolved]
&lt;/p&gt;&lt;p&gt;
Signed-off-by: Michael Koziarski 
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/025515b234d8380f195e3de3818d076302605b12&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-04T00:10:38+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-06-04T00:10:38+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">3</version>
      <user-name>Repository</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This patch looks like it breaks existing documented functionality of assert_redirected_to. It's now too fussy about getting exact parameters in order to match a route. The method should just match the route segments that are provided, and ignore other params that are omitted.

It looks like this patch makes some basic tests impossible:

@@@ ruby
def test_create_should_redirect_to_edit
  post :create, valid_form_input
  assert_redirected_to :action =&gt; 'edit'
end

## Result:
# No route matches {:action=&gt;&quot;edit&quot;}
@@@

The route requires an id in order to match, but we can't guess the id of the new record...</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This patch looks like it breaks existing documented functionality of assert_redirected_to. It's now too fussy about getting exact parameters in order to match a route. The method should just match the route segments that are provided, and ignore other params that are omitted.
&lt;/p&gt;&lt;p&gt;
It looks like this patch makes some basic tests impossible:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;def test_create_should_redirect_to_edit
  post :create, valid_form_input
  assert_redirected_to :action =&amp;gt; 'edit'
end

## Result:
# No route matches {:action=&amp;gt;&amp;quot;edit&amp;quot;}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
The route requires an id in order to match, but we can't guess the id of the new record...
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T05:08:55+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T05:08:55+01:00</updated-at>
      <user-id type="integer">17505</user-id>
      <version type="integer">4</version>
      <user-name>Andrew Vit</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>It looks like this patch modified existing tests to specify the controller wherever it was omitted. For the record, I did try adding the controller in my own tests, but that doesn't fix the test failures where other params are needed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
It looks like this patch modified existing tests to specify the controller wherever it was omitted. For the record, I did try adding the controller in my own tests, but that doesn't fix the test failures where other params are needed.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T05:15:14+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T05:15:14+01:00</updated-at>
      <user-id type="integer">17505</user-id>
      <version type="integer">5</version>
      <user-name>Andrew Vit</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looking at this right now.  Hit me on #rails-contrib if you want to talk about this.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Looking at this right now.  Hit me on #rails-contrib if you want to talk about this.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T05:20:16+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T05:20:16+01:00</updated-at>
      <user-id type="integer">8505</user-id>
      <version type="integer">6</version>
      <user-name>Gabe da Silveira</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Gabe, it doesn't look like your patch attached here is the culprit, because the whole thing has since been rewritten... See ticket #c3aaba01

A comment on the rescue block in the previous code said:
@@@ ruby
rescue ActionController::RoutingError # routing failed us, so match the strings only.
@@@
But the new code that Koz wrote normalizes into strings straightaway, instead of diffing the requested route segments like before.

I'm out of my league with this. Not sure if this should be a new ticket or if it's still related to this fix... I've attached a test which shows the problem I described above.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Gabe, it doesn't look like your patch attached here is the culprit, because the whole thing has since been rewritten... See ticket #c3aaba01
&lt;/p&gt;&lt;p&gt;
A comment on the rescue block in the previous code said:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;rescue ActionController::RoutingError # routing failed us, so match the strings only.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
But the new code that Koz wrote normalizes into strings straightaway, instead of diffing the requested route segments like before.
&lt;/p&gt;&lt;p&gt;
I'm out of my league with this. Not sure if this should be a new ticket or if it's still related to this fix... I've attached a test which shows the problem I described above.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T06:52:54+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T06:52:54+01:00</updated-at>
      <user-id type="integer">17505</user-id>
      <version type="integer">7</version>
      <user-name>Andrew Vit</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hey there,

definitely open a new ticket with some examples that failed.

The test cases I changed in the previous ticket were passing not only due to the partial matching, but due to regular route expiry rules.  i.e. url_for :action=&gt;'index' implicitly defaults to this controller.

I'm not sure that the previous behaviour makes sense to me, but if enough people feel strongly about it we can check it out.

So yeah, another ticket with a failing example which doesn't involve components and we can take a look :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hey there,
&lt;/p&gt;&lt;p&gt;
definitely open a new ticket with some examples that failed.
&lt;/p&gt;&lt;p&gt;
The test cases I changed in the previous ticket were passing not only due to the partial matching, but due to regular route expiry rules.  i.e. url_for :action=&gt;'index' implicitly defaults to this controller.
&lt;/p&gt;&lt;p&gt;
I'm not sure that the previous behaviour makes sense to me, but if enough people feel strongly about it we can check it out.
&lt;/p&gt;&lt;p&gt;
So yeah, another ticket with a failing example which doesn't involve components and we can take a look :)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T08:32:27+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T08:32:27+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">8</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The follow-up ticket is #584. The test I attached to that ticket is the same as here, I stayed out of the nested modules (&quot;components?&quot;).

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;
The follow-up ticket is &lt;a href=&quot;/projects/8994/tickets/584&quot; title=&quot;Ticket #584&quot;&gt;#584&lt;/a&gt;. The test I attached to that ticket is the same as here, I stayed out of the nested modules (&quot;components?&quot;).
&lt;/p&gt;&lt;p&gt;
Thanks!
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-09T19:13:39+01:00</created-at>
      <creator-id type="integer">8505</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">308</number>
      <permalink>fix-assert_redirected_to-for-nested-controllers</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack patch</tag>
      <title>Fix assert_redirected_to for nested controllers</title>
      <updated-at type="datetime">2008-07-09T19:13:39+01:00</updated-at>
      <user-id type="integer">17505</user-id>
      <version type="integer">9</version>
      <user-name>Andrew Vit</user-name>
      <creator-name>Gabe da Silveira</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/308</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>9a9ac597605ca872b32dbff6fd882422db8f60ae</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-03T00:08:11+01:00</created-at>
      <filename>assert_redirected_to_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">25543</id>
      <size type="integer">4393</size>
      <uploader-id type="integer">8505</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/25543/assert_redirected_to_fix.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>9fc219ad0b52e924177c116f5f0d4e7df62f56b6</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-07-09T06:52:54+01:00</created-at>
      <filename>test_assert_redirected_to.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">31576</id>
      <size type="integer">964</size>
      <uploader-id type="integer">17505</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/31576/test_assert_redirected_to.diff</url>
    </attachment>
  </attachments>
</ticket>
