<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-08-26T23:00:22+01:00</created-at>
  <creator-id type="integer">28440</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">908</number>
  <permalink>layout-mime-type-should-match-the-response-s</permalink>
  <priority type="integer">360</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>actionpack</tag>
  <title>Layout MIME type should match the response's</title>
  <updated-at type="datetime">2008-12-03T15:47:26+00:00</updated-at>
  <user-id type="integer">28440</user-id>
  <version type="integer">9</version>
  <user-name>Roman Le N&#233;grate</user-name>
  <creator-name>Roman Le N&#233;grate</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Given `layout.html.erb` and `layout.js.erb`, `GET /index.js` should cause `layout.js.erb` to be picked as the layout.

This fails to happen if `index.js.erb` tries to render a partial of another type inside itself (for example: `_list.html.erb`), in which case `layout.html.erb` is mistakenly picked.

I attached a failing test covering this bug.

I may take time to fix that later.</original-body>
  <latest-body>Given `layout.html.erb` and `layout.js.erb`, `GET /index.js` should cause `layout.js.erb` to be picked as the layout.

This fails to happen if `index.js.erb` tries to render a partial of another type inside itself (for example: `_list.html.erb`), in which case `layout.html.erb` is mistakenly picked.

I attached a failing test covering this bug.

I may take time to fix that later.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Given &lt;code&gt;layout.html.erb&lt;/code&gt; and &lt;code&gt;layout.js.erb&lt;/code&gt;, &lt;code&gt;GET /index.js&lt;/code&gt; should cause &lt;code&gt;layout.js.erb&lt;/code&gt; to be picked as the layout.&lt;/p&gt;

&lt;p&gt;This fails to happen if &lt;code&gt;index.js.erb&lt;/code&gt; tries to render a partial of another type inside itself (for example: &lt;code&gt;_list.html.erb&lt;/code&gt;), in which case &lt;code&gt;layout.html.erb&lt;/code&gt; is mistakenly picked.&lt;/p&gt;

&lt;p&gt;I attached a failing test covering this bug.&lt;/p&gt;

&lt;p&gt;I may take time to fix that later.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Given `layout.html.erb` and `layout.js.erb`, `GET /index.js` should cause `layout.js.erb` to be picked as the layout.

This fails to happen if `index.js.erb` tries to render a partial of another type inside itself (for example: `_list.html.erb`), in which case `layout.html.erb` is mistakenly picked.

I attached a failing test covering this bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Given &lt;code&gt;layout.html.erb&lt;/code&gt; and &lt;code&gt;layout.js.erb&lt;/code&gt;, &lt;code&gt;GET /index.js&lt;/code&gt; should cause &lt;code&gt;layout.js.erb&lt;/code&gt; to be picked as the layout.&lt;/p&gt;

&lt;p&gt;This fails to happen if &lt;code&gt;index.js.erb&lt;/code&gt; tries to render a partial of another type inside itself (for example: &lt;code&gt;_list.html.erb&lt;/code&gt;), in which case &lt;code&gt;layout.html.erb&lt;/code&gt; is mistakenly picked.&lt;/p&gt;

&lt;p&gt;I attached a failing test covering this bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-26T23:01:06+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 actionpack bug controller edge patch tested tests</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-26T23:01:06+01:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">1</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Re-uploaded the failing test as there was a typo in the failing assertion.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Re-uploaded the failing test as there was a typo in the failing assertion.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-26T23:26:06+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 actionpack bug controller edge patch tested tests</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-26T23:26:06+01:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">2</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Uploaded a second patch: the same test that was failing, along with an attempt at solving the problem.

The `mime_responds_test.rb` test suite now passes when run alone.

Unfortunately, when running the full ActionPack test suite, another assertion fails inside the new test, for no apparent reason.

The only change I made is to remove the line `@template_format = :html` in `ActionView::Base#pick_template`. I don't understand what goes wrong when running the full suite; hopefully somebody can help me on this.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Uploaded a second patch: the same test that was failing, along with an attempt at solving the problem.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;mime_responds_test.rb&lt;/code&gt; test suite now passes when run alone.&lt;/p&gt;

&lt;p&gt;Unfortunately, when running the full ActionPack test suite, another assertion fails inside the new test, for no apparent reason.&lt;/p&gt;

&lt;p&gt;The only change I made is to remove the line &lt;code&gt;@template_format = :html&lt;/code&gt; in &lt;code&gt;ActionView::Base#pick_template&lt;/code&gt;. I don't understand what goes wrong when running the full suite; hopefully somebody can help me on this.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-27T02:11:35+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 actionpack bug controller edge patch tested tests</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-27T02:11:35+01:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">3</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Oops, fixed the filename of the last patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Oops, fixed the filename of the last patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-27T02:15:43+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 actionpack bug controller edge patch tested tests</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-27T02:15:43+01:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">4</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 if you can get it working.

NOTE: test_layout_mime_should_match_responses should be broken up into separate cases</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 if you can get it working.&lt;/p&gt;
&lt;p&gt;NOTE: test_layout_mime_should_match_responses should be broken
up into separate cases&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-29T17:01:50+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:tag: 2.1 actionpack bug controller edge patch tested tests
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s-2</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-29T17:01:50+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Joshua:

The 2nd patch fixes the bug as the (new) test passes. Plus, I use Rails with this patch applied in one of my projects and I noticed that that bug is now actually gone.

What is weird though, is that when the test suite is run in its entirety, an assertion within the same test (but different from the one which failed originally) then fails. Like some other test messed with the code and did not restore it to its original state afterward.

&quot;test_layout_mime_should_match_responses should be broken up into separate cases&quot;: agreed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Joshua:&lt;/p&gt;
&lt;p&gt;The 2nd patch fixes the bug as the (new) test passes. Plus, I
use Rails with this patch applied in one of my projects and I
noticed that that bug is now actually gone.&lt;/p&gt;
&lt;p&gt;What is weird though, is that when the test suite is run in its
entirety, an assertion within the same test (but different from the
one which failed originally) then fails. Like some other test
messed with the code and did not restore it to its original state
afterward.&lt;/p&gt;
&lt;p&gt;&quot;test_layout_mime_should_match_responses should be broken up
into separate cases&quot;: agreed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-30T22:38:13+01:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s-3</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-08-30T22:38:13+01:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">6</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>tests still fail, let me know if you make more progress</body>
      <body-html>&lt;div&gt;&lt;p&gt;tests still fail, let me know if you make more progress&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-03T15:33:40+00:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>actionpack</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-12-03T15:33:44+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">7</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-03T15:33:48+00:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>actionpack</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-12-03T15:33:50+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">8</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Actually, not long after creating this ticket, I rewrote ActionView::Base#pick_template so that it behaves more consistently. And it's been working like a charm since then.

Currently, the rewrite is packaged in a plug-in and I haven't taken the time to make a patch for Rails out of it. I just put it up on GitHub for you to take a look and perhaps have a stab at it:

http://github.com/Roman2K/action-view-pick-template-fix/tree/master</body>
      <body-html>&lt;div&gt;&lt;p&gt;Actually, not long after creating this ticket, I rewrote
ActionView::Base#pick_template so that it behaves more
consistently. And it's been working like a charm since then.&lt;/p&gt;
&lt;p&gt;Currently, the rewrite is packaged in a plug-in and I haven't
taken the time to make a patch for Rails out of it. I just put it
up on GitHub for you to take a look and perhaps have a stab at
it:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://github.com/Roman2K/action-view-pick-template-fix/tree/master&quot;&gt;
http://github.com/Roman2K/action...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-03T15:47:21+00:00</created-at>
      <creator-id type="integer">28440</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">908</number>
      <permalink>layout-mime-type-should-match-the-response-s</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>actionpack</tag>
      <title>Layout MIME type should match the response's</title>
      <updated-at type="datetime">2008-12-03T15:47:26+00:00</updated-at>
      <user-id type="integer">28440</user-id>
      <version type="integer">9</version>
      <user-name>Roman Le N&#233;grate</user-name>
      <creator-name>Roman Le N&#233;grate</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/908</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>c91fb91e3627053e32ece18f3db4ad90ac2c4b92</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-26T23:26:05+01:00</created-at>
      <filename>layout_mime_should_match_responses.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">41767</id>
      <size type="integer">5407</size>
      <uploader-id type="integer">28440</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/41767/layout_mime_should_match_responses.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>cfcfe7369ca84c5d0124147e9ad35b8e37ba945e</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-27T02:15:42+01:00</created-at>
      <filename>layout_mime_should_match_that_of_response-solution_attempt.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">41815</id>
      <size type="integer">7463</size>
      <uploader-id type="integer">28440</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/41815/layout_mime_should_match_that_of_response-solution_attempt.diff</url>
    </attachment>
  </attachments>
</ticket>
