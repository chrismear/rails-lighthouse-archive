<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-10-02T10:58:46+01:00</created-at>
  <creator-id type="integer">41907</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">2182</number>
  <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
  <priority type="integer">1385</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>active_support datetime iso8601 json patch</tag>
  <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
  <updated-at type="datetime">2011-02-02T16:43:32+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">14</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Marcello Nuccio</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
  <milestone-title>3.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&gt;1}.to_json)
throws
ActiveSupport::JSON::ParseError: Invalid JSON string

The problem is that &quot;1110-39-10&quot; looks like a date, but is not.
For example removing the trailing '0' in the key, works:
ActiveSupport::JSON.decode({&quot;1110-39-1&quot;=&gt;1}.to_json)</original-body>
  <latest-body>ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&gt;1}.to_json)
throws
ActiveSupport::JSON::ParseError: Invalid JSON string

The problem is that &quot;1110-39-10&quot; looks like a date, but is not.
For example removing the trailing '0' in the key, works:
ActiveSupport::JSON.decode({&quot;1110-39-1&quot;=&gt;1}.to_json)</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&amp;gt;1}.to_json) throws
ActiveSupport::JSON::ParseError: Invalid JSON string&lt;/p&gt;
&lt;p&gt;The problem is that &quot;1110-39-10&quot; looks like a date, but is not.
For example removing the trailing '0' in the key, works:
ActiveSupport::JSON.decode({&quot;1110-39-1&quot;=&amp;gt;1}.to_json)&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&gt;1}.to_json)
throws
ActiveSupport::JSON::ParseError: Invalid JSON string

The problem is that &quot;1110-39-10&quot; looks like a date, but is not.
For example removing the trailing '0' in the key, works:
ActiveSupport::JSON.decode({&quot;1110-39-1&quot;=&gt;1}.to_json)</body>
      <body-html>&lt;div&gt;&lt;p&gt;ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&amp;gt;1}.to_json) throws
ActiveSupport::JSON::ParseError: Invalid JSON string&lt;/p&gt;
&lt;p&gt;The problem is that &quot;1110-39-10&quot; looks like a date, but is not.
For example removing the trailing '0' in the key, works:
ActiveSupport::JSON.decode({&quot;1110-39-1&quot;=&amp;gt;1}.to_json)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-09T17:10:00+00:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2009-03-09T17:10:06+00:00</updated-at>
      <user-id type="integer">41907</user-id>
      <version type="integer">1</version>
      <user-name>Marcello Nuccio</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>fails in 2.3.X as well. Care to submit a patch ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;fails in 2.3.X as well. Care to submit a patch ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-10T20:46:04+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-10T20:46:05+01:00</updated-at>
      <user-id type="integer">39626</user-id>
      <version type="integer">2</version>
      <user-name>Rishav Rastogi</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This actually looks like (in Rails 2.3.5) it's not so much an error in the JSON parsing, as it is in YAML parsing:

    &gt;&gt; ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&gt;1}.to_json)
    StandardError: Invalid JSON string
    &gt;&gt; ActiveSupport::JSON::Backends::Yaml.send(:convert_json_to_yaml, &quot;{'1110-39-10': 'foo'}&quot;)
    =&gt; &quot;{ 1110-39-10 :  'foo'}&quot;
    &gt;&gt; YAML.load _
    ArgumentError: invalid date

So, it's actually the `YAML.load` call in `decode` for the YAML backend that is throwing the `ArgumentError`, which is being caught and re-raised as a `ParseError`.  However, using the packaged JSONGem, backend, again in Rails 2.3.5:

    &gt;&gt; require 'active_support/json/backends/jsongem'
    &gt;&gt; json = {'1110-39-10' =&gt; 1}.to_json
    =&gt; &quot;{\&quot;1110-39-10\&quot;:1}&quot;
    &gt;&gt; ActiveSupport::JSON::Backends::JSONGem.decode(json)
    =&gt; {&quot;1110-39-10&quot;=&gt;1}</body>
      <body-html>&lt;div&gt;&lt;p&gt;This actually looks like (in Rails 2.3.5) it's not so much an
error in the JSON parsing, as it is in YAML parsing:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt; ActiveSupport::JSON.decode({&quot;1110-39-10&quot;=&amp;gt;1}.to_json)
StandardError: Invalid JSON string
&amp;gt;&amp;gt; ActiveSupport::JSON::Backends::Yaml.send(:convert_json_to_yaml, &quot;{'1110-39-10': 'foo'}&quot;)
=&amp;gt; &quot;{ 1110-39-10 :  'foo'}&quot;
&amp;gt;&amp;gt; YAML.load _
ArgumentError: invalid date&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So, it's actually the &lt;code&gt;YAML.load&lt;/code&gt; call in
&lt;code&gt;decode&lt;/code&gt; for the YAML backend that is throwing the
&lt;code&gt;ArgumentError&lt;/code&gt;, which is being caught and re-raised as
a &lt;code&gt;ParseError&lt;/code&gt;. However, using the packaged JSONGem,
backend, again in Rails 2.3.5:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt; require 'active_support/json/backends/jsongem'
&amp;gt;&amp;gt; json = {'1110-39-10' =&amp;gt; 1}.to_json
=&amp;gt; &quot;{\&quot;1110-39-10\&quot;:1}&quot;
&amp;gt;&amp;gt; ActiveSupport::JSON::Backends::JSONGem.decode(json)
=&amp;gt; {&quot;1110-39-10&quot;=&amp;gt;1}&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-11T04:40:34+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-11T04:40:39+01:00</updated-at>
      <user-id type="integer">18798</user-id>
      <version type="integer">3</version>
      <user-name>Nathaniel Bibler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Attached is a patch which updates the `ActiveSupport::JSON::DATE_REGEX` to more accurately match date strings.  I only modified the date (month and day) portions of the regular expression and left the time matching alone.  It now only matches on months of 01-12 and days of 01-31 instead of any two-digit numeric combination.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a patch which updates the
&lt;code&gt;ActiveSupport::JSON::DATE_REGEX&lt;/code&gt; to more accurately
match date strings. I only modified the date (month and day)
portions of the regular expression and left the time matching
alone. It now only matches on months of 01-12 and days of 01-31
instead of any two-digit numeric combination.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-11T05:04:04+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: active_support
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support patch</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-11T05:04:15+01:00</updated-at>
      <user-id type="integer">18798</user-id>
      <version type="integer">4</version>
      <user-name>Nathaniel Bibler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>That patch, by the way, was made against the 2.3-stable branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That patch, by the way, was made against the 2.3-stable
branch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-11T05:12:38+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support patch</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-11T05:12:39+01:00</updated-at>
      <user-id type="integer">18798</user-id>
      <version type="integer">5</version>
      <user-name>Nathaniel Bibler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached is a patch against master (rails 3), where the tests do still fail for this, as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a patch against master (rails 3), where the tests do
still fail for this, as well.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-11T05:20:50+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support patch</tag>
      <title>ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-11T05:20:53+01:00</updated-at>
      <user-id type="integer">18798</user-id>
      <version type="integer">6</version>
      <user-name>Nathaniel Bibler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-11T17:47:06+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: active_support patch
:title: ActiveSupport::JSON.decode cannot parse output from to_json()
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-04-11T17:47:09+01:00</updated-at>
      <user-id type="integer">18798</user-id>
      <version type="integer">7</version>
      <user-name>Nathaniel Bibler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:41+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-05-04T18:48:41+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Actually, it's possible to switch off this behavior (at least in 2.3.8):

    ActiveSupport.parse_json_times = false</body>
      <body-html>&lt;div&gt;&lt;p&gt;Actually, it's possible to switch off this behavior (at least in
2.3.8):&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActiveSupport.parse_json_times = false&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T12:05:24+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-08-27T12:05:25+01:00</updated-at>
      <user-id type="integer">32561</user-id>
      <version type="integer">9</version>
      <user-name>AlekSi</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Well, this mattr is present, but doesn't works (weird).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Well, this mattr is present, but doesn't works (weird).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T12:39:10+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-08-27T12:39:12+01:00</updated-at>
      <user-id type="integer">32561</user-id>
      <version type="integer">10</version>
      <user-name>AlekSi</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hello, there is a further problem with this `ActiveSupport::JSON::DATE_REGEX` in that it purports to be ISO8601 compliant but does not parse the `&lt;date&gt;T&lt;time&gt;Z` joining character as per the specification: http://www.w3.org/TR/NOTE-datetime

Thus, it fails e.g.:
@@@
ActiveSupport::JSON.decode(ActiveSupport::JSON.encode(Time.now))
@@@
produces a `String` not a `DateTime`, even though `ActiveSupport.parse_json_times = true`


Nat, if you could change the midsection from `[ \t]+` to something like `(T|[ \t]+)` it might do the trick. I.e.
@@@
    DATE_REGEX = /^(?:\d{4}-(0[1-9]|1[012])-(0[1-9]|[12]\d|3[01])|\d{4}-\d{1,2}-\d{1,2}(T|[ \t]+)\d{1,2}:\d{2}:\d{2}(\.[0-9]*)?(([ \t]*)Z|[-+]\d{2}?(:\d{2})?))$/
@@@

Those of you in the know could advise whether this would hose anything else. We're using only Yagl serialization in production and not the YAML backend.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello, there is a further problem with this
&lt;code&gt;ActiveSupport::JSON::DATE_REGEX&lt;/code&gt; in that it purports to
be ISO8601 compliant but does not parse the
&lt;code&gt;&amp;lt;date&amp;gt;T&amp;lt;time&amp;gt;Z&lt;/code&gt; joining character as per
the specification: &lt;a href=
&quot;http://www.w3.org/TR/NOTE-datetime&quot;&gt;http://www.w3.org/TR/NOTE-datetime&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thus, it fails e.g.:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActiveSupport::JSON.decode(ActiveSupport::JSON.encode(Time.now))&lt;/code&gt;
&lt;/pre&gt;
produces a &lt;code&gt;String&lt;/code&gt; not a &lt;code&gt;DateTime&lt;/code&gt;, even
though &lt;code&gt;ActiveSupport.parse_json_times = true&lt;/code&gt;
&lt;p&gt;Nat, if you could change the midsection from &lt;code&gt;[ \t]+&lt;/code&gt;
to something like &lt;code&gt;(T|[ \t]+)&lt;/code&gt; it might do the trick.
I.e.&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    DATE_REGEX = /^(?:\d{4}-(0[1-9]|1[012])-(0[1-9]|[12]\d|3[01])|\d{4}-\d{1,2}-\d{1,2}(T|[ \t]+)\d{1,2}:\d{2}:\d{2}(.[0-9]&lt;em&gt;)?(([ \t]&lt;/em&gt;)Z|[-+]\d{2}?(:\d{2})?))$/&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Those of you in the know could advise whether this would hose
anything else. We're using only Yagl serialization in production
and not the YAML backend.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-30T23:30:06+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: active_support json patch
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support datetime iso8601 json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-09-30T23:30:07+01:00</updated-at>
      <user-id type="integer">92422</user-id>
      <version type="integer">11</version>
      <user-name>tribalvibes</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I need to check if this is still a problem in 3.x, but I can confirm this is a problem in 2.3.5. tribalvibes' fix above didn't quite seem to work (unless formatting affected the regex). The issue is that the current regex expects a space to be present before the &quot;Z&quot;. Here's a fix for that:

    ActiveSupport::JSON::DATE_REGEX = /^(?:\d{4}-(0[1-9]|1[012])-(0[1-9]|[12]\d|3[01])|\d{4}-\d{1,2}-\d{1,2}(T|[ \t]+)\d{1,2}:\d{2}:\d{2}(.[0-9])?(([ \t])?Z|[-+]\d{2}?(:\d{2})?))$/</body>
      <body-html>&lt;div&gt;&lt;p&gt;I need to check if this is still a problem in 3.x, but I can
confirm this is a problem in 2.3.5. tribalvibes' fix above didn't
quite seem to work (unless formatting affected the regex). The
issue is that the current regex expects a space to be present
before the &quot;Z&quot;. Here's a fix for that:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActiveSupport::JSON::DATE_REGEX = /^(?:\d{4}-(0[1-9]|1[012])-(0[1-9]|[12]\d|3[01])|\d{4}-\d{1,2}-\d{1,2}(T|[ \t]+)\d{1,2}:\d{2}:\d{2}(.[0-9])?(([ \t])?Z|[-+]\d{2}?(:\d{2})?))$/&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-14T18:05:45+01:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support datetime iso8601 json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2010-10-14T18:05:47+01:00</updated-at>
      <user-id type="integer">34034</user-id>
      <version type="integer">12</version>
      <user-name>Elliot Winkler</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:30:19+00:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_support datetime iso8601 json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2011-02-02T16:43:11+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">13</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:30:20+00:00</created-at>
      <creator-id type="integer">41907</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2182</number>
      <permalink>activesupportjsondecode-cannot-parse-output-from-to_json</permalink>
      <priority type="integer">1385</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>active_support datetime iso8601 json patch</tag>
      <title>[PATCH] ActiveSupport::JSON.decode cannot parse output from to_json()</title>
      <updated-at type="datetime">2011-02-02T16:43:32+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">14</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Marcello Nuccio</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2182</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>943bf1a59f8d74b50af16fa523fe1705a1f96c44</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-11T05:04:04+01:00</created-at>
      <filename>patch-2182.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">478338</id>
      <size type="integer">2141</size>
      <uploader-id type="integer">18798</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/478338/patch-2182.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>08dcf68068b0220741e655c21d84ce2c7b8a665a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-11T05:20:50+01:00</created-at>
      <filename>patch-2182-master.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">478345</id>
      <size type="integer">2189</size>
      <uploader-id type="integer">18798</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/478345/patch-2182-master.diff</url>
    </attachment>
  </attachments>
</ticket>
