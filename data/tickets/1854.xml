<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-03T03:51:00+00:00</created-at>
  <creator-id type="integer">15174</creator-id>
  <milestone-due-on type="datetime">2009-01-31T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1854</number>
  <permalink>fastcgi-dispatcher-dont-work</permalink>
  <priority type="integer">60</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>2.3 bug fastcgi patch rack tested</tag>
  <title>FastCGI dispatcher don't work</title>
  <updated-at type="datetime">2009-03-05T14:46:36+00:00</updated-at>
  <user-id type="integer">19875</user-id>
  <version type="integer">32</version>
  <user-name>Peter Wagenet</user-name>
  <creator-name>Alexander Semyonov</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
  <priority-name nil="true"></priority-name>
  <original-body>After update to rails 2.3 FastCGI server won't respond.

in fastcgi.crash.log:

Dispatcher failed to catch: undefined method `env' for #&lt;CGI:0xb78e0208&gt; (NoMethodError)
  /usr/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/lib/ruby/1.8/fcgi.rb:606:in `each_cgi'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  ./public/dispatch.fcgi:30
unhandled dispatch error</original-body>
  <latest-body>After update to rails 2.3 FastCGI server won't respond.

in fastcgi.crash.log:

Dispatcher failed to catch: undefined method `env' for #&lt;CGI:0xb78e0208&gt; (NoMethodError)
  /usr/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/lib/ruby/1.8/fcgi.rb:606:in `each_cgi'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  ./public/dispatch.fcgi:30
unhandled dispatch error</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;After update to rails 2.3 FastCGI server won't respond.&lt;/p&gt;
&lt;p&gt;in fastcgi.crash.log:&lt;/p&gt;
&lt;p&gt;Dispatcher failed to catch: undefined method &lt;code&gt;env' for #
(NoMethodError)
/usr/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in&lt;/code&gt;serve'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:101:in
&lt;code&gt;process_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:151:in&lt;/code&gt;with_signal_handler'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:99:in
&lt;code&gt;process_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:76:in&lt;/code&gt;process_each_request'
/usr/lib/ruby/1.8/fcgi.rb:606:in &lt;code&gt;each_cgi'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:75:in&lt;/code&gt;process_each_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in
&lt;code&gt;catch'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in&lt;/code&gt;process_each_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:49:in
&lt;code&gt;process!'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:23:in&lt;/code&gt;process!'
./public/dispatch.fcgi:30 unhandled dispatch error&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>After update to rails 2.3 FastCGI server won't respond.

in fastcgi.crash.log:

Dispatcher failed to catch: undefined method `env' for #&lt;CGI:0xb78e0208&gt; (NoMethodError)
  /usr/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/lib/ruby/1.8/fcgi.rb:606:in `each_cgi'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  ./public/dispatch.fcgi:30
unhandled dispatch error</body>
      <body-html>&lt;div&gt;&lt;p&gt;After update to rails 2.3 FastCGI server won't respond.&lt;/p&gt;
&lt;p&gt;in fastcgi.crash.log:&lt;/p&gt;
&lt;p&gt;Dispatcher failed to catch: undefined method &lt;code&gt;env' for
#&amp;lt;CGI:0xb78e0208&amp;gt; (NoMethodError)
/usr/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in&lt;/code&gt;serve'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:101:in
&lt;code&gt;process_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:151:in&lt;/code&gt;with_signal_handler'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:99:in
&lt;code&gt;process_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:76:in&lt;/code&gt;process_each_request'
/usr/lib/ruby/1.8/fcgi.rb:606:in &lt;code&gt;each_cgi'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:75:in&lt;/code&gt;process_each_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in
&lt;code&gt;catch'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:74:in&lt;/code&gt;process_each_request'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:49:in
&lt;code&gt;process!'
/home/rotuka/Sites/croconize/vendor/rails/railties/lib/fcgi_handler.rb:23:in&lt;/code&gt;process!'
./public/dispatch.fcgi:30 unhandled dispatch error&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T03:51:00+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-03T03:51:02+00:00</updated-at>
      <user-id type="integer">15174</user-id>
      <version type="integer">1</version>
      <user-name>Alexander Semyonov</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T22:58:21+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3 fastcgi rack
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-03T22:58:26+00:00</updated-at>
      <user-id type="integer">15174</user-id>
      <version type="integer">2</version>
      <user-name>Alexander Semyonov</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T23:04:57+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-03T23:05:03+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">3</version>
      <user-name>DHH</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I know you probably can't create a unit test for this, but can you please give me some steps to reproduce it. Like what server is in front, apache or lighttpd?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I know you probably can't create a unit test for this, but can
you please give me some steps to reproduce it. Like what server is
in front, apache or lighttpd?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-03T23:30:42+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-03T23:30:44+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">4</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I see similar behavior with IIS7 + FastCGI + Ruby One-Click installer 1.8.6-26

[03/Feb/2009:22:38:55 :: 1972] Ignoring unsupported signal USR1.
[03/Feb/2009:22:38:55 :: 1972] Dispatcher failed to catch: undefined method `env' for #&lt;FCGI::CGI:0x424378c&gt; (NoMethodError)
  C:/ruby/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:101:in `process_request'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:151:in `with_signal_handler'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:99:in `process_request'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:76:in `process_each_request'
  C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:612:in `each_cgi'
  C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:609:in `each'
  C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:609:in `each_cgi'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:75:in `process_each_request'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:74:in `catch'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:74:in `process_each_request'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:49:in `process!'
  C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:23:in `process!'
  c:/development/myapp/public/dispatch.fcgi:24
unhandled dispatch error</body>
      <body-html>&lt;div&gt;&lt;p&gt;I see similar behavior with IIS7 + FastCGI + Ruby One-Click
installer 1.8.6-26&lt;/p&gt;
&lt;p&gt;[03/Feb/2009:22:38:55 :: 1972] Ignoring unsupported signal USR1.
[03/Feb/2009:22:38:55 :: 1972] Dispatcher failed to catch:
undefined method &lt;code&gt;env' for #&amp;lt;FCGI::CGI:0x424378c&amp;gt;
(NoMethodError)
C:/ruby/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in&lt;/code&gt;serve'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:101:in
&lt;code&gt;process_request'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:151:in&lt;/code&gt;with_signal_handler'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:99:in
&lt;code&gt;process_request'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:76:in&lt;/code&gt;process_each_request'
C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:612:in &lt;code&gt;each_cgi'
C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:609:in&lt;/code&gt;each'
C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:609:in &lt;code&gt;each_cgi'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:75:in&lt;/code&gt;process_each_request'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:74:in
&lt;code&gt;catch'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:74:in&lt;/code&gt;process_each_request'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:49:in
&lt;code&gt;process!'
C:/ruby/lib/ruby/gems/1.8/gems/rails-2.3.0/lib/fcgi_handler.rb:23:in&lt;/code&gt;process!'
c:/development/myapp/public/dispatch.fcgi:24 unhandled dispatch
error&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T03:51:38+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-04T03:51:41+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">5</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>FWIW, I had IIS7 + FastCGI + Rails 2.2.2 working. All I did was update the app to Rails 2.3.0.</body>
      <body-html>&lt;div&gt;&lt;p&gt;FWIW, I had IIS7 + FastCGI + Rails 2.2.2 working. All I did was
update the app to Rails 2.3.0.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T04:06:59+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-04T04:07:02+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">6</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think you might be expecting a different class of object for the request variable. I think you're expecting an FCGI::CGI::Request or CGI::Request, but the error log shows that you're getting an FCGI::CGI or CGI object instead.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think you might be expecting a different class of object for
the request variable. I think you're expecting an
FCGI::CGI::Request or CGI::Request, but the error log shows that
you're getting an FCGI::CGI or CGI object instead.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T04:58:03+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-04T04:58:07+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">7</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Apache2 + mod_fastcgi + rails2.3. Application doesn't work.

dispatcher.fcgi shows me &quot;502 Bad Gateway&quot; and put nothing in logs

When I run dispatcher manually ($ ./public/dispatch.fcgi) there are the same errors (like in first post)

dispatcher.cgi shows &quot;Application Error&quot; that written in .htaccess and in logs there are:

/usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/cgi_process.rb:22:in `__send__': You have a nil object when you didn't expect it! (NoMethodError)
The error occurred while evaluating nil.env_table
	from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/cgi_process.rb:22:in `dispatch_cgi'
	from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/dispatcher.rb:79:in `dispatch_cgi'
	from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/dispatcher.rb:29:in `dispatch'
	from ./public/dispatch.cgi:10</body>
      <body-html>&lt;div&gt;&lt;p&gt;Apache2 + mod_fastcgi + rails2.3. Application doesn't work.&lt;/p&gt;
&lt;p&gt;dispatcher.fcgi shows me &quot;502 Bad Gateway&quot; and put nothing in
logs&lt;/p&gt;
&lt;p&gt;When I run dispatcher manually ($ ./public/dispatch.fcgi) there
are the same errors (like in first post)&lt;/p&gt;
&lt;p&gt;dispatcher.cgi shows &quot;Application Error&quot; that written in
.htaccess and in logs there are:&lt;/p&gt;
&lt;p&gt;
/usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/cgi_process.rb:22:in
&lt;code&gt;__send__': You have a nil object when you didn't expect it!
(NoMethodError) The error occurred while evaluating
nil.env_table&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/cgi_process.rb:22:in `dispatch_cgi'
from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/dispatcher.rb:79:in `dispatch_cgi'
from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.0/lib/action_controller/dispatcher.rb:29:in `dispatch'
from ./public/dispatch.cgi:10
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-04T10:10:39+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-04T10:10:42+00:00</updated-at>
      <user-id type="integer">15174</user-id>
      <version type="integer">8</version>
      <user-name>Alexander Semyonov</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Looking at the spec for the Rack FastCGI handler, 3 things immediately jump out at me:

- Line 8 : @host = '0.0.0.0'
  This is not a valid address on Windows. Should change to 127.0.0.1
- Line 14 : the use of fork
  fork is not implemented on Windows. The win32-process gem is needed to get this working (conditional require?)
- Line 16 : lighttpd
  There is an unstated dependency on Lighttpd

I'll try to get these in place and run the spec again. I think that is why all the examples in the spec fail right now:

C:\ruby\lib\ruby\gems\1.8\gems\rack-0.9.1\test&gt;spec spec_rack_fastcgi.rb
FFFFFFFFF

1)
NotImplementedError in 'Rack::Handler::FastCGI startup'
fork() function is unimplemented on this machine
./spec_rack_fastcgi.rb:14:in `fork'
./spec_rack_fastcgi.rb:14:

2)
Test::Unit::AssertionFailedError in 'Rack::Handler::FastCGI should respond'
Exception raised:
Class: &lt;Errno::EADDRNOTAVAIL&gt;
Message: &lt;&quot;The requested address is not valid in its context. - connect(2)&quot;&gt;
---Backtrace---
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in `initialize'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in `open'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in `connect'
C:/Ruby/lib/ruby/1.8/timeout.rb:48:in `timeout'
C:/Ruby/lib/ruby/1.8/timeout.rb:76:in `timeout'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in `connect'
C:/Ruby/lib/ruby/1.8/net/http.rb:557:in `do_start'
C:/Ruby/lib/ruby/1.8/net/http.rb:546:in `start'
C:/Ruby/lib/ruby/1.8/net/http.rb:440:in `start'
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:23
---------------
./spec_rack_fastcgi.rb:22:

3)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should be a lighttpd'
The requested address is not valid in its context. - connect(2)
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:28:

4)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have rack headers'
The requested address is not valid in its context. - connect(2)
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:38:

5)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have CGI headers on GET'
The requested address is not valid in its context. - connect(2)
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:46:

6)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have CGI headers on POST'

The requested address is not valid in its context. - connect(2)
./testrequest.rb:31:in `POST'
./spec_rack_fastcgi.rb:63:

7)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should support HTTP auth'
The requested address is not valid in its context. - connect(2)
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:74:

8)
Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should set status'
The requested address is not valid in its context. - connect(2)
./testrequest.rb:17:in `GET'
./spec_rack_fastcgi.rb:79:

9)
TypeError in 'Rack::Handler::FastCGI shutdown'
wrong argument type nil (expected Fixnum)
./spec_rack_fastcgi.rb:86:in `kill'
./spec_rack_fastcgi.rb:86:

Finished in 1.23 seconds

9 examples, 9 failures</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looking at the spec for the Rack FastCGI handler, 3 things
immediately jump out at me:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Line 8 : @host = '0.0.0.0' This is not a valid address on
Windows. Should change to 127.0.0.1&lt;/li&gt;
&lt;li&gt;Line 14 : the use of fork fork is not implemented on Windows.
The win32-process gem is needed to get this working (conditional
require?)&lt;/li&gt;
&lt;li&gt;Line 16 : lighttpd There is an unstated dependency on
Lighttpd&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I'll try to get these in place and run the spec again. I think
that is why all the examples in the spec fail right now:&lt;/p&gt;
&lt;p&gt;C:\ruby\lib\ruby\gems\1.8\gems\rack-0.9.1\test&amp;gt;spec
spec_rack_fastcgi.rb FFFFFFFFF&lt;/p&gt;
&lt;p&gt;1) NotImplementedError in 'Rack::Handler::FastCGI startup'
fork() function is unimplemented on this machine
./spec_rack_fastcgi.rb:14:in &lt;code&gt;fork'
./spec_rack_fastcgi.rb:14:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;2) Test::Unit::AssertionFailedError in 'Rack::Handler::FastCGI
should respond' Exception raised: Class:
&amp;lt;Errno::EADDRNOTAVAIL&amp;gt; Message: &amp;lt;&quot;The requested address is
not valid in its context. - connect(2)&quot;&amp;gt; ---Backtrace---
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in &lt;code&gt;initialize'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in&lt;/code&gt;open'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in &lt;code&gt;connect'
C:/Ruby/lib/ruby/1.8/timeout.rb:48:in&lt;/code&gt;timeout'
C:/Ruby/lib/ruby/1.8/timeout.rb:76:in &lt;code&gt;timeout'
C:/Ruby/lib/ruby/1.8/net/http.rb:564:in&lt;/code&gt;connect'
C:/Ruby/lib/ruby/1.8/net/http.rb:557:in &lt;code&gt;do_start'
C:/Ruby/lib/ruby/1.8/net/http.rb:546:in&lt;/code&gt;start'
C:/Ruby/lib/ruby/1.8/net/http.rb:440:in &lt;code&gt;start'
./testrequest.rb:17:in&lt;/code&gt;GET'&lt;/p&gt;
&lt;h2&gt;./spec_rack_fastcgi.rb:23&lt;/h2&gt;
&lt;p&gt;./spec_rack_fastcgi.rb:22:&lt;/p&gt;
&lt;p&gt;3) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should be a
lighttpd' The requested address is not valid in its context. -
connect(2) ./testrequest.rb:17:in &lt;code&gt;GET'
./spec_rack_fastcgi.rb:28:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;4) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have
rack headers' The requested address is not valid in its context. -
connect(2) ./testrequest.rb:17:in &lt;code&gt;GET'
./spec_rack_fastcgi.rb:38:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;5) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have
CGI headers on GET' The requested address is not valid in its
context. - connect(2) ./testrequest.rb:17:in &lt;code&gt;GET'
./spec_rack_fastcgi.rb:46:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;6) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should have
CGI headers on POST'&lt;/p&gt;
&lt;p&gt;The requested address is not valid in its context. - connect(2)
./testrequest.rb:31:in &lt;code&gt;POST'
./spec_rack_fastcgi.rb:63:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;7) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should
support HTTP auth' The requested address is not valid in its
context. - connect(2) ./testrequest.rb:17:in &lt;code&gt;GET'
./spec_rack_fastcgi.rb:74:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;8) Errno::EADDRNOTAVAIL in 'Rack::Handler::FastCGI should set
status' The requested address is not valid in its context. -
connect(2) ./testrequest.rb:17:in &lt;code&gt;GET'
./spec_rack_fastcgi.rb:79:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;9) TypeError in 'Rack::Handler::FastCGI shutdown' wrong argument
type nil (expected Fixnum) ./spec_rack_fastcgi.rb:86:in &lt;code&gt;kill'
./spec_rack_fastcgi.rb:86:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Finished in 1.23 seconds&lt;/p&gt;
&lt;p&gt;9 examples, 9 failures&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-05T03:25:12+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T03:25:13+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">9</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm getting the same error. Running on hostingrails.com with Apache.

@@@ ruby
05/Feb/2009:13:10:16 :: 15387] Dispatcher failed to catch: request: #&lt;FCGI::CGI:0xb6ecab60 @args=nil, @params={}, @cookies={&quot;_trunk_session&quot;=&gt;[&quot;BAh7ByIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsGOhFub3RpY2VfZXJyb3IiaFNvcnJ5ISBUaGlzIGFjY291bnQgaW4gbm90IHJlZ2lzdGVyZWQgd2l0aCB1cy4gUGxlYXNlIGVuc3VyZSB0aGF0IHlvdSBoYXZlIGVudGVyZWQgdGhlIGNvcnJlY3QgdXJsLgY6CkB1c2VkewY7BkY6DGNzcmZfaWQiJWY4MzI5NDU2NDNiMmMwYjAyMzdiNTk0YmUzNzI4NGMz--014da862ca2ba93f9d3be2e3121afad5d8b2bc91&quot;]}, @output_hidden=nil, @request=#&lt;FCGI:0xb6ecb510&gt;, @output_cookies=nil, @multipart=false&gt; (RuntimeError)
  /home/mygalax/webapps/dev/vendor/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:612:in `each_cgi'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each_cgi'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  dispatch.fcgi:25
unhandled dispatch error
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm getting the same error. Running on hostingrails.com with
Apache.&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
05/Feb/2009:13:10:16 :: 15387] Dispatcher failed to catch: request: #&amp;lt;FCGI::CGI:0xb6ecab60 @args=nil, @params={}, @cookies={&amp;quot;_trunk_session&amp;quot;=&amp;gt;[&amp;quot;BAh7ByIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsGOhFub3RpY2VfZXJyb3IiaFNvcnJ5ISBUaGlzIGFjY291bnQgaW4gbm90IHJlZ2lzdGVyZWQgd2l0aCB1cy4gUGxlYXNlIGVuc3VyZSB0aGF0IHlvdSBoYXZlIGVudGVyZWQgdGhlIGNvcnJlY3QgdXJsLgY6CkB1c2VkewY7BkY6DGNzcmZfaWQiJWY4MzI5NDU2NDNiMmMwYjAyMzdiNTk0YmUzNzI4NGMz--014da862ca2ba93f9d3be2e3121afad5d8b2bc91&amp;quot;]}, @output_hidden=nil, @request=#&amp;lt;FCGI:0xb6ecb510&amp;gt;, @output_cookies=nil, @multipart=false&amp;gt; (RuntimeError)
  /home/mygalax/webapps/dev/vendor/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:612:in `each_cgi'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each_cgi'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  dispatch.fcgi:25
unhandled dispatch error
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-05T19:13:47+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T19:13:51+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">10</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Whoops, didn't realize that the error was actually different that time. I've also gotten:

@@@ ruby
[05/Feb/2009:13:08:49 :: 14855] Dispatcher failed to catch: undefined method `env' for #&lt;FCGI::CGI:0xb6f5ff1c&gt; (NoMethodError)
  /home/mygalax/webapps/dev/vendor/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:612:in `each_cgi'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each_cgi'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  dispatch.fcgi:25
unhandled dispatch error
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Whoops, didn't realize that the error was actually different
that time. I've also gotten:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
[05/Feb/2009:13:08:49 :: 14855] Dispatcher failed to catch: undefined method `env' for #&amp;lt;FCGI::CGI:0xb6f5ff1c&amp;gt; (NoMethodError)
  /home/mygalax/webapps/dev/vendor/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:151:in `with_signal_handler'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:99:in `process_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:612:in `each_cgi'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each'
  /usr/local/lib/ruby/gems/1.8/gems/fcgi-0.8.7/lib/fcgi.rb:609:in `each_cgi'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `catch'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:74:in `process_each_request'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:49:in `process!'
  /home/mygalax/webapps/dev/vendor/rails/railties/lib/fcgi_handler.rb:23:in `process!'
  dispatch.fcgi:25
unhandled dispatch error
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-05T19:15:06+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T19:15:08+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">11</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Crap. You can ignore the &quot;Dispatcher failed to catch: request&quot; error. That was my fault. The &quot;env&quot; one still stands though. Sorry about that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Crap. You can ignore the &quot;Dispatcher failed to catch: request&quot;
error. That was my fault. The &quot;env&quot; one still stands though. Sorry
about that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-05T19:17:04+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T19:17:08+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">12</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have a fix for this that at least allows the site to run. I'm not sure if it's really correct but it does at least work, so it's a start. Patch is attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have a fix for this that at least allows the site to run. I'm
not sure if it's really correct but it does at least work, so it's
a start. Patch is attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-05T20:31:18+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3 bug fastcgi rack
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T20:31:23+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">13</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [dcc2407d9976740cebe6736ec6adeae269b81203]) Fixed FCGI handling [#1854 state:resolved]

Signed-off-by: Joshua Peek &lt;josh@joshpeek.com&gt;
http://github.com/rails/rails/commit/dcc2407d9976740cebe6736ec6adeae269b81203</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [dcc2407d9976740cebe6736ec6adeae269b81203]) Fixed FCGI
handling [&lt;a href=&quot;/projects/8994/tickets/1854&quot; title=&quot;Ticket #1854&quot;&gt;#1854&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Joshua Peek &lt;a href=&quot;mailto:josh@joshpeek.com&quot;&gt;josh@joshpeek.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/dcc2407d9976740cebe6736ec6adeae269b81203&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-05T22:22:09+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T22:22:10+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Awesome work Peter!

Alexander and Will does this fix your issue?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Awesome work Peter!&lt;/p&gt;
&lt;p&gt;Alexander and Will does this fix your issue?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-05T22:23:00+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-05T22:23:01+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">15</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sorry, I had to revert it. It broke some tests.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry, I had to revert it. It broke some tests.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T01:40:58+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T01:40:59+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">16</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [f75b98d67ed9ef85d20858a1d24ee6767d64ece6]) Revert &quot;Fixed FCGI handling [#1854 state:resolved]&quot;

This reverts commit dcc2407d9976740cebe6736ec6adeae269b81203.
http://github.com/rails/rails/commit/f75b98d67ed9ef85d20858a1d24ee6767d64ece6</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [f75b98d67ed9ef85d20858a1d24ee6767d64ece6]) Revert &quot;Fixed
FCGI handling [&lt;a href=&quot;/projects/8994/tickets/1854&quot; title=&quot;Ticket #1854&quot;&gt;#1854&lt;/a&gt; state:resolved]&quot;&lt;/p&gt;
&lt;p&gt;This reverts commit dcc2407d9976740cebe6736ec6adeae269b81203.
&lt;a href=&quot;http://github.com/rails/rails/commit/f75b98d67ed9ef85d20858a1d24ee6767d64ece6&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T01:40:59+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T01:40:59+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">17</version>
      <user-name>Repository</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>No problem. I wasn't convinced it was exactly the right fix, just the start of one. I'll look into the tests and see if I can figure anything out. In the meantime if anyone else wants to build on what I've done they're more than welcome to.</body>
      <body-html>&lt;div&gt;&lt;p&gt;No problem. I wasn't convinced it was exactly the right fix,
just the start of one. I'll look into the tests and see if I can
figure anything out. In the meantime if anyone else wants to build
on what I've done they're more than welcome to.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T01:45:32+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T01:45:38+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">18</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Patch was no good on windows/IIS7:

Dispatcher failed to catch: Bad file descriptor (Errno::EBADF)
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in `write'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in `id'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in `process_request'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:153:in `with_signal_handler'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:100:in `process_request'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:77:in `process_each_request'
  C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:606:in `each_cgi'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:76:in `process_each_request'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:75:in `catch'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:75:in `process_each_request'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:50:in `process!'
  c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:24:in `process!'
  c:/development/myapp/public/dispatch.fcgi:24
unhandled dispatch error</body>
      <body-html>&lt;div&gt;&lt;p&gt;Patch was no good on windows/IIS7:&lt;/p&gt;
&lt;p&gt;Dispatcher failed to catch: Bad file descriptor (Errno::EBADF)
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in
&lt;code&gt;write'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in&lt;/code&gt;id'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:102:in
&lt;code&gt;process_request'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:153:in&lt;/code&gt;with_signal_handler'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:100:in
&lt;code&gt;process_request'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:77:in&lt;/code&gt;process_each_request'
C:/ruby/lib/ruby/site_ruby/1.8/fcgi.rb:606:in &lt;code&gt;each_cgi'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:76:in&lt;/code&gt;process_each_request'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:75:in
&lt;code&gt;catch'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:75:in&lt;/code&gt;process_each_request'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:50:in
&lt;code&gt;process!'
c:/development/myapp/vendor/rails/railties/lib/fcgi_handler.rb:24:in&lt;/code&gt;process!'
c:/development/myapp/public/dispatch.fcgi:24 unhandled dispatch
error&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T02:31:13+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T02:31:18+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">19</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@Will, I'm not sure what's going on there. I don't have IIS7 to test on myself.

Anyway, I've attached an updated patch with working tests. This patch solves the problem in some cases at least.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Will, I'm not sure what's going on there. I don't have IIS7 to
test on myself.&lt;/p&gt;
&lt;p&gt;Anyway, I've attached an updated patch with working tests. This
patch solves the problem in some cases at least.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-06T04:01:24+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3 bug fastcgi patch rack
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T04:01:26+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">20</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Is this something that should be patched upstream on Rack's FCGI server?

I'm going to look into this more this weekend. Ideally we could push some of the signal handling up to Rack so you'd just use it instead.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Is this something that should be patched upstream on Rack's FCGI
server?&lt;/p&gt;
&lt;p&gt;I'm going to look into this more this weekend. Ideally we could
push some of the signal handling up to Rack so you'd just use it
instead.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T04:41:47+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T04:41:51+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">21</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Yeah, one problem I see is that the tests just mock out the requests. So we're just assuming that we get a certain kind of object FCGI::Request, but we're actually getting FCGI::CGI. Nothing is actually testing to make sure we're getting the right object. Secondly, the C based FCGI doesn't appear to include the FCGI::Request class. I had to force it to load the pure Ruby version of FCGI for that bit to work. I haven't yet hunted down where the FCGI::CGI request is coming from so I'm not sure if it's a problem with what Rack is providing or what Rails is expecting.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yeah, one problem I see is that the tests just mock out the
requests. So we're just assuming that we get a certain kind of
object FCGI::Request, but we're actually getting FCGI::CGI. Nothing
is actually testing to make sure we're getting the right object.
Secondly, the C based FCGI doesn't appear to include the
FCGI::Request class. I had to force it to load the pure Ruby
version of FCGI for that bit to work. I haven't yet hunted down
where the FCGI::CGI request is coming from so I'm not sure if it's
a problem with what Rack is providing or what Rails is
expecting.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T04:55:19+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T04:55:22+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">22</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>As far as I could have a look at it problem was that provider.each_cgi sends a different object then Rack is expecting. The solution for me was to change it to provider.each, but I know this breaks some other things down the code, so someone with some clue about the whole thing should have a look.</body>
      <body-html>&lt;div&gt;&lt;p&gt;As far as I could have a look at it problem was that
provider.each_cgi sends a different object then Rack is expecting.
The solution for me was to change it to provider.each, but I know
this breaks some other things down the code, so someone with some
clue about the whole thing should have a look.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T08:20:05+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T08:20:08+00:00</updated-at>
      <user-id type="integer">17428</user-id>
      <version type="integer">23</version>
      <user-name>Jan De Poorter</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Jan, that fits with what I'm seeing. If you open up the fcgi gem (0.8.7) you see that in lib/fcgi.rb FCGI::each_cgi explicitly returns a CGI object. Then the fcgi_handler.rb goes on to call methods that aren't defined on the CGI object. The only possible explanations I can think of are that someone just goofed and thought it was a Request object (which my patch changes it to), or the CGI class is defined differently somewhere else (possibly Ruby 1.9?).

So before we can do a proper fix there are a few questions we need answered:
1) What kind of object should we be expecting. Should it be a CGI object as the variable naming implies? Or should it be a Request object.
2a) If a CGI object, should we be converting it to a Request or instead calling methods that actually exist on the CGI object (i.e. stdinput, stdoutput, env_table)?
2b) If a Request object, how should it be generated? Is FCGI::each the appropriate way? 

Once we can answer these questions I think we can then get a full fix out the door.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Jan, that fits with what I'm seeing. If you open up the fcgi
gem (0.8.7) you see that in lib/fcgi.rb FCGI::each_cgi explicitly
returns a CGI object. Then the fcgi_handler.rb goes on to call
methods that aren't defined on the CGI object. The only possible
explanations I can think of are that someone just goofed and
thought it was a Request object (which my patch changes it to), or
the CGI class is defined differently somewhere else (possibly Ruby
1.9?).&lt;/p&gt;
&lt;p&gt;So before we can do a proper fix there are a few questions we
need answered: 1) What kind of object should we be expecting.
Should it be a CGI object as the variable naming implies? Or should
it be a Request object. 2a) If a CGI object, should we be
converting it to a Request or instead calling methods that actually
exist on the CGI object (i.e. stdinput, stdoutput, env_table)? 2b)
If a Request object, how should it be generated? Is FCGI::each the
appropriate way?&lt;/p&gt;
&lt;p&gt;Once we can answer these questions I think we can then get a
full fix out the door.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-06T15:45:35+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-06T15:45:40+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">24</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [2316e7dfb16518d4d0d92165bcd53b262080fc37]) Fix FCGI handler with lighttpd [#1854 state:resolved]
http://github.com/rails/rails/commit/2316e7dfb16518d4d0d92165bcd53b262080fc37</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [2316e7dfb16518d4d0d92165bcd53b262080fc37]) Fix FCGI
handler with lighttpd [&lt;a href=&quot;/projects/8994/tickets/1854&quot; title=&quot;Ticket #1854&quot;&gt;#1854&lt;/a&gt; state:resolved] &lt;a href=&quot;http://github.com/rails/rails/commit/2316e7dfb16518d4d0d92165bcd53b262080fc37&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T06:26:17+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T06:26:19+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">25</version>
      <user-name>Repository</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've verified it against lighttpd on OS X. Can you guys please test on windows.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've verified it against lighttpd on OS X. Can you guys please
test on windows.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T06:31:21+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T06:31:22+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">26</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Confirmed working on IIS7 + FastCGI.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Confirmed working on IIS7 + FastCGI.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T13:55:42+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T13:55:47+00:00</updated-at>
      <user-id type="integer">10264</user-id>
      <version type="integer">27</version>
      <user-name>Will Green</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Confirmed on Apache/2.2.8 (Unix)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Confirmed on Apache/2.2.8 (Unix)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T16:15:07+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T16:15:11+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">28</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Sweet!

I'm going try to get those fancy signal handlers pushed up to Rack core now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sweet!&lt;/p&gt;
&lt;p&gt;I'm going try to get those fancy signal handlers pushed up to
Rack core now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T17:01:14+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T17:01:16+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">29</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Sounds good. Let me know if you need any help with testing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sounds good. Let me know if you need any help with testing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-07T17:10:38+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-02-07T17:10:43+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">30</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Peter,.. You said you were on HostingRails.com and that you got this working?

I am butting up against this problem too.

starting
[05/Mar/2009:04:50:43 :: 4414] Dispatcher failed to catch: undefined method `env' for #&lt;FCGI::CGI:0xb75be458&gt; (NoMethodError)
  /usr/local/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in `serve'
  /home/gfmerde/rhlebm3/vendor/rails/railties/lib/fcgi_handler.rb:101:in `process_request'
blah
blah
blah

Am I able to apply your patch locally to something/somewhere in my app, or do I have to convince someone at hostingrails.com to do this? Or do I have to renounce 2.3 ? :-( sniff.

My out-of-bandwidth email is shawn@shawnkoppenhoefer.com by the way.
Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Peter,.. You said you were on HostingRails.com and that you got
this working?&lt;/p&gt;
&lt;p&gt;I am butting up against this problem too.&lt;/p&gt;
&lt;p&gt;starting [05/Mar/2009:04:50:43 :: 4414] Dispatcher failed to
catch: undefined method &lt;code&gt;env' for
#&amp;lt;FCGI::CGI:0xb75be458&amp;gt; (NoMethodError)
/usr/local/lib/ruby/gems/1.8/gems/rack-0.9.1/lib/rack/handler/fastcgi.rb:32:in&lt;/code&gt;serve'
/home/gfmerde/rhlebm3/vendor/rails/railties/lib/fcgi_handler.rb:101:in
&lt;code&gt;process_request' blah blah blah&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Am I able to apply your patch locally to something/somewhere in
my app, or do I have to convince someone at hostingrails.com to do
this? Or do I have to renounce 2.3 ? :-( sniff.&lt;/p&gt;
&lt;p&gt;My out-of-bandwidth email is &lt;a href=&quot;mailto:shawn@shawnkoppenhoefer.com&quot;&gt;shawn@shawnkoppenhoefer.com&lt;/a&gt;
by the way. Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-05T11:25:54+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-03-05T11:25:56+00:00</updated-at>
      <user-id type="integer">26641</user-id>
      <version type="integer">31</version>
      <user-name>Shawn</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Shawn,

You'll want to freeze Rails into vendor to avoid being stuck with HostingRails' version. If you freeze edge, you should be set. If you want to freeze 2.3 RC1 then try applying Joshua's patch here: http://github.com/rails/rails/commit/2316e7dfb16518d4d0d92165bcd53b262080fc37</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Shawn,&lt;/p&gt;
&lt;p&gt;You'll want to freeze Rails into vendor to avoid being stuck
with HostingRails' version. If you freeze edge, you should be set.
If you want to freeze 2.3 RC1 then try applying Joshua's patch
here: &lt;a href=&quot;http://github.com/rails/rails/commit/2316e7dfb16518d4d0d92165bcd53b262080fc37&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-05T14:46:33+00:00</created-at>
      <creator-id type="integer">15174</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1854</number>
      <permalink>fastcgi-dispatcher-dont-work</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3 bug fastcgi patch rack tested</tag>
      <title>FastCGI dispatcher don't work</title>
      <updated-at type="datetime">2009-03-05T14:46:36+00:00</updated-at>
      <user-id type="integer">19875</user-id>
      <version type="integer">32</version>
      <user-name>Peter Wagenet</user-name>
      <creator-name>Alexander Semyonov</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1854</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>38f7d5907ae461a2b666b1a0d10e1ba1cce7b5df</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-05T20:31:18+00:00</created-at>
      <filename>fix-fcgi.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">85649</id>
      <size type="integer">872</size>
      <uploader-id type="integer">19875</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/85649/fix-fcgi.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>6a8c82f38b461abd8f4c1146260d69817b9bb856</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-06T04:01:24+00:00</created-at>
      <filename>fix-fcgi-with-tests.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">85801</id>
      <size type="integer">3366</size>
      <uploader-id type="integer">19875</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/85801/fix-fcgi-with-tests.diff</url>
    </attachment>
  </attachments>
</ticket>
