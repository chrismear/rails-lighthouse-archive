<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-08-07T14:29:46+01:00</created-at>
  <creator-id type="integer">28395</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">773</number>
  <permalink>unfunctional-actionview-testcase</permalink>
  <priority type="integer">234</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>helper routing tests</tag>
  <title>Unfunctional ActionView::TestCase</title>
  <updated-at type="datetime">2008-11-10T18:49:18+00:00</updated-at>
  <user-id type="integer">424</user-id>
  <version type="integer">4</version>
  <user-name>Joshua Peek</user-name>
  <creator-name>papricek</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/773</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When testing helpers with ActionView::TestCase, everything's ok, until I use a route with hash parameters. Then I get these errors:

NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
    (eval):17:in `admin_advertisements_advertisement_clicked_url'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `send!'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `method_missing'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:36:in `link_to_advertisement'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:44:in `render_skyscraper'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:20:in `render_advertisements'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `each'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `render_advertisements'
    test/functional/admin/advertisements_helper_test.rb:13:in `test_render_advertisement_one'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `run'

1 tests, 0 assertions, 0 failures, 1 errors</original-body>
  <latest-body>When testing helpers with ActionView::TestCase, everything's ok, until I use a route with hash parameters. Then I get these errors:

NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
    (eval):17:in `admin_advertisements_advertisement_clicked_url'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `send!'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `method_missing'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:36:in `link_to_advertisement'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:44:in `render_skyscraper'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:20:in `render_advertisements'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `each'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `render_advertisements'
    test/functional/admin/advertisements_helper_test.rb:13:in `test_render_advertisement_one'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `run'

1 tests, 0 assertions, 0 failures, 1 errors</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When testing helpers with ActionView::TestCase, everything's ok, until I use a route with hash parameters. Then I get these errors:&lt;/p&gt;

&lt;p&gt;NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
(eval):17:in `admin_advertisements_advertisement_clicked_url'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `send!'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `method_missing'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:36:in `link_to_advertisement'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:44:in `render_skyscraper'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:20:in `render_advertisements'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `each'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `render_advertisements'
test/functional/admin/advertisements_helper_test.rb:13:in `test_render_advertisement_one'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `run'
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;1 tests, 0 assertions, 0 failures, 1 errors&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When testing helpers with ActionView::TestCase, everything's ok, until I use a route with hash parameters. Then I get these errors:

NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
    (eval):17:in `admin_advertisements_advertisement_clicked_url'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `send!'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `method_missing'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:36:in `link_to_advertisement'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:44:in `render_skyscraper'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:20:in `render_advertisements'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `each'
    D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `render_advertisements'
    test/functional/admin/advertisements_helper_test.rb:13:in `test_render_advertisement_one'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
    C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `run'

1 tests, 0 assertions, 0 failures, 1 errors</body>
      <body-html>&lt;div&gt;&lt;p&gt;When testing helpers with ActionView::TestCase, everything's ok, until I use a route with hash parameters. Then I get these errors:&lt;/p&gt;

&lt;p&gt;NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
(eval):17:in `admin_advertisements_advertisement_clicked_url'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `send!'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/actionpack-2.1.0/lib/action_view/test_case.rb:54:in `method_missing'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:36:in `link_to_advertisement'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:44:in `render_skyscraper'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:20:in `render_advertisements'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `each'
D:/www/svatba123/app/helpers/admin/advertisements_helper.rb:14:in `render_advertisements'
test/functional/admin/advertisements_helper_test.rb:13:in `test_render_advertisement_one'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
C:/Program Files/ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.0/lib/active_support/testing/setup_and_teardown.rb:67:in `run'
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;1 tests, 0 assertions, 0 failures, 1 errors&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-07T14:29:47+01:00</created-at>
      <creator-id type="integer">28395</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">773</number>
      <permalink>unfunctional-actionview-testcase</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>helper routing tests</tag>
      <title>Unfunctional ActionView::TestCase</title>
      <updated-at type="datetime">2008-08-07T14:29:47+01:00</updated-at>
      <user-id type="integer">28395</user-id>
      <version type="integer">1</version>
      <user-name>papricek</user-name>
      <creator-name>papricek</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/773</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>require File.dirname(__FILE__) + '/../../test_helper'
require 'admin/advertisements_helper'

class Admin::AdvertisementsHelperTest &lt; ActionView::TestCase
  
  include Admin::AdvertisementsHelper
  fixtures  :advertisements, :advertisers, :advertisement_assignments, :advertisement_positions
   
  
  def test_render_advertisement_one
    position = advertisement_positions(:one)
    a = advertisements(:one)
    html = render_advertisements(position.slug, 1)
    assert_match /#{a.id}/, html, &quot;HTML reklamy obsahuje id reklamy&quot;
    assert_match /skyscraper/, html, &quot;Div reklamy obsahuje spravny class&quot;
  end
end</body>
      <body-html>&lt;div&gt;&lt;p&gt;require File.dirname(&lt;strong&gt;FILE&lt;/strong&gt;) + '/../../test&lt;em&gt;helper'
require 'admin/advertisements&lt;/em&gt;helper'&lt;/p&gt;

&lt;p&gt;class Admin::AdvertisementsHelperTest &amp;lt; ActionView::TestCase&lt;/p&gt;

&lt;p&gt;  include Admin::AdvertisementsHelper
  fixtures  :advertisements, :advertisers, :advertisement&lt;em&gt;assignments, :advertisement&lt;/em&gt;positions&lt;/p&gt;

&lt;p&gt;  def test&lt;em&gt;render&lt;/em&gt;advertisement_one&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;position = advertisement_positions(:one)
a = advertisements(:one)
html = render_advertisements(position.slug, 1)
assert_match /#{a.id}/, html, &quot;HTML reklamy obsahuje id reklamy&quot;
assert_match /skyscraper/, html, &quot;Div reklamy obsahuje spravny class&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;  end
end&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-08T09:04:46+01:00</created-at>
      <creator-id type="integer">28395</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">773</number>
      <permalink>unfunctional-actionview-testcase</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>helper routing tests</tag>
      <title>Unfunctional ActionView::TestCase</title>
      <updated-at type="datetime">2008-08-08T09:04:46+01:00</updated-at>
      <user-id type="integer">28395</user-id>
      <version type="integer">2</version>
      <user-name>papricek</user-name>
      <creator-name>papricek</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/773</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>require File.dirname(__FILE__) + '/../../test_helper'
require 'admin/advertisements_helper'

class Admin::AdvertisementsHelperTest &lt; ActionView::TestCase
  
  include Admin::AdvertisementsHelper
  fixtures  :advertisements, :advertisers, :advertisement_assignments, :advertisement_positions
   
  
  def test_render_advertisement_one
    position = advertisement_positions(:one)
    a = advertisements(:one)
    html = render_advertisements(position.slug, 1)
    assert_match /#{a.id}/, html, &quot;HTML reklamy obsahuje id reklamy&quot;
    assert_match /skyscraper/, html, &quot;Div reklamy obsahuje spravny class&quot;
  end
end

module Admin::AdvertisementsHelper
  
  def render_advertisements(type, count)
    ads = Advertisement.find_for_position(type, count)
    html = &quot;&quot;
    ads.each do |ad|
      if ad.script.empty?
        html &lt;&lt; case ad.ad_type
        when &quot;Fullbanner&quot;
          render_fullbanner(ad)
        when &quot;Skyscraper&quot;
          render_skyscraper(ad)
        when &quot;Text&quot;
          render_text_ad(ad)
        when &quot;Flash&quot;
          render_flash(ad)
        when &quot;Halfbanner&quot;
          render_halfbanner(ad)
        end
      else 
        html &lt;&lt; ad.script
      end
    end
    return html
  end
etc...
end</body>
      <body-html>&lt;div&gt;&lt;p&gt;require File.dirname(&lt;strong&gt;FILE&lt;/strong&gt;) + '/../../test&lt;em&gt;helper'
require 'admin/advertisements&lt;/em&gt;helper'&lt;/p&gt;

&lt;p&gt;class Admin::AdvertisementsHelperTest &amp;lt; ActionView::TestCase&lt;/p&gt;

&lt;p&gt;  include Admin::AdvertisementsHelper
  fixtures  :advertisements, :advertisers, :advertisement&lt;em&gt;assignments, :advertisement&lt;/em&gt;positions&lt;/p&gt;

&lt;p&gt;  def test&lt;em&gt;render&lt;/em&gt;advertisement_one&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;position = advertisement_positions(:one)
a = advertisements(:one)
html = render_advertisements(position.slug, 1)
assert_match /#{a.id}/, html, &quot;HTML reklamy obsahuje id reklamy&quot;
assert_match /skyscraper/, html, &quot;Div reklamy obsahuje spravny class&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;  end
end&lt;/p&gt;

&lt;p&gt;module Admin::AdvertisementsHelper&lt;/p&gt;

&lt;p&gt;  def render_advertisements(type, count)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ads = Advertisement.find_for_position(type, count)
html = &quot;&quot;
ads.each do |ad|
  if ad.script.empty?
    html &amp;lt;&amp;lt; case ad.ad_type
    when &quot;Fullbanner&quot;
      render_fullbanner(ad)
    when &quot;Skyscraper&quot;
      render_skyscraper(ad)
    when &quot;Text&quot;
      render_text_ad(ad)
    when &quot;Flash&quot;
      render_flash(ad)
    when &quot;Halfbanner&quot;
      render_halfbanner(ad)
    end
  else
    html &amp;lt;&amp;lt; ad.script
  end
end
return html
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;  end
etc...
end&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-08T09:05:42+01:00</created-at>
      <creator-id type="integer">28395</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">773</number>
      <permalink>unfunctional-actionview-testcase</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>helper routing tests</tag>
      <title>Unfunctional ActionView::TestCase</title>
      <updated-at type="datetime">2008-08-08T09:05:42+01:00</updated-at>
      <user-id type="integer">28395</user-id>
      <version type="integer">3</version>
      <user-name>papricek</user-name>
      <creator-name>papricek</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/773</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-10T18:49:15+00:00</created-at>
      <creator-id type="integer">28395</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">773</number>
      <permalink>unfunctional-actionview-testcase</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>helper routing tests</tag>
      <title>Unfunctional ActionView::TestCase</title>
      <updated-at type="datetime">2008-11-10T18:49:18+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">4</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>papricek</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/773</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
