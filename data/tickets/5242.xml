<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">15316</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-16T21:23:17+01:00</created-at>
  <creator-id type="integer">34341</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">5242</number>
  <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
  <updated-at type="datetime">2010-11-08T01:48:21+00:00</updated-at>
  <user-id type="integer">14998</user-id>
  <version type="integer">47</version>
  <user-name>Ryan Bigg</user-name>
  <creator-name>Alex Le</creator-name>
  <assigned-user-name>Aaron Patterson</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>High</priority-name>
  <original-body>I deployed a Rails 3 RC app last night to my Linode server, running CentOS, Nginx and Passenger, RVM with 1.8.7.  Then this morning I connected to it again to and got error with &quot;MySQL has gone away&quot;:

I'm not sure if this is a Rails 3 RC issue or not, but when the app was running on Rails 3b4, I never run into this issue.  Here's the stacktrace.  



[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in `log_without_newrelic_instrumentation'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in `log'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in `log'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in `execute'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:616:in `select'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:76:in `cache_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:427:in `find_by_sql_without_trace_ActiveRecord_self_name_find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:319:in `find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:314:in `find_by_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation.rb:64:in `to_a'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:324:in `find_first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:117:in `first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `find_by_attributes'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `method_missing'

app/controllers/app/users_controller.rb:52:in `check_for_valid_coupon'

app/controllers/app/users_controller.rb:23:in `create'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:136:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rendering.rb:11:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:18:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:434:in `_run__514234185__process_action__1623385099__callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `_run_process_action_callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `run_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:17:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:30:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications/instrumenter.rb:21:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:29:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rescue.rb:17:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:28:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:251:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:246:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:27:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:105:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/rendering.rb:40:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:133:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:173:in `action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:27:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:148:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:89:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:73:in `optimized_each'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:88:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:139:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:489:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:35:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `catch'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/head.rb:14:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/methodoverride.rb:24:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/params_parser.rb:21:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/flash.rb:177:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/cookies.rb:268:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:32:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:12:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:31:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:46:in `call'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:410:in `_run_call_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:44:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/sendfile.rb:107:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/show_exceptions.rb:48:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/rack/logger.rb:13:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/runtime.rb:17:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `synchronize'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:168:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `send'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `method_missing'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_request_handler.rb:207:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:120:in `run'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:65:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/utils.rb:252:in `safe_fork'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:58:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:41:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:159:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:287:in `handle_spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `__send__'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:196:in `start_synchronously'

[GEM_ROOT]/gems/passenger-2.2.13/bin/passenger-spawn-server:61</original-body>
  <latest-body>I deployed a Rails 3 RC app last night to my Linode server, running CentOS, Nginx and Passenger, RVM with 1.8.7.  Then this morning I connected to it again to and got error with &quot;MySQL has gone away&quot;:

I'm not sure if this is a Rails 3 RC issue or not, but when the app was running on Rails 3b4, I never run into this issue.  Here's the stacktrace.  



[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in `log_without_newrelic_instrumentation'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in `log'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in `log'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in `execute'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:616:in `select'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:76:in `cache_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:427:in `find_by_sql_without_trace_ActiveRecord_self_name_find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:319:in `find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:314:in `find_by_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation.rb:64:in `to_a'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:324:in `find_first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:117:in `first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `find_by_attributes'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `method_missing'

app/controllers/app/users_controller.rb:52:in `check_for_valid_coupon'

app/controllers/app/users_controller.rb:23:in `create'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:136:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rendering.rb:11:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:18:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:434:in `_run__514234185__process_action__1623385099__callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `_run_process_action_callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `run_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:17:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:30:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications/instrumenter.rb:21:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:29:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rescue.rb:17:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:28:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:251:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:246:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:27:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:105:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/rendering.rb:40:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:133:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:173:in `action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:27:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:148:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:89:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:73:in `optimized_each'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:88:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:139:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:489:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:35:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `catch'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/head.rb:14:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/methodoverride.rb:24:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/params_parser.rb:21:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/flash.rb:177:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/cookies.rb:268:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:32:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:12:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:31:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:46:in `call'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:410:in `_run_call_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:44:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/sendfile.rb:107:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/show_exceptions.rb:48:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/rack/logger.rb:13:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/runtime.rb:17:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `synchronize'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:168:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `send'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `method_missing'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_request_handler.rb:207:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:120:in `run'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:65:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/utils.rb:252:in `safe_fork'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:58:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:41:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:159:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:287:in `handle_spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `__send__'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:196:in `start_synchronously'

[GEM_ROOT]/gems/passenger-2.2.13/bin/passenger-spawn-server:61</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I deployed a Rails 3 RC app last night to my Linode server,
running CentOS, Nginx and Passenger, RVM with 1.8.7. Then this
morning I connected to it again to and got error with &quot;MySQL has
gone away&quot;:&lt;/p&gt;
&lt;p&gt;I'm not sure if this is a Rails 3 RC issue or not, but when the
app was running on Rails 3b4, I never run into this issue. Here's
the stacktrace.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in
&lt;code&gt;log_without_newrelic_instrumentation'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in
&lt;code&gt;log'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in
&lt;code&gt;log'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in
&lt;code&gt;execute'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:616:in
&lt;code&gt;select'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:76:in
&lt;code&gt;cache_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:427:in
&lt;code&gt;find_by_sql_without_trace_ActiveRecord_self_name_find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:319:in
&lt;code&gt;find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:314:in
&lt;code&gt;find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation.rb:64:in
&lt;code&gt;to_a'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:324:in
&lt;code&gt;find_first'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:117:in
&lt;code&gt;first'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in
&lt;code&gt;find_by_attributes'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in
&lt;code&gt;method_missing'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/app/users_controller.rb:52:in
&lt;code&gt;check_for_valid_coupon'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/app/users_controller.rb:23:in
&lt;code&gt;create'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in
&lt;code&gt;send_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in
&lt;code&gt;send_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:136:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rendering.rb:11:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:18:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:434:in
&lt;code&gt;_run__514234185__process_action__1623385099__callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in
&lt;code&gt;_run_process_action_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in
&lt;code&gt;run_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:17:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:30:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications/instrumenter.rb:21:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:29:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rescue.rb:17:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:28:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:251:in
&lt;code&gt;perform_action_with_newrelic_trace'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:246:in
&lt;code&gt;perform_action_with_newrelic_trace'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:27:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:105:in
&lt;code&gt;process'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/rendering.rb:40:in
&lt;code&gt;process'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:133:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rack_delegation.rb:14:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:173:in
&lt;code&gt;action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:27:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:148:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:89:in
&lt;code&gt;recognize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:73:in
&lt;code&gt;optimized_each'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:88:in
&lt;code&gt;recognize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:139:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:489:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:35:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in
&lt;code&gt;catch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/head.rb:14:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/methodoverride.rb:24:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/params_parser.rb:21:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/flash.rb:177:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/session/abstract_store.rb:149:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/cookies.rb:268:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:32:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in
&lt;code&gt;cache'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:12:in
&lt;code&gt;cache'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:31:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:46:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:410:in
&lt;code&gt;_run_call_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:44:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/sendfile.rb:107:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/remote_ip.rb:48:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/show_exceptions.rb:48:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/rack/logger.rb:13:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/runtime.rb:17:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;synchronize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:168:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in
&lt;code&gt;method_missing'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/request_handler.rb:92:in
&lt;code&gt;process_request'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_request_handler.rb:207:in
&lt;code&gt;main_loop'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:120:in
&lt;code&gt;run'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:65:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/utils.rb:252:in
&lt;code&gt;safe_fork'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:58:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:41:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:159:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:287:in
&lt;code&gt;handle_spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in
&lt;code&gt;__send__'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in
&lt;code&gt;main_loop'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:196:in
&lt;code&gt;start_synchronously'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/bin/passenger-spawn-server:61&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I deployed a Rails 3 RC app last night to my Linode server, running CentOS, Nginx and Passenger, RVM with 1.8.7.  Then this morning I connected to it again to and got error with &quot;MySQL has gone away&quot;:

I'm not sure if this is a Rails 3 RC issue or not, but when the app was running on Rails 3b4, I never run into this issue.  Here's the stacktrace.  



[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in `log_without_newrelic_instrumentation'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in `log'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in `log'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in `execute'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:616:in `select'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:76:in `cache_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in `select_all'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:427:in `find_by_sql_without_trace_ActiveRecord_self_name_find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:319:in `find_by_sql'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:314:in `find_by_sql'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation.rb:64:in `to_a'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:324:in `find_first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:117:in `first'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in `find_by_attributes'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `send'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in `method_missing'

app/controllers/app/users_controller.rb:52:in `check_for_valid_coupon'

app/controllers/app/users_controller.rb:23:in `create'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in `send_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:136:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rendering.rb:11:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:18:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:434:in `_run__514234185__process_action__1623385099__callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in `_run_process_action_callbacks'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `send'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in `run_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:17:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:30:in `process_action'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications/instrumenter.rb:21:in `instrument'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in `instrument'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:29:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rescue.rb:17:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:28:in `process_action'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:251:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in `trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:246:in `perform_action_with_newrelic_trace'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:27:in `process_action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:105:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/rendering.rb:40:in `process'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:133:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:173:in `action'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in `dispatch'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:27:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:148:in `call'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:89:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:73:in `optimized_each'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:88:in `recognize'

[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:139:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:489:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:35:in `call'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `catch'

[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/head.rb:14:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/methodoverride.rb:24:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/params_parser.rb:21:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/flash.rb:177:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/cookies.rb:268:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:32:in `call'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:12:in `cache'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:31:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:46:in `call'

[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:410:in `_run_call_callbacks'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:44:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/sendfile.rb:107:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'

[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/show_exceptions.rb:48:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/rack/logger.rb:13:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/runtime.rb:17:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `synchronize'

[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:168:in `call'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `send'

[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in `method_missing'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_request_handler.rb:207:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:120:in `run'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:65:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/utils.rb:252:in `safe_fork'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:58:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:41:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:159:in `spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:287:in `handle_spawn_application'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `__send__'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in `main_loop'

[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:196:in `start_synchronously'

[GEM_ROOT]/gems/passenger-2.2.13/bin/passenger-spawn-server:61</body>
      <body-html>&lt;div&gt;&lt;p&gt;I deployed a Rails 3 RC app last night to my Linode server,
running CentOS, Nginx and Passenger, RVM with 1.8.7. Then this
morning I connected to it again to and got error with &quot;MySQL has
gone away&quot;:&lt;/p&gt;
&lt;p&gt;I'm not sure if this is a Rails 3 RC issue or not, but when the
app was running on Rails 3b4, I never run into this issue. Here's
the stacktrace.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in
&lt;code&gt;log_without_newrelic_instrumentation'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in
&lt;code&gt;log'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in
&lt;code&gt;log'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in
&lt;code&gt;execute'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:616:in
&lt;code&gt;select'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:76:in
&lt;code&gt;cache_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:54:in
&lt;code&gt;select_all'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:427:in
&lt;code&gt;find_by_sql_without_trace_ActiveRecord_self_name_find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:319:in
&lt;code&gt;find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:314:in
&lt;code&gt;find_by_sql'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation.rb:64:in
&lt;code&gt;to_a'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:324:in
&lt;code&gt;find_first'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:117:in
&lt;code&gt;first'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/relation/finder_methods.rb:227:in
&lt;code&gt;find_by_attributes'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/base.rb:942:in
&lt;code&gt;method_missing'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/app/users_controller.rb:52:in
&lt;code&gt;check_for_valid_coupon'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;app/controllers/app/users_controller.rb:23:in
&lt;code&gt;create'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in
&lt;code&gt;send_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/implicit_render.rb:4:in
&lt;code&gt;send_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:136:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rendering.rb:11:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:18:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:434:in
&lt;code&gt;_run__514234185__process_action__1623385099__callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:404:in
&lt;code&gt;_run_process_action_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:93:in
&lt;code&gt;run_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/callbacks.rb:17:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:30:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications/instrumenter.rb:21:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/notifications.rb:52:in
&lt;code&gt;instrument'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/instrumentation.rb:29:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rescue.rb:17:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:28:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:251:in
&lt;code&gt;perform_action_with_newrelic_trace'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in
&lt;code&gt;trace_execution_scoped'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:246:in
&lt;code&gt;perform_action_with_newrelic_trace'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:27:in
&lt;code&gt;process_action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/base.rb:105:in
&lt;code&gt;process'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/abstract_controller/rendering.rb:40:in
&lt;code&gt;process'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:133:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal/rack_delegation.rb:14:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_controller/metal.rb:173:in
&lt;code&gt;action'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:62:in
&lt;code&gt;dispatch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:27:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:148:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:89:in
&lt;code&gt;recognize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:73:in
&lt;code&gt;optimized_each'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/code_generation.rb:88:in
&lt;code&gt;recognize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/rack-mount-0.6.9/lib/rack/mount/route_set.rb:139:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/routing/route_set.rb:489:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:35:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in
&lt;code&gt;catch'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/warden-0.10.7/lib/warden/manager.rb:34:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/head.rb:14:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/methodoverride.rb:24:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/params_parser.rb:21:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/flash.rb:177:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/session/abstract_store.rb:149:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/cookies.rb:268:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:32:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in
&lt;code&gt;cache'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:12:in
&lt;code&gt;cache'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/query_cache.rb:31:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:46:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/activesupport-3.0.0.rc/lib/active_support/callbacks.rb:410:in
&lt;code&gt;_run_call_callbacks'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/callbacks.rb:44:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/sendfile.rb:107:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/remote_ip.rb:48:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/actionpack-3.0.0.rc/lib/action_dispatch/middleware/show_exceptions.rb:48:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/rack/logger.rb:13:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/runtime.rb:17:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;synchronize'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/rack-1.2.1/lib/rack/lock.rb:11:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:168:in
&lt;code&gt;call'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in
&lt;code&gt;send'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[GEM_ROOT]/gems/railties-3.0.0.rc/lib/rails/application.rb:77:in
&lt;code&gt;method_missing'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/request_handler.rb:92:in
&lt;code&gt;process_request'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_request_handler.rb:207:in
&lt;code&gt;main_loop'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:120:in
&lt;code&gt;run'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:65:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/utils.rb:252:in
&lt;code&gt;safe_fork'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:58:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/rack/application_spawner.rb:41:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:159:in
&lt;code&gt;spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/spawn_manager.rb:287:in
&lt;code&gt;handle_spawn_application'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in
&lt;code&gt;__send__'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:352:in
&lt;code&gt;main_loop'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/lib/phusion_passenger/abstract_server.rb:196:in
&lt;code&gt;start_synchronously'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
[GEM_ROOT]/gems/passenger-2.2.13/bin/passenger-spawn-server:61&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-29T19:06:07+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-29T19:06:09+01:00</updated-at>
      <user-id type="integer">34341</user-id>
      <version type="integer">1</version>
      <user-name>Alex Le</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello,

This more then likely is not a bug with Rails.  The error &quot;MySQL has gone away&quot; is quite common.  You can find a list of causes here:

http://blog.taragana.com/index.php/archive/mysql-tip-mysql-server-has-gone-away-or-lost-connection-to-server-during-query-fix/

From my experience it is typically caused by the server timing out and closing the connection.  A workaround for the time out/connection issue is to include the line 'reconnect: true' in your database.yml. Here is more information in the Ruby on Rails Guides:

http://guides.rubyonrails.org/2_3_release_notes.html#reconnecting-mysql-connections

If a connection closes it will be restarted automatically when the application attempts to use it.  I am going to mark this as invalid, but if you are still seeing this as a problem feel free to update this ticket.

Mike Riley</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;This more then likely is not a bug with Rails. The error &quot;MySQL
has gone away&quot; is quite common. You can find a list of causes
here:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://blog.taragana.com/index.php/archive/mysql-tip-mysql-server-has-gone-away-or-lost-connection-to-server-during-query-fix/&quot;&gt;
http://blog.taragana.com/index.php/archive/mysql-tip-mysql-server-h...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;From my experience it is typically caused by the server timing
out and closing the connection. A workaround for the time
out/connection issue is to include the line 'reconnect: true' in
your database.yml. Here is more information in the Ruby on Rails
Guides:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://guides.rubyonrails.org/2_3_release_notes.html#reconnecting-mysql-connections&quot;&gt;
http://guides.rubyonrails.org/2_3_release_notes.html#reconnecting-m...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If a connection closes it will be restarted automatically when
the application attempts to use it. I am going to mark this as
invalid, but if you are still seeing this as a problem feel free to
update this ticket.&lt;/p&gt;
&lt;p&gt;Mike Riley&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-29T19:56:06+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-29T19:56:08+01:00</updated-at>
      <user-id type="integer">102763</user-id>
      <version type="integer">2</version>
      <user-name>Mike Riley</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Mike, thanks for the thorough explanation.  I really appreciate it.

Please go ahead and close the ticket.  I have added the &quot;reconnect: true&quot; to the database.yml file, and I'll update the ticket if this is still an issue.

Regards,

Alex</body>
      <body-html>&lt;div&gt;&lt;p&gt;Mike, thanks for the thorough explanation. I really appreciate
it.&lt;/p&gt;
&lt;p&gt;Please go ahead and close the ticket. I have added the
&quot;reconnect: true&quot; to the database.yml file, and I'll update the
ticket if this is still an issue.&lt;/p&gt;
&lt;p&gt;Regards,&lt;/p&gt;
&lt;p&gt;Alex&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-29T21:12:14+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-29T21:12:19+01:00</updated-at>
      <user-id type="integer">34341</user-id>
      <version type="integer">3</version>
      <user-name>Alex Le</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello Alex,

You are quite welcome.  Marking this ticket as closed as requested.

Mike Riley</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello Alex,&lt;/p&gt;
&lt;p&gt;You are quite welcome. Marking this ticket as closed as
requested.&lt;/p&gt;
&lt;p&gt;Mike Riley&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-29T21:29:49+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-29T21:29:50+01:00</updated-at>
      <user-id type="integer">102763</user-id>
      <version type="integer">4</version>
      <user-name>Mike Riley</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Not be freaking anybody out, but I'm having this problem since I upgraded Rails 3.0.0.beta4 to 3.0.0.rc. It never happened before I upgraded, and now it happened at least twice.

I don't have enough data to conclude anything about it, but just letting you know...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Not be freaking anybody out, but I'm having this problem since I
upgraded Rails 3.0.0.beta4 to 3.0.0.rc. It never happened before I
upgraded, and now it happened at least twice.&lt;/p&gt;
&lt;p&gt;I don't have enough data to conclude anything about it, but just
letting you know...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-30T09:23:04+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-30T09:23:06+01:00</updated-at>
      <user-id type="integer">27931</user-id>
      <version type="integer">5</version>
      <user-name>iain</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">102763</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Mike,

Even when I added it the line &quot;reconnect: true&quot; to the database.yml, I still ran into this issue again (after haven't accessed the site for a few hours).  With iain's report, maybe this is a real bug in the new ActiveRecord.  

I suggest we re-open this ticket so that it can be further examined.

Thanks,

Alex</body>
      <body-html>&lt;div&gt;&lt;p&gt;Mike,&lt;/p&gt;
&lt;p&gt;Even when I added it the line &quot;reconnect: true&quot; to the
database.yml, I still ran into this issue again (after haven't
accessed the site for a few hours). With iain's report, maybe this
is a real bug in the new ActiveRecord.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I suggest we re-open this ticket so that it can be further
examined.&lt;/p&gt;
&lt;p&gt;Thanks,&lt;/p&gt;
&lt;p&gt;Alex&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-30T10:01:00+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-30T10:01:02+01:00</updated-at>
      <user-id type="integer">34341</user-id>
      <version type="integer">6</version>
      <user-name>Alex Le</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Mike Riley</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello Alex,

I am reopening this as requested so this can be investigated further.

Mike Riley</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello Alex,&lt;/p&gt;
&lt;p&gt;I am reopening this as requested so this can be investigated
further.&lt;/p&gt;
&lt;p&gt;Mike Riley&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-30T21:49:25+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:assigned_user: 102763
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-30T21:49:26+01:00</updated-at>
      <user-id type="integer">102763</user-id>
      <version type="integer">7</version>
      <user-name>Mike Riley</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Chiming in on this -- I also have an app that ran without issues on all the Rails betas, but starting throwing the &quot;MySQL has gone away&quot; error with the RC. The error happens after the app has been dormant for a few hours. I haven't tried the reconnect:true in database.yml yet.

Ubuntu 10, Mysql 5.1.41, Rais 3Rc1, REE ruby 1.8.7 (2009-12-24 patchlevel 248), mysql gem 2.8.1, Passenger 2.2.11</body>
      <body-html>&lt;div&gt;&lt;p&gt;Chiming in on this -- I also have an app that ran without issues
on all the Rails betas, but starting throwing the &quot;MySQL has gone
away&quot; error with the RC. The error happens after the app has been
dormant for a few hours. I haven't tried the reconnect:true in
database.yml yet.&lt;/p&gt;
&lt;p&gt;Ubuntu 10, Mysql 5.1.41, Rais 3Rc1, REE ruby 1.8.7 (2009-12-24
patchlevel 248), mysql gem 2.8.1, Passenger 2.2.11&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-31T01:51:12+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-31T01:51:15+01:00</updated-at>
      <user-id type="integer">19605</user-id>
      <version type="integer">8</version>
      <user-name>Andre Lewis</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I had the same problem. It was solved by setting reconnect:true in database.yml. 

ruby: 1.9.2
mysql: 5.0.51a
passenger: 2.2.15
rails: 3RC1</body>
      <body-html>&lt;div&gt;&lt;p&gt;I had the same problem. It was solved by setting reconnect:true
in database.yml.&lt;/p&gt;
&lt;p&gt;ruby: 1.9.2&lt;br&gt;
mysql: 5.0.51a&lt;br&gt;
passenger: 2.2.15&lt;br&gt;
rails: 3RC1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-31T06:21:31+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-07-31T06:21:34+01:00</updated-at>
      <user-id type="integer">101600</user-id>
      <version type="integer">9</version>
      <user-name>mirza</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Same issue here, and setting reconnect:true in database.yml did not solve it over an extended period of time.

Need to restart unicorn workers to get it all up and running again.

This is an app which is in development, so it is sitting idle for extended periods of time - if that is of any assistance to tracking the bug down.

Ubuntu 8.04, mysql 5.0.51, Rails 3RC1, REE ruby 1.8.7 (2010-04-19 patchlevel 253), Unicorn 1.1.2, nginx/0.7.67.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same issue here, and setting reconnect:true in database.yml did
not solve it over an extended period of time.&lt;/p&gt;
&lt;p&gt;Need to restart unicorn workers to get it all up and running
again.&lt;/p&gt;
&lt;p&gt;This is an app which is in development, so it is sitting idle
for extended periods of time - if that is of any assistance to
tracking the bug down.&lt;/p&gt;
&lt;p&gt;Ubuntu 8.04, mysql 5.0.51, Rails 3RC1, REE ruby 1.8.7
(2010-04-19 patchlevel 253), Unicorn 1.1.2, nginx/0.7.67.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T04:28:23+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T04:28:28+01:00</updated-at>
      <user-id type="integer">109860</user-id>
      <version type="integer">10</version>
      <user-name>James</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Alex Le or James: please provide sample code that illustrates the problem, i.e. the code that invokes the ActiveRecord method that results in the error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Alex Le or James: please provide sample code that illustrates
the problem, i.e. the code that invokes the ActiveRecord method
that results in the error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T14:57:41+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T14:57:43+01:00</updated-at>
      <user-id type="integer">109474</user-id>
      <version type="integer">11</version>
      <user-name>Jeff Lawson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Not sure if &quot;me too&quot; helps at all, but I am in the same situation. App was running fine for months on previous Rails betas, after upgrading to Rails 3.0.0.rc I get &quot;Mysql::Error (MySQL server has gone away)&quot; for all requests after its been running for a little while.

apache
passenger (2.2.15)
rails (3.0.0.rc)
mysql gem (2.8.1)

From the production.log, it runs for a while, and just breaks.  Here's a successful request:


Started GET &quot;/&quot; for 71.178.241.200 at Sun Aug 01 20:58:51 -0400 2010
  Processing by HomepageController#show as HTML
Rendered players/_hidden_players.html.haml (0.2ms)
Rendered unlocks/_unlocks.html.haml (345.3ms)
Rendered homepage/show.html.haml within layouts/application (433.0ms)
Completed 200 OK in 707ms (Views: 433.6ms | ActiveRecord: 74.2ms)

Then, the next request (admittedly 9 hours later, it's a low-traffic site) fails:

Started GET &quot;/&quot; for 68.87.42.115 at Mon Aug 02 08:08:09 -0400 2010
  Processing by HomepageController#show as HTML
Completed   in 4ms

Mysql::Error (MySQL server has gone away):
  app/controllers/homepage_controller.rb:9:in `show'

I'll try the &quot;reconnect&quot; option mentioned above, but never had this problem until moving from beta4 to rc.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Not sure if &quot;me too&quot; helps at all, but I am in the same
situation. App was running fine for months on previous Rails betas,
after upgrading to Rails 3.0.0.rc I get &quot;Mysql::Error (MySQL server
has gone away)&quot; for all requests after its been running for a
little while.&lt;/p&gt;
&lt;p&gt;apache&lt;br&gt;
passenger (2.2.15)&lt;br&gt;
rails (3.0.0.rc)&lt;br&gt;
mysql gem (2.8.1)&lt;/p&gt;
&lt;p&gt;From the production.log, it runs for a while, and just breaks.
Here's a successful request:&lt;/p&gt;
&lt;p&gt;Started GET &quot;/&quot; for 71.178.241.200 at Sun Aug 01 20:58:51 -0400
2010&lt;br&gt;
Processing by HomepageController#show as HTML Rendered
players/&lt;em&gt;hidden_players.html.haml (0.2ms)&lt;br&gt;
Rendered unlocks/&lt;/em&gt;unlocks.html.haml (345.3ms)&lt;br&gt;
Rendered homepage/show.html.haml within layouts/application
(433.0ms)&lt;br&gt;
Completed 200 OK in 707ms (Views: 433.6ms | ActiveRecord:
74.2ms)&lt;/p&gt;
&lt;p&gt;Then, the next request (admittedly 9 hours later, it's a
low-traffic site) fails:&lt;/p&gt;
&lt;p&gt;Started GET &quot;/&quot; for 68.87.42.115 at Mon Aug 02 08:08:09 -0400
2010&lt;br&gt;
Processing by HomepageController#show as HTML Completed in 4ms&lt;/p&gt;
&lt;p&gt;Mysql::Error (MySQL server has gone away):&lt;br&gt;
app/controllers/homepage_controller.rb:9:in &lt;code&gt;show'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I'll try the &quot;reconnect&quot; option mentioned above, but never had
this problem until moving from beta4 to rc.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T15:56:42+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T15:56:46+01:00</updated-at>
      <user-id type="integer">109905</user-id>
      <version type="integer">12</version>
      <user-name>MikeF</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Jeff,

My Rails app is pretty standard so I'm not sure what code I should provide.  So far the issue occurs when we have a long running app (maybe after a few hours) got disconnected from MySQL and couldn't reconnect.

My setting in production is Nginx, Passenger, stock MySQL installation from yum (I'm using CentOS), and the database.yml config file is:  


development:
  adapter: mysql
  database: marrily_development
  pool: 5
  timeout: 5000
  username: root
  host: 127.0.0.1

# Warning: The database defined as &quot;test&quot; will be erased and
# re-generated from your development database when you run &quot;rake&quot;.
# Do not set this db to the same as development or production.
test:
  adapter: mysql
  database: marrily_test
  pool: 5
  host: 127.0.0.1
  username: root

staging:
  adapter: mysql
  database: marrily_staging
  pool: 5
  timeout: 5000
  username: #REDACTED#
  password: #REDACTED#
  host: 127.0.0.1
  reconnect: true

production:
  adapter: mysql
  database: marrily_production
  pool: 5
  timeout: 5000
  username: #REDACTED#
  password: #REDACTED#
  host: 127.0.0.1
  reconnect: true


Hope this helps.  Nonetheless, I'll take a look into the ActiveRecord code to see what's going on as well.

Alex.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Jeff,&lt;/p&gt;
&lt;p&gt;My Rails app is pretty standard so I'm not sure what code I
should provide. So far the issue occurs when we have a long running
app (maybe after a few hours) got disconnected from MySQL and
couldn't reconnect.&lt;/p&gt;
&lt;p&gt;My setting in production is Nginx, Passenger, stock MySQL
installation from yum (I'm using CentOS), and the database.yml
config file is:&lt;br&gt;&lt;/p&gt;
&lt;p&gt;development:&lt;br&gt;
adapter: mysql database: marrily_development pool: 5 timeout: 5000
username: root host: 127.0.0.1&lt;/p&gt;
&lt;h1&gt;Warning: The database defined as &quot;test&quot; will be erased and&lt;/h1&gt;
&lt;h1&gt;re-generated from your development database when you run
&quot;rake&quot;.&lt;/h1&gt;
&lt;h1&gt;Do not set this db to the same as development or
production.&lt;/h1&gt;
&lt;p&gt;test:&lt;br&gt;
adapter: mysql database: marrily_test pool: 5 host: 127.0.0.1
username: root&lt;/p&gt;
&lt;p&gt;staging:&lt;br&gt;
adapter: mysql database: marrily_staging pool: 5 timeout: 5000
username: #REDACTED# password: #REDACTED# host: 127.0.0.1
reconnect: true&lt;/p&gt;
&lt;p&gt;production:&lt;br&gt;
adapter: mysql database: marrily_production pool: 5 timeout: 5000
username: #REDACTED# password: #REDACTED# host: 127.0.0.1
reconnect: true&lt;/p&gt;
&lt;p&gt;Hope this helps. Nonetheless, I'll take a look into the
ActiveRecord code to see what's going on as well.&lt;/p&gt;
&lt;p&gt;Alex.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T17:46:55+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T17:46:56+01:00</updated-at>
      <user-id type="integer">34341</user-id>
      <version type="integer">13</version>
      <user-name>Alex Le</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Alex,

I was wondering what check_for_valid_coupon in:

@@@ ruby
app/controllers/app/users_controller.rb
@@@

looked like.



Jeff</body>
      <body-html>&lt;div&gt;&lt;p&gt;Alex,&lt;/p&gt;
&lt;p&gt;I was wondering what check_for_valid_coupon in:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;app/controllers/app/users_controller.rb&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;looked like.&lt;/p&gt;
&lt;p&gt;Jeff&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T18:11:50+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T18:11:51+01:00</updated-at>
      <user-id type="integer">109474</user-id>
      <version type="integer">14</version>
      <user-name>Jeff Lawson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Jess, check_for_valid_coupon is a utility method in the controller to help me check for a valid coupon before letting user proceed with the registration (Marrily.com is still under alpha so I don't want to let people freely register, but just a few people with a correct coupon code can)

Here's the code from my app with the relevant methods:




class App::UsersController &lt; BaseController
  include ApplicationHelper 
  include App::UsersHelper  
  
  before_filter :authenticate_user!, :except =&gt; [ :new, :create ]
  
  layout 'app'

  def create
    @user = User.new params[:user]
    @user.account_id = -1 # set a temporary account_id to pass the validation before actually creating the account
    
    check_for_valid_coupon
    return unless @coupon # for alpha
    
    @account = Account.new params[:account]

    if @account.valid? and @user.valid?
      @account.save!
      
      @user.account_id = @account.id
      @user.save!
      
      track_user
      
      # assign the main user id to the account
      @account.update_attribute :account_holder_id, @user.id 
      
      # sign in for new, un-confirmed users.
      sign_in @user if @user.class.confirm_within &gt; 0
      
      flash[:notice] = &quot;Account created successfully&quot;
      redirect_to :controller =&gt; &quot;app/events&quot;, :action =&gt; 'setup_event' 
    else
      # logger.error ex
      render :action =&gt; 'new', :layout =&gt; 'app_registration'
    end
  end

  def check_for_valid_coupon
    @coupon = nil
    unless params[:coupon].nil?
      @coupon = AppCoupon.find_by_code params[:coupon].upcase
      if @coupon and @coupon.active?
        # mark coupon as used
        @coupon.used!
      else 
        @coupon = nil
      end
    end
    
    if @coupon.nil?
      flash[:error] = 'Marrily is currently in closed-alpha testing at the moment.  Please enter the coupon code if you have one.'
      render :action =&gt; 'new', :layout =&gt; 'app_registration' and return
    end
  end

end</body>
      <body-html>&lt;div&gt;&lt;p&gt;Jess, check_for_valid_coupon is a utility method in the
controller to help me check for a valid coupon before letting user
proceed with the registration (Marrily.com is still under alpha so
I don't want to let people freely register, but just a few people
with a correct coupon code can)&lt;/p&gt;
&lt;p&gt;Here's the code from my app with the relevant methods:&lt;/p&gt;
&lt;p&gt;class App::UsersController &amp;lt; BaseController&lt;br&gt;
include ApplicationHelper include App::UsersHelper&lt;br&gt;&lt;/p&gt;
&lt;p&gt;before_filter :authenticate_user!, :except =&amp;gt; [ :new, :create
]&lt;/p&gt;
&lt;p&gt;layout 'app'&lt;/p&gt;
&lt;p&gt;def create&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@user = User.new params[:user]
@user.account_id = -1 # set a temporary account_id to pass the validation before actually creating the account

check_for_valid_coupon
return unless @coupon # for alpha

@account = Account.new params[:account]

if @account.valid? and @user.valid?
  @account.save!

  @user.account_id = @account.id
  @user.save!

  track_user

  # assign the main user id to the account
  @account.update_attribute :account_holder_id, @user.id 

  # sign in for new, un-confirmed users.
  sign_in @user if @user.class.confirm_within &amp;gt; 0

  flash[:notice] = &quot;Account created successfully&quot;
  redirect_to :controller =&amp;gt; &quot;app/events&quot;, :action =&amp;gt; 'setup_event' 
else
  # logger.error ex
  render :action =&amp;gt; 'new', :layout =&amp;gt; 'app_registration'
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end&lt;/p&gt;
&lt;p&gt;def check_for_valid_coupon&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@coupon = nil
unless params[:coupon].nil?
  @coupon = AppCoupon.find_by_code params[:coupon].upcase
  if @coupon and @coupon.active?
    # mark coupon as used
    @coupon.used!
  else 
    @coupon = nil
  end
end

if @coupon.nil?
  flash[:error] = 'Marrily is currently in closed-alpha testing at the moment.  Please enter the coupon code if you have one.'
  render :action =&amp;gt; 'new', :layout =&amp;gt; 'app_registration' and return
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end&lt;/p&gt;
&lt;p&gt;end&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T18:18:14+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T18:18:16+01:00</updated-at>
      <user-id type="integer">34341</user-id>
      <version type="integer">15</version>
      <user-name>Alex Le</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Alex,

Completely remove New Relic RPM and see if you still have the problem.


Jeff</body>
      <body-html>&lt;div&gt;&lt;p&gt;Alex,&lt;/p&gt;
&lt;p&gt;Completely remove New Relic RPM and see if you still have the
problem.&lt;/p&gt;
&lt;p&gt;Jeff&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T19:50:57+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T19:50:59+01:00</updated-at>
      <user-id type="integer">109474</user-id>
      <version type="integer">16</version>
      <user-name>Jeff Lawson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>FWIW, I don't have New Relic RPM installed in my app (never did), and I'm having the same problems (see my comment above).</body>
      <body-html>&lt;div&gt;&lt;p&gt;FWIW, I don't have New Relic RPM installed in my app (never
did), and I'm having the same problems (see my comment above).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T21:25:41+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-02T21:25:44+01:00</updated-at>
      <user-id type="integer">109905</user-id>
      <version type="integer">17</version>
      <user-name>MikeF</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Alex's stack trace looks like this at the top:

@@@ ruby
[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in log_without_newrelic_instrumentation'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in log'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in log'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in execute'
@@@

i.e. when **@connection#query(sql)** is called in **ConnectionAdapters#execute**, the execution path jumps into New Relic RPM and when it comes out it is in **AbstractAdapter#log**'s exception handler where it does **raise translate_exception(e, message)**. Clearly, the effect of **@connection#query(sql)** is being lost in the new Relic RPM world  :-)

If Alex has the same problem without New Relic RPM then the new stack trace could shed more light on the problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Alex's stack trace looks like this at the top:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/abstract_adapter.rb:202:in log_without_newrelic_instrumentation'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:65:in log'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/method_tracer.rb:141:in trace_execution_scoped'

vendor/plugins/newrelic_rpm/lib/new_relic/agent/instrumentation/active_record_instrumentation.rb:62:in log'

[GEM_ROOT]/gems/activerecord-3.0.0.rc/lib/active_record/connection_adapters/mysql_adapter.rb:286:in execute'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;i.e. when &lt;strong&gt;@connection#query(sql)&lt;/strong&gt; is called in
&lt;strong&gt;ConnectionAdapters#execute&lt;/strong&gt;, the execution path
jumps into New Relic RPM and when it comes out it is in
&lt;strong&gt;AbstractAdapter#log&lt;/strong&gt;'s exception handler where it
does &lt;strong&gt;raise translate_exception(e, message)&lt;/strong&gt;.
Clearly, the effect of &lt;strong&gt;@connection#query(sql)&lt;/strong&gt; is
being lost in the new Relic RPM world :-)&lt;/p&gt;
&lt;p&gt;If Alex has the same problem without New Relic RPM then the new
stack trace could shed more light on the problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-03T10:11:59+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-03T10:12:01+01:00</updated-at>
      <user-id type="integer">109474</user-id>
      <version type="integer">18</version>
      <user-name>Jeff Lawson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Also seeing this problem on both mysql and mysql2 adapters with 3.0RC.
Not using New Relic. Only thing special with my setup is Nginx and Unicorn.

I think this should have high priority.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Also seeing this problem on both mysql and mysql2 adapters with
3.0RC.&lt;br&gt;
Not using New Relic. Only thing special with my setup is Nginx and
Unicorn.&lt;/p&gt;
&lt;p&gt;I think this should have high priority.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T09:39:44+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-11T09:39:46+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">19</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Did those of you experiencing this use the gem or bundle rails from github?

Trying to limit the time scope.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Did those of you experiencing this use the gem or bundle rails
from github?&lt;/p&gt;
&lt;p&gt;Trying to limit the time scope.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-11T20:38:08+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-11T20:38:12+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">20</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Added reconnect to my setup with mysql2 adapter.
Seems to work this far.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Added reconnect to my setup with mysql2 adapter.&lt;br&gt;
Seems to work this far.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-12T16:39:08+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-12T16:39:12+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">21</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-15T19:07:22+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 3
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-15T19:07:24+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">22</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Maybe &quot;reconnect: true&quot; should be the default? It may just be me, but I kind of like it when my application will reopen a dead connection automatically. It sure beats me having to go in and kick things. My guess is that most people just assume Rails does this by default.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Maybe &quot;reconnect: true&quot; should be the default? It may just be
me, but I kind of like it when my application will reopen a dead
connection automatically. It sure beats me having to go in and kick
things. My guess is that most people just assume Rails does this by
default.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-16T14:26:41+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-16T14:26:45+01:00</updated-at>
      <user-id type="integer">9751</user-id>
      <version type="integer">23</version>
      <user-name>Trotter Cashion</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&quot;reconnect: true&quot; should fix the problem.  Here is a sample program to reproduce the error (this script assumes a database called &quot;activerecord_unittest&quot; that has a &quot;toys&quot; table):

@@@ ruby
require 'rubygems'
require 'mysql'
require 'active_support'
require 'active_record'

p ActiveRecord::VERSION::STRING

options = {
  :adapter =&gt; 'mysql',
  :database =&gt; 'activerecord_unittest',

  ## Uncomment the following line to watch the database reconnect
  #:reconnect =&gt; true
}

ActiveRecord::Base.establish_connection options

class Toy &lt; ActiveRecord::Base; end

p Toy.count
ActiveRecord::Base.connection.execute('SET wait_timeout = 10')
sleep(11)
p Toy.count
@@@

Note that if you uncomment the &quot;reconnect&quot; line, the database will reconnect.  The error is reproducible on 2.3.x as well as 3.0.

I agree with Trotter that &quot;reconnection: true&quot; should be default.  Unless anyone objects, I will change AR to have reconnect set to true by default.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&quot;reconnect: true&quot; should fix the problem. Here is a sample
program to reproduce the error (this script assumes a database
called &quot;activerecord_unittest&quot; that has a &quot;toys&quot; table):&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;require 'rubygems'
require 'mysql'
require 'active_support'
require 'active_record'

p ActiveRecord::VERSION::STRING

options = {
  :adapter =&amp;gt; 'mysql',
  :database =&amp;gt; 'activerecord_unittest',

  ## Uncomment the following line to watch the database reconnect
  #:reconnect =&amp;gt; true
}

ActiveRecord::Base.establish_connection options

class Toy &amp;lt; ActiveRecord::Base; end

p Toy.count
ActiveRecord::Base.connection.execute('SET wait_timeout = 10')
sleep(11)
p Toy.count&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Note that if you uncomment the &quot;reconnect&quot; line, the database
will reconnect. The error is reproducible on 2.3.x as well as
3.0.&lt;/p&gt;
&lt;p&gt;I agree with Trotter that &quot;reconnection: true&quot; should be
default. Unless anyone objects, I will change AR to have reconnect
set to true by default.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-16T21:23:17+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-16T21:35:05+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">24</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Do you like leisure? Do you like fashion? Do you like fancy? Well, we all have that. Come on, our store have the recreational of &lt;a href=&quot;http://www.vibramshoesmall.com&quot;&gt;five fingers shoes&lt;/a&gt; and &lt;a href=&quot;http://www.winarenas.com&quot;&gt;Nfl jerseys&lt;/a&gt;, have the fashion of &lt;a href=&quot;http://www.bootsame.com&quot;&gt;ugg boots &lt;/a&gt; in our store, and also have the luxuriant combining with sexy of &lt;a href=&quot;http://www.baguess.com&quot;&gt;Prada handbags&lt;/a&gt;. We look forward to your arrival!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Do you like leisure? Do you like fashion? Do you like fancy?
Well, we all have that. Come on, our store have the recreational of
&lt;a href=&quot;http://www.vibramshoesmall.com&quot;&gt;five fingers shoes&lt;/a&gt; and
&lt;a href=&quot;http://www.winarenas.com&quot;&gt;Nfl jerseys&lt;/a&gt;, have the
fashion of &lt;a href=&quot;http://www.bootsame.com&quot;&gt;ugg boots&lt;/a&gt; in our
store, and also have the luxuriant combining with sexy of &lt;a href=
&quot;http://www.baguess.com&quot;&gt;Prada handbags&lt;/a&gt;. We look forward to
your arrival!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T08:32:16+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T16:22:24+01:00</updated-at>
      <user-id type="integer">111899</user-id>
      <version type="integer">25</version>
      <user-name>vivian</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 on adding reconnect: true as default</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 on adding reconnect: true as default&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T14:46:38+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T14:46:41+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">26</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>`reconnect: true` bypasses the additional config we do to the connection, like setting the encoding. We probably shouldn't expose it as an option.

The regression here is that the connection manager is checking out an idle connection. Or something is hanging on to a connection instance rather than checking it out from the manager. Either way, the connection is idling out and not getting verified before use.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;code&gt;reconnect: true&lt;/code&gt; bypasses the additional config we
do to the connection, like setting the encoding. We probably
shouldn't expose it as an option.&lt;/p&gt;
&lt;p&gt;The regression here is that the connection manager is checking
out an idle connection. Or something is hanging on to a connection
instance rather than checking it out from the manager. Either way,
the connection is idling out and not getting verified before
use.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T17:22:25+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T17:22:27+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">27</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>After talking to @bitsweat, it sounds like setting `reconnect: true` as default is bad news.  I need to do more investigation, so:

@Rolf, @Alex:  a few questions,

1) Are you running your application with cache_classes turned off?

2) If you turn cache_classes off, does the problem go away?

3) Can you provide a small app that shows the same behavior?

The reason I'm asking about the class cache is that I suspect the bug is here:

  http://github.com/rails/rails/blob/master/activerecord/lib/active_record/railtie.rb#L67-75

I'm not sure why we would only add this code in the case that classes are not cached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;After talking to @bitsweat, it sounds like setting
&lt;code&gt;reconnect: true&lt;/code&gt; as default is bad news. I need to do
more investigation, so:&lt;/p&gt;
&lt;p&gt;@Rolf, @Alex: a few questions,&lt;/p&gt;
&lt;p&gt;1) Are you running your application with cache_classes turned
off?&lt;/p&gt;
&lt;p&gt;2) If you turn cache_classes off, does the problem go away?&lt;/p&gt;
&lt;p&gt;3) Can you provide a small app that shows the same behavior?&lt;/p&gt;
&lt;p&gt;The reason I'm asking about the class cache is that I suspect
the bug is here:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/blob/master/activerecord/lib/active_record/railtie.rb#L67-75&quot;&gt;
http://github.com/rails/rails/blob/master/activerecord/lib/active_r...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I'm not sure why we would only add this code in the case that
classes are not cached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T17:37:11+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T17:37:13+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">28</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Aaron:

1) Running with cache_classes = true

Regarding 2, I need some advice on testing this reliably in the app env.
Only noticed it when I left the app running overnight and there was no activity.

Unicorn establishes db connections as well, which might come into play.


@@@

# unicorn.rb config

after_fork do |server, worker|
  # the following is required for Rails + &quot;preload_app true&quot;,
  defined?(ActiveRecord::Base) and
  ActiveRecord::Base.establish_connection
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Aaron:&lt;/p&gt;
&lt;p&gt;1) Running with cache_classes = true&lt;/p&gt;
&lt;p&gt;Regarding 2, I need some advice on testing this reliably in the
app env.&lt;br&gt;
Only noticed it when I left the app running overnight and there was
no activity.&lt;/p&gt;
&lt;p&gt;Unicorn establishes db connections as well, which might come
into play.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;
# unicorn.rb config

after_fork do |server, worker|
  # the following is required for Rails + &quot;preload_app true&quot;,
  defined?(ActiveRecord::Base) and
  ActiveRecord::Base.establish_connection
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T18:00:28+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T18:00:32+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">29</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Rolf, (and everyone :-) ),

I'll try to explain what I think is going wrong.  MySQL has a wait_timeout set to 28800 seconds (8hrs).  What that means is that if a connection is idle for more than 8hrs, MySQL closes the connection.  You can speed up reproducing the error by setting the wait_timeout to a lower value.

Here is my hypothesis: When connections are checked out from the pool, they are [automatically verified to be open](http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L241-250).  Calling `ActiveRecord::Base.connection` will [check out a connection and cache it in the @reserved_connections hash](http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L95-101).  Unless the connection is checked back in, calling `connection` on the connection pool will happily return a stale connection that was cached in @reserved_connections.

I think there are two ways to solve this.

1) Fix [this code](http://github.com/rails/rails/blob/master/activerecord/lib/active_record/railtie.rb#L67-75) so that clear_reloadable_connections! is called even if we're caching classes.

2) Modify [this code](http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L95-101) to verify the connection after pulling it from the @reserved_connections hash.

I like the first solution best, but I don't know the history for this code.  It requires research.

Also, before I make any modifications I need to write a failing test to prove my hypothesis.  Stay tuned.  :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Rolf, (and everyone :-) ),&lt;/p&gt;
&lt;p&gt;I'll try to explain what I think is going wrong. MySQL has a
wait_timeout set to 28800 seconds (8hrs). What that means is that
if a connection is idle for more than 8hrs, MySQL closes the
connection. You can speed up reproducing the error by setting the
wait_timeout to a lower value.&lt;/p&gt;
&lt;p&gt;Here is my hypothesis: When connections are checked out from the
pool, they are &lt;a href=
&quot;http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L241-250&quot;&gt;
automatically verified to be open&lt;/a&gt;. Calling
&lt;code&gt;ActiveRecord::Base.connection&lt;/code&gt; will &lt;a href=
&quot;http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L95-101&quot;&gt;
check out a connection and cache it in the @reserved_connections
hash&lt;/a&gt;. Unless the connection is checked back in, calling
&lt;code&gt;connection&lt;/code&gt; on the connection pool will happily return
a stale connection that was cached in @reserved_connections.&lt;/p&gt;
&lt;p&gt;I think there are two ways to solve this.&lt;/p&gt;
&lt;p&gt;1) Fix &lt;a href=
&quot;http://github.com/rails/rails/blob/master/activerecord/lib/active_record/railtie.rb#L67-75&quot;&gt;
this code&lt;/a&gt; so that clear_reloadable_connections! is called even
if we're caching classes.&lt;/p&gt;
&lt;p&gt;2) Modify &lt;a href=
&quot;http://github.com/rails/rails/blob/master/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L95-101&quot;&gt;
this code&lt;/a&gt; to verify the connection after pulling it from the
@reserved_connections hash.&lt;/p&gt;
&lt;p&gt;I like the first solution best, but I don't know the history for
this code. It requires research.&lt;/p&gt;
&lt;p&gt;Also, before I make any modifications I need to write a failing
test to prove my hypothesis. Stay tuned. :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-17T19:42:08+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-17T19:42:14+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">30</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Rolf establishing the connection shouldn't do anything.  From reading the source, it doesn't look like it actually establishes a connection but rather creates a connection pool.  Also, can you upload the output of &quot;SHOW variables&quot;?

I have bad news.  :'(

I can't reproduce this bug. :'(

I created a minimal rails application, set the wait timeout on the mysql side to 10 seconds, and everything worked fine (even without reconnect set).

I need more information because I feel like I'm shooting in the dark.  I'll keep messing around, but without a better repro, I'm not sure what to do.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Rolf establishing the connection shouldn't do anything. From
reading the source, it doesn't look like it actually establishes a
connection but rather creates a connection pool. Also, can you
upload the output of &quot;SHOW variables&quot;?&lt;/p&gt;
&lt;p&gt;I have bad news. :'(&lt;/p&gt;
&lt;p&gt;I can't reproduce this bug. :'(&lt;/p&gt;
&lt;p&gt;I created a minimal rails application, set the wait timeout on
the mysql side to 10 seconds, and everything worked fine (even
without reconnect set).&lt;/p&gt;
&lt;p&gt;I need more information because I feel like I'm shooting in the
dark. I'll keep messing around, but without a better repro, I'm not
sure what to do.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T02:19:06+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-19T02:19:08+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">31</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Do you have `config.cache_classes = true` in the minimal app?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Do you have &lt;code&gt;config.cache_classes = true&lt;/code&gt; in the
minimal app?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T07:22:15+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-19T07:22:21+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">32</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Aaron

Output from &quot;SHOW variables&quot; in mysql below.
(if you need the output queried from Rails, let me know)

To sum it up:

Error happened on both the mysql and mysql2 adapter without reconnect.
The error most likely raised it's head between the b4 release, and RC release.

The ruby version was ruby-1.8.7-p299. (updated to 1.9.2-p0 now)
Setup is Nginx with Unicorn.

I'll turn reconnect off today, to see if the error rears it head again tomorrow.
Is there any code you'd want me to put in my ApplicationController to log the status of
the connection pool?

@@@
mysql&gt; show variables;
+-----------------------------------------+-------------------------------------------------------------------------------------------+
| Variable_name                           | Value                                                                                     |
+-----------------------------------------+-------------------------------------------------------------------------------------------+
| auto_increment_increment                | 1                                                                                         |
| auto_increment_offset                   | 1                                                                                         |
| autocommit                              | ON                                                                                        |
| automatic_sp_privileges                 | ON                                                                                        |
| back_log                                | 50                                                                                        |
| basedir                                 | /usr/                                                                                     |
| big_tables                              | OFF                                                                                       |
| binlog_cache_size                       | 32768                                                                                     |
| binlog_direct_non_transactional_updates | OFF                                                                                       |
| binlog_format                           | STATEMENT                                                                                 |
| bulk_insert_buffer_size                 | 8388608                                                                                   |
| character_set_client                    | utf8                                                                                      |
| character_set_connection                | utf8                                                                                      |
| character_set_database                  | utf8                                                                                      |
| character_set_filesystem                | binary                                                                                    |
| character_set_results                   | utf8                                                                                      |
| character_set_server                    | utf8                                                                                      |
| character_set_system                    | utf8                                                                                      |
| character_sets_dir                      | /usr/share/mysql/charsets/                                                                |
| collation_connection                    | utf8_general_ci                                                                           |
| collation_database                      | utf8_general_ci                                                                           |
| collation_server                        | utf8_general_ci                                                                           |
| completion_type                         | 0                                                                                         |
| concurrent_insert                       | 1                                                                                         |
| connect_timeout                         | 10                                                                                        |
| datadir                                 | /var/lib/mysql/                                                                           |
| date_format                             | %Y-%m-%d                                                                                  |
| datetime_format                         | %Y-%m-%d %H:%i:%s                                                                         |
| default_week_format                     | 0                                                                                         |
| delay_key_write                         | ON                                                                                        |
| delayed_insert_limit                    | 100                                                                                       |
| delayed_insert_timeout                  | 300                                                                                       |
| delayed_queue_size                      | 1000                                                                                      |
| div_precision_increment                 | 4                                                                                         |
| engine_condition_pushdown               | ON                                                                                        |
| error_count                             | 0                                                                                         |
| event_scheduler                         | OFF                                                                                       |
| expire_logs_days                        | 0                                                                                         |
| flush                                   | OFF                                                                                       |
| flush_time                              | 0                                                                                         |
| foreign_key_checks                      | ON                                                                                        |
| ft_boolean_syntax                       | + -&gt;&lt;()~*:&quot;&quot;&amp;|                                                                            |
| ft_max_word_len                         | 84                                                                                        |
| ft_min_word_len                         | 4                                                                                         |
| ft_query_expansion_limit                | 20                                                                                        |
| ft_stopword_file                        | (built-in)                                                                                |
| general_log                             | OFF                                                                                       |
| general_log_file                        | /var/lib/mysql/li144-225.log                                                              |
| group_concat_max_len                    | 1024                                                                                      |
| have_community_features                 | YES                                                                                       |
| have_compress                           | YES                                                                                       |
| have_crypt                              | YES                                                                                       |
| have_csv                                | YES                                                                                       |
| have_dynamic_loading                    | YES                                                                                       |
| have_geometry                           | YES                                                                                       |
| have_innodb                             | YES                                                                                       |
| have_ndbcluster                         | DISABLED                                                                                  |
| have_openssl                            | DISABLED                                                                                  |
| have_partitioning                       | YES                                                                                       |
| have_query_cache                        | YES                                                                                       |
| have_rtree_keys                         | YES                                                                                       |
| have_ssl                                | DISABLED                                                                                  |
| have_symlink                            | YES                                                                                       |
| hostname                                | li144-225                                                                                 |
| identity                                | 0                                                                                         |
| ignore_builtin_innodb                   | OFF                                                                                       |
| init_connect                            |                                                                                           |
| init_file                               |                                                                                           |
| init_slave                              |                                                                                           |
| innodb_adaptive_hash_index              | ON                                                                                        |
| innodb_additional_mem_pool_size         | 1048576                                                                                   |
| innodb_autoextend_increment             | 8                                                                                         |
| innodb_autoinc_lock_mode                | 1                                                                                         |
| innodb_buffer_pool_size                 | 8388608                                                                                   |
| innodb_checksums                        | ON                                                                                        |
| innodb_commit_concurrency               | 0                                                                                         |
| innodb_concurrency_tickets              | 500                                                                                       |
| innodb_data_file_path                   | ibdata1:10M:autoextend                                                                    |
| innodb_data_home_dir                    |                                                                                           |
| innodb_doublewrite                      | ON                                                                                        |
| innodb_fast_shutdown                    | 1                                                                                         |
| innodb_file_io_threads                  | 4                                                                                         |
| innodb_file_per_table                   | OFF                                                                                       |
| innodb_flush_log_at_trx_commit          | 1                                                                                         |
| innodb_flush_method                     |                                                                                           |
| innodb_force_recovery                   | 0                                                                                         |
| innodb_lock_wait_timeout                | 50                                                                                        |
| innodb_locks_unsafe_for_binlog          | OFF                                                                                       |
| innodb_log_buffer_size                  | 1048576                                                                                   |
| innodb_log_file_size                    | 5242880                                                                                   |
| innodb_log_files_in_group               | 2                                                                                         |
| innodb_log_group_home_dir               | ./                                                                                        |
| innodb_max_dirty_pages_pct              | 90                                                                                        |
| innodb_max_purge_lag                    | 0                                                                                         |
| innodb_mirrored_log_groups              | 1                                                                                         |
| innodb_open_files                       | 300                                                                                       |
| innodb_rollback_on_timeout              | OFF                                                                                       |
| innodb_stats_on_metadata                | ON                                                                                        |
| innodb_support_xa                       | ON                                                                                        |
| innodb_sync_spin_loops                  | 20                                                                                        |
| innodb_table_locks                      | ON                                                                                        |
| innodb_thread_concurrency               | 8                                                                                         |
| innodb_thread_sleep_delay               | 10000                                                                                     |
| innodb_use_legacy_cardinality_algorithm | ON                                                                                        |
| insert_id                               | 0                                                                                         |
| interactive_timeout                     | 28800                                                                                     |
| join_buffer_size                        | 131072                                                                                    |
| keep_files_on_create                    | OFF                                                                                       |
| key_buffer_size                         | 16777216                                                                                  |
| key_cache_age_threshold                 | 300                                                                                       |
| key_cache_block_size                    | 1024                                                                                      |
| key_cache_division_limit                | 100                                                                                       |
| language                                | /usr/share/mysql/english/                                                                 |
| large_files_support                     | ON                                                                                        |
| large_page_size                         | 0                                                                                         |
| large_pages                             | OFF                                                                                       |
| last_insert_id                          | 0                                                                                         |
| lc_time_names                           | en_US                                                                                     |
| license                                 | GPL                                                                                       |
| local_infile                            | ON                                                                                        |
| locked_in_memory                        | OFF                                                                                       |
| log                                     | OFF                                                                                       |
| log_bin                                 | OFF                                                                                       |
| log_bin_trust_function_creators         | OFF                                                                                       |
| log_bin_trust_routine_creators          | OFF                                                                                       |
| log_error                               | /var/lib/mysql/li144-225.err                                                              |
| log_output                              | FILE                                                                                      |
| log_queries_not_using_indexes           | OFF                                                                                       |
| log_slave_updates                       | OFF                                                                                       |
| log_slow_queries                        | OFF                                                                                       |
| log_warnings                            | 1                                                                                         |
| long_query_time                         | 10.000000                                                                                 |
| low_priority_updates                    | OFF                                                                                       |
| lower_case_file_system                  | OFF                                                                                       |
| lower_case_table_names                  | 0                                                                                         |
| max_allowed_packet                      | 1048576                                                                                   |
| max_binlog_cache_size                   | 18446744073709547520                                                                      |
| max_binlog_size                         | 1073741824                                                                                |
| max_connect_errors                      | 10                                                                                        |
| max_connections                         | 151                                                                                       |
| max_delayed_threads                     | 20                                                                                        |
| max_error_count                         | 64                                                                                        |
| max_heap_table_size                     | 16777216                                                                                  |
| max_insert_delayed_threads              | 20                                                                                        |
| max_join_size                           | 18446744073709551615                                                                      |
| max_length_for_sort_data                | 1024                                                                                      |
| max_prepared_stmt_count                 | 16382                                                                                     |
| max_relay_log_size                      | 0                                                                                         |
| max_seeks_for_key                       | 18446744073709551615                                                                      |
| max_sort_length                         | 1024                                                                                      |
| max_sp_recursion_depth                  | 0                                                                                         |
| max_tmp_tables                          | 32                                                                                        |
| max_user_connections                    | 0                                                                                         |
| max_write_lock_count                    | 18446744073709551615                                                                      |
| min_examined_row_limit                  | 0                                                                                         |
| multi_range_count                       | 256                                                                                       |
| myisam_data_pointer_size                | 6                                                                                         |
| myisam_max_sort_file_size               | 9223372036853727232                                                                       |
| myisam_mmap_size                        | 18446744073709551615                                                                      |
| myisam_recover_options                  | OFF                                                                                       |
| myisam_repair_threads                   | 1                                                                                         |
| myisam_sort_buffer_size                 | 8388608                                                                                   |
| myisam_stats_method                     | nulls_unequal                                                                             |
| myisam_use_mmap                         | OFF                                                                                       |
| ndb_autoincrement_prefetch_sz           | 1                                                                                         |
| ndb_cache_check_time                    | 0                                                                                         |
| ndb_connectstring                       |                                                                                           |
| ndb_extra_logging                       | 0                                                                                         |
| ndb_force_send                          | ON                                                                                        |
| ndb_index_stat_cache_entries            | 32                                                                                        |
| ndb_index_stat_enable                   | OFF                                                                                       |
| ndb_index_stat_update_freq              | 20                                                                                        |
| ndb_report_thresh_binlog_epoch_slip     | 3                                                                                         |
| ndb_report_thresh_binlog_mem_usage      | 10                                                                                        |
| ndb_use_copying_alter_table             | OFF                                                                                       |
| ndb_use_exact_count                     | ON                                                                                        |
| ndb_use_transactions                    | ON                                                                                        |
| net_buffer_length                       | 16384                                                                                     |
| net_read_timeout                        | 30                                                                                        |
| net_retry_count                         | 10                                                                                        |
| net_write_timeout                       | 60                                                                                        |
| new                                     | OFF                                                                                       |
| old                                     | OFF                                                                                       |
| old_alter_table                         | OFF                                                                                       |
| old_passwords                           | OFF                                                                                       |
| open_files_limit                        | 1024                                                                                      |
| optimizer_prune_level                   | 1                                                                                         |
| optimizer_search_depth                  | 62                                                                                        |
| optimizer_switch                        | index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on |
| pid_file                                | /var/lib/mysql/li144-225.pid                                                              |
| plugin_dir                              | /usr/lib/mysql/plugin                                                                     |
| port                                    | 3306                                                                                      |
| preload_buffer_size                     | 32768                                                                                     |
| profiling                               | OFF                                                                                       |
| profiling_history_size                  | 15                                                                                        |
| protocol_version                        | 10                                                                                        |
| pseudo_thread_id                        | 96                                                                                        |
| query_alloc_block_size                  | 8192                                                                                      |
| query_cache_limit                       | 1048576                                                                                   |
| query_cache_min_res_unit                | 4096                                                                                      |
| query_cache_size                        | 0                                                                                         |
| query_cache_type                        | ON                                                                                        |
| query_cache_wlock_invalidate            | OFF                                                                                       |
| query_prealloc_size                     | 8192                                                                                      |
| rand_seed1                              |                                                                                           |
| rand_seed2                              |                                                                                           |
| range_alloc_block_size                  | 4096                                                                                      |
| read_buffer_size                        | 131072                                                                                    |
| read_only                               | OFF                                                                                       |
| read_rnd_buffer_size                    | 262144                                                                                    |
| relay_log                               |                                                                                           |
| relay_log_index                         |                                                                                           |
| relay_log_info_file                     | relay-log.info                                                                            |
| relay_log_purge                         | ON                                                                                        |
| relay_log_space_limit                   | 0                                                                                         |
| report_host                             |                                                                                           |
| report_password                         |                                                                                           |
| report_port                             | 3306                                                                                      |
| report_user                             |                                                                                           |
| rpl_recovery_rank                       | 0                                                                                         |
| secure_auth                             | OFF                                                                                       |
| secure_file_priv                        |                                                                                           |
| server_id                               | 1                                                                                         |
| skip_external_locking                   | ON                                                                                        |
| skip_name_resolve                       | OFF                                                                                       |
| skip_networking                         | ON                                                                                        |
| skip_show_database                      | OFF                                                                                       |
| slave_compressed_protocol               | OFF                                                                                       |
| slave_exec_mode                         | STRICT                                                                                    |
| slave_load_tmpdir                       | /tmp                                                                                      |
| slave_net_timeout                       | 3600                                                                                      |
| slave_skip_errors                       | OFF                                                                                       |
| slave_transaction_retries               | 10                                                                                        |
| slow_launch_time                        | 2                                                                                         |
| slow_query_log                          | OFF                                                                                       |
| slow_query_log_file                     | /var/lib/mysql/li144-225-slow.log                                                         |
| socket                                  | /var/run/mysqld/mysqld.sock                                                               |
| sort_buffer_size                        | 524288                                                                                    |
| sql_auto_is_null                        | ON                                                                                        |
| sql_big_selects                         | ON                                                                                        |
| sql_big_tables                          | OFF                                                                                       |
| sql_buffer_result                       | OFF                                                                                       |
| sql_log_bin                             | ON                                                                                        |
| sql_log_off                             | OFF                                                                                       |
| sql_log_update                          | ON                                                                                        |
| sql_low_priority_updates                | OFF                                                                                       |
| sql_max_join_size                       | 18446744073709551615                                                                      |
| sql_mode                                |                                                                                           |
| sql_notes                               | ON                                                                                        |
| sql_quote_show_create                   | ON                                                                                        |
| sql_safe_updates                        | OFF                                                                                       |
| sql_select_limit                        | 18446744073709551615                                                                      |
| sql_slave_skip_counter                  |                                                                                           |
| sql_warnings                            | OFF                                                                                       |
| ssl_ca                                  |                                                                                           |
| ssl_capath                              |                                                                                           |
| ssl_cert                                |                                                                                           |
| ssl_cipher                              |                                                                                           |
| ssl_key                                 |                                                                                           |
| storage_engine                          | MyISAM                                                                                    |
| sync_binlog                             | 0                                                                                         |
| sync_frm                                | ON                                                                                        |
| system_time_zone                        | EDT                                                                                       |
| table_definition_cache                  | 256                                                                                       |
| table_lock_wait_timeout                 | 50                                                                                        |
| table_open_cache                        | 64                                                                                        |
| table_type                              | MyISAM                                                                                    |
| thread_cache_size                       | 0                                                                                         |
| thread_handling                         | one-thread-per-connection                                                                 |
| thread_stack                            | 262144                                                                                    |
| time_format                             | %H:%i:%s                                                                                  |
| time_zone                               | SYSTEM                                                                                    |
| timed_mutexes                           | OFF                                                                                       |
| timestamp                               | 1282204061                                                                                |
| tmp_table_size                          | 16777216                                                                                  |
| tmpdir                                  | /tmp                                                                                      |
| transaction_alloc_block_size            | 8192                                                                                      |
| transaction_prealloc_size               | 4096                                                                                      |
| tx_isolation                            | REPEATABLE-READ                                                                           |
| unique_checks                           | ON                                                                                        |
| updatable_views_with_limit              | YES                                                                                       |
| version                                 | 5.1.47                                                                                    |
| version_comment                         | Source distribution                                                                       |
| version_compile_machine                 | x86_64                                                                                    |
| version_compile_os                      | unknown-linux-gnu                                                                         |
| wait_timeout                            | 28800                                                                                     |
| warning_count                           | 0                                                                                         |
+-----------------------------------------+-------------------------------------------------------------------------------------------+
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Aaron&lt;/p&gt;
&lt;p&gt;Output from &quot;SHOW variables&quot; in mysql below.&lt;br&gt;
(if you need the output queried from Rails, let me know)&lt;/p&gt;
&lt;p&gt;To sum it up:&lt;/p&gt;
&lt;p&gt;Error happened on both the mysql and mysql2 adapter without
reconnect.&lt;br&gt;
The error most likely raised it's head between the b4 release, and
RC release.&lt;/p&gt;
&lt;p&gt;The ruby version was ruby-1.8.7-p299. (updated to 1.9.2-p0
now)&lt;br&gt;
Setup is Nginx with Unicorn.&lt;/p&gt;
&lt;p&gt;I'll turn reconnect off today, to see if the error rears it head
again tomorrow.&lt;br&gt;
Is there any code you'd want me to put in my ApplicationController
to log the status of&lt;br&gt;
the connection pool?&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; show variables;
+-----------------------------------------+-------------------------------------------------------------------------------------------+
| Variable_name                           | Value                                                                                     |
+-----------------------------------------+-------------------------------------------------------------------------------------------+
| auto_increment_increment                | 1                                                                                         |
| auto_increment_offset                   | 1                                                                                         |
| autocommit                              | ON                                                                                        |
| automatic_sp_privileges                 | ON                                                                                        |
| back_log                                | 50                                                                                        |
| basedir                                 | /usr/                                                                                     |
| big_tables                              | OFF                                                                                       |
| binlog_cache_size                       | 32768                                                                                     |
| binlog_direct_non_transactional_updates | OFF                                                                                       |
| binlog_format                           | STATEMENT                                                                                 |
| bulk_insert_buffer_size                 | 8388608                                                                                   |
| character_set_client                    | utf8                                                                                      |
| character_set_connection                | utf8                                                                                      |
| character_set_database                  | utf8                                                                                      |
| character_set_filesystem                | binary                                                                                    |
| character_set_results                   | utf8                                                                                      |
| character_set_server                    | utf8                                                                                      |
| character_set_system                    | utf8                                                                                      |
| character_sets_dir                      | /usr/share/mysql/charsets/                                                                |
| collation_connection                    | utf8_general_ci                                                                           |
| collation_database                      | utf8_general_ci                                                                           |
| collation_server                        | utf8_general_ci                                                                           |
| completion_type                         | 0                                                                                         |
| concurrent_insert                       | 1                                                                                         |
| connect_timeout                         | 10                                                                                        |
| datadir                                 | /var/lib/mysql/                                                                           |
| date_format                             | %Y-%m-%d                                                                                  |
| datetime_format                         | %Y-%m-%d %H:%i:%s                                                                         |
| default_week_format                     | 0                                                                                         |
| delay_key_write                         | ON                                                                                        |
| delayed_insert_limit                    | 100                                                                                       |
| delayed_insert_timeout                  | 300                                                                                       |
| delayed_queue_size                      | 1000                                                                                      |
| div_precision_increment                 | 4                                                                                         |
| engine_condition_pushdown               | ON                                                                                        |
| error_count                             | 0                                                                                         |
| event_scheduler                         | OFF                                                                                       |
| expire_logs_days                        | 0                                                                                         |
| flush                                   | OFF                                                                                       |
| flush_time                              | 0                                                                                         |
| foreign_key_checks                      | ON                                                                                        |
| ft_boolean_syntax                       | + -&amp;gt;&amp;lt;()~*:&quot;&quot;&amp;amp;|                                                                            |
| ft_max_word_len                         | 84                                                                                        |
| ft_min_word_len                         | 4                                                                                         |
| ft_query_expansion_limit                | 20                                                                                        |
| ft_stopword_file                        | (built-in)                                                                                |
| general_log                             | OFF                                                                                       |
| general_log_file                        | /var/lib/mysql/li144-225.log                                                              |
| group_concat_max_len                    | 1024                                                                                      |
| have_community_features                 | YES                                                                                       |
| have_compress                           | YES                                                                                       |
| have_crypt                              | YES                                                                                       |
| have_csv                                | YES                                                                                       |
| have_dynamic_loading                    | YES                                                                                       |
| have_geometry                           | YES                                                                                       |
| have_innodb                             | YES                                                                                       |
| have_ndbcluster                         | DISABLED                                                                                  |
| have_openssl                            | DISABLED                                                                                  |
| have_partitioning                       | YES                                                                                       |
| have_query_cache                        | YES                                                                                       |
| have_rtree_keys                         | YES                                                                                       |
| have_ssl                                | DISABLED                                                                                  |
| have_symlink                            | YES                                                                                       |
| hostname                                | li144-225                                                                                 |
| identity                                | 0                                                                                         |
| ignore_builtin_innodb                   | OFF                                                                                       |
| init_connect                            |                                                                                           |
| init_file                               |                                                                                           |
| init_slave                              |                                                                                           |
| innodb_adaptive_hash_index              | ON                                                                                        |
| innodb_additional_mem_pool_size         | 1048576                                                                                   |
| innodb_autoextend_increment             | 8                                                                                         |
| innodb_autoinc_lock_mode                | 1                                                                                         |
| innodb_buffer_pool_size                 | 8388608                                                                                   |
| innodb_checksums                        | ON                                                                                        |
| innodb_commit_concurrency               | 0                                                                                         |
| innodb_concurrency_tickets              | 500                                                                                       |
| innodb_data_file_path                   | ibdata1:10M:autoextend                                                                    |
| innodb_data_home_dir                    |                                                                                           |
| innodb_doublewrite                      | ON                                                                                        |
| innodb_fast_shutdown                    | 1                                                                                         |
| innodb_file_io_threads                  | 4                                                                                         |
| innodb_file_per_table                   | OFF                                                                                       |
| innodb_flush_log_at_trx_commit          | 1                                                                                         |
| innodb_flush_method                     |                                                                                           |
| innodb_force_recovery                   | 0                                                                                         |
| innodb_lock_wait_timeout                | 50                                                                                        |
| innodb_locks_unsafe_for_binlog          | OFF                                                                                       |
| innodb_log_buffer_size                  | 1048576                                                                                   |
| innodb_log_file_size                    | 5242880                                                                                   |
| innodb_log_files_in_group               | 2                                                                                         |
| innodb_log_group_home_dir               | ./                                                                                        |
| innodb_max_dirty_pages_pct              | 90                                                                                        |
| innodb_max_purge_lag                    | 0                                                                                         |
| innodb_mirrored_log_groups              | 1                                                                                         |
| innodb_open_files                       | 300                                                                                       |
| innodb_rollback_on_timeout              | OFF                                                                                       |
| innodb_stats_on_metadata                | ON                                                                                        |
| innodb_support_xa                       | ON                                                                                        |
| innodb_sync_spin_loops                  | 20                                                                                        |
| innodb_table_locks                      | ON                                                                                        |
| innodb_thread_concurrency               | 8                                                                                         |
| innodb_thread_sleep_delay               | 10000                                                                                     |
| innodb_use_legacy_cardinality_algorithm | ON                                                                                        |
| insert_id                               | 0                                                                                         |
| interactive_timeout                     | 28800                                                                                     |
| join_buffer_size                        | 131072                                                                                    |
| keep_files_on_create                    | OFF                                                                                       |
| key_buffer_size                         | 16777216                                                                                  |
| key_cache_age_threshold                 | 300                                                                                       |
| key_cache_block_size                    | 1024                                                                                      |
| key_cache_division_limit                | 100                                                                                       |
| language                                | /usr/share/mysql/english/                                                                 |
| large_files_support                     | ON                                                                                        |
| large_page_size                         | 0                                                                                         |
| large_pages                             | OFF                                                                                       |
| last_insert_id                          | 0                                                                                         |
| lc_time_names                           | en_US                                                                                     |
| license                                 | GPL                                                                                       |
| local_infile                            | ON                                                                                        |
| locked_in_memory                        | OFF                                                                                       |
| log                                     | OFF                                                                                       |
| log_bin                                 | OFF                                                                                       |
| log_bin_trust_function_creators         | OFF                                                                                       |
| log_bin_trust_routine_creators          | OFF                                                                                       |
| log_error                               | /var/lib/mysql/li144-225.err                                                              |
| log_output                              | FILE                                                                                      |
| log_queries_not_using_indexes           | OFF                                                                                       |
| log_slave_updates                       | OFF                                                                                       |
| log_slow_queries                        | OFF                                                                                       |
| log_warnings                            | 1                                                                                         |
| long_query_time                         | 10.000000                                                                                 |
| low_priority_updates                    | OFF                                                                                       |
| lower_case_file_system                  | OFF                                                                                       |
| lower_case_table_names                  | 0                                                                                         |
| max_allowed_packet                      | 1048576                                                                                   |
| max_binlog_cache_size                   | 18446744073709547520                                                                      |
| max_binlog_size                         | 1073741824                                                                                |
| max_connect_errors                      | 10                                                                                        |
| max_connections                         | 151                                                                                       |
| max_delayed_threads                     | 20                                                                                        |
| max_error_count                         | 64                                                                                        |
| max_heap_table_size                     | 16777216                                                                                  |
| max_insert_delayed_threads              | 20                                                                                        |
| max_join_size                           | 18446744073709551615                                                                      |
| max_length_for_sort_data                | 1024                                                                                      |
| max_prepared_stmt_count                 | 16382                                                                                     |
| max_relay_log_size                      | 0                                                                                         |
| max_seeks_for_key                       | 18446744073709551615                                                                      |
| max_sort_length                         | 1024                                                                                      |
| max_sp_recursion_depth                  | 0                                                                                         |
| max_tmp_tables                          | 32                                                                                        |
| max_user_connections                    | 0                                                                                         |
| max_write_lock_count                    | 18446744073709551615                                                                      |
| min_examined_row_limit                  | 0                                                                                         |
| multi_range_count                       | 256                                                                                       |
| myisam_data_pointer_size                | 6                                                                                         |
| myisam_max_sort_file_size               | 9223372036853727232                                                                       |
| myisam_mmap_size                        | 18446744073709551615                                                                      |
| myisam_recover_options                  | OFF                                                                                       |
| myisam_repair_threads                   | 1                                                                                         |
| myisam_sort_buffer_size                 | 8388608                                                                                   |
| myisam_stats_method                     | nulls_unequal                                                                             |
| myisam_use_mmap                         | OFF                                                                                       |
| ndb_autoincrement_prefetch_sz           | 1                                                                                         |
| ndb_cache_check_time                    | 0                                                                                         |
| ndb_connectstring                       |                                                                                           |
| ndb_extra_logging                       | 0                                                                                         |
| ndb_force_send                          | ON                                                                                        |
| ndb_index_stat_cache_entries            | 32                                                                                        |
| ndb_index_stat_enable                   | OFF                                                                                       |
| ndb_index_stat_update_freq              | 20                                                                                        |
| ndb_report_thresh_binlog_epoch_slip     | 3                                                                                         |
| ndb_report_thresh_binlog_mem_usage      | 10                                                                                        |
| ndb_use_copying_alter_table             | OFF                                                                                       |
| ndb_use_exact_count                     | ON                                                                                        |
| ndb_use_transactions                    | ON                                                                                        |
| net_buffer_length                       | 16384                                                                                     |
| net_read_timeout                        | 30                                                                                        |
| net_retry_count                         | 10                                                                                        |
| net_write_timeout                       | 60                                                                                        |
| new                                     | OFF                                                                                       |
| old                                     | OFF                                                                                       |
| old_alter_table                         | OFF                                                                                       |
| old_passwords                           | OFF                                                                                       |
| open_files_limit                        | 1024                                                                                      |
| optimizer_prune_level                   | 1                                                                                         |
| optimizer_search_depth                  | 62                                                                                        |
| optimizer_switch                        | index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on |
| pid_file                                | /var/lib/mysql/li144-225.pid                                                              |
| plugin_dir                              | /usr/lib/mysql/plugin                                                                     |
| port                                    | 3306                                                                                      |
| preload_buffer_size                     | 32768                                                                                     |
| profiling                               | OFF                                                                                       |
| profiling_history_size                  | 15                                                                                        |
| protocol_version                        | 10                                                                                        |
| pseudo_thread_id                        | 96                                                                                        |
| query_alloc_block_size                  | 8192                                                                                      |
| query_cache_limit                       | 1048576                                                                                   |
| query_cache_min_res_unit                | 4096                                                                                      |
| query_cache_size                        | 0                                                                                         |
| query_cache_type                        | ON                                                                                        |
| query_cache_wlock_invalidate            | OFF                                                                                       |
| query_prealloc_size                     | 8192                                                                                      |
| rand_seed1                              |                                                                                           |
| rand_seed2                              |                                                                                           |
| range_alloc_block_size                  | 4096                                                                                      |
| read_buffer_size                        | 131072                                                                                    |
| read_only                               | OFF                                                                                       |
| read_rnd_buffer_size                    | 262144                                                                                    |
| relay_log                               |                                                                                           |
| relay_log_index                         |                                                                                           |
| relay_log_info_file                     | relay-log.info                                                                            |
| relay_log_purge                         | ON                                                                                        |
| relay_log_space_limit                   | 0                                                                                         |
| report_host                             |                                                                                           |
| report_password                         |                                                                                           |
| report_port                             | 3306                                                                                      |
| report_user                             |                                                                                           |
| rpl_recovery_rank                       | 0                                                                                         |
| secure_auth                             | OFF                                                                                       |
| secure_file_priv                        |                                                                                           |
| server_id                               | 1                                                                                         |
| skip_external_locking                   | ON                                                                                        |
| skip_name_resolve                       | OFF                                                                                       |
| skip_networking                         | ON                                                                                        |
| skip_show_database                      | OFF                                                                                       |
| slave_compressed_protocol               | OFF                                                                                       |
| slave_exec_mode                         | STRICT                                                                                    |
| slave_load_tmpdir                       | /tmp                                                                                      |
| slave_net_timeout                       | 3600                                                                                      |
| slave_skip_errors                       | OFF                                                                                       |
| slave_transaction_retries               | 10                                                                                        |
| slow_launch_time                        | 2                                                                                         |
| slow_query_log                          | OFF                                                                                       |
| slow_query_log_file                     | /var/lib/mysql/li144-225-slow.log                                                         |
| socket                                  | /var/run/mysqld/mysqld.sock                                                               |
| sort_buffer_size                        | 524288                                                                                    |
| sql_auto_is_null                        | ON                                                                                        |
| sql_big_selects                         | ON                                                                                        |
| sql_big_tables                          | OFF                                                                                       |
| sql_buffer_result                       | OFF                                                                                       |
| sql_log_bin                             | ON                                                                                        |
| sql_log_off                             | OFF                                                                                       |
| sql_log_update                          | ON                                                                                        |
| sql_low_priority_updates                | OFF                                                                                       |
| sql_max_join_size                       | 18446744073709551615                                                                      |
| sql_mode                                |                                                                                           |
| sql_notes                               | ON                                                                                        |
| sql_quote_show_create                   | ON                                                                                        |
| sql_safe_updates                        | OFF                                                                                       |
| sql_select_limit                        | 18446744073709551615                                                                      |
| sql_slave_skip_counter                  |                                                                                           |
| sql_warnings                            | OFF                                                                                       |
| ssl_ca                                  |                                                                                           |
| ssl_capath                              |                                                                                           |
| ssl_cert                                |                                                                                           |
| ssl_cipher                              |                                                                                           |
| ssl_key                                 |                                                                                           |
| storage_engine                          | MyISAM                                                                                    |
| sync_binlog                             | 0                                                                                         |
| sync_frm                                | ON                                                                                        |
| system_time_zone                        | EDT                                                                                       |
| table_definition_cache                  | 256                                                                                       |
| table_lock_wait_timeout                 | 50                                                                                        |
| table_open_cache                        | 64                                                                                        |
| table_type                              | MyISAM                                                                                    |
| thread_cache_size                       | 0                                                                                         |
| thread_handling                         | one-thread-per-connection                                                                 |
| thread_stack                            | 262144                                                                                    |
| time_format                             | %H:%i:%s                                                                                  |
| time_zone                               | SYSTEM                                                                                    |
| timed_mutexes                           | OFF                                                                                       |
| timestamp                               | 1282204061                                                                                |
| tmp_table_size                          | 16777216                                                                                  |
| tmpdir                                  | /tmp                                                                                      |
| transaction_alloc_block_size            | 8192                                                                                      |
| transaction_prealloc_size               | 4096                                                                                      |
| tx_isolation                            | REPEATABLE-READ                                                                           |
| unique_checks                           | ON                                                                                        |
| updatable_views_with_limit              | YES                                                                                       |
| version                                 | 5.1.47                                                                                    |
| version_comment                         | Source distribution                                                                       |
| version_compile_machine                 | x86_64                                                                                    |
| version_compile_os                      | unknown-linux-gnu                                                                         |
| wait_timeout                            | 28800                                                                                     |
| warning_count                           | 0                                                                                         |
+-----------------------------------------+-------------------------------------------------------------------------------------------+&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T09:00:25+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-19T09:00:28+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">33</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Jeremy yes, and I'm running in production mode.  I've attached my sample application (that doesn't break for me).

Here is my my.cnf:

@@@
[client]
character_set = utf8

[mysqld]
character-set-server  = utf8
default-character-set = utf8
init-connect    = 'SET NAMES utf8'
wait_timeout = 10
@@@

Here is how I start my server:

    $ RAILS_ENV=production RAILS=$HOME/git/rails bundle exec script/rails server

Here are the curl commands I use:

    $ curl http://localhost:3000/foo; sleep 11; curl http://localhost:3000/foo</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Jeremy yes, and I'm running in production mode. I've attached
my sample application (that doesn't break for me).&lt;/p&gt;
&lt;p&gt;Here is my my.cnf:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[client]
character_set = utf8

[mysqld]
character-set-server  = utf8
default-character-set = utf8
init-connect    = 'SET NAMES utf8'
wait_timeout = 10&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Here is how I start my server:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;$ RAILS_ENV=production RAILS=$HOME/git/rails bundle exec script/rails server&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Here are the curl commands I use:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;$ curl http://localhost:3000/foo; sleep 11; curl http://localhost:3000/foo&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T17:11:01+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-19T17:11:04+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">34</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Turned off the reconnect on my app now.
It'll be fun to see what it says tomorrow.

Good night.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Turned off the reconnect on my app now.&lt;br&gt;
It'll be fun to see what it says tomorrow.&lt;/p&gt;
&lt;p&gt;Good night.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T23:46:54+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-19T23:46:57+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">35</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I just ran in to this here this morning on rails 3.0.0.rc

My change yesterday was on Passenger where added PassengerPoolIdleTime 0 to remove the slow start ups (I like the fact that they die off, but the users don't). It sat idle all night and this morning. It was throwing 500's. It's running the default production config for internal testing, so no traffic outside business hours.

In the logs it says:
ActiveRecord::StatementInvalid (Mysql::Error: MySQL server has gone away: .....

Ubuntu 10.04.1 LTS
Apache/2.2.14 (Ubuntu)
Mysql: 5.1.41-3ubuntu12.6-log (Ubuntu)
ruby 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux]
rails 3.0.0.rc
passenger 2.2.13

restarting apache relived the issue. I've added the reconnect: true to the database.yml so we will see if that helps. It was mentioned that adding that statement was not a good idea. Why?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just ran in to this here this morning on rails 3.0.0.rc&lt;/p&gt;
&lt;p&gt;My change yesterday was on Passenger where added
PassengerPoolIdleTime 0 to remove the slow start ups (I like the
fact that they die off, but the users don't). It sat idle all night
and this morning. It was throwing 500's. It's running the default
production config for internal testing, so no traffic outside
business hours.&lt;/p&gt;
&lt;p&gt;In the logs it says:&lt;br&gt;
ActiveRecord::StatementInvalid (Mysql::Error: MySQL server has gone
away: .....&lt;/p&gt;
&lt;p&gt;Ubuntu 10.04.1 LTS&lt;br&gt;
Apache/2.2.14 (Ubuntu)&lt;br&gt;
Mysql: 5.1.41-3ubuntu12.6-log (Ubuntu)&lt;br&gt;
ruby 1.8.7 (2010-01-10 patchlevel 249) [x86_64-linux]&lt;br&gt;
rails 3.0.0.rc&lt;br&gt;
passenger 2.2.13&lt;/p&gt;
&lt;p&gt;restarting apache relived the issue. I've added the reconnect:
true to the database.yml so we will see if that helps. It was
mentioned that adding that statement was not a good idea. Why?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-20T15:37:48+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-20T15:37:50+01:00</updated-at>
      <user-id type="integer">36681</user-id>
      <version type="integer">36</version>
      <user-name>Fredrik Thuresson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The app was failing this morning as expected.

It saw some activity around 2.30 AM, hit a NameError in a controller.
22 minutes later, (with no db acitivity) the mysql connection is gone.
Mysql processlist showed zero connections this morning.

I can't reproduce by taking the same steps.

The processlist in mysql shows 2 sleeping connections now.

Ideas?</body>
      <body-html>&lt;div&gt;&lt;p&gt;The app was failing this morning as expected.&lt;/p&gt;
&lt;p&gt;It saw some activity around 2.30 AM, hit a NameError in a
controller.&lt;br&gt;
22 minutes later, (with no db acitivity) the mysql connection is
gone.&lt;br&gt;
Mysql processlist showed zero connections this morning.&lt;/p&gt;
&lt;p&gt;I can't reproduce by taking the same steps.&lt;/p&gt;
&lt;p&gt;The processlist in mysql shows 2 sleeping connections now.&lt;/p&gt;
&lt;p&gt;Ideas?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-20T18:34:42+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-20T18:34:45+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">37</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Btw, I am in #carlhuda as rolfb.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Btw, I am in #carlhuda as rolfb.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-20T18:41:16+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-20T18:41:18+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">38</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looks like the regression is http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170478a3828fe. If you set `config.threadsafe!` in your `config/application.rb`, it will work around the problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks like the regression is &lt;a href=
&quot;http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170478a3828fe&quot;&gt;
http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170...&lt;/a&gt;.
If you set &lt;code&gt;config.threadsafe!&lt;/code&gt; in your
&lt;code&gt;config/application.rb&lt;/code&gt;, it will work around the
problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-21T02:54:26+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-21T02:54:28+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">39</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hi,

i wanted to add that i'm quite sure the problem also exists for a non-idle app. In my setup a cronjob calls a certain controller every minute and there are some sql queries triggered each time.

After switching to rails 3rc, the same problems appeared ca. 6-8 hours after restarting apache (&quot;MySQL server has gone away&quot;, ruby 1.8.7, passenger 2.1.14 with apache, production app, cache_classes = true, config.threadsafe! not set )

After setting reconnect: true in database.yml, no errors since then.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;i wanted to add that i'm quite sure the problem also exists for
a non-idle app. In my setup a cronjob calls a certain controller
every minute and there are some sql queries triggered each
time.&lt;/p&gt;
&lt;p&gt;After switching to rails 3rc, the same problems appeared ca. 6-8
hours after restarting apache (&quot;MySQL server has gone away&quot;, ruby
1.8.7, passenger 2.1.14 with apache, production app, cache_classes
= true, config.threadsafe! not set )&lt;/p&gt;
&lt;p&gt;After setting reconnect: true in database.yml, no errors since
then.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-23T00:07:02+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-23T00:07:06+01:00</updated-at>
      <user-id type="integer">58766</user-id>
      <version type="integer">40</version>
      <user-name>mixr</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I agree entirely with mixr. I added reconnect:true into my database.yml last night and have had my first 6hr period without an issue for a while.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree entirely with mixr. I added reconnect:true into my
database.yml last night and have had my first 6hr period without an
issue for a while.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-23T09:06:34+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-23T09:06:36+01:00</updated-at>
      <user-id type="integer">96819</user-id>
      <version type="integer">41</version>
      <user-name>iHiD</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@mixr

That could be attributed to caching of queries.

Using reconnect: true is not a good solution.
There is a regression which needs to be fixed and Aaron is looking into it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@mixr&lt;/p&gt;
&lt;p&gt;That could be attributed to caching of queries.&lt;/p&gt;
&lt;p&gt;Using reconnect: true is not a good solution.&lt;br&gt;
There is a regression which needs to be fixed and Aaron is looking
into it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-23T09:26:10+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-23T09:26:13+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">42</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey everyone!  Jeremy and I discussed the problem, and he was able to find the commit where the regression occurred:

  http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170478a3828fe

Jeremy reverted the regression commit here:

  http://github.com/rails/rails/commit/c211d904ba358d3d1ae85d56fa3a805ea505c23a

So this ticket should be fixed, so I will mark it as fixed.  :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey everyone! Jeremy and I discussed the problem, and he was
able to find the commit where the regression occurred:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170478a3828fe&quot;&gt;
http://github.com/rails/rails/commit/6b29dc876fe185881d46731c3ae170...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Jeremy reverted the regression commit here:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/c211d904ba358d3d1ae85d56fa3a805ea505c23a&quot;&gt;
http://github.com/rails/rails/commit/c211d904ba358d3d1ae85d56fa3a80...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So this ticket should be fixed, so I will mark it as fixed.
:-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-23T16:39:20+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-23T16:39:22+01:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">43</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>That is great news.
Good work and thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;That is great news.&lt;br&gt;
Good work and thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-23T17:05:13+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-08-23T17:05:14+01:00</updated-at>
      <user-id type="integer">79823</user-id>
      <version type="integer">44</version>
      <user-name>Rolf Bjaanes</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:59+01:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>mysql &quot;rails 3.0.rc&quot;</tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-10-15T23:01:59+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">45</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T01:48:17+00:00</created-at>
      <creator-id type="integer">34341</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: mysql &quot;rails 3.0.rc&quot;
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5242</number>
      <permalink>activerecordstatementinvalid-mysqlerror-mysql-server-has-gone-away</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>ActiveRecord::StatementInvalid: Mysql::Error: MySQL server has gone away</title>
      <updated-at type="datetime">2010-11-08T01:48:21+00:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">47</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Alex Le</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5242</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>038495629205a23c214d23840707adb4b088e67e</code>
      <content-type>application/zip</content-type>
      <created-at type="datetime">2010-08-19T17:11:01+01:00</created-at>
      <filename>foo.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">636518</id>
      <size type="integer">109608</size>
      <uploader-id type="integer">15316</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/636518/foo.zip</url>
    </attachment>
  </attachments>
</ticket>
