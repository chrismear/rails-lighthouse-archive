<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1366</assigned-user-id>
  <attachments-count type="integer">5</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-07-09T21:30:51+01:00</created-at>
  <creator-id type="integer">9698</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">2896</number>
  <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>:include activerecord eager_loading patch</tag>
  <title>collection_singular_ids breaks when used with :include</title>
  <updated-at type="datetime">2010-05-15T17:21:54+01:00</updated-at>
  <user-id type="integer">65556</user-id>
  <version type="integer">19</version>
  <user-name>Rizwan Reza</user-name>
  <creator-name>Diego Algorta</creator-name>
  <assigned-user-name>Pratik</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
  <milestone-title>3.x</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>Given a has_many association defined with an :include option, you can't use the #collection_singular_ids method because it fails trying to eager load the 2nd level association when it's unneeded.

The attached patch includes a test case where you can see the need for it.

I'm not exactly happy with the patch because it involves adding a new :ignore_include valid option to ActiveRecord::Base.find, but I think I've read people requesting that kind of option too so maybe this is something you may want too.

Please review the patch and suggest any improvements or raise concerns.</original-body>
  <latest-body>Given a has_many association defined with an :include option, you can't use the #collection_singular_ids method because it fails trying to eager load the 2nd level association when it's unneeded.

The attached patch includes a test case where you can see the need for it.

I'm not exactly happy with the patch because it involves adding a new :ignore_include valid option to ActiveRecord::Base.find, but I think I've read people requesting that kind of option too so maybe this is something you may want too.

Please review the patch and suggest any improvements or raise concerns.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Given a has_many association defined with an :include option,
you can't use the #collection_singular_ids method because it fails
trying to eager load the 2nd level association when it's
unneeded.&lt;/p&gt;
&lt;p&gt;The attached patch includes a test case where you can see the
need for it.&lt;/p&gt;
&lt;p&gt;I'm not exactly happy with the patch because it involves adding
a new :ignore_include valid option to ActiveRecord::Base.find, but
I think I've read people requesting that kind of option too so
maybe this is something you may want too.&lt;/p&gt;
&lt;p&gt;Please review the patch and suggest any improvements or raise
concerns.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Given a has_many association defined with an :include option, you can't use the #collection_singular_ids method because it fails trying to eager load the 2nd level association when it's unneeded.

The attached patch includes a test case where you can see the need for it.

I'm not exactly happy with the patch because it involves adding a new :ignore_include valid option to ActiveRecord::Base.find, but I think I've read people requesting that kind of option too so maybe this is something you may want too.

Please review the patch and suggest any improvements or raise concerns.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Given a has_many association defined with an :include option,
you can't use the #collection_singular_ids method because it fails
trying to eager load the 2nd level association when it's
unneeded.&lt;/p&gt;
&lt;p&gt;The attached patch includes a test case where you can see the
need for it.&lt;/p&gt;
&lt;p&gt;I'm not exactly happy with the patch because it involves adding
a new :ignore_include valid option to ActiveRecord::Base.find, but
I think I've read people requesting that kind of option too so
maybe this is something you may want too.&lt;/p&gt;
&lt;p&gt;Please review the patch and suggest any improvements or raise
concerns.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-09T21:30:51+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2009-07-09T21:31:00+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">1</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-03T06:11:25+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:include activerecord eager_loading patch&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2009-08-03T06:11:28+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>verified

Updated just the tests from the patch to apply cleanly.

I think there should be a cleaner implementation - so I did not include the original one in the patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;verified&lt;/p&gt;
&lt;p&gt;Updated just the tests from the patch to apply cleanly.&lt;/p&gt;
&lt;p&gt;I think there should be a cleaner implementation - so I did not
include the original one in the patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-09T12:51:22+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2009-08-09T12:51:27+01:00</updated-at>
      <user-id type="integer">65618</user-id>
      <version type="integer">3</version>
      <user-name>dira</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I just ran into this bug. Asking for collection_singular_ids shouldn't try to load any include-ed associations.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just ran into this bug. Asking for collection_singular_ids
shouldn't try to load any include-ed associations.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-19T19:05:24+00:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2009-11-19T19:05:26+00:00</updated-at>
      <user-id type="integer">18278</user-id>
      <version type="integer">4</version>
      <user-name>Jason Roelofs</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/13645)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/13645&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-12T12:46:15+00:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:include activerecord bugmash eager_loading patch&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-02-12T12:46:15+00:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">5</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:53+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-04T18:48:53+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">6</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Can a bugmasher verify this errant behavior on master and supply an updated path?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can a bugmasher verify this errant behavior on master and supply
an updated path?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-09T19:18:28+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:include activerecord eager_loading patch&quot;
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-09T19:18:32+01:00</updated-at>
      <user-id type="integer">22242</user-id>
      <version type="integer">7</version>
      <user-name>Dan Pickett</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm attaching two separate patches in case the core team doesn't like my fix, or someone shows up with a better one (which is quite possible).

add_failing_singular_ids_with_include_test.diff is an updated version of the failing test needed to prove the bug.

fix_failing_singular_ids_with_include.diff is the patch to fix activerecord so that the previously added test, passes. It's VERY different from my original patch when creating this ticket as rails itself has changed a lot since then. I still think someone with better knowledge of activerecord's internals could do it better, but this one seems to be good enough (and I think less messy than the previous one).

Both apply cleanly on top of ce5827ea4791e8b8143919ecceb0231e36e8932e (master from may 9)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm attaching two separate patches in case the core team doesn't
like my fix, or someone shows up with a better one (which is quite
possible).&lt;/p&gt;
&lt;p&gt;add_failing_singular_ids_with_include_test.diff is an updated
version of the failing test needed to prove the bug.&lt;/p&gt;
&lt;p&gt;fix_failing_singular_ids_with_include.diff is the patch to fix
activerecord so that the previously added test, passes. It's VERY
different from my original patch when creating this ticket as rails
itself has changed a lot since then. I still think someone with
better knowledge of activerecord's internals could do it better,
but this one seems to be good enough (and I think less messy than
the previous one).&lt;/p&gt;
&lt;p&gt;Both apply cleanly on top of
ce5827ea4791e8b8143919ecceb0231e36e8932e (master from may 9)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-10T09:27:42+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-10T09:27:47+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">8</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I forgot to include one file in the test patch, So I'm attaching a new commit with the missing file.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I forgot to include one file in the test patch, So I'm attaching
a new commit with the missing file.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T00:36:37+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-11T00:36:38+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">9</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T00:47:47+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-11T00:47:48+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">10</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>The last patch looks much better than the first time, i ran the tests on latest version of master and so far so good. It seems a issue worth fixing.
+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;The last patch looks much better than the first time, i ran the
tests on latest version of master and so far so good. It seems a
issue worth fixing.&lt;br&gt;
+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T01:26:26+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-11T01:26:28+01:00</updated-at>
      <user-id type="integer">97543</user-id>
      <version type="integer">11</version>
      <user-name>Federico Brubacher</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>As there where too many patch files already, I deleted the ones which were mine and I'm submitting them merged in just 2 files.

 * 1-new_failing_test.diff adds a new test to demonstrate the bug.
 * 2-fix-bug.diff fixes the bug, gets the test to pass. Maybe someone can think of a better fix, but I think this one is good enough.</body>
      <body-html>&lt;div&gt;&lt;p&gt;As there where too many patch files already, I deleted the ones
which were mine and I'm submitting them merged in just 2 files.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1-new_failing_test.diff adds a new test to demonstrate the
bug.&lt;/li&gt;
&lt;li&gt;2-fix-bug.diff fixes the bug, gets the test to pass. Maybe
someone can think of a better fix, but I think this one is good
enough.&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T19:24:51+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-11T19:25:01+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">12</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Assigning to Pratik since he knows better about ActiveRecord.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Assigning to Pratik since he knows better about
ActiveRecord.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T15:35:01+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:tag: &quot;:include activerecord bugmash eager_loading patch&quot;
:assigned_user: 85
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>:include activerecord eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T15:35:02+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">13</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I've attached a patch.

As requested by rizwanreza on #railsbridge, I'm attaching a merged patch with both the test and the fix in just one commit. Rebased to latest master branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've attached a patch.&lt;/p&gt;
&lt;p&gt;As requested by rizwanreza on #railsbridge, I'm attaching a
merged patch with both the test and the fix in just one commit.
Rebased to latest master branch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T15:42:54+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:include activerecord eager_loading patch&quot;
:assigned_user: 1366
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T15:42:58+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">14</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Please use .except(:includes) instead.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Please use .except(:includes) instead.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T15:48:55+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T15:48:56+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">15</version>
      <user-name>Pratik</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T15:49:26+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 85
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T15:49:28+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">16</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I've attached a patch.

This new patch has a way much simpler test and fix. Thx Pratik for pointing me to the right direction as the old patch and fix were based on the initial work for rails 2.3</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've attached a patch.&lt;/p&gt;
&lt;p&gt;This new patch has a way much simpler test and fix. Thx Pratik
for pointing me to the right direction as the old patch and fix
were based on the initial work for rails 2.3&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T16:40:59+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T16:41:00+01:00</updated-at>
      <user-id type="integer">9698</user-id>
      <version type="integer">17</version>
      <user-name>Diego Algorta</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>(from [3436fdfc12d58925e3d981e0afa61084ea34736c]) Fix for get_ids when including a belongs_to association on a has_many association [#2896 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/3436fdfc12d58925e3d981e0afa61084ea34736c</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/3436fdfc12d58925e3d981e0afa61084ea34736c&quot;
title=
&quot;Changeset [3436fdfc12d58925e3d981e0afa61084ea34736c]&quot;&gt;[3436fdfc12d58925e3d981e0afa61084ea34736c]&lt;/a&gt;)
Fix for get_ids when including a belongs_to association on a
has_many association [&lt;a href=&quot;/projects/8994/tickets/2896&quot; title=
&quot;Ticket #2896&quot;&gt;#2896&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a&gt;pratiknaik@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/3436fdfc12d58925e3d981e0afa61084ea34736c&quot;&gt;
http://github.com/rails/rails/commit/3436fdfc12d58925e3d981e0afa610...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T16:59:13+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:state: verified
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>:include activerecord bugmash eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T16:59:15+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">18</version>
      <user-name>Repository</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T17:21:53+01:00</created-at>
      <creator-id type="integer">9698</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:include activerecord bugmash eager_loading patch&quot;
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2896</number>
      <permalink>collection_singular_ids-breaks-when-used-with-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>:include activerecord eager_loading patch</tag>
      <title>collection_singular_ids breaks when used with :include</title>
      <updated-at type="datetime">2010-05-15T17:21:54+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">19</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Diego Algorta</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2896</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>e1016f6190d4b7b7eddbf6380272badf5b45a544</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-08-09T12:51:22+01:00</created-at>
      <filename>singular_ids_tests.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">239335</id>
      <size type="integer">4803</size>
      <uploader-id type="integer">65618</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/239335/singular_ids_tests.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>4f1bb5bcb860651e60ed80ee0986f9990904b0c4</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-11T19:24:51+01:00</created-at>
      <filename>1-new_failing_test.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">517578</id>
      <size type="integer">5713</size>
      <uploader-id type="integer">9698</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/517578/1-new_failing_test.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>41f7e061cc52969987c2bdcc079b51d3da69098f</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-11T19:24:57+01:00</created-at>
      <filename>2-fix_bug.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">517579</id>
      <size type="integer">2857</size>
      <uploader-id type="integer">9698</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/517579/2-fix_bug.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>b18fbeafd173214ebe425cb0d785dbe7904bf036</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-15T15:42:55+01:00</created-at>
      <filename>merged_patch_fixing_singular_ids_with_include.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522611</id>
      <size type="integer">8262</size>
      <uploader-id type="integer">9698</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522611/merged_patch_fixing_singular_ids_with_include.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>29ff9b535d75a644b394e7c34c20476759d3d878</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-15T16:40:59+01:00</created-at>
      <filename>much_simpler_test_and_fix_leveraging_except_includes.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522633</id>
      <size type="integer">2683</size>
      <uploader-id type="integer">9698</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522633/much_simpler_test_and_fix_leveraging_except_includes.diff</url>
    </attachment>
  </attachments>
</ticket>
