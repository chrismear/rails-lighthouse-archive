<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-01-06T16:50:03+00:00</created-at>
  <creator-id type="integer">42716</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">1702</number>
  <permalink>atomic_write</permalink>
  <priority type="integer">1015</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activesupport patch</tag>
  <title>atomic_write </title>
  <updated-at type="datetime">2009-03-10T02:48:15+00:00</updated-at>
  <user-id type="integer">424</user-id>
  <version type="integer">4</version>
  <user-name>Joshua Peek</user-name>
  <creator-name>Tomas K.</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1702</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When I use :file_store, Rails application must have permission to write in 'public/' directory. If it doesn't have access to 'public/', cache files are created as temporary files - i.e. 'menu.cache.20222.0' instead of 'menu.cache'.

atomic_write creates (in some cases) a file /permissions_check.XXXXXXX to determine the default permissions. This file is created in the current directory. If the script hasn't permission to write in the current directory, it fails and the code, which renames temporary file (created by the atomic_write) and changes its permissions, isn't executed. 

The file .permission_check should be created in the same directory as the output file.

Note: It's my first report. If something is missing, let me know, I will add it.</original-body>
  <latest-body>When I use :file_store, Rails application must have permission to write in 'public/' directory. If it doesn't have access to 'public/', cache files are created as temporary files - i.e. 'menu.cache.20222.0' instead of 'menu.cache'.

atomic_write creates (in some cases) a file /permissions_check.XXXXXXX to determine the default permissions. This file is created in the current directory. If the script hasn't permission to write in the current directory, it fails and the code, which renames temporary file (created by the atomic_write) and changes its permissions, isn't executed. 

The file .permission_check should be created in the same directory as the output file.

Note: It's my first report. If something is missing, let me know, I will add it.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When I use :file_store, Rails application must have permission
to write in 'public/' directory. If it doesn't have access to
'public/', cache files are created as temporary files - i.e.
'menu.cache.20222.0' instead of 'menu.cache'.&lt;/p&gt;
&lt;p&gt;atomic_write creates (in some cases) a file
/permissions_check.XXXXXXX to determine the default permissions.
This file is created in the current directory. If the script hasn't
permission to write in the current directory, it fails and the
code, which renames temporary file (created by the atomic_write)
and changes its permissions, isn't executed.&lt;/p&gt;
&lt;p&gt;The file .permission_check should be created in the same
directory as the output file.&lt;/p&gt;
&lt;p&gt;Note: It's my first report. If something is missing, let me
know, I will add it.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When I use :file_store, Rails application must have permission to write in 'public/' directory. If it doesn't have access to 'public/', cache files are created as temporary files - i.e. 'menu.cache.20222.0' instead of 'menu.cache'.

atomic_write creates (in some cases) a file /permissions_check.XXXXXXX to determine the default permissions. This file is created in the current directory. If the script hasn't permission to write in the current directory, it fails and the code, which renames temporary file (created by the atomic_write) and changes its permissions, isn't executed. 

The file .permission_check should be created in the same directory as the output file.

Note: It's my first report. If something is missing, let me know, I will add it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;When I use :file_store, Rails application must have permission
to write in 'public/' directory. If it doesn't have access to
'public/', cache files are created as temporary files - i.e.
'menu.cache.20222.0' instead of 'menu.cache'.&lt;/p&gt;
&lt;p&gt;atomic_write creates (in some cases) a file
/permissions_check.XXXXXXX to determine the default permissions.
This file is created in the current directory. If the script hasn't
permission to write in the current directory, it fails and the
code, which renames temporary file (created by the atomic_write)
and changes its permissions, isn't executed.&lt;/p&gt;
&lt;p&gt;The file .permission_check should be created in the same
directory as the output file.&lt;/p&gt;
&lt;p&gt;Note: It's my first report. If something is missing, let me
know, I will add it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-06T16:50:03+00:00</created-at>
      <creator-id type="integer">42716</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1702</number>
      <permalink>atomic_write</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport</tag>
      <title>atomic_write </title>
      <updated-at type="datetime">2009-01-06T16:50:07+00:00</updated-at>
      <user-id type="integer">42716</user-id>
      <version type="integer">1</version>
      <user-name>Tomas K.</user-name>
      <creator-name>Tomas K.</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1702</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-27T10:08:22+00:00</created-at>
      <creator-id type="integer">42716</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1702</number>
      <permalink>atomic_write</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport</tag>
      <title>atomic_write </title>
      <updated-at type="datetime">2009-01-27T10:08:26+00:00</updated-at>
      <user-id type="integer">10656</user-id>
      <version type="integer">2</version>
      <user-name>joost baaij</user-name>
      <creator-name>Tomas K.</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1702</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-08T15:18:19+00:00</created-at>
      <creator-id type="integer">42716</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1702</number>
      <permalink>atomic_write</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport patch</tag>
      <title>atomic_write </title>
      <updated-at type="datetime">2009-03-08T15:18:24+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Tomas K.</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1702</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looks like this fix was already applied.

@@@ ruby
          begin
            # Get original file permissions
            old_stat = stat(file_name)
          rescue Errno::ENOENT
            # No old permissions, write a temp file to determine the defaults
            check_name = join(dirname(file_name), &quot;.permissions_check.#{Thread.current.object_id}.#{Process.pid}.#{rand(1000000)}&quot;)
            open(check_name, &quot;w&quot;) { }
            old_stat = stat(check_name)
            unlink(check_name)
          end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks like this fix was already applied.&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
          begin
            # Get original file permissions
            old_stat = stat(file_name)
          rescue Errno::ENOENT
            # No old permissions, write a temp file to determine the defaults
            check_name = join(dirname(file_name), &amp;quot;.permissions_check.#{Thread.current.object_id}.#{Process.pid}.#{rand(1000000)}&amp;quot;)
            open(check_name, &amp;quot;w&amp;quot;) { }
            old_stat = stat(check_name)
            unlink(check_name)
          end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-10T02:48:09+00:00</created-at>
      <creator-id type="integer">42716</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1702</number>
      <permalink>atomic_write</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport patch</tag>
      <title>atomic_write </title>
      <updated-at type="datetime">2009-03-10T02:48:15+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">4</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Tomas K.</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1702</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>b5edcfa1c6f4613bdc274e6fbf1242d486b3a9b9</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-01-06T16:50:04+00:00</created-at>
      <filename>atomic_permission_file_dir.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">75769</id>
      <size type="integer">1179</size>
      <uploader-id type="integer">42716</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/75769/atomic_permission_file_dir.diff</url>
    </attachment>
  </attachments>
</ticket>
