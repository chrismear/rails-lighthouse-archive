<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-17T01:58:28+00:00</created-at>
  <creator-id type="integer">48151</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">3744</number>
  <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag nil="true"></tag>
  <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
  <updated-at type="datetime">2011-04-30T01:01:12+01:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">22</version>
  <user-name>rails</user-name>
  <creator-name>Andrew Williams</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
  <milestone-title>3.x</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>in encoding.rb line 68:

raise CircularReferenceError, 'object references itself' if seen.include?(value)

I think this should read something like:

raise CircularReferenceError, 'object references itself' if seen.detect { |i| value.equal?(i) }

i.e. it should test for equality at the object level, rather than via the ==() method (which is occassionally overidden, and can erroneously trigger the CircularReferenceError).</original-body>
  <latest-body>in encoding.rb line 68:

raise CircularReferenceError, 'object references itself' if seen.include?(value)

I think this should read something like:

raise CircularReferenceError, 'object references itself' if seen.detect { |i| value.equal?(i) }

i.e. it should test for equality at the object level, rather than via the ==() method (which is occassionally overidden, and can erroneously trigger the CircularReferenceError).</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;in encoding.rb line 68:&lt;/p&gt;
&lt;p&gt;raise CircularReferenceError, 'object references itself' if
seen.include?(value)&lt;/p&gt;
&lt;p&gt;I think this should read something like:&lt;/p&gt;
&lt;p&gt;raise CircularReferenceError, 'object references itself' if
seen.detect { |i| value.equal?(i) }&lt;/p&gt;
&lt;p&gt;i.e. it should test for equality at the object level, rather
than via the ==() method (which is occassionally overidden, and can
erroneously trigger the CircularReferenceError).&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>in encoding.rb line 68:

raise CircularReferenceError, 'object references itself' if seen.include?(value)

I think this should read something like:

raise CircularReferenceError, 'object references itself' if seen.detect { |i| value.equal?(i) }

i.e. it should test for equality at the object level, rather than via the ==() method (which is occassionally overidden, and can erroneously trigger the CircularReferenceError).</body>
      <body-html>&lt;div&gt;&lt;p&gt;in encoding.rb line 68:&lt;/p&gt;
&lt;p&gt;raise CircularReferenceError, 'object references itself' if
seen.include?(value)&lt;/p&gt;
&lt;p&gt;I think this should read something like:&lt;/p&gt;
&lt;p&gt;raise CircularReferenceError, 'object references itself' if
seen.detect { |i| value.equal?(i) }&lt;/p&gt;
&lt;p&gt;i.e. it should test for equality at the object level, rather
than via the ==() method (which is occassionally overidden, and can
erroneously trigger the CircularReferenceError).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-19T03:40:08+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-01-19T03:40:09+00:00</updated-at>
      <user-id type="integer">48151</user-id>
      <version type="integer">1</version>
      <user-name>Andrew Williams</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can verify this problem as well. Having 2 datetime types in the json output causes this failure as well.
I used the described patch above to get around this problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can verify this problem as well. Having 2 datetime types in
the json output causes this failure as well.&lt;br&gt;
I used the described patch above to get around this problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-02T23:07:30+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-03-02T23:07:34+00:00</updated-at>
      <user-id type="integer">9988</user-id>
      <version type="integer">2</version>
      <user-name>Sean Wolfe</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can verify this as well.  This patch suppressed the error at least.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can verify this as well. This patch suppressed the error at
least.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-05T00:11:22+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-04-05T00:11:26+01:00</updated-at>
      <user-id type="integer">93436</user-id>
      <version type="integer">3</version>
      <user-name>testman</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Patch and test welcome!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Patch and test welcome!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-05T03:04:52+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-04-05T03:04:55+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">4</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-05T03:05:03+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-04-05T03:05:06+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">5</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This can be closed, the line currently reads (as suggested above as patch) :

@@@ ruby
   if @seen.any? { |object| object.equal?(value) }
@@@

&lt;em&gt;Edited by Rohit Arondekar for formating.&lt;/em&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;This can be closed, the line currently reads (as suggested above
as patch) :&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;   if @seen.any? { |object| object.equal?(value) }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;Edited by Rohit Arondekar for formating.&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T11:56:25+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-07-01T08:33:31+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">6</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can be closed. See above.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can be closed. See above.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T08:31:23+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:assigned_user: 85
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-07-01T08:31:32+01:00</updated-at>
      <user-id type="integer">65050</user-id>
      <version type="integer">7</version>
      <user-name>David Trasbo</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-01T08:33:56+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;json activesupport circularreferenceerror&quot;</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-07-01T08:34:03+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">8</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This hasn't been fixed. I still see an issue here:

    ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:57:in `check_for_circular_references'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:45:in `encode'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `block in encode_json'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `each'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `map'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `encode_json'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:46:in `block in encode'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:60:in `check_for_circular_references'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:45:in `encode'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:30:in `encode'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/core_ext/object/to_json.rb:20:in `to_json'
	from (irb):10
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands/console.rb:44:in `start'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands/console.rb:8:in `start'
	from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands.rb:23:in `&lt;top (required)&gt;'
	from script/rails:6:in `require'
	from script/rails:6:in `&lt;main&gt;'</body>
      <body-html>&lt;div&gt;&lt;p&gt;This hasn't been fixed. I still see an issue here:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:57:in `check_for_circular_references'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:45:in `encode'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `block in encode_json'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `each'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `map'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:209:in `encode_json'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:46:in `block in encode'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:60:in `check_for_circular_references'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:45:in `encode'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/json/encoding.rb:30:in `encode'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/activesupport/lib/active_support/core_ext/object/to_json.rb:20:in `to_json'
from (irb):10
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands/console.rb:44:in `start'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands/console.rb:8:in `start'
from /Users/jdelsman/.rvm/gems/ruby-1.9.2-rc2/bundler/gems/rails-b378b19/railties/lib/rails/commands.rb:23:in `&amp;lt;top (required)&amp;gt;'
from script/rails:6:in `require'
from script/rails:6:in `&amp;lt;main&amp;gt;'&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-23T06:10:14+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;json activesupport circularreferenceerror\&quot;&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport circularreferenceerror json</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-07-23T06:10:16+01:00</updated-at>
      <user-id type="integer">27299</user-id>
      <version type="integer">9</version>
      <user-name>Josh Delsman</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Yes, this does not appear to be fixed in Rails3 beta4.  I have a date field and am trying to use to_json with no success.

&lt;code&gt;
ruby-1.8.7-p249 &gt; PayPeriod
 =&gt; PayPeriod(id: integer, start_date: date, end_date: date, pay_date: date) 

ruby-1.8.7-p249 &gt; PayPeriod.limit(1) =&gt; [#&lt;PayPeriod id: 1, start_date: &quot;2010-06-01&quot;, end_date: &quot;2010-06-15&quot;, pay_date: &quot;2010-06-29&quot;&gt;] 

ruby-1.8.7-p249 &gt; PayPeriod.limit(1).to_json
ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself
	from /Users/wprater/.rvm/gems/ruby-1.8.7-p249/gems/activesupport-3.0.0.beta4/lib/active_support/json/encoding.rb:59:in `check_for_circular_references'

&lt;/code&gt;

Any ideas for a temporary fix?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, this does not appear to be fixed in Rails3 beta4. I have a
date field and am trying to use to_json with no success.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;br&gt;
ruby-1.8.7-p249 &amp;gt; PayPeriod&lt;br&gt;
=&amp;gt; PayPeriod(id: integer, start_date: date, end_date: date,
pay_date: date)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ruby-1.8.7-p249 &amp;gt; PayPeriod.limit(1) =&amp;gt; [#]&lt;/p&gt;
&lt;p&gt;ruby-1.8.7-p249 &amp;gt; PayPeriod.limit(1).to_json&lt;br&gt;
ActiveSupport::JSON::Encoding::CircularReferenceError: object
references itself&lt;br&gt;&lt;/p&gt;
{mkd-extraction-bd47fe22ed55c8d20a7d00c63404312e}
&lt;p&gt;Any ideas for a temporary fix?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-01T23:21:53+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport circularreferenceerror json</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-08-01T23:21:57+01:00</updated-at>
      <user-id type="integer">1444</user-id>
      <version type="integer">10</version>
      <user-name>Will Prater</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Getting this error still in Rails 3.0.0:

@@@
ActiveSupport::JSON::Encoding::CircularReferenceError in SearchesController#new
object references itself

activesupport (3.0.0) lib/active_support/json/encoding.rb:57:in `check_for_circular_references'
activesupport (3.0.0) lib/active_support/json/encoding.rb:45:in `encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `block in encode_json'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `each'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `map'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `encode_json'
activesupport (3.0.0) lib/active_support/json/encoding.rb:46:in `block in encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:60:in `check_for_circular_references'
activesupport (3.0.0) lib/active_support/json/encoding.rb:45:in `encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:30:in `encode'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:74:in `block in &lt;module:Renderers&gt;'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:32:in `_handle_render_options'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:47:in `render_to_body'
actionpack (3.0.0) lib/action_controller/metal/compatibility.rb:55:in `render_to_body'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:101:in `render_to_string'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:92:in `render'
actionpack (3.0.0) lib/action_controller/metal/rendering.rb:17:in `render'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:40:in `block (2 levels) in render'
activesupport (3.0.0) lib/active_support/core_ext/benchmark.rb:5:in `block in ms'
/home/throlkim/.rvm/rubies/ruby-1.9.2-p0/lib/ruby/1.9.1/benchmark.rb:309:in `realtime'
activesupport (3.0.0) lib/active_support/core_ext/benchmark.rb:5:in `ms'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:40:in `block in render'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:78:in `cleanup_view_runtime'
activerecord (3.0.0) lib/active_record/railties/controller_runtime.rb:15:in `cleanup_view_runtime'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:39:in `render'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:209:in `display'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:159:in `api_behavior'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:138:in `rescue in to_format'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:136:in `to_format'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:119:in `respond'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:112:in `call'
actionpack (3.0.0) lib/action_controller/metal/mime_responds.rb:232:in `respond_with'
actionpack (3.0.0) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
actionpack (3.0.0) lib/abstract_controller/base.rb:150:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/rendering.rb:11:in `process_action'
actionpack (3.0.0) lib/abstract_controller/callbacks.rb:18:in `block in process_action'
activesupport (3.0.0) lib/active_support/callbacks.rb:435:in `_run__29503673__process_action__515564314__callbacks'
activesupport (3.0.0) lib/active_support/callbacks.rb:409:in `_run_process_action_callbacks'
activesupport (3.0.0) lib/active_support/callbacks.rb:93:in `run_callbacks'
actionpack (3.0.0) lib/abstract_controller/callbacks.rb:17:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:30:in `block in process_action'
activesupport (3.0.0) lib/active_support/notifications.rb:52:in `block in instrument'
activesupport (3.0.0) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (3.0.0) lib/active_support/notifications.rb:52:in `instrument'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:29:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/rescue.rb:17:in `process_action'
actionpack (3.0.0) lib/abstract_controller/base.rb:119:in `process'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:40:in `process'
actionpack (3.0.0) lib/action_controller/metal.rb:133:in `dispatch'
actionpack (3.0.0) lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'
actionpack (3.0.0) lib/action_controller/metal.rb:173:in `block in action'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:62:in `call'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:62:in `dispatch'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:27:in `call'
rack-mount (0.6.13) lib/rack/mount/route_set.rb:148:in `block in call'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:93:in `block in recognize'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:75:in `optimized_each'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:92:in `recognize'
rack-mount (0.6.13) lib/rack/mount/route_set.rb:139:in `call'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:492:in `call'
haml (3.0.21) lib/sass/plugin/rack.rb:41:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/best_standards_support.rb:17:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/head.rb:14:in `call'
rack (1.2.1) lib/rack/methodoverride.rb:24:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/params_parser.rb:21:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/flash.rb:182:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/cookies.rb:287:in `call'
activerecord (3.0.0) lib/active_record/query_cache.rb:32:in `block in call'
activerecord (3.0.0) lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'
activerecord (3.0.0) lib/active_record/query_cache.rb:12:in `cache'
activerecord (3.0.0) lib/active_record/query_cache.rb:31:in `call'
activerecord (3.0.0) lib/active_record/connection_adapters/abstract/connection_pool.rb:355:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/callbacks.rb:46:in `block in call'
activesupport (3.0.0) lib/active_support/callbacks.rb:415:in `_run_call_callbacks'
actionpack (3.0.0) lib/action_dispatch/middleware/callbacks.rb:44:in `call'
rack (1.2.1) lib/rack/sendfile.rb:107:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/remote_ip.rb:48:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/show_exceptions.rb:46:in `call'
railties (3.0.0) lib/rails/rack/logger.rb:13:in `call'
rack (1.2.1) lib/rack/runtime.rb:17:in `call'
activesupport (3.0.0) lib/active_support/cache/strategy/local_cache.rb:72:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `block in call'
&lt;internal:prelude&gt;:10:in `synchronize'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/static.rb:30:in `call'
railties (3.0.0) lib/rails/application.rb:168:in `call'
railties (3.0.0) lib/rails/application.rb:77:in `method_missing'
railties (3.0.0) lib/rails/rack/log_tailer.rb:14:in `call'
rack (1.2.1) lib/rack/content_length.rb:13:in `call'
rack (1.2.1) lib/rack/chunked.rb:15:in `call'
rack (1.2.1) lib/rack/handler/mongrel.rb:67:in `process'
mongrel (1.2.0.pre2) lib/mongrel.rb:165:in `block in process_client'
mongrel (1.2.0.pre2) lib/mongrel.rb:164:in `each'
mongrel (1.2.0.pre2) lib/mongrel.rb:164:in `process_client'
mongrel (1.2.0.pre2) lib/mongrel.rb:291:in `block (2 levels) in run'

@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Getting this error still in Rails 3.0.0:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActiveSupport::JSON::Encoding::CircularReferenceError in SearchesController#new
object references itself

activesupport (3.0.0) lib/active_support/json/encoding.rb:57:in `check_for_circular_references'
activesupport (3.0.0) lib/active_support/json/encoding.rb:45:in `encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `block in encode_json'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `each'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `map'
activesupport (3.0.0) lib/active_support/json/encoding.rb:209:in `encode_json'
activesupport (3.0.0) lib/active_support/json/encoding.rb:46:in `block in encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:60:in `check_for_circular_references'
activesupport (3.0.0) lib/active_support/json/encoding.rb:45:in `encode'
activesupport (3.0.0) lib/active_support/json/encoding.rb:30:in `encode'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:74:in `block in &amp;lt;module:Renderers&amp;gt;'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:32:in `_handle_render_options'
actionpack (3.0.0) lib/action_controller/metal/renderers.rb:47:in `render_to_body'
actionpack (3.0.0) lib/action_controller/metal/compatibility.rb:55:in `render_to_body'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:101:in `render_to_string'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:92:in `render'
actionpack (3.0.0) lib/action_controller/metal/rendering.rb:17:in `render'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:40:in `block (2 levels) in render'
activesupport (3.0.0) lib/active_support/core_ext/benchmark.rb:5:in `block in ms'
/home/throlkim/.rvm/rubies/ruby-1.9.2-p0/lib/ruby/1.9.1/benchmark.rb:309:in `realtime'
activesupport (3.0.0) lib/active_support/core_ext/benchmark.rb:5:in `ms'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:40:in `block in render'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:78:in `cleanup_view_runtime'
activerecord (3.0.0) lib/active_record/railties/controller_runtime.rb:15:in `cleanup_view_runtime'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:39:in `render'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:209:in `display'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:159:in `api_behavior'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:138:in `rescue in to_format'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:136:in `to_format'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:119:in `respond'
actionpack (3.0.0) lib/action_controller/metal/responder.rb:112:in `call'
actionpack (3.0.0) lib/action_controller/metal/mime_responds.rb:232:in `respond_with'
actionpack (3.0.0) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
actionpack (3.0.0) lib/abstract_controller/base.rb:150:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/rendering.rb:11:in `process_action'
actionpack (3.0.0) lib/abstract_controller/callbacks.rb:18:in `block in process_action'
activesupport (3.0.0) lib/active_support/callbacks.rb:435:in `_run__29503673__process_action__515564314__callbacks'
activesupport (3.0.0) lib/active_support/callbacks.rb:409:in `_run_process_action_callbacks'
activesupport (3.0.0) lib/active_support/callbacks.rb:93:in `run_callbacks'
actionpack (3.0.0) lib/abstract_controller/callbacks.rb:17:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:30:in `block in process_action'
activesupport (3.0.0) lib/active_support/notifications.rb:52:in `block in instrument'
activesupport (3.0.0) lib/active_support/notifications/instrumenter.rb:21:in `instrument'
activesupport (3.0.0) lib/active_support/notifications.rb:52:in `instrument'
actionpack (3.0.0) lib/action_controller/metal/instrumentation.rb:29:in `process_action'
actionpack (3.0.0) lib/action_controller/metal/rescue.rb:17:in `process_action'
actionpack (3.0.0) lib/abstract_controller/base.rb:119:in `process'
actionpack (3.0.0) lib/abstract_controller/rendering.rb:40:in `process'
actionpack (3.0.0) lib/action_controller/metal.rb:133:in `dispatch'
actionpack (3.0.0) lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'
actionpack (3.0.0) lib/action_controller/metal.rb:173:in `block in action'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:62:in `call'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:62:in `dispatch'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:27:in `call'
rack-mount (0.6.13) lib/rack/mount/route_set.rb:148:in `block in call'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:93:in `block in recognize'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:75:in `optimized_each'
rack-mount (0.6.13) lib/rack/mount/code_generation.rb:92:in `recognize'
rack-mount (0.6.13) lib/rack/mount/route_set.rb:139:in `call'
actionpack (3.0.0) lib/action_dispatch/routing/route_set.rb:492:in `call'
haml (3.0.21) lib/sass/plugin/rack.rb:41:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/best_standards_support.rb:17:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/head.rb:14:in `call'
rack (1.2.1) lib/rack/methodoverride.rb:24:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/params_parser.rb:21:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/flash.rb:182:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/session/abstract_store.rb:149:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/cookies.rb:287:in `call'
activerecord (3.0.0) lib/active_record/query_cache.rb:32:in `block in call'
activerecord (3.0.0) lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'
activerecord (3.0.0) lib/active_record/query_cache.rb:12:in `cache'
activerecord (3.0.0) lib/active_record/query_cache.rb:31:in `call'
activerecord (3.0.0) lib/active_record/connection_adapters/abstract/connection_pool.rb:355:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/callbacks.rb:46:in `block in call'
activesupport (3.0.0) lib/active_support/callbacks.rb:415:in `_run_call_callbacks'
actionpack (3.0.0) lib/action_dispatch/middleware/callbacks.rb:44:in `call'
rack (1.2.1) lib/rack/sendfile.rb:107:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/remote_ip.rb:48:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/show_exceptions.rb:46:in `call'
railties (3.0.0) lib/rails/rack/logger.rb:13:in `call'
rack (1.2.1) lib/rack/runtime.rb:17:in `call'
activesupport (3.0.0) lib/active_support/cache/strategy/local_cache.rb:72:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `block in call'
&amp;lt;internal:prelude&amp;gt;:10:in `synchronize'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
actionpack (3.0.0) lib/action_dispatch/middleware/static.rb:30:in `call'
railties (3.0.0) lib/rails/application.rb:168:in `call'
railties (3.0.0) lib/rails/application.rb:77:in `method_missing'
railties (3.0.0) lib/rails/rack/log_tailer.rb:14:in `call'
rack (1.2.1) lib/rack/content_length.rb:13:in `call'
rack (1.2.1) lib/rack/chunked.rb:15:in `call'
rack (1.2.1) lib/rack/handler/mongrel.rb:67:in `process'
mongrel (1.2.0.pre2) lib/mongrel.rb:165:in `block in process_client'
mongrel (1.2.0.pre2) lib/mongrel.rb:164:in `each'
mongrel (1.2.0.pre2) lib/mongrel.rb:164:in `process_client'
mongrel (1.2.0.pre2) lib/mongrel.rb:291:in `block (2 levels) in run'&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-14T10:40:11+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport circularreferenceerror json</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-10-14T10:40:13+01:00</updated-at>
      <user-id type="integer">102680</user-id>
      <version type="integer">11</version>
      <user-name>Throlkim</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Could one of you please write a patch with tests. Contributor guide can be found here &amp;mdash; http://rails.lighthouseapp.com/projects/8994/sending-patches

Also I apologize for not taking a look at this earlier.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could one of you please write a patch with tests. Contributor
guide can be found here &amp;mdash; &lt;a href=
&quot;http://rails.lighthouseapp.com/projects/8994/sending-patches&quot;&gt;http://rails.lighthouseapp.com/projects/8994/sending-patches&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Also I apologize for not taking a look at this earlier.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-14T10:48:25+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport circularreferenceerror json</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-10-14T10:48:26+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">12</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:40+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport circularreferenceerror json</tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-10-15T23:01:40+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">13</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T08:33:55+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport circularreferenceerror json
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-10-19T08:33:58+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">15</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Will Prater: I am not able to reproduce it with rails edge. Can you show me your model, migration and the data to reproduce this problem.

@@@ ruby
ree-1.8.7-2010.02 &gt; Car.first.to_json
  Car Load (0.2ms)  SELECT &quot;cars&quot;.* FROM &quot;cars&quot; LIMIT 1
 =&gt; &quot;{\&quot;car\&quot;:{\&quot;name\&quot;:\&quot;honda\&quot;,\&quot;manufactured_at\&quot;:\&quot;2010-11-15T21:05:00Z\&quot;,\&quot;color\&quot;:null,\&quot;id\&quot;:1}}&quot; 
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Will Prater: I am not able to reproduce it with rails edge. Can
you show me your model, migration and the data to reproduce this
problem.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;ree-1.8.7-2010.02 &amp;gt; Car.first.to_json
  Car Load (0.2ms)  SELECT &quot;cars&quot;.* FROM &quot;cars&quot; LIMIT 1
 =&amp;gt; &quot;{\&quot;car\&quot;:{\&quot;name\&quot;:\&quot;honda\&quot;,\&quot;manufactured_at\&quot;:\&quot;2010-11-15T21:05:00Z\&quot;,\&quot;color\&quot;:null,\&quot;id\&quot;:1}}&quot;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:06:29+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-11-15T21:06:32+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">16</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>00zoe
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT shoes&lt;/strong&gt;&lt;/a&gt;, Galin ang Na. 
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland Boots Sale&lt;/strong&gt;&lt;/a&gt;, insulated boot and set. 
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face jacket&lt;/strong&gt;&lt;/a&gt;, have been the. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland boots&lt;/strong&gt;&lt;/a&gt;, &#32463;&#20856;1956. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;ugg boots sale&lt;/strong&gt;&lt;/a&gt;, qkl000. 
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland&lt;/strong&gt;&lt;/a&gt;, &#35199;&#38376;&#21561;&#38634;. 
&lt;a href=&quot;http://www.mbtclearance.org/&quot;&gt;&lt;strong&gt;MBT shoes clearance&lt;/strong&gt;&lt;/a&gt;, styles, sizes. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT shoes&lt;/strong&gt;&lt;/a&gt;, Galin ang Na. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT trainers&lt;/strong&gt;&lt;/a&gt;, boots sale online. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;cheap ugg boots uk&lt;/strong&gt;&lt;/a&gt;, making cutprice. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;&lt;strong&gt;ugg handbags uk&lt;/strong&gt;&lt;/a&gt;, have not looked back.. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;&lt;strong&gt;cheap ugg handbags&lt;/strong&gt;&lt;/a&gt;, The result was the. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT lami shoes&lt;/strong&gt;&lt;/a&gt;, We have a long term. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT tunisha&lt;/strong&gt;&lt;/a&gt;, cooperative manufacturer. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland boots sale&lt;/strong&gt;&lt;/a&gt;, The source of. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk/ugg-boots-sale-gissella-c-18.html&quot;&gt;&lt;strong&gt;ugg gissella&lt;/strong&gt;&lt;/a&gt;, &#24680;&#22312;&#20170;&#22825;&#25165;&#30456;&#36935;. 
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face outlet&lt;/strong&gt;&lt;/a&gt;, now timberland boots. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland roll top&lt;/strong&gt;&lt;/a&gt;, footwear. They. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland chukka&lt;/strong&gt;&lt;/a&gt;, &#31505;&#19977;&#23569;. 
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Cheap Timberland Boots&lt;/strong&gt;&lt;/a&gt;, &#21326;&#20180; a subsidiary. 
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Waterproof Boots&lt;/strong&gt;&lt;/a&gt;, Timberland. By 1978 more. 
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland Boots&lt;/strong&gt;&lt;/a&gt;, &#21338;&#23458;. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT UK&lt;/strong&gt;&lt;/a&gt;, Nothing to worry. 
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland UK&lt;/strong&gt;&lt;/a&gt;, ak11-. 
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland outlet&lt;/strong&gt;&lt;/a&gt;, myaifeili. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;ugg boots sale uk&lt;/strong&gt;&lt;/a&gt;, asisi. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;cheap ugg boots&lt;/strong&gt;&lt;/a&gt;, mercury. 
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland Boots UK&lt;/strong&gt;&lt;/a&gt;, to produce it, under. 
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland Boots&lt;/strong&gt;&lt;/a&gt;, &#22914;&#26085; the brand name. 
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Cheap Timberland Boots&lt;/strong&gt;&lt;/a&gt;, ak22-. 
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;&lt;strong&gt;ugg handbags sale&lt;/strong&gt;&lt;/a&gt;, dry in Timberlands. And. 
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face boots sale&lt;/strong&gt;&lt;/a&gt;, on the Internet.. 
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face jacket sale&lt;/strong&gt;&lt;/a&gt;, in a river, and your. 
&lt;a href=&quot;http://www.bootsue.com/mbt-shoes-clearance-sale-c-5.html&quot;&gt;&lt;strong&gt;MBT shoes clearance&lt;/strong&gt;&lt;/a&gt;, can steadily. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT shoes UK&lt;/strong&gt;&lt;/a&gt;, &#28023;&#23376; 1990. 
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT sale&lt;/strong&gt;&lt;/a&gt;, about, you could. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;cheap timberland boots&lt;/strong&gt;&lt;/a&gt;, timberland is. 
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberlands&lt;/strong&gt;&lt;/a&gt;, an offshoot.</body>
      <body-html>&lt;div&gt;&lt;p&gt;00zoe&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
shoes&lt;/strong&gt;&lt;/a&gt;, Galin ang Na.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
Boots Sale&lt;/strong&gt;&lt;/a&gt;, insulated boot and set.&lt;br&gt;
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face
jacket&lt;/strong&gt;&lt;/a&gt;, have been the.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland
boots&lt;/strong&gt;&lt;/a&gt;, &amp;#32463;&amp;#20856;1956.&lt;br&gt;
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;ugg boots
sale&lt;/strong&gt;&lt;/a&gt;, qkl000.&lt;br&gt;
&lt;a href=
&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland&lt;/strong&gt;&lt;/a&gt;,
&amp;#35199;&amp;#38376;&amp;#21561;&amp;#38634;.&lt;br&gt;
&lt;a href=&quot;http://www.mbtclearance.org/&quot;&gt;&lt;strong&gt;MBT shoes
clearance&lt;/strong&gt;&lt;/a&gt;, styles, sizes.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
shoes&lt;/strong&gt;&lt;/a&gt;, Galin ang Na.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
trainers&lt;/strong&gt;&lt;/a&gt;, boots sale online.&lt;br&gt;
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;cheap ugg
boots uk&lt;/strong&gt;&lt;/a&gt;, making cutprice.&lt;br&gt;
&lt;a href=
&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;
&lt;strong&gt;ugg handbags uk&lt;/strong&gt;&lt;/a&gt;, have not looked back..&lt;br&gt;
&lt;a href=
&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;
&lt;strong&gt;cheap ugg handbags&lt;/strong&gt;&lt;/a&gt;, The result was the.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT lami
shoes&lt;/strong&gt;&lt;/a&gt;, We have a long term.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
tunisha&lt;/strong&gt;&lt;/a&gt;, cooperative manufacturer.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland
boots sale&lt;/strong&gt;&lt;/a&gt;, The source of.&lt;br&gt;
&lt;a href=
&quot;http://www.cheapuggbootssale.co.uk/ugg-boots-sale-gissella-c-18.html&quot;&gt;
&lt;strong&gt;ugg gissella&lt;/strong&gt;&lt;/a&gt;,
&amp;#24680;&amp;#22312;&amp;#20170;&amp;#22825;&amp;#25165;&amp;#30456;&amp;#36935;.&lt;br&gt;
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face
outlet&lt;/strong&gt;&lt;/a&gt;, now timberland boots.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland
roll top&lt;/strong&gt;&lt;/a&gt;, footwear. They.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberland
chukka&lt;/strong&gt;&lt;/a&gt;, &amp;#31505;&amp;#19977;&amp;#23569;.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Cheap
Timberland Boots&lt;/strong&gt;&lt;/a&gt;, &amp;#21326;&amp;#20180; a subsidiary.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Waterproof
Boots&lt;/strong&gt;&lt;/a&gt;, Timberland. By 1978 more.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
Boots&lt;/strong&gt;&lt;/a&gt;, &amp;#21338;&amp;#23458;.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
UK&lt;/strong&gt;&lt;/a&gt;, Nothing to worry.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
UK&lt;/strong&gt;&lt;/a&gt;, ak11-.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
outlet&lt;/strong&gt;&lt;/a&gt;, myaifeili.&lt;br&gt;
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;ugg boots sale
uk&lt;/strong&gt;&lt;/a&gt;, asisi.&lt;br&gt;
&lt;a href=&quot;http://www.cheapuggbootssale.co.uk&quot;&gt;&lt;strong&gt;cheap ugg
boots&lt;/strong&gt;&lt;/a&gt;, mercury.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
Boots UK&lt;/strong&gt;&lt;/a&gt;, to produce it, under.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots4sale.co.uk&quot;&gt;&lt;strong&gt;Timberland
Boots&lt;/strong&gt;&lt;/a&gt;, &amp;#22914;&amp;#26085; the brand name.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandboots2sale.co.uk&quot;&gt;&lt;strong&gt;Cheap
Timberland Boots&lt;/strong&gt;&lt;/a&gt;, ak22-.&lt;br&gt;
&lt;a href=
&quot;http://www.cheapuggbootssale.co.uk/cheap-ugg-handbags-uk-c-23.html&quot;&gt;
&lt;strong&gt;ugg handbags sale&lt;/strong&gt;&lt;/a&gt;, dry in Timberlands.
And.&lt;br&gt;
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face
boots sale&lt;/strong&gt;&lt;/a&gt;, on the Internet..&lt;br&gt;
&lt;a href=&quot;http://www.thenorthfaceoutlet.co.uk&quot;&gt;&lt;strong&gt;north face
jacket sale&lt;/strong&gt;&lt;/a&gt;, in a river, and your.&lt;br&gt;
&lt;a href=
&quot;http://www.bootsue.com/mbt-shoes-clearance-sale-c-5.html&quot;&gt;&lt;strong&gt;MBT
shoes clearance&lt;/strong&gt;&lt;/a&gt;, can steadily.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT shoes
UK&lt;/strong&gt;&lt;/a&gt;, &amp;#28023;&amp;#23376; 1990.&lt;br&gt;
&lt;a href=&quot;http://www.mbtshoes4sale.co.uk&quot;&gt;&lt;strong&gt;MBT
sale&lt;/strong&gt;&lt;/a&gt;, about, you could.&lt;br&gt;
&lt;a href=&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;cheap
timberland boots&lt;/strong&gt;&lt;/a&gt;, timberland is.&lt;br&gt;
&lt;a href=
&quot;http://www.timberlandbootsale.co.uk&quot;&gt;&lt;strong&gt;Timberlands&lt;/strong&gt;&lt;/a&gt;,
an offshoot.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-17T01:54:59+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-11-17T01:58:28+00:00</updated-at>
      <user-id type="integer">125438</user-id>
      <version type="integer">17</version>
      <user-name>zoery</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">89656</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am only able to reproduce the issue with a ThinkingSphinx::Search object, not an actual array of results.

One easy test is to try:

    results.to_a.to_json

This was sufficient enough for me to indicate that it was an issue with the library and not with Rails.

Please try this to make sure you're dealing with an array of results or with a lazy loaded object that doesn't handle to_json correctly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am only able to reproduce the issue with a
ThinkingSphinx::Search object, not an actual array of results.&lt;/p&gt;
&lt;p&gt;One easy test is to try:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;results.to_a.to_json&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This was sufficient enough for me to indicate that it was an
issue with the library and not with Rails.&lt;/p&gt;
&lt;p&gt;Please try this to make sure you're dealing with an array of
results or with a lazy loaded object that doesn't handle to_json
correctly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-18T20:03:47+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2010-11-18T20:03:50+00:00</updated-at>
      <user-id type="integer">12316</user-id>
      <version type="integer">18</version>
      <user-name>Matt Todd</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name>Rohit Arondekar</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can we close this ticket or is still unresolved?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can we close this ticket or is still unresolved?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-26T10:03:41+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 89656
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2011-01-26T10:04:14+00:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">19</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Current rails 3.0.3 code has the following implementation:
    if @seen.any? { |object| object.equal?(value) }
      raise CircularReferenceError, 'object references itself'
    end

So the ticket should be fine now, the problem with &quot;==&quot; has been solved</body>
      <body-html>&lt;div&gt;&lt;p&gt;Current rails 3.0.3 code has the following
implementation:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;if @seen.any? { |object| object.equal?(value) }
  raise CircularReferenceError, 'object references itself'
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So the ticket should be fine now, the problem with &quot;==&quot; has been
solved&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-29T19:53:37+00:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2011-01-29T19:54:06+00:00</updated-at>
      <user-id type="integer">86215</user-id>
      <version type="integer">20</version>
      <user-name>Alexey Nayden</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-30T01:00:05+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: needs-more-info
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2011-04-30T01:01:12+01:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">21</version>
      <user-name>rails</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-04-30T01:00:06+01:00</created-at>
      <creator-id type="integer">48151</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">3744</number>
      <permalink>activesupportjsonencode-bogus-circularreferenceerror</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>ActiveSupport::JSON.encode bogus CircularReferenceError</title>
      <updated-at type="datetime">2011-04-30T01:00:39+01:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">22</version>
      <user-name>rails</user-name>
      <creator-name>Andrew Williams</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3744</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
  </versions>
</ticket>
