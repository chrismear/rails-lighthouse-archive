<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-12-20T12:43:50+00:00</created-at>
  <creator-id type="integer">3800</creator-id>
  <milestone-due-on type="datetime">2009-03-18T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">22038</milestone-id>
  <number type="integer">324</number>
  <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag nil="true"></tag>
  <title>Gem dependencies inconsistently load rails/init.rb</title>
  <updated-at type="datetime">2010-12-20T12:43:50+00:00</updated-at>
  <user-id type="integer">94458</user-id>
  <version type="integer">39</version>
  <user-name>Jeff Kreeftmeijer</user-name>
  <creator-name>Bruce Williams</creator-name>
  <assigned-user-name>Rick</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
  <milestone-title>2.1.3</milestone-title>
  <priority-name>High</priority-name>
  <original-body>Gems unpacked with gems:unpack inconsistently load &lt;tt&gt;rails/init.rb&lt;/tt&gt;from the unpacked gem and from the system gem (and in the case of an unpacked gem with no system gem present, the file isn't loaded at all).

This was tested with a small test gem [attached] on 2.1 stable and HEAD today at 7cfa6ec8a37b70ec302f09929df5160ac42971e7.

Each file in the gem outputs the filename at the beginning and end when loaded.  I've also included what the output looks like when used from &lt;tt&gt;vendor/plugins&lt;/tt&gt;, simply for comparison.

h3. Traditional &lt;tt&gt;vendor/plugins&lt;/tt&gt;

Expected output (&lt;tt&gt;init.rb&lt;/tt&gt; just &lt;tt&gt;require&lt;/tt&gt;s &lt;tt&gt;rails/init.rb&lt;/tt&gt;)

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/pre&gt;

h3. config.gem _(not unpacked)_

Expected output.

&lt;pre&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem still present on system)_

Files loaded from both the unpacked gem and system gem.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem not present on system)_

&lt;tt&gt;rails/init.rb&lt;/tt&gt; not loaded.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/pre&gt;</original-body>
  <latest-body>Gems unpacked with gems:unpack inconsistently load &lt;tt&gt;rails/init.rb&lt;/tt&gt;from the unpacked gem and from the system gem (and in the case of an unpacked gem with no system gem present, the file isn't loaded at all).

This was tested with a small test gem [attached] on 2.1 stable and HEAD today at 7cfa6ec8a37b70ec302f09929df5160ac42971e7.

Each file in the gem outputs the filename at the beginning and end when loaded.  I've also included what the output looks like when used from &lt;tt&gt;vendor/plugins&lt;/tt&gt;, simply for comparison.

h3. Traditional &lt;tt&gt;vendor/plugins&lt;/tt&gt;

Expected output (&lt;tt&gt;init.rb&lt;/tt&gt; just &lt;tt&gt;require&lt;/tt&gt;s &lt;tt&gt;rails/init.rb&lt;/tt&gt;)

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/pre&gt;

h3. config.gem _(not unpacked)_

Expected output.

&lt;pre&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem still present on system)_

Files loaded from both the unpacked gem and system gem.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem not present on system)_

&lt;tt&gt;rails/init.rb&lt;/tt&gt; not loaded.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/pre&gt;</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
Gems unpacked with gems:unpack inconsistently load rails/init.rbfrom the unpacked gem and from the system gem (and in the case of an unpacked gem with no system gem present, the file isn't loaded at all).
&lt;/p&gt;&lt;p&gt;
This was tested with a small test gem [attached] on 2.1 stable and HEAD today at 7cfa6ec8a37b70ec302f09929df5160ac42971e7.
&lt;/p&gt;&lt;p&gt;
Each file in the gem outputs the filename at the beginning and end when loaded.  I've also included what the output looks like when used from vendor/plugins, simply for comparison.
&lt;/p&gt;
&lt;h3&gt;
Traditional vendor/plugins
&lt;/h3&gt;
&lt;p&gt;
Expected output (init.rb just requires rails/init.rb)
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(not unpacked)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
Expected output.
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(unpacked, gem still present on system)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
Files loaded from both the unpacked gem and system gem.
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(unpacked, gem not present on system)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
rails/init.rb not loaded.
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Gems unpacked with gems:unpack inconsistently load &lt;tt&gt;rails/init.rb&lt;/tt&gt;from the unpacked gem and from the system gem (and in the case of an unpacked gem with no system gem present, the file isn't loaded at all).

This was tested with a small test gem [attached] on 2.1 stable and HEAD today at 7cfa6ec8a37b70ec302f09929df5160ac42971e7.

Each file in the gem outputs the filename at the beginning and end when loaded.  I've also included what the output looks like when used from &lt;tt&gt;vendor/plugins&lt;/tt&gt;, simply for comparison.

h3. Traditional &lt;tt&gt;vendor/plugins&lt;/tt&gt;

Expected output (&lt;tt&gt;init.rb&lt;/tt&gt; just &lt;tt&gt;require&lt;/tt&gt;s &lt;tt&gt;rails/init.rb&lt;/tt&gt;)

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/pre&gt;

h3. config.gem _(not unpacked)_

Expected output.

&lt;pre&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem still present on system)_

Files loaded from both the unpacked gem and system gem.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/pre&gt;

h3. config.gem _(unpacked, gem not present on system)_

&lt;tt&gt;rails/init.rb&lt;/tt&gt; not loaded.

&lt;pre&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/pre&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Gems unpacked with gems:unpack inconsistently load &lt;tt&gt;rails/init.rb&lt;/tt&gt;from the unpacked gem and from the system gem (and in the case of an unpacked gem with no system gem present, the file isn't loaded at all).
&lt;/p&gt;&lt;p&gt;
This was tested with a small test gem [attached] on 2.1 stable and HEAD today at 7cfa6ec8a37b70ec302f09929df5160ac42971e7.
&lt;/p&gt;&lt;p&gt;
Each file in the gem outputs the filename at the beginning and end when loaded.  I've also included what the output looks like when used from &lt;tt&gt;vendor/plugins&lt;/tt&gt;, simply for comparison.
&lt;/p&gt;
&lt;h3&gt;
Traditional &lt;tt&gt;vendor/plugins&lt;/tt&gt;
&lt;/h3&gt;
&lt;p&gt;
Expected output (&lt;tt&gt;init.rb&lt;/tt&gt; just &lt;tt&gt;require&lt;/tt&gt;s &lt;tt&gt;rails/init.rb&lt;/tt&gt;)
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/plugins/unpack_testing/init.rb
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(not unpacked)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
Expected output.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(unpacked, gem still present on system)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
Files loaded from both the unpacked gem and system gem.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
config.gem &lt;em&gt;(unpacked, gem not present on system)&lt;/em&gt;
&lt;/h3&gt;
&lt;p&gt;
&lt;tt&gt;rails/init.rb&lt;/tt&gt; not loaded.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/test2.1/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T21:26:28+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-03T21:26:28+01:00</updated-at>
      <user-id type="integer">3800</user-id>
      <version type="integer">1</version>
      <user-name>Bruce Williams</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T21:46:19+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-03T21:46:19+01:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">2</version>
      <user-name>DHH</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Okay, I'm seeing two issues here:  

* Frozen gems aren't getting their specs loaded, so unpacked gems aren't getting their rails/init.rb files run.
* The system gem specs are still loaded, so their init.rb files are run.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Okay, I'm seeing two issues here:
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
Frozen gems aren't getting their specs loaded, so unpacked gems aren't getting their rails/init.rb files run.
&lt;/li&gt;&lt;li&gt;
The system gem specs are still loaded, so their init.rb files are run.
&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-08T18:31:21+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-08T18:31:21+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">3</version>
      <user-name>Rick</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Bruce, can you (and any other interested parties) try the commit from &quot;my rails fork&quot;:http://github.com/technoweenie/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0?  Assuming this works well, I'll push this to the main rails repo.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Bruce, can you (and any other interested parties) try the commit from &lt;a href=&quot;http://github.com/technoweenie/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0&quot;&gt;my rails fork&lt;/a&gt;?  Assuming this works well, I'll push this to the main rails repo.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-08T19:05:43+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-08T19:05:43+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">4</version>
      <user-name>Rick</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Rick; will give it a shot -- results shortly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Rick; will give it a shot -- results shortly.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-08T19:31:43+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-08T19:31:43+01:00</updated-at>
      <user-id type="integer">3800</user-id>
      <version type="integer">5</version>
      <user-name>Bruce Williams</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Rick, it looks like you've fixed the loading from _both_ the unpacked and system gem when both are present, but autoloading doesn't seem to be functioning correctly (See #3 below).

Also, @rails/init.rb@ doesn't seem to be loaded at all from unpacked gems when the system gem is _not_ present (See #4 below).

Testing notes: Generated a fresh app from @railties/bin/rails@ using a clone of &quot;your fork&quot;:http://github.com/technoweenie/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0, tossed the rails source in vendor/rails, and used the unpack_testing gem attached to the ticket.  Please let me know if this seems like the wrong way to go about it.

h3. In vendor/plugins

(Just for reference).  Expected result.  This was working before.

&lt;pre&gt;
bruce@riyah Development/bug-324  % ruby script/console 
Loading development environment (Rails 2.1.0)
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/rails/init.rb
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing.rb
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/rails/init.rb
&gt;&gt;
&lt;/pre&gt;

h3. #2, Plain gem dependency

Expected result.  @rails/init.rb@ loaded, and autoloading of @UnpackTesting::AutoloadedConstant@ succeeds.  This was working before.

&lt;pre&gt;
bruce@riyah Development/bug-324  % ruby script/console
Loading development environment (Rails 2.1.0)
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&gt;&gt;
&lt;/pre&gt;


h3. #3, Unpacked, gem still present on system

@rails/init.rb@ loaded from the right place, but autoloading of @UnpackTesting::AutoloadedConstant@ fails (looks like it's using a plain @vendor/@ load path, incorrectly guessing the constant?)

&lt;pre&gt;
bruce@riyah Development/bug-324  % ruby script/console 
Loading development environment (Rails 2.1.0)
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/rails/init.rb
/Users/bruce/Development/bug-324/vendor/rails/activerecord/lib/../../activesupport/lib/active_support/dependencies.rb:116:in `qualified_const_defined?':NameError: &quot;Gems::UnpackTesting-0.0.001::Lib::UnpackTesting&quot; is not a valid constant name!
&gt;&gt;
&lt;/pre&gt;

h3. #4, Unpacked, gem not present on system

@rails/init.rb@ not loaded at all.

&lt;pre&gt;
bruce@riyah Development/bug-324  % ruby script/console              
Loading development environment (Rails 2.1.0)
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
LOADED /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&gt;&gt;
&lt;/pre&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Rick, it looks like you've fixed the loading from &lt;em&gt;both&lt;/em&gt; the unpacked and system gem when both are present, but autoloading doesn't seem to be functioning correctly (See &lt;a href=&quot;/projects/8994/tickets/3&quot; title=&quot;Ticket #3&quot;&gt;#3&lt;/a&gt; below).
&lt;/p&gt;&lt;p&gt;
Also, &lt;code&gt;rails/init.rb&lt;/code&gt; doesn't seem to be loaded at all from unpacked gems when the system gem is &lt;em&gt;not&lt;/em&gt; present (See &lt;a href=&quot;/projects/8994/tickets/4&quot; title=&quot;Ticket #4&quot;&gt;#4&lt;/a&gt; below).
&lt;/p&gt;&lt;p&gt;
Testing notes: Generated a fresh app from &lt;code&gt;railties/bin/rails&lt;/code&gt; using a clone of &lt;a href=&quot;http://github.com/technoweenie/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0&quot;&gt;your fork&lt;/a&gt;, tossed the rails source in vendor/rails, and used the unpack_testing gem attached to the ticket.  Please let me know if this seems like the wrong way to go about it.
&lt;/p&gt;
&lt;h3&gt;
In vendor/plugins
&lt;/h3&gt;
&lt;p&gt;
(Just for reference).  Expected result.  This was working before.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
bruce@riyah Development/bug-324  % ruby script/console
&lt;/p&gt;&lt;p&gt;
Loading development environment (Rails 2.1.0)
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/bug-324/vendor/plugins/unpack_testing/rails/init.rb
&lt;/p&gt;&lt;p&gt;
&gt;&gt;
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
&lt;a href=&quot;/projects/8994/tickets/2&quot; title=&quot;Ticket #2&quot;&gt;#2&lt;/a&gt;, Plain gem dependency
&lt;/h3&gt;
&lt;p&gt;
Expected result.  &lt;code&gt;rails/init.rb&lt;/code&gt; loaded, and autoloading of &lt;code&gt;UnpackTesting::AutoloadedConstant&lt;/code&gt; succeeds.  This was working before.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
bruce@riyah Development/bug-324  % ruby script/console
&lt;/p&gt;&lt;p&gt;
Loading development environment (Rails 2.1.0)
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/lib/unpack_testing/autoloaded_constant.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Library/Ruby/Gems/1.8/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
&gt;&gt;
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
&lt;a href=&quot;/projects/8994/tickets/3&quot; title=&quot;Ticket #3&quot;&gt;#3&lt;/a&gt;, Unpacked, gem still present on system
&lt;/h3&gt;
&lt;p&gt;
&lt;code&gt;rails/init.rb&lt;/code&gt; loaded from the right place, but autoloading of &lt;code&gt;UnpackTesting::AutoloadedConstant&lt;/code&gt; fails (looks like it's using a plain &lt;code&gt;vendor/&lt;/code&gt; load path, incorrectly guessing the constant?)
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
bruce@riyah Development/bug-324  % ruby script/console
&lt;/p&gt;&lt;p&gt;
Loading development environment (Rails 2.1.0)
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/rails/init.rb
&lt;/p&gt;&lt;p&gt;
/Users/bruce/Development/bug-324/vendor/rails/activerecord/lib/../../activesupport/lib/active_support/dependencies.rb:116:in `qualified_const_defined?':NameError: &quot;Gems::UnpackTesting-0.0.001::Lib::UnpackTesting&quot; is not a valid constant name!
&lt;/p&gt;&lt;p&gt;
&gt;&gt;
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;
&lt;h3&gt;
&lt;a href=&quot;/projects/8994/tickets/4&quot; title=&quot;Ticket #4&quot;&gt;#4&lt;/a&gt;, Unpacked, gem not present on system
&lt;/h3&gt;
&lt;p&gt;
&lt;code&gt;rails/init.rb&lt;/code&gt; not loaded at all.
&lt;/p&gt;&lt;p&gt;
&lt;pre&gt;
&lt;/p&gt;&lt;p&gt;
bruce@riyah Development/bug-324  % ruby script/console
&lt;/p&gt;&lt;p&gt;
Loading development environment (Rails 2.1.0)
&lt;/p&gt;&lt;p&gt;
LOADING /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
LOADED /Users/bruce/Development/bug-324/vendor/gems/unpack_testing-0.0.001/lib/unpack_testing.rb
&lt;/p&gt;&lt;p&gt;
&gt;&gt;
&lt;/p&gt;&lt;p&gt;
&lt;/pre&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-08T20:08:18+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-08T20:08:18+01:00</updated-at>
      <user-id type="integer">3800</user-id>
      <version type="integer">6</version>
      <user-name>Bruce Williams</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [faad1e32a8ab81890018ba89d191607778830cf0]) Fix discrepancies with loading rails/init.rb from gems. [#324 state:resolved]
http://github.com/rails/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [faad1e32a8ab81890018ba89d191607778830cf0]) Fix discrepancies with loading rails/init.rb from gems. [#324 state:resolved]
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/faad1e32a8ab81890018ba89d191607778830cf0&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-19T18:01:15+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: verified
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-19T18:01:15+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">7</version>
      <user-name>Repository</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-19T18:10:19+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-19T18:10:19+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">8</version>
      <user-name>Rick</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-19T18:10:24+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-19T18:10:24+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">9</version>
      <user-name>Rick</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [e1bd75a92285c29269270e708e49d7cd5fabac36]) Fix discrepancies with loading rails/init.rb from gems. [#324 state:resolved]
http://github.com/rails/rails/commit/e1bd75a92285c29269270e708e49d7cd5fabac36</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [e1bd75a92285c29269270e708e49d7cd5fabac36]) Fix discrepancies with loading rails/init.rb from gems. [#324 state:resolved]
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/e1bd75a92285c29269270e708e49d7cd5fabac36&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-19T18:12:10+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-19T18:12:10+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">10</version>
      <user-name>Repository</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>As of 10c581a6deed66e8b62de6e7a3621a63de90baad (HEAD as of now), I'm still seeing the same behavior in unpacked gems as mentioned in my last comment.  I also tested this against e1bd75a92285c29269270e708e49d7cd5fabac36 with the same results.

* When unpacked with the system gem still present, autoloading fails (attempts to build constants such as &lt;tt&gt;Gems::UnpackTesting-0.0.001::Lib::UnpackTesting&lt;/tt&gt;)
* When unpacked _without_ the system gem present, &lt;tt&gt;rails/init.rb&lt;/tt&gt; isn't loaded.

Did your testing show different results?  I'm generating a fresh app using &lt;tt&gt;railties/bin/rails&lt;/tt&gt; and tossing the repo in at &lt;tt&gt;vendor/rails&lt;/tt&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
As of 10c581a6deed66e8b62de6e7a3621a63de90baad (HEAD as of now), I'm still seeing the same behavior in unpacked gems as mentioned in my last comment.  I also tested this against e1bd75a92285c29269270e708e49d7cd5fabac36 with the same results.
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
When unpacked with the system gem still present, autoloading fails (attempts to build constants such as &lt;tt&gt;Gems::UnpackTesting-0.0.001::Lib::UnpackTesting&lt;/tt&gt;)
&lt;/li&gt;&lt;li&gt;
When unpacked &lt;em&gt;without&lt;/em&gt; the system gem present, &lt;tt&gt;rails/init.rb&lt;/tt&gt; isn't loaded.
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;
Did your testing show different results?  I'm generating a fresh app using &lt;tt&gt;railties/bin/rails&lt;/tt&gt; and tossing the repo in at &lt;tt&gt;vendor/rails&lt;/tt&gt;.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-19T18:46:28+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-19T18:46:28+01:00</updated-at>
      <user-id type="integer">3800</user-id>
      <version type="integer">11</version>
      <user-name>Bruce Williams</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm having the same issue with - in the constant name. Trying to autoload constants from an a path that doesn't convert into a module name.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I'm having the same issue with - in the constant name. Trying to autoload constants from an a path that doesn't convert into a module name.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-24T02:01:54+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-06-24T02:01:54+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">12</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Is there a any progress?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Is there a any progress?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-02T19:33:33+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-07-02T19:33:33+01:00</updated-at>
      <user-id type="integer">17102</user-id>
      <version type="integer">13</version>
      <user-name>Stephan Kaag</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Instead of unpacking gems we could just install them in vendor/gems using the gem command (or unpack could just do a gem install):

Ex: gem install -i gems activesupport activerecord (From RAILS_ROOT)

Then we could just do something:

@@@ ruby
Gem.path.unshift(RAILS_ROOT + &quot;vendor/gems&quot;)
@@@

This is how merb do it afaik, is there any reason for not doing it? seems better than the current way to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Instead of unpacking gems we could just install them in vendor/gems using the gem command (or unpack could just do a gem install):
&lt;/p&gt;&lt;p&gt;
Ex: gem install -i gems activesupport activerecord (From RAILS_ROOT)
&lt;/p&gt;&lt;p&gt;
Then we could just do something:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;Gem.path.unshift(RAILS_ROOT + &amp;quot;vendor/gems&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
This is how merb do it afaik, is there any reason for not doing it? seems better than the current way to me.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-24T14:28:18+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-07-24T14:28:18+01:00</updated-at>
      <user-id type="integer">27062</user-id>
      <version type="integer">14</version>
      <user-name>Ramon Salvad&#243;</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Ramon, if you think that's a better way, by all means add an enhancement ticket so it can be discussed.

The resolution of this issue (the breakage of a feature in 2.1) is a different concern.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Ramon, if you think that's a better way, by all means add an enhancement ticket so it can be discussed.
&lt;/p&gt;&lt;p&gt;
The resolution of this issue (the breakage of a feature in 2.1) is a different concern.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-01T18:03:13+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-08-01T18:03:13+01:00</updated-at>
      <user-id type="integer">3800</user-id>
      <version type="integer">15</version>
      <user-name>Bruce Williams</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>No progress here. Someone needs to tackle it or it will be left behind.</body>
      <body-html>&lt;div&gt;&lt;p&gt;No progress here. Someone needs to tackle it or it will be left
behind.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-30T02:13:02+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb-2</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-08-30T02:13:02+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is a key feature.  I personally don't care about unpacked gems, but I'd love to have plugins just work as external gems.

I also don't care about it working with config.gems.  The sensible thing to me would be to process rails/init.rb for any activated gem which has a rails/init.rb - regardless of whether it was put on the load path via config.gems, preinitializer.rb, or manually via a gem() call.  That seems the most logical, decoupled approach.

I can't commit, but I'll try to dig into this next time I have an itch related to it...</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is a key feature. I personally don't care about unpacked
gems, but I'd love to have plugins just work as external gems.&lt;/p&gt;
&lt;p&gt;I also don't care about it working with config.gems. The
sensible thing to me would be to process rails/init.rb for any
activated gem which has a rails/init.rb - regardless of whether it
was put on the load path via config.gems, preinitializer.rb, or
manually via a gem() call. That seems the most logical, decoupled
approach.&lt;/p&gt;
&lt;p&gt;I can't commit, but I'll try to dig into this next time I have
an itch related to it...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-30T19:51:28+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb-3</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-08-30T19:51:28+01:00</updated-at>
      <user-id type="integer">17482</user-id>
      <version type="integer">17</version>
      <user-name>Chad Woolley</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm sorry to see that this bug is marked stale - since it's a problem which happens at my deployment scenarios.

My workaround is at the moment to remove gems packaged into the application.
=&gt; But I'd like to have fully consistent application deployments (means every application brings it's on rails + gems, so that there are zero dependencies on the host, besides a database connection).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm sorry to see that this bug is marked stale - since it's a
problem which happens at my deployment scenarios.&lt;/p&gt;
&lt;p&gt;My workaround is at the moment to remove gems packaged into the
application. =&amp;gt; But I'd like to have fully consistent
application deployments (means every application brings it's on
rails + gems, so that there are zero dependencies on the host,
besides a database connection).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-02T10:51:11+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb-4</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-02T10:51:11+01:00</updated-at>
      <user-id type="integer">12596</user-id>
      <version type="integer">18</version>
      <user-name>Rene Androsch</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think I figured out the reason why &quot;#3 Unpacked, gem still present on system&quot; is throwing an error.  The current path to constant resolution convention assumes that directories under lib, plugins, and gems can be used as constant names.  When a gem with a version number is unpacked the directory has the version number in it, causing the above problem.  I have attached a patch that strips the version numbers out of the constant name.  Of course, the patch also comes with a test :)  Hopefully this will unstale this guy, because I am very interested in never using plugins again.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think I figured out the reason why &quot;#3 Unpacked, gem still
present on system&quot; is throwing an error. The current path to
constant resolution convention assumes that directories under lib,
plugins, and gems can be used as constant names. When a gem with a
version number is unpacked the directory has the version number in
it, causing the above problem. I have attached a patch that strips
the version numbers out of the constant name. Of course, the patch
also comes with a test :) Hopefully this will unstale this guy,
because I am very interested in never using plugins again.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-02T20:35:28+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb-5</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-02T20:35:28+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">19</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Actually, as far as I can tell that patch also fixes #4.  neat!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Actually, as far as I can tell that patch also fixes &lt;a href=&quot;/projects/8994/tickets/4&quot; title=&quot;Ticket #4&quot;&gt;#4&lt;/a&gt;. neat!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-02T21:04:33+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb-6</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-02T21:04:33+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">20</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Rails 2.1.1 is out and the changelog (http://gist.github.com/raw/8946/6f8a982756f8f2d65705210c2e85892fcadad651) mentions &quot;Fix discrepancies with loading rails/init.rb from gems&quot;. I presume that refers to commit e1bd75a92285c29269270e708e49d7cd5fabac36 (http://github.com/rails/rails/commit/e1bd75a92285c29269270e708e49d7cd5fabac36), right?

Is it true then that the breakage that Bruce described is still present in the latest release?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Rails 2.1.1 is out and the changelog (&lt;a href=&quot;http://gist.github.com/raw/8946/6f8a982756f8f2d65705210c2e85892fcadad651)&quot;&gt;http://gist.github.com/raw/8946/...&lt;/a&gt;
mentions &quot;Fix discrepancies with loading rails/init.rb from gems&quot;.
I presume that refers to commit
e1bd75a92285c29269270e708e49d7cd5fabac36 (&lt;a href=&quot;http://github.com/rails/rails/commit/e1bd75a92285c29269270e708e49d7cd5fabac36)&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;,
right?&lt;/p&gt;
&lt;p&gt;Is it true then that the breakage that Bruce described is still
present in the latest release?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-05T19:00:13+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-05T19:00:16+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">21</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Just tested Justin's patch against 2.1.1.

In 2.1 with Haml 2.0.2 frozen into vendor/gems my spec suite runs fine. After upgrading to 2.1.1 &quot;rake spec&quot; fails with the following (didn't even get as far as running the app, I imagine it won't even boot):

@@@
rake aborted!
&quot;Gems::Haml-2.0.2::Lib&quot; is not a valid constant name!

(See full trace by running task with --trace)
@@@

After applying the patch to 2.1.1 the spec suite runs fine again. Haven't yet established whether this happens to fix cases #3 and #4 referenced previously.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just tested Justin's patch against 2.1.1.&lt;/p&gt;
&lt;p&gt;In 2.1 with Haml 2.0.2 frozen into vendor/gems my spec suite
runs fine. After upgrading to 2.1.1 &quot;rake spec&quot; fails with the
following (didn't even get as far as running the app, I imagine it
won't even boot):&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
rake aborted!
&amp;quot;Gems::Haml-2.0.2::Lib&amp;quot; is not a valid constant name!

(See full trace by running task with --trace)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After applying the patch to 2.1.1 the spec suite runs fine
again. Haven't yet established whether this happens to fix cases
&lt;a href=&quot;/projects/8994/tickets/3&quot; title=&quot;Ticket #3&quot;&gt;#3&lt;/a&gt; and
&lt;a href=&quot;/projects/8994/tickets/4&quot; title=&quot;Ticket #4&quot;&gt;#4&lt;/a&gt;
referenced previously.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-05T19:29:04+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-05T19:29:07+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">22</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Wincent Just to clarify, the case in which your spec fails is 2.1.1 WITHOUT the patch.  With the patch applied everything seems to work appropriately, right?</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Wincent Just to clarify, the case in which your spec fails is
2.1.1 WITHOUT the patch. With the patch applied everything seems to
work appropriately, right?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-05T20:27:42+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-05T20:27:44+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">23</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Yes that's right Justin: 2.1 worked without the patch, 2.1.1 doesn't work without the patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes that's right Justin: 2.1 worked without the patch, 2.1.1
doesn't work without the patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-05T22:07:40+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-05T22:07:45+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">24</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The plot thickens:

Rails 2.1.1, Haml 2.0.2 frozen into vendor/gems/, and the patch applied. Works fine until I delete the system-wide copy of Haml 2.0.2 (leaving the frozen one intact in vendor/gems/). Upon deleting Haml 2.0.2 gem from the system all attempts to run specs or launch the app yield:

@@@
uninitialized constant Rails::Initializer::Sass
@@@

I actually think that might be a separate problem, something about Haml itself seeing as I can't reproduce the problem with other gems. It seems like it wasn't designed to be frozen into vendor/gems/.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The plot thickens:&lt;/p&gt;
&lt;p&gt;Rails 2.1.1, Haml 2.0.2 frozen into vendor/gems/, and the patch
applied. Works fine until I delete the system-wide copy of Haml
2.0.2 (leaving the frozen one intact in vendor/gems/). Upon
deleting Haml 2.0.2 gem from the system all attempts to run specs
or launch the app yield:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
uninitialized constant Rails::Initializer::Sass
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I actually think that might be a separate problem, something
about Haml itself seeing as I can't reproduce the problem with
other gems. It seems like it wasn't designed to be frozen into
vendor/gems/.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T22:15:05+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-06T22:15:09+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">25</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Further testing reveals that &quot;init.rb&quot;/&quot;rails/init.rb&quot; are not getting evaluated in the frozen gem; &quot;init.rb&quot; does get evaluated when Haml is installed as a plugin at vendor/plugins/haml.

Related post to Haml group:

http://groups.google.com/group/haml/browse_thread/thread/57ea1edfcebfa980</body>
      <body-html>&lt;div&gt;&lt;p&gt;Further testing reveals that &quot;init.rb&quot;/&quot;rails/init.rb&quot; are not
getting evaluated in the frozen gem; &quot;init.rb&quot; does get evaluated
when Haml is installed as a plugin at vendor/plugins/haml.&lt;/p&gt;
&lt;p&gt;Related post to Haml group:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://groups.google.com/group/haml/browse_thread/thread/57ea1edfcebfa980&quot;&gt;
http://groups.google.com/group/h...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T22:56:07+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-06T22:56:22+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">26</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@wincent make sure you check out: http://rails.lighthouseapp.com/projects/8994/tickets/59-when-loading-a-plugin-via-rubygems-rake-tasks-aren-t-included which is a separate issue I created a patch for.  I'll be testing haml with both of these patches and let you know what I find.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@wincent make sure you check out: &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994/tickets/59-when-loading-a-plugin-via-rubygems-rake-tasks-aren-t-included&quot;&gt;
http://rails.lighthouseapp.com/p...&lt;/a&gt; which is a separate issue I
created a patch for. I'll be testing haml with both of these
patches and let you know what I find.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-10T23:52:56+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-10T23:53:06+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">27</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@wincent I tested this with rails 2.1.1 and haml-2.0.3 with none of the patches applied and didn't run into any problems.

1. system based haml installed, ran system rails/init.rb
2. system based haml installed with frozen haml, ran frozen rails/init.rb
3. no system based haml with frozen haml, ran frozen rails/init.rb</body>
      <body-html>&lt;div&gt;&lt;p&gt;@wincent I tested this with rails 2.1.1 and haml-2.0.3 with none
of the patches applied and didn't run into any problems.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;system based haml installed, ran system rails/init.rb&lt;/li&gt;
&lt;li&gt;system based haml installed with frozen haml, ran frozen
rails/init.rb&lt;/li&gt;
&lt;li&gt;no system based haml with frozen haml, ran frozen
rails/init.rb&lt;/li&gt;
&lt;/ol&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T01:16:54+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-11T01:16:59+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">28</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Haml 2.0.3 just came out and I haven't tried it yet, so will do so.

I'm not surprised about &quot;1&quot; and &quot;2&quot; but I am a little surprised about &quot;3&quot;, as I have other frozen gems that aren't installed on the system and their rails/init.rb didn't seem to be getting called. Will double check.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Haml 2.0.3 just came out and I haven't tried it yet, so will do
so.&lt;/p&gt;
&lt;p&gt;I'm not surprised about &quot;1&quot; and &quot;2&quot; but I am a little surprised
about &quot;3&quot;, as I have other frozen gems that aren't installed on the
system and their rails/init.rb didn't seem to be getting called.
Will double check.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T10:32:25+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-11T10:32:50+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">29</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Justin, I can't reproduce your findings. I just gave it a try with Rails 2.1.1 + the patch from this ticket and Haml 2.0.3:

1. system based haml installed, ran system rails/init.rb
2. system based haml installed with frozen haml, ran frozen rails/init.rb
3. no system based haml with frozen haml, failed to run rails/init.rb

Also tried it with Rails 2.1.1, unpatched, a new Rails app with nothing but this config.gem line in the environment.rb:

@@@
config.gem 'haml', :version =&gt; '&gt;= 2.0.3'
@@@

1. system based haml installed, ran system rails/init.rb
2. system based haml installed with frozen haml, ran frozen rails/init.rb
3. no system based haml with frozen haml, failed to run rails/init.rb

And a fourth option:

4. no system based haml and no frozen haml, correctly aborts with &quot;Missing these required gems...&quot;

Also note that in 2.1.1 &quot;rake gems:unpack&quot; doesn't work due to bug #1003; I could only complete the above tests by applying the patch from that ticket.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Justin, I can't reproduce your findings. I just gave it a try
with Rails 2.1.1 + the patch from this ticket and Haml 2.0.3:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;system based haml installed, ran system rails/init.rb&lt;/li&gt;
&lt;li&gt;system based haml installed with frozen haml, ran frozen
rails/init.rb&lt;/li&gt;
&lt;li&gt;no system based haml with frozen haml, failed to run
rails/init.rb&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Also tried it with Rails 2.1.1, unpatched, a new Rails app with
nothing but this config.gem line in the environment.rb:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
config.gem 'haml', :version =&amp;gt; '&amp;gt;= 2.0.3'
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;system based haml installed, ran system rails/init.rb&lt;/li&gt;
&lt;li&gt;system based haml installed with frozen haml, ran frozen
rails/init.rb&lt;/li&gt;
&lt;li&gt;no system based haml with frozen haml, failed to run
rails/init.rb&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And a fourth option:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;no system based haml and no frozen haml, correctly aborts with
&quot;Missing these required gems...&quot;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Also note that in 2.1.1 &quot;rake gems:unpack&quot; doesn't work due to
bug &lt;a href=&quot;/projects/8994/tickets/1003&quot; title=&quot;Ticket #1003&quot;&gt;#1003&lt;/a&gt;; I could only complete the above tests by
applying the patch from that ticket.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T16:33:41+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-11T16:33:46+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">30</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@wincent How are you testing to see if init.rb was run or not.  I want to make sure we are doing the same thing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@wincent How are you testing to see if init.rb was run or not. I
want to make sure we are doing the same thing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T16:43:24+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-11T16:43:31+01:00</updated-at>
      <user-id type="integer">26568</user-id>
      <version type="integer">31</version>
      <user-name>Justin Marney</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm testing by sticking something like this in rails/init.rb:

@@@
raise &quot;derailed!&quot;
@@@

When rails/init.rb gets evaluated the exception is raised and whatever I'm doing (script/console, rake spec etc) aborts.

In any case, I've taken the time to grok the gem loading code a bit and I've come up with a patch that fixes things for me at least.

The key lies in railties/lib/rails/plugin/locator.rb. Basically, only stuff which has a Gem::Specification will have its rails/init.rb evaluated because everything else gets filtered out.

It appears that any system-installed gem will have a Gem::Specification set up for it by RubyGems when the &quot;gem&quot; method is called from add_load_paths in railties/lib/rails/gem_dependency.rb.

On the other hand, if a gem is frozen then it winds up going through the other code path in add_load_paths; the frozen &quot;lib&quot; (and possibly &quot;ext&quot;) paths are added to the load path but &quot;gem&quot; is never called and a spec is never set up.

As Rick commented back in June, &quot;Frozen gems aren't getting their specs loaded, so unpacked gems aren't getting their rails/init.rb files run.&quot;

So my patch just adds a Gem::Specification for all such frozen gems and now rails/init.rb does indeed get called for them. I chose to put this in add_load_paths because that's where the non-frozen gems end up getting their Gem::Specifications too (by the RubyGems &quot;gem&quot; method).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm testing by sticking something like this in
rails/init.rb:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
raise &amp;quot;derailed!&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When rails/init.rb gets evaluated the exception is raised and
whatever I'm doing (script/console, rake spec etc) aborts.&lt;/p&gt;
&lt;p&gt;In any case, I've taken the time to grok the gem loading code a
bit and I've come up with a patch that fixes things for me at
least.&lt;/p&gt;
&lt;p&gt;The key lies in railties/lib/rails/plugin/locator.rb. Basically,
only stuff which has a Gem::Specification will have its
rails/init.rb evaluated because everything else gets filtered
out.&lt;/p&gt;
&lt;p&gt;It appears that any system-installed gem will have a
Gem::Specification set up for it by RubyGems when the &quot;gem&quot; method
is called from add_load_paths in
railties/lib/rails/gem_dependency.rb.&lt;/p&gt;
&lt;p&gt;On the other hand, if a gem is frozen then it winds up going
through the other code path in add_load_paths; the frozen &quot;lib&quot;
(and possibly &quot;ext&quot;) paths are added to the load path but &quot;gem&quot; is
never called and a spec is never set up.&lt;/p&gt;
&lt;p&gt;As Rick commented back in June, &quot;Frozen gems aren't getting
their specs loaded, so unpacked gems aren't getting their
rails/init.rb files run.&quot;&lt;/p&gt;
&lt;p&gt;So my patch just adds a Gem::Specification for all such frozen
gems and now rails/init.rb does indeed get called for them. I chose
to put this in add_load_paths because that's where the non-frozen
gems end up getting their Gem::Specifications too (by the RubyGems
&quot;gem&quot; method).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-11T17:51:48+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.1-stable bug dependencies edge
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-09-11T17:51:58+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">32</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Is there anything happening with this issue?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Is there anything happening with this issue?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-10-14T14:26:56+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.1-stable bug dependencies edge patch
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-10-14T14:27:01+01:00</updated-at>
      <user-id type="integer">21241</user-id>
      <version type="integer">33</version>
      <user-name>Magnus Bergmark</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Can somebody double check that this works now? The changes from #1128 should have removed any inconsistencies. (the 'frozen gem without system gem' case should work)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can somebody double check that this works now? The changes from
&lt;a href=&quot;/projects/8994/tickets/1128&quot; title=&quot;Ticket #1128&quot;&gt;#1128&lt;/a&gt; should have removed any inconsistencies.
(the 'frozen gem without system gem' case should work)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-10-17T16:41:03+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-10-17T16:41:06+01:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">34</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-10-24T03:19:36+01:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9901
</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-10-24T03:19:39+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">35</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Just updated an application from 2.1.1 to 2.1.2 and can confirm that it's still a problem in the latest Rails release (2.1.2). Also tested that the patch I posted back in September fixes the problem in 2.1.2 as well, and it does.

Any chance of getting it applied before 2.2 goes final? (Later today when I get some time I hope to test the 2.2 release candidate and see if the problem is still present there.)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just updated an application from 2.1.1 to 2.1.2 and can confirm
that it's still a problem in the latest Rails release (2.1.2). Also
tested that the patch I posted back in September fixes the problem
in 2.1.2 as well, and it does.&lt;/p&gt;
&lt;p&gt;Any chance of getting it applied before 2.2 goes final? (Later
today when I get some time I hope to test the 2.2 release candidate
and see if the problem is still present there.)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-05T11:35:23+00:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-11-05T11:35:26+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">36</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I should also add that Justin's patch is still needed to correct errors like:

@@@
&quot;Gems::Haml-2.0.3::Lib&quot; is not a valid constant name!
@@@

My patch handles a separate issue (for example, when Haml is frozen into vendor/gems and not present elsewhere on the system):

@@@
uninitialized constant Rails::Initializer::Sass
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I should also add that Justin's patch is still needed to correct
errors like:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
&amp;quot;Gems::Haml-2.0.3::Lib&amp;quot; is not a valid constant name!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My patch handles a separate issue (for example, when Haml is
frozen into vendor/gems and not present elsewhere on the
system):&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
uninitialized constant Rails::Initializer::Sass
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-05T11:42:30+00:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.1-stable bug bug dependencies edge patch</tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2008-11-05T11:42:32+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">37</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T08:51:51+00:00</created-at>
      <creator-id type="integer">3800</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.1-stable bug bug dependencies edge patch
</diffable-attributes>
      <milestone-id type="integer">22038</milestone-id>
      <number type="integer">324</number>
      <permalink>gem-dependencies-inconsistently-load-rails-init-rb</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>Gem dependencies inconsistently load rails/init.rb</title>
      <updated-at type="datetime">2010-11-08T08:51:58+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">39</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Bruce Williams</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/324</url>
      <milestone-title>2.1.3</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>bfcbf10f4b2884d63b9b98a625041df962e6fe75</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-03T21:26:28+01:00</created-at>
      <filename>unpack_testing-0.0.001.gem</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">25742</id>
      <size type="integer">5632</size>
      <uploader-id type="integer">3800</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/25742/unpack_testing-0.0.001.gem</url>
    </attachment>
    <attachment type="Attachment">
      <code>6957799240c96dc4e188ed527041c8b70b20c5fe</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-09-02T20:35:28+01:00</created-at>
      <filename>gem_dep_version_number_bug.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">43265</id>
      <size type="integer">1838</size>
      <uploader-id type="integer">26568</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/43265/gem_dep_version_number_bug.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f0cf4b1c3ad5cb8d656e2d34e1b5e57ef7f7de85</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-09-11T17:51:49+01:00</created-at>
      <filename>missing_gem_specs.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">45347</id>
      <size type="integer">616</size>
      <uploader-id type="integer">12845</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/45347/missing_gem_specs.patch</url>
    </attachment>
  </attachments>
</ticket>
