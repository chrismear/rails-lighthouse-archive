<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-07-20T06:20:50+01:00</created-at>
  <creator-id type="integer">25075</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">3578</number>
  <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>escape_javascript linebreak unicode utf8</tag>
  <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
  <updated-at type="datetime">2011-04-13T01:00:48+01:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">6</version>
  <user-name>rails</user-name>
  <creator-name>subimage</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
  <priority-name nil="true"></priority-name>
  <original-body>I believe escape_javascript is not properly escaping unicode line breaks.

I've attached a JS file that was generated using escape_javascript directly from my utf8 encoded database. It has the offending character on position 32 of line 1. Try pasting it into the firebug console and you'll get an error &quot;unterminated string literal&quot;. Remove character 32, and it fixes it.

I pasted the character into a hex editor and it turns out to be E280A8, which googling leads me to believe is a unicode linebreak.

Modifying the escape_javascript method to include the weird character seems to fix things.

I'm running Ruby 1.8.6</original-body>
  <latest-body>I believe escape_javascript is not properly escaping unicode line breaks.

I've attached a JS file that was generated using escape_javascript directly from my utf8 encoded database. It has the offending character on position 32 of line 1. Try pasting it into the firebug console and you'll get an error &quot;unterminated string literal&quot;. Remove character 32, and it fixes it.

I pasted the character into a hex editor and it turns out to be E280A8, which googling leads me to believe is a unicode linebreak.

Modifying the escape_javascript method to include the weird character seems to fix things.

I'm running Ruby 1.8.6</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I believe escape_javascript is not properly escaping unicode
line breaks.&lt;/p&gt;
&lt;p&gt;I've attached a JS file that was generated using
escape_javascript directly from my utf8 encoded database. It has
the offending character on position 32 of line 1. Try pasting it
into the firebug console and you'll get an error &quot;unterminated
string literal&quot;. Remove character 32, and it fixes it.&lt;/p&gt;
&lt;p&gt;I pasted the character into a hex editor and it turns out to be
E280A8, which googling leads me to believe is a unicode
linebreak.&lt;/p&gt;
&lt;p&gt;Modifying the escape_javascript method to include the weird
character seems to fix things.&lt;/p&gt;
&lt;p&gt;I'm running Ruby 1.8.6&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I believe escape_javascript is not properly escaping unicode line breaks.

I've attached a JS file that was generated using escape_javascript directly from my utf8 encoded database. It has the offending character on position 32 of line 1. Try pasting it into the firebug console and you'll get an error &quot;unterminated string literal&quot;. Remove character 32, and it fixes it.

I pasted the character into a hex editor and it turns out to be E280A8, which googling leads me to believe is a unicode linebreak.

Modifying the escape_javascript method to include the weird character seems to fix things.

I'm running Ruby 1.8.6</body>
      <body-html>&lt;div&gt;&lt;p&gt;I believe escape_javascript is not properly escaping unicode
line breaks.&lt;/p&gt;
&lt;p&gt;I've attached a JS file that was generated using
escape_javascript directly from my utf8 encoded database. It has
the offending character on position 32 of line 1. Try pasting it
into the firebug console and you'll get an error &quot;unterminated
string literal&quot;. Remove character 32, and it fixes it.&lt;/p&gt;
&lt;p&gt;I pasted the character into a hex editor and it turns out to be
E280A8, which googling leads me to believe is a unicode
linebreak.&lt;/p&gt;
&lt;p&gt;Modifying the escape_javascript method to include the weird
character seems to fix things.&lt;/p&gt;
&lt;p&gt;I'm running Ruby 1.8.6&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-15T23:44:47+00:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2009-12-15T23:44:52+00:00</updated-at>
      <user-id type="integer">25075</user-id>
      <version type="integer">1</version>
      <user-name>subimage</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 on this issue.  I've run into the identical error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 on this issue. I've run into the identical error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-26T21:02:59+00:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2010-01-26T21:03:00+00:00</updated-at>
      <user-id type="integer">34867</user-id>
      <version type="integer">2</version>
      <user-name>Michael Kintzer</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>anging from &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;cheap jewelry&lt;/a&gt;&lt;/b&gt; hairstyles to clothing, diet &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net/designer-jewelry/pandora-jewelry.html&quot;&gt;replica Pandora&lt;/a&gt;&lt;/b&gt; schedule, footwear to designer &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;cheap jewelry replica&lt;/a&gt;&lt;/b&gt; jewelry etc so that &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;designer jewelry on sale&lt;/a&gt;&lt;/b&gt; they can live the &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net/designer-jewelry/gucci-earrings.html&quot;&gt;replica Gucci Earrings wholesale&lt;/a&gt;&lt;/b&gt; lifestyle in the way &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net/designer-jewelry/christian-dior-jewelry.html&quot;&gt;cheap Christian Dior online sale&lt;/a&gt;&lt;/b&gt; they are leading. Because &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net/designer-jewelry/links-of-london-jewelry.html&quot;&gt;cheap Links of London for sale&lt;/a&gt;&lt;/b&gt; of the fact; designer &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;designer jewelry store&lt;/a&gt;&lt;/b&gt; jewelry wear by celebrities &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;designer fashion jewelry&lt;/a&gt;&lt;/b&gt; like Britney Spears, Jenifer &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net/designer-jewelry/pandora-packages.html&quot;&gt;replica Pandora Packages&lt;/a&gt;&lt;/b&gt; Lopez, etc never fails to catch the fantasies of every woman. Ho</body>
      <body-html>&lt;div&gt;&lt;p&gt;anging from &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;cheap
jewelry&lt;/a&gt;&lt;/b&gt; hairstyles to clothing, diet &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net/designer-jewelry/pandora-jewelry.html&quot;&gt;replica
Pandora&lt;/a&gt;&lt;/b&gt; schedule, footwear to designer &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net&quot;&gt;cheap jewelry replica&lt;/a&gt;&lt;/b&gt; jewelry
etc so that &lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;designer jewelry
on sale&lt;/a&gt;&lt;/b&gt; they can live the &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net/designer-jewelry/gucci-earrings.html&quot;&gt;replica
Gucci Earrings wholesale&lt;/a&gt;&lt;/b&gt; lifestyle in the way &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net/designer-jewelry/christian-dior-jewelry.html&quot;&gt;
cheap Christian Dior online sale&lt;/a&gt;&lt;/b&gt; they are leading. Because
&lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net/designer-jewelry/links-of-london-jewelry.html&quot;&gt;
cheap Links of London for sale&lt;/a&gt;&lt;/b&gt; of the fact; designer
&lt;b&gt;&lt;a href=&quot;http://www.jewelrysea.net&quot;&gt;designer jewelry
store&lt;/a&gt;&lt;/b&gt; jewelry wear by celebrities &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net&quot;&gt;designer fashion jewelry&lt;/a&gt;&lt;/b&gt; like
Britney Spears, Jenifer &lt;b&gt;&lt;a href=
&quot;http://www.jewelrysea.net/designer-jewelry/pandora-packages.html&quot;&gt;replica
Pandora Packages&lt;/a&gt;&lt;/b&gt; Lopez, etc never fails to catch the
fantasies of every woman. Ho&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-20T04:16:37+01:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2010-07-20T06:20:50+01:00</updated-at>
      <user-id type="integer">107926</user-id>
      <version type="integer">3</version>
      <user-name>echo</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I had the same problem. I found that my text is correctly stored in the database (mysql), but it was incorrectly generated in the js resulting in an unwanted line ending in my js

I solved this by adding 

encoding: utf8

to my database.yml. Then rails correctly handles the utf8 in my database and handles the linebreak correctly. The generated js does not contain unwanted line endings anymore and characters like &#233; show up correctly (instead of a ?). See http://oldwiki.rubyonrails.org/rails/pages/HowToUseUnicodeStrings under &quot;Configuring the database connection&quot;</body>
      <body-html>&lt;div&gt;&lt;p&gt;I had the same problem. I found that my text is correctly stored
in the database (mysql), but it was incorrectly generated in the js
resulting in an unwanted line ending in my js&lt;/p&gt;
&lt;p&gt;I solved this by adding&lt;/p&gt;
&lt;p&gt;encoding: utf8&lt;/p&gt;
&lt;p&gt;to my database.yml. Then rails correctly handles the utf8 in my
database and handles the linebreak correctly. The generated js does
not contain unwanted line endings anymore and characters like
&amp;eacute; show up correctly (instead of a ?). See &lt;a href=
&quot;http://oldwiki.rubyonrails.org/rails/pages/HowToUseUnicodeStrings&quot;&gt;
http://oldwiki.rubyonrails.org/rails/pages/HowToUseUnicodeStrings&lt;/a&gt;
under &quot;Configuring the database connection&quot;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-12T19:57:11+00:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2011-01-12T19:57:21+00:00</updated-at>
      <user-id type="integer">20871</user-id>
      <version type="integer">4</version>
      <user-name>Reinier Balt</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-13T01:00:07+01:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2011-04-13T01:00:48+01:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">5</version>
      <user-name>rails</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-04-13T01:00:07+01:00</created-at>
      <creator-id type="integer">25075</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3578</number>
      <permalink>escape_javascript-cant-handle-unicode-linebreaks-hex-e280a8</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>escape_javascript linebreak unicode utf8</tag>
      <title>escape_javascript can't handle unicode linebreaks (hex E280A8)</title>
      <updated-at type="datetime">2011-04-13T01:00:14+01:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">6</version>
      <user-name>rails</user-name>
      <creator-name>subimage</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3578</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>c22112a36f5f162bafb1dc15ed78ce16a9cad096</code>
      <content-type>application/octet-stream</content-type>
      <created-at type="datetime">2009-12-15T23:44:47+00:00</created-at>
      <filename>escape_javascript_patch.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">353547</id>
      <size type="integer">870</size>
      <uploader-id type="integer">25075</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/353547/escape_javascript_patch.rb</url>
    </attachment>
    <attachment type="Attachment">
      <code>a9a0ff0a6b3323075a8e2dc5fb836a1ca86ee38b</code>
      <content-type>application/x-javascript</content-type>
      <created-at type="datetime">2009-12-15T23:44:51+00:00</created-at>
      <filename>jacked_character.js</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">353548</id>
      <size type="integer">570</size>
      <uploader-id type="integer">25075</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/353548/jacked_character.js</url>
    </attachment>
  </attachments>
</ticket>
