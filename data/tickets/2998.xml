<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-08-05T21:23:51+01:00</created-at>
  <creator-id type="integer">65300</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">2998</number>
  <permalink>named_scope-ignores-include-option</permalink>
  <priority type="integer">130216</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>2-3-stable 23 235 30 activerecord bugmash error ignored include named_scope patch sql</tag>
  <title>[PATCH] SQL generated by find ignores :include option</title>
  <updated-at type="datetime">2011-02-02T17:27:27+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">20</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Emery Finkelstein</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
  <priority-name nil="true"></priority-name>
  <original-body>Since upgrading to Rails 2.3.3 from 2.3.2 named scopes have started ignoring the :include option.

@@@
class Item &lt; ActiveRecord::Base
has_many :collection_sets, :through =&gt; :set_items
has_many :set_items

named_scope :in_collection, lambda {|c|
    { :include =&gt;  :collection_sets, :order =&gt; 'items.name', :conditions =&gt; 
       {:'collection_sets.collection_id' =&gt; c}
    }
}
end

Item.in_collection(2)
@@@

generates this SQL query in rails 2.3.3

@@@
SELECT * FROM `items` WHERE (`collection_sets`.`collection_id` = 2)  ORDER BY items.name
@@@

In Rails 2.3.2 it generated this SQL query

@@@
SELECT * FROM `items` LEFT OUTER JOIN `set_items` ON (`item`.`id` = `set_items`.`item_id`) LEFT OUTER JOIN `collection_sets` ON (`collection_sets`.`id` = `set_items`.`collection_set_id`) WHERE `collection_sets`.`id` = 2 ORDER BY items.name
@@@

Providing an unknown value for :include option in the named scope does not produce the expected ActiveREcord::ConfigurationError (Association named 'foo' was not found; perhaps you misspelled it?)</original-body>
  <latest-body>Since upgrading to Rails 2.3.3 from 2.3.2 named scopes have started ignoring the :include option.

@@@
class Item &lt; ActiveRecord::Base
has_many :collection_sets, :through =&gt; :set_items
has_many :set_items

named_scope :in_collection, lambda {|c|
    { :include =&gt;  :collection_sets, :order =&gt; 'items.name', :conditions =&gt; 
       {:'collection_sets.collection_id' =&gt; c}
    }
}
end

Item.in_collection(2)
@@@

generates this SQL query in rails 2.3.3

@@@
SELECT * FROM `items` WHERE (`collection_sets`.`collection_id` = 2)  ORDER BY items.name
@@@

In Rails 2.3.2 it generated this SQL query

@@@
SELECT * FROM `items` LEFT OUTER JOIN `set_items` ON (`item`.`id` = `set_items`.`item_id`) LEFT OUTER JOIN `collection_sets` ON (`collection_sets`.`id` = `set_items`.`collection_set_id`) WHERE `collection_sets`.`id` = 2 ORDER BY items.name
@@@

Providing an unknown value for :include option in the named scope does not produce the expected ActiveREcord::ConfigurationError (Association named 'foo' was not found; perhaps you misspelled it?)</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Since upgrading to Rails 2.3.3 from 2.3.2 named scopes have
started ignoring the :include option.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
class Item &amp;lt; ActiveRecord::Base
has_many :collection_sets, :through =&amp;gt; :set_items
has_many :set_items

named_scope :in_collection, lambda {|c|
    { :include =&amp;gt;  :collection_sets, :order =&amp;gt; 'items.name', :conditions =&amp;gt; 
       {:'collection_sets.collection_id' =&amp;gt; c}
    }
}
end

Item.in_collection(2)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;generates this SQL query in rails 2.3.3&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
SELECT * FROM `items` WHERE (`collection_sets`.`collection_id` = 2)  ORDER BY items.name
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In Rails 2.3.2 it generated this SQL query&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
SELECT * FROM `items` LEFT OUTER JOIN `set_items` ON (`item`.`id` = `set_items`.`item_id`) LEFT OUTER JOIN `collection_sets` ON (`collection_sets`.`id` = `set_items`.`collection_set_id`) WHERE `collection_sets`.`id` = 2 ORDER BY items.name
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Providing an unknown value for :include option in the named
scope does not produce the expected
ActiveREcord::ConfigurationError (Association named 'foo' was not
found; perhaps you misspelled it?)&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Since upgrading to Rails 2.3.3 from 2.3.2 named scopes have started ignoring the :include option.

@@@
class Item &lt; ActiveRecord::Base
has_many :collection_sets, :through =&gt; :set_items
has_many :set_items

named_scope :in_collection, lambda {|c|
    { :include =&gt;  :collection_sets, :order =&gt; 'items.name', :conditions =&gt; 
       {:'collection_sets.collection_id' =&gt; c}
    }
}
end

Item.in_collection(2)
@@@

generates this SQL query in rails 2.3.3

@@@
SELECT * FROM `items` WHERE (`collection_sets`.`collection_id` = 2)  ORDER BY items.name
@@@

In Rails 2.3.2 it generated this SQL query

@@@
SELECT * FROM `items` LEFT OUTER JOIN `set_items` ON (`item`.`id` = `set_items`.`item_id`) LEFT OUTER JOIN `collection_sets` ON (`collection_sets`.`id` = `set_items`.`collection_set_id`) WHERE `collection_sets`.`id` = 2 ORDER BY items.name
@@@

Providing an unknown value for :include option in the named scope does not produce the expected ActiveREcord::ConfigurationError (Association named 'foo' was not found; perhaps you misspelled it?)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Since upgrading to Rails 2.3.3 from 2.3.2 named scopes have
started ignoring the :include option.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Item &amp;lt; ActiveRecord::Base
has_many :collection_sets, :through =&amp;gt; :set_items
has_many :set_items

named_scope :in_collection, lambda {|c|
    { :include =&amp;gt;  :collection_sets, :order =&amp;gt; 'items.name', :conditions =&amp;gt; 
       {:'collection_sets.collection_id' =&amp;gt; c}
    }
}
end

Item.in_collection(2)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;generates this SQL query in rails 2.3.3&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;SELECT * FROM `items` WHERE (`collection_sets`.`collection_id` = 2)  ORDER BY items.name&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In Rails 2.3.2 it generated this SQL query&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;SELECT * FROM `items` LEFT OUTER JOIN `set_items` ON (`item`.`id` = `set_items`.`item_id`) LEFT OUTER JOIN `collection_sets` ON (`collection_sets`.`id` = `set_items`.`collection_set_id`) WHERE `collection_sets`.`id` = 2 ORDER BY items.name&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Providing an unknown value for :include option in the named
scope does not produce the expected
ActiveREcord::ConfigurationError (Association named 'foo' was not
found; perhaps you misspelled it?)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-05T21:23:51+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-08-05T21:23:55+01:00</updated-at>
      <user-id type="integer">65300</user-id>
      <version type="integer">1</version>
      <user-name>Emery Finkelstein</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've done a little more investigation into the issue and made the following observations.

Giving the same options the named scope should have to scoped works as expected.
eg:
@@@
Item.scoped(:include =&gt;  :collection_sets, :order =&gt; 'items.name', :conditions =&gt; {:'collection_sets.collection_id' =&gt; c}) 
@@@

Works as expected when c is defined as either a CollectionSet object or an integer.

A result of this is that I could create a lambda or Proc or method that just calls an anonymous scope, but this work around cannot be chained.


proxy_options for the named scope includes :include.
@@@
Item.in_collection(2).proxy_options =&gt; {:include=&gt;:collection_sets, :order=&gt;&quot;items.name&quot;, :conditions=&gt;{:&quot;collection_sets.collection_id&quot;=&gt; 2} }
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've done a little more investigation into the issue and made
the following observations.&lt;/p&gt;
&lt;p&gt;Giving the same options the named scope should have to scoped
works as expected.&lt;br&gt;
eg:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Item.scoped(:include =&amp;gt;  :collection_sets, :order =&amp;gt; 'items.name', :conditions =&amp;gt; {:'collection_sets.collection_id' =&amp;gt; c})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Works as expected when c is defined as either a CollectionSet
object or an integer.&lt;/p&gt;
&lt;p&gt;A result of this is that I could create a lambda or Proc or
method that just calls an anonymous scope, but this work around
cannot be chained.&lt;/p&gt;
&lt;p&gt;proxy_options for the named scope includes :include.&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Item.in_collection(2).proxy_options =&amp;gt; {:include=&amp;gt;:collection_sets, :order=&amp;gt;&quot;items.name&quot;, :conditions=&amp;gt;{:&quot;collection_sets.collection_id&quot;=&amp;gt; 2} }&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-05T22:27:25+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-08-05T22:27:29+01:00</updated-at>
      <user-id type="integer">65300</user-id>
      <version type="integer">2</version>
      <user-name>Emery Finkelstein</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-25T12:58:38+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.3 :include activerecord error ignored named_scope sql
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-25T12:58:39+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">3</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 verified on 2-3-stable, i tried to follow up `named_scope.rb` and try to point to where exactly the `:include` option is dropped/ignored when set within a lambda, but couldn't find any pointers..</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified on 2-3-stable, i tried to follow up
&lt;code&gt;named_scope.rb&lt;/code&gt; and try to point to where exactly the
&lt;code&gt;:include&lt;/code&gt; option is dropped/ignored when set within a
lambda, but couldn't find any pointers..&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-26T01:43:08+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-26T01:43:12+01:00</updated-at>
      <user-id type="integer">36381</user-id>
      <version type="integer">4</version>
      <user-name>Elad Meidar</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 verified - will try to write a test for it</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified - will try to write a test for it&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-26T16:35:32+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-26T16:35:38+01:00</updated-at>
      <user-id type="integer">38437</user-id>
      <version type="integer">5</version>
      <user-name>Luciano G. Panaro</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I understand that the options of a scope such as conditions are passed directly to #find. So in this case it would be a bug in #find rather than scopes themselves. This for example did not work either:

@@@ ruby
def self.test(c)
  self.find :all, :include =&gt; :collection_sets, :conditions =&gt; { :'collection_sets.id' =&gt; c } 
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I understand that the options of a scope such as conditions are
passed directly to #find. So in this case it would be a bug in
#find rather than scopes themselves. This for example did not work
either:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;def self.test(c)
  self.find :all, :include =&amp;gt; :collection_sets, :conditions =&amp;gt; { :'collection_sets.id' =&amp;gt; c } 
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-26T17:20:18+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-26T17:20:19+01:00</updated-at>
      <user-id type="integer">38437</user-id>
      <version type="integer">6</version>
      <user-name>Luciano G. Panaro</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 verified

I have attached a test case that demonstrates the error on the #find method (as per Luciano's finding).</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified&lt;/p&gt;
&lt;p&gt;I have attached a test case that demonstrates the error on the
#find method (as per Luciano's finding).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-26T22:36:04+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-26T22:36:08+01:00</updated-at>
      <user-id type="integer">24346</user-id>
      <version type="integer">7</version>
      <user-name>John Trupiano</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>So it turns out the culprit was using symbols for keys in the conditions hash.  Had you conversely used a string instead, this query would have worked.

I have updated my previous patch with the one line fix to associations.rb to allow symbols as keys.</body>
      <body-html>&lt;div&gt;&lt;p&gt;So it turns out the culprit was using symbols for keys in the
conditions hash. Had you conversely used a string instead, this
query would have worked.&lt;/p&gt;
&lt;p&gt;I have updated my previous patch with the one line fix to
associations.rb to allow symbols as keys.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-27T00:55:48+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-27T00:55:55+01:00</updated-at>
      <user-id type="integer">24346</user-id>
      <version type="integer">8</version>
      <user-name>John Trupiano</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 verified on 2-3-stable and Master,
patch however, applies cleanly only on 2-3-stable.
i've attached a patch for master, (credits are mine, i have no idea how to notate them to someone else, sorry).</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified on 2-3-stable and Master, patch however, applies
cleanly only on 2-3-stable.&lt;br&gt;
i've attached a patch for master, (credits are mine, i have no idea
how to notate them to someone else, sorry).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-27T04:17:39+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-27T04:17:41+01:00</updated-at>
      <user-id type="integer">36381</user-id>
      <version type="integer">9</version>
      <user-name>Elad Meidar</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>+1 verified.

Both patches apply clean (John's on 2-3-stable, Elad's on master) and all tests pass.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified.&lt;/p&gt;
&lt;p&gt;Both patches apply clean (John's on 2-3-stable, Elad's on
master) and all tests pass.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-27T05:03:53+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-27T05:03:59+01:00</updated-at>
      <user-id type="integer">71121</user-id>
      <version type="integer">10</version>
      <user-name>sr.iniv.t</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-27T11:48:55+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.3 :include activerecord bugmash error ignored named_scope sql
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash bugmash-review error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-27T11:48:57+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">11</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-27T12:33:15+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.3 :include activerecord bugmash bugmash-review error ignored named_scope sql
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash-review error ignored named_scope sql</tag>
      <title>named_scope ignores :include option</title>
      <updated-at type="datetime">2009-09-27T12:33:16+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">12</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>This patch is good to be applied.  Just changing the name to include PATCH and better describe the actual patch (original bug report was just a derivative manifestation of the real bug).</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch is good to be applied. Just changing the name to
include PATCH and better describe the actual patch (original bug
report was just a derivative manifestation of the real bug).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-29T12:56:24+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:title: named_scope ignores :include option
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 :include activerecord bugmash-review error ignored named_scope sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2009-09-29T12:56:30+01:00</updated-at>
      <user-id type="integer">24346</user-id>
      <version type="integer">13</version>
      <user-name>John Trupiano</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Any news?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any news?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-05T20:41:26+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.3 :include activerecord bugmash-review error ignored named_scope sql
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash-review error ignored named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2009-10-05T20:41:50+01:00</updated-at>
      <user-id type="integer">18453</user-id>
      <version type="integer">14</version>
      <user-name>iGEL</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I would love to see this one applied.  Duplicate bugs (e.g. https://rails.lighthouseapp.com/projects/8994/tickets/3316-has_many-through-with-conditions-fails ) continue to be reported.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I would love to see this one applied. Duplicate bugs (e.g.
&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3316-has_many-through-with-conditions-fails&quot;&gt;
https://rails.lighthouseapp.com/projects/8994/tickets/3316-has_many...&lt;/a&gt;
) continue to be reported.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-05T20:51:35+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash-review error ignored named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2009-10-05T20:57:27+01:00</updated-at>
      <user-id type="integer">24346</user-id>
      <version type="integer">15</version>
      <user-name>John Trupiano</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>+1, just ran into this on 2.3.5 (after upgrading from 2.1.2 where it worked).</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1, just ran into this on 2.3.5 (after upgrading from 2.1.2
where it worked).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-14T12:01:09+00:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash-review error ignored named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2010-01-14T12:01:11+00:00</updated-at>
      <user-id type="integer">9958</user-id>
      <version type="integer">16</version>
      <user-name>Henrik Nyh</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Made a monkeypatch initializer that can be used until Johns patch is merged: http://gist.github.com/277141</body>
      <body-html>&lt;div&gt;&lt;p&gt;Made a monkeypatch initializer that can be used until Johns
patch is merged: &lt;a href=
&quot;http://gist.github.com/277141&quot;&gt;http://gist.github.com/277141&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-14T13:03:26+00:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash-review error ignored named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2010-01-14T13:03:27+00:00</updated-at>
      <user-id type="integer">9958</user-id>
      <version type="integer">17</version>
      <user-name>Henrik Nyh</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20085)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20085&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T18:45:38+01:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash-review error ignored named_scope patch sql
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash error ignored named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2010-05-15T18:45:38+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">18</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:38:53+00:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2-3-stable 2.3 2.3.5 3.0 :include activerecord bugmash error ignored named_scope patch sql
:priority: 0
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">130216</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2-3-stable 23 235 30 activerecord bugmash error ignored include named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2011-02-02T17:27:16+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">19</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:38:54+00:00</created-at>
      <creator-id type="integer">65300</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2998</number>
      <permalink>named_scope-ignores-include-option</permalink>
      <priority type="integer">130216</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2-3-stable 23 235 30 activerecord bugmash error ignored include named_scope patch sql</tag>
      <title>[PATCH] SQL generated by find ignores :include option</title>
      <updated-at type="datetime">2011-02-02T17:27:27+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">20</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Emery Finkelstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2998</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ffc36ae60e628ba2f1b409364054d7aded488563</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-09-26T22:36:04+01:00</created-at>
      <filename>failing_test_for_find_with_hash_conditions_and_include_on_has_many_through_association.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">279480</id>
      <size type="integer">1778</size>
      <uploader-id type="integer">24346</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/279480/failing_test_for_find_with_hash_conditions_and_include_on_has_many_through_association.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>3d2801d6de6ee2b605a0ade59d2dd78ff7ba0a8d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-09-27T00:55:48+01:00</created-at>
      <filename>2988-allow_keys_to_be_symbols_in_conditions_hash_when_finding_with_has_many_through.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">279516</id>
      <size type="integer">2743</size>
      <uploader-id type="integer">24346</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/279516/2988-allow_keys_to_be_symbols_in_conditions_hash_when_finding_with_has_many_through.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>c87d86a844d0c73269a44a60669ed7bbf12bd436</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-09-27T04:17:39+01:00</created-at>
      <filename>LH2998-named_scope_ignores_include_symbol_patch-master.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">279568</id>
      <size type="integer">2457</size>
      <uploader-id type="integer">36381</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/279568/LH2998-named_scope_ignores_include_symbol_patch-master.diff</url>
    </attachment>
  </attachments>
</ticket>
