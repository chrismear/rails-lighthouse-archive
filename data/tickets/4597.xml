<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">15316</assigned-user-id>
  <attachments-count type="integer">6</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-14T07:28:43+00:00</created-at>
  <creator-id type="integer">22054</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4597</number>
  <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>activerecord arel limit order patch postgresql</tag>
  <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
  <updated-at type="datetime">2011-02-14T07:28:43+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">29</version>
  <user-name>Repository</user-name>
  <creator-name>Adam Keys</creator-name>
  <assigned-user-name>Aaron Patterson</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>If one creates a query that uses both limits and order clauses that contain punctuation, column aliases are put in the wrong place and an invalid query is generated.

For example:

@@@ ruby
# Works
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
# Fails (note the comma)
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
@@@

The correct query looks like this:

@@@ sql
 SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0
@@@

The incorrect query ends up like this (note the placement of the first `AS`):

@@@ sql
SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0, COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_1 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 20 OFFSET 0
@@@

If the `limit` is removed, the query is generated properly, regardless of `order` clause.

This script shows a couple working order clauses and one that doesn't.

@@@ ruby
logger = Logger.new(STDOUT)
ActiveRecord::Base.logger = logger
ActiveRecord::Base.colorize_logging = false

working = [&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;,
  &quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(lat)))&quot;]
not_working = [&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;]

(working + not_working).each do |order|
  begin
    # Spots can belong to multiple trips. Each spot has a lat/lng pair.
    Trip.includes(:spots).offset(0).limit(20).order(order).all
    logger.info &quot;Good: #{order}&quot;
  rescue =&gt; e
    logger.info &quot;Bad: #{order}&quot;
    logger.debug e
  end
end
@@@

The output of said script is attached.</original-body>
  <latest-body>If one creates a query that uses both limits and order clauses that contain punctuation, column aliases are put in the wrong place and an invalid query is generated.

For example:

@@@ ruby
# Works
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
# Fails (note the comma)
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
@@@

The correct query looks like this:

@@@ sql
 SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0
@@@

The incorrect query ends up like this (note the placement of the first `AS`):

@@@ sql
SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0, COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_1 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 20 OFFSET 0
@@@

If the `limit` is removed, the query is generated properly, regardless of `order` clause.

This script shows a couple working order clauses and one that doesn't.

@@@ ruby
logger = Logger.new(STDOUT)
ActiveRecord::Base.logger = logger
ActiveRecord::Base.colorize_logging = false

working = [&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;,
  &quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(lat)))&quot;]
not_working = [&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;]

(working + not_working).each do |order|
  begin
    # Spots can belong to multiple trips. Each spot has a lat/lng pair.
    Trip.includes(:spots).offset(0).limit(20).order(order).all
    logger.info &quot;Good: #{order}&quot;
  rescue =&gt; e
    logger.info &quot;Bad: #{order}&quot;
    logger.debug e
  end
end
@@@

The output of said script is attached.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;If one creates a query that uses both limits and order clauses
that contain punctuation, column aliases are put in the wrong place
and an invalid query is generated.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;# Works
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
# Fails (note the comma)
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The correct query looks like this:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt; SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The incorrect query ends up like this (note the placement of the
first &lt;code&gt;AS&lt;/code&gt;):&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0, COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_1 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 20 OFFSET 0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If the &lt;code&gt;limit&lt;/code&gt; is removed, the query is generated
properly, regardless of &lt;code&gt;order&lt;/code&gt; clause.&lt;/p&gt;
&lt;p&gt;This script shows a couple working order clauses and one that
doesn't.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;logger = Logger.new(STDOUT)
ActiveRecord::Base.logger = logger
ActiveRecord::Base.colorize_logging = false

working = [&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;,
  &quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(lat)))&quot;]
not_working = [&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;]

(working + not_working).each do |order|
  begin
    # Spots can belong to multiple trips. Each spot has a lat/lng pair.
    Trip.includes(:spots).offset(0).limit(20).order(order).all
    logger.info &quot;Good: #{order}&quot;
  rescue =&amp;gt; e
    logger.info &quot;Bad: #{order}&quot;
    logger.debug e
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The output of said script is attached.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>If one creates a query that uses both limits and order clauses that contain punctuation, column aliases are put in the wrong place and an invalid query is generated.

For example:

@@@ ruby
# Works
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
# Fails (note the comma)
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
@@@

The correct query looks like this:

@@@ sql
 SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0
@@@

The incorrect query ends up like this (note the placement of the first `AS`):

@@@ sql
SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0, COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_1 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 20 OFFSET 0
@@@

If the `limit` is removed, the query is generated properly, regardless of `order` clause.

This script shows a couple working order clauses and one that doesn't.

@@@ ruby
logger = Logger.new(STDOUT)
ActiveRecord::Base.logger = logger
ActiveRecord::Base.colorize_logging = false

working = [&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;,
  &quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(lat)))&quot;]
not_working = [&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;]

(working + not_working).each do |order|
  begin
    # Spots can belong to multiple trips. Each spot has a lat/lng pair.
    Trip.includes(:spots).offset(0).limit(20).order(order).all
    logger.info &quot;Good: #{order}&quot;
  rescue =&gt; e
    logger.info &quot;Bad: #{order}&quot;
    logger.debug e
  end
end
@@@

The output of said script is attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;If one creates a query that uses both limits and order clauses
that contain punctuation, column aliases are put in the wrong place
and an invalid query is generated.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;# Works
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all
# Fails (note the comma)
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The correct query looks like this:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt; SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The incorrect query ends up like this (note the placement of the
first &lt;code&gt;AS&lt;/code&gt;):&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0, COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_1 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 20 OFFSET 0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If the &lt;code&gt;limit&lt;/code&gt; is removed, the query is generated
properly, regardless of &lt;code&gt;order&lt;/code&gt; clause.&lt;/p&gt;
&lt;p&gt;This script shows a couple working order clauses and one that
doesn't.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;logger = Logger.new(STDOUT)
ActiveRecord::Base.logger = logger
ActiveRecord::Base.colorize_logging = false

working = [&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;,
  &quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(lat)))&quot;]
not_working = [&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;]

(working + not_working).each do |order|
  begin
    # Spots can belong to multiple trips. Each spot has a lat/lng pair.
    Trip.includes(:spots).offset(0).limit(20).order(order).all
    logger.info &quot;Good: #{order}&quot;
  rescue =&amp;gt; e
    logger.info &quot;Bad: #{order}&quot;
    logger.debug e
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The output of said script is attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-14T22:34:49+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-14T22:34:52+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">1</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is occurring under rails-3.0.0.beta3.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is occurring under rails-3.0.0.beta3.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-14T22:36:58+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-14T22:37:00+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">2</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Can you provide a test case?
And please try on master</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you provide a test case?&lt;br&gt;
And please try on master&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-14T23:19:49+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-14T23:19:51+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">3</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sure. Attached is a patch to add the test case and the result I get when run against PostgreSQL. I ran this against a recent clone of master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sure. Attached is a patch to add the test case and the result I
get when run against PostgreSQL. I ran this against a recent clone
of master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T16:02:07+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T16:02:10+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">4</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Ok i'm going to try with your info, thx</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ok i'm going to try with your info, thx&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T17:01:27+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T17:01:30+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">5</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Adam Keys the wrong thing here is that you are doing ...

Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).all

and expecting the order method to add things on the select part of the query

SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(COS(1)*COS(-1)*COS(RADIANS(spots.lat))) AS alias_0 FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; = &quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20 OFFSET 0</body>
      <body-html>&lt;div&gt;&lt;p&gt;Adam Keys the wrong thing here is that you are doing ...&lt;/p&gt;
&lt;p&gt;
Trip.includes(:spots).offset(0).limit(20).order(&quot;LEAST(COS(1)&lt;em&gt;COS(-1)&lt;/em&gt;COS(RADIANS(spots.lat)))&quot;).all&lt;/p&gt;
&lt;p&gt;and expecting the order method to add things on the select part
of the query&lt;/p&gt;
&lt;p&gt;SELECT * FROM (SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id,
LEAST(COS(1)&lt;em&gt;COS(-1)&lt;/em&gt;COS(RADIANS(spots.lat))) AS alias_0
FROM &quot;trips&quot; LEFT OUTER JOIN &quot;waypoints&quot; ON &quot;trips&quot;.&quot;id&quot; =
&quot;waypoints&quot;.&quot;trip_id&quot; LEFT OUTER JOIN &quot;spots&quot; ON &quot;spots&quot;.&quot;id&quot; =
&quot;waypoints&quot;.&quot;spot_id&quot;) AS id_list ORDER BY id_list.alias_0 LIMIT 20
OFFSET 0&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T20:11:43+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T20:11:47+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">6</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Perhaps you misspeled order and tried to do another thing, please fix it if this is the case</body>
      <body-html>&lt;div&gt;&lt;p&gt;Perhaps you misspeled order and tried to do another thing,
please fix it if this is the case&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T20:12:42+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T20:12:43+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T20:41:52+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>bugmash</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T20:41:54+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">8</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>The reason I believe this is a bug is that it works when there is no `limit` clause. Removing it produces this valid query:

@@@ sql
SELECT     &quot;tags&quot;.&quot;id&quot; AS t0_r0, &quot;tags&quot;.&quot;name&quot; AS t0_r1, &quot;tags&quot;.&quot;taggings_count&quot; AS t0_r2, &quot;taggings&quot;.&quot;id&quot; AS t1_r0, &quot;taggings&quot;.&quot;tag_id&quot; AS t1_r1, &quot;taggings&quot;.&quot;super_tag_id&quot; AS t1_r2, &quot;taggings&quot;.&quot;taggable_type&quot; AS t1_r3, &quot;taggings&quot;.&quot;taggable_id&quot; AS t1_r4 FROM       &quot;tags&quot; LEFT OUTER JOIN &quot;taggings&quot; ON &quot;taggings&quot;.&quot;tag_id&quot; = &quot;tags&quot;.&quot;id&quot; ORDER BY  LEAST(1,COS(1)*COS(-1)*COS(RADIANS(taggings.taggings_count)))
@@@

The query I have in the test case isn't exactly right for the test schema, but I'm certain that generating this bit of SQL is not correct:

@@@ sql
SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0,
@@@

The alias inside the function call is how this bug manifests itself.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The reason I believe this is a bug is that it works when there
is no &lt;code&gt;limit&lt;/code&gt; clause. Removing it produces this valid
query:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;SELECT     &quot;tags&quot;.&quot;id&quot; AS t0_r0, &quot;tags&quot;.&quot;name&quot; AS t0_r1, &quot;tags&quot;.&quot;taggings_count&quot; AS t0_r2, &quot;taggings&quot;.&quot;id&quot; AS t1_r0, &quot;taggings&quot;.&quot;tag_id&quot; AS t1_r1, &quot;taggings&quot;.&quot;super_tag_id&quot; AS t1_r2, &quot;taggings&quot;.&quot;taggable_type&quot; AS t1_r3, &quot;taggings&quot;.&quot;taggable_id&quot; AS t1_r4 FROM       &quot;tags&quot; LEFT OUTER JOIN &quot;taggings&quot; ON &quot;taggings&quot;.&quot;tag_id&quot; = &quot;tags&quot;.&quot;id&quot; ORDER BY  LEAST(1,COS(1)*COS(-1)*COS(RADIANS(taggings.taggings_count)))&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The query I have in the test case isn't exactly right for the
test schema, but I'm certain that generating this bit of SQL is not
correct:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;sql&quot;&gt;SELECT DISTINCT ON (&quot;trips&quot;.id) &quot;trips&quot;.id, LEAST(1 AS alias_0,&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The alias inside the function call is how this bug manifests
itself.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T20:49:48+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>bugmash</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T20:49:50+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">9</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Here's a better testcase. Remove the limit and the query is fine but the assert fails. Leave it in and the query is invalid.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's a better testcase. Remove the limit and the query is fine
but the assert fails. Leave it in and the query is invalid.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-15T21:09:30+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>bugmash</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-15T21:09:32+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">10</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Santiago, could you please review the most recent testcase attached above and clear the invalid flag on this ticket? I believe this is a bonafide bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Santiago, could you please review the most recent testcase
attached above and clear the invalid flag on this ticket? I believe
this is a bonafide bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-05-18T15:54:02+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>bugmash</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-18T15:54:04+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">11</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-20T22:14:01+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-20T22:14:02+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">12</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>First of all sorry for closing the ticket, i hadn't understood it really well. 

The issue here is .order(str) and str containing comma inside of expressions when used with limit
as in order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;).limit(1)
       this comma  ^^^

I propose to deprecate/remove the following use order(&quot;column1, column2&quot;) in favor of order([&quot;column1&quot;, &quot;column2&quot;]) which is also a cleaner usage.
If not trying to deal with both cases order(&quot;column1, column2&quot;) and order(&quot;LEAST(1,COS(1)*COS(-1)*COS(RADIANS(spots.lat)))&quot;) the split by comma done in activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:853 couldn't be and we should manage with a StringScanner taking care about things like ((,)),((,)) in we only want to split by the middle comma.

With this API change accepted we have to do a thsi minimal patch for Arel see here http://github.com/spastorino/arel/commit/6e4b421ac394a4c18d8d35d6a6860c6ae0cb3a4f

And apply this patch on master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;First of all sorry for closing the ticket, i hadn't understood
it really well.&lt;/p&gt;
&lt;p&gt;The issue here is .order(str) and str containing comma inside of
expressions when used with limit&lt;br&gt;
as in
order(&quot;LEAST(1,COS(1)&lt;em&gt;COS(-1)&lt;/em&gt;COS(RADIANS(spots.lat)))&quot;).limit(1)&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;   this comma  ^^^&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I propose to deprecate/remove the following use order(&quot;column1,
column2&quot;) in favor of order([&quot;column1&quot;, &quot;column2&quot;]) which is also a
cleaner usage.&lt;br&gt;
If not trying to deal with both cases order(&quot;column1, column2&quot;) and
order(&quot;LEAST(1,COS(1)&lt;em&gt;COS(-1)&lt;/em&gt;COS(RADIANS(spots.lat)))&quot;) the
split by comma done in
activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:853
couldn't be and we should manage with a StringScanner taking care
about things like ((,)),((,)) in we only want to split by the
middle comma.&lt;/p&gt;
&lt;p&gt;With this API change accepted we have to do a thsi minimal patch
for Arel see here &lt;a href=
&quot;http://github.com/spastorino/arel/commit/6e4b421ac394a4c18d8d35d6a6860c6ae0cb3a4f&quot;&gt;
http://github.com/spastorino/arel/commit/6e4b421ac394a4c18d8d35d6a6...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And apply this patch on master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-21T04:53:42+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: bugmash
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-21T04:53:51+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">13</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>The previous patch makes SQLite fail because it doesn't support LEAST function.
This is the right one.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The previous patch makes SQLite fail because it doesn't support
LEAST function.&lt;br&gt;
This is the right one.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-21T11:44:34+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-21T11:44:46+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">14</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I applied the patch above and got one failure when I ran the PostgreSQL relation tests:

@@@
  1) Error:
test_finding_with_complex_order_and_limit(RelationTest):
ActiveRecord::StatementInvalid: PGError: ERROR:  column id_list.alias_1 does not exist
LINE 1: ...tags&quot;.&quot;id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.al...
                                                             ^
: SELECT * FROM (SELECT DISTINCT ON (&quot;tags&quot;.id) &quot;tags&quot;.id, LEAST(1,COS(1)*COS(-1)*COS(RADIANS(taggings.super_tag_id))) AS alias_0 FROM &quot;tags&quot; LEFT OUTER JOIN &quot;taggings&quot; ON &quot;taggings&quot;.&quot;tag_id&quot; = &quot;tags&quot;.&quot;id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 1
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb:210:in `log'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:464:in `execute_without_query_record'
    ./test/cases/helper.rb:40:in `execute'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:954:in `select_raw'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:941:in `select'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:56:in `select_all'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/base.rb:431:in `find_by_sql'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:64:in `to_a'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:12:in `collect'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:221:in `construct_limited_ids_condition'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:208:in `apply_join_dependency'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:197:in `construct_relation_for_association_find'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:182:in `find_with_associations'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:64:in `to_a'
    ./test/cases/relations_test.rb:102:in `test_finding_with_complex_order_and_limit'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:67:in `run'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/callbacks.rb:414:in `_run_setup_callbacks'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:65:in `run'
@@@

Will give it a look tomorrow.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I applied the patch above and got one failure when I ran the
PostgreSQL relation tests:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;  1) Error:
test_finding_with_complex_order_and_limit(RelationTest):
ActiveRecord::StatementInvalid: PGError: ERROR:  column id_list.alias_1 does not exist
LINE 1: ...tags&quot;.&quot;id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.al...
                                                             ^
: SELECT * FROM (SELECT DISTINCT ON (&quot;tags&quot;.id) &quot;tags&quot;.id, LEAST(1,COS(1)*COS(-1)*COS(RADIANS(taggings.super_tag_id))) AS alias_0 FROM &quot;tags&quot; LEFT OUTER JOIN &quot;taggings&quot; ON &quot;taggings&quot;.&quot;tag_id&quot; = &quot;tags&quot;.&quot;id&quot;) AS id_list ORDER BY id_list.alias_0 , id_list.alias_1  LIMIT 1
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb:210:in `log'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:464:in `execute_without_query_record'
    ./test/cases/helper.rb:40:in `execute'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:954:in `select_raw'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:941:in `select'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:56:in `select_all'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/base.rb:431:in `find_by_sql'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:64:in `to_a'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:12:in `collect'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:221:in `construct_limited_ids_condition'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:208:in `apply_join_dependency'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:197:in `construct_relation_for_association_find'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation/finder_methods.rb:182:in `find_with_associations'
    /Users/adam/Desktop/In/rails/activerecord/lib/active_record/relation.rb:64:in `to_a'
    ./test/cases/relations_test.rb:102:in `test_finding_with_complex_order_and_limit'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:67:in `__send__'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:67:in `run'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/callbacks.rb:414:in `_run_setup_callbacks'
    /Users/adam/Desktop/In/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:65:in `run'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Will give it a look tomorrow.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-21T20:59:15+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-21T20:59:21+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">15</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Adam you have to patch Arel too</body>
      <body-html>&lt;div&gt;&lt;p&gt;Adam you have to patch Arel too&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-21T22:01:15+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-21T22:01:20+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">16</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-22T00:45:30+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 40272
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-22T00:47:14+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">17</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>+1

I switched my bundle to use your fork of arel and, with your patch, everything is passing.

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;
&lt;p&gt;I switched my bundle to use your fork of arel and, with your
patch, everything is passing.&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T00:29:56+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-23T00:30:01+01:00</updated-at>
      <user-id type="integer">22054</user-id>
      <version type="integer">18</version>
      <user-name>Adam Keys</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I've thought on other approaches less obtrusives than this, but need to talk to Jeremy Kemper about this.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've thought on other approaches less obtrusives than this, but
need to talk to Jeremy Kemper about this.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T02:01:57+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-23T02:02:03+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">19</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Passing an array makes sense. What about deprecation in 2.3.7?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Passing an array makes sense. What about deprecation in
2.3.7?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T21:20:15+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-05-23T21:20:20+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">20</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Any updates here?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any updates here?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-03T08:01:14+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-08-03T08:01:16+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">21</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-03T16:44:05+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 85
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-08-03T16:44:08+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">22</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:33+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-08-30T04:10:33+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">23</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:53+01:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-10-15T23:01:53+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">24</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-04T22:08:44+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 40272
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-11-04T22:08:50+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">25</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>@Adam can you try this again against 3-0-stable with ARel 2.0.0?  I think this is fixed, but I don't know that the number of return rows is correct.

By &quot;fixed&quot;, I mean valid SQL is returned.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Adam can you try this again against 3-0-stable with ARel 2.0.0?
I think this is fixed, but I don't know that the number of return
rows is correct.&lt;/p&gt;
&lt;p&gt;By &quot;fixed&quot;, I mean valid SQL is returned.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-04T22:27:21+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-11-04T22:27:26+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">26</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-04T22:27:39+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-11-04T22:27:41+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">27</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I've tried again and is not working. The problem is in the distinct method of postgresql.
We are going to try some things with Aaron and get back to you.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've tried again and is not working. The problem is in the
distinct method of postgresql.&lt;br&gt;
We are going to try some things with Aaron and get back to you.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-04T23:28:48+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:state: needs-more-info
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-11-04T23:28:54+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">28</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>(from [3146aa68fd03ea4392b45f1c8771675a9c850471]) Fixes queries using limits and punctuation in order, removes order(&quot;col1, col2&quot;) usage in favor of order([&quot;col1&quot;, &quot;col2&quot;})

[#4597 state:committed]
https://github.com/rails/rails/commit/3146aa68fd03ea4392b45f1c8771675a9c850471</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/3146aa68fd03ea4392b45f1c8771675a9c850471&quot;
title=
&quot;Changeset [3146aa68fd03ea4392b45f1c8771675a9c850471]&quot;&gt;[3146aa68fd03ea4392b45f1c8771675a9c850471]&lt;/a&gt;)
Fixes queries using limits and punctuation in order, removes
order(&quot;col1, col2&quot;) usage in favor of order([&quot;col1&quot;, &quot;col2&quot;})&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/4597&quot; title=
&quot;Ticket #4597&quot;&gt;#4597&lt;/a&gt; state:committed] &lt;a href=
&quot;https://github.com/rails/rails/commit/3146aa68fd03ea4392b45f1c8771675a9c850471&quot;&gt;
https://github.com/rails/rails/commit/3146aa68fd03ea4392b45f1c87716...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-05T18:29:29+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2010-11-05T18:29:32+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">29</version>
      <user-name>Repository</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>thank you very much......&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/&quot;&gt;&#1605;&#1606;&#1578;&#1583;&#1610;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&#1605;&#1603;&#1610;&#1575;&#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1575;&#1586;&#1610;&#1575;&#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1601;&#1587;&#1575;&#1578;&#1610;&#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&#1585;&#1587;&#1575;&#1574;&#1604; 
- &#1605;&#1587;&#1580;&#1575;&#1578; - &#1608;&#1587;&#1575;&#1574;&#1591;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&#1578;&#1608;&#1576;&#1610;&#1603;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&#1608;&#1592;&#1575;&#1574;&#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&#1576;&#1585;&#1608;&#1603;&#1587;&#1610;&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=&quot;http://forum.line-sport.tv/&quot;&gt;&#1604;&#1575;&#1610;&#1606; &#1587;&#1576;&#1608;&#1585;&#1578;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;thank you very much......&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/&quot;&gt;&amp;#1605;&amp;#1606;&amp;#1578;&amp;#1583;&amp;#1610;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&amp;#1605;&amp;#1603;&amp;#1610;&amp;#1575;&amp;#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1575;&amp;#1586;&amp;#1610;&amp;#1575;&amp;#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1601;&amp;#1587;&amp;#1575;&amp;#1578;&amp;#1610;&amp;#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&amp;#1585;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1604;&lt;br&gt;
- &amp;#1605;&amp;#1587;&amp;#1580;&amp;#1575;&amp;#1578; -
&amp;#1608;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1591;&lt;/a&gt;&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&amp;#1578;&amp;#1608;&amp;#1576;&amp;#1610;&amp;#1603;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&amp;#1608;&amp;#1592;&amp;#1575;&amp;#1574;&amp;#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt;
&lt;a href=
&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&amp;#1576;&amp;#1585;&amp;#1608;&amp;#1603;&amp;#1587;&amp;#1610;&lt;/a&gt;
&lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=
&quot;http://forum.line-sport.tv/&quot;&gt;&amp;#1604;&amp;#1575;&amp;#1610;&amp;#1606;
&amp;#1587;&amp;#1576;&amp;#1608;&amp;#1585;&amp;#1578;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-08T11:22:29+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2011-02-08T12:16:07+00:00</updated-at>
      <user-id type="integer">136126</user-id>
      <version type="integer">30</version>
      <user-name>alasiri1</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You possibly can buy beauty drops you can aquire with many different patterns similar to the triangular as well as rectangle-shaped varieties.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; To help while recognize touch available practically expression along with damaged in almost any necklace around your neck.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&#160;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; Just in case alphabets will never get that promotion using a man, &lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;use those who obtain out of all kinds of other communities as an example food including cakes,&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; crops and so forth</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You
possibly can buy beauty drops you can aquire with many different
patterns similar to the triangular as well as rectangle-shaped
varieties.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras
Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; To help while recognize touch available
practically expression along with damaged in almost any necklace
around your neck.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&amp;nbsp;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;
Just in case alphabets will never get that promotion using a man,
&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora
ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;use those who obtain out of all kinds of
other communities as an example food including
cakes,&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora
NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; crops and so forth&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-14T06:15:18+00:00</created-at>
      <creator-id type="integer">22054</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4597</number>
      <permalink>queries-using-limits-and-punctuation-in-order-clauses-generate-invalid-sql</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord arel limit order patch postgresql</tag>
      <title>Queries using limits and punctuation in order clauses generate invalid SQL </title>
      <updated-at type="datetime">2011-02-14T07:28:43+00:00</updated-at>
      <user-id type="integer">136876</user-id>
      <version type="integer">31</version>
      <user-name>pandora jewellry</user-name>
      <creator-name>Adam Keys</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4597</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>1aa5305f2611392e5ef15b99ee4a7054378949d5</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-14T22:34:49+01:00</created-at>
      <filename>bug.txt</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522279</id>
      <size type="integer">5004</size>
      <uploader-id type="integer">22054</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522279/bug.txt</url>
    </attachment>
    <attachment type="Attachment">
      <code>b3a43eb384635c195531b220519ca3135dc78c69</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-15T16:02:07+01:00</created-at>
      <filename>testcase.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522624</id>
      <size type="integer">1002</size>
      <uploader-id type="integer">22054</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522624/testcase.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>2f6c96c3d0dbaa0f98aa45bc379184ad45ec68bd</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-15T16:02:07+01:00</created-at>
      <filename>fail.txt</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522625</id>
      <size type="integer">3106</size>
      <uploader-id type="integer">22054</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522625/fail.txt</url>
    </attachment>
    <attachment type="Attachment">
      <code>232bf64f11f2dca58a3dc9fb8ae6233f25d4d68a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-15T21:09:30+01:00</created-at>
      <filename>testcase.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">522703</id>
      <size type="integer">1482</size>
      <uploader-id type="integer">22054</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/522703/testcase.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>5732aa4e91cbee25152c9df71f745e989b6624cc</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-21T04:53:42+01:00</created-at>
      <filename>limits_and_punctiation_in_order.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">529476</id>
      <size type="integer">6094</size>
      <uploader-id type="integer">40272</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/529476/limits_and_punctiation_in_order.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>e681ff121addcdcc83505633e9ab40c18bc5e50c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-05-21T11:44:34+01:00</created-at>
      <filename>limits_and_punctuation_in_order.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">529703</id>
      <size type="integer">6351</size>
      <uploader-id type="integer">40272</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/529703/limits_and_punctuation_in_order.patch</url>
    </attachment>
  </attachments>
</ticket>
