<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-07-24T10:41:44+01:00</created-at>
  <creator-id type="integer">63892</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">2947</number>
  <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
  <priority type="integer">2026</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activeresource</tag>
  <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
  <updated-at type="datetime">2009-08-09T10:30:00+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">8</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Ben</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>ActiveResource provides a timeout variable: &quot;Active Resource relies on HTTP to access RESTful APIs and as such is inherently susceptible to slow or unresponsive servers. In such cases, your Active Resource method calls could \timeout. You can control the amount of time before Active Resource times out with the timeout variable. &quot;

However, the timeout value only sets the read_timeout on the underlying Net:HTTP object, not the open_timeout. This means that if a hostname resolves for an ActiveResource request, but there's no server to respond (or the server doesn't respond), the timeout value set in the ActiveResource subclass will not be adhered to. Modifying the ActiveResource::Connection class to also set the http object's open_timeout value should resolve the issue.</original-body>
  <latest-body>ActiveResource provides a timeout variable: &quot;Active Resource relies on HTTP to access RESTful APIs and as such is inherently susceptible to slow or unresponsive servers. In such cases, your Active Resource method calls could \timeout. You can control the amount of time before Active Resource times out with the timeout variable. &quot;

However, the timeout value only sets the read_timeout on the underlying Net:HTTP object, not the open_timeout. This means that if a hostname resolves for an ActiveResource request, but there's no server to respond (or the server doesn't respond), the timeout value set in the ActiveResource subclass will not be adhered to. Modifying the ActiveResource::Connection class to also set the http object's open_timeout value should resolve the issue.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;ActiveResource provides a timeout variable: &quot;Active Resource
relies on HTTP to access RESTful APIs and as such is inherently
susceptible to slow or unresponsive servers. In such cases, your
Active Resource method calls could \timeout. You can control the
amount of time before Active Resource times out with the timeout
variable. &quot;&lt;/p&gt;
&lt;p&gt;However, the timeout value only sets the read_timeout on the
underlying Net:HTTP object, not the open_timeout. This means that
if a hostname resolves for an ActiveResource request, but there's
no server to respond (or the server doesn't respond), the timeout
value set in the ActiveResource subclass will not be adhered to.
Modifying the ActiveResource::Connection class to also set the http
object's open_timeout value should resolve the issue.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>ActiveResource provides a timeout variable: &quot;Active Resource relies on HTTP to access RESTful APIs and as such is inherently susceptible to slow or unresponsive servers. In such cases, your Active Resource method calls could \timeout. You can control the amount of time before Active Resource times out with the timeout variable. &quot;

However, the timeout value only sets the read_timeout on the underlying Net:HTTP object, not the open_timeout. This means that if a hostname resolves for an ActiveResource request, but there's no server to respond (or the server doesn't respond), the timeout value set in the ActiveResource subclass will not be adhered to. Modifying the ActiveResource::Connection class to also set the http object's open_timeout value should resolve the issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;ActiveResource provides a timeout variable: &quot;Active Resource
relies on HTTP to access RESTful APIs and as such is inherently
susceptible to slow or unresponsive servers. In such cases, your
Active Resource method calls could \timeout. You can control the
amount of time before Active Resource times out with the timeout
variable. &quot;&lt;/p&gt;
&lt;p&gt;However, the timeout value only sets the read_timeout on the
underlying Net:HTTP object, not the open_timeout. This means that
if a hostname resolves for an ActiveResource request, but there's
no server to respond (or the server doesn't respond), the timeout
value set in the ActiveResource subclass will not be adhered to.
Modifying the ActiveResource::Connection class to also set the http
object's open_timeout value should resolve the issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-24T10:41:44+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activeresource</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-07-24T10:41:50+01:00</updated-at>
      <user-id type="integer">63892</user-id>
      <version type="integer">1</version>
      <user-name>Ben</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-03T06:06:06+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activeresource
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-03T06:06:09+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 on this. read_timeout helps when the connection is open and is slow to serve up its goods, but does nothing about a slow response when opening in the first place.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 on this. read_timeout helps when the connection is open and
is slow to serve up its goods, but does nothing about a slow
response when opening in the first place.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T23:46:21+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-08T23:46:24+01:00</updated-at>
      <user-id type="integer">10504</user-id>
      <version type="integer">3</version>
      <user-name>Josh Nichols</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can't create a patch, however i dug into this and here is what i've found.

We need to simply add the open_timeout to accept the timeout variable, so no additional functionality/arg's need to be changed in a person's app code.  If they used timeout before, we simply take that same variable and apply it to Net::HTTP#opne_timeout, which is the variable you want to use if there is NO connection to a server.  it appears the read_timeout variable is applied if you get a response but then nothing comes back, which as  you can tell, is different then from being shut out of the server altogether.

Here is the code.

@@@ ruby
Line 139ish... 
http.open_timeout = @timeout ||= 60 #default to 60 seconds. currently default is never.
@@@ 

I've used the rdocs for Net::HTTP to verify the open_timeout method here: 

&gt; &gt; open_timeout  	 [RW]   	Seconds to wait until connection is opened. If the HTTP object cannot open a connection in this many seconds, it raises a TimeoutError exception. 

Net::HTTP open_timeout doesn't have a default value however, it's set to nil == forever, so we set it to 60 seconds, to match the read_timeout variable's default in Net::HTTP.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can't create a patch, however i dug into this and here is what
i've found.&lt;/p&gt;
&lt;p&gt;We need to simply add the open_timeout to accept the timeout
variable, so no additional functionality/arg's need to be changed
in a person's app code. If they used timeout before, we simply take
that same variable and apply it to Net::HTTP#opne_timeout, which is
the variable you want to use if there is NO connection to a server.
it appears the read_timeout variable is applied if you get a
response but then nothing comes back, which as you can tell, is
different then from being shut out of the server altogether.&lt;/p&gt;
&lt;p&gt;Here is the code.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Line 139ish... 
http.open_timeout = @timeout ||= 60 #default to 60 seconds. currently default is never.&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I've used the rdocs for Net::HTTP to verify the open_timeout
method here:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;open_timeout &lt;a href=&quot;/projects/8994/changesets/RW&quot; title=
&quot;Changeset [RW]&quot;&gt;[RW]&lt;/a&gt; Seconds to wait until connection is
opened. If the HTTP object cannot open a connection in this many
seconds, it raises a TimeoutError exception.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Net::HTTP open_timeout doesn't have a default value however,
it's set to nil == forever, so we set it to 60 seconds, to match
the read_timeout variable's default in Net::HTTP.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-09T02:10:28+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-09T02:10:34+01:00</updated-at>
      <user-id type="integer">32315</user-id>
      <version type="integer">4</version>
      <user-name>pjammer</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Attached a patch to deal with this.

There's a couple of complications. Mainly, the 'http' method is what is building the Net::HTTP object. This would be fine, except that that lib/active_resource/http_mock overrides this entirely to use itself (ActiveResource::HttpMock). Considering this is kind of a public API, I didn't want to change the 'http' method, so instead, I created a 'build_http' method which handles the actual construction. I made a few tests which test that things happen sanely during build_http, including setting open_timeout.

I think some additional tests could be added for building the http object, but this should be enough for this particular issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached a patch to deal with this.&lt;/p&gt;
&lt;p&gt;There's a couple of complications. Mainly, the 'http' method is
what is building the Net::HTTP object. This would be fine, except
that that lib/active_resource/http_mock overrides this entirely to
use itself (ActiveResource::HttpMock). Considering this is kind of
a public API, I didn't want to change the 'http' method, so
instead, I created a 'build_http' method which handles the actual
construction. I made a few tests which test that things happen
sanely during build_http, including setting open_timeout.&lt;/p&gt;
&lt;p&gt;I think some additional tests could be added for building the
http object, but this should be enough for this particular
issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-09T07:45:47+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-09T07:45:49+01:00</updated-at>
      <user-id type="integer">10504</user-id>
      <version type="integer">5</version>
      <user-name>Josh Nichols</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [a0caad5255ed120192755fce10960a38b53c056d]) Setting connection timeout also affects Net::HTTP open_timeout.

[#2947 state:resolved]
http://github.com/rails/rails/commit/a0caad5255ed120192755fce10960a38b53c056d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/a0caad5255ed120192755fce10960a38b53c056d&quot;
title=
&quot;Changeset [a0caad5255ed120192755fce10960a38b53c056d]&quot;&gt;[a0caad5255ed120192755fce10960a38b53c056d]&lt;/a&gt;)
Setting connection timeout also affects Net::HTTP open_timeout.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2947&quot; title=
&quot;Ticket #2947&quot;&gt;#2947&lt;/a&gt; state:resolved] &lt;a href=
&quot;http://github.com/rails/rails/commit/a0caad5255ed120192755fce10960a38b53c056d&quot;&gt;
http://github.com/rails/rails/commit/a0caad5255ed120192755fce10960a...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-09T10:29:17+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-09T10:29:19+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">6</version>
      <user-name>Repository</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [83cc7de2a47df199348cc47d2794a3f30ad4f4fb]) Setting connection timeout also affects Net::HTTP open_timeout.

[#2947 state:resolved]
http://github.com/rails/rails/commit/83cc7de2a47df199348cc47d2794a3f30ad4f4fb</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/83cc7de2a47df199348cc47d2794a3f30ad4f4fb&quot;
title=
&quot;Changeset [83cc7de2a47df199348cc47d2794a3f30ad4f4fb]&quot;&gt;[83cc7de2a47df199348cc47d2794a3f30ad4f4fb]&lt;/a&gt;)
Setting connection timeout also affects Net::HTTP open_timeout.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2947&quot; title=
&quot;Ticket #2947&quot;&gt;#2947&lt;/a&gt; state:resolved] &lt;a href=
&quot;http://github.com/rails/rails/commit/83cc7de2a47df199348cc47d2794a3f30ad4f4fb&quot;&gt;
http://github.com/rails/rails/commit/83cc7de2a47df199348cc47d2794a3...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-09T10:29:17+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activeresource bugmash</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-09T10:29:20+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">7</version>
      <user-name>Repository</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Josh, rebased your patch against the proxy change and updated the test to not need a mock.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Josh, rebased your patch against the proxy change and updated
the test to not need a mock.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-09T10:29:58+01:00</created-at>
      <creator-id type="integer">63892</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activeresource bugmash
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2947</number>
      <permalink>activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activeresource</tag>
      <title>ActiveResource timeout doesn't set open_timeout on underlying Net:HTTP object</title>
      <updated-at type="datetime">2009-08-09T10:30:00+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Ben</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2947</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>6faa736d4f297f320a7e2e4000e95e6d01398051</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-08-09T07:45:47+01:00</created-at>
      <filename>2947-activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">239293</id>
      <size type="integer">3471</size>
      <uploader-id type="integer">10504</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/239293/2947-activeresource-timeout-doesnt-set-open_timeout-on-underlying-nethttp-object.patch</url>
    </attachment>
  </attachments>
</ticket>
