<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2010-10-19T17:52:54+01:00</created-at>
  <creator-id type="integer">82933</creator-id>
  <milestone-due-on type="datetime">2011-03-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">103410</milestone-id>
  <number type="integer">5027</number>
  <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>needs-more-info</state>
  <tag nil="true"></tag>
  <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
  <updated-at type="datetime">2011-04-28T15:38:45+01:00</updated-at>
  <user-id type="integer">17051</user-id>
  <version type="integer">28</version>
  <user-name>Adam Bair</user-name>
  <creator-name>Garrett Bjerkhoel</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
  <milestone-title>3.0.6</milestone-title>
  <priority-name>High</priority-name>
  <original-body>In Rails master whenever an exception is raised, it takes a rough 30 seconds for the page to render completely with a number of `SHOW TABLES` MySQL queries.

    Started GET &quot;/&quot; for 127.0.0.1 at Thu Jul 01 09:26:36 -0400 2010
      SQL (1.6ms)  describe `approvals_users`
      SQL (14.1ms)  describe `clients_users`
      SQL (1.4ms)  describe `agencies_users`
      SQL (1.3ms)  describe `clients_users`
      SQL (1.2ms)  describe `approvals_users`
      SQL (1.4ms)  describe `permissions_users`
      Processing by DashboardController#show as HTML
      SQL (1.4ms)  describe `agencies_users`
      Agency Load (0.4ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`subdomain` = 'test') LIMIT 1
      Plan Load (0.4ms)  SELECT `plans`.`id`, `plans`.`name`, `plans`.`price`, `plans`.`client_limit`, `plans`.`allow_hosted_domain`, `plans`.`created_at`, `plans`.`updated_at`, `plans`.`email_access`, `plans`.`max_file_size`, `plans`.`is_secure`, `plans`.`create_templates`, `plans`.`token`, `plans`.`file_types` FROM `plans` WHERE (`plans`.`id` = 3) LIMIT 1
      User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
      SQL (1.4ms)  describe `permissions_users`
      Permission Load (0.5ms)  SELECT permissions.* FROM permissions INNER JOIN permissions_users ON permissions.id = permissions_users.permission_id WHERE permissions_users.user_id = 1 AND permissions_users.agency_id = 1 LIMIT 1
      Client Load (0.5ms)  SELECT clients.* FROM clients INNER JOIN clients_users ON clients.id = clients_users.client_id WHERE clients_users.agency_id = 1 AND clients_users.user_id = 1 ORDER BY clients.name ASC
      Project Load (0.5ms)  SELECT `projects`.`id`, `projects`.`client_id`, `projects`.`name`, `projects`.`slug`, `projects`.`description`, `projects`.`due_at`, `projects`.`position`, `projects`.`created_at`, `projects`.`updated_at`, `projects`.`is_public`, `projects`.`public_key`, `projects`.`pages_count` FROM `projects` WHERE (`projects`.client_id = 93) ORDER BY position ASC, created_at ASC
      Page Load (0.7ms)  SELECT `pages`.* FROM `pages` WHERE (`pages`.project_id = 28) ORDER BY pages.position ASC, pages.created_at ASC, id DESC LIMIT 1
      Revision Load (0.5ms)  SELECT `revisions`.`id`, `revisions`.`user_id`, `revisions`.`page_id`, `revisions`.`version`, `revisions`.`asset_file_name`, `revisions`.`asset_file_size`, `revisions`.`asset_file_type`, `revisions`.`asset_updated_at`, `revisions`.`created_at`, `revisions`.`updated_at`, `revisions`.`comments_count`, `revisions`.`agency_id`, `revisions`.`asset_stored`, `revisions`.`panda_id`, `revisions`.`type` FROM `revisions` WHERE (`revisions`.page_id = 1) ORDER BY revisions.version DESC LIMIT 1
    Rendered dashboard/partials/_project.html.haml (61.6ms)
    Rendered dashboard/partials/_client.html.haml (74.9ms)
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
    Rendered dashboard/show.html.haml within layouts/application (21656.9ms)
    Completed   in 21781ms
    
    ActionView::Template::Error (undefined local variable or method `throw_error' for #&lt;#&lt;Class:0x106635770&gt;:0x1066334e8&gt;):
        12:   .title_bar
        13:     %h4 Recent Activity
        14:   .stream
        15:     = throw_error
        16:     - cache [current_agency, current_user, 'feeds'] do
        17:       - feed_list = Feed.list
        18:       - feed_list[:items].each do |item, feed|
      app/views/dashboard/show.html.haml:15:in `_app_views_dashboard_show_html_haml__665120934_2201062920_0'
      app/controllers/dashboard_controller.rb:6:in `show'
    
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.4ms)
      SQL (1.1ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (17415.2ms)
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (17738.5ms)

This has happened for the following exceptions and more:

- NoMethodError
- ActiveRecord::RecordNotFound
- ActionView::Template::Error

Although there are a few exceptions that fail and render immediately, like `ActionController::UnknownAction`. Attached is the stack trace.</original-body>
  <latest-body>In Rails master whenever an exception is raised, it takes a rough 30 seconds for the page to render completely with a number of `SHOW TABLES` MySQL queries.

    Started GET &quot;/&quot; for 127.0.0.1 at Thu Jul 01 09:26:36 -0400 2010
      SQL (1.6ms)  describe `approvals_users`
      SQL (14.1ms)  describe `clients_users`
      SQL (1.4ms)  describe `agencies_users`
      SQL (1.3ms)  describe `clients_users`
      SQL (1.2ms)  describe `approvals_users`
      SQL (1.4ms)  describe `permissions_users`
      Processing by DashboardController#show as HTML
      SQL (1.4ms)  describe `agencies_users`
      Agency Load (0.4ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`subdomain` = 'test') LIMIT 1
      Plan Load (0.4ms)  SELECT `plans`.`id`, `plans`.`name`, `plans`.`price`, `plans`.`client_limit`, `plans`.`allow_hosted_domain`, `plans`.`created_at`, `plans`.`updated_at`, `plans`.`email_access`, `plans`.`max_file_size`, `plans`.`is_secure`, `plans`.`create_templates`, `plans`.`token`, `plans`.`file_types` FROM `plans` WHERE (`plans`.`id` = 3) LIMIT 1
      User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
      SQL (1.4ms)  describe `permissions_users`
      Permission Load (0.5ms)  SELECT permissions.* FROM permissions INNER JOIN permissions_users ON permissions.id = permissions_users.permission_id WHERE permissions_users.user_id = 1 AND permissions_users.agency_id = 1 LIMIT 1
      Client Load (0.5ms)  SELECT clients.* FROM clients INNER JOIN clients_users ON clients.id = clients_users.client_id WHERE clients_users.agency_id = 1 AND clients_users.user_id = 1 ORDER BY clients.name ASC
      Project Load (0.5ms)  SELECT `projects`.`id`, `projects`.`client_id`, `projects`.`name`, `projects`.`slug`, `projects`.`description`, `projects`.`due_at`, `projects`.`position`, `projects`.`created_at`, `projects`.`updated_at`, `projects`.`is_public`, `projects`.`public_key`, `projects`.`pages_count` FROM `projects` WHERE (`projects`.client_id = 93) ORDER BY position ASC, created_at ASC
      Page Load (0.7ms)  SELECT `pages`.* FROM `pages` WHERE (`pages`.project_id = 28) ORDER BY pages.position ASC, pages.created_at ASC, id DESC LIMIT 1
      Revision Load (0.5ms)  SELECT `revisions`.`id`, `revisions`.`user_id`, `revisions`.`page_id`, `revisions`.`version`, `revisions`.`asset_file_name`, `revisions`.`asset_file_size`, `revisions`.`asset_file_type`, `revisions`.`asset_updated_at`, `revisions`.`created_at`, `revisions`.`updated_at`, `revisions`.`comments_count`, `revisions`.`agency_id`, `revisions`.`asset_stored`, `revisions`.`panda_id`, `revisions`.`type` FROM `revisions` WHERE (`revisions`.page_id = 1) ORDER BY revisions.version DESC LIMIT 1
    Rendered dashboard/partials/_project.html.haml (61.6ms)
    Rendered dashboard/partials/_client.html.haml (74.9ms)
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
    Rendered dashboard/show.html.haml within layouts/application (21656.9ms)
    Completed   in 21781ms
    
    ActionView::Template::Error (undefined local variable or method `throw_error' for #&lt;#&lt;Class:0x106635770&gt;:0x1066334e8&gt;):
        12:   .title_bar
        13:     %h4 Recent Activity
        14:   .stream
        15:     = throw_error
        16:     - cache [current_agency, current_user, 'feeds'] do
        17:       - feed_list = Feed.list
        18:       - feed_list[:items].each do |item, feed|
      app/views/dashboard/show.html.haml:15:in `_app_views_dashboard_show_html_haml__665120934_2201062920_0'
      app/controllers/dashboard_controller.rb:6:in `show'
    
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.4ms)
      SQL (1.1ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (17415.2ms)
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (17738.5ms)

This has happened for the following exceptions and more:

- NoMethodError
- ActiveRecord::RecordNotFound
- ActionView::Template::Error

Although there are a few exceptions that fail and render immediately, like `ActionController::UnknownAction`. Attached is the stack trace.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;In Rails master whenever an exception is raised, it takes a
rough 30 seconds for the page to render completely with a number of
&lt;code&gt;SHOW TABLES&lt;/code&gt; MySQL queries.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Started GET &quot;/&quot; for 127.0.0.1 at Thu Jul 01 09:26:36 -0400 2010
  SQL (1.6ms)  describe `approvals_users`
  SQL (14.1ms)  describe `clients_users`
  SQL (1.4ms)  describe `agencies_users`
  SQL (1.3ms)  describe `clients_users`
  SQL (1.2ms)  describe `approvals_users`
  SQL (1.4ms)  describe `permissions_users`
  Processing by DashboardController#show as HTML
  SQL (1.4ms)  describe `agencies_users`
  Agency Load (0.4ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`subdomain` = 'test') LIMIT 1
  Plan Load (0.4ms)  SELECT `plans`.`id`, `plans`.`name`, `plans`.`price`, `plans`.`client_limit`, `plans`.`allow_hosted_domain`, `plans`.`created_at`, `plans`.`updated_at`, `plans`.`email_access`, `plans`.`max_file_size`, `plans`.`is_secure`, `plans`.`create_templates`, `plans`.`token`, `plans`.`file_types` FROM `plans` WHERE (`plans`.`id` = 3) LIMIT 1
  User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
  SQL (1.4ms)  describe `permissions_users`
  Permission Load (0.5ms)  SELECT permissions.* FROM permissions INNER JOIN permissions_users ON permissions.id = permissions_users.permission_id WHERE permissions_users.user_id = 1 AND permissions_users.agency_id = 1 LIMIT 1
  Client Load (0.5ms)  SELECT clients.* FROM clients INNER JOIN clients_users ON clients.id = clients_users.client_id WHERE clients_users.agency_id = 1 AND clients_users.user_id = 1 ORDER BY clients.name ASC
  Project Load (0.5ms)  SELECT `projects`.`id`, `projects`.`client_id`, `projects`.`name`, `projects`.`slug`, `projects`.`description`, `projects`.`due_at`, `projects`.`position`, `projects`.`created_at`, `projects`.`updated_at`, `projects`.`is_public`, `projects`.`public_key`, `projects`.`pages_count` FROM `projects` WHERE (`projects`.client_id = 93) ORDER BY position ASC, created_at ASC
  Page Load (0.7ms)  SELECT `pages`.* FROM `pages` WHERE (`pages`.project_id = 28) ORDER BY pages.position ASC, pages.created_at ASC, id DESC LIMIT 1
  Revision Load (0.5ms)  SELECT `revisions`.`id`, `revisions`.`user_id`, `revisions`.`page_id`, `revisions`.`version`, `revisions`.`asset_file_name`, `revisions`.`asset_file_size`, `revisions`.`asset_file_type`, `revisions`.`asset_updated_at`, `revisions`.`created_at`, `revisions`.`updated_at`, `revisions`.`comments_count`, `revisions`.`agency_id`, `revisions`.`asset_stored`, `revisions`.`panda_id`, `revisions`.`type` FROM `revisions` WHERE (`revisions`.page_id = 1) ORDER BY revisions.version DESC LIMIT 1
Rendered dashboard/partials/_project.html.haml (61.6ms)
Rendered dashboard/partials/_client.html.haml (74.9ms)
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
Rendered dashboard/show.html.haml within layouts/application (21656.9ms)
Completed   in 21781ms

ActionView::Template::Error (undefined local variable or method `throw_error' for #&amp;lt;#&amp;lt;Class:0x106635770&amp;gt;:0x1066334e8&amp;gt;):
    12:   .title_bar
    13:     %h4 Recent Activity
    14:   .stream
    15:     = throw_error
    16:     - cache [current_agency, current_user, 'feeds'] do
    17:       - feed_list = Feed.list
    18:       - feed_list[:items].each do |item, feed|
  app/views/dashboard/show.html.haml:15:in `_app_views_dashboard_show_html_haml__665120934_2201062920_0'
  app/controllers/dashboard_controller.rb:6:in `show'

Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.4ms)
  SQL (1.1ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (17415.2ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (17738.5ms)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This has happened for the following exceptions and more:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NoMethodError&lt;/li&gt;
&lt;li&gt;ActiveRecord::RecordNotFound&lt;/li&gt;
&lt;li&gt;ActionView::Template::Error&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Although there are a few exceptions that fail and render
immediately, like &lt;code&gt;ActionController::UnknownAction&lt;/code&gt;.
Attached is the stack trace.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In Rails master whenever an exception is raised, it takes a rough 30 seconds for the page to render completely with a number of `SHOW TABLES` MySQL queries.

    Started GET &quot;/&quot; for 127.0.0.1 at Thu Jul 01 09:26:36 -0400 2010
      SQL (1.6ms)  describe `approvals_users`
      SQL (14.1ms)  describe `clients_users`
      SQL (1.4ms)  describe `agencies_users`
      SQL (1.3ms)  describe `clients_users`
      SQL (1.2ms)  describe `approvals_users`
      SQL (1.4ms)  describe `permissions_users`
      Processing by DashboardController#show as HTML
      SQL (1.4ms)  describe `agencies_users`
      Agency Load (0.4ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`subdomain` = 'test') LIMIT 1
      Plan Load (0.4ms)  SELECT `plans`.`id`, `plans`.`name`, `plans`.`price`, `plans`.`client_limit`, `plans`.`allow_hosted_domain`, `plans`.`created_at`, `plans`.`updated_at`, `plans`.`email_access`, `plans`.`max_file_size`, `plans`.`is_secure`, `plans`.`create_templates`, `plans`.`token`, `plans`.`file_types` FROM `plans` WHERE (`plans`.`id` = 3) LIMIT 1
      User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
      SQL (1.4ms)  describe `permissions_users`
      Permission Load (0.5ms)  SELECT permissions.* FROM permissions INNER JOIN permissions_users ON permissions.id = permissions_users.permission_id WHERE permissions_users.user_id = 1 AND permissions_users.agency_id = 1 LIMIT 1
      Client Load (0.5ms)  SELECT clients.* FROM clients INNER JOIN clients_users ON clients.id = clients_users.client_id WHERE clients_users.agency_id = 1 AND clients_users.user_id = 1 ORDER BY clients.name ASC
      Project Load (0.5ms)  SELECT `projects`.`id`, `projects`.`client_id`, `projects`.`name`, `projects`.`slug`, `projects`.`description`, `projects`.`due_at`, `projects`.`position`, `projects`.`created_at`, `projects`.`updated_at`, `projects`.`is_public`, `projects`.`public_key`, `projects`.`pages_count` FROM `projects` WHERE (`projects`.client_id = 93) ORDER BY position ASC, created_at ASC
      Page Load (0.7ms)  SELECT `pages`.* FROM `pages` WHERE (`pages`.project_id = 28) ORDER BY pages.position ASC, pages.created_at ASC, id DESC LIMIT 1
      Revision Load (0.5ms)  SELECT `revisions`.`id`, `revisions`.`user_id`, `revisions`.`page_id`, `revisions`.`version`, `revisions`.`asset_file_name`, `revisions`.`asset_file_size`, `revisions`.`asset_file_type`, `revisions`.`asset_updated_at`, `revisions`.`created_at`, `revisions`.`updated_at`, `revisions`.`comments_count`, `revisions`.`agency_id`, `revisions`.`asset_stored`, `revisions`.`panda_id`, `revisions`.`type` FROM `revisions` WHERE (`revisions`.page_id = 1) ORDER BY revisions.version DESC LIMIT 1
    Rendered dashboard/partials/_project.html.haml (61.6ms)
    Rendered dashboard/partials/_client.html.haml (74.9ms)
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
    Rendered dashboard/show.html.haml within layouts/application (21656.9ms)
    Completed   in 21781ms
    
    ActionView::Template::Error (undefined local variable or method `throw_error' for #&lt;#&lt;Class:0x106635770&gt;:0x1066334e8&gt;):
        12:   .title_bar
        13:     %h4 Recent Activity
        14:   .stream
        15:     = throw_error
        16:     - cache [current_agency, current_user, 'feeds'] do
        17:       - feed_list = Feed.list
        18:       - feed_list[:items].each do |item, feed|
      app/views/dashboard/show.html.haml:15:in `_app_views_dashboard_show_html_haml__665120934_2201062920_0'
      app/controllers/dashboard_controller.rb:6:in `show'
    
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.4ms)
      SQL (1.1ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (1.0ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.7ms)  SHOW TABLES
      SQL (0.9ms)  SHOW TABLES
      SQL (0.8ms)  SHOW TABLES
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (17415.2ms)
    Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (17738.5ms)

This has happened for the following exceptions and more:

- NoMethodError
- ActiveRecord::RecordNotFound
- ActionView::Template::Error

Although there are a few exceptions that fail and render immediately, like `ActionController::UnknownAction`. Attached is the stack trace.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In Rails master whenever an exception is raised, it takes a
rough 30 seconds for the page to render completely with a number of
&lt;code&gt;SHOW TABLES&lt;/code&gt; MySQL queries.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Started GET &quot;/&quot; for 127.0.0.1 at Thu Jul 01 09:26:36 -0400 2010
  SQL (1.6ms)  describe `approvals_users`
  SQL (14.1ms)  describe `clients_users`
  SQL (1.4ms)  describe `agencies_users`
  SQL (1.3ms)  describe `clients_users`
  SQL (1.2ms)  describe `approvals_users`
  SQL (1.4ms)  describe `permissions_users`
  Processing by DashboardController#show as HTML
  SQL (1.4ms)  describe `agencies_users`
  Agency Load (0.4ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`subdomain` = 'test') LIMIT 1
  Plan Load (0.4ms)  SELECT `plans`.`id`, `plans`.`name`, `plans`.`price`, `plans`.`client_limit`, `plans`.`allow_hosted_domain`, `plans`.`created_at`, `plans`.`updated_at`, `plans`.`email_access`, `plans`.`max_file_size`, `plans`.`is_secure`, `plans`.`create_templates`, `plans`.`token`, `plans`.`file_types` FROM `plans` WHERE (`plans`.`id` = 3) LIMIT 1
  User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
  SQL (1.4ms)  describe `permissions_users`
  Permission Load (0.5ms)  SELECT permissions.* FROM permissions INNER JOIN permissions_users ON permissions.id = permissions_users.permission_id WHERE permissions_users.user_id = 1 AND permissions_users.agency_id = 1 LIMIT 1
  Client Load (0.5ms)  SELECT clients.* FROM clients INNER JOIN clients_users ON clients.id = clients_users.client_id WHERE clients_users.agency_id = 1 AND clients_users.user_id = 1 ORDER BY clients.name ASC
  Project Load (0.5ms)  SELECT `projects`.`id`, `projects`.`client_id`, `projects`.`name`, `projects`.`slug`, `projects`.`description`, `projects`.`due_at`, `projects`.`position`, `projects`.`created_at`, `projects`.`updated_at`, `projects`.`is_public`, `projects`.`public_key`, `projects`.`pages_count` FROM `projects` WHERE (`projects`.client_id = 93) ORDER BY position ASC, created_at ASC
  Page Load (0.7ms)  SELECT `pages`.* FROM `pages` WHERE (`pages`.project_id = 28) ORDER BY pages.position ASC, pages.created_at ASC, id DESC LIMIT 1
  Revision Load (0.5ms)  SELECT `revisions`.`id`, `revisions`.`user_id`, `revisions`.`page_id`, `revisions`.`version`, `revisions`.`asset_file_name`, `revisions`.`asset_file_size`, `revisions`.`asset_file_type`, `revisions`.`asset_updated_at`, `revisions`.`created_at`, `revisions`.`updated_at`, `revisions`.`comments_count`, `revisions`.`agency_id`, `revisions`.`asset_stored`, `revisions`.`panda_id`, `revisions`.`type` FROM `revisions` WHERE (`revisions`.page_id = 1) ORDER BY revisions.version DESC LIMIT 1
Rendered dashboard/partials/_project.html.haml (61.6ms)
Rendered dashboard/partials/_client.html.haml (74.9ms)
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
Rendered dashboard/show.html.haml within layouts/application (21656.9ms)
Completed   in 21781ms

ActionView::Template::Error (undefined local variable or method `throw_error' for #&amp;lt;#&amp;lt;Class:0x106635770&amp;gt;:0x1066334e8&amp;gt;):
    12:   .title_bar
    13:     %h4 Recent Activity
    14:   .stream
    15:     = throw_error
    16:     - cache [current_agency, current_user, 'feeds'] do
    17:       - feed_list = Feed.list
    18:       - feed_list[:items].each do |item, feed|
  app/views/dashboard/show.html.haml:15:in `_app_views_dashboard_show_html_haml__665120934_2201062920_0'
  app/controllers/dashboard_controller.rb:6:in `show'

Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.4ms)
  SQL (1.1ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (1.0ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.7ms)  SHOW TABLES
  SQL (0.9ms)  SHOW TABLES
  SQL (0.8ms)  SHOW TABLES
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (17415.2ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-21957b72ea394c679d9b17e75b570cc99596322d/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (17738.5ms)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This has happened for the following exceptions and more:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NoMethodError&lt;/li&gt;
&lt;li&gt;ActiveRecord::RecordNotFound&lt;/li&gt;
&lt;li&gt;ActionView::Template::Error&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Although there are a few exceptions that fail and render
immediately, like &lt;code&gt;ActionController::UnknownAction&lt;/code&gt;.
Attached is the stack trace.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T14:36:56+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;activerecord rails3&quot; exception</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-07-01T14:36:59+01:00</updated-at>
      <user-id type="integer">82933</user-id>
      <version type="integer">1</version>
      <user-name>Garrett Bjerkhoel</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T17:47:16+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:priority: 0
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;activerecord rails3&quot; exception</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-07-01T17:47:20+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">2</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I created a brand new rails app and added a single line at the top of index page.

@@@ ruby
&lt;% raise 'boom' %&gt;
@@@

I see my exception instantly. Here is my log

@@@ ruby
Started GET &quot;/users&quot; for 127.0.0.1 at Thu Jul 01 13:23:24 -0400 2010
  Processing by UsersController#index as HTML
  SQL (0.8ms)   SELECT name
 FROM sqlite_master
 WHERE type = 'table' AND NOT name = 'sqlite_sequence'

  User Load (0.2ms)  SELECT &quot;users&quot;.* FROM &quot;users&quot;
Rendered users/index.html.erb within layouts/application (4.0ms)
Completed   in 38ms

ActionView::Template::Error (boom):
    1: &lt;% raise 'boom' %&gt;
    2: 
    3: &lt;h1&gt;Listing users&lt;/h1&gt;
    4: 
  app/views/users/index.html.erb:1:in `_app_views_users_index_html_erb___518242468_2158308900_0'
  app/controllers/users_controller.rb:7:in `index'

Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.3ms)
Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (3.9ms)
Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (9.6ms)
@@@



You are using haml. Can you try without haml although I don't expect haml to be an issue?

Could it be possible that some other plugin/gem is interfering. Could you please list all gems/plugins you are using in your app?

thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;I created a brand new rails app and added a single line at the
top of index page.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;lt;% raise 'boom' %&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I see my exception instantly. Here is my log&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;Started GET &quot;/users&quot; for 127.0.0.1 at Thu Jul 01 13:23:24 -0400 2010
  Processing by UsersController#index as HTML
  SQL (0.8ms)   SELECT name
 FROM sqlite_master
 WHERE type = 'table' AND NOT name = 'sqlite_sequence'

  User Load (0.2ms)  SELECT &quot;users&quot;.* FROM &quot;users&quot;
Rendered users/index.html.erb within layouts/application (4.0ms)
Completed   in 38ms

ActionView::Template::Error (boom):
    1: &amp;lt;% raise 'boom' %&amp;gt;
    2: 
    3: &amp;lt;h1&amp;gt;Listing users&amp;lt;/h1&amp;gt;
    4: 
  app/views/users/index.html.erb:1:in `_app_views_users_index_html_erb___518242468_2158308900_0'
  app/controllers/users_controller.rb:7:in `index'

Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.3ms)
Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (3.9ms)
Rendered /Users/nsingh/dev/working/rails_tickets/rails/actionpack/lib/action_dispatch/middleware/templates/rescues/template_error.erb within rescues/layout (9.6ms)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;You are using haml. Can you try without haml although I don't
expect haml to be an issue?&lt;/p&gt;
&lt;p&gt;Could it be possible that some other plugin/gem is interfering.
Could you please list all gems/plugins you are using in your
app?&lt;/p&gt;
&lt;p&gt;thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T18:27:15+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;activerecord rails3\&quot; exception&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-07-01T18:27:24+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">3</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>These errors are happening even before I hit the views sometimes; Builder/xml, within controllers, etc.

I thought maybe the Hoptoad Gem might have something to do with this because that's its job to report errors, so I took that out and it still takes increasingly long to render any sort of exception.

@@@ ruby
Started POST &quot;/api/v1/agencies.xml&quot; for 127.0.0.1 at Thu Jul 01 13:34:38 -0400 2010
  SQL (1.6ms)  describe `approvals_users`
  SQL (1.8ms)  describe `clients_users`
  SQL (1.5ms)  describe `agencies_users`
  SQL (1.3ms)  describe `clients_users`
  SQL (1.2ms)  describe `approvals_users`
  SQL (2.3ms)  describe `permissions_users`
  Processing by Api::V1::AgenciesController#create as XML
  Parameters: {&quot;api_key&quot;=&gt;&quot;123132&quot;}
  SQL (1.5ms)  describe `agencies_users`
  Agency Load (1.9ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`api_key` = '123132') LIMIT 1
Completed   in 37ms

ActiveRecord::RecordNotFound (Couldn't find Agency with api_key = 123132):
  app/models/agency.rb:58:in `find_by_domain'
  app/controllers/api_controller.rb:32:in `current_agency'
  app/controllers/api_controller.rb:94:in `run_api_validations'

Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.5ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (18154.3ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (18542.1ms)
@@@

Stacktrace:

@@@ ruby
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/relation/finder_methods.rb:230:in `find_by_attributes'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/base.rb:1036:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/base.rb:1036:in `method_missing'
app/models/agency.rb:58:in `find_by_domain'
app/controllers/api_controller.rb:32:in `current_agency'
app/controllers/api_controller.rb:94:in `run_api_validations'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:430:in `_run__353673824__process_action__1623385099__callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:404:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:404:in `_run_process_action_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:93:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:93:in `run_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/callbacks.rb:17:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/instrumentation.rb:29:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications/instrumenter.rb:20:in `instrument'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications.rb:47:in `__send__'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications.rb:47:in `instrument'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/instrumentation.rb:28:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/rescue.rb:8:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/base.rb:105:in `process'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/rendering.rb:40:in `process'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal.rb:133:in `dispatch'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal.rb:173:in `action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:29:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:29:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/route_set.rb:148:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:89:in `recognize'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:66:in `optimized_each'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:88:in `recognize'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/route_set.rb:139:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:486:in `call'
vendor/plugins/rack_openid/lib/rack/openid.rb:98:in `call'
hoptoad_notifier (2.3.0) lib/hoptoad_notifier/rack.rb:27:in `call'
haml (3.0.13) lib/sass/plugin/rack.rb:41:in `call'
warden (0.10.7) lib/warden/manager.rb:35:in `call'
warden (0.10.7) lib/warden/manager.rb:34:in `catch'
warden (0.10.7) lib/warden/manager.rb:34:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/head.rb:14:in `call'
rack (1.2.1) lib/rack/methodoverride.rb:24:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/params_parser.rb:21:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/flash.rb:177:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/session/abstract_store.rb:144:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/cookies.rb:268:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:32:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:12:in `cache'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:31:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:367:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/callbacks.rb:46:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:410:in `_run_call_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/callbacks.rb:44:in `call'
rack (1.2.1) lib/rack/sendfile.rb:107:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/show_exceptions.rb:48:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/rack/logger.rb:13:in `call'
rack (1.2.1) lib/rack/runtime.rb:17:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `synchronize'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/static.rb:30:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:162:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:77:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:77:in `method_missing'
passenger (2.2.11) lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'
passenger (2.2.11) lib/phusion_passenger/abstract_request_handler.rb:207:in `main_loop'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:118:in `run'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:65:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/utils.rb:184:in `safe_fork'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:58:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:41:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/spawn_manager.rb:159:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/spawn_manager.rb:287:in `handle_spawn_application'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:352:in `__send__'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:352:in `main_loop'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:196:in `start_synchronously'
passenger (2.2.11) bin/passenger-spawn-server:61
@@@
    
Here is my Gemfile:

@@@ ruby
source 'http://gemcutter.org'

# Core
# gem 'rails', '3.0.0.beta4'
gem 'rails', :git =&gt; 'http://github.com/rails/rails.git'
gem 'sinatra'
gem 'mysql'
gem 'bundler'
gem 'memcache-client'
gem 'system_timer'
gem 'mime-types', :require =&gt; 'mime/types'
gem 'json'
gem 'haml', '~&gt; 3.0.12'
gem 'bcrypt-ruby', :require =&gt; 'bcrypt'

# Users
gem 'warden'
gem 'ruby-openid', :require =&gt; 'openid'
gem 'canable'
gem 'devise', '1.1.rc2'

# Paperclip
gem 'aws-s3', :require =&gt; 'aws/s3'
gem 'paperclip', :git =&gt; 'git://github.com/dewski/paperclip.git', :branch =&gt; 'rails3'
gem 'delayed_job', :git =&gt; 'git://github.com/dewski/delayed_job.git'

group :development do
  gem 'termios'
  gem 'faker'
end

group :test do
  gem 'webrat'
  gem 'hpricot'
  gem 'mocha', :require =&gt; false
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;These errors are happening even before I hit the views
sometimes; Builder/xml, within controllers, etc.&lt;/p&gt;
&lt;p&gt;I thought maybe the Hoptoad Gem might have something to do with
this because that's its job to report errors, so I took that out
and it still takes increasingly long to render any sort of
exception.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;Started POST &quot;/api/v1/agencies.xml&quot; for 127.0.0.1 at Thu Jul 01 13:34:38 -0400 2010
  SQL (1.6ms)  describe `approvals_users`
  SQL (1.8ms)  describe `clients_users`
  SQL (1.5ms)  describe `agencies_users`
  SQL (1.3ms)  describe `clients_users`
  SQL (1.2ms)  describe `approvals_users`
  SQL (2.3ms)  describe `permissions_users`
  Processing by Api::V1::AgenciesController#create as XML
  Parameters: {&quot;api_key&quot;=&amp;gt;&quot;123132&quot;}
  SQL (1.5ms)  describe `agencies_users`
  Agency Load (1.9ms)  SELECT `agencies`.* FROM `agencies` WHERE (`agencies`.`api_key` = '123132') LIMIT 1
Completed   in 37ms

ActiveRecord::RecordNotFound (Couldn't find Agency with api_key = 123132):
  app/models/agency.rb:58:in `find_by_domain'
  app/controllers/api_controller.rb:32:in `current_agency'
  app/controllers/api_controller.rb:94:in `run_api_validations'

Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/_trace.erb (1.5ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/_request_and_response.erb (18154.3ms)
Rendered /Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (18542.1ms)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Stacktrace:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/relation/finder_methods.rb:230:in `find_by_attributes'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/base.rb:1036:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/base.rb:1036:in `method_missing'
app/models/agency.rb:58:in `find_by_domain'
app/controllers/api_controller.rb:32:in `current_agency'
app/controllers/api_controller.rb:94:in `run_api_validations'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:430:in `_run__353673824__process_action__1623385099__callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:404:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:404:in `_run_process_action_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:93:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:93:in `run_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/callbacks.rb:17:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/instrumentation.rb:29:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications/instrumenter.rb:20:in `instrument'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications.rb:47:in `__send__'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/notifications.rb:47:in `instrument'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/instrumentation.rb:28:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/rescue.rb:8:in `process_action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/base.rb:105:in `process'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/abstract_controller/rendering.rb:40:in `process'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal.rb:133:in `dispatch'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_controller/metal.rb:173:in `action'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:29:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:29:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/route_set.rb:148:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:89:in `recognize'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:66:in `optimized_each'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/code_generation.rb:88:in `recognize'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/vendor/rack-mount-0.6.6.pre/rack/mount/route_set.rb:139:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/routing/route_set.rb:486:in `call'
vendor/plugins/rack_openid/lib/rack/openid.rb:98:in `call'
hoptoad_notifier (2.3.0) lib/hoptoad_notifier/rack.rb:27:in `call'
haml (3.0.13) lib/sass/plugin/rack.rb:41:in `call'
warden (0.10.7) lib/warden/manager.rb:35:in `call'
warden (0.10.7) lib/warden/manager.rb:34:in `catch'
warden (0.10.7) lib/warden/manager.rb:34:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/head.rb:14:in `call'
rack (1.2.1) lib/rack/methodoverride.rb:24:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/params_parser.rb:21:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/flash.rb:177:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/session/abstract_store.rb:144:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/cookies.rb:268:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:32:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:28:in `cache'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:12:in `cache'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/query_cache.rb:31:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:367:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/callbacks.rb:46:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/activesupport/lib/active_support/callbacks.rb:410:in `_run_call_callbacks'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/callbacks.rb:44:in `call'
rack (1.2.1) lib/rack/sendfile.rb:107:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/remote_ip.rb:48:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/show_exceptions.rb:48:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/rack/logger.rb:13:in `call'
rack (1.2.1) lib/rack/runtime.rb:17:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
rack (1.2.1) lib/rack/lock.rb:11:in `synchronize'
rack (1.2.1) lib/rack/lock.rb:11:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/actionpack/lib/action_dispatch/middleware/static.rb:30:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:162:in `call'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:77:in `send'
/Users/garrett/.bundle/ruby/1.8/bundler/gems/rails-07b08721a226ff01f983e61d99ab4da96e296c97-53b34e84762b7f2d6b641f99dadbb1eab42907ab/railties/lib/rails/application.rb:77:in `method_missing'
passenger (2.2.11) lib/phusion_passenger/rack/request_handler.rb:92:in `process_request'
passenger (2.2.11) lib/phusion_passenger/abstract_request_handler.rb:207:in `main_loop'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:118:in `run'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:65:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/utils.rb:184:in `safe_fork'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:58:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/rack/application_spawner.rb:41:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/spawn_manager.rb:159:in `spawn_application'
passenger (2.2.11) lib/phusion_passenger/spawn_manager.rb:287:in `handle_spawn_application'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:352:in `__send__'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:352:in `main_loop'
passenger (2.2.11) lib/phusion_passenger/abstract_server.rb:196:in `start_synchronously'
passenger (2.2.11) bin/passenger-spawn-server:61&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Here is my Gemfile:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;source 'http://gemcutter.org'

# Core
# gem 'rails', '3.0.0.beta4'
gem 'rails', :git =&amp;gt; 'http://github.com/rails/rails.git'
gem 'sinatra'
gem 'mysql'
gem 'bundler'
gem 'memcache-client'
gem 'system_timer'
gem 'mime-types', :require =&amp;gt; 'mime/types'
gem 'json'
gem 'haml', '~&amp;gt; 3.0.12'
gem 'bcrypt-ruby', :require =&amp;gt; 'bcrypt'

# Users
gem 'warden'
gem 'ruby-openid', :require =&amp;gt; 'openid'
gem 'canable'
gem 'devise', '1.1.rc2'

# Paperclip
gem 'aws-s3', :require =&amp;gt; 'aws/s3'
gem 'paperclip', :git =&amp;gt; 'git://github.com/dewski/paperclip.git', :branch =&amp;gt; 'rails3'
gem 'delayed_job', :git =&amp;gt; 'git://github.com/dewski/delayed_job.git'

group :development do
  gem 'termios'
  gem 'faker'
end

group :test do
  gem 'webrat'
  gem 'hpricot'
  gem 'mocha', :require =&amp;gt; false
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-01T18:45:04+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-07-01T18:45:08+01:00</updated-at>
      <user-id type="integer">82933</user-id>
      <version type="integer">4</version>
      <user-name>Garrett Bjerkhoel</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:33+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-08-30T04:10:33+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">5</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Can you attach a minimum reproducible case, which we can run and reproduce the problem? For freshly minted Rails3 application, I can't reproduce your problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you attach a minimum reproducible case, which we can run and
reproduce the problem? For freshly minted Rails3 application, I
can't reproduce your problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-22T16:02:03+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-09-22T16:02:05+01:00</updated-at>
      <user-id type="integer">2053</user-id>
      <version type="integer">6</version>
      <user-name>gnufied</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>We need a way of re-producing this from a fresh Rails 3 app.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We need a way of re-producing this from a fresh Rails 3 app.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-23T08:44:24+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-09-23T08:44:29+01:00</updated-at>
      <user-id type="integer">65050</user-id>
      <version type="integer">7</version>
      <user-name>David Trasbo</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:57+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>&quot;activerecord rails3&quot; exception rails3</tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-10-15T23:01:57+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-16T02:42:33+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;activerecord rails3\&quot; exception rails3&quot;
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-10-16T02:42:39+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">10</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I thought maybe the Hoptoad Gem might have &lt;a href=&quot;http://www.weddinginthebox.com/blog/wedding-dress-finder.html&quot;&gt;excellent wedding dress finder&lt;/a&gt; to do with this because that's its job to report errors, so I took that out and it still takes increasingly long to render any sort of exception.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I thought maybe the Hoptoad Gem might have &lt;a href=
&quot;http://www.weddinginthebox.com/blog/wedding-dress-finder.html&quot;&gt;excellent
wedding dress finder&lt;/a&gt; to do with this because that's its job to
report errors, so I took that out and it still takes increasingly
long to render any sort of exception.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T06:35:42+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-10-19T17:52:54+01:00</updated-at>
      <user-id type="integer">120610</user-id>
      <version type="integer">11</version>
      <user-name>koukou</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The problem is actually pretty subtle and manifests whenever you have some object with huge `inspect` output in your `request.env`.

For example I have an app with a lot of routes and Devise installed. Devise adds Warden middleware which is always present in `request.env` and which holds references to `ActionDispatch::Routing::RouteSet`. The inspect output of `ActionDispatch::Routing::RouteSet` is huge when you have many routes (I get about ~3Mb diagnostics.erb output on that project).

One solution would be just to truncate output for every key in the `debug_hash` method of `_request_and_response.erb` partial.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem is actually pretty subtle and manifests whenever you
have some object with huge &lt;code&gt;inspect&lt;/code&gt; output in your
&lt;code&gt;request.env&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For example I have an app with a lot of routes and Devise
installed. Devise adds Warden middleware which is always present in
&lt;code&gt;request.env&lt;/code&gt; and which holds references to
&lt;code&gt;ActionDispatch::Routing::RouteSet&lt;/code&gt;. The inspect output
of &lt;code&gt;ActionDispatch::Routing::RouteSet&lt;/code&gt; is huge when you
have many routes (I get about ~3Mb diagnostics.erb output on that
project).&lt;/p&gt;
&lt;p&gt;One solution would be just to truncate output for every key in
the &lt;code&gt;debug_hash&lt;/code&gt; method of
&lt;code&gt;_request_and_response.erb&lt;/code&gt; partial.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-08T15:16:50+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-11-08T15:16:55+00:00</updated-at>
      <user-id type="integer">43210</user-id>
      <version type="integer">12</version>
      <user-name>Evgeniy Dolzhenko</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/34349)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/34349&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:04:51+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2010-11-15T21:04:51+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">13</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I confirm this problem and Evgeniy Dolzhenko explanation.

On my application, the template (_request_and_response.erb) takes 10 seconds to render. By disabling the debug_hash method, the rendering time goes down to less than 1 sec!

I confirm that request.env is very big and I agree with truncating its values.

It's not possible to inject megabytes of data in a single page as it even freezes the browser sometimes.

Do you see another clean solution than truncating?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I confirm this problem and Evgeniy Dolzhenko explanation.&lt;/p&gt;
&lt;p&gt;On my application, the template (_request_and_response.erb)
takes 10 seconds to render. By disabling the debug_hash method, the
rendering time goes down to less than 1 sec!&lt;/p&gt;
&lt;p&gt;I confirm that request.env is very big and I agree with
truncating its values.&lt;/p&gt;
&lt;p&gt;It's not possible to inject megabytes of data in a single page
as it even freezes the browser sometimes.&lt;/p&gt;
&lt;p&gt;Do you see another clean solution than truncating?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-03T14:48:18+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-01-03T14:48:35+00:00</updated-at>
      <user-id type="integer">18156</user-id>
      <version type="integer">14</version>
      <user-name>Nicolas Blanco</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Some more investigation on my request.env object, here are the biggest keys :

warden: 2009703 bytes
action_controller.instance: 5985405 bytes
action_dispatch.remote_ip: 1999023 bytes

If this normal?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Some more investigation on my request.env object, here are the
biggest keys :&lt;/p&gt;
&lt;p&gt;warden: 2009703 bytes&lt;br&gt;
action_controller.instance: 5985405 bytes&lt;br&gt;
action_dispatch.remote_ip: 1999023 bytes&lt;/p&gt;
&lt;p&gt;If this normal?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-03T15:52:12+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-01-03T15:52:44+00:00</updated-at>
      <user-id type="integer">18156</user-id>
      <version type="integer">15</version>
      <user-name>Nicolas Blanco</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/42275)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/42275&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-12T21:58:22+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 92071
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-02-12T21:58:22+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">16</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/43692)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/43692&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-27T03:15:39+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 101623
</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-02-27T03:15:39+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">17</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached is a patch that adds configurable options for both session and environment dumping on ActionDispatch error pages. These options have been added to the ActionDispatch Railtie and are called dump_session_on_error and dump_environment_on_error respectively. By default I've set the options to dump sessions but not the environment on error, since the session dump generally seems to be small while the environment dump can become huge as you add things like routes and plugins and extensions that like to add instance variables to the controller and such.

I rarely ever find myself looking at the environment dump, so I'm not really going to miss it if it's gone by default, but it's nice being able to turn it back on again for the once-in-a-blue-moon that I would ever need to use it.

This might not be as pretty of a solution as truncating the values in the environment hash and such, but it's a quick fix for something that I doubt too many people really pay attention to anyways. I haven't included any tests in the patch as I'm not sure how to go about testing configuration options and templates like this, but I can add them if necessary and if anyone has any hints.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a patch that adds configurable options for both
session and environment dumping on ActionDispatch error pages.
These options have been added to the ActionDispatch Railtie and are
called dump_session_on_error and dump_environment_on_error
respectively. By default I've set the options to dump sessions but
not the environment on error, since the session dump generally
seems to be small while the environment dump can become huge as you
add things like routes and plugins and extensions that like to add
instance variables to the controller and such.&lt;/p&gt;
&lt;p&gt;I rarely ever find myself looking at the environment dump, so
I'm not really going to miss it if it's gone by default, but it's
nice being able to turn it back on again for the
once-in-a-blue-moon that I would ever need to use it.&lt;/p&gt;
&lt;p&gt;This might not be as pretty of a solution as truncating the
values in the environment hash and such, but it's a quick fix for
something that I doubt too many people really pay attention to
anyways. I haven't included any tests in the patch as I'm not sure
how to go about testing configuration options and templates like
this, but I can add them if necessary and if anyone has any
hints.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-07T23:07:43+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-07T23:08:03+00:00</updated-at>
      <user-id type="integer">20511</user-id>
      <version type="integer">18</version>
      <user-name>jay</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I just realized that the patch above was against 3-0-stable, so here's a patch against master, too.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just realized that the patch above was against 3-0-stable, so
here's a patch against master, too.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-08T20:06:00+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-08T20:06:21+00:00</updated-at>
      <user-id type="integer">20511</user-id>
      <version type="integer">19</version>
      <user-name>jay</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I'm seeing what I think is the same problem as the original poster. I find that some exceptions end up making a bunch of slow SHOW TABLES queries when they are being stringified. I have an almost vanilla rail 3.0.5 app that can reproduce the problem here: https://github.com/ajh/show_tables

See the README for how to repro it.

I've also found people talking about what seems to be the same issue here: http://stackoverflow.com/questions/3114993/exception-pages-in-development-mode-take-upwards-of-15-30-seconds-to-render-why</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm seeing what I think is the same problem as the original
poster. I find that some exceptions end up making a bunch of slow
SHOW TABLES queries when they are being stringified. I have an
almost vanilla rail 3.0.5 app that can reproduce the problem here:
&lt;a href=
&quot;https://github.com/ajh/show_tables&quot;&gt;https://github.com/ajh/show_tables&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;See the README for how to repro it.&lt;/p&gt;
&lt;p&gt;I've also found people talking about what seems to be the same
issue here: &lt;a href=
&quot;http://stackoverflow.com/questions/3114993/exception-pages-in-development-mode-take-upwards-of-15-30-seconds-to-render-why&quot;&gt;
http://stackoverflow.com/questions/3114993/exception-pages-in-devel...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-12T07:14:21+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-12T07:14:42+00:00</updated-at>
      <user-id type="integer">20951</user-id>
      <version type="integer">20</version>
      <user-name>Andy</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>The key part of the backtraces that I'm seeing is this (see https://github.com/ajh/show_tables/blob/master/README for a full backtrace):

    /home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/mysql2-0.2.6/lib/active_record/connection_adapters/mysql2_adapter.rb:432:in `tables'
    /home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/connection_adapters/abstract/schema_statements.rb:21:in `table_exists?'
    /home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/base.rb:673:in `table_exists?'
    /home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/base.rb:795:in `inspect' 
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_str'
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_s'                     
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `inspect'
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_str'                   
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_s'
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `message'

A raised exception's #message method is called, and as that's being evaluated somehow an ActiveRecord::Base class's inspect method gets fired.

I've followed this code path in a debugger and I don't see the call to the ActiveRecord::Base.inspect method, the debugger just ends up inside that method. After setting a break point at the bottom line in the above backtrace, I can examine the exception like so:

    Breakpoint 2 at /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36
    /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36
    &quot;#{@exception.class.name}: #{@exception.message}&quot;
    (rdb:1) irb
    ruby-1.8.7-p302 :001 &gt; @exception.class
       =&gt; NoMethodError
    ruby-1.8.7-p302 :005 &gt;   @exception.class.included_modules
       =&gt; [ActiveSupport::Dependencies::Blamable, Base64::Deprecated, Base64, ActiveSupport::Dependencies::Loadable, PP::ObjectMixin, Kernel]

I've skimmed through the included modules and haven't seen anything that might call ActiveRecord::Base.inspect.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The key part of the backtraces that I'm seeing is this (see
&lt;a href=
&quot;https://github.com/ajh/show_tables/blob/master/README&quot;&gt;https://github.com/ajh/show_tables/blob/master/README&lt;/a&gt;
for a full backtrace):&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/mysql2-0.2.6/lib/active_record/connection_adapters/mysql2_adapter.rb:432:in `tables'
/home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/connection_adapters/abstract/schema_statements.rb:21:in `table_exists?'
/home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/base.rb:673:in `table_exists?'
/home/ajh/.rvm/gems/ruby-1.8.7-p302@rails3/gems/activerecord-3.0.5/lib/active_record/base.rb:795:in `inspect' 
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_str'
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_s'                     
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `inspect'
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_str'                   
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `to_s'
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36:in `message'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;A raised exception's #message method is called, and as that's
being evaluated somehow an ActiveRecord::Base class's inspect
method gets fired.&lt;/p&gt;
&lt;p&gt;I've followed this code path in a debugger and I don't see the
call to the ActiveRecord::Base.inspect method, the debugger just
ends up inside that method. After setting a break point at the
bottom line in the above backtrace, I can examine the exception
like so:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Breakpoint 2 at /home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36
/home/ajh/.rvm/rubies/ruby-1.8.7-p302/lib/ruby/1.8/test/unit/error.rb:36
&quot;#{@exception.class.name}: #{@exception.message}&quot;
(rdb:1) irb
ruby-1.8.7-p302 :001 &amp;gt; @exception.class
   =&amp;gt; NoMethodError
ruby-1.8.7-p302 :005 &amp;gt;   @exception.class.included_modules
   =&amp;gt; [ActiveSupport::Dependencies::Blamable, Base64::Deprecated, Base64, ActiveSupport::Dependencies::Loadable, PP::ObjectMixin, Kernel]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I've skimmed through the included modules and haven't seen
anything that might call ActiveRecord::Base.inspect.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-12T17:24:59+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-12T17:25:18+00:00</updated-at>
      <user-id type="integer">20951</user-id>
      <version type="integer">21</version>
      <user-name>Andy</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>By the way, about the patches above and Evgeniy Dolzhenko's explanation. I don't doubt that fixes a real issue, but I don't think it explains Garrett's original problem where he is seeing a bunch of 'SHOW TABLES' queries being run.</body>
      <body-html>&lt;div&gt;&lt;p&gt;By the way, about the patches above and Evgeniy Dolzhenko's
explanation. I don't doubt that fixes a real issue, but I don't
think it explains Garrett's original problem where he is seeing a
bunch of 'SHOW TABLES' queries being run.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-12T17:34:34+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-12T17:34:53+00:00</updated-at>
      <user-id type="integer">20951</user-id>
      <version type="integer">22</version>
      <user-name>Andy</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>FWIW, we had a similar problem on Rails 2.2.x and fixed it by monkey patching ActiveRecord::Base.inspect:

@@@ ruby
module ActiveRecord
  class Base
    def self.inspect
      if self == Base
        super
      elsif abstract_class?
        &quot;#{super}(abstract)&quot; 
      else
        begin
          attr_list = columns.map { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '
          &quot;#{super}(#{attr_list})&quot; 
        rescue Exception =&gt; e
          # Any exception is likely to be caused by the table not existing!
          &quot;#{super}(Table doesn't exist)&quot;
        end
      end
    end
  end
end
@@@

The original code relied on `table_exists?` which causes a `SHOW TABLES` query without any caching.  I decided that if you call `table_exists?` then you probably wanted to explicitly check if the table exists, but for `inspect` it would be OK to just rely on `columns` failing.

I don't know if this is helpful on Rails 3 or not - we're not there yet.

Cheers,
    Jonathan.</body>
      <body-html>&lt;div&gt;&lt;p&gt;FWIW, we had a similar problem on Rails 2.2.x and fixed it by
monkey patching ActiveRecord::Base.inspect:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;module ActiveRecord
  class Base
    def self.inspect
      if self == Base
        super
      elsif abstract_class?
        &quot;#{super}(abstract)&quot; 
      else
        begin
          attr_list = columns.map { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '
          &quot;#{super}(#{attr_list})&quot; 
        rescue Exception =&amp;gt; e
          # Any exception is likely to be caused by the table not existing!
          &quot;#{super}(Table doesn't exist)&quot;
        end
      end
    end
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The original code relied on &lt;code&gt;table_exists?&lt;/code&gt; which
causes a &lt;code&gt;SHOW TABLES&lt;/code&gt; query without any caching. I
decided that if you call &lt;code&gt;table_exists?&lt;/code&gt; then you
probably wanted to explicitly check if the table exists, but for
&lt;code&gt;inspect&lt;/code&gt; it would be OK to just rely on
&lt;code&gt;columns&lt;/code&gt; failing.&lt;/p&gt;
&lt;p&gt;I don't know if this is helpful on Rails 3 or not - we're not
there yet.&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Jonathan.&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-14T16:00:46+00:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-03-14T16:01:06+00:00</updated-at>
      <user-id type="integer">51960</user-id>
      <version type="integer">23</version>
      <user-name>Jonathan Monahan</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Bump, this is still a huge &amp; pervasive issue -- you can balloon error pages to 2.5MB just by adding omniauth to a vanilla Rails app. There's a healthy discussion here, including some .inspect monkeypatches:

http://stackoverflow.com/questions/3114993/exception-pages-in-development-mode-take-upwards-of-15-30-seconds-to-render-why</body>
      <body-html>&lt;div&gt;&lt;p&gt;Bump, this is still a huge &amp;amp; pervasive issue -- you can
balloon error pages to 2.5MB just by adding omniauth to a vanilla
Rails app. There's a healthy discussion here, including some
.inspect monkeypatches:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://stackoverflow.com/questions/3114993/exception-pages-in-development-mode-take-upwards-of-15-30-seconds-to-render-why&quot;&gt;
http://stackoverflow.com/questions/3114993/exception-pages-in-devel...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-07T01:37:43+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-04-07T01:38:09+01:00</updated-at>
      <user-id type="integer">8924</user-id>
      <version type="integer">24</version>
      <user-name>Jamie Wilkinson</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Any one of the @_response, @_request, and @_env instance variables in a controller object have inspects that are so enormous that they are useless.  The problem is really that inspecting the env hash inspects the controller, which has the env hash as an instance variable, and has other instance variables which have the env hash as an instance variable.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any one of the @&lt;em&gt;response, @&lt;/em&gt;request, and @_env instance
variables in a controller object have inspects that are so enormous
that they are useless. The problem is really that inspecting the
env hash inspects the controller, which has the env hash as an
instance variable, and has other instance variables which have the
env hash as an instance variable.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-07T18:36:31+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-04-07T18:36:59+01:00</updated-at>
      <user-id type="integer">112960</user-id>
      <version type="integer">25</version>
      <user-name>Raphael Sofaer</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Bump +1 - ran into this today using Rails v3.0.6 and pow. Ended up using the &quot;SmallInspect&quot; mixin from the stackoverflow post above after spending waay to much time on it. This reduces the time from 45 seconds on exception to around 5 though it does NOT solve the tons of SHOW_TABLE messages flying by in the logfile.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Bump +1 - ran into this today using Rails v3.0.6 and pow. Ended
up using the &quot;SmallInspect&quot; mixin from the stackoverflow post above
after spending waay to much time on it. This reduces the time from
45 seconds on exception to around 5 though it does NOT solve the
tons of SHOW_TABLE messages flying by in the logfile.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T04:28:29+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-04-28T04:28:52+01:00</updated-at>
      <user-id type="integer">17051</user-id>
      <version type="integer">26</version>
      <user-name>Adam Bair</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>For the SHOW_TABLES issue one thing you might want to check is to see if you have any route constraints. We noticed that we, Ping - a coworker and myself, could stop the tables from showing up by overriding the inspect method on the model on the constraint. In our case it was the Account model. We did something like this:

  def self.inspect
    ['id','name', 'domain', 'subdomain'].each { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '
  end  

I know that this place is defunct but I wanted to add this here just in case it could help someone.</body>
      <body-html>&lt;div&gt;&lt;p&gt;For the SHOW_TABLES issue one thing you might want to check is
to see if you have any route constraints. We noticed that we, Ping
- a coworker and myself, could stop the tables from showing up by
overriding the inspect method on the model on the constraint. In
our case it was the Account model. We did something like this:&lt;/p&gt;
&lt;p&gt;def self.inspect&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;['id','name', 'domain', 'subdomain'].each { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I know that this place is defunct but I wanted to add this here
just in case it could help someone.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T15:37:46+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-04-28T15:38:15+01:00</updated-at>
      <user-id type="integer">17051</user-id>
      <version type="integer">27</version>
      <user-name>Adam Bair</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>def self.inspect
      ['id','name', 'domain', 'subdomain'].each { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '
    end

Is what I meant to say.</body>
      <body-html>&lt;div&gt;&lt;p&gt;def self.inspect&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;  ['id','name', 'domain', 'subdomain'].each { |c| &quot;#{c.name}: #{c.type}&quot; } * ', '
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Is what I meant to say.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T15:38:18+01:00</created-at>
      <creator-id type="integer">82933</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">5027</number>
      <permalink>_request_and_responseerb-and-diagnosticserb-take-an-increasingly-long-time-to-render-in-development-with-multiple-show-tables-calls</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag nil="true"></tag>
      <title>_request_and_response.erb and diagnostics.erb take an increasingly long time to render in development with multiple SHOW TABLES calls</title>
      <updated-at type="datetime">2011-04-28T15:38:45+01:00</updated-at>
      <user-id type="integer">17051</user-id>
      <version type="integer">28</version>
      <user-name>Adam Bair</user-name>
      <creator-name>Garrett Bjerkhoel</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5027</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>949821a3361aeb0d8c03015a82f763633867c53b</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-01T14:36:56+01:00</created-at>
      <filename>stacktrace.txt</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">583394</id>
      <size type="integer">19367</size>
      <uploader-id type="integer">82933</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/583394/stacktrace.txt</url>
    </attachment>
    <attachment type="Attachment">
      <code>6b6c5029082d4d222a465d187b5436be27d8d6e4</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-03-07T23:07:44+00:00</created-at>
      <filename>0001-make-session-and-environme.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">946713</id>
      <size type="integer">2608</size>
      <uploader-id type="integer">20511</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/946713/0001-make-session-and-environme.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>a1b46b4a09cbbc40647f8ef4d6b3c8700e131e74</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-03-08T20:06:00+00:00</created-at>
      <filename>0001-make-session-and-environme.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">948520</id>
      <size type="integer">2789</size>
      <uploader-id type="integer">20511</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/948520/0001-make-session-and-environme.patch</url>
    </attachment>
  </attachments>
</ticket>
