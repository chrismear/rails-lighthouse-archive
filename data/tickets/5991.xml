<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-17T11:31:45+00:00</created-at>
  <creator-id type="integer">124337</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5991</number>
  <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag nil="true"></tag>
  <title>406 Unacceptable received for something the Accept header has said it can take</title>
  <updated-at type="datetime">2010-11-19T11:53:25+00:00</updated-at>
  <user-id type="integer">19965</user-id>
  <version type="integer">5</version>
  <user-name>Jos&#233; Valim</user-name>
  <creator-name>Russell Garner</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
  <priority-name>Low</priority-name>
  <original-body>I have a &quot;build your own feed&quot; kind of HTML form which POSTs to a controller action which can only return ATOM:

@@@
respond_to :atom
.
.
respond_with(@articles = Article.paged_since(@date, params[:path], params[:page], params[:include_deleted]))
@@@

The browser's `Accept` header is Firefox's default:

`&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;`

Unfortunately, posting to this action yields &quot;406 Unacceptable&quot; despite the fact the browser has said we can accept anything and we have an ATOM representation ready to go (this used to work in 2.3.5 - I've hit this apropos of upgrading to 3.0.3).  I think this is an error - do people agree?  It seems to be related to the following ticket:

https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression

Before I start looking at how to be a contributor, is there anything obvious to anyone else that I've missed?

Cheers.</original-body>
  <latest-body>I have a &quot;build your own feed&quot; kind of HTML form which POSTs to a controller action which can only return ATOM:

@@@
respond_to :atom
.
.
respond_with(@articles = Article.paged_since(@date, params[:path], params[:page], params[:include_deleted]))
@@@

The browser's `Accept` header is Firefox's default:

`&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;`

Unfortunately, posting to this action yields &quot;406 Unacceptable&quot; despite the fact the browser has said we can accept anything and we have an ATOM representation ready to go (this used to work in 2.3.5 - I've hit this apropos of upgrading to 3.0.3).  I think this is an error - do people agree?  It seems to be related to the following ticket:

https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression

Before I start looking at how to be a contributor, is there anything obvious to anyone else that I've missed?

Cheers.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I have a &quot;build your own feed&quot; kind of HTML form which POSTs to
a controller action which can only return ATOM:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;respond_to :atom
.
.
respond_with(@articles = Article.paged_since(@date, params[:path], params[:page], params[:include_deleted]))&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The browser's &lt;code&gt;Accept&lt;/code&gt; header is Firefox's
default:&lt;/p&gt;
&lt;p&gt;
&lt;code&gt;&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately, posting to this action yields &quot;406 Unacceptable&quot;
despite the fact the browser has said we can accept anything and we
have an ATOM representation ready to go (this used to work in 2.3.5
- I've hit this apropos of upgrading to 3.0.3). I think this is an
error - do people agree? It seems to be related to the following
ticket:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression&quot;&gt;
https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Before I start looking at how to be a contributor, is there
anything obvious to anyone else that I've missed?&lt;/p&gt;
&lt;p&gt;Cheers.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I have a &quot;build your own feed&quot; kind of HTML form which POSTs to a controller action which can only return ATOM:

@@@
respond_to :atom
.
.
respond_with(@articles = Article.paged_since(@date, params[:path], params[:page], params[:include_deleted]))
@@@

The browser's `Accept` header is Firefox's default:

`&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;`

Unfortunately, posting to this action yields &quot;406 Unacceptable&quot; despite the fact the browser has said we can accept anything and we have an ATOM representation ready to go (this used to work in 2.3.5 - I've hit this apropos of upgrading to 3.0.3).  I think this is an error - do people agree?  It seems to be related to the following ticket:

https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression

Before I start looking at how to be a contributor, is there anything obvious to anyone else that I've missed?

Cheers.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have a &quot;build your own feed&quot; kind of HTML form which POSTs to
a controller action which can only return ATOM:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;respond_to :atom
.
.
respond_with(@articles = Article.paged_since(@date, params[:path], params[:page], params[:include_deleted]))&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The browser's &lt;code&gt;Accept&lt;/code&gt; header is Firefox's
default:&lt;/p&gt;
&lt;p&gt;
&lt;code&gt;&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately, posting to this action yields &quot;406 Unacceptable&quot;
despite the fact the browser has said we can accept anything and we
have an ATOM representation ready to go (this used to work in 2.3.5
- I've hit this apropos of upgrading to 3.0.3). I think this is an
error - do people agree? It seems to be related to the following
ticket:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-negotiation-regression&quot;&gt;
https://rails.lighthouseapp.com/projects/8994/tickets/3541-content-...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Before I start looking at how to be a contributor, is there
anything obvious to anyone else that I've missed?&lt;/p&gt;
&lt;p&gt;Cheers.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-17T11:31:45+00:00</created-at>
      <creator-id type="integer">124337</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5991</number>
      <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>406 Unacceptable received for something the Accept header has said it can take</title>
      <updated-at type="datetime">2010-11-19T08:43:52+00:00</updated-at>
      <user-id type="integer">124337</user-id>
      <version type="integer">1</version>
      <user-name>Russell Garner</user-name>
      <creator-name>Russell Garner</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached 5991_tests.patch to demonstrate.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached 5991_tests.patch to demonstrate.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-17T17:51:34+00:00</created-at>
      <creator-id type="integer">124337</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5991</number>
      <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>406 Unacceptable received for something the Accept header has said it can take</title>
      <updated-at type="datetime">2010-11-17T17:51:39+00:00</updated-at>
      <user-id type="integer">124337</user-id>
      <version type="integer">2</version>
      <user-name>Russell Garner</user-name>
      <creator-name>Russell Garner</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yes, but this can't be fixed. Some browsers (cof cof IE) are really retarded when sending accept headers in the sense it may pass image/png or atom with higher priority than text/html. So rails tries to detect everything that looks like a bad browser request and defaults it to HTML. sorry, but You will need to pass :format =&gt; :atom as option to form_for or ensure in other way .atom is present at the end of the URL.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, but this can't be fixed. Some browsers (cof cof IE) are
really retarded when sending accept headers in the sense it may
pass image/png or atom with higher priority than text/html. So
rails tries to detect everything that looks like a bad browser
request and defaults it to HTML. sorry, but You will need to pass
:format =&amp;gt; :atom as option to form_for or ensure in other way
.atom is present at the end of the URL.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-19T10:31:39+00:00</created-at>
      <creator-id type="integer">124337</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5991</number>
      <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag nil="true"></tag>
      <title>406 Unacceptable received for something the Accept header has said it can take</title>
      <updated-at type="datetime">2010-11-19T10:31:40+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">3</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Russell Garner</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>If I found a way to make the above tests pass in addition to everyone else's, would you consider a patch?  I'm actually hacking the `request.format = :atom` in the controller action at the moment, but I don't believe serving a 406 when any agent (browser or otherwise) has said they can accept anything and there are formats there waiting is good HTTP.  We're letting bad browsers like (cough cough ;)) IE dictate good HTTP-related server practice.</body>
      <body-html>&lt;div&gt;&lt;p&gt;If I found a way to make the above tests pass in addition to
everyone else's, would you consider a patch? I'm actually hacking
the &lt;code&gt;request.format = :atom&lt;/code&gt; in the controller action at
the moment, but I don't believe serving a 406 when any agent
(browser or otherwise) has said they can accept anything and there
are formats there waiting is good HTTP. We're letting bad browsers
like (cough cough ;)) IE dictate good HTTP-related server
practice.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-19T10:56:25+00:00</created-at>
      <creator-id type="integer">124337</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5991</number>
      <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag nil="true"></tag>
      <title>406 Unacceptable received for something the Accept header has said it can take</title>
      <updated-at type="datetime">2010-11-19T10:56:27+00:00</updated-at>
      <user-id type="integer">124337</user-id>
      <version type="integer">4</version>
      <user-name>Russell Garner</user-name>
      <creator-name>Russell Garner</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yes, if you find a way to circumvent the issue, a patch is welcome. :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, if you find a way to circumvent the issue, a patch is
welcome. :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-19T11:53:24+00:00</created-at>
      <creator-id type="integer">124337</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5991</number>
      <permalink>406-unacceptable-received-for-something-the-accept-header-has-said-it-can-take</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag nil="true"></tag>
      <title>406 Unacceptable received for something the Accept header has said it can take</title>
      <updated-at type="datetime">2010-11-19T11:53:25+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">5</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Russell Garner</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5991</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ef57f92fa8435da627abe3d44be83f387259ab9f</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-17T17:51:06+00:00</created-at>
      <filename>5991_tests.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">775731</id>
      <size type="integer">909</size>
      <uploader-id type="integer">124337</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/775731/5991_tests.patch</url>
    </attachment>
  </attachments>
</ticket>
