<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-10-21T17:03:36+01:00</created-at>
  <creator-id type="integer">23341</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">3403</number>
  <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
  <priority type="integer">26</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag nil="true"></tag>
  <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
  <updated-at type="datetime">2010-10-15T23:01:37+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">7</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Sam Ruby</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Symptoms:

rs = ActionController::Routing::Routes
last_request = rs.recognize_path &quot;/blog/2006/07/28&quot;
rs.generate({:year =&gt; 2006}, last_request)

2.3.3 =&gt; &quot;/blog/2006/07/28&quot;
2.3.4 =&gt; /blog/show_date?year=2006&quot;
3.0pre =&gt; &quot;/blog/2006&quot;

Note: the issue isn't that it isn't picking the &quot;optimum&quot; URI, the issue is that it isn't picking one that matches the last_request.</original-body>
  <latest-body>Symptoms:

rs = ActionController::Routing::Routes
last_request = rs.recognize_path &quot;/blog/2006/07/28&quot;
rs.generate({:year =&gt; 2006}, last_request)

2.3.3 =&gt; &quot;/blog/2006/07/28&quot;
2.3.4 =&gt; /blog/show_date?year=2006&quot;
3.0pre =&gt; &quot;/blog/2006&quot;

Note: the issue isn't that it isn't picking the &quot;optimum&quot; URI, the issue is that it isn't picking one that matches the last_request.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Symptoms:&lt;/p&gt;
&lt;p&gt;rs = ActionController::Routing::Routes&lt;br&gt;
last_request = rs.recognize_path &quot;/blog/2006/07/28&quot;&lt;br&gt;
rs.generate({:year =&amp;gt; 2006}, last_request)&lt;/p&gt;
&lt;p&gt;2.3.3 =&amp;gt; &quot;/blog/2006/07/28&quot;&lt;br&gt;
2.3.4 =&amp;gt; /blog/show_date?year=2006&quot;&lt;br&gt;
3.0pre =&amp;gt; &quot;/blog/2006&quot;&lt;/p&gt;
&lt;p&gt;Note: the issue isn't that it isn't picking the &quot;optimum&quot; URI,
the issue is that it isn't picking one that matches the
last_request.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Symptoms:

rs = ActionController::Routing::Routes
last_request = rs.recognize_path &quot;/blog/2006/07/28&quot;
rs.generate({:year =&gt; 2006}, last_request)

2.3.3 =&gt; &quot;/blog/2006/07/28&quot;
2.3.4 =&gt; /blog/show_date?year=2006&quot;
3.0pre =&gt; &quot;/blog/2006&quot;

Note: the issue isn't that it isn't picking the &quot;optimum&quot; URI, the issue is that it isn't picking one that matches the last_request.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Symptoms:&lt;/p&gt;
&lt;p&gt;rs = ActionController::Routing::Routes&lt;br&gt;
last_request = rs.recognize_path &quot;/blog/2006/07/28&quot;&lt;br&gt;
rs.generate({:year =&amp;gt; 2006}, last_request)&lt;/p&gt;
&lt;p&gt;2.3.3 =&amp;gt; &quot;/blog/2006/07/28&quot;&lt;br&gt;
2.3.4 =&amp;gt; /blog/show_date?year=2006&quot;&lt;br&gt;
3.0pre =&amp;gt; &quot;/blog/2006&quot;&lt;/p&gt;
&lt;p&gt;Note: the issue isn't that it isn't picking the &quot;optimum&quot; URI,
the issue is that it isn't picking one that matches the
last_request.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-21T17:03:36+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-10-21T17:03:37+01:00</updated-at>
      <user-id type="integer">23341</user-id>
      <version type="integer">1</version>
      <user-name>Sam Ruby</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can you please post the route configuration.

Also, both &quot;recognize&quot; and &quot;recognize_path&quot; are deprecated apis. I'm going put a notice in 2.3.x in favor of only providing the &quot;call&quot; api for recognizing routes.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you please post the route configuration.&lt;/p&gt;
&lt;p&gt;Also, both &quot;recognize&quot; and &quot;recognize_path&quot; are deprecated apis.
I'm going put a notice in 2.3.x in favor of only providing the
&quot;call&quot; api for recognizing routes.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-21T19:15:18+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-10-21T19:15:19+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">2</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Here is the entire script: http://github.com/rubys/awdwr/raw/master/data/code/e1/routing/config/routes_for_blog.rb

You can run it from an empty rails project, using either script/console or irb.

The output from the run can be found at (ruby 1.8.7 and ruby 1.9.2 respectively):

http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-21.2
http://intertwingly.net/projects/AWDwR3/checkdepot-rvm-1.9.2.html#section-21.2

I don't see any deprecation warnings produced.  I am open to any suggestions as to better APIs that provide the same basic abilities to manipulate and explore routes.  I don't understand the reference to the &quot;call&quot; api.

For references, here is comparable output from Rails 2.3.2:

http://intertwingly.net/projects/AWDwR3/checkdepot-2.3.2.html#section-21.2</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here is the entire script: &lt;a href=
&quot;http://github.com/rubys/awdwr/raw/master/data/code/e1/routing/config/routes_for_blog.rb&quot;&gt;
http://github.com/rubys/awdwr/raw/master/data/code/e1/routing/confi...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You can run it from an empty rails project, using either
script/console or irb.&lt;/p&gt;
&lt;p&gt;The output from the run can be found at (ruby 1.8.7 and ruby
1.9.2 respectively):&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-21.2&quot;&gt;
http://intertwingly.net/projects/AWDwR3/checkdepot.html#section-21.2&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://intertwingly.net/projects/AWDwR3/checkdepot-rvm-1.9.2.html#section-21.2&quot;&gt;
http://intertwingly.net/projects/AWDwR3/checkdepot-rvm-1.9.2.html#s...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I don't see any deprecation warnings produced. I am open to any
suggestions as to better APIs that provide the same basic abilities
to manipulate and explore routes. I don't understand the reference
to the &quot;call&quot; api.&lt;/p&gt;
&lt;p&gt;For references, here is comparable output from Rails 2.3.2:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://intertwingly.net/projects/AWDwR3/checkdepot-2.3.2.html#section-21.2&quot;&gt;
http://intertwingly.net/projects/AWDwR3/checkdepot-2.3.2.html#secti...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-21T20:31:42+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-10-21T20:31:45+01:00</updated-at>
      <user-id type="integer">23341</user-id>
      <version type="integer">3</version>
      <user-name>Sam Ruby</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-08T20:38:45+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-11-08T20:38:46+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">4</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I added a pending test based on your AWD test case.

http://github.com/rails/rails/commit/e9d21ca903adbcfaae5ac37a1a46dbb285cd6761</body>
      <body-html>&lt;div&gt;&lt;p&gt;I added a pending test based on your AWD test case.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/e9d21ca903adbcfaae5ac37a1a46dbb285cd6761&quot;&gt;
http://github.com/rails/rails/commit/e9d21ca903adbcfaae5ac37a1a46db...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-11-10T04:19:30+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-11-10T04:19:33+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think we're just going settle on breaking backwards compatibility here.

@@@ ruby
  map.connect &quot;blog/:year/:month/:day&quot;, 
              :controller =&gt; &quot;blog&quot;, 
              :action =&gt; &quot;show_date&quot;, 
              :requirements =&gt; { :year =&gt; /(19|20)\d\d/,
                                 :month =&gt; /[01]?\d/, 
                                 :day =&gt; /[0-3]?\d/}, 
              :day =&gt; nil, 
              :month =&gt; nil 
@@@

:year, :month, and :day are all optional segments. It will not use last_request/recalled params to fill in optional segments. This is generally the policy of the old router. However passing in :day and :month with nil cause some weird quirks. This behavior was never officially doc or ever tested. It just happened to work.

Relying on this nil quirk to force recalled params to be used will be deprecated in 3.0. 


Sam, ping me on CF if you want to discuss further.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think we're just going settle on breaking backwards
compatibility here.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  map.connect &quot;blog/:year/:month/:day&quot;, 
              :controller =&amp;gt; &quot;blog&quot;, 
              :action =&amp;gt; &quot;show_date&quot;, 
              :requirements =&amp;gt; { :year =&amp;gt; /(19|20)\d\d/,
                                 :month =&amp;gt; /[01]?\d/, 
                                 :day =&amp;gt; /[0-3]?\d/}, 
              :day =&amp;gt; nil, 
              :month =&amp;gt; nil&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;:year, :month, and :day are all optional segments. It will not
use last_request/recalled params to fill in optional segments. This
is generally the policy of the old router. However passing in :day
and :month with nil cause some weird quirks. This behavior was
never officially doc or ever tested. It just happened to work.&lt;/p&gt;
&lt;p&gt;Relying on this nil quirk to force recalled params to be used
will be deprecated in 3.0.&lt;/p&gt;
&lt;p&gt;Sam, ping me on CF if you want to discuss further.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-12-06T21:48:52+00:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2009-12-06T21:48:56+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">6</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:37+01:00</created-at>
      <creator-id type="integer">23341</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">3403</number>
      <permalink>last-request-no-longer-respected-awdwr3-section-212</permalink>
      <priority type="integer">26</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag nil="true"></tag>
      <title>Last Request no longer respected (AWDwR3, section 21.2)</title>
      <updated-at type="datetime">2010-10-15T23:01:37+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Sam Ruby</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3403</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
