<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-04-28T14:25:17+01:00</created-at>
  <creator-id type="integer">750</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">2575</number>
  <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
  <priority type="integer">1715</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>2-3-stable activerecord sti</tag>
  <title>Not Eager Loading Application Classes Causes STI Breakage</title>
  <updated-at type="datetime">2011-02-02T19:04:32+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">7</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Peter Marklund</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
  <milestone-title>3.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>It turns out that the fact that we don't typically eager load application classes in the development environment (since cache_classes is false) can break STI since the subclasses may not have been loaded when the SQL query is constructed. See this blog post for more:

http://developer.newsdesk.se/2009/04/28/rails-gotcha-eager-loading-application-classes-to-make-sti-work

The only simple solution that comes to my mind right now is to always eager load application classes.</original-body>
  <latest-body>It turns out that the fact that we don't typically eager load application classes in the development environment (since cache_classes is false) can break STI since the subclasses may not have been loaded when the SQL query is constructed. See this blog post for more:

http://developer.newsdesk.se/2009/04/28/rails-gotcha-eager-loading-application-classes-to-make-sti-work

The only simple solution that comes to my mind right now is to always eager load application classes.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;It turns out that the fact that we don't typically eager load
application classes in the development environment (since
cache_classes is false) can break STI since the subclasses may not
have been loaded when the SQL query is constructed. See this blog
post for more:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://developer.newsdesk.se/2009/04/28/rails-gotcha-eager-loading-application-classes-to-make-sti-work&quot;&gt;
http://developer.newsdesk.se/200...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The only simple solution that comes to my mind right now is to
always eager load application classes.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>It turns out that the fact that we don't typically eager load application classes in the development environment (since cache_classes is false) can break STI since the subclasses may not have been loaded when the SQL query is constructed. See this blog post for more:

http://developer.newsdesk.se/2009/04/28/rails-gotcha-eager-loading-application-classes-to-make-sti-work

The only simple solution that comes to my mind right now is to always eager load application classes.</body>
      <body-html>&lt;div&gt;&lt;p&gt;It turns out that the fact that we don't typically eager load
application classes in the development environment (since
cache_classes is false) can break STI since the subclasses may not
have been loaded when the SQL query is constructed. See this blog
post for more:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://developer.newsdesk.se/2009/04/28/rails-gotcha-eager-loading-application-classes-to-make-sti-work&quot;&gt;
http://developer.newsdesk.se/200...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The only simple solution that comes to my mind right now is to
always eager load application classes.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-28T14:25:17+01:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2009-04-28T14:25:22+01:00</updated-at>
      <user-id type="integer">750</user-id>
      <version type="integer">1</version>
      <user-name>Peter Marklund</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>or explicitly load them at the end of the parent class' file (I know, not very nice)</body>
      <body-html>&lt;div&gt;&lt;p&gt;or explicitly load them at the end of the parent class' file (I
know, not very nice)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-07T23:08:26+01:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2009-05-07T23:08:27+01:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">2</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've added 2 configuration options:

* reset_subclasses: clear AR::Base subclasses;
* load_application_classes: eager load application classes;

With those, you can set your development environment to eager load application and don't clear models subclasses. So it will load all models at startup time and subclasses structure will not be cleared after each request.

If you change model' subclasses structure you have reboot application.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've added 2 configuration options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;reset_subclasses: clear AR::Base subclasses;&lt;/li&gt;
&lt;li&gt;load_application_classes: eager load application classes;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With those, you can set your development environment to eager
load application and don't clear models subclasses. So it will load
all models at startup time and subclasses structure will not be
cleared after each request.&lt;/p&gt;
&lt;p&gt;If you change model' subclasses structure you have reboot
application.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-12T23:04:05+01:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2009-08-12T23:04:12+01:00</updated-at>
      <user-id type="integer">64076</user-id>
      <version type="integer">3</version>
      <user-name>dlibanori</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Last diff is to master, not Rails 2.3.3</body>
      <body-html>&lt;div&gt;&lt;p&gt;Last diff is to master, not Rails 2.3.3&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-12T23:07:05+01:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2009-08-12T23:07:12+01:00</updated-at>
      <user-id type="integer">64076</user-id>
      <version type="integer">4</version>
      <user-name>dlibanori</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:48+01:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2010-05-04T18:48:48+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">5</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T17:02:43+00:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:state: new
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">1715</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2011-02-02T19:04:32+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">6</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T17:02:44+00:00</created-at>
      <creator-id type="integer">750</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2575</number>
      <permalink>not-eager-loading-application-classes-causes-sti-breakage</permalink>
      <priority type="integer">1715</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2-3-stable activerecord sti</tag>
      <title>Not Eager Loading Application Classes Causes STI Breakage</title>
      <updated-at type="datetime">2011-02-02T19:04:20+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Peter Marklund</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2575</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>54d929ca5ef3fcec62fc50dbe3239282afd01149</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-08-12T23:04:06+01:00</created-at>
      <filename>new_config_options.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">242539</id>
      <size type="integer">14794</size>
      <uploader-id type="integer">64076</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/242539/new_config_options.diff</url>
    </attachment>
  </attachments>
</ticket>
