From 2bbb8dd5efeee0a05abcc492b36ec29159076f50 Mon Sep 17 00:00:00 2001
From: Antonio Cangiano <acangiano@gmail.com>
Date: Wed, 11 Jun 2008 15:25:19 -0400
Subject: [PATCH] Fixed non-standard SQL generated by preloading has_and_belongs_to_many association

---
 .../lib/active_record/association_preload.rb       |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/activerecord/lib/active_record/association_preload.rb b/activerecord/lib/active_record/association_preload.rb
index a3d1f12..49f5270 100644
--- a/activerecord/lib/active_record/association_preload.rb
+++ b/activerecord/lib/active_record/association_preload.rb
@@ -103,10 +103,10 @@ module ActiveRecord
         associated_records = reflection.klass.find(:all, :conditions => [conditions, ids],
         :include => options[:include],
         :joins => "INNER JOIN #{connection.quote_table_name options[:join_table]} as t0 ON #{reflection.klass.quoted_table_name}.#{reflection.klass.primary_key} = t0.#{reflection.association_foreign_key}",
-        :select => "#{options[:select] || table_name+'.*'}, t0.#{reflection.primary_key_name} as _parent_record_id",
+        :select => "#{options[:select] || table_name+'.*'}, t0.#{reflection.primary_key_name} as the_parent_record_id",
         :order => options[:order])
 
-        set_association_collection_records(id_to_record_map, reflection.name, associated_records, '_parent_record_id')
+        set_association_collection_records(id_to_record_map, reflection.name, associated_records, 'the_parent_record_id')
       end
 
       def preload_has_one_association(records, reflection, preload_options={})
-- 
1.5.5.1015.g9d258

