<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">85</assigned-user-id>
  <attachments-count type="integer">7</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-25T12:27:57+00:00</created-at>
  <creator-id type="integer">26148</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">2991</number>
  <permalink>after-transaction-patch</permalink>
  <priority type="integer">2</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>3.0 active_record transaction</tag>
  <title>After Transaction Patch</title>
  <updated-at type="datetime">2010-11-25T12:27:57+00:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">30</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Brian Durand</creator-name>
  <assigned-user-name>Jeremy Kemper</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Medium</priority-name>
  <original-body>This patch provides hooks for callbacks after a transaction rolls back or commits. It is intended to address some inconsistencies with the current Rails code as well as offer hooks for developers to execute code at the appropriate time.

## Bug with creating records in transaction block ##

The current transaction code will roll back a newly created record to the proper state with a nil id and new_record? returning true, but only when an error is encountered while the record is being saved. If you have a multi statement transaction, records will not be rolled back properly. Take this case:

@@@ ruby
class Model &lt; ActiveRecord::Base
  def after_save
    raise &quot;illegal value&quot; if title == &quot;xxx&quot;
  end
end
@@@

This code works fine:

@@@ ruby
model = Model.new(:title =&gt; &quot;xxx&quot;)
assert model.new_record?
model.save
assert model.new_record?
@@@

However, wrap it in a transaction block, and it fails:

@@@ ruby
Model.transaction do
  model = Model.new(:title =&gt; &quot;valid&quot;)
  assert model.new_record?
  model.save
  raise ActiveRecord::Rollback
end
assert model.new_record? # Fail!
@@@

This patch solves the issue by keeping track of all records saved or destroyed in a transaction and rolling back the id and new_record? for newly created records when transactions are rolled back.

## Callbacks after_commit, after_rollback ##

In addition, the patch adds callbacks for after_commit and after_rollback which are called after a commit or rollback is sent to the database. The intention is to allow developers to hook in code to communicate with systems external to the database.

For example, a common construct with caching is to add a clear cache call to an after_save callback. However, since after_save callbacks happen within a transaction, the cache will be cleared before the changes is committed to the database. This leaves a small window where another process can regenerate the cache entry:

Process 1 -&gt; begin transaction
Process 1 -&gt; save record
Process 1 -&gt; clear cache
Process 2 -&gt; read cache
Process 2 -&gt; regenerate cache from database
Process 1 -&gt; commit transaction

In this case, Process 2 will generate what will be a stale cache entry out of sync with the database. This bug is most likely to occur in a transaction block or if there are additional after_save callbacks on the model.

As another example, some models may store data external to the database (i.e. on the file system) that needs to be cleaned up if the record is not successfully saved. Once again, this can fail in a transaction block where the record is rolled back after any after save has occurred.</original-body>
  <latest-body>This patch provides hooks for callbacks after a transaction rolls back or commits. It is intended to address some inconsistencies with the current Rails code as well as offer hooks for developers to execute code at the appropriate time.

## Bug with creating records in transaction block ##

The current transaction code will roll back a newly created record to the proper state with a nil id and new_record? returning true, but only when an error is encountered while the record is being saved. If you have a multi statement transaction, records will not be rolled back properly. Take this case:

@@@ ruby
class Model &lt; ActiveRecord::Base
  def after_save
    raise &quot;illegal value&quot; if title == &quot;xxx&quot;
  end
end
@@@

This code works fine:

@@@ ruby
model = Model.new(:title =&gt; &quot;xxx&quot;)
assert model.new_record?
model.save
assert model.new_record?
@@@

However, wrap it in a transaction block, and it fails:

@@@ ruby
Model.transaction do
  model = Model.new(:title =&gt; &quot;valid&quot;)
  assert model.new_record?
  model.save
  raise ActiveRecord::Rollback
end
assert model.new_record? # Fail!
@@@

This patch solves the issue by keeping track of all records saved or destroyed in a transaction and rolling back the id and new_record? for newly created records when transactions are rolled back.

## Callbacks after_commit, after_rollback ##

In addition, the patch adds callbacks for after_commit and after_rollback which are called after a commit or rollback is sent to the database. The intention is to allow developers to hook in code to communicate with systems external to the database.

For example, a common construct with caching is to add a clear cache call to an after_save callback. However, since after_save callbacks happen within a transaction, the cache will be cleared before the changes is committed to the database. This leaves a small window where another process can regenerate the cache entry:

Process 1 -&gt; begin transaction
Process 1 -&gt; save record
Process 1 -&gt; clear cache
Process 2 -&gt; read cache
Process 2 -&gt; regenerate cache from database
Process 1 -&gt; commit transaction

In this case, Process 2 will generate what will be a stale cache entry out of sync with the database. This bug is most likely to occur in a transaction block or if there are additional after_save callbacks on the model.

As another example, some models may store data external to the database (i.e. on the file system) that needs to be cleaned up if the record is not successfully saved. Once again, this can fail in a transaction block where the record is rolled back after any after save has occurred.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;This patch provides hooks for callbacks after a transaction
rolls back or commits. It is intended to address some
inconsistencies with the current Rails code as well as offer hooks
for developers to execute code at the appropriate time.&lt;/p&gt;
&lt;h2&gt;Bug with creating records in transaction block&lt;/h2&gt;
&lt;p&gt;The current transaction code will roll back a newly created
record to the proper state with a nil id and new_record? returning
true, but only when an error is encountered while the record is
being saved. If you have a multi statement transaction, records
will not be rolled back properly. Take this case:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
class Model &amp;lt; ActiveRecord::Base
  def after_save
    raise &amp;quot;illegal value&amp;quot; if title == &amp;quot;xxx&amp;quot;
  end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This code works fine:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
model = Model.new(:title =&amp;gt; &amp;quot;xxx&amp;quot;)
assert model.new_record?
model.save
assert model.new_record?
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, wrap it in a transaction block, and it fails:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
Model.transaction do
  model = Model.new(:title =&amp;gt; &amp;quot;valid&amp;quot;)
  assert model.new_record?
  model.save
  raise ActiveRecord::Rollback
end
assert model.new_record? # Fail!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This patch solves the issue by keeping track of all records
saved or destroyed in a transaction and rolling back the id and
new_record? for newly created records when transactions are rolled
back.&lt;/p&gt;
&lt;h2&gt;Callbacks after_commit, after_rollback&lt;/h2&gt;
&lt;p&gt;In addition, the patch adds callbacks for after_commit and
after_rollback which are called after a commit or rollback is sent
to the database. The intention is to allow developers to hook in
code to communicate with systems external to the database.&lt;/p&gt;
&lt;p&gt;For example, a common construct with caching is to add a clear
cache call to an after_save callback. However, since after_save
callbacks happen within a transaction, the cache will be cleared
before the changes is committed to the database. This leaves a
small window where another process can regenerate the cache
entry:&lt;/p&gt;
&lt;p&gt;Process 1 -&amp;gt; begin transaction Process 1 -&amp;gt; save record
Process 1 -&amp;gt; clear cache Process 2 -&amp;gt; read cache Process 2
-&amp;gt; regenerate cache from database Process 1 -&amp;gt; commit
transaction&lt;/p&gt;
&lt;p&gt;In this case, Process 2 will generate what will be a stale cache
entry out of sync with the database. This bug is most likely to
occur in a transaction block or if there are additional after_save
callbacks on the model.&lt;/p&gt;
&lt;p&gt;As another example, some models may store data external to the
database (i.e. on the file system) that needs to be cleaned up if
the record is not successfully saved. Once again, this can fail in
a transaction block where the record is rolled back after any after
save has occurred.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This patch provides hooks for callbacks after a transaction rolls back or commits. It is intended to address some inconsistencies with the current Rails code as well as offer hooks for developers to execute code at the appropriate time.

## Bug with creating records in transaction block ##

The current transaction code will roll back a newly created record to the proper state with a nil id and new_record? returning true, but only when an error is encountered while the record is being saved. If you have a multi statement transaction, records will not be rolled back properly. Take this case:

@@@ ruby
class Model &lt; ActiveRecord::Base
  def after_save
    raise &quot;illegal value&quot; if title == &quot;xxx&quot;
  end
end
@@@

This code works fine:

@@@ ruby
model = Model.new(:title =&gt; &quot;xxx&quot;)
assert model.new_record?
model.save
assert model.new_record?
@@@

However, wrap it in a transaction block, and it fails:

@@@ ruby
Model.transaction do
  model = Model.new(:title =&gt; &quot;valid&quot;)
  assert model.new_record?
  model.save
  raise ActiveRecord::Rollback
end
assert model.new_record? # Fail!
@@@

This patch solves the issue by keeping track of all records saved or destroyed in a transaction and rolling back the id and new_record? for newly created records when transactions are rolled back.

## Callbacks after_commit, after_rollback ##

In addition, the patch adds callbacks for after_commit and after_rollback which are called after a commit or rollback is sent to the database. The intention is to allow developers to hook in code to communicate with systems external to the database.

For example, a common construct with caching is to add a clear cache call to an after_save callback. However, since after_save callbacks happen within a transaction, the cache will be cleared before the changes is committed to the database. This leaves a small window where another process can regenerate the cache entry:

Process 1 -&gt; begin transaction
Process 1 -&gt; save record
Process 1 -&gt; clear cache
Process 2 -&gt; read cache
Process 2 -&gt; regenerate cache from database
Process 1 -&gt; commit transaction

In this case, Process 2 will generate what will be a stale cache entry out of sync with the database. This bug is most likely to occur in a transaction block or if there are additional after_save callbacks on the model.

As another example, some models may store data external to the database (i.e. on the file system) that needs to be cleaned up if the record is not successfully saved. Once again, this can fail in a transaction block where the record is rolled back after any after save has occurred.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch provides hooks for callbacks after a transaction
rolls back or commits. It is intended to address some
inconsistencies with the current Rails code as well as offer hooks
for developers to execute code at the appropriate time.&lt;/p&gt;
&lt;h2&gt;Bug with creating records in transaction block&lt;/h2&gt;
&lt;p&gt;The current transaction code will roll back a newly created
record to the proper state with a nil id and new_record? returning
true, but only when an error is encountered while the record is
being saved. If you have a multi statement transaction, records
will not be rolled back properly. Take this case:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class Model &amp;lt; ActiveRecord::Base
  def after_save
    raise &quot;illegal value&quot; if title == &quot;xxx&quot;
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This code works fine:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;model = Model.new(:title =&amp;gt; &quot;xxx&quot;)
assert model.new_record?
model.save
assert model.new_record?&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;However, wrap it in a transaction block, and it fails:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Model.transaction do
  model = Model.new(:title =&amp;gt; &quot;valid&quot;)
  assert model.new_record?
  model.save
  raise ActiveRecord::Rollback
end
assert model.new_record? # Fail!&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This patch solves the issue by keeping track of all records
saved or destroyed in a transaction and rolling back the id and
new_record? for newly created records when transactions are rolled
back.&lt;/p&gt;
&lt;h2&gt;Callbacks after_commit, after_rollback&lt;/h2&gt;
&lt;p&gt;In addition, the patch adds callbacks for after_commit and
after_rollback which are called after a commit or rollback is sent
to the database. The intention is to allow developers to hook in
code to communicate with systems external to the database.&lt;/p&gt;
&lt;p&gt;For example, a common construct with caching is to add a clear
cache call to an after_save callback. However, since after_save
callbacks happen within a transaction, the cache will be cleared
before the changes is committed to the database. This leaves a
small window where another process can regenerate the cache
entry:&lt;/p&gt;
&lt;p&gt;Process 1 -&amp;gt; begin transaction&lt;br&gt;
Process 1 -&amp;gt; save record&lt;br&gt;
Process 1 -&amp;gt; clear cache&lt;br&gt;
Process 2 -&amp;gt; read cache&lt;br&gt;
Process 2 -&amp;gt; regenerate cache from database&lt;br&gt;
Process 1 -&amp;gt; commit transaction&lt;/p&gt;
&lt;p&gt;In this case, Process 2 will generate what will be a stale cache
entry out of sync with the database. This bug is most likely to
occur in a transaction block or if there are additional after_save
callbacks on the model.&lt;/p&gt;
&lt;p&gt;As another example, some models may store data external to the
database (i.e. on the file system) that needs to be cleaned up if
the record is not successfully saved. Once again, this can fail in
a transaction block where the record is rolled back after any after
save has occurred.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-04T03:36:11+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.4 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2009-08-04T03:36:18+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">1</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I certainly like the features of after_commit and after_rollback.  The implementation is pretty intrusive (necessarily).

However another part of me thinks that once the transaction's rolled back it's much easier to just redirect / reload and start over.  

Assigning to jeremy as he was the last one to poke around in the txn area.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I certainly like the features of after_commit and
after_rollback. The implementation is pretty intrusive
(necessarily).&lt;/p&gt;
&lt;p&gt;However another part of me thinks that once the transaction's
rolled back it's much easier to just redirect / reload and start
over.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Assigning to jeremy as he was the last one to poke around in the
txn area.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-05T07:01:57+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.4 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2009-08-05T07:02:01+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Redirecting / reloading doesn't fix the problem and will lose any validation errors that should be displayed to the user. The bigger issue, though, is that it can lead to inconsistent or corrupt data.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Redirecting / reloading doesn't fix the problem and will lose
any validation errors that should be displayed to the user. The
bigger issue, though, is that it can lead to inconsistent or
corrupt data.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-14T15:57:52+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.4 active_record transaction
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2009-09-14T15:57:57+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">3</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>There is also the after_commit gem (http://gemcutter.org/gems/after_commit).  Perhaps the authors of that gem could work together with Brian (the author of this patch) and Jeremy Kemper, to get it cleaned up, reviewed, and pulled into rails core.  As Brian states above, it is not possible to safely write cache invalidation or indexing code without hooks that run outside of the transaction.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There is also the after_commit gem (&lt;a href=
&quot;http://gemcutter.org/gems/after_commit)&quot;&gt;http://gemcutter.org/gems/after_commit)&lt;/a&gt;.
Perhaps the authors of that gem could work together with Brian (the
author of this patch) and Jeremy Kemper, to get it cleaned up,
reviewed, and pulled into rails core. As Brian states above, it is
not possible to safely write cache invalidation or indexing code
without hooks that run outside of the transaction.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-16T16:02:34+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2009-12-16T16:02:35+00:00</updated-at>
      <user-id type="integer">68219</user-id>
      <version type="integer">4</version>
      <user-name>nicholas a. evans</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I didn't include a before_commit or before_rollback in the patch just because of the nature of the issue.

When a transaction is ready to be committed, it should really be committed. A before_commit callback gives a chance for some code to raise an exception that will stop the commit from happening.

A before_rollback doesn't quite have the same problem, but it does have the complication that you can't do anything that needs to be persisted to the database (unless you have a separate connection open) since it will be immediately rolled back. I didn't think it was worth the added complication since both of these callbacks can be covered by the existing after_save callback.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I didn't include a before_commit or before_rollback in the patch
just because of the nature of the issue.&lt;/p&gt;
&lt;p&gt;When a transaction is ready to be committed, it should really be
committed. A before_commit callback gives a chance for some code to
raise an exception that will stop the commit from happening.&lt;/p&gt;
&lt;p&gt;A before_rollback doesn't quite have the same problem, but it
does have the complication that you can't do anything that needs to
be persisted to the database (unless you have a separate connection
open) since it will be immediately rolled back. I didn't think it
was worth the added complication since both of these callbacks can
be covered by the existing after_save callback.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-05T15:44:20+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-01-05T15:44:22+00:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">5</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I looked through the after_commit gem and couldn't use anything because of the number of core code changes in Rails 3.0. Specifically, this patch works with the save point support added to transactions in ActiveRecord::ConnectionAdapters::DatabaseStatements.

I have added a new patch file which supersedes the previous one and incorporates the latest method of adding and invoking callbacks. I also added the after_commit_on_* and after_rollback_on_* callbacks from the after_commit gem (where * = create, update, or delete). As I previously stated, I don't think the before_commit or before_rollback callbacks are safe and did not add them. Also fixed is restoring the ActiveRecord::Base#destroyed? when a transaction rolls back similar to how new_record? is restored.

I think it is important to get this patch into Rails 3.0 since the effects it addresses (corrupt data, and inconsistent errors that can't be replicated and turn in to a time suck) are severe and fixing the issue in a plugin or gem will be fragile. It's really not possible to patch the code in a gem without replicating the code ActiveRecord::ConnectionAdapters::DatabaseStatements#transaction because of the inclusion of save points requires several spots to hook in the callbacks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I looked through the after_commit gem and couldn't use anything
because of the number of core code changes in Rails 3.0.
Specifically, this patch works with the save point support added to
transactions in
ActiveRecord::ConnectionAdapters::DatabaseStatements.&lt;/p&gt;
&lt;p&gt;I have added a new patch file which supersedes the previous one
and incorporates the latest method of adding and invoking
callbacks. I also added the after_commit_on&lt;em&gt;* and
after_rollback_on&lt;/em&gt;* callbacks from the after_commit gem (where
* = create, update, or delete). As I previously stated, I don't
think the before_commit or before_rollback callbacks are safe and
did not add them. Also fixed is restoring the
ActiveRecord::Base#destroyed? when a transaction rolls back similar
to how new_record? is restored.&lt;/p&gt;
&lt;p&gt;I think it is important to get this patch into Rails 3.0 since
the effects it addresses (corrupt data, and inconsistent errors
that can't be replicated and turn in to a time suck) are severe and
fixing the issue in a plugin or gem will be fragile. It's really
not possible to patch the code in a gem without replicating the
code
ActiveRecord::ConnectionAdapters::DatabaseStatements#transaction
because of the inclusion of save points requires several spots to
hook in the callbacks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-19T17:05:47+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-01-19T17:06:00+00:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">6</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-19T18:39:42+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-01-19T18:39:44+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>In case someone wants a lightweight after_commit implementation on top of rails 2.x, here is a simple plugin that does the job. You don't need to patch rails, just require 'after_commit'.

This enables the following code, anywhere in a model:

@@@ ruby
after_commit do
  # write file, create cache, etc
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;In case someone wants a lightweight after_commit implementation
on top of rails 2.x, here is a simple plugin that does the job. You
don't need to patch rails, just require 'after_commit'.&lt;/p&gt;
&lt;p&gt;This enables the following code, anywhere in a model:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;after_commit do
  # write file, create cache, etc
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-09T17:52:20+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-02-09T17:52:22+00:00</updated-at>
      <user-id type="integer">4065</user-id>
      <version type="integer">8</version>
      <user-name>Gaspard Bucher</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Updated the after_commit plugin with proper init code: http://zenadmin.org/en/blog/post647.html</body>
      <body-html>&lt;div&gt;&lt;p&gt;Updated the after_commit plugin with proper init code: &lt;a href=
&quot;http://zenadmin.org/en/blog/post647.html&quot;&gt;http://zenadmin.org/en/blog/post647.html&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-09T18:14:20+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-02-09T18:14:22+00:00</updated-at>
      <user-id type="integer">4065</user-id>
      <version type="integer">9</version>
      <user-name>Gaspard Bucher</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Any more thoughts on this patch? I still think that the hooks necessary for after_rollback functionality require this to be in the core code instead of as a plugin. The new support for rollback points in ActiveRecord 3 makes it quite a bit more sophisticated than in Rails 2.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any more thoughts on this patch? I still think that the hooks
necessary for after_rollback functionality require this to be in
the core code instead of as a plugin. The new support for rollback
points in ActiveRecord 3 makes it quite a bit more sophisticated
than in Rails 2.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-29T16:55:29+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T16:55:33+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">10</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>+1 on the idea and implementation. I frequently need this and use a small monkeypatch plugin to do it. The only nit is some code style that doesn't match Rails, like the space in `def foo (bar)`.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 on the idea and implementation. I frequently need this and
use a small monkeypatch plugin to do it. The only nit is some code
style that doesn't match Rails, like the space in &lt;code&gt;def foo
(bar)&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-29T17:06:19+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T17:06:21+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">11</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I fixed the offending code styles and rebased the patch with the latest master and fixed some Ruby warnings showing up in the tests.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I fixed the offending code styles and rebased the patch with the
latest master and fixed some Ruby warnings showing up in the
tests.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-29T18:50:36+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T18:50:40+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">12</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [da840d13da865331297d5287391231b1ed39721b]) Add after_commit and after_rollback callbacks to ActiveRecord that are called after transactions either commit or rollback on all records saved or destroyed in the transaction.

[#2991 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/da840d13da865331297d5287391231b1ed39721b</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/da840d13da865331297d5287391231b1ed39721b&quot;
title=
&quot;Changeset [da840d13da865331297d5287391231b1ed39721b]&quot;&gt;[da840d13da865331297d5287391231b1ed39721b]&lt;/a&gt;)
Add after_commit and after_rollback callbacks to ActiveRecord that
are called after transactions either commit or rollback on all
records saved or destroyed in the transaction.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=
&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/da840d13da865331297d5287391231b1ed39721b&quot;&gt;
http://github.com/rails/rails/commit/da840d13da865331297d5287391231...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T20:24:54+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T20:24:56+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">13</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>One more thing: `after_commit_on_create` is old-style API. Could you bump these up to `after_commit :on =&gt; :create/:update/:destroy` ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;One more thing: &lt;code&gt;after_commit_on_create&lt;/code&gt; is old-style
API. Could you bump these up to &lt;code&gt;after_commit :on =&amp;gt;
:create/:update/:destroy&lt;/code&gt; ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T20:36:23+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T20:36:25+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">14</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I understand the interest of the declarative after_commit code in the model as a class method as it has been the way to write callbacks in Rails for a long time but I think we could consider faster and more Ruby-like code with blocks *triggered in the model* because:

1. these retain the context and avoid filling the model with instance variable that you need to clear afterwards
2. code blocks are inserted in the transaction, not in the model's instance variables
3. if your code path does not need an after commit, the overhead is zero

The reason we start to ask for :on =&gt; :destroy, :on =&gt; :create is a good indicator that the callback solution is not the best approach to &quot;after_commit&quot;. Examples below:

I. Usage example with block triggered after_commit:

@@@ ruby
before_destroy :clear_cache

def clear_cache
  # Since the object still exists, we can find the related cached
  # files.
  cached_pages = CachedPage.all(...)
  after_commit do
    cached_pages.each do |p|
      p.destroy!
    end
  end
end
@@@


II. Example with after_commit callback:

@@@ ruby
before_destroy :get_cached_pages
after_commit :clear_cached_pages, :on =&gt; :destroy

def get_cached_pages
  # Since the object still exists, we can find the related cached
  # files.
  @cached_pages = CachedPage.all(...)
end

def clear_cached_pages
  return if @cached_pages.blank?
  @cached_pages.each do |p|
    p.destroy!
  end
  @cached_pages = nil
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I understand the interest of the declarative after_commit code
in the model as a class method as it has been the way to write
callbacks in Rails for a long time but I think we could consider
faster and more Ruby-like code with blocks &lt;em&gt;triggered in the
model&lt;/em&gt; because:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;these retain the context and avoid filling the model with
instance variable that you need to clear afterwards&lt;br&gt;&lt;/li&gt;
&lt;li&gt;code blocks are inserted in the transaction, not in the model's
instance variables&lt;br&gt;&lt;/li&gt;
&lt;li&gt;if your code path does not need an after commit, the overhead
is zero&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The reason we start to ask for :on =&amp;gt; :destroy, :on =&amp;gt;
:create is a good indicator that the callback solution is not the
best approach to &quot;after_commit&quot;. Examples below:&lt;/p&gt;
&lt;p&gt;I. Usage example with block triggered after_commit:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;before_destroy :clear_cache

def clear_cache
  # Since the object still exists, we can find the related cached
  # files.
  cached_pages = CachedPage.all(...)
  after_commit do
    cached_pages.each do |p|
      p.destroy!
    end
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;II. Example with after_commit callback:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;before_destroy :get_cached_pages
after_commit :clear_cached_pages, :on =&amp;gt; :destroy

def get_cached_pages
  # Since the object still exists, we can find the related cached
  # files.
  @cached_pages = CachedPage.all(...)
end

def clear_cached_pages
  return if @cached_pages.blank?
  @cached_pages.each do |p|
    p.destroy!
  end
  @cached_pages = nil
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T21:06:12+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T21:06:16+01:00</updated-at>
      <user-id type="integer">4065</user-id>
      <version type="integer">15</version>
      <user-name>Gaspard Bucher</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Gaspard, that's similar to the monkeypatch I use.

I notice that most of my usage is in another callback that just declares an after_transaction block. I do like the instance-level API too, though.

@@@ ruby
module AfterTransaction
  def self.included(base)
    base.extend(ClassMethods)

    class &lt;&lt; base
      alias_method_chain :transaction, :callbacks
    end
  end

  module ClassMethods
    @@after_transaction_hooks = []

    def transaction_with_callbacks(&amp;block)
      clean = true
      transaction_without_callbacks(&amp;block)
    rescue Exception
      clean = false
      raise
    ensure
      if connection.open_transactions.zero?
        after_transaction_callbacks if clean
        clear_transaction_callbacks!
      end
    end

    def after_transaction(&amp;block)
      if connection.open_transactions.zero?
        yield
      else
        @@after_transaction_hooks &lt;&lt; block
      end
    end

    private

      def after_transaction_callbacks
        @@after_transaction_hooks.each { |hook| hook.call }
      end

      def clear_transaction_callbacks!
        @@after_transaction_hooks.clear
      end
  end

  def after_transaction(&amp;block)
    self.class.after_transaction(&amp;block)
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Gaspard, that's similar to the monkeypatch I use.&lt;/p&gt;
&lt;p&gt;I notice that most of my usage is in another callback that just
declares an after_transaction block. I do like the instance-level
API too, though.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;module AfterTransaction
  def self.included(base)
    base.extend(ClassMethods)

    class &amp;lt;&amp;lt; base
      alias_method_chain :transaction, :callbacks
    end
  end

  module ClassMethods
    @@after_transaction_hooks = []

    def transaction_with_callbacks(&amp;amp;block)
      clean = true
      transaction_without_callbacks(&amp;amp;block)
    rescue Exception
      clean = false
      raise
    ensure
      if connection.open_transactions.zero?
        after_transaction_callbacks if clean
        clear_transaction_callbacks!
      end
    end

    def after_transaction(&amp;amp;block)
      if connection.open_transactions.zero?
        yield
      else
        @@after_transaction_hooks &amp;lt;&amp;lt; block
      end
    end

    private

      def after_transaction_callbacks
        @@after_transaction_hooks.each { |hook| hook.call }
      end

      def clear_transaction_callbacks!
        @@after_transaction_hooks.clear
      end
  end

  def after_transaction(&amp;amp;block)
    self.class.after_transaction(&amp;amp;block)
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T21:14:25+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T21:14:28+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Here's a patch to update the API to the new style in the comments and the tests.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's a patch to update the API to the new style in the
comments and the tests.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T21:16:48+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T21:16:52+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">17</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>I do like the features available with a block. I have written my fair share of truly ugly after_save monstrosities. The instance API would be great for all callbacks to support in addition to the class API.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I do like the features available with a block. I have written my
fair share of truly ugly after_save monstrosities. The instance API
would be great for all callbacks to support in addition to the
class API.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-29T21:19:37+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-29T21:19:40+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">18</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>(from [d2a49e4b1f30c5997e169110eed94a55aee53f56]) Update after_commit and after_rollback docs and tests to use new style API with an :on options instead of on_* suffix.

[#2991]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/d2a49e4b1f30c5997e169110eed94a55aee53f56</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/d2a49e4b1f30c5997e169110eed94a55aee53f56&quot;
title=
&quot;Changeset [d2a49e4b1f30c5997e169110eed94a55aee53f56]&quot;&gt;[d2a49e4b1f30c5997e169110eed94a55aee53f56]&lt;/a&gt;)
Update after_commit and after_rollback docs and tests to use new
style API with an :on options instead of on_* suffix.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt;]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=
&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/d2a49e4b1f30c5997e169110eed94a55aee53f56&quot;&gt;
http://github.com/rails/rails/commit/d2a49e4b1f30c5997e169110eed94a...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-30T02:26:45+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-04-30T02:26:47+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">19</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>Brian, could you take a look at the failing tests on master? Turns out this was broken but was hidden by some assert typos.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Brian, could you take a look at the failing tests on master?
Turns out this was broken but was hidden by some assert typos.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T18:54:49+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T18:55:00+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">20</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T19:24:01+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T19:24:10+01:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">21</version>
      <user-name>DHH</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>(from [1b2941cba1165b0721f57524645fe378bee2a950]) Temporarily revert &quot;Update after_commit and after_rollback docs and tests to use new style API with an :on options instead of on_* suffix.&quot; and &quot;Add after_commit and after_rollback callbacks to ActiveRecord that are called after transactions either commit or rollback on all records saved or destroyed in the transaction.&quot;

This reverts commits d2a49e4b1f30c5997e169110eed94a55aee53f56 and da840d13da865331297d5287391231b1ed39721b.

[#2991]

Conflicts:

	activerecord/CHANGELOG
	activerecord/lib/active_record/transactions.rb
	activerecord/test/cases/transaction_callbacks_test.rb
http://github.com/rails/rails/commit/1b2941cba1165b0721f57524645fe378bee2a950</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/1b2941cba1165b0721f57524645fe378bee2a950&quot;
title=
&quot;Changeset [1b2941cba1165b0721f57524645fe378bee2a950]&quot;&gt;[1b2941cba1165b0721f57524645fe378bee2a950]&lt;/a&gt;)
Temporarily revert &quot;Update after_commit and after_rollback docs and
tests to use new style API with an :on options instead of on_*
suffix.&quot; and &quot;Add after_commit and after_rollback callbacks to
ActiveRecord that are called after transactions either commit or
rollback on all records saved or destroyed in the transaction.&quot;&lt;/p&gt;
&lt;p&gt;This reverts commits d2a49e4b1f30c5997e169110eed94a55aee53f56
and da840d13da865331297d5287391231b1ed39721b.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt;]&lt;/p&gt;
&lt;p&gt;Conflicts:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;activerecord/CHANGELOG
activerecord/lib/active_record/transactions.rb
activerecord/test/cases/transaction_callbacks_test.rb&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/1b2941cba1165b0721f57524645fe378bee2a950&quot;&gt;
http://github.com/rails/rails/commit/1b2941cba1165b0721f57524645fe3...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T19:56:51+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T19:57:00+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">22</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>Fixed. I'd mistakenly assumed the :on option was universal for all callbacks. The callbacks are now modeled after the validation call backs which support the :on option.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Fixed. I'd mistakenly assumed the :on option was universal for
all callbacks. The callbacks are now modeled after the validation
call backs which support the :on option.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T20:48:43+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T20:48:54+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">23</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>(from [b07073924002fd56ac5b63b24cb9318b3dee45c4]) Revert &quot;Temporarily revert &quot;Update after_commit and after_rollback docs and tests to use new style API with an :on options instead of on_* suffix.&quot; and &quot;Add after_commit and after_rollback callbacks to ActiveRecord that are called after transactions either commit or rollback on all records saved or destroyed in the transaction.&quot;&quot;

This reverts commit 1b2941cba1165b0721f57524645fe378bee2a950.

[#2991]
http://github.com/rails/rails/commit/b07073924002fd56ac5b63b24cb9318b3dee45c4</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/b07073924002fd56ac5b63b24cb9318b3dee45c4&quot;
title=
&quot;Changeset [b07073924002fd56ac5b63b24cb9318b3dee45c4]&quot;&gt;[b07073924002fd56ac5b63b24cb9318b3dee45c4]&lt;/a&gt;)
Revert &quot;Temporarily revert &quot;Update after_commit and after_rollback
docs and tests to use new style API with an :on options instead of
on_* suffix.&quot; and &quot;Add after_commit and after_rollback callbacks to
ActiveRecord that are called after transactions either commit or
rollback on all records saved or destroyed in the
transaction.&quot;&quot;&lt;/p&gt;
&lt;p&gt;This reverts commit
1b2941cba1165b0721f57524645fe378bee2a950.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt;] &lt;a href=
&quot;http://github.com/rails/rails/commit/b07073924002fd56ac5b63b24cb9318b3dee45c4&quot;&gt;
http://github.com/rails/rails/commit/b07073924002fd56ac5b63b24cb931...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-08T22:05:48+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T22:05:56+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">24</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>(from [2500e6af6634c984f7d2b567403de1c4c544ff91]) Make logic for after_commit and after_rollback :on option work like it does for validation callbacks.

[#2991 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/2500e6af6634c984f7d2b567403de1c4c544ff91</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/2500e6af6634c984f7d2b567403de1c4c544ff91&quot;
title=
&quot;Changeset [2500e6af6634c984f7d2b567403de1c4c544ff91]&quot;&gt;[2500e6af6634c984f7d2b567403de1c4c544ff91]&lt;/a&gt;)
Make logic for after_commit and after_rollback :on option work like
it does for validation callbacks.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/2500e6af6634c984f7d2b567403de1c4c544ff91&quot;&gt;
http://github.com/rails/rails/commit/2500e6af6634c984f7d2b567403de1...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-08T22:05:56+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T22:06:07+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">25</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Thanks Brian!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Brian!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-08T22:31:54+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-08T22:32:05+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">26</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>I found another bug with this code. The rollback code is resetting the id to its previous value. However, the attributes hash is frozen. The attached patch fixes the problem by unfreezing the attributes on rollback. This problem is a blocker if you use ActiveRecord outside of Rails and don't set the logger (that's how I found the bug).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I found another bug with this code. The rollback code is
resetting the id to its previous value. However, the attributes
hash is frozen. The attached patch fixes the problem by unfreezing
the attributes on rollback. This problem is a blocker if you use
ActiveRecord outside of Rails and don't set the logger (that's how
I found the bug).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-18T23:06:45+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-18T23:07:01+01:00</updated-at>
      <user-id type="integer">26148</user-id>
      <version type="integer">27</version>
      <user-name>Brian Durand</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>(from [237165feb3e5f7b117b05353bd64d756b9f18f74]) Fix bug with rolling back frozen attributes.

[#2991]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/237165feb3e5f7b117b05353bd64d756b9f18f74</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/237165feb3e5f7b117b05353bd64d756b9f18f74&quot;
title=
&quot;Changeset [237165feb3e5f7b117b05353bd64d756b9f18f74]&quot;&gt;[237165feb3e5f7b117b05353bd64d756b9f18f74]&lt;/a&gt;)
Fix bug with rolling back frozen attributes.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2991&quot; title=
&quot;Ticket #2991&quot;&gt;#2991&lt;/a&gt;]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=
&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/237165feb3e5f7b117b05353bd64d756b9f18f74&quot;&gt;
http://github.com/rails/rails/commit/237165feb3e5f7b117b05353bd64d7...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-18T23:13:40+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-06-18T23:13:48+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">28</version>
      <user-name>Repository</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>I wrapped Jeremy Kemper initial after_transaction 'hack' into a plugin(+specs), for all rails 2.x users and whoever still needs the insttant after_transaction in Rails 3

http://github.com/grosser/ar_after_transaction</body>
      <body-html>&lt;div&gt;&lt;p&gt;I wrapped Jeremy Kemper initial after_transaction 'hack' into a
plugin(+specs), for all rails 2.x users and whoever still needs the
insttant after_transaction in Rails 3&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/grosser/ar_after_transaction&quot;&gt;http://github.com/grosser/ar_after_transaction&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-28T16:30:32+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-08-28T16:30:37+01:00</updated-at>
      <user-id type="integer">42010</user-id>
      <version type="integer">29</version>
      <user-name>grosser</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:34+01:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-10-15T23:01:34+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">30</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap uggs&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap uggs the only boot sale&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uggs for cheap&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;ugg boots cheap&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap kids uggs&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap classic tall ugg boots 5815 mulberry&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uggs cheap&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uk cheap ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;super cheap ugg classic mini boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots with zips&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg sunburst boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;really cheap ugg classic mini&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots for $64&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;ugg boots for cheap&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;ugg slippers cheap&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap authentic uggs&lt;/a&gt;,
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots for sale in uk&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots mulberry&lt;/a&gt; So You Can Buy It Now!

&lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;cheap ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots on sale&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg brand boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots uk&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots sale&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg australia boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;discount ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;what stores sell ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots on sale authorized&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;us ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;mens ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;australian ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg cove boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;fur inside ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;kids ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg bailey boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;adirondack tall ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;shopping for ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg mini boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;womens ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;lowest price ugg boots&lt;/a&gt;,&lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt; baby ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg style boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;knock off ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots discount&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg cove boots sale&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;discounted ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg roseberry boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;purple ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots sydney&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots cheap&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots store&lt;/a&gt; SO Cheap With Free Shipping!

&lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;UGG Store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;UGG Store Outlet&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;UK UGG Store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg factory store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg outlet stores&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;what stores sell ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg outlet store locations in pa hit bg&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg boots store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;shoe stores ugg australia sandals kids&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;boot shoes store ugg hit bg&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg store locater&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;shoe stores ugg australia kids&lt;/a&gt; Thats ugg store uk online shop!

&lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;tall boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;cardy ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;uggs sale&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boots on sale&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy chocolate&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy sale&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg boots cardy&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg boots cream&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boot&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;adirondack tall ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg mosaic tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg tall boot sale&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;cheap classic tall ugg boots 5815 mulberry&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;classic tall ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall boot&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;sundance tall ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg boots classic tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg adirondack tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall wool&lt;/a&gt;. Have You Best Choice, Buy It Now!


&lt;a href=&quot;http://www.uggshop.net&quot;&gt;UGG Classic Short&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;UGG Short Boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;Short uggs&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;UGG Shop online&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;authentic ugg australia women's classic short #5825 - black sheepskin&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg fern suede classic short&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;classic short ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;classic short ugg in grey&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg short boots fushia&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg boots 8 short&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg ultra short black&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;eggplant short ugg&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;short classic ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;short ugg boots chestnut womens&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg boots black short&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short black paisley&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg ultra short sku&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg women's classic short&lt;/a&gt;, Buy It Now! 

&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Triplet&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Bomber&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Boots 5803, UGG Boots 1873&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Boots USA&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;bailey button ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boots bomber&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boots at macys&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg boots - bailey button novelty- kids grey&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg australia bailey button&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button crinkle leather&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boots on sale&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button triplet boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button blackberry wine&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;discount ugg bailey button&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg australia bailey button boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button 5803 grey size 10&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boot grey&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button cheap&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button triple&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg boots - bailey button novelty&lt;/a&gt;, Buy It Now!</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap uggs&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap uggs the only boot sale&lt;/a&gt;,
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uggs for cheap&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;ugg boots cheap&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap kids uggs&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap classic tall ugg boots 5815
mulberry&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uggs cheap&lt;/a&gt;,
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;uk cheap ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;super cheap ugg classic mini
boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots
with zips&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg
sunburst boots&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;really
cheap ugg classic mini&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots for $64&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;ugg boots for cheap&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;ugg slippers cheap&lt;/a&gt;, &lt;a href=
&quot;http://www.cheapuggshop.com&quot;&gt;cheap authentic uggs&lt;/a&gt;,&lt;br&gt;
&lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots for sale in
uk&lt;/a&gt;, &lt;a href=&quot;http://www.cheapuggshop.com&quot;&gt;cheap ugg boots
mulberry&lt;/a&gt; So You Can Buy It Now!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;cheap ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots on sale&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg brand boots&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots uk&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots sale&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg australia boots&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;discount ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.ugg-boots-uk.com&quot;&gt;what stores sell ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots on sale
authorized&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;us ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;mens ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;australian ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg cove
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;fur inside ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;kids ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg bailey
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;adirondack tall
ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;shopping for
ugg boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg mini
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;womens ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;lowest price ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;baby ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg style
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;knock off ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots
discount&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg cove boots
sale&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;discounted ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg roseberry
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;purple ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots
sydney&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots
cheap&lt;/a&gt;, &lt;a href=&quot;http://www.ugg-boots-uk.com&quot;&gt;ugg boots
store&lt;/a&gt; SO Cheap With Free Shipping!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;UGG Store&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;UGG Store Outlet&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;UK UGG Store&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;ugg factory store&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;ugg outlet stores&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;what stores sell ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg outlet store locations
in pa hit bg&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg
store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg boots
store&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;shoe stores ugg
australia sandals kids&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootseshop.com&quot;&gt;boot shoes store ugg hit bg&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;ugg store locater&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootseshop.com&quot;&gt;shoe stores ugg australia
kids&lt;/a&gt; Thats ugg store uk online shop!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;tall boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;cardy ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;uggs sale&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg cardy&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boots on sale&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg cardy chocolate&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg cardy sale&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy tall&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg boots cardy&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;classic cardy ugg boots cream&lt;/a&gt;,
&lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boot&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg cardy boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;adirondack tall ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall boots&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg mosaic tall&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;ugg tall boot sale&lt;/a&gt;, &lt;a href=
&quot;http://www.auuggboots.com&quot;&gt;cheap classic tall ugg boots 5815
mulberry&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;classic tall ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall
boot&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic cardy
tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;sundance tall ugg
boots&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg boots classic
tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg adirondack
tall&lt;/a&gt;, &lt;a href=&quot;http://www.auuggboots.com&quot;&gt;ugg classic tall
wool&lt;/a&gt;. Have You Best Choice, Buy It Now!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.uggshop.net&quot;&gt;UGG Classic Short&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;UGG Short Boots&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;Short uggs&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;UGG Shop online&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;authentic ugg australia women's classic
short&lt;/a&gt; &lt;a href=&quot;/projects/8994/tickets/5825&quot; title=
&quot;Ticket #5825&quot;&gt;#5825&lt;/a&gt; - black sheepskin,&lt;br&gt;
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short boots&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg fern suede classic short&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;classic short ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;classic short ugg in grey&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg short boots fushia&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg boots 8 short&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;ugg ultra short black&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;eggplant short ugg&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;short classic ugg boots&lt;/a&gt;, &lt;a href=
&quot;http://www.uggshop.net&quot;&gt;short ugg boots chestnut womens&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg boots black short&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short black
paisley&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg classic short
boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg ultra short sku&lt;/a&gt;,
&lt;a href=&quot;http://www.uggshop.net&quot;&gt;ugg women's classic short&lt;/a&gt;, Buy
It Now!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Boots&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Triplet&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Bailey Button Bomber&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Boots 5803, UGG Boots
1873&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;UGG Boots USA&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;bailey button ugg boots&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button boots
bomber&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button
boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button
boots at macys&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg boots
- bailey button novelty- kids grey&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootsusa.com&quot;&gt;ugg australia bailey button&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button crinkle
leather&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button
boots on sale&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey
button triplet boot&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg
bailey button blackberry wine&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootsusa.com&quot;&gt;discount ugg bailey button&lt;/a&gt;,
&lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg australia bailey button
boots&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button
5803 grey size 10&lt;/a&gt;, &lt;a href=&quot;http://www.uggbootsusa.com&quot;&gt;ugg
bailey button boot grey&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button cheap&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootsusa.com&quot;&gt;ugg bailey button triple&lt;/a&gt;, &lt;a href=
&quot;http://www.uggbootsusa.com&quot;&gt;ugg boots - bailey button novelty&lt;/a&gt;,
Buy It Now!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-25T12:13:27+00:00</created-at>
      <creator-id type="integer">26148</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">2991</number>
      <permalink>after-transaction-patch</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>3.0 active_record transaction</tag>
      <title>After Transaction Patch</title>
      <updated-at type="datetime">2010-11-25T12:27:56+00:00</updated-at>
      <user-id type="integer">126682</user-id>
      <version type="integer">31</version>
      <user-name>sunnyabc</user-name>
      <creator-name>Brian Durand</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2991</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>fe67deaf98bb15d58218acdbbdf7d4f166255ad3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-08-04T03:36:13+01:00</created-at>
      <filename>after_transaction.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">235388</id>
      <size type="integer">21826</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/235388/after_transaction.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>4e3c112413504db734410863b67bd5dc0899d519</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-01-19T17:05:47+00:00</created-at>
      <filename>after_transaction_patch_2.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">382243</id>
      <size type="integer">27474</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/382243/after_transaction_patch_2.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f79a0f1899c919c20108c95194aab3883e14810b</code>
      <content-type>application/x-gzip</content-type>
      <created-at type="datetime">2010-02-09T17:52:20+00:00</created-at>
      <filename>after_commit.tgz</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">405485</id>
      <size type="integer">1393</size>
      <uploader-id type="integer">4065</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/405485/after_commit.tgz</url>
    </attachment>
    <attachment type="Attachment">
      <code>7f7f0b499ffdb056fffb4aac8d07e114d90411f4</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-29T18:50:36+01:00</created-at>
      <filename>after_transaction_patch_3.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">503969</id>
      <size type="integer">27642</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/503969/after_transaction_patch_3.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>330396b2039a04aecf0b80294444d7069f1b4c18</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-29T21:16:48+01:00</created-at>
      <filename>update_api_calls.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">504309</id>
      <size type="integer">3088</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/504309/update_api_calls.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>96ffd9b2759ecc57938dde10883ea8959f371c6c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-08T20:48:43+01:00</created-at>
      <filename>after_trasaction_fix_on_callbacks.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">551458</id>
      <size type="integer">4627</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/551458/after_trasaction_fix_on_callbacks.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>9c5ce6815bfaaf06e320fcf16fc9c95ad74e4fe1</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-18T23:06:46+01:00</created-at>
      <filename>fix_rollback_frozen_attributes.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">566122</id>
      <size type="integer">4385</size>
      <uploader-id type="integer">26148</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/566122/fix_rollback_frozen_attributes.diff</url>
    </attachment>
  </attachments>
</ticket>
