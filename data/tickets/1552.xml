<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-07-21T01:45:48+01:00</created-at>
  <creator-id type="integer">27303</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1552</number>
  <permalink>memory-problem-with-configlog_level-warn</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>config log_level memory</tag>
  <title>Memory Problem with config.log_level = :warn</title>
  <updated-at type="datetime">2010-07-21T01:45:48+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">6</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Edward Waller</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
  <priority-name nil="true"></priority-name>
  <original-body>## Rails 2.2+ has this problem (testing on Rails HEAD) ##

So, in Rails 2.2+, there seems to be some memory problems with using config.log_level  = :warn.  Below I show the steps to reproduce this.

# Creating project #

@@@
compy:Rails Eddie$ rails logger_problem
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  script/process
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application.rb
      create  app/helpers/application_helper.rb
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/environment.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  script/performance/request
      create  script/process/reaper
      create  script/process/spawner
      create  script/process/inspector
      create  script/runner
      create  script/server
      create  script/plugin
      create  public/dispatch.rb
      create  public/dispatch.cgi
      create  public/dispatch.fcgi
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
compy:Rails Eddie$ cd logger_problem/
compy:logger_problem Eddie$ cp -R ../test_project/vendor/rails vendor/
compy:logger_problem Eddie$ script/generate resource tasks
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/tasks
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/tasks.rb
      create    test/unit/tasks_test.rb
      create    test/fixtures/tasks.yml
      create    db/migrate
      create    db/migrate/20081210205128_create_tasks.rb
      create  app/controllers/tasks_controller.rb
      create  test/functional/tasks_controller_test.rb
      create  app/helpers/tasks_helper.rb
      create  test/unit/helpers/tasks_helper_test.rb
       route  map.resources :tasks
compy:logger_problem Eddie$ rake db:migrate
(in /Users/Eddie/Projects/Rails/logger_problem)
==  CreateTasks: migrating ====================================================
-- create_table(:tasks)
   -&gt; 0.0041s
==  CreateTasks: migrated (0.0044s) ===========================================
@@@

# Editing files #

I added an index action, created index.html.erb, and set config.log_level = :warn

@@@
diff --git a/app/controllers/tasks_controller.rb b/app/controllers/tasks_controller.rb
index 1ad33d0..22407f0 100644
--- a/app/controllers/tasks_controller.rb
+++ b/app/controllers/tasks_controller.rb
@@ -1,2 +1,5 @@
 class TasksController &lt; ApplicationController
+  def index
+    
+  end
 end
diff --git a/config/environments/production.rb b/config/environments/production.rb
index ec5b7bc..996f8eb 100644
--- a/config/environments/production.rb
+++ b/config/environments/production.rb
@@ -22,3 +22,5 @@ config.action_controller.perform_caching             = true

 # Disable delivery errors, bad email addresses will be ignored
 # config.action_mailer.raise_delivery_errors = false
+
+config.log_level = :warn
@@@

# Starting Server #

@@@
compy:logger_problem Eddie$ script/server -e production
=&gt; Booting Mongrel
=&gt; Rails 2.3.0 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
@@@

# Hitting it with httperf to simulate requests #

@@@
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  104660 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  126672 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  147612 21431 21366 script/server -e production
@@@

As you should be able to see above, the memory usage (first column) grows quite a bit with each 1000  requests.  Commenting out the config.log_level = :warn line stops this behavior.

If you need any more info I'd be happy to help.</original-body>
  <latest-body>## Rails 2.2+ has this problem (testing on Rails HEAD) ##

So, in Rails 2.2+, there seems to be some memory problems with using config.log_level  = :warn.  Below I show the steps to reproduce this.

# Creating project #

@@@
compy:Rails Eddie$ rails logger_problem
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  script/process
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application.rb
      create  app/helpers/application_helper.rb
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/environment.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  script/performance/request
      create  script/process/reaper
      create  script/process/spawner
      create  script/process/inspector
      create  script/runner
      create  script/server
      create  script/plugin
      create  public/dispatch.rb
      create  public/dispatch.cgi
      create  public/dispatch.fcgi
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
compy:Rails Eddie$ cd logger_problem/
compy:logger_problem Eddie$ cp -R ../test_project/vendor/rails vendor/
compy:logger_problem Eddie$ script/generate resource tasks
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/tasks
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/tasks.rb
      create    test/unit/tasks_test.rb
      create    test/fixtures/tasks.yml
      create    db/migrate
      create    db/migrate/20081210205128_create_tasks.rb
      create  app/controllers/tasks_controller.rb
      create  test/functional/tasks_controller_test.rb
      create  app/helpers/tasks_helper.rb
      create  test/unit/helpers/tasks_helper_test.rb
       route  map.resources :tasks
compy:logger_problem Eddie$ rake db:migrate
(in /Users/Eddie/Projects/Rails/logger_problem)
==  CreateTasks: migrating ====================================================
-- create_table(:tasks)
   -&gt; 0.0041s
==  CreateTasks: migrated (0.0044s) ===========================================
@@@

# Editing files #

I added an index action, created index.html.erb, and set config.log_level = :warn

@@@
diff --git a/app/controllers/tasks_controller.rb b/app/controllers/tasks_controller.rb
index 1ad33d0..22407f0 100644
--- a/app/controllers/tasks_controller.rb
+++ b/app/controllers/tasks_controller.rb
@@ -1,2 +1,5 @@
 class TasksController &lt; ApplicationController
+  def index
+    
+  end
 end
diff --git a/config/environments/production.rb b/config/environments/production.rb
index ec5b7bc..996f8eb 100644
--- a/config/environments/production.rb
+++ b/config/environments/production.rb
@@ -22,3 +22,5 @@ config.action_controller.perform_caching             = true

 # Disable delivery errors, bad email addresses will be ignored
 # config.action_mailer.raise_delivery_errors = false
+
+config.log_level = :warn
@@@

# Starting Server #

@@@
compy:logger_problem Eddie$ script/server -e production
=&gt; Booting Mongrel
=&gt; Rails 2.3.0 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
@@@

# Hitting it with httperf to simulate requests #

@@@
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  104660 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  126672 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  147612 21431 21366 script/server -e production
@@@

As you should be able to see above, the memory usage (first column) grows quite a bit with each 1000  requests.  Commenting out the config.log_level = :warn line stops this behavior.

If you need any more info I'd be happy to help.</latest-body>
  <original-body-html>&lt;div&gt;&lt;h2&gt;Rails 2.2+ has this problem (testing on Rails HEAD)&lt;/h2&gt;
&lt;p&gt;So, in Rails 2.2+, there seems to be some memory problems with
using config.log_level = :warn. Below I show the steps to reproduce
this.&lt;/p&gt;
&lt;h1&gt;Creating project&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:Rails Eddie$ rails logger_problem
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  script/process
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application.rb
      create  app/helpers/application_helper.rb
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/environment.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  script/performance/request
      create  script/process/reaper
      create  script/process/spawner
      create  script/process/inspector
      create  script/runner
      create  script/server
      create  script/plugin
      create  public/dispatch.rb
      create  public/dispatch.cgi
      create  public/dispatch.fcgi
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
compy:Rails Eddie$ cd logger_problem/
compy:logger_problem Eddie$ cp -R ../test_project/vendor/rails vendor/
compy:logger_problem Eddie$ script/generate resource tasks
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/tasks
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/tasks.rb
      create    test/unit/tasks_test.rb
      create    test/fixtures/tasks.yml
      create    db/migrate
      create    db/migrate/20081210205128_create_tasks.rb
      create  app/controllers/tasks_controller.rb
      create  test/functional/tasks_controller_test.rb
      create  app/helpers/tasks_helper.rb
      create  test/unit/helpers/tasks_helper_test.rb
       route  map.resources :tasks
compy:logger_problem Eddie$ rake db:migrate
(in /Users/Eddie/Projects/Rails/logger_problem)
==  CreateTasks: migrating ====================================================
-- create_table(:tasks)
   -&amp;gt; 0.0041s
==  CreateTasks: migrated (0.0044s) ===========================================
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Editing files&lt;/h1&gt;
&lt;p&gt;I added an index action, created index.html.erb, and set
config.log_level = :warn&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
diff --git a/app/controllers/tasks_controller.rb b/app/controllers/tasks_controller.rb
index 1ad33d0..22407f0 100644
--- a/app/controllers/tasks_controller.rb
+++ b/app/controllers/tasks_controller.rb
@@ -1,2 +1,5 @@
 class TasksController &amp;lt; ApplicationController
+  def index
+    
+  end
 end
diff --git a/config/environments/production.rb b/config/environments/production.rb
index ec5b7bc..996f8eb 100644
--- a/config/environments/production.rb
+++ b/config/environments/production.rb
@@ -22,3 +22,5 @@ config.action_controller.perform_caching             = true

 # Disable delivery errors, bad email addresses will be ignored
 # config.action_mailer.raise_delivery_errors = false
+
+config.log_level = :warn
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Starting Server&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:logger_problem Eddie$ script/server -e production
=&amp;gt; Booting Mongrel
=&amp;gt; Rails 2.3.0 application starting on http://0.0.0.0:3000
=&amp;gt; Call with -d to detach
=&amp;gt; Ctrl-C to shutdown server
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Hitting it with httperf to simulate requests&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  104660 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &amp;gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  126672 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &amp;gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  147612 21431 21366 script/server -e production
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you should be able to see above, the memory usage (first
column) grows quite a bit with each 1000 requests. Commenting out
the config.log_level = :warn line stops this behavior.&lt;/p&gt;
&lt;p&gt;If you need any more info I'd be happy to help.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>## Rails 2.2+ has this problem (testing on Rails HEAD) ##

So, in Rails 2.2+, there seems to be some memory problems with using config.log_level  = :warn.  Below I show the steps to reproduce this.

# Creating project #

@@@
compy:Rails Eddie$ rails logger_problem
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  script/process
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application.rb
      create  app/helpers/application_helper.rb
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/environment.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  script/performance/request
      create  script/process/reaper
      create  script/process/spawner
      create  script/process/inspector
      create  script/runner
      create  script/server
      create  script/plugin
      create  public/dispatch.rb
      create  public/dispatch.cgi
      create  public/dispatch.fcgi
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
compy:Rails Eddie$ cd logger_problem/
compy:logger_problem Eddie$ cp -R ../test_project/vendor/rails vendor/
compy:logger_problem Eddie$ script/generate resource tasks
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/tasks
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/tasks.rb
      create    test/unit/tasks_test.rb
      create    test/fixtures/tasks.yml
      create    db/migrate
      create    db/migrate/20081210205128_create_tasks.rb
      create  app/controllers/tasks_controller.rb
      create  test/functional/tasks_controller_test.rb
      create  app/helpers/tasks_helper.rb
      create  test/unit/helpers/tasks_helper_test.rb
       route  map.resources :tasks
compy:logger_problem Eddie$ rake db:migrate
(in /Users/Eddie/Projects/Rails/logger_problem)
==  CreateTasks: migrating ====================================================
-- create_table(:tasks)
   -&gt; 0.0041s
==  CreateTasks: migrated (0.0044s) ===========================================
@@@

# Editing files #

I added an index action, created index.html.erb, and set config.log_level = :warn

@@@
diff --git a/app/controllers/tasks_controller.rb b/app/controllers/tasks_controller.rb
index 1ad33d0..22407f0 100644
--- a/app/controllers/tasks_controller.rb
+++ b/app/controllers/tasks_controller.rb
@@ -1,2 +1,5 @@
 class TasksController &lt; ApplicationController
+  def index
+    
+  end
 end
diff --git a/config/environments/production.rb b/config/environments/production.rb
index ec5b7bc..996f8eb 100644
--- a/config/environments/production.rb
+++ b/config/environments/production.rb
@@ -22,3 +22,5 @@ config.action_controller.perform_caching             = true

 # Disable delivery errors, bad email addresses will be ignored
 # config.action_mailer.raise_delivery_errors = false
+
+config.log_level = :warn
@@@

# Starting Server #

@@@
compy:logger_problem Eddie$ script/server -e production
=&gt; Booting Mongrel
=&gt; Rails 2.3.0 application starting on http://0.0.0.0:3000
=&gt; Call with -d to detach
=&gt; Ctrl-C to shutdown server
@@@

# Hitting it with httperf to simulate requests #

@@@
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  104660 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  126672 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  147612 21431 21366 script/server -e production
@@@

As you should be able to see above, the memory usage (first column) grows quite a bit with each 1000  requests.  Commenting out the config.log_level = :warn line stops this behavior.

If you need any more info I'd be happy to help.</body>
      <body-html>&lt;div&gt;&lt;h2&gt;Rails 2.2+ has this problem (testing on Rails HEAD)&lt;/h2&gt;
&lt;p&gt;So, in Rails 2.2+, there seems to be some memory problems with
using config.log_level = :warn. Below I show the steps to reproduce
this.&lt;/p&gt;
&lt;h1&gt;Creating project&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:Rails Eddie$ rails logger_problem
      create  
      create  app/controllers
      create  app/helpers
      create  app/models
      create  app/views/layouts
      create  config/environments
      create  config/initializers
      create  config/locales
      create  db
      create  doc
      create  lib
      create  lib/tasks
      create  log
      create  public/images
      create  public/javascripts
      create  public/stylesheets
      create  script/performance
      create  script/process
      create  test/fixtures
      create  test/functional
      create  test/integration
      create  test/performance
      create  test/unit
      create  vendor
      create  vendor/plugins
      create  tmp/sessions
      create  tmp/sockets
      create  tmp/cache
      create  tmp/pids
      create  Rakefile
      create  README
      create  app/controllers/application.rb
      create  app/helpers/application_helper.rb
      create  test/test_helper.rb
      create  test/performance/browsing_test.rb
      create  config/database.yml
      create  config/routes.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/new_rails_defaults.rb
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/environment.rb
      create  config/environments/production.rb
      create  config/environments/development.rb
      create  config/environments/test.rb
      create  script/about
      create  script/console
      create  script/dbconsole
      create  script/destroy
      create  script/generate
      create  script/performance/benchmarker
      create  script/performance/profiler
      create  script/performance/request
      create  script/process/reaper
      create  script/process/spawner
      create  script/process/inspector
      create  script/runner
      create  script/server
      create  script/plugin
      create  public/dispatch.rb
      create  public/dispatch.cgi
      create  public/dispatch.fcgi
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/index.html
      create  public/favicon.ico
      create  public/robots.txt
      create  public/images/rails.png
      create  public/javascripts/prototype.js
      create  public/javascripts/effects.js
      create  public/javascripts/dragdrop.js
      create  public/javascripts/controls.js
      create  public/javascripts/application.js
      create  doc/README_FOR_APP
      create  log/server.log
      create  log/production.log
      create  log/development.log
      create  log/test.log
compy:Rails Eddie$ cd logger_problem/
compy:logger_problem Eddie$ cp -R ../test_project/vendor/rails vendor/
compy:logger_problem Eddie$ script/generate resource tasks
      exists  app/models/
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/tasks
      exists  test/functional/
      exists  test/unit/
      create  test/unit/helpers/
  dependency  model
      exists    app/models/
      exists    test/unit/
      exists    test/fixtures/
      create    app/models/tasks.rb
      create    test/unit/tasks_test.rb
      create    test/fixtures/tasks.yml
      create    db/migrate
      create    db/migrate/20081210205128_create_tasks.rb
      create  app/controllers/tasks_controller.rb
      create  test/functional/tasks_controller_test.rb
      create  app/helpers/tasks_helper.rb
      create  test/unit/helpers/tasks_helper_test.rb
       route  map.resources :tasks
compy:logger_problem Eddie$ rake db:migrate
(in /Users/Eddie/Projects/Rails/logger_problem)
==  CreateTasks: migrating ====================================================
-- create_table(:tasks)
   -&amp;gt; 0.0041s
==  CreateTasks: migrated (0.0044s) ===========================================
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Editing files&lt;/h1&gt;
&lt;p&gt;I added an index action, created index.html.erb, and set
config.log_level = :warn&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
diff --git a/app/controllers/tasks_controller.rb b/app/controllers/tasks_controller.rb
index 1ad33d0..22407f0 100644
--- a/app/controllers/tasks_controller.rb
+++ b/app/controllers/tasks_controller.rb
@@ -1,2 +1,5 @@
 class TasksController &amp;lt; ApplicationController
+  def index
+    
+  end
 end
diff --git a/config/environments/production.rb b/config/environments/production.rb
index ec5b7bc..996f8eb 100644
--- a/config/environments/production.rb
+++ b/config/environments/production.rb
@@ -22,3 +22,5 @@ config.action_controller.perform_caching             = true

 # Disable delivery errors, bad email addresses will be ignored
 # config.action_mailer.raise_delivery_errors = false
+
+config.log_level = :warn
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Starting Server&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:logger_problem Eddie$ script/server -e production
=&amp;gt; Booting Mongrel
=&amp;gt; Rails 2.3.0 application starting on http://0.0.0.0:3000
=&amp;gt; Call with -d to detach
=&amp;gt; Ctrl-C to shutdown server
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Hitting it with httperf to simulate requests&lt;/h1&gt;


&lt;pre&gt;&lt;code&gt;
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  104660 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &amp;gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  126672 21431 21366 script/server -e production
compy:vendor Eddie$ httperf --server localhost --port 3000 --uri /tasks --num-conns 1000 &amp;gt; /dev/null 
compy:vendor Eddie$  ps -e -o vsz,pid,ppid,args | grep server
  147612 21431 21366 script/server -e production
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you should be able to see above, the memory usage (first
column) grows quite a bit with each 1000 requests. Commenting out
the config.log_level = :warn line stops this behavior.&lt;/p&gt;
&lt;p&gt;If you need any more info I'd be happy to help.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-10T21:13:33+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T21:13:37+00:00</updated-at>
      <user-id type="integer">27303</user-id>
      <version type="integer">1</version>
      <user-name>Edward Waller</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Good catch!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Good catch!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-10T22:38:45+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T22:38:49+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">2</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>d'oh, foobared patch</body>
      <body-html>&lt;div&gt;&lt;p&gt;d'oh, foobared patch&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-10T22:40:45+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T22:40:49+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">3</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [8da5c5597a218b29a200d9504a73312d59b1a92f]) Squash memory leak when calling flush with an empty buffer

[#1552 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/8da5c5597a218b29a200d9504a73312d59b1a92f</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [8da5c5597a218b29a200d9504a73312d59b1a92f]) Squash memory
leak when calling flush with an empty buffer&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/1552&quot; title=&quot;Ticket #1552&quot;&gt;#1552&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/8da5c5597a218b29a200d9504a73312d59b1a92f&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-10T23:09:46+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T23:09:47+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [9f69ff12d44c4d1e475fd6efede120ccedba3b3e]) Squash memory leak when calling flush with an empty buffer

[#1552 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/9f69ff12d44c4d1e475fd6efede120ccedba3b3e</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [9f69ff12d44c4d1e475fd6efede120ccedba3b3e]) Squash memory
leak when calling flush with an empty buffer&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/1552&quot; title=&quot;Ticket #1552&quot;&gt;#1552&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/9f69ff12d44c4d1e475fd6efede120ccedba3b3e&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-10T23:09:47+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T23:09:48+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">5</version>
      <user-name>Repository</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-10T23:09:57+00:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2008-12-10T23:09:58+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">6</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>emolument &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; documentation and are recurrently &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; superficial of the arm's &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com/watches/jc7-2-replica-2149.html&quot;&gt;JC7-2 replica&lt;/a&gt;&lt;/b&gt; finish of many, but &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com/watches/301-sb-131-rx-replica-2961.html&quot;&gt;301.SB.131.RX replica&lt;/a&gt;&lt;/b&gt; is embodied possible to &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; concede exclusive of these &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com/collection/replica-mont-blanc-watches.html&quot;&gt;Replica Mont Blanc Watches&lt;/a&gt;&lt;/b&gt; watches gone astray spending &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;omega watches sale&lt;/a&gt;&lt;/b&gt; a fortune? The moneymmaking &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; violence of Ebay is &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;rolex replica Watch&lt;/a&gt;&lt;/b&gt; patent. bearings fresh contract &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com/watches/179174-maj-replica-611.html&quot;&gt;179174-MAJ replica&lt;/a&gt;&lt;/b&gt; you permit a flea peddle find, compatible for a ne</body>
      <body-html>&lt;div&gt;&lt;p&gt;emolument &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;Replica
Watches&lt;/a&gt;&lt;/b&gt; documentation and are recurrently &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt;
superficial of the arm's &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com/watches/jc7-2-replica-2149.html&quot;&gt;JC7-2
replica&lt;/a&gt;&lt;/b&gt; finish of many, but &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com/watches/301-sb-131-rx-replica-2961.html&quot;&gt;
301.SB.131.RX replica&lt;/a&gt;&lt;/b&gt; is embodied possible to &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; concede
exclusive of these &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com/collection/replica-mont-blanc-watches.html&quot;&gt;
Replica Mont Blanc Watches&lt;/a&gt;&lt;/b&gt; watches gone astray spending
&lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;omega watches
sale&lt;/a&gt;&lt;/b&gt; a fortune? The moneymmaking &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com&quot;&gt;Replica Watches&lt;/a&gt;&lt;/b&gt; violence
of Ebay is &lt;b&gt;&lt;a href=&quot;http://www.replicawatches5.com&quot;&gt;rolex
replica Watch&lt;/a&gt;&lt;/b&gt; patent. bearings fresh contract &lt;b&gt;&lt;a href=
&quot;http://www.replicawatches5.com/watches/179174-maj-replica-611.html&quot;&gt;
179174-MAJ replica&lt;/a&gt;&lt;/b&gt; you permit a flea peddle find,
compatible for a ne&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-19T09:34:00+01:00</created-at>
      <creator-id type="integer">27303</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1552</number>
      <permalink>memory-problem-with-configlog_level-warn</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>config log_level memory</tag>
      <title>Memory Problem with config.log_level = :warn</title>
      <updated-at type="datetime">2010-07-21T01:45:48+01:00</updated-at>
      <user-id type="integer">107790</user-id>
      <version type="integer">7</version>
      <user-name>a4490302sc</user-name>
      <creator-name>Edward Waller</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1552</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>13832397f4311ea970cadaf47a4952417d2afd83</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-10T22:40:45+00:00</created-at>
      <filename>squash_buffered_logger_memory_leak.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">70015</id>
      <size type="integer">1651</size>
      <uploader-id type="integer">17477</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/70015/squash_buffered_logger_memory_leak.patch</url>
    </attachment>
  </attachments>
</ticket>
