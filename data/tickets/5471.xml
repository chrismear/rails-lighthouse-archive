<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-27T12:30:28+01:00</created-at>
  <creator-id type="integer">17605</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5471</number>
  <permalink>formhelper-problem-with-write-only-fields</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>form_helper patch</tag>
  <title>FormHelper problem with write-only fields</title>
  <updated-at type="datetime">2010-08-27T16:41:37+01:00</updated-at>
  <user-id type="integer">17605</user-id>
  <version type="integer">8</version>
  <user-name>Oliver Eilhard</user-name>
  <creator-name>Oliver Eilhard</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
  <priority-name>Low</priority-name>
  <original-body>With 3.0 RC2 I'm having problems with models that have write-only fields that are not backed by a database column, e.g. a User model with a password field.

I will provide a new test in `form_helper_test.rb` that fails with RC2 but succeeds with RC.

This is probably due to the changes in [8141f0894ecf869ee11f077e5b49e06669790632](http://github.com/rails/rails/commit/8141f0894ecf869ee11f077e5b49e06669790632) (see [ticket #3374](https://rails.lighthouseapp.com/projects/8994/tickets/3374).

The only workaround I've found is implementing the `xyz_before_type_cast` method. Is this the way it's supposed to work?</original-body>
  <latest-body>With 3.0 RC2 I'm having problems with models that have write-only fields that are not backed by a database column, e.g. a User model with a password field.

I will provide a new test in `form_helper_test.rb` that fails with RC2 but succeeds with RC.

This is probably due to the changes in [8141f0894ecf869ee11f077e5b49e06669790632](http://github.com/rails/rails/commit/8141f0894ecf869ee11f077e5b49e06669790632) (see [ticket #3374](https://rails.lighthouseapp.com/projects/8994/tickets/3374).

The only workaround I've found is implementing the `xyz_before_type_cast` method. Is this the way it's supposed to work?</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;With 3.0 RC2 I'm having problems with models that have
write-only fields that are not backed by a database column, e.g. a
User model with a password field.&lt;/p&gt;
&lt;p&gt;I will provide a new test in &lt;code&gt;form_helper_test.rb&lt;/code&gt;
that fails with RC2 but succeeds with RC.&lt;/p&gt;
&lt;p&gt;This is probably due to the changes in &lt;a href=
&quot;http://github.com/rails/rails/commit/8141f0894ecf869ee11f077e5b49e06669790632&quot;&gt;
8141f0894ecf869ee11f077e5b49e06669790632&lt;/a&gt; (see &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3374&quot;&gt;ticket
#3374&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The only workaround I've found is implementing the
&lt;code&gt;xyz_before_type_cast&lt;/code&gt; method. Is this the way it's
supposed to work?&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>With 3.0 RC2 I'm having problems with models that have write-only fields that are not backed by a database column, e.g. a User model with a password field.

I will provide a new test in `form_helper_test.rb` that fails with RC2 but succeeds with RC.

This is probably due to the changes in [8141f0894ecf869ee11f077e5b49e06669790632](http://github.com/rails/rails/commit/8141f0894ecf869ee11f077e5b49e06669790632) (see [ticket #3374](https://rails.lighthouseapp.com/projects/8994/tickets/3374).

The only workaround I've found is implementing the `xyz_before_type_cast` method. Is this the way it's supposed to work?</body>
      <body-html>&lt;div&gt;&lt;p&gt;With 3.0 RC2 I'm having problems with models that have
write-only fields that are not backed by a database column, e.g. a
User model with a password field.&lt;/p&gt;
&lt;p&gt;I will provide a new test in &lt;code&gt;form_helper_test.rb&lt;/code&gt;
that fails with RC2 but succeeds with RC.&lt;/p&gt;
&lt;p&gt;This is probably due to the changes in &lt;a href=
&quot;http://github.com/rails/rails/commit/8141f0894ecf869ee11f077e5b49e06669790632&quot;&gt;
8141f0894ecf869ee11f077e5b49e06669790632&lt;/a&gt; (see &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/3374&quot;&gt;ticket
#3374&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The only workaround I've found is implementing the
&lt;code&gt;xyz_before_type_cast&lt;/code&gt; method. Is this the way it's
supposed to work?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T09:24:12+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T09:24:14+01:00</updated-at>
      <user-id type="integer">17605</user-id>
      <version type="integer">1</version>
      <user-name>Oliver Eilhard</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This patch adds a failing test to `form_helper_test.rb`.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch adds a failing test to
&lt;code&gt;form_helper_test.rb&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T09:29:09+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T09:29:13+01:00</updated-at>
      <user-id type="integer">17605</user-id>
      <version type="integer">2</version>
      <user-name>Oliver Eilhard</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm about to push a change related with this but definitely is not
going to solve your problem. You need a database field or a field
reader. Also your code doesn't work even before my commit. You can
check it out ...

Let's review it ...

@@@
object.respond_to?(method_name + &quot;_before_type_cast&quot;) ?
object.send(method_name + &quot;_before_type_cast&quot;) :
object.send(method_name)
@@@

Your object doesn't respond_to password_before_type_cast so this code
ends trying to execute object.send('password') and you don't have a
reader neither.

Oliver, perhaps what you want to do is f.password_field :password, :value =&gt; ''
and instead of writing the password= method you can do attr_writer :password ;)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm about to push a change related with this but definitely is
not&lt;br&gt;
going to solve your problem. You need a database field or a
field&lt;br&gt;
reader. Also your code doesn't work even before my commit. You
can&lt;br&gt;
check it out ...&lt;/p&gt;
&lt;p&gt;Let's review it ...&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;object.respond_to?(method_name + &quot;_before_type_cast&quot;) ?
object.send(method_name + &quot;_before_type_cast&quot;) :
object.send(method_name)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Your object doesn't respond_to password_before_type_cast so this
code&lt;br&gt;
ends trying to execute object.send('password') and you don't have
a&lt;br&gt;
reader neither.&lt;/p&gt;
&lt;p&gt;Oliver, perhaps what you want to do is f.password_field
:password, :value =&amp;gt; ''&lt;br&gt;
and instead of writing the password= method you can do attr_writer
:password ;)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T12:30:28+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T12:54:22+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">3</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [f95ba5c262bfd713f0a2fc656f8e645d3eea60f2]) Make InstanceTagMethods#value_before_type_cast raise if the model don't respond to attr_before_type_cast or attr method

[#3374] [#5471 state:committed]
http://github.com/rails/rails/commit/f95ba5c262bfd713f0a2fc656f8e645d3eea60f2</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f95ba5c262bfd713f0a2fc656f8e645d3eea60f2&quot;
title=
&quot;Changeset [f95ba5c262bfd713f0a2fc656f8e645d3eea60f2]&quot;&gt;[f95ba5c262bfd713f0a2fc656f8e645d3eea60f2]&lt;/a&gt;)
Make InstanceTagMethods#value_before_type_cast raise if the model
don't respond to attr_before_type_cast or attr method&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/3374&quot; title=
&quot;Ticket #3374&quot;&gt;#3374&lt;/a&gt;] [&lt;a href=&quot;/projects/8994/tickets/5471&quot;
title=&quot;Ticket #5471&quot;&gt;#5471&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/f95ba5c262bfd713f0a2fc656f8e645d3eea60f2&quot;&gt;
http://github.com/rails/rails/commit/f95ba5c262bfd713f0a2fc656f8e64...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-27T13:08:47+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T13:08:48+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [3ba8e3100548f10fce0c9784981a4589531476dd]) Make InstanceTagMethods#value_before_type_cast raise if the model don't respond to attr_before_type_cast or attr method

[#3374] [#5471 state:committed]
http://github.com/rails/rails/commit/3ba8e3100548f10fce0c9784981a4589531476dd</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/3ba8e3100548f10fce0c9784981a4589531476dd&quot;
title=
&quot;Changeset [3ba8e3100548f10fce0c9784981a4589531476dd]&quot;&gt;[3ba8e3100548f10fce0c9784981a4589531476dd]&lt;/a&gt;)
Make InstanceTagMethods#value_before_type_cast raise if the model
don't respond to attr_before_type_cast or attr method&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/3374&quot; title=
&quot;Ticket #3374&quot;&gt;#3374&lt;/a&gt;] [&lt;a href=&quot;/projects/8994/tickets/5471&quot;
title=&quot;Ticket #5471&quot;&gt;#5471&lt;/a&gt; state:committed] &lt;a href=
&quot;http://github.com/rails/rails/commit/3ba8e3100548f10fce0c9784981a4589531476dd&quot;&gt;
http://github.com/rails/rails/commit/3ba8e3100548f10fce0c9784981a45...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-27T13:09:16+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T13:09:19+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">5</version>
      <user-name>Repository</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm still puzzled why it did work up to 3.0 RC, but your help is greatly appreciated. I'm going with the `f.password_field :password, :value =&gt; ''` and that's fine with me. Thanks, Santiago.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm still puzzled why it did work up to 3.0 RC, but your help is
greatly appreciated. I'm going with the &lt;code&gt;f.password_field
:password, :value =&amp;gt; ''&lt;/code&gt; and that's fine with me. Thanks,
Santiago.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-27T13:51:25+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T13:51:26+01:00</updated-at>
      <user-id type="integer">17605</user-id>
      <version type="integer">6</version>
      <user-name>Oliver Eilhard</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Doesn't work for me on Rails 3 RC.
I'm uploading the example for you to see, i'm getting as expected according to the code :) ...

@@@
undefined method `password' for #&lt;Post id: nil, title: nil, created_at: nil, updated_at: nil&gt;

Extracted source (around line #20):

17:   &lt;/div&gt;
18:   &lt;div class=&quot;field&quot;&gt;
19:     &lt;%= f.label :password %&gt;&lt;br /&gt;
20:     &lt;%= f.password_field :password %&gt;
21:   &lt;/div&gt;
22:   &lt;div class=&quot;actions&quot;&gt;
23:     &lt;%= f.submit %&gt;
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Doesn't work for me on Rails 3 RC.&lt;br&gt;
I'm uploading the example for you to see, i'm getting as expected
according to the code :) ...&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;undefined method `password' for #&amp;lt;Post id: nil, title: nil, created_at: nil, updated_at: nil&amp;gt;

Extracted source (around line #20):

17:   &amp;lt;/div&amp;gt;
18:   &amp;lt;div class=&quot;field&quot;&amp;gt;
19:     &amp;lt;%= f.label :password %&amp;gt;&amp;lt;br /&amp;gt;
20:     &amp;lt;%= f.password_field :password %&amp;gt;
21:   &amp;lt;/div&amp;gt;
22:   &amp;lt;div class=&quot;actions&quot;&amp;gt;
23:     &amp;lt;%= f.submit %&amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-27T16:28:28+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T16:28:30+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Thanks again. Sorry for causing so much work. Next time, I'll do better testing... promised. :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks again. Sorry for causing so much work. Next time, I'll do
better testing... promised. :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-08-27T16:41:35+01:00</created-at>
      <creator-id type="integer">17605</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5471</number>
      <permalink>formhelper-problem-with-write-only-fields</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>form_helper patch</tag>
      <title>FormHelper problem with write-only fields</title>
      <updated-at type="datetime">2010-08-27T16:41:37+01:00</updated-at>
      <user-id type="integer">17605</user-id>
      <version type="integer">8</version>
      <user-name>Oliver Eilhard</user-name>
      <creator-name>Oliver Eilhard</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5471</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ce22873838b5463485861fb017d199fcabe73a1c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-08-27T09:29:09+01:00</created-at>
      <filename>form_helper_writeonly_field_problem.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">647771</id>
      <size type="integer">1353</size>
      <uploader-id type="integer">17605</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/647771/form_helper_writeonly_field_problem.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>9b43f06355f16600d3c746271a8318ade7a8fd17</code>
      <content-type>application/x-gzip</content-type>
      <created-at type="datetime">2010-08-27T16:28:29+01:00</created-at>
      <filename>myapptar.gz</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">648348</id>
      <size type="integer">87614</size>
      <uploader-id type="integer">40272</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/648348/myapptar.gz</url>
    </attachment>
  </attachments>
</ticket>
