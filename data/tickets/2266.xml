<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">22589</assigned-user-id>
  <attachments-count type="integer">7</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-03-03T09:20:23+00:00</created-at>
  <creator-id type="integer">12845</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">2266</number>
  <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
  <priority type="integer">1444</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag nil="true"></tag>
  <title>rake gems broken for vendored gems which are unbuilt extensions</title>
  <updated-at type="datetime">2011-03-03T09:20:23+00:00</updated-at>
  <user-id type="integer">94458</user-id>
  <version type="integer">34</version>
  <user-name>Jeff Kreeftmeijer</user-name>
  <creator-name>Wincent Colaiuta</creator-name>
  <assigned-user-name>Matt Jones</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>In between Rails 2.3.1 RC2 and 2.3.2 final, &quot;rake gems&quot; and &quot;rake gems:build&quot; became broken for gems which are vendored, are C extensions, and are not yet built.

I suspect the breakage was caused in the rewrite introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf.

In order to reproduce the problem you need a gem which is a C extension, such as the &quot;wikitext&quot; gem:

@@@
sudo gem install wikitext
@@@

Now create a new Rails app:

@@@
rails gembug
cd gembug
@@@

Now add a &quot;config.gem&quot; line to &quot;config/environment.rb&quot;:

@@@
config.gem 'wikitext'
@@@

Note that &quot;rake gems&quot; works fine for now, because you haven't yet vendored the gem:

@@@
(in /private/tmp/gembug)
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

Now try unpacking the gem with &quot;rake gems:unpack&quot; (which works), but note that &quot;rake gems&quot; is now broken. &quot;rake gems:build&quot; is also broken. Here's the output of &quot;rake gems --trace&quot;:

@@@
(in /private/tmp/gembug)
** Invoke gems (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/gem_dependency.rb:179:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:162:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
@@@

Evidently, &quot;rake gems&quot; (and also &quot;rake gems:build&quot;) are trying to &quot;require&quot; files in the vendored gem which do not exist yet, because the C extension hasn't been built. In other words, &quot;rake gems:build&quot; will only work if the vendored gem is already built, which is a chicken-and-egg problem. Obviously, &quot;script/server&quot; is also broken; the app won't even start.

Looks like the logic introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf will need to be changed so that at the very least &quot;rake gems&quot; and most certainly &quot;rake gems:build&quot; doesn't actually _require_ the gems. I haven't yet fully grokked that code but I will continue to look into it and see if I can spot exactly where the bug lies.

In the meantime, the workaround is to copy the built extension from the system gem into the vendored gem:

@@@
$ cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
$ rake gems
(in /private/tmp/gembug)
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@</original-body>
  <latest-body>In between Rails 2.3.1 RC2 and 2.3.2 final, &quot;rake gems&quot; and &quot;rake gems:build&quot; became broken for gems which are vendored, are C extensions, and are not yet built.

I suspect the breakage was caused in the rewrite introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf.

In order to reproduce the problem you need a gem which is a C extension, such as the &quot;wikitext&quot; gem:

@@@
sudo gem install wikitext
@@@

Now create a new Rails app:

@@@
rails gembug
cd gembug
@@@

Now add a &quot;config.gem&quot; line to &quot;config/environment.rb&quot;:

@@@
config.gem 'wikitext'
@@@

Note that &quot;rake gems&quot; works fine for now, because you haven't yet vendored the gem:

@@@
(in /private/tmp/gembug)
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

Now try unpacking the gem with &quot;rake gems:unpack&quot; (which works), but note that &quot;rake gems&quot; is now broken. &quot;rake gems:build&quot; is also broken. Here's the output of &quot;rake gems --trace&quot;:

@@@
(in /private/tmp/gembug)
** Invoke gems (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/gem_dependency.rb:179:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:162:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
@@@

Evidently, &quot;rake gems&quot; (and also &quot;rake gems:build&quot;) are trying to &quot;require&quot; files in the vendored gem which do not exist yet, because the C extension hasn't been built. In other words, &quot;rake gems:build&quot; will only work if the vendored gem is already built, which is a chicken-and-egg problem. Obviously, &quot;script/server&quot; is also broken; the app won't even start.

Looks like the logic introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf will need to be changed so that at the very least &quot;rake gems&quot; and most certainly &quot;rake gems:build&quot; doesn't actually _require_ the gems. I haven't yet fully grokked that code but I will continue to look into it and see if I can spot exactly where the bug lies.

In the meantime, the workaround is to copy the built extension from the system gem into the vendored gem:

@@@
$ cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
$ rake gems
(in /private/tmp/gembug)
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;In between Rails 2.3.1 RC2 and 2.3.2 final, &quot;rake gems&quot; and
&quot;rake gems:build&quot; became broken for gems which are vendored, are C
extensions, and are not yet built.&lt;/p&gt;
&lt;p&gt;I suspect the breakage was caused in the rewrite introduced in
commit 99d75a7b02bf430a124b9c3e2515850959d78acf.&lt;/p&gt;
&lt;p&gt;In order to reproduce the problem you need a gem which is a C
extension, such as the &quot;wikitext&quot; gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
sudo gem install wikitext
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now create a new Rails app:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
rails gembug
cd gembug
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now add a &quot;config.gem&quot; line to &quot;config/environment.rb&quot;:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
config.gem 'wikitext'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note that &quot;rake gems&quot; works fine for now, because you haven't
yet vendored the gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /private/tmp/gembug)
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now try unpacking the gem with &quot;rake gems:unpack&quot; (which works),
but note that &quot;rake gems&quot; is now broken. &quot;rake gems:build&quot; is also
broken. Here's the output of &quot;rake gems --trace&quot;:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /private/tmp/gembug)
** Invoke gems (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/gem_dependency.rb:179:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:162:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Evidently, &quot;rake gems&quot; (and also &quot;rake gems:build&quot;) are trying
to &quot;require&quot; files in the vendored gem which do not exist yet,
because the C extension hasn't been built. In other words, &quot;rake
gems:build&quot; will only work if the vendored gem is already built,
which is a chicken-and-egg problem. Obviously, &quot;script/server&quot; is
also broken; the app won't even start.&lt;/p&gt;
&lt;p&gt;Looks like the logic introduced in commit
99d75a7b02bf430a124b9c3e2515850959d78acf will need to be changed so
that at the very least &quot;rake gems&quot; and most certainly &quot;rake
gems:build&quot; doesn't actually &lt;em&gt;require&lt;/em&gt; the gems. I haven't
yet fully grokked that code but I will continue to look into it and
see if I can spot exactly where the bug lies.&lt;/p&gt;
&lt;p&gt;In the meantime, the workaround is to copy the built extension
from the system gem into the vendored gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
$ cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
$ rake gems
(in /private/tmp/gembug)
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In between Rails 2.3.1 RC2 and 2.3.2 final, &quot;rake gems&quot; and &quot;rake gems:build&quot; became broken for gems which are vendored, are C extensions, and are not yet built.

I suspect the breakage was caused in the rewrite introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf.

In order to reproduce the problem you need a gem which is a C extension, such as the &quot;wikitext&quot; gem:

@@@
sudo gem install wikitext
@@@

Now create a new Rails app:

@@@
rails gembug
cd gembug
@@@

Now add a &quot;config.gem&quot; line to &quot;config/environment.rb&quot;:

@@@
config.gem 'wikitext'
@@@

Note that &quot;rake gems&quot; works fine for now, because you haven't yet vendored the gem:

@@@
(in /private/tmp/gembug)
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

Now try unpacking the gem with &quot;rake gems:unpack&quot; (which works), but note that &quot;rake gems&quot; is now broken. &quot;rake gems:build&quot; is also broken. Here's the output of &quot;rake gems --trace&quot;:

@@@
(in /private/tmp/gembug)
** Invoke gems (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/gem_dependency.rb:179:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:162:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
@@@

Evidently, &quot;rake gems&quot; (and also &quot;rake gems:build&quot;) are trying to &quot;require&quot; files in the vendored gem which do not exist yet, because the C extension hasn't been built. In other words, &quot;rake gems:build&quot; will only work if the vendored gem is already built, which is a chicken-and-egg problem. Obviously, &quot;script/server&quot; is also broken; the app won't even start.

Looks like the logic introduced in commit 99d75a7b02bf430a124b9c3e2515850959d78acf will need to be changed so that at the very least &quot;rake gems&quot; and most certainly &quot;rake gems:build&quot; doesn't actually _require_ the gems. I haven't yet fully grokked that code but I will continue to look into it and see if I can spot exactly where the bug lies.

In the meantime, the workaround is to copy the built extension from the system gem into the vendored gem:

@@@
$ cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
$ rake gems
(in /private/tmp/gembug)
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;In between Rails 2.3.1 RC2 and 2.3.2 final, &quot;rake gems&quot; and
&quot;rake gems:build&quot; became broken for gems which are vendored, are C
extensions, and are not yet built.&lt;/p&gt;
&lt;p&gt;I suspect the breakage was caused in the rewrite introduced in
commit 99d75a7b02bf430a124b9c3e2515850959d78acf.&lt;/p&gt;
&lt;p&gt;In order to reproduce the problem you need a gem which is a C
extension, such as the &quot;wikitext&quot; gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
sudo gem install wikitext
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now create a new Rails app:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
rails gembug
cd gembug
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now add a &quot;config.gem&quot; line to &quot;config/environment.rb&quot;:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
config.gem 'wikitext'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note that &quot;rake gems&quot; works fine for now, because you haven't
yet vendored the gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /private/tmp/gembug)
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now try unpacking the gem with &quot;rake gems:unpack&quot; (which works),
but note that &quot;rake gems&quot; is now broken. &quot;rake gems:build&quot; is also
broken. Here's the output of &quot;rake gems --trace&quot;:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /private/tmp/gembug)
** Invoke gems (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/gem_dependency.rb:179:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:305:in `load_gems'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:162:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Evidently, &quot;rake gems&quot; (and also &quot;rake gems:build&quot;) are trying
to &quot;require&quot; files in the vendored gem which do not exist yet,
because the C extension hasn't been built. In other words, &quot;rake
gems:build&quot; will only work if the vendored gem is already built,
which is a chicken-and-egg problem. Obviously, &quot;script/server&quot; is
also broken; the app won't even start.&lt;/p&gt;
&lt;p&gt;Looks like the logic introduced in commit
99d75a7b02bf430a124b9c3e2515850959d78acf will need to be changed so
that at the very least &quot;rake gems&quot; and most certainly &quot;rake
gems:build&quot; doesn't actually &lt;em&gt;require&lt;/em&gt; the gems. I haven't
yet fully grokked that code but I will continue to look into it and
see if I can spot exactly where the bug lies.&lt;/p&gt;
&lt;p&gt;In the meantime, the workaround is to copy the built extension
from the system gem into the vendored gem:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
$ cp /Library/Ruby/Gems/1.8/gems/wikitext-1.5.1/ext/wikitext.bundle vendor/gems/wikitext-1.5.1/ext/
$ rake gems
(in /private/tmp/gembug)
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-17T10:50:53+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-17T10:50:56+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">1</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Ok, I've been analysing 99d75a7b02bf430a124b9c3e2515850959d78acf a bit more to see if I can figure out what's going on. I see it adds a &quot;gems_build_rake_task&quot; global variable which it uses to at least try to do the right thing when doing &quot;rake gems:build&quot;, but it's not working.

Here is the stack trace of &quot;rake gems:build --trace&quot;:

@@@
(in /private/tmp/gembug)
** Invoke gems:build (first_time)
** Execute gems:build
** Invoke gems:unpack (first_time)
** Invoke gems:install (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:23
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
@@@

This stack trace shows that the problem is that &quot;evaluate_init_rb&quot; is firing off the &quot;init.rb&quot; file in the vendored but not yet built gem, which is causing the NameError to be triggered.

I also tried blowing away the gem entirely and doing &quot;rake gems:build&quot; instead of &quot;rake gems:unpack&quot; followed by &quot;rake gems:build&quot;. In this case the gems does get unpacked and built before the init.rb is called (if it is even called, I didn't check).

I am going to look into patching the &quot;evaluate_init_rb&quot; method or some other appropriate point in the call chain to look at the &quot;gems_build_rake_task&quot; global and prevent the unwanted &quot;init.rb&quot; from firing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ok, I've been analysing 99d75a7b02bf430a124b9c3e2515850959d78acf
a bit more to see if I can figure out what's going on. I see it
adds a &quot;gems_build_rake_task&quot; global variable which it uses to at
least try to do the right thing when doing &quot;rake gems:build&quot;, but
it's not working.&lt;/p&gt;
&lt;p&gt;Here is the stack trace of &quot;rake gems:build --trace&quot;:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /private/tmp/gembug)
** Invoke gems:build (first_time)
** Execute gems:build
** Invoke gems:unpack (first_time)
** Invoke gems:install (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
rake aborted!
no such file to load -- wikitext
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:36:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/private/tmp/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin.rb:48:in `load'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `each'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:348:in `load_plugins'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:163:in `process'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `send'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/initializer.rb:113:in `run'
/private/tmp/gembug/config/environment.rb:9
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/Library/Ruby/Site/1.8/rubygems/custom_require.rb:31:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Library/Ruby/Gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:156:in `require'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/misc.rake:4
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:17
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:588:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:585:in `invoke_prerequisites'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:577:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rails-2.3.2/lib/tasks/gems.rake:23
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `call'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:617:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:612:in `execute'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:578:in `invoke_with_call_chain'
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:571:in `invoke_with_call_chain'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:564:in `invoke'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2027:in `invoke_task'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `each'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2005:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1999:in `top_level'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1977:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:2044:in `standard_exception_handling'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/lib/rake.rb:1974:in `run'
/Library/Ruby/Gems/1.8/gems/rake-0.8.4/bin/rake:31
/usr/bin/rake:19:in `load'
/usr/bin/rake:19
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This stack trace shows that the problem is that
&quot;evaluate_init_rb&quot; is firing off the &quot;init.rb&quot; file in the vendored
but not yet built gem, which is causing the NameError to be
triggered.&lt;/p&gt;
&lt;p&gt;I also tried blowing away the gem entirely and doing &quot;rake
gems:build&quot; instead of &quot;rake gems:unpack&quot; followed by &quot;rake
gems:build&quot;. In this case the gems does get unpacked and built
before the init.rb is called (if it is even called, I didn't
check).&lt;/p&gt;
&lt;p&gt;I am going to look into patching the &quot;evaluate_init_rb&quot; method
or some other appropriate point in the call chain to look at the
&quot;gems_build_rake_task&quot; global and prevent the unwanted &quot;init.rb&quot;
from firing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-18T10:09:03+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-18T10:09:06+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">2</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Ok. Attaching a minimal patch to get &quot;rake gems:build&quot; working again.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ok. Attaching a minimal patch to get &quot;rake gems:build&quot; working
again.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-18T10:28:20+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-18T10:28:24+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">3</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>5 days have passed. Anyone had a chance to look at this patch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;5 days have passed. Anyone had a chance to look at this
patch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-23T16:58:00+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-23T16:58:04+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">4</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-23T17:42:02+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-23T17:42:06+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">5</version>
      <user-name>Pratik</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>There's a bit of a catch-22 here - the changes to the build command in that commit mean that gems not requested by config.gem won't get built. BUT, plugins are supposed to require any gems they depend on with config.gem statements in init.rb.

This patch as written would break in a situation where plugin X (installed in vendor/plugins) depended on wikitext. The unpack task would correctly pick up the dependency, and then build wouldn't be run (as the plugin's init.rb). At that point, the app is wedged - trying to load the environment will get the error seen above.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There's a bit of a catch-22 here - the changes to the build
command in that commit mean that gems not requested by config.gem
won't get built. BUT, plugins are supposed to require any gems they
depend on with config.gem statements in init.rb.&lt;/p&gt;
&lt;p&gt;This patch as written would break in a situation where plugin X
(installed in vendor/plugins) depended on wikitext. The unpack task
would correctly pick up the dependency, and then build wouldn't be
run (as the plugin's init.rb). At that point, the app is wedged -
trying to load the environment will get the error seen above.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-24T01:12:25+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-24T01:12:26+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">6</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>So what's the solution then? This behaviour here is a regression. It used to work prior to 99d75a7b02bf430a124b9c3e2515850959d78acf, and now it doesn't. How do we fix it?</body>
      <body-html>&lt;div&gt;&lt;p&gt;So what's the solution then? This behaviour here is a
regression. It used to work prior to
99d75a7b02bf430a124b9c3e2515850959d78acf, and now it doesn't. How
do we fix it?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-24T06:10:46+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-24T06:10:51+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">7</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>A patch is attached that should handle these cases. I've added some code that does a check for gems with native components that have not yet been built and bails out with an error.

This error is similar in nature to the check for unloaded dependencies.

This should at least let you know what is going wrong and give you a means to fix it rather than bailing out with cryptic errors.</body>
      <body-html>&lt;div&gt;&lt;p&gt;A patch is attached that should handle these cases. I've added
some code that does a check for gems with native components that
have not yet been built and bails out with an error.&lt;/p&gt;
&lt;p&gt;This error is similar in nature to the check for unloaded
dependencies.&lt;/p&gt;
&lt;p&gt;This should at least let you know what is going wrong and give
you a means to fix it rather than bailing out with cryptic
errors.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T18:58:44+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T18:58:46+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">8</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Apparently my rebase-fu is broken again, new patch attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Apparently my rebase-fu is broken again, new patch attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T19:01:05+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T19:01:08+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">9</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>The patch still doesn't address the problem - Rails is loading all of the rails/init.rb files it can find (as part of plugin initialization). The init.rb file for wikitext requires the native extension, which fails.

I'm not totally convinced that this even *is* patchable in the current system - we need to load init.rb files to pick up dependencies specified there, but we can't ensure that one of those files won't try to require an unbuild native extension.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The patch still doesn't address the problem - Rails is loading
all of the rails/init.rb files it can find (as part of plugin
initialization). The init.rb file for wikitext requires the native
extension, which fails.&lt;/p&gt;
&lt;p&gt;I'm not totally convinced that this even &lt;em&gt;is&lt;/em&gt; patchable
in the current system - we need to load init.rb files to pick up
dependencies specified there, but we can't ensure that one of those
files won't try to require an unbuild native extension.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T20:31:05+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T20:31:09+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">10</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>This patch causes the initializer to abort() out before plugin initialization if there are any unbuilt gems. How is the case not handled?</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch causes the initializer to abort() out before plugin
initialization if there are any unbuilt gems. How is the case not
handled?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T20:37:48+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T20:37:54+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">11</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>In this ticket's case, the problem is that calling 'rake gems:build' loads the environment (via gems:unpack), which tries to load the plugins, which blows up. So the solution recommended by the error message doesn't work.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In this ticket's case, the problem is that calling 'rake
gems:build' loads the environment (via gems:unpack), which tries to
load the plugins, which blows up. So the solution recommended by
the error message doesn't work.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T20:41:36+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T20:41:38+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">12</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>How would that case ever be encountered?

In what cases is there an unpacked, unbuilt gem in vendor/gems that is not specified by config.gem?

If the file is specified by config.gem anywhere, the initializer will abort out as it will recognize it as unbuilt.</body>
      <body-html>&lt;div&gt;&lt;p&gt;How would that case ever be encountered?&lt;/p&gt;
&lt;p&gt;In what cases is there an unpacked, unbuilt gem in vendor/gems
that is not specified by config.gem?&lt;/p&gt;
&lt;p&gt;If the file is specified by config.gem anywhere, the initializer
will abort out as it will recognize it as unbuilt.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T20:52:41+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T20:52:43+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">13</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Add config.gem 'wikitext' to environment.rb


[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)


[~Code/WikiTextTest] rake gems:unpack
(in /Users/ddollarCode/WikiTextTest)
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
          /usr/bin aren't both writable.
Unpacked gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'


[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
The following gems have native components that need to be built
  wikitext  

You're running:
  ruby 1.8.6.114 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  rubygems 1.3.1 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8, /Library/Ruby/Gems/1.8

Run `rake gems:build` to build the unbuilt gems.


[~Code/WikiTextTest] rake gems:build
(in /Users/ddollarCode/WikiTextTest)
Built gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'

[~/Code/WikiTextTest] rake gems
(in /Users/ddollar/Code/RailsApp)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Add config.gem 'wikitext' to environment.rb&lt;/p&gt;
&lt;p&gt;[~Code/WikiTextTest] rake gems (in
/Users/ddollarCode/WikiTextTest) - [F] aws-s3 = 0.5.1&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;- [I] xml-simple
- [R] builder 
- [I] mime-types 
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;[F] RedCloth&lt;/li&gt;
&lt;li&gt;[I] wikitext&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I = Installed F = Frozen R = Framework (loaded before rails
starts)&lt;/p&gt;
&lt;p&gt;[~Code/WikiTextTest] rake gems:unpack (in
/Users/ddollarCode/WikiTextTest) WARNING: Installing to ~/.gem
since /Library/Ruby/Gems/1.8 and&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;      /usr/bin aren't both writable.
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Unpacked gem:
'/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'&lt;/p&gt;
&lt;p&gt;[~Code/WikiTextTest] rake gems (in
/Users/ddollarCode/WikiTextTest) The following gems have native
components that need to be built wikitext&lt;br&gt;&lt;/p&gt;
&lt;p&gt;You're running: ruby 1.8.6.114 at
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
rubygems 1.3.1 at
/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8,
/Library/Ruby/Gems/1.8&lt;/p&gt;
&lt;p&gt;Run &lt;code&gt;rake gems:build&lt;/code&gt; to build the unbuilt gems.&lt;/p&gt;
&lt;p&gt;[~Code/WikiTextTest] rake gems:build (in
/Users/ddollarCode/WikiTextTest) Built gem:
'/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'&lt;/p&gt;
&lt;p&gt;[~/Code/WikiTextTest] rake gems (in
/Users/ddollar/Code/RailsApp) - [F] aws-s3 = 0.5.1&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;- [I] xml-simple
- [R] builder 
- [I] mime-types 
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;[F] RedCloth&lt;/li&gt;
&lt;li&gt;[F] wikitext&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I = Installed F = Frozen R = Framework (loaded before rails
starts)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T20:59:19+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T20:59:25+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">14</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Trying that again, curse you Lighthouse-lack-of-preview!

Add config.gem 'wikitext' to environment.rb

@@@
[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

@@@
[~Code/WikiTextTest] rake gems:unpack
(in /Users/ddollarCode/WikiTextTest)
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
          /usr/bin aren't both writable.
Unpacked gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'
@@@

@@@
[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
The following gems have native components that need to be built
  wikitext  

You're running:
  ruby 1.8.6.114 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  rubygems 1.3.1 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8, /Library/Ruby/Gems/1.8

Run `rake gems:build` to build the unbuilt gems.
@@@

@@@
[~Code/WikiTextTest] rake gems:build
(in /Users/ddollarCode/WikiTextTest)
Built gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'
@@@

@@@
[~/Code/WikiTextTest] rake gems
(in /Users/ddollar/Code/RailsApp)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Trying that again, curse you Lighthouse-lack-of-preview!&lt;/p&gt;
&lt;p&gt;Add config.gem 'wikitext' to environment.rb&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [I] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~Code/WikiTextTest] rake gems:unpack
(in /Users/ddollarCode/WikiTextTest)
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
          /usr/bin aren't both writable.
Unpacked gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~Code/WikiTextTest] rake gems
(in /Users/ddollarCode/WikiTextTest)
The following gems have native components that need to be built
  wikitext  

You're running:
  ruby 1.8.6.114 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  rubygems 1.3.1 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8, /Library/Ruby/Gems/1.8

Run `rake gems:build` to build the unbuilt gems.
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~Code/WikiTextTest] rake gems:build
(in /Users/ddollarCode/WikiTextTest)
Built gem: '/Users/ddollarCode/WikiTextTest/vendor/gems/wikitext-1.5.2'
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTextTest] rake gems
(in /Users/ddollar/Code/RailsApp)
 - [F] aws-s3 = 0.5.1
    - [I] xml-simple 
    - [R] builder 
    - [I] mime-types 
 - [F] RedCloth 
 - [F] wikitext 

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T21:00:27+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T21:00:32+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">15</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Fixing the patch to not check gems that are not frozen for built status</body>
      <body-html>&lt;div&gt;&lt;p&gt;Fixing the patch to not check gems that are not frozen for built
status&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T21:01:53+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T21:01:59+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">16</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>After applying the very latest patch, I'm not getting the same results here - I get the same output, up until I run gems:build. That errors out with the same 'no such file to load' error as before.</body>
      <body-html>&lt;div&gt;&lt;p&gt;After applying the very latest patch, I'm not getting the same
results here - I get the same output, up until I run gems:build.
That errors out with the same 'no such file to load' error as
before.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T22:03:22+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T22:03:25+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">17</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Matt:

Could you post the output with --trace of your failure?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Matt:&lt;/p&gt;
&lt;p&gt;Could you post the output with --trace of your failure?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T22:05:41+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T22:05:47+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">18</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Sure - here's the full trace:

@@@
(in /Users/mattjones/grip/gembug)
** Invoke gems:build (first_time)
** Execute gems:build
** Invoke gems:unpack (first_time)
** Invoke gems:install (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
rake aborted!
no such file to load -- wikitext
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:48:in `load'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:37:in `each'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:369:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:165:in `process'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:113:in `send'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:113:in `run'
/Users/mattjones/grip/gembug/config/environment.rb:9
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/misc.rake:4
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/gems.rake:17
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:588:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:577:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:588:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:577:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/gems.rake:23
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2019:in `invoke_task'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2036:in `standard_exception_handling'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1991:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1970:in `run'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2036:in `standard_exception_handling'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1967:in `run'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/bin/rake:31
/usr/local/bin/rake:19:in `load'
/usr/local/bin/rake:19
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sure - here's the full trace:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
(in /Users/mattjones/grip/gembug)
** Invoke gems:build (first_time)
** Execute gems:build
** Invoke gems:unpack (first_time)
** Invoke gems:install (first_time)
** Invoke gems:base (first_time)
** Execute gems:base
** Invoke environment (first_time)
** Execute environment
rake aborted!
no such file to load -- wikitext
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/gems/wikitext-1.5.1/lib/wikitext/nil_class.rb:15
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/gems/wikitext-1.5.1/rails/init.rb:15:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:146:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnings'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:142:in `evaluate_init_rb'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin.rb:48:in `load'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:38:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:37:in `each'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/rails/plugin/loader.rb:37:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:369:in `load_plugins'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:165:in `process'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:113:in `send'
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:113:in `run'
/Users/mattjones/grip/gembug/config/environment.rb:9
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
/usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:521:in `new_constants_in'
/Users/mattjones/grip/gembug/vendor/rails/activesupport/lib/active_support/dependencies.rb:156:in `require'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/misc.rake:4
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/gems.rake:17
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:588:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:577:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:588:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:585:in `invoke_prerequisites'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:577:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/Users/mattjones/grip/gembug/vendor/rails/railties/lib/tasks/gems.rake:23
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `call'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:617:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:612:in `execute'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:578:in `invoke_with_call_chain'
/usr/local/lib/ruby/1.8/monitor.rb:238:in `synchronize'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:571:in `invoke_with_call_chain'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:564:in `invoke'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2019:in `invoke_task'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `each'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1997:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2036:in `standard_exception_handling'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1991:in `top_level'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1970:in `run'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:2036:in `standard_exception_handling'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake.rb:1967:in `run'
/usr/local/lib/ruby/gems/1.8/gems/rake-0.8.3/bin/rake:31
/usr/local/bin/rake:19:in `load'
/usr/local/bin/rake:19
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T22:07:33+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T22:07:38+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">19</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:369:in `load_plugins'

The initializer should never get there with unbuilt gems. Try removing vendor/gems/wikitext and starting over, perhaps it was in an odd state from pre-patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
/Users/mattjones/grip/gembug/config/../vendor/rails/railties/lib/initializer.rb:369:in
&lt;code&gt;load_plugins'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The initializer should never get there with unbuilt gems. Try
removing vendor/gems/wikitext and starting over, perhaps it was in
an odd state from pre-patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-27T22:17:34+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-03-27T22:17:35+00:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">20</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Could I get someone to take a look at this (the original submitter or Matt Jones)

The patch should be quite a help to those using gems with native extensions.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could I get someone to take a look at this (the original
submitter or Matt Jones)&lt;/p&gt;
&lt;p&gt;The patch should be quite a help to those using gems with native
extensions.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-01T20:07:53+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-01T20:07:58+01:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">21</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Just a note for anyone trying out any of these patches using the wikitext gem to reproduce the problem.

I actually patched the gem to work around the issue:

http://git.wincent.com/wikitext.git?a=blobdiff;f=rails/init.rb;h=fba7edddbd028fe54762a003d1995a489498a464;hp=d201b626b430e69b1f69f81e88da679babd60317;hb=b1b1b38e93db1c7b009480c897da255265c882c4;hpb=2acdc7fb90cf17d88ec7b8230923782904ff70ec

So if you want to trigger the bug your config.gem line should explicitly require version 1.5.1, because version 1.5.2 contains the workaround:

@@@
config.gem 'wikitext', :version =&gt; '1.5.1'
@@@

And to install version 1.5.1 of the gem if you don't have it already, you'd have to pass a specific version in:

@@@
gem install wikitext --version 1.5.1
@@@

I still think the regression should be fixed in Rails though, because it's better than patching any and all third-party extensions which might be affected by the issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just a note for anyone trying out any of these patches using the
wikitext gem to reproduce the problem.&lt;/p&gt;
&lt;p&gt;I actually patched the gem to work around the issue:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://git.wincent.com/wikitext.git?a=blobdiff;f=rails&quot;&gt;http://git.wincent.com/wikitext....&lt;/a&gt;/init.rb;h=fba7edddbd028fe54762a003d1995a489498a464;hp=d201b626b430e69b1f69f81e88da679babd60317;hb=b1b1b38e93db1c7b009480c897da255265c882c4;hpb=2acdc7fb90cf17d88ec7b8230923782904ff70ec&lt;/p&gt;
&lt;p&gt;So if you want to trigger the bug your config.gem line should
explicitly require version 1.5.1, because version 1.5.2 contains
the workaround:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
config.gem 'wikitext', :version =&amp;gt; '1.5.1'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And to install version 1.5.1 of the gem if you don't have it
already, you'd have to pass a specific version in:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
gem install wikitext --version 1.5.1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I still think the regression should be fixed in Rails though,
because it's better than patching any and all third-party
extensions which might be affected by the issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-01T21:34:18+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-01T21:34:21+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">22</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Lighthouse ate my link. Here's the patch:

@@@
diff --git a/rails/init.rb b/rails/init.rb
index d201b62..fba7edd 100644
--- a/rails/init.rb
+++ b/rails/init.rb
@@ -1,4 +1,4 @@
-# Copyright 2008 Wincent Colaiuta
+# Copyright 2008-2009 Wincent Colaiuta
 # This program is free software: you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation, either version 3 of the License, or
@@ -12,6 +12,10 @@
 # You should have received a copy of the GNU General Public License
 # along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 
-require 'wikitext/nil_class'
-require 'wikitext/string'
-require 'wikitext/rails'
+# Avoid Rails bug #2266 by not requiring during &quot;rake gems:build&quot;
+# See: https://rails.lighthouseapp.com/projects/8994/tickets/2266
+unless $gems_build_rake_task
+  require 'wikitext/nil_class'
+  require 'wikitext/string'
+  require 'wikitext/rails'
+end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Lighthouse ate my link. Here's the patch:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
diff --git a/rails/init.rb b/rails/init.rb
index d201b62..fba7edd 100644
--- a/rails/init.rb
+++ b/rails/init.rb
@@ -1,4 +1,4 @@
-# Copyright 2008 Wincent Colaiuta
+# Copyright 2008-2009 Wincent Colaiuta
 # This program is free software: you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation, either version 3 of the License, or
@@ -12,6 +12,10 @@
 # You should have received a copy of the GNU General Public License
 # along with this program.  If not, see &amp;lt;http://www.gnu.org/licenses/&amp;gt;.
 
-require 'wikitext/nil_class'
-require 'wikitext/string'
-require 'wikitext/rails'
+# Avoid Rails bug #2266 by not requiring during &amp;quot;rake gems:build&amp;quot;
+# See: https://rails.lighthouseapp.com/projects/8994/tickets/2266
+unless $gems_build_rake_task
+  require 'wikitext/nil_class'
+  require 'wikitext/string'
+  require 'wikitext/rails'
+end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-01T21:35:57+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-01T21:36:01+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">23</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>I've modified the patch to have gems:build get the list of gems from vendor/gems rather than by loading the environment. Wikitest 1.5.1 works now, evidenced below.

@@@
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [ ] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

@@@
[~/Code/WikiTest] sudo rake gems:install
(in /Users/ddollar/Code/WikiTest)
gem install wikitext --version &quot;= 1.5.1&quot;
Building native extensions.  This could take a while...
Successfully installed wikitext-1.5.1
1 gem installed
@@@

@@@
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [I] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@

@@@
[~/Code/WikiTest] rake gems:unpack:dependencies
(in /Users/ddollar/Code/WikiTest)
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
          /usr/bin aren't both writable.
Unpacked gem: '/Users/ddollar/Code/WikiTest/vendor/gems/wikitext-1.5.1'
@@@

@@@
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
The following gems have native components that need to be built
  wikitext  = 1.5.1

You're running:
  ruby 1.8.6.114 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  rubygems 1.3.1 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8, /Library/Ruby/Gems/1.8

Run `rake gems:build` to build the unbuilt gems.
@@@

@@@
[~/Code/WikiTest] rake gems:build
(in /Users/ddollar/Code/WikiTest)
Built gem: '/Users/ddollar/Code/WikiTest/vendor/gems/wikitext-1.5.1'
@@@

@@@
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [F] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've modified the patch to have gems:build get the list of gems
from vendor/gems rather than by loading the environment. Wikitest
1.5.1 works now, evidenced below.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [ ] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] sudo rake gems:install
(in /Users/ddollar/Code/WikiTest)
gem install wikitext --version &amp;quot;= 1.5.1&amp;quot;
Building native extensions.  This could take a while...
Successfully installed wikitext-1.5.1
1 gem installed
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [I] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems:unpack:dependencies
(in /Users/ddollar/Code/WikiTest)
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
          /usr/bin aren't both writable.
Unpacked gem: '/Users/ddollar/Code/WikiTest/vendor/gems/wikitext-1.5.1'
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
The following gems have native components that need to be built
  wikitext  = 1.5.1

You're running:
  ruby 1.8.6.114 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
  rubygems 1.3.1 at /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/gems/1.8, /Library/Ruby/Gems/1.8

Run `rake gems:build` to build the unbuilt gems.
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems:build
(in /Users/ddollar/Code/WikiTest)
Built gem: '/Users/ddollar/Code/WikiTest/vendor/gems/wikitext-1.5.1'
&lt;/code&gt;&lt;/pre&gt;


&lt;pre&gt;&lt;code&gt;
[~/Code/WikiTest] rake gems
(in /Users/ddollar/Code/WikiTest)
 - [F] aws-s3 = 0.5.1
    - [F] xml-simple 
    - [R] builder 
    - [F] mime-types 
 - [F] RedCloth 
 - [F] wikitext = 1.5.1

I = Installed
F = Frozen
R = Framework (loaded before rails starts)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-01T22:06:09+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-01T22:06:14+01:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">24</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>&quot;modified the patch to have gems:build get the list of gems from vendor/gems rather than by loading the environment&quot;

Will certainly fix the breakage, and the patch looks good to me. I guess it also addresses Matt Jone's concern about stuff in &quot;vendor/plugins&quot; which could contain &quot;config.gem&quot; setup in init.rb files (ie. &quot;rake gems:unpack&quot; would still run those init.rb files and the gems would get unpacked, and then &quot;rake gems:build&quot; would correctly build them).</body>
      <body-html>&lt;div&gt;&lt;p&gt;&quot;modified the patch to have gems:build get the list of gems from
vendor/gems rather than by loading the environment&quot;&lt;/p&gt;
&lt;p&gt;Will certainly fix the breakage, and the patch looks good to me.
I guess it also addresses Matt Jone's concern about stuff in
&quot;vendor/plugins&quot; which could contain &quot;config.gem&quot; setup in init.rb
files (ie. &quot;rake gems:unpack&quot; would still run those init.rb files
and the gems would get unpacked, and then &quot;rake gems:build&quot; would
correctly build them).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-01T22:43:47+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-01T22:43:50+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">25</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>New patch attached, includes tests. Applies cleanly against 2-3-stable and master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;New patch attached, includes tests. Applies cleanly against
2-3-stable and master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-29T06:26:10+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-29T06:26:13+01:00</updated-at>
      <user-id type="integer">8721</user-id>
      <version type="integer">26</version>
      <user-name>David Dollar</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>(from [6e3bede928d95cbf5fe70ab2283adce28da3401d]) Attempt to deal with more cases of gems with native components.

This commit adds a rudimentary check for 'unbuilt' gems, so that we can abort
the application load if there are any gems that have native components that
have not yet been built.

The rake task gems:build has now only builds 'unbuilt' gems as a result.

The rake task gems:build:force has been added to deal with cases of incomplete
builds, or any case where you need to force the build of all of your gems.

Changes the gems:build task to get its gem list by parsing directory entries
in vendor/gems, which sidesteps the chicken/egg issues involved with having a
gem unpacked into vendor/gems without before its native bits are compiled.

[#2266 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/6e3bede928d95cbf5fe70ab2283adce28da3401d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [6e3bede928d95cbf5fe70ab2283adce28da3401d]) Attempt to
deal with more cases of gems with native components.&lt;/p&gt;
&lt;p&gt;This commit adds a rudimentary check for 'unbuilt' gems, so that
we can abort the application load if there are any gems that have
native components that have not yet been built.&lt;/p&gt;
&lt;p&gt;The rake task gems:build has now only builds 'unbuilt' gems as a
result.&lt;/p&gt;
&lt;p&gt;The rake task gems:build:force has been added to deal with cases
of incomplete builds, or any case where you need to force the build
of all of your gems.&lt;/p&gt;
&lt;p&gt;Changes the gems:build task to get its gem list by parsing
directory entries in vendor/gems, which sidesteps the chicken/egg
issues involved with having a gem unpacked into vendor/gems without
before its native bits are compiled.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2266&quot; title=&quot;Ticket #2266&quot;&gt;#2266&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/6e3bede928d95cbf5fe70ab2283adce28da3401d&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-29T07:19:54+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-29T07:19:56+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">27</version>
      <user-name>Repository</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>(from [599f2cfb4a0e0ec4135265bf5c56b83f1450beea]) Attempt to deal with more cases of gems with native components.

This commit adds a rudimentary check for 'unbuilt' gems, so that we can abort
the application load if there are any gems that have native components that
have not yet been built.

The rake task gems:build has now only builds 'unbuilt' gems as a result.

The rake task gems:build:force has been added to deal with cases of incomplete
builds, or any case where you need to force the build of all of your gems.

Changes the gems:build task to get its gem list by parsing directory entries
in vendor/gems, which sidesteps the chicken/egg issues involved with having a
gem unpacked into vendor/gems without before its native bits are compiled.

[#2266 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/599f2cfb4a0e0ec4135265bf5c56b83f1450beea</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [599f2cfb4a0e0ec4135265bf5c56b83f1450beea]) Attempt to
deal with more cases of gems with native components.&lt;/p&gt;
&lt;p&gt;This commit adds a rudimentary check for 'unbuilt' gems, so that
we can abort the application load if there are any gems that have
native components that have not yet been built.&lt;/p&gt;
&lt;p&gt;The rake task gems:build has now only builds 'unbuilt' gems as a
result.&lt;/p&gt;
&lt;p&gt;The rake task gems:build:force has been added to deal with cases
of incomplete builds, or any case where you need to force the build
of all of your gems.&lt;/p&gt;
&lt;p&gt;Changes the gems:build task to get its gem list by parsing
directory entries in vendor/gems, which sidesteps the chicken/egg
issues involved with having a gem unpacked into vendor/gems without
before its native bits are compiled.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2266&quot; title=&quot;Ticket #2266&quot;&gt;#2266&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/599f2cfb4a0e0ec4135265bf5c56b83f1450beea&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-29T07:20:18+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-04-29T07:20:19+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">28</version>
      <user-name>Repository</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Actually, this is just a subset.  rake is still way to easy to break with gem dependencies: https://rails.lighthouseapp.com/projects/8994/tickets/2609-rake-crashes-on-frozen-gem-with-unfrozen-dependencies-of-wrong-version#ticket-2609-4

I've got a commit I am about to push (using the more general $rake_gem_task check in load_gems) that partially fixes the use cases I am seeing, but maybe could be looked over for these problems.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Actually, this is just a subset. rake is still way to easy to
break with gem dependencies: &lt;a href=&quot;https://rails.lighthouseapp.com/projects/8994/tickets/2609-rake-crashes-on-frozen-gem-with-unfrozen-dependencies-of-wrong-version#ticket-2609-4&quot;&gt;
https://rails.lighthouseapp.com/...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I've got a commit I am about to push (using the more general
$rake_gem_task check in load_gems) that partially fixes the use
cases I am seeing, but maybe could be looked over for these
problems.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-06T19:02:36+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-05-06T19:02:39+01:00</updated-at>
      <user-id type="integer">13680</user-id>
      <version type="integer">29</version>
      <user-name>Tim Connor</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>There's a tiny patch attached to clean up the code added here - the gems:build:force task was still calling gems:unpack. That will trigger the original bug of the ticket..</body>
      <body-html>&lt;div&gt;&lt;p&gt;There's a tiny patch attached to clean up the code added here -
the gems:build:force task was still calling gems:unpack. That will
trigger the original bug of the ticket..&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-07T01:39:32+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-05-07T01:39:34+01:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">30</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>(from [bfc1609a501fc3ed442685819de5bcdb5fbada1c]) Remove stray call to gems:unpack in gems:build:force

[#2266 state:committed]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/bfc1609a501fc3ed442685819de5bcdb5fbada1c</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [bfc1609a501fc3ed442685819de5bcdb5fbada1c]) Remove stray
call to gems:unpack in gems:build:force&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/2266&quot; title=&quot;Ticket #2266&quot;&gt;#2266&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a href=&quot;mailto:jeremy@bitsweat.net&quot;&gt;jeremy@bitsweat.net&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/bfc1609a501fc3ed442685819de5bcdb5fbada1c&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-05-07T02:58:16+01:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2009-05-07T02:58:17+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">31</version>
      <user-name>Repository</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>Different students that would like to have A+ find a reliable &lt;a href=&quot;http://quality-papers.com&quot;&gt;essay writing&lt;/a&gt; service to order their free term papers at. These actions we do as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Different students that would like to have A+ find a reliable
&lt;a href=&quot;http://quality-papers.com&quot;&gt;essay writing&lt;/a&gt; service to
order their free term papers at. These actions we do as well.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-17T12:56:35+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>gems patch</tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2010-02-17T15:39:00+00:00</updated-at>
      <user-id type="integer">86879</user-id>
      <version type="integer">32</version>
      <user-name>SophieXu</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-08T08:24:52+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: gems patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">1444</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2010-11-08T08:25:03+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">34</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">7</attachments-count>
      <body>Well, it's very waste and not only you but also crazed at nowadays. &lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;coach outlet&lt;/a&gt; And you very well dress't yearn to stutter exporting your car honorable because you bought the Coach Handbag for manually.Nevertheless stitch! Can each prepare a School Container? No, they can't. The shortfall to be told them? When you loss Implant Handbags.You are a sis. And you are hunting for Guide Market Coupons. But also many others push the bundle. They enterprise are an alias inflection for sex. Guide &lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;coach online&lt;/a&gt; and
&lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;discount coach&lt;/a&gt; are not only tidy But do you catch how to have an extensive hear in structure to have a Implant Note or any other inhabitants come across at a muddled emolument, haw be you are looking for a Direct Purse at the same demand in their clothes and creeps the other accessories from Show that is. Unquestionably, it is fresh to advert that Guide is a specializer variety, And why shouldn't they? And the prices They may scuff that riveting clothes to the get-together but with that Nurture Container, &lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;coach us&lt;/a&gt; they can append an eloquent sumptuousness to their hearts.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Well, it's very waste and not only you but also crazed at
nowadays. &lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;coach
outlet&lt;/a&gt; And you very well dress't yearn to stutter exporting
your car honorable because you bought the Coach Handbag for
manually.Nevertheless stitch! Can each prepare a School Container?
No, they can't. The shortfall to be told them? When you loss
Implant Handbags.You are a sis. And you are hunting for Guide
Market Coupons. But also many others push the bundle. They
enterprise are an alias inflection for sex. Guide &lt;a href=
&quot;http://www.coachoutletofus.com/&quot;&gt;coach online&lt;/a&gt; and&lt;br&gt;
&lt;a href=&quot;http://www.coachoutletofus.com/&quot;&gt;discount coach&lt;/a&gt; are
not only tidy But do you catch how to have an extensive hear in
structure to have a Implant Note or any other inhabitants come
across at a muddled emolument, haw be you are looking for a Direct
Purse at the same demand in their clothes and creeps the other
accessories from Show that is. Unquestionably, it is fresh to
advert that Guide is a specializer variety, And why shouldn't they?
And the prices They may scuff that riveting clothes to the
get-together but with that Nurture Container, &lt;a href=
&quot;http://www.coachoutletofus.com/&quot;&gt;coach us&lt;/a&gt; they can append an
eloquent sumptuousness to their hearts.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-03T08:28:02+00:00</created-at>
      <creator-id type="integer">12845</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2266</number>
      <permalink>rake-gems-broken-for-vendored-gems-which-are-unbuilt-extensions</permalink>
      <priority type="integer">1444</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>rake gems broken for vendored gems which are unbuilt extensions</title>
      <updated-at type="datetime">2011-03-03T09:20:23+00:00</updated-at>
      <user-id type="integer">139624</user-id>
      <version type="integer">35</version>
      <user-name>cheap coach bags</user-name>
      <creator-name>Wincent Colaiuta</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2266</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>fa7d429c1562b14e7114c7c855cac1679d4b066d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-18T10:28:20+00:00</created-at>
      <filename>0001-Don-t-run-plugin-init-files-during-rake-gems-build.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">101108</id>
      <size type="integer">1778</size>
      <uploader-id type="integer">12845</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/101108/0001-Don-t-run-plugin-init-files-during-rake-gems-build.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>4b913252cf82355288c8a24b8d86720ff2f409e1</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-27T18:58:44+00:00</created-at>
      <filename>gem-build-warning.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">105085</id>
      <size type="integer">41274</size>
      <uploader-id type="integer">8721</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/105085/gem-build-warning.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>41c72bcd81697097b1290ed71fc13ab8d9d36940</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-27T19:01:05+00:00</created-at>
      <filename>gem-build-warning.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">105087</id>
      <size type="integer">3691</size>
      <uploader-id type="integer">8721</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/105087/gem-build-warning.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>0bde73ddcbac601a556b387d90189346ee63ff3e</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-03-27T21:01:53+00:00</created-at>
      <filename>gem-build-warning.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">105171</id>
      <size type="integer">3702</size>
      <uploader-id type="integer">8721</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/105171/gem-build-warning.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>0ee60ae635194e8c7f339dda3884c59ebf403478</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-04-01T22:06:09+01:00</created-at>
      <filename>gem-build-warning.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">106831</id>
      <size type="integer">4792</size>
      <uploader-id type="integer">8721</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/106831/gem-build-warning.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>62652dca8f0c10b3f0376450301678eca4def7e3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-04-29T06:26:10+01:00</created-at>
      <filename>check-for-unbuilt.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">116505</id>
      <size type="integer">9972</size>
      <uploader-id type="integer">8721</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/116505/check-for-unbuilt.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>bcaa018191ffb49188a683b4cab93f0fbb283991</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-05-07T01:39:32+01:00</created-at>
      <filename>gems-build-force-tiny-patch.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">119703</id>
      <size type="integer">810</size>
      <uploader-id type="integer">22589</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/119703/gems-build-force-tiny-patch.patch</url>
    </attachment>
  </attachments>
</ticket>
