<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-02-16T04:39:07+00:00</created-at>
  <creator-id type="integer">53265</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">3969</number>
  <permalink>responsecookies-empty-in-integration-test</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>cookies integration_test rails3</tag>
  <title>response.cookies empty in integration test</title>
  <updated-at type="datetime">2010-03-06T18:58:38+00:00</updated-at>
  <user-id type="integer">424</user-id>
  <version type="integer">5</version>
  <user-name>Joshua Peek</user-name>
  <creator-name>Don Werve</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
  <priority-name>Low</priority-name>
  <original-body>Integration test that worked on 2.3.5, now fails on 3.0.0.beta; this test needs to confirm that a cookie has been issued by a given controller, yet 'response.cookies' is a completely empty hash, no matter what I put in at the controller level.

Digging deeper, this appears to only effect cookies set via the new PermanentCookieJar, and quite possibly the SignedCookieJar.  

Looking at response.headers shows the cookies as being set, and throwing some puts() statements in at various points in the chain seems to show that only the standard cookie_jar is being hit for cookies.  Unfortunately, I've hit the end of my knowledge of Rails internals, and can't seem to find the bit where cookie_jar.write() is called, to update it so that it pulls from all cookie jars, not just the 'first' one.</original-body>
  <latest-body>Integration test that worked on 2.3.5, now fails on 3.0.0.beta; this test needs to confirm that a cookie has been issued by a given controller, yet 'response.cookies' is a completely empty hash, no matter what I put in at the controller level.

Digging deeper, this appears to only effect cookies set via the new PermanentCookieJar, and quite possibly the SignedCookieJar.  

Looking at response.headers shows the cookies as being set, and throwing some puts() statements in at various points in the chain seems to show that only the standard cookie_jar is being hit for cookies.  Unfortunately, I've hit the end of my knowledge of Rails internals, and can't seem to find the bit where cookie_jar.write() is called, to update it so that it pulls from all cookie jars, not just the 'first' one.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Integration test that worked on 2.3.5, now fails on 3.0.0.beta;
this test needs to confirm that a cookie has been issued by a given
controller, yet 'response.cookies' is a completely empty hash, no
matter what I put in at the controller level.&lt;/p&gt;
&lt;p&gt;Digging deeper, this appears to only effect cookies set via the
new PermanentCookieJar, and quite possibly the
SignedCookieJar.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looking at response.headers shows the cookies as being set, and
throwing some puts() statements in at various points in the chain
seems to show that only the standard cookie_jar is being hit for
cookies. Unfortunately, I've hit the end of my knowledge of Rails
internals, and can't seem to find the bit where cookie_jar.write()
is called, to update it so that it pulls from all cookie jars, not
just the 'first' one.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Integration test that worked on 2.3.5, now fails on 3.0.0.beta; this test needs to confirm that a cookie has been issued by a given controller, yet 'response.cookies' is a completely empty hash, no matter what I put in at the controller level.

Digging deeper, this appears to only effect cookies set via the new PermanentCookieJar, and quite possibly the SignedCookieJar.  

Looking at response.headers shows the cookies as being set, and throwing some puts() statements in at various points in the chain seems to show that only the standard cookie_jar is being hit for cookies.  Unfortunately, I've hit the end of my knowledge of Rails internals, and can't seem to find the bit where cookie_jar.write() is called, to update it so that it pulls from all cookie jars, not just the 'first' one.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Integration test that worked on 2.3.5, now fails on 3.0.0.beta;
this test needs to confirm that a cookie has been issued by a given
controller, yet 'response.cookies' is a completely empty hash, no
matter what I put in at the controller level.&lt;/p&gt;
&lt;p&gt;Digging deeper, this appears to only effect cookies set via the
new PermanentCookieJar, and quite possibly the
SignedCookieJar.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looking at response.headers shows the cookies as being set, and
throwing some puts() statements in at various points in the chain
seems to show that only the standard cookie_jar is being hit for
cookies. Unfortunately, I've hit the end of my knowledge of Rails
internals, and can't seem to find the bit where cookie_jar.write()
is called, to update it so that it pulls from all cookie jars, not
just the 'first' one.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-16T04:39:07+00:00</created-at>
      <creator-id type="integer">53265</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3969</number>
      <permalink>responsecookies-empty-in-integration-test</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookies integration_test rails3</tag>
      <title>response.cookies empty in integration test</title>
      <updated-at type="datetime">2010-02-16T04:39:09+00:00</updated-at>
      <user-id type="integer">53265</user-id>
      <version type="integer">1</version>
      <user-name>Don Werve</user-name>
      <creator-name>Don Werve</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-16T21:45:03+00:00</created-at>
      <creator-id type="integer">53265</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3969</number>
      <permalink>responsecookies-empty-in-integration-test</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookies integration_test rails3</tag>
      <title>response.cookies empty in integration test</title>
      <updated-at type="datetime">2010-02-16T21:45:07+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">2</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Don Werve</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Could you post some more info so we can try to reproduce?

This maybe a rack-test bug so you want to contact Bryan Helmkamp.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could you post some more info so we can try to reproduce?&lt;/p&gt;
&lt;p&gt;This maybe a rack-test bug so you want to contact Bryan
Helmkamp.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-19T15:50:29+00:00</created-at>
      <creator-id type="integer">53265</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 424
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3969</number>
      <permalink>responsecookies-empty-in-integration-test</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookies integration_test rails3</tag>
      <title>response.cookies empty in integration test</title>
      <updated-at type="datetime">2010-02-19T15:50:32+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">3</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Don Werve</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In the controller:

    def dosomething
        cookies['imacookie'] = 'foo'
        cookies.permanent['imapermanentcookie'] = 'bar'
    end

In the integration test:

     post('/controller/dosomething')

Inspecting 'response.cookies' in the integration test after this shows that 'imacookie' gets set, but 'imapermanentcookie' does not.  If I look at the full headers ('response.headers'), then I see 'imapermanentcookie'.

Rack-test bug?</body>
      <body-html>&lt;div&gt;&lt;p&gt;In the controller:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def dosomething
    cookies['imacookie'] = 'foo'
    cookies.permanent['imapermanentcookie'] = 'bar'
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In the integration test:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt; post('/controller/dosomething')&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Inspecting 'response.cookies' in the integration test after this
shows that 'imacookie' gets set, but 'imapermanentcookie' does not.
If I look at the full headers ('response.headers'), then I see
'imapermanentcookie'.&lt;/p&gt;
&lt;p&gt;Rack-test bug?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-02T02:10:48+00:00</created-at>
      <creator-id type="integer">53265</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3969</number>
      <permalink>responsecookies-empty-in-integration-test</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookies integration_test rails3</tag>
      <title>response.cookies empty in integration test</title>
      <updated-at type="datetime">2010-03-02T02:10:52+00:00</updated-at>
      <user-id type="integer">53265</user-id>
      <version type="integer">4</version>
      <user-name>Don Werve</user-name>
      <creator-name>Don Werve</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sounds like it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sounds like it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-03-06T18:58:35+00:00</created-at>
      <creator-id type="integer">53265</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3969</number>
      <permalink>responsecookies-empty-in-integration-test</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>cookies integration_test rails3</tag>
      <title>response.cookies empty in integration test</title>
      <updated-at type="datetime">2010-03-06T18:58:38+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Don Werve</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3969</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
