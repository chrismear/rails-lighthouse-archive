<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-06-25T03:03:36+01:00</created-at>
  <creator-id type="integer">643</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4963</number>
  <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag nil="true"></tag>
  <title>router doesn't accept conditions regexp with start of line/string char</title>
  <updated-at type="datetime">2010-06-26T00:52:17+01:00</updated-at>
  <user-id type="integer">643</user-id>
  <version type="integer">7</version>
  <user-name>Trevor Turk</user-name>
  <creator-name>Trevor Turk</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
  <priority-name>High</priority-name>
  <original-body>This gist should demonstrate the problem that I'm seeing:

http://gist.github.com/452280

I may be doing something wrong, but I believe this route constraint should be valid:

`:constraints =&gt; {:id =&gt; /^\d/}`

...but it crashes the app on boot. If I remove the `^` then it works fine. 

This regexp works in irb:

`'1-rick-roll-d' =~ /^\d/ =&gt; 0`
`'trevor' =~ /^\d/ =&gt; nil`

I'm trying to dig around and make a failing test case, but not sure I'll succeed...</original-body>
  <latest-body>This gist should demonstrate the problem that I'm seeing:

http://gist.github.com/452280

I may be doing something wrong, but I believe this route constraint should be valid:

`:constraints =&gt; {:id =&gt; /^\d/}`

...but it crashes the app on boot. If I remove the `^` then it works fine. 

This regexp works in irb:

`'1-rick-roll-d' =~ /^\d/ =&gt; 0`
`'trevor' =~ /^\d/ =&gt; nil`

I'm trying to dig around and make a failing test case, but not sure I'll succeed...</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;This gist should demonstrate the problem that I'm seeing:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://gist.github.com/452280&quot;&gt;http://gist.github.com/452280&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I may be doing something wrong, but I believe this route
constraint should be valid:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:constraints =&amp;gt; {:id =&amp;gt; /^\d/}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;...but it crashes the app on boot. If I remove the
&lt;code&gt;^&lt;/code&gt; then it works fine.&lt;/p&gt;
&lt;p&gt;This regexp works in irb:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;'1-rick-roll-d' =~ /^\d/ =&amp;gt; 0&lt;/code&gt; &lt;code&gt;'trevor' =~
/^\d/ =&amp;gt; nil&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I'm trying to dig around and make a failing test case, but not
sure I'll succeed...&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This gist should demonstrate the problem that I'm seeing:

http://gist.github.com/452280

I may be doing something wrong, but I believe this route constraint should be valid:

`:constraints =&gt; {:id =&gt; /^\d/}`

...but it crashes the app on boot. If I remove the `^` then it works fine. 

This regexp works in irb:

`'1-rick-roll-d' =~ /^\d/ =&gt; 0`
`'trevor' =~ /^\d/ =&gt; nil`

I'm trying to dig around and make a failing test case, but not sure I'll succeed...</body>
      <body-html>&lt;div&gt;&lt;p&gt;This gist should demonstrate the problem that I'm seeing:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://gist.github.com/452280&quot;&gt;http://gist.github.com/452280&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I may be doing something wrong, but I believe this route
constraint should be valid:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:constraints =&amp;gt; {:id =&amp;gt; /^\d/}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;...but it crashes the app on boot. If I remove the
&lt;code&gt;^&lt;/code&gt; then it works fine.&lt;/p&gt;
&lt;p&gt;This regexp works in irb:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;'1-rick-roll-d' =~ /^\d/ =&amp;gt; 0&lt;/code&gt; &lt;code&gt;'trevor' =~
/^\d/ =&amp;gt; nil&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I'm trying to dig around and make a failing test case, but not
sure I'll succeed...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T03:03:36+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T03:03:41+01:00</updated-at>
      <user-id type="integer">643</user-id>
      <version type="integer">1</version>
      <user-name>Trevor Turk</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am able to reproduce this case with rails edge.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am able to reproduce this case with rails edge.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T05:19:46+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T05:20:28+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">2</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks for the second pair of eyes. I think this might be a problem with:

http://github.com/josh/regin

So, I'm going to assign to Josh. My apologies if I'm misguided on this. Thank you!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for the second pair of eyes. I think this might be a
problem with:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/josh/regin&quot;&gt;http://github.com/josh/regin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So, I'm going to assign to Josh. My apologies if I'm misguided
on this. Thank you!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T05:40:34+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T05:40:40+01:00</updated-at>
      <user-id type="integer">643</user-id>
      <version type="integer">3</version>
      <user-name>Trevor Turk</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You can't use regexp anchors within routing constraints as the whole route is compiled into a larger regexp that begins with \A and may end with \Z (depending on the route spec). This is always been the case even in 2.3.x.

In your gist the route regexp would be compiled as /\A\/(?:&lt;id&gt;^\d)\Z/ which is a invalid regexp. Regin picks this up which is why it looks as though the problem is there.</body>
      <body-html>&lt;div&gt;&lt;p&gt;You can't use regexp anchors within routing constraints as the
whole route is compiled into a larger regexp that begins with \A
and may end with \Z (depending on the route spec). This is always
been the case even in 2.3.x.&lt;/p&gt;
&lt;p&gt;In your gist the route regexp would be compiled as
/\A\/(?:^\d)\Z/ which is a invalid regexp. Regin picks this up
which is why it looks as though the problem is there.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-25T06:56:08+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T06:56:14+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">4</version>
      <user-name>Andrew White</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Well, that's certainly a surprise! I thought that'd be a reasonable constraint. 

Is there any known workaround? In either case, I think this probably warrants some documentation mentioning that it's a known issue. I'm happy to take up the cause on that front. If anyone knows of a workaround, I'd rather include that than a caveat, though. I'll give it a day or two and work up a patch if nobody responds. 

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Well, that's certainly a surprise! I thought that'd be a
reasonable constraint.&lt;/p&gt;
&lt;p&gt;Is there any known workaround? In either case, I think this
probably warrants some documentation mentioning that it's a known
issue. I'm happy to take up the cause on that front. If anyone
knows of a workaround, I'd rather include that than a caveat,
though. I'll give it a day or two and work up a patch if nobody
responds.&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-25T07:02:20+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T07:02:26+01:00</updated-at>
      <user-id type="integer">643</user-id>
      <version type="integer">5</version>
      <user-name>Trevor Turk</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You don't need the anchor as all routes are anchored at the start. If what you're trying to do is to make sure that if the id param starts with an number then route it to the videos controller then this will work:

@@@ ruby
  match '/:id' =&gt; 'videos#show',
    :constraints =&gt; { :id =&gt; /\d+(?:-[-_a-zA-Z0-9]+)/ },
    :as =&gt; :video

  match '/:id' =&gt; 'users#show',
    :constraints =&gt; { :id =&gt; /[a-zA-Z].*/ },
    :as =&gt; :user
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;You don't need the anchor as all routes are anchored at the
start. If what you're trying to do is to make sure that if the id
param starts with an number then route it to the videos controller
then this will work:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  match '/:id' =&amp;gt; 'videos#show',
    :constraints =&amp;gt; { :id =&amp;gt; /\d+(?:-[-_a-zA-Z0-9]+)/ },
    :as =&amp;gt; :video

  match '/:id' =&amp;gt; 'users#show',
    :constraints =&amp;gt; { :id =&amp;gt; /[a-zA-Z].*/ },
    :as =&amp;gt; :user&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-25T08:11:12+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-25T08:11:18+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">6</version>
      <user-name>Andrew White</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks again, Andrew - that really helps. 

I'm adding to Neeraj's commit (thanks, BTW :)

http://github.com/lifo/docrails/commit/a2242a608e5c3057ec46ddffdd983d94780f90f6

...to show an example based on Andrew's suggestion:

http://github.com/lifo/docrails/commit/81e9627c7f4bad6007a5f8b5b7f5d50c9b28969c

Please feel free to change/remove/improve this, but I think something like it is worth having. 

I also wonder if might be worth providing a nicer error message in this case, if possible, since it's a known issue. 

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks again, Andrew - that really helps.&lt;/p&gt;
&lt;p&gt;I'm adding to Neeraj's commit (thanks, BTW :)&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/lifo/docrails/commit/a2242a608e5c3057ec46ddffdd983d94780f90f6&quot;&gt;
http://github.com/lifo/docrails/commit/a2242a608e5c3057ec46ddffdd98...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;...to show an example based on Andrew's suggestion:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/lifo/docrails/commit/81e9627c7f4bad6007a5f8b5b7f5d50c9b28969c&quot;&gt;
http://github.com/lifo/docrails/commit/81e9627c7f4bad6007a5f8b5b7f5...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Please feel free to change/remove/improve this, but I think
something like it is worth having.&lt;/p&gt;
&lt;p&gt;I also wonder if might be worth providing a nicer error message
in this case, if possible, since it's a known issue.&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-26T00:52:09+01:00</created-at>
      <creator-id type="integer">643</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4963</number>
      <permalink>router-doesnt-accept-conditions-regexp-with-start-of-linestring-char</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>router doesn't accept conditions regexp with start of line/string char</title>
      <updated-at type="datetime">2010-06-26T00:52:17+01:00</updated-at>
      <user-id type="integer">643</user-id>
      <version type="integer">7</version>
      <user-name>Trevor Turk</user-name>
      <creator-name>Trevor Turk</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4963</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
