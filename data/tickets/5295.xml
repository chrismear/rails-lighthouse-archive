<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-05T01:58:14+01:00</created-at>
  <creator-id type="integer">52024</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">5295</number>
  <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>rails3rc testing &quot;testing environment&quot;</tag>
  <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
  <updated-at type="datetime">2010-10-15T23:02:00+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">10</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Robert Pankowecki</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>Just run some application server with 'RAILS_ENV=test rails s' and click links. Sometimes it just does not start to process the request.
I can see in the log that the server received the request but nothing is happening.

I managed to create capybara test that just tries to clicks 40 links on a page that leads to the same page. The test works without a problem on rails3.beta4 but fails on rails3.rc because of the bug. I can submit the application with it so it is easy to repeat the bug.</original-body>
  <latest-body>Just run some application server with 'RAILS_ENV=test rails s' and click links. Sometimes it just does not start to process the request.
I can see in the log that the server received the request but nothing is happening.

I managed to create capybara test that just tries to clicks 40 links on a page that leads to the same page. The test works without a problem on rails3.beta4 but fails on rails3.rc because of the bug. I can submit the application with it so it is easy to repeat the bug.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Just run some application server with 'RAILS_ENV=test rails s'
and click links. Sometimes it just does not start to process the
request.&lt;br&gt;
I can see in the log that the server received the request but
nothing is happening.&lt;/p&gt;
&lt;p&gt;I managed to create capybara test that just tries to clicks 40
links on a page that leads to the same page. The test works without
a problem on rails3.beta4 but fails on rails3.rc because of the
bug. I can submit the application with it so it is easy to repeat
the bug.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Just run some application server with 'RAILS_ENV=test rails s' and click links. Sometimes it just does not start to process the request.
I can see in the log that the server received the request but nothing is happening.

I managed to create capybara test that just tries to clicks 40 links on a page that leads to the same page. The test works without a problem on rails3.beta4 but fails on rails3.rc because of the bug. I can submit the application with it so it is easy to repeat the bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just run some application server with 'RAILS_ENV=test rails s'
and click links. Sometimes it just does not start to process the
request.&lt;br&gt;
I can see in the log that the server received the request but
nothing is happening.&lt;/p&gt;
&lt;p&gt;I managed to create capybara test that just tries to clicks 40
links on a page that leads to the same page. The test works without
a problem on rails3.beta4 but fails on rails3.rc because of the
bug. I can submit the application with it so it is easy to repeat
the bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-04T13:03:35+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-04T13:03:38+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">1</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I traced my ruby process. It seems that one of them is waiting for some fmutex. (http://groups.google.com/group/ruby-capybara/browse_thread/thread/5a1a3e358f63533e). Is it possible that some semaphores logic works different in test env? Like for example guard/mutex used by loggers ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I traced my ruby process. It seems that one of them is waiting
for some fmutex. (&lt;a href=
&quot;http://groups.google.com/group/ruby-capybara/browse_thread/thread/5a1a3e358f63533e)&quot;&gt;http://groups.google.com/group/ruby-capybara/browse_thread/thread/5...&lt;/a&gt;.
Is it possible that some semaphores logic works different in test
env? Like for example guard/mutex used by loggers ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-04T13:15:45+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-04T13:15:46+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">2</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Last logs:

@@@
Started GET &quot;/models?i=14&quot; for 127.0.0.1 at 2010-08-04 16:16:57 +0200
  Processing by ModelsController#index as HTML
  Parameters: {&quot;i&quot;=&gt;&quot;14&quot;}
Rendered models/index.html.erb within layouts/application (5.8ms)
Completed 200 OK in 6ms (Views: 6.3ms | ActiveRecord: 0.0ms)


Started GET &quot;/models?i=8&quot; for 127.0.0.1 at 2010-08-04 16:16:58 +0200

@@@

Obviously the application stops working somewhere between writing &quot;Started GET&quot; and &quot;Processing by&quot;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Last logs:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Started GET &quot;/models?i=14&quot; for 127.0.0.1 at 2010-08-04 16:16:57 +0200
  Processing by ModelsController#index as HTML
  Parameters: {&quot;i&quot;=&amp;gt;&quot;14&quot;}
Rendered models/index.html.erb within layouts/application (5.8ms)
Completed 200 OK in 6ms (Views: 6.3ms | ActiveRecord: 0.0ms)


Started GET &quot;/models?i=8&quot; for 127.0.0.1 at 2010-08-04 16:16:58 +0200&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Obviously the application stops working somewhere between
writing &quot;Started GET&quot; and &quot;Processing by&quot;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-04T15:24:56+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-04T15:24:59+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">3</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I don't think I can reproduce this on master. I tried refreshing a lot of times but it didn't happen.

I can confirm that it does happen with RC. A simple scaffold will do. Just keep refreshing the /posts page, it should hang after 10-30 refreshes.

I wanted to try on 3-0-stable but I'm getting an error so I couldn't. The error here: http://pastie.org/1075273 The error has nothing to do with this ticket, but if it works on 3-0-stable then this issue might have been fixed along the way.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I don't think I can reproduce this on master. I tried refreshing
a lot of times but it didn't happen.&lt;/p&gt;
&lt;p&gt;I can confirm that it does happen with RC. A simple scaffold
will do. Just keep refreshing the /posts page, it should hang after
10-30 refreshes.&lt;/p&gt;
&lt;p&gt;I wanted to try on 3-0-stable but I'm getting an error so I
couldn't. The error here: &lt;a href=
&quot;http://pastie.org/1075273&quot;&gt;http://pastie.org/1075273&lt;/a&gt; The error
has nothing to do with this ticket, but if it works on 3-0-stable
then this issue might have been fixed along the way.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-04T17:08:16+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-04T17:10:38+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">4</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I spent 6 hours today trying to find out something about this bug but I could not find anything useful. I can try tomorrow (CET) to use master and see how it works for me. Can you provide any guess about why it might be happening on RC ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I spent 6 hours today trying to find out something about this
bug but I could not find anything useful. I can try tomorrow (CET)
to use master and see how it works for me. Can you provide any
guess about why it might be happening on RC ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-04T20:05:06+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-04T20:05:08+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">5</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can confirm that it does happen on 3-0-stable also.

Steps to reproduce:

* Bundle 3-0-stable
* Create a scaffold Post
* RAILS_ENV=test rake db:migrate
* RAILS_ENV bundle exec rails s
* keep refreshing /posts, it should hang after 10-30 refreshes</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that it does happen on 3-0-stable also.&lt;/p&gt;
&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bundle 3-0-stable&lt;/li&gt;
&lt;li&gt;Create a scaffold Post&lt;/li&gt;
&lt;li&gt;RAILS_ENV=test rake db:migrate&lt;/li&gt;
&lt;li&gt;RAILS_ENV bundle exec rails s&lt;/li&gt;
&lt;li&gt;keep refreshing /posts, it should hang after 10-30
refreshes&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-05T01:58:14+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-05T06:45:54+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">6</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:34+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-08-30T04:10:34+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>My capybara tests stared to running fine again on Rails 3.0.0 so I can say that is not reproducible for me now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;My capybara tests stared to running fine again on Rails 3.0.0 so
I can say that is not reproducible for me now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-04T22:13:55+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-09-04T22:13:58+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">8</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-09-04T22:30:40+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-09-04T22:30:41+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">9</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:02:00+01:00</created-at>
      <creator-id type="integer">52024</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5295</number>
      <permalink>rails3-rc-application-hangs-randomly-when-server-running-in-test-environment</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>rails3rc testing &quot;testing environment&quot;</tag>
      <title>Rails3 RC - Application hangs randomly when server running in test environment</title>
      <updated-at type="datetime">2010-10-15T23:02:00+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">10</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Robert Pankowecki</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5295</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
