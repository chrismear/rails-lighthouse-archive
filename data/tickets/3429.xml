<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">8406</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-10-26T21:56:43+00:00</created-at>
  <creator-id type="integer">17264</creator-id>
  <milestone-due-on type="datetime">2010-01-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">50064</milestone-id>
  <number type="integer">3429</number>
  <permalink>autosave-assocation-needlessly-uses-eval</permalink>
  <priority type="integer">167166</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
  <title>Autosave Assocation Needlessly Uses eval()</title>
  <updated-at type="datetime">2010-01-07T19:32:24+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">8</version>
  <user-name>Repository</user-name>
  <creator-name>Comron Sattari</creator-name>
  <assigned-user-name>Eloy Duran</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
  <milestone-title>2.3.6</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>The blog post at http://blog.pluron.com/2008/02/rails-faster-as.html talks about using String based callbacks in ActiveRecord and how they affect performance through usage of eval() and Kernel.binding. This has been patched in Rails

However I recently found that autosave_association.rb can make use of a similar patch, which I have attached.</original-body>
  <latest-body>The blog post at http://blog.pluron.com/2008/02/rails-faster-as.html talks about using String based callbacks in ActiveRecord and how they affect performance through usage of eval() and Kernel.binding. This has been patched in Rails

However I recently found that autosave_association.rb can make use of a similar patch, which I have attached.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;The blog post at &lt;a href=
&quot;http://blog.pluron.com/2008/02/rails-faster-as.html&quot;&gt;http://blog.pluron.com/2008/02/rails-faster-as.html&lt;/a&gt;
talks about using String based callbacks in ActiveRecord and how
they affect performance through usage of eval() and Kernel.binding.
This has been patched in Rails&lt;/p&gt;
&lt;p&gt;However I recently found that autosave_association.rb can make
use of a similar patch, which I have attached.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The blog post at http://blog.pluron.com/2008/02/rails-faster-as.html talks about using String based callbacks in ActiveRecord and how they affect performance through usage of eval() and Kernel.binding. This has been patched in Rails

However I recently found that autosave_association.rb can make use of a similar patch, which I have attached.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The blog post at &lt;a href=
&quot;http://blog.pluron.com/2008/02/rails-faster-as.html&quot;&gt;http://blog.pluron.com/2008/02/rails-faster-as.html&lt;/a&gt;
talks about using String based callbacks in ActiveRecord and how
they affect performance through usage of eval() and Kernel.binding.
This has been patched in Rails&lt;/p&gt;
&lt;p&gt;However I recently found that autosave_association.rb can make
use of a similar patch, which I have attached.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-10-26T21:56:43+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2009-10-26T21:56:47+00:00</updated-at>
      <user-id type="integer">17264</user-id>
      <version type="integer">1</version>
      <user-name>Comron Sattari</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-30T19:38:13+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2009-12-30T19:38:14+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">2</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>It's true that evaling a string should be avoided. However, the strings your patch touches are not being evaled. There's only one place in autosave_association.rb that uses eval, module_eval actually, which isn't bad because it's used to define a method, which is faster than using define_method and ok in this case. HTH</body>
      <body-html>&lt;div&gt;&lt;p&gt;It's true that evaling a string should be avoided. However, the
strings your patch touches are not being evaled. There's only one
place in autosave_association.rb that uses eval, module_eval
actually, which isn't bad because it's used to define a method,
which is faster than using define_method and ok in this case.
HTH&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-12-31T11:01:09+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2009-12-31T11:01:10+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">3</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I should have been clearer, it is the callback chain that uses the evel. In this case, after_create, after_update and validate all add these strings to the callback chain, and then evaluate_method in callbacks.rb uses eval() in the callback is a string, and send if it is a symbol. I found the problem while profiling my app.

Please let me know if I'm misunderstanding something.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I should have been clearer, it is the callback chain that uses
the evel. In this case, after_create, after_update and validate all
add these strings to the callback chain, and then evaluate_method
in callbacks.rb uses eval() in the callback is a string, and send
if it is a symbol. I found the problem while profiling my app.&lt;/p&gt;
&lt;p&gt;Please let me know if I'm misunderstanding something.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-12-31T16:15:19+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2009-12-31T16:15:20+00:00</updated-at>
      <user-id type="integer">17264</user-id>
      <version type="integer">4</version>
      <user-name>Comron Sattari</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Ah yes, you're right. Will fix! Thanks for the update :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ah yes, you're right. Will fix! Thanks for the update :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-31T16:23:31+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2009-12-31T16:23:33+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">5</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-07T16:24:56+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2010-01-07T16:25:00+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">6</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [f866ced24ac9cdece7801f50ec79cdbe3ff5ad59]) Don't use strings for callbacks, as these will be evaled. Rather use symbols, which uses a direct method dispatch.

Patch by Comron Sattari. [#3429 state:resolved]
http://github.com/rails/rails/commit/f866ced24ac9cdece7801f50ec79cdbe3ff5ad59</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f866ced24ac9cdece7801f50ec79cdbe3ff5ad59&quot;
title=
&quot;Changeset [f866ced24ac9cdece7801f50ec79cdbe3ff5ad59]&quot;&gt;[f866ced24ac9cdece7801f50ec79cdbe3ff5ad59]&lt;/a&gt;)
Don't use strings for callbacks, as these will be evaled. Rather
use symbols, which uses a direct method dispatch.&lt;/p&gt;
&lt;p&gt;Patch by Comron Sattari. [&lt;a href=&quot;/projects/8994/tickets/3429&quot;
title=&quot;Ticket #3429&quot;&gt;#3429&lt;/a&gt; state:resolved]&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/f866ced24ac9cdece7801f50ec79cdbe3ff5ad59&quot;&gt;
http://github.com/rails/rails/commit/f866ced24ac9cdece7801f50ec79cd...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-01-07T19:15:01+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- 
:state: verified
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2010-01-07T19:15:02+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">7</version>
      <user-name>Repository</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">8406</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [4b7a439bd17e6d9e8567758ee6a0da13447c3229]) Don't use strings for callbacks, as these will be evaled. Rather use symbols, which uses a direct method dispatch.

Patch by Comron Sattari. [#3429 state:resolved]
http://github.com/rails/rails/commit/4b7a439bd17e6d9e8567758ee6a0da13447c3229</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/4b7a439bd17e6d9e8567758ee6a0da13447c3229&quot;
title=
&quot;Changeset [4b7a439bd17e6d9e8567758ee6a0da13447c3229]&quot;&gt;[4b7a439bd17e6d9e8567758ee6a0da13447c3229]&lt;/a&gt;)
Don't use strings for callbacks, as these will be evaled. Rather
use symbols, which uses a direct method dispatch.&lt;/p&gt;
&lt;p&gt;Patch by Comron Sattari. [&lt;a href=&quot;/projects/8994/tickets/3429&quot;
title=&quot;Ticket #3429&quot;&gt;#3429&lt;/a&gt; state:resolved]&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/4b7a439bd17e6d9e8567758ee6a0da13447c3229&quot;&gt;
http://github.com/rails/rails/commit/4b7a439bd17e6d9e8567758ee6a0da...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-01-07T19:32:21+00:00</created-at>
      <creator-id type="integer">17264</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3429</number>
      <permalink>autosave-assocation-needlessly-uses-eval</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.3.3 active_record autosave callback callbacks memory performance</tag>
      <title>Autosave Assocation Needlessly Uses eval()</title>
      <updated-at type="datetime">2010-01-07T19:32:24+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">8</version>
      <user-name>Repository</user-name>
      <creator-name>Comron Sattari</creator-name>
      <assigned-user-name>Eloy Duran</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3429</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>96b332b1ee94813884c4115101928798b511f8a1</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-10-26T21:56:46+00:00</created-at>
      <filename>autosave.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">305500</id>
      <size type="integer">811</size>
      <uploader-id type="integer">17264</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/305500/autosave.diff</url>
    </attachment>
  </attachments>
</ticket>
