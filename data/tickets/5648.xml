<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-10-02T10:47:02+01:00</created-at>
  <creator-id type="integer">116295</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">5648</number>
  <permalink>after_filter-not-halted</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>after_filter not halted</title>
  <updated-at type="datetime">2010-11-11T16:23:33+00:00</updated-at>
  <user-id type="integer">40263</user-id>
  <version type="integer">19</version>
  <user-name>Neeraj Singh</user-name>
  <creator-name>Buts Johan</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body># Expected behavior: #

When a before filter render or redirects the action itself and after filters should not be executed.

# Wrong behavior: #

After filter gets executed although the before filter rendered or redirected.

# Example: #

In following application_controller.rb ...

@@@ ruby
class ApplicationController &lt; ActionController::Base

  before_filter :do_before
  after_filter  :do_after

  def should_halt
    Rails.logger.debug &quot;Executed: should_halt&quot;
    render :text =&gt; 'not halted'
  end

  def do_before
    Rails.logger.debug &quot;Executed: do_before&quot;
    render :text =&gt; 'before'
  end

  def do_after
    Rails.logger.debug &quot;Executed: do_after&quot;
  end

end
@@@

expected debug output should be: 

@@@ 
Executed: do_before
@@@

but was

@@@
Executed: do_before
Executed: do_after
@@@

# Note: #

Rails 2.0 documentation indicated that after filters should not get called when before filters returned false, rendered or redirected. The current rails documentation (3.0) does not document the behavior of the controller callbacks. Either indicate that the behavior has changed or that this bug needs to be fixed.</original-body>
  <latest-body># Expected behavior: #

When a before filter render or redirects the action itself and after filters should not be executed.

# Wrong behavior: #

After filter gets executed although the before filter rendered or redirected.

# Example: #

In following application_controller.rb ...

@@@ ruby
class ApplicationController &lt; ActionController::Base

  before_filter :do_before
  after_filter  :do_after

  def should_halt
    Rails.logger.debug &quot;Executed: should_halt&quot;
    render :text =&gt; 'not halted'
  end

  def do_before
    Rails.logger.debug &quot;Executed: do_before&quot;
    render :text =&gt; 'before'
  end

  def do_after
    Rails.logger.debug &quot;Executed: do_after&quot;
  end

end
@@@

expected debug output should be: 

@@@ 
Executed: do_before
@@@

but was

@@@
Executed: do_before
Executed: do_after
@@@

# Note: #

Rails 2.0 documentation indicated that after filters should not get called when before filters returned false, rendered or redirected. The current rails documentation (3.0) does not document the behavior of the controller callbacks. Either indicate that the behavior has changed or that this bug needs to be fixed.</latest-body>
  <original-body-html>&lt;div&gt;&lt;h1&gt;Expected behavior:&lt;/h1&gt;
&lt;p&gt;When a before filter render or redirects the action itself and
after filters should not be executed.&lt;/p&gt;
&lt;h1&gt;Wrong behavior:&lt;/h1&gt;
&lt;p&gt;After filter gets executed although the before filter rendered
or redirected.&lt;/p&gt;
&lt;h1&gt;Example:&lt;/h1&gt;
&lt;p&gt;In following application_controller.rb ...&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;class ApplicationController &amp;lt; ActionController::Base

  before_filter :do_before
  after_filter  :do_after

  def should_halt
    Rails.logger.debug &quot;Executed: should_halt&quot;
    render :text =&amp;gt; 'not halted'
  end

  def do_before
    Rails.logger.debug &quot;Executed: do_before&quot;
    render :text =&amp;gt; 'before'
  end

  def do_after
    Rails.logger.debug &quot;Executed: do_after&quot;
  end

end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;expected debug output should be:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Executed: do_before&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but was&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Executed: do_before
Executed: do_after&lt;/code&gt;
&lt;/pre&gt;
&lt;h1&gt;Note:&lt;/h1&gt;
&lt;p&gt;Rails 2.0 documentation indicated that after filters should not
get called when before filters returned false, rendered or
redirected. The current rails documentation (3.0) does not document
the behavior of the controller callbacks. Either indicate that the
behavior has changed or that this bug needs to be fixed.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body># Expected behavior: #

When a before filter render or redirects the action itself and after filters should not be executed.

# Wrong behavior: #

After filter gets executed although the before filter rendered or redirected.

# Example: #

In following application_controller.rb ...

@@@ ruby
class ApplicationController &lt; ActionController::Base

  before_filter :do_before
  after_filter  :do_after

  def should_halt
    Rails.logger.debug &quot;Executed: should_halt&quot;
    render :text =&gt; 'not halted'
  end

  def do_before
    Rails.logger.debug &quot;Executed: do_before&quot;
    render :text =&gt; 'before'
  end

  def do_after
    Rails.logger.debug &quot;Executed: do_after&quot;
  end

end
@@@

expected debug output should be: 

@@@ 
Executed: do_before
@@@

but was

@@@
Executed: do_before
Executed: do_after
@@@

# Note: #

Rails 2.0 documentation indicated that after filters should not get called when before filters returned false, rendered or redirected. The current rails documentation (3.0) does not document the behavior of the controller callbacks. Either indicate that the behavior has changed or that this bug needs to be fixed.</body>
      <body-html>&lt;div&gt;&lt;h1&gt;Expected behavior:&lt;/h1&gt;
&lt;p&gt;When a before filter render or redirects the action itself and
after filters should not be executed.&lt;/p&gt;
&lt;h1&gt;Wrong behavior:&lt;/h1&gt;
&lt;p&gt;After filter gets executed although the before filter rendered
or redirected.&lt;/p&gt;
&lt;h1&gt;Example:&lt;/h1&gt;
&lt;p&gt;In following application_controller.rb ...&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;class ApplicationController &amp;lt; ActionController::Base

  before_filter :do_before
  after_filter  :do_after

  def should_halt
    Rails.logger.debug &quot;Executed: should_halt&quot;
    render :text =&amp;gt; 'not halted'
  end

  def do_before
    Rails.logger.debug &quot;Executed: do_before&quot;
    render :text =&amp;gt; 'before'
  end

  def do_after
    Rails.logger.debug &quot;Executed: do_after&quot;
  end

end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;expected debug output should be:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Executed: do_before&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;but was&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Executed: do_before
Executed: do_after&lt;/code&gt;
&lt;/pre&gt;
&lt;h1&gt;Note:&lt;/h1&gt;
&lt;p&gt;Rails 2.0 documentation indicated that after filters should not
get called when before filters returned false, rendered or
redirected. The current rails documentation (3.0) does not document
the behavior of the controller callbacks. Either indicate that the
behavior has changed or that this bug needs to be fixed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-17T13:39:06+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack after_filter before_filter callbacks chain &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-09-17T13:39:09+01:00</updated-at>
      <user-id type="integer">116295</user-id>
      <version type="integer">1</version>
      <user-name>Buts Johan</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm seeing and expecting the same behaviour. I'm noticing that the compiled callback does not put any conditions on an after filter. 

@@@ ruby
_conditional_callback_around_21(halted) do
  unless halted
    result = do_before
    halted = (response_body)
  end

  value = yield if block_given? &amp;&amp; !halted
  do_after
end
halted ? false : (block_given? ? value : true)
@@@

I'm expecting that the last compiled line should be used as a condition on the &quot;do_after&quot; call. 

When adding a :if statement to the after_filter the output slightly changes on the last lines:

@@@ ruby
  if _callback_after_21(self)
    do_after
  end
end
halted ? false : (block_given? ? value : true)
@@@

It seems to me that the last line should be included in the condition.

@@@ ruby
  if (halted ? false : (block_given? ? value : true)) &amp;&amp; _callback_after_21(self)
    do_after
  end
end
@@@

@@@ ruby
  if halted ? false : (block_given? ? value : true)
    do_after
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm seeing and expecting the same behaviour. I'm noticing that
the compiled callback does not put any conditions on an after
filter.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;_conditional_callback_around_21(halted) do
  unless halted
    result = do_before
    halted = (response_body)
  end

  value = yield if block_given? &amp;amp;&amp;amp; !halted
  do_after
end
halted ? false : (block_given? ? value : true)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I'm expecting that the last compiled line should be used as a
condition on the &quot;do_after&quot; call.&lt;/p&gt;
&lt;p&gt;When adding a :if statement to the after_filter the output
slightly changes on the last lines:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  if _callback_after_21(self)
    do_after
  end
end
halted ? false : (block_given? ? value : true)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;It seems to me that the last line should be included in the
condition.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;  if (halted ? false : (block_given? ? value : true)) &amp;amp;&amp;amp; _callback_after_21(self)
    do_after
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;  if halted ? false : (block_given? ? value : true)
    do_after
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-17T13:57:28+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack after_filter before_filter callbacks chain &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-09-17T13:57:29+01:00</updated-at>
      <user-id type="integer">17424</user-id>
      <version type="integer">2</version>
      <user-name>Bertg</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Surprised to see no response. Thinking this would be quite a serious issue...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Surprised to see no response. Thinking this would be quite a
serious issue...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-30T17:29:59+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack after_filter before_filter callbacks chain &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-09-30T17:30:05+01:00</updated-at>
      <user-id type="integer">17424</user-id>
      <version type="integer">3</version>
      <user-name>Bertg</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi Bertg,

I agree with you, I would expect Rails 3 to inherit the behavior of Rails 2.3.x filters. 

For that, I've wrote tests and patch to make it work as you suggested.

BTW: This patch applies cleanly on master now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Bertg,&lt;/p&gt;
&lt;p&gt;I agree with you, I would expect Rails 3 to inherit the behavior
of Rails 2.3.x filters.&lt;/p&gt;
&lt;p&gt;For that, I've wrote tests and patch to make it work as you
suggested.&lt;/p&gt;
&lt;p&gt;BTW: This patch applies cleanly on master now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-03T04:51:56+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: actionpack after_filter before_filter callbacks chain &quot;rails 3.0.0&quot;
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-03T04:51:58+01:00</updated-at>
      <user-id type="integer">33838</user-id>
      <version type="integer">4</version>
      <user-name>Marcelo Giorgi</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40272</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Interestingly I am not able to reproduce this error. I tested with rails edge. In both render :text and redirect_to cases the after_filter is not invoked.


Here is my test code

@@@ ruby
class UsersController &lt; ApplicationController

  before_filter :do_before
  after_filter  :do_after

  def do_before
    puts 'before &gt;&gt;&gt;' * 10
    #render :text =&gt; 'filter should be halted'
    redirect_to surveys_path
  end

  def do_after
    puts 'after &lt;&lt;&lt;' * 10
  end

  def index
    @users = User.all
  end

end
@@@

I'm sure I'm missing something. Not sure what? :-)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Interestingly I am not able to reproduce this error. I tested
with rails edge. In both render :text and redirect_to cases the
after_filter is not invoked.&lt;/p&gt;
&lt;p&gt;Here is my test code&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class UsersController &amp;lt; ApplicationController

  before_filter :do_before
  after_filter  :do_after

  def do_before
    puts 'before &amp;gt;&amp;gt;&amp;gt;' * 10
    #render :text =&amp;gt; 'filter should be halted'
    redirect_to surveys_path
  end

  def do_after
    puts 'after &amp;lt;&amp;lt;&amp;lt;' * 10
  end

  def index
    @users = User.all
  end

end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I'm sure I'm missing something. Not sure what? :-)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-03T10:40:43+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-03T10:40:45+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">5</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Santiago Pastorino</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey guys,

If this bug still exists, I would recommend to use a solution similar to the one in ActiveModel::Callbacks:

http://github.com/rails/rails/blob/master/activemodel/lib/active_model/callbacks.rb#L131

In other words, simple adding &quot;!halted&quot; as condition to :if in after_filter will fix the issue. I prefer this solution because AS::Callbacks is already too complex and adding another option will just make it worse.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey guys,&lt;/p&gt;
&lt;p&gt;If this bug still exists, I would recommend to use a solution
similar to the one in ActiveModel::Callbacks:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/blob/master/activemodel/lib/active_model/callbacks.rb#L131&quot;&gt;
http://github.com/rails/rails/blob/master/activemodel/lib/active_mo...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In other words, simple adding &quot;!halted&quot; as condition to :if in
after_filter will fix the issue. I prefer this solution because
AS::Callbacks is already too complex and adding another option will
just make it worse.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-03T13:00:37+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
:assigned_user: 40272
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-03T13:00:40+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">6</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hi Neeraj and Jose,

Neeraj, I run your code with rails edge and got the following output for this url http://localhost:3000/users:

before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;before &gt;&gt;&gt;
after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;after &lt;&lt;&lt;

So, for me it is reaching the after filter either when I redirect or render from the before_filter called do_before.

Jose, Yeah I agree, AS::Callbacks is complex enough. So, I wrote a new patch here.

Let me know what you think.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Neeraj and Jose,&lt;/p&gt;
&lt;p&gt;Neeraj, I run your code with rails edge and got the following
output for this url &lt;a href=
&quot;http://localhost:3000/users&quot;&gt;http://localhost:3000/users&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;before &amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before
&amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before
&amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before &amp;gt;&amp;gt;&amp;gt;before
&amp;gt;&amp;gt;&amp;gt;&lt;br&gt;
after &amp;lt;&amp;lt;&lt;/p&gt;
&lt;p&gt;So, for me it is reaching the after filter either when I
redirect or render from the before_filter called do_before.&lt;/p&gt;
&lt;p&gt;Jose, Yeah I agree, AS::Callbacks is complex enough. So, I wrote
a new patch here.&lt;/p&gt;
&lt;p&gt;Let me know what you think.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-03T15:34:56+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-03T15:34:59+01:00</updated-at>
      <user-id type="integer">33838</user-id>
      <version type="integer">7</version>
      <user-name>Marcelo Giorgi</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:02:03+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-15T23:02:03+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-16T02:28:25+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: actionpack after_filter before_filter callbacks chain patch &quot;rails 3.0.0&quot; &quot;sheepskin boots&quot;
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;actionpack after_filter before_filter callbacks chain patch rails 3.0.0&quot;</tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-16T02:28:32+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">10</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T08:35:59+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;actionpack after_filter before_filter callbacks chain patch rails 3.0.0\&quot;&quot;
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-19T08:36:02+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">12</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 having this issue with 3.0.1 application</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 having this issue with 3.0.1 application&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-22T11:58:44+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-22T11:58:46+01:00</updated-at>
      <user-id type="integer">43210</user-id>
      <version type="integer">13</version>
      <user-name>Evgeniy Dolzhenko</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Great, I will apply this patch in the following days.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Great, I will apply this patch in the following days.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-22T12:22:01+01:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-10-22T12:22:04+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">14</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I still can't reproduce this problem with rails edge.

I don't see boom in the following case.

@@@ ruby
class UsersController &lt; ApplicationController
  before_filter :f1
  before_filter :f2

  def f2
    raise 'boom'
  end

  def f1
    render :text =&gt; 'finished'
  end

  def index
    @users = User.all
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I still can't reproduce this problem with rails edge.&lt;/p&gt;
&lt;p&gt;I don't see boom in the following case.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class UsersController &amp;lt; ApplicationController
  before_filter :f1
  before_filter :f2

  def f2
    raise 'boom'
  end

  def f1
    render :text =&amp;gt; 'finished'
  end

  def index
    @users = User.all
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-11T15:48:48+00:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-11-11T15:48:54+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">15</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>It should be `after_filter :f2` not `before_filter :f2`</body>
      <body-html>&lt;div&gt;&lt;p&gt;It should be &lt;code&gt;after_filter :f2&lt;/code&gt; not
&lt;code&gt;before_filter :f2&lt;/code&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-11T15:55:39+00:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-11-11T15:55:43+00:00</updated-at>
      <user-id type="integer">43210</user-id>
      <version type="integer">16</version>
      <user-name>Evgeniy Dolzhenko</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [2bb1c202b48c4f1c8d81927fb3e5fc00806231f9]) Make after_filter halt when before_filter renders or redirects [#5648 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
https://github.com/rails/rails/commit/2bb1c202b48c4f1c8d81927fb3e5fc00806231f9</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/2bb1c202b48c4f1c8d81927fb3e5fc00806231f9&quot;
title=
&quot;Changeset [2bb1c202b48c4f1c8d81927fb3e5fc00806231f9]&quot;&gt;[2bb1c202b48c4f1c8d81927fb3e5fc00806231f9]&lt;/a&gt;)
Make after_filter halt when before_filter renders or redirects
[&lt;a href=&quot;/projects/8994/tickets/5648&quot; title=
&quot;Ticket #5648&quot;&gt;#5648&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;https://github.com/rails/rails/commit/2bb1c202b48c4f1c8d81927fb3e5fc00806231f9&quot;&gt;
https://github.com/rails/rails/commit/2bb1c202b48c4f1c8d81927fb3e5f...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-11T16:07:26+00:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-11-11T16:07:30+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">17</version>
      <user-name>Repository</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a]) Make after_filter halt when before_filter renders or redirects [#5648 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
https://github.com/rails/rails/commit/0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a&quot;
title=
&quot;Changeset [0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a]&quot;&gt;[0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a]&lt;/a&gt;)
Make after_filter halt when before_filter renders or redirects
[&lt;a href=&quot;/projects/8994/tickets/5648&quot; title=
&quot;Ticket #5648&quot;&gt;#5648&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;https://github.com/rails/rails/commit/0de95dfb2c99f188c5e4c98aa59f6e8f2736f70a&quot;&gt;
https://github.com/rails/rails/commit/0de95dfb2c99f188c5e4c98aa59f6...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-11T16:07:49+00:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-11-11T16:07:53+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">18</version>
      <user-name>Repository</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>My bad. Anyway it is committed now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;My bad. Anyway it is committed now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-11T16:23:23+00:00</created-at>
      <creator-id type="integer">116295</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5648</number>
      <permalink>after_filter-not-halted</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>after_filter not halted</title>
      <updated-at type="datetime">2010-11-11T16:23:33+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">19</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Buts Johan</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5648</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>a8a5688209ad54c76314bf34d211447e7a9f6500</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-10-03T04:51:56+01:00</created-at>
      <filename>after_filter-halts-when-before_filter-renders-redirects-or-returns-false.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">701986</id>
      <size type="integer">6267</size>
      <uploader-id type="integer">33838</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/701986/after_filter-halts-when-before_filter-renders-redirects-or-returns-false.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>9fb88bfae49ed549de36f43a0fd9265e049a480d</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-10-03T15:34:57+01:00</created-at>
      <filename>after_filter-halts-when-before_filter-renders-or-redirects.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">702093</id>
      <size type="integer">6314</size>
      <uploader-id type="integer">33838</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/702093/after_filter-halts-when-before_filter-renders-or-redirects.patch</url>
    </attachment>
  </attachments>
</ticket>
