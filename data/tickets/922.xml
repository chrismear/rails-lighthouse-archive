<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">5</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-08-28T04:32:42+01:00</created-at>
  <creator-id type="integer">10683</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">922</number>
  <permalink>has_many-through-transaction-rollback</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activerecord patch &quot;rails 3&quot;</tag>
  <title>has_many through transaction rollback</title>
  <updated-at type="datetime">2010-07-18T10:20:42+01:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">35</version>
  <user-name>Repository</user-name>
  <creator-name>2 College Bums</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
  <milestone-title>3.x</milestone-title>
  <priority-name>High</priority-name>
  <original-body>When saving a model that contains a has_many through association, the entire transaction fails to rollback when the validation fails. Specifically xxx_ids= should not modify the association unless all validations pass.

Example:
Let's assume we have a Paper model that contains a title attribute and a has_many through relationship with Categories. We validate to ensure a paper has at least one category and the title is not invalid.

If the title is invalid and the categories are empty and an &quot;update_attributes&quot; occurs even after the validation fails, all associations to categories are lost. The title is not updated as expected. Preferably, the association to categories would not be affected unless a save is successful.

@@@ ruby
a = Paper.first
a.categories # =&gt; [#category1, #category2]
a.update_attributes(:category_ids =&gt; [], :title =&gt; &quot;invalid&quot;) # =&gt; false
a.categories # =&gt; []
a.title # =&gt; &quot;invalid&quot; 
a.valid? # =&gt; false
a.errors.full_messages # =&gt; [&quot;title cannot be invalid&quot;, &quot;At least one category must be assigned&quot;]
a.reload
a.title # =&gt; &quot;Original&quot;
a.categories # =&gt; []
a.valid? # =&gt; false
@@@

There is a quick fix that doesn't completely solve the problem. In the model where the update_attributes occurs we can force a &quot;rollback&quot; using the following code:
@@@ ruby
  def update_attributes_with_rollback(*args)
    old_category_ids = self.category_ids
    saved_properly = update_attributes_without_rollback(*args)
    self.category_ids = old_category_ids unless saved_properly
    saved_properly
  end
  alias_method_chain :update_attributes, :rollback
@@@

Here are some resources which aided us and may help:
* http://giantrobots.thoughtbot.com/2008/8/19/pneumatic-cylinders
* http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes</original-body>
  <latest-body>When saving a model that contains a has_many through association, the entire transaction fails to rollback when the validation fails. Specifically xxx_ids= should not modify the association unless all validations pass.

Example:
Let's assume we have a Paper model that contains a title attribute and a has_many through relationship with Categories. We validate to ensure a paper has at least one category and the title is not invalid.

If the title is invalid and the categories are empty and an &quot;update_attributes&quot; occurs even after the validation fails, all associations to categories are lost. The title is not updated as expected. Preferably, the association to categories would not be affected unless a save is successful.

@@@ ruby
a = Paper.first
a.categories # =&gt; [#category1, #category2]
a.update_attributes(:category_ids =&gt; [], :title =&gt; &quot;invalid&quot;) # =&gt; false
a.categories # =&gt; []
a.title # =&gt; &quot;invalid&quot; 
a.valid? # =&gt; false
a.errors.full_messages # =&gt; [&quot;title cannot be invalid&quot;, &quot;At least one category must be assigned&quot;]
a.reload
a.title # =&gt; &quot;Original&quot;
a.categories # =&gt; []
a.valid? # =&gt; false
@@@

There is a quick fix that doesn't completely solve the problem. In the model where the update_attributes occurs we can force a &quot;rollback&quot; using the following code:
@@@ ruby
  def update_attributes_with_rollback(*args)
    old_category_ids = self.category_ids
    saved_properly = update_attributes_without_rollback(*args)
    self.category_ids = old_category_ids unless saved_properly
    saved_properly
  end
  alias_method_chain :update_attributes, :rollback
@@@

Here are some resources which aided us and may help:
* http://giantrobots.thoughtbot.com/2008/8/19/pneumatic-cylinders
* http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When saving a model that contains a has_many through association, the entire transaction fails to rollback when the validation fails. Specifically xxx_ids= should not modify the association unless all validations pass.&lt;/p&gt;

&lt;p&gt;Example:
Let's assume we have a Paper model that contains a title attribute and a has_many through relationship with Categories. We validate to ensure a paper has at least one category and the title is not invalid.&lt;/p&gt;

&lt;p&gt;If the title is invalid and the categories are empty and an &quot;update_attributes&quot; occurs even after the validation fails, all associations to categories are lost. The title is not updated as expected. Preferably, the association to categories would not be affected unless a save is successful.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
a = Paper.first
a.categories # =&amp;gt; [#category1, #category2]
a.update_attributes(:category_ids =&amp;gt; [], :title =&amp;gt; &amp;quot;invalid&amp;quot;) # =&amp;gt; false
a.categories # =&amp;gt; []
a.title # =&amp;gt; &amp;quot;invalid&amp;quot;
a.valid? # =&amp;gt; false
a.errors.full_messages # =&amp;gt; [&amp;quot;title cannot be invalid&amp;quot;, &amp;quot;At least one category must be assigned&amp;quot;]
a.reload
a.title # =&amp;gt; &amp;quot;Original&amp;quot;
a.categories # =&amp;gt; []
a.valid? # =&amp;gt; false
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There is a quick fix that doesn't completely solve the problem. In the model where the update_attributes occurs we can force a &quot;rollback&quot; using the following code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
  def update_attributes_with_rollback(*args)
    old_category_ids = self.category_ids
    saved_properly = update_attributes_without_rollback(*args)
    self.category_ids = old_category_ids unless saved_properly
    saved_properly
  end
  alias_method_chain :update_attributes, :rollback
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here are some resources which aided us and may help:
* &lt;a href=&quot;http://giantrobots.thoughtbot.com/2008/8/19/pneumatic-cylinders&quot;&gt;http://giantrobots.thoughtbot.co...&lt;/a&gt;
* &lt;a href=&quot;http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes&quot;&gt;http://paulbarry.com/articles/20...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When saving a model that contains a has_many through association, the entire transaction fails to rollback when the validation fails. Specifically xxx_ids= should not modify the association unless all validations pass.

Example:
Let's assume we have a Paper model that contains a title attribute and a has_many through relationship with Categories. We validate to ensure a paper has at least one category and the title is not invalid.

If the title is invalid and the categories are empty and an &quot;update_attributes&quot; occurs even after the validation fails, all associations to categories are lost. The title is not updated as expected. Preferably, the association to categories would not be affected unless a save is successful.

@@@ ruby
a = Paper.first
a.categories # =&gt; [#category1, #category2]
a.update_attributes(:category_ids =&gt; [], :title =&gt; &quot;invalid&quot;) # =&gt; false
a.categories # =&gt; []
a.title # =&gt; &quot;invalid&quot; 
a.valid? # =&gt; false
a.errors.full_messages # =&gt; [&quot;title cannot be invalid&quot;, &quot;At least one category must be assigned&quot;]
a.reload
a.title # =&gt; &quot;Original&quot;
a.categories # =&gt; []
a.valid? # =&gt; false
@@@

There is a quick fix that doesn't completely solve the problem. In the model where the update_attributes occurs we can force a &quot;rollback&quot; using the following code:
@@@ ruby
  def update_attributes_with_rollback(*args)
    old_category_ids = self.category_ids
    saved_properly = update_attributes_without_rollback(*args)
    self.category_ids = old_category_ids unless saved_properly
    saved_properly
  end
  alias_method_chain :update_attributes, :rollback
@@@

Here are some resources which aided us and may help:

 * http://giantrobots.thoughtbot.com/2008/8/19/pneumatic-cylinders
 * http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes</body>
      <body-html>&lt;div&gt;&lt;p&gt;When saving a model that contains a has_many through association, the entire transaction fails to rollback when the validation fails. Specifically xxx_ids= should not modify the association unless all validations pass.&lt;/p&gt;

&lt;p&gt;Example:
Let's assume we have a Paper model that contains a title attribute and a has_many through relationship with Categories. We validate to ensure a paper has at least one category and the title is not invalid.&lt;/p&gt;

&lt;p&gt;If the title is invalid and the categories are empty and an &quot;update_attributes&quot; occurs even after the validation fails, all associations to categories are lost. The title is not updated as expected. Preferably, the association to categories would not be affected unless a save is successful.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
a = Paper.first
a.categories # =&amp;gt; [#category1, #category2]
a.update_attributes(:category_ids =&amp;gt; [], :title =&amp;gt; &amp;quot;invalid&amp;quot;) # =&amp;gt; false
a.categories # =&amp;gt; []
a.title # =&amp;gt; &amp;quot;invalid&amp;quot;
a.valid? # =&amp;gt; false
a.errors.full_messages # =&amp;gt; [&amp;quot;title cannot be invalid&amp;quot;, &amp;quot;At least one category must be assigned&amp;quot;]
a.reload
a.title # =&amp;gt; &amp;quot;Original&amp;quot;
a.categories # =&amp;gt; []
a.valid? # =&amp;gt; false
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There is a quick fix that doesn't completely solve the problem. In the model where the update_attributes occurs we can force a &quot;rollback&quot; using the following code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
  def update_attributes_with_rollback(*args)
    old_category_ids = self.category_ids
    saved_properly = update_attributes_without_rollback(*args)
    self.category_ids = old_category_ids unless saved_properly
    saved_properly
  end
  alias_method_chain :update_attributes, :rollback
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here are some resources which aided us and may help:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://giantrobots.thoughtbot.com/2008/8/19/pneumatic-cylinders&quot;&gt;http://giantrobots.thoughtbot.co...&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://paulbarry.com/articles/2007/10/24/has_many-through-checkboxes&quot;&gt;http://paulbarry.com/articles/20...&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-28T04:33:29+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-08-28T04:33:29+01:00</updated-at>
      <user-id type="integer">10683</user-id>
      <version type="integer">1</version>
      <user-name>2 College Bums</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've just been bitten from this too.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've just been bitten from this too.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-31T14:07:57+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback-2</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-08-31T14:07:57+01:00</updated-at>
      <user-id type="integer">1075</user-id>
      <version type="integer">2</version>
      <user-name>Claudio Poli</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In edge, if any validation fails there's a rollback of the transaction that wraps save (that's since #891).

Could you please test if that solves this issue?</body>
      <body-html>&lt;div&gt;&lt;p&gt;In edge, if any validation fails there's a rollback of the
transaction that wraps save (that's since &lt;a href=&quot;/projects/8994/tickets/891&quot; title=&quot;Ticket #891&quot;&gt;#891&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Could you please test if that solves this issue?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-31T21:20:42+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback-3</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-08-31T21:20:42+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">3</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This patch does not solve this issue. We tested it in edge and the use case above still fails. We checked to make sure that save_with_transactions was called, and the rollback still did not completely revert the has_many through association.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch does not solve this issue. We tested it in edge and
the use case above still fails. We checked to make sure that
save_with_transactions was called, and the rollback still did not
completely revert the has_many through association.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-05T22:20:53+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-05T22:20:56+01:00</updated-at>
      <user-id type="integer">10683</user-id>
      <version type="integer">4</version>
      <user-name>2 College Bums</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think I see the problem.

The setter `category_ids=` updates the associated categories in the database right away.

On the other hand `update_attributes` is implemented like this:
@@@ ruby
  def update_attributes(attributes)
    self.attributes = attributes
    save
  end
@@@
and that call to `attributes=` ends up invoking `category_ids=`:
@@@ ruby
respond_to?(:&quot;#{k}=&quot;) ? send(:&quot;#{k}=&quot;, v) : raise(UnknownAttributeError, &quot;unknown attribute: #{k}&quot;)
@@@
Clearly that one is not wrapped by the transaction of `save`.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think I see the problem.&lt;/p&gt;
&lt;p&gt;The setter &lt;code&gt;category_ids=&lt;/code&gt; updates the associated
categories in the database right away.&lt;/p&gt;
&lt;p&gt;On the other hand &lt;code&gt;update_attributes&lt;/code&gt; is implemented
like this:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
  def update_attributes(attributes)
    self.attributes = attributes
    save
  end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and that call to &lt;code&gt;attributes=&lt;/code&gt; ends up invoking
&lt;code&gt;category_ids=&lt;/code&gt;:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
respond_to?(:&amp;quot;#{k}=&amp;quot;) ? send(:&amp;quot;#{k}=&amp;quot;, v) : raise(UnknownAttributeError, &amp;quot;unknown attribute: #{k}&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clearly that one is not wrapped by the transaction of
&lt;code&gt;save&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T02:12:08+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-06T02:12:14+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">5</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>OK, here's a fix. We wrap the update_attribute* family in transactions.</body>
      <body-html>&lt;div&gt;&lt;p&gt;OK, here's a fix. We wrap the update_attribute* family in
transactions.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T04:31:23+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-06T04:31:28+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">6</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Touched a couple of details in the original diff, here's an update.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Touched a couple of details in the original diff, here's an
update.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T04:36:23+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-06T04:36:28+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">7</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>And yet another revision.</body>
      <body-html>&lt;div&gt;&lt;p&gt;And yet another revision.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T04:51:27+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-06T04:51:33+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">8</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1 good one</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 good one&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-06T20:32:54+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-06T20:32:56+01:00</updated-at>
      <user-id type="integer">1075</user-id>
      <version type="integer">9</version>
      <user-name>Claudio Poli</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1 works</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 works&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-09-09T01:32:52+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-09-09T01:32:56+01:00</updated-at>
      <user-id type="integer">10683</user-id>
      <version type="integer">10</version>
      <user-name>2 College Bums</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-20T15:50:31+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2008-12-20T15:50:33+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">11</version>
      <user-name>Pratik</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think this is good to go, but no longer applies cleanly.  Resubmit and I'll apply it</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think this is good to go, but no longer applies cleanly.
Resubmit and I'll apply it&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-01T02:11:27+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-01T02:11:30+00:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">12</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sure!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sure!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-01T10:18:05+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-01T10:18:10+00:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">13</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [fc09ebc669bd58f415f7d3ef932ef02dab821ab5]) Wrap calls to update_attributes in a transaction.

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
[#922 state:committed]
http://github.com/rails/rails/commit/fc09ebc669bd58f415f7d3ef932ef02dab821ab5</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [fc09ebc669bd58f415f7d3ef932ef02dab821ab5]) Wrap calls to
update_attributes in a transaction.&lt;/p&gt;
&lt;p&gt;Signed-off-by: Michael Koziarski &lt;a href=&quot;mailto:michael@koziarski.com&quot;&gt;michael@koziarski.com&lt;/a&gt; [&lt;a href=&quot;/projects/8994/tickets/922&quot; title=&quot;Ticket #922&quot;&gt;#922&lt;/a&gt;
state:committed] &lt;a href=&quot;http://github.com/rails/rails/commit/fc09ebc669bd58f415f7d3ef932ef02dab821ab5&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T02:42:14+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-22T02:42:15+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">14</version>
      <user-name>Repository</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [06040849b5a680c2a87893699580f9b9b80f72e4]) Revert &quot;Wrap calls to update_attributes in a transaction.&quot;

This caused failures on sqlite, sqlite3 and postgresql

This reverts commit fc09ebc669bd58f415f7d3ef932ef02dab821ab5.
[#922 state:reopened]
http://github.com/rails/rails/commit/06040849b5a680c2a87893699580f9b9b80f72e4</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [06040849b5a680c2a87893699580f9b9b80f72e4]) Revert &quot;Wrap
calls to update_attributes in a transaction.&quot;&lt;/p&gt;
&lt;p&gt;This caused failures on sqlite, sqlite3 and postgresql&lt;/p&gt;
&lt;p&gt;This reverts commit fc09ebc669bd58f415f7d3ef932ef02dab821ab5.
[&lt;a href=&quot;/projects/8994/tickets/922&quot; title=&quot;Ticket #922&quot;&gt;#922&lt;/a&gt;
state:reopened] &lt;a href=&quot;http://github.com/rails/rails/commit/06040849b5a680c2a87893699580f9b9b80f72e4&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T03:41:31+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-22T03:41:32+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">15</version>
      <user-name>Repository</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-22T03:43:23+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-22T03:43:27+00:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">16</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'll have a look at those failures.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'll have a look at those failures.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-22T09:54:16+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-22T09:54:19+00:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">17</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Indeed in my machine tests fail even for MySQL now.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Indeed in my machine tests fail even for MySQL now.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-22T22:45:02+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-02-22T22:45:08+00:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">18</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-18T16:34:44+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 24544
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-03-18T16:34:48+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">19</version>
      <user-name>DHH</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think the failures were because the default in delete_records is to nullify and there are db constraints. By changing the audit_logs in Developer to dependent =&gt; :destroy gets around that. I am playing with tests to see if I can get them all to pass.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think the failures were because the default in delete_records
is to nullify and there are db constraints. By changing the
audit_logs in Developer to dependent =&amp;gt; :destroy gets around
that. I am playing with tests to see if I can get them all to
pass.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-25T05:22:38+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-04-25T05:22:42+01:00</updated-at>
      <user-id type="integer">4696</user-id>
      <version type="integer">20</version>
      <user-name>Brad Pauly</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm not sure I completely understand, but I'm wondering if update_attribute should also do this since it doesn't do validation and update_attribute(:foo_ids, []) seems okay to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not sure I completely understand, but I'm wondering if
update_attribute should also do this since it doesn't do validation
and update_attribute(:foo_ids, []) seems okay to me.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-25T05:49:00+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-04-25T05:49:06+01:00</updated-at>
      <user-id type="integer">4696</user-id>
      <version type="integer">21</version>
      <user-name>Brad Pauly</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Posting a patch if anyone is interested. Essentially the same as Xavier posted but without update_attribute and with the change to developer model.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Posting a patch if anyone is interested. Essentially the same as
Xavier posted but without update_attribute and with the change to
developer model.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-25T08:08:16+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-04-25T08:08:21+01:00</updated-at>
      <user-id type="integer">4696</user-id>
      <version type="integer">22</version>
      <user-name>Brad Pauly</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hey Brad, thanks for the followup Real Life interrupted this :).

update_attribute does not run validations but it runs callbacks, there's still the chance that something triggers a rollback or has a side-effect in the database.

The reason I included update_attribute is not that one though, because callbacks are run inside a call to save(). Problem is update_attribute is not atomic because the setter itself runs outside the transaction of save().</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey Brad, thanks for the followup Real Life interrupted this
:).&lt;/p&gt;
&lt;p&gt;update_attribute does not run validations but it runs callbacks,
there's still the chance that something triggers a rollback or has
a side-effect in the database.&lt;/p&gt;
&lt;p&gt;The reason I included update_attribute is not that one though,
because callbacks are run inside a call to save(). Problem is
update_attribute is not atomic because the setter itself runs
outside the transaction of save().&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-25T09:29:00+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-04-25T09:29:04+01:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">23</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Hi Xavier, Thanks for explaining. I went back to your original patch and started over. I have MySQL and Sqlite3 passing, just need to figure out Postgresql.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Xavier, Thanks for explaining. I went back to your original
patch and started over. I have MySQL and Sqlite3 passing, just need
to figure out Postgresql.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-29T06:35:03+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-04-29T06:35:10+01:00</updated-at>
      <user-id type="integer">4696</user-id>
      <version type="integer">24</version>
      <user-name>Brad Pauly</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've started to dig in to this for Postgresql.  What I'm seeing in 2.3.2 on the ruby pg-0.80 driver is that validation fails and ActiveRecord::Transactions raises an ActiveRecord::Rollback.  However in ActiveRecord::ConnectionAdapters::DatabaseStatements#transaction the rollback_db_transaction is never invoked because the logic for tracking whether or not a transaction is open returns false, causing the rollback to not occur.  It looks like transaction_open, requires_new, or open_transactions is not keeping state correctly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've started to dig in to this for Postgresql. What I'm seeing
in 2.3.2 on the ruby pg-0.80 driver is that validation fails and
ActiveRecord::Transactions raises an ActiveRecord::Rollback.
However in
ActiveRecord::ConnectionAdapters::DatabaseStatements#transaction
the rollback_db_transaction is never invoked because the logic for
tracking whether or not a transaction is open returns false,
causing the rollback to not occur. It looks like transaction_open,
requires_new, or open_transactions is not keeping state
correctly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-20T23:22:29+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-07-20T23:44:02+01:00</updated-at>
      <user-id type="integer">63374</user-id>
      <version type="integer">25</version>
      <user-name>Trey Dempsey</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Trey,  can you isolate this problem in a stand-alone test for AR?
that'd let us split this ticket up into the has_many problem and the
postgres-transaction-not-working problem</body>
      <body-html>&lt;div&gt;&lt;p&gt;Trey, can you isolate this problem in a stand-alone test for
AR?&lt;br&gt;
that'd let us split this ticket up into the has_many problem and
the&lt;br&gt;
postgres-transaction-not-working problem&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-23T05:01:37+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord bug has_many</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2009-07-23T05:01:40+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">26</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>&lt;a href=&quot; http://www.essayslab.com&quot;&gt;Buy essay&lt;/a&gt; and written essay and be insured you have all facts about this good post*.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a&gt;Buy essay&lt;/a&gt; and written essay and be insured you have all
facts about this good post*.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-15T20:25:44+00:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activerecord bug has_many
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-01-15T20:25:47+00:00</updated-at>
      <user-id type="integer">82838</user-id>
      <version type="integer">27</version>
      <user-name>Amy25</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:34+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-05-04T18:48:34+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">28</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Attached is patch against rails3 master. All the tests are passing.

All the work has been done by others so they should be given the commit credit.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is patch against rails3 master. All the tests are
passing.&lt;/p&gt;
&lt;p&gt;All the work has been done by others so they should be given the
commit credit.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-05T04:41:37+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1375</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-05T04:41:41+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">29</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I am bumping the priority on this one. Fixing this would also fix ticket like #2933.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am bumping the priority on this one. Fixing this would also
fix ticket like &lt;a href=&quot;/projects/8994/tickets/2933&quot; title=
&quot;Ticket #2933&quot;&gt;#2933&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T17:50:01+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 1375
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-13T17:50:04+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">30</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>previous patch did not apply cleanly. Attached is updated patch</body>
      <body-html>&lt;div&gt;&lt;p&gt;previous patch did not apply cleanly. Attached is updated
patch&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T20:34:27+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
:assigned_user: 141
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord patch &quot;rails 3&quot;</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-13T20:34:32+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">31</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5]) update_attributes and update_attributes! are now wrapped in a transaction

[#922 state:resovled]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5&quot;
title=
&quot;Changeset [f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5]&quot;&gt;[f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5]&lt;/a&gt;)
update_attributes and update_attributes! are now wrapped in a
transaction&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/922&quot; title=
&quot;Ticket #922&quot;&gt;#922&lt;/a&gt; state:resovled]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a href=
&quot;mailto:jose.valim@gmail.com&quot;&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/f4fbc2c1f943ff11776b2c7c34df6bcbe655a4e5&quot;&gt;
http://github.com/rails/rails/commit/f4fbc2c1f943ff11776b2c7c34df6b...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-13T21:05:07+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord patch &quot;rails 3&quot;</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-13T21:05:10+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">32</version>
      <user-name>Repository</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-14T07:03:34+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activerecord patch &quot;rails 3&quot;</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-14T07:03:36+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">33</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Attaching the backported fix for 2-3-stable.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attaching the backported fix for 2-3-stable.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-14T15:50:00+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord patch &quot;rails 3&quot;</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-14T15:50:03+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">34</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">5</attachments-count>
      <body>(from [99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b]) update_attribute and updated_attributes! are now wrapped in a transaction

[#922 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b&quot;
title=
&quot;Changeset [99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b]&quot;&gt;[99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b]&lt;/a&gt;)
update_attribute and updated_attributes! are now wrapped in a
transaction&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/922&quot; title=
&quot;Ticket #922&quot;&gt;#922&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a href=
&quot;mailto:jose.valim@gmail.com&quot;&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/99cdea7cbe69f7ea9ef82bdcf9502e47e9e4e07b&quot;&gt;
http://github.com/rails/rails/commit/99cdea7cbe69f7ea9ef82bdcf9502e...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-07-18T10:20:39+01:00</created-at>
      <creator-id type="integer">10683</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">922</number>
      <permalink>has_many-through-transaction-rollback</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activerecord patch &quot;rails 3&quot;</tag>
      <title>has_many through transaction rollback</title>
      <updated-at type="datetime">2010-07-18T10:20:42+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">35</version>
      <user-name>Repository</user-name>
      <creator-name>2 College Bums</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/922</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>7129f07ed96ceb2439a01ae56fe26022fecc97af</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-01T10:18:05+00:00</created-at>
      <filename>wrap_update_attribute_in_a_transaction.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">83638</id>
      <size type="integer">3473</size>
      <uploader-id type="integer">11378</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/83638/wrap_update_attribute_in_a_transaction.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>0509c5be39a6c6700d3a39cc08d22145e8175a5a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-04-25T08:08:16+01:00</created-at>
      <filename>has_many_transaction_rollback.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">115279</id>
      <size type="integer">3602</size>
      <uploader-id type="integer">4696</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/115279/has_many_transaction_rollback.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>7f6d6ef4afb058f9c36741154254faf1cc9de4f3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-05T04:41:37+01:00</created-at>
      <filename>922_fix_against_master.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">585890</id>
      <size type="integer">3713</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/585890/922_fix_against_master.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>89aae9cfb63b83a5fa8838ee3e61c6a04084672c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-13T20:34:27+01:00</created-at>
      <filename>922_fix_rails_master.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">592307</id>
      <size type="integer">3593</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/592307/922_fix_rails_master.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>10e7d3a0f1b39debc45d5807eed201d204e09dd6</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-07-14T15:50:00+01:00</created-at>
      <filename>922_fix_for_2-3-stable.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">592986</id>
      <size type="integer">3606</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/592986/922_fix_for_2-3-stable.diff</url>
    </attachment>
  </attachments>
</ticket>
