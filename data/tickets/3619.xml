<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">85</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-12-26T22:50:21+00:00</created-at>
  <creator-id type="integer">12475</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">82855</milestone-id>
  <number type="integer">3619</number>
  <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
  <priority type="integer">2</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>235 2x bugmash conditions layout &quot;nested layouts&quot;</tag>
  <title>Conditional layouts ignore default application wide layout</title>
  <updated-at type="datetime">2011-02-02T18:15:31+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">21</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Henrique</creator-name>
  <assigned-user-name>Jeremy Kemper</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
  <milestone-title>2.3.10</milestone-title>
  <priority-name>Medium</priority-name>
  <original-body>Suppose you have a layout called &quot;application.html.erb&quot;, your main application layout. Now if you have a controller with 7 actions but want to apply a different layout in one action,  like:

@@@ ruby
layout &quot;full_width&quot;, :only =&gt; :index
@@@

the other six actions won't use any layout at all. The same occurs with the :except option.

I think the current behavior is neither intuitive nor desirable in most cases. IMHO It would make more sense to default the unmatched actions to the application.html.erb layout.</original-body>
  <latest-body>Suppose you have a layout called &quot;application.html.erb&quot;, your main application layout. Now if you have a controller with 7 actions but want to apply a different layout in one action,  like:

@@@ ruby
layout &quot;full_width&quot;, :only =&gt; :index
@@@

the other six actions won't use any layout at all. The same occurs with the :except option.

I think the current behavior is neither intuitive nor desirable in most cases. IMHO It would make more sense to default the unmatched actions to the application.html.erb layout.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Suppose you have a layout called &quot;application.html.erb&quot;, your
main application layout. Now if you have a controller with 7
actions but want to apply a different layout in one action,
like:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;layout &quot;full_width&quot;, :only =&amp;gt; :index&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;the other six actions won't use any layout at all. The same
occurs with the :except option.&lt;/p&gt;
&lt;p&gt;I think the current behavior is neither intuitive nor desirable
in most cases. IMHO It would make more sense to default the
unmatched actions to the application.html.erb layout.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Suppose you have a layout called &quot;application.html.erb&quot;, your main application layout. Now if you have a controller with 7 actions but want to apply a different layout in one action,  like:

@@@ ruby
layout &quot;full_width&quot;, :only =&gt; :index
@@@

the other six actions won't use any layout at all. The same occurs with the :except option.

I think the current behavior is neither intuitive nor desirable in most cases. IMHO It would make more sense to default the unmatched actions to the application.html.erb layout.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Suppose you have a layout called &quot;application.html.erb&quot;, your
main application layout. Now if you have a controller with 7
actions but want to apply a different layout in one action,
like:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;layout &quot;full_width&quot;, :only =&amp;gt; :index&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;the other six actions won't use any layout at all. The same
occurs with the :except option.&lt;/p&gt;
&lt;p&gt;I think the current behavior is neither intuitive nor desirable
in most cases. IMHO It would make more sense to default the
unmatched actions to the application.html.erb layout.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-26T22:50:21+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>layout</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2009-12-26T22:50:23+00:00</updated-at>
      <user-id type="integer">12475</user-id>
      <version type="integer">1</version>
      <user-name>Henrique</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think the reason for this would be that the &quot;_action_has_layout?&quot; method returns false if you use the &quot;layout&quot; method to set the layout with conditions and the action called is not in the list.
As a workaround I would pass the layout to render in the index action like so:

{{{
  def index
    # ...
    render :layout =&gt; 'full_width'
  end
}}}

this way the index action will render full_width and all other actions will default to the application layout or whatever other layout you have specified.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think the reason for this would be that the
&quot;_action_has_layout?&quot; method returns false if you use the &quot;layout&quot;
method to set the layout with conditions and the action called is
not in the list.&lt;br&gt;
As a workaround I would pass the layout to render in the index
action like so:&lt;/p&gt;
&lt;p&gt;{{{ def index&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;# ...
render :layout =&amp;gt; 'full_width'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end }}}&lt;/p&gt;
&lt;p&gt;this way the index action will render full_width and all other
actions will default to the application layout or whatever other
layout you have specified.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-12-28T20:43:42+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>layout</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2009-12-28T20:43:43+00:00</updated-at>
      <user-id type="integer">2529</user-id>
      <version type="integer">2</version>
      <user-name>Daniel Guettler</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Tried to do:

@@@ ruby
layout nil, :only =&gt; [:create, :destroy]
@@@

And it also applied for index action. Except does the same.

Workaround:

@@@ ruby
render :layout =&gt; false
@@@

In every action.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Tried to do:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;layout nil, :only =&amp;gt; [:create, :destroy]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And it also applied for index action. Except does the same.&lt;/p&gt;
&lt;p&gt;Workaround:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;render :layout =&amp;gt; false&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In every action.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-11T18:40:14+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: layout
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>conditions layout</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-01-11T18:40:16+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">3</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-12T15:55:08+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: conditions layout
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-12T15:55:10+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">4</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Which Rails version?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Which Rails version?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-12T16:16:20+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-12T16:16:23+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">5</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>2.3.5</body>
      <body-html>&lt;div&gt;&lt;p&gt;2.3.5&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-12T16:31:02+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: conditions layout &quot;nested layouts&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-12T16:31:05+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">6</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Could you please provide a failing test case or even a patch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could you please provide a failing test case or even a
patch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-12T16:32:44+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-12T16:32:47+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">7</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>OK, I will try to do it tomorrow.</body>
      <body-html>&lt;div&gt;&lt;p&gt;OK, I will try to do it tomorrow.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-12T16:35:31+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-12T16:35:34+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">8</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Added 2 failed tests for nested/inherited layout with condition and just simple layout with condition.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Added 2 failed tests for nested/inherited layout with condition
and just simple layout with condition.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-13T23:04:06+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 conditions layout &quot;nested layouts&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-13T23:04:07+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">9</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-18T15:56:43+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-18T15:57:15+00:00</updated-at>
      <user-id type="integer">16383</user-id>
      <version type="integer">10</version>
      <user-name>Dmitry Polushkin</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks for the tests, Dmitry. Good case to cover.

Does it work on master? Patches welcome :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for the tests, Dmitry. Good case to cover.&lt;/p&gt;
&lt;p&gt;Does it work on master? Patches welcome :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-18T17:55:51+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-18T18:02:59+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">11</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I have been looking at this problem and my conclusion is that the problem in here is that one *controller* only can stores one *layout* definition:

@@@ ruby
# layout.rb

def layout(template_name, conditions = {}, auto = false)
  add_layout_conditions(conditions)
  write_inheritable_attribute(:layout, template_name)
  write_inheritable_attribute(:auto_layout, auto)
end
@@@

So each time we call to *layout* method the *layout* attribute will be reset to the new value even if this *layout* is intended to be used **only** on one *action*.

Another problem in here is that we can't make a definition like this:

@@@ ruby
class HasTwoOwnLayoutWithConditionsController &lt; LayoutTest
  layout 'layout_wadus', :only =&gt; 'wadus'
  layout 'layout_churro', :only =&gt; 'churro'
end
@@@

Because the second call to *layout* method will delete what is defined on the first one, so this is not gonna work:

@@@ ruby
def test_layout_with_two_layouts_with_conditions_definided
  @controller = HasTwoOwnLayoutWithConditionsController.new
  get :churro
  assert_equal 'layouts/layout_churro', @response.layout
  
  get :wadus
  assert_equal 'layouts/layout_wadus', @response.layout
  
  get :hello
  assert_equal 'layouts/layout_test', @response.layout
end
@@@

If we add to the *fixtures/layout_tests* all the *layouts* and *views* needed only the first *assertion* will work because it is defined on the last call to the *layout* method.

What I think could be a solution is to change the *layout.rb* class so on every call to *layout* method a new *layout* definition will be stored but without delete the already stored *layouts*, so what we will have will be an *Stack* of *layouts* and to figure out what *layout* has to be used on a particular *action* of a particular *controller* we will have to check all the *Stack* from top to bottom.

The problem is double because the *layout* definition is not stored on only one attribute, remember the method *layout* on the class *layout.rb* pasted above.

I can try to implement a solution but I need to receive feedback of my conclusions since this could be a very big change on *layout* implementation.

Regards.

f.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have been looking at this problem and my conclusion is that
the problem in here is that one &lt;em&gt;controller&lt;/em&gt; only can stores
one &lt;em&gt;layout&lt;/em&gt; definition:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;# layout.rb

def layout(template_name, conditions = {}, auto = false)
  add_layout_conditions(conditions)
  write_inheritable_attribute(:layout, template_name)
  write_inheritable_attribute(:auto_layout, auto)
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So each time we call to &lt;em&gt;layout&lt;/em&gt; method the
&lt;em&gt;layout&lt;/em&gt; attribute will be reset to the new value even if
this &lt;em&gt;layout&lt;/em&gt; is intended to be used &lt;strong&gt;only&lt;/strong&gt;
on one &lt;em&gt;action&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Another problem in here is that we can't make a definition like
this:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;class HasTwoOwnLayoutWithConditionsController &amp;lt; LayoutTest
  layout 'layout_wadus', :only =&amp;gt; 'wadus'
  layout 'layout_churro', :only =&amp;gt; 'churro'
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Because the second call to &lt;em&gt;layout&lt;/em&gt; method will delete
what is defined on the first one, so this is not gonna work:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;def test_layout_with_two_layouts_with_conditions_definided
  @controller = HasTwoOwnLayoutWithConditionsController.new
  get :churro
  assert_equal 'layouts/layout_churro', @response.layout
  
  get :wadus
  assert_equal 'layouts/layout_wadus', @response.layout
  
  get :hello
  assert_equal 'layouts/layout_test', @response.layout
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If we add to the &lt;em&gt;fixtures/layout_tests&lt;/em&gt; all the
&lt;em&gt;layouts&lt;/em&gt; and &lt;em&gt;views&lt;/em&gt; needed only the first
&lt;em&gt;assertion&lt;/em&gt; will work because it is defined on the last call
to the &lt;em&gt;layout&lt;/em&gt; method.&lt;/p&gt;
&lt;p&gt;What I think could be a solution is to change the
&lt;em&gt;layout.rb&lt;/em&gt; class so on every call to &lt;em&gt;layout&lt;/em&gt; method
a new &lt;em&gt;layout&lt;/em&gt; definition will be stored but without delete
the already stored &lt;em&gt;layouts&lt;/em&gt;, so what we will have will be
an &lt;em&gt;Stack&lt;/em&gt; of &lt;em&gt;layouts&lt;/em&gt; and to figure out what
&lt;em&gt;layout&lt;/em&gt; has to be used on a particular &lt;em&gt;action&lt;/em&gt; of a
particular &lt;em&gt;controller&lt;/em&gt; we will have to check all the
&lt;em&gt;Stack&lt;/em&gt; from top to bottom.&lt;/p&gt;
&lt;p&gt;The problem is double because the &lt;em&gt;layout&lt;/em&gt; definition is
not stored on only one attribute, remember the method
&lt;em&gt;layout&lt;/em&gt; on the class &lt;em&gt;layout.rb&lt;/em&gt; pasted above.&lt;/p&gt;
&lt;p&gt;I can try to implement a solution but I need to receive feedback
of my conclusions since this could be a very big change on
&lt;em&gt;layout&lt;/em&gt; implementation.&lt;/p&gt;
&lt;p&gt;Regards.&lt;/p&gt;
&lt;p&gt;f.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-26T10:41:45+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-03-26T10:41:49+00:00</updated-at>
      <user-id type="integer">23794</user-id>
      <version type="integer">12</version>
      <user-name>Fernando Guillen</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Fernando has a good point. Maintaing the stack seems like a good idea. However if the stack has options like only and except then figuring out the correct layout might take time and there will be performance hit.

The other approach would be to resolve which layout will be applied to which method at boot time. The issue in this case would be if someone adds a new method to a controller dynamically.

I haven't looked at rails3 but I do remember that in one of the speeches Yehuda mentioned that to make filters run faster in rails3 , he takes that second approach mentioned above. I might be wrong but he resolves what all filters will be applied to a method at boot time. Not sure how and if he handles if a method is added dynamically.

Either way the solution would require some structural change. And as Fernando said a high level guideline from the core team would be a help.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Fernando has a good point. Maintaing the stack seems like a good
idea. However if the stack has options like only and except then
figuring out the correct layout might take time and there will be
performance hit.&lt;/p&gt;
&lt;p&gt;The other approach would be to resolve which layout will be
applied to which method at boot time. The issue in this case would
be if someone adds a new method to a controller dynamically.&lt;/p&gt;
&lt;p&gt;I haven't looked at rails3 but I do remember that in one of the
speeches Yehuda mentioned that to make filters run faster in rails3
, he takes that second approach mentioned above. I might be wrong
but he resolves what all filters will be applied to a method at
boot time. Not sure how and if he handles if a method is added
dynamically.&lt;/p&gt;
&lt;p&gt;Either way the solution would require some structural change.
And as Fernando said a high level guideline from the core team
would be a help.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T16:39:06+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-04-16T16:39:10+01:00</updated-at>
      <user-id type="integer">18266</user-id>
      <version type="integer">13</version>
      <user-name>Neeraj</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hey guys, I made other ticket with a more limited scope, but I agree with Fernando we should have more flexibility and even ability to add 2+ layout declarations.

https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/4556-when-using-conditional-layouts-actions-fallback-to-parent-layout</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey guys, I made other ticket with a more limited scope, but I
agree with Fernando we should have more flexibility and even
ability to add 2+ layout declarations.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/4556-when-using-conditional-layouts-actions-fallback-to-parent-layout&quot;&gt;
https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-08T21:39:36+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-05-08T21:39:39+01:00</updated-at>
      <user-id type="integer">97543</user-id>
      <version type="integer">14</version>
      <user-name>Federico Brubacher</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20088)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20088&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-16T02:41:12+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 2.x conditions layout &quot;nested layouts&quot;
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-05-16T02:41:12+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">15</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20606)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20606&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T17:54:44+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 50064
</diffable-attributes>
      <milestone-id type="integer">73241</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-05-23T17:54:44+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.7</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20631)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20631&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-24T09:40:52+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73241
</diffable-attributes>
      <milestone-id type="integer">73273</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-05-24T09:40:52+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">17</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.8</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20816)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20816&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-25T23:45:40+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73273
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-05-25T23:45:40+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">18</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27613)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27613&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T02:28:50+01:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2010-08-30T02:28:50+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">19</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:49:52+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 2.x bugmash conditions layout &quot;nested layouts&quot;
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>235 2x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2011-02-02T18:14:49+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">20</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:49:54+00:00</created-at>
      <creator-id type="integer">12475</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3619</number>
      <permalink>conditional-layouts-ignore-default-application-wide-layout</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>235 2x bugmash conditions layout &quot;nested layouts&quot;</tag>
      <title>Conditional layouts ignore default application wide layout</title>
      <updated-at type="datetime">2011-02-02T18:15:31+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">21</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Henrique</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3619</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>60449d0e7fd154e3ea71c469b55c32d351a54634</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-03-13T23:04:06+00:00</created-at>
      <filename>rails_layout_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">445781</id>
      <size type="integer">1487</size>
      <uploader-id type="integer">16383</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/445781/rails_layout_fix.diff</url>
    </attachment>
  </attachments>
</ticket>
