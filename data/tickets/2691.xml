<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-05-21T18:57:12+01:00</created-at>
  <creator-id type="integer">19095</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">2691</number>
  <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
  <priority type="integer">1812</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag nil="true"></tag>
  <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
  <updated-at type="datetime">2011-02-02T18:43:29+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">6</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Brad Sumersford</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
  <milestone-title>3.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When adding development only gems like 'faker' I place them in the development.rb configuration and all works as advertised.

Unfortunately, if the gem is dependent on plugin functionality, fiveruns_tuneup for example, the rails/init.rb in the gem plugin only fires when the config.gem entry is put in the main environment.rb and not in any of the environment specific configurations.

This is due to the Rails Initializer calling **add_plugin_load_paths** before it calls **load_environment**. The **add_plugin_load_paths** method will load all the plugins (and call rails/init.rb if available) and cache them, unfortunately before the environment specific configuration gets a chance to load any gems it may need.  

If this is intentional, it's not very intuitive as the config.gem declarations *do* work in the environment specific configuration, just not **completely**.</original-body>
  <latest-body>When adding development only gems like 'faker' I place them in the development.rb configuration and all works as advertised.

Unfortunately, if the gem is dependent on plugin functionality, fiveruns_tuneup for example, the rails/init.rb in the gem plugin only fires when the config.gem entry is put in the main environment.rb and not in any of the environment specific configurations.

This is due to the Rails Initializer calling **add_plugin_load_paths** before it calls **load_environment**. The **add_plugin_load_paths** method will load all the plugins (and call rails/init.rb if available) and cache them, unfortunately before the environment specific configuration gets a chance to load any gems it may need.  

If this is intentional, it's not very intuitive as the config.gem declarations *do* work in the environment specific configuration, just not **completely**.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When adding development only gems like 'faker' I place them in
the development.rb configuration and all works as advertised.&lt;/p&gt;
&lt;p&gt;Unfortunately, if the gem is dependent on plugin functionality,
fiveruns_tuneup for example, the rails/init.rb in the gem plugin
only fires when the config.gem entry is put in the main
environment.rb and not in any of the environment specific
configurations.&lt;/p&gt;
&lt;p&gt;This is due to the Rails Initializer calling
&lt;strong&gt;add_plugin_load_paths&lt;/strong&gt; before it calls
&lt;strong&gt;load_environment&lt;/strong&gt;. The
&lt;strong&gt;add_plugin_load_paths&lt;/strong&gt; method will load all the
plugins (and call rails/init.rb if available) and cache them,
unfortunately before the environment specific configuration gets a
chance to load any gems it may need.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;If this is intentional, it's not very intuitive as the
config.gem declarations &lt;em&gt;do&lt;/em&gt; work in the environment
specific configuration, just not &lt;strong&gt;completely&lt;/strong&gt;.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When adding development only gems like 'faker' I place them in the development.rb configuration and all works as advertised.

Unfortunately, if the gem is dependent on plugin functionality, fiveruns_tuneup for example, the rails/init.rb in the gem plugin only fires when the config.gem entry is put in the main environment.rb and not in any of the environment specific configurations.

This is due to the Rails Initializer calling **add_plugin_load_paths** before it calls **load_environment**. The **add_plugin_load_paths** method will load all the plugins (and call rails/init.rb if available) and cache them, unfortunately before the environment specific configuration gets a chance to load any gems it may need.  

If this is intentional, it's not very intuitive as the config.gem declarations *do* work in the environment specific configuration, just not **completely**.</body>
      <body-html>&lt;div&gt;&lt;p&gt;When adding development only gems like 'faker' I place them in
the development.rb configuration and all works as advertised.&lt;/p&gt;
&lt;p&gt;Unfortunately, if the gem is dependent on plugin functionality,
fiveruns_tuneup for example, the rails/init.rb in the gem plugin
only fires when the config.gem entry is put in the main
environment.rb and not in any of the environment specific
configurations.&lt;/p&gt;
&lt;p&gt;This is due to the Rails Initializer calling
&lt;strong&gt;add_plugin_load_paths&lt;/strong&gt; before it calls
&lt;strong&gt;load_environment&lt;/strong&gt;. The
&lt;strong&gt;add_plugin_load_paths&lt;/strong&gt; method will load all the
plugins (and call rails/init.rb if available) and cache them,
unfortunately before the environment specific configuration gets a
chance to load any gems it may need.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;If this is intentional, it's not very intuitive as the
config.gem declarations &lt;em&gt;do&lt;/em&gt; work in the environment
specific configuration, just not &lt;strong&gt;completely&lt;/strong&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-05-21T18:57:13+01:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2009-05-21T18:57:17+01:00</updated-at>
      <user-id type="integer">19095</user-id>
      <version type="integer">1</version>
      <user-name>Brad Sumersford</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can confirm this issue in Rails 2.3.5. Here are steps to reproduce:

Add the following to `config/test.rb`:

@@@ ruby
config.gem &quot;webrat&quot;
config.gem &quot;contest&quot;
config.gem &quot;stories&quot;
@@@

Generate a new integration test and add the following in the test class:

@@@ ruby
story &quot;Show that the bug is valid&quot; do
  scenario &quot;With webrat&quot; do
    visit &quot;/&quot;
  end
end
@@@

Install gems with `rake gems:install` and then `rake test:integration`. The test will fail:

    Started
    E
    Finished in 0.051676 seconds.
    
      1) Error:
    test_With_webrat(SignUpTest::TestShowThatTheBugIsValid):
    NoMethodError: undefined method `visit' for #&lt;SignUpTest::TestShowThatTheBugIsValid:0x102288180&gt;
        /test/integration/sign_up_test.rb:8:in `test_With_webrat'
    
    1 tests, 0 assertions, 0 failures, 1 errors

It fails because the code in `rails/init.rb` in the Stories gem is not executed.

Note that configuring the gem dependencies in `config/environment.rb`, like Brad says, works as expected. (Also note that you can wrap those same dependencies with `if RAILS_ENV == &quot;test&quot;` to load them only in the test environment.)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm this issue in Rails 2.3.5. Here are steps to
reproduce:&lt;/p&gt;
&lt;p&gt;Add the following to &lt;code&gt;config/test.rb&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;config.gem &quot;webrat&quot;
config.gem &quot;contest&quot;
config.gem &quot;stories&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Generate a new integration test and add the following in the
test class:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;story &quot;Show that the bug is valid&quot; do
  scenario &quot;With webrat&quot; do
    visit &quot;/&quot;
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Install gems with &lt;code&gt;rake gems:install&lt;/code&gt; and then
&lt;code&gt;rake test:integration&lt;/code&gt;. The test will fail:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Started
E
Finished in 0.051676 seconds.

  1) Error:
test_With_webrat(SignUpTest::TestShowThatTheBugIsValid):
NoMethodError: undefined method `visit' for #&amp;lt;SignUpTest::TestShowThatTheBugIsValid:0x102288180&amp;gt;
    /test/integration/sign_up_test.rb:8:in `test_With_webrat'

1 tests, 0 assertions, 0 failures, 1 errors&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;It fails because the code in &lt;code&gt;rails/init.rb&lt;/code&gt; in the
Stories gem is not executed.&lt;/p&gt;
&lt;p&gt;Note that configuring the gem dependencies in
&lt;code&gt;config/environment.rb&lt;/code&gt;, like Brad says, works as
expected. (Also note that you can wrap those same dependencies with
&lt;code&gt;if RAILS_ENV == &quot;test&quot;&lt;/code&gt; to load them only in the test
environment.)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-20T04:43:18+00:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2010-01-20T04:43:23+00:00</updated-at>
      <user-id type="integer">57493</user-id>
      <version type="integer">2</version>
      <user-name>Chris Jones</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:50+01:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2010-05-04T18:48:50+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">3</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Any updates here? This is still an issue on latest 2.x or 3.x releases?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any updates here? This is still an issue on latest 2.x or 3.x
releases?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-09T04:12:49+01:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">1812</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2010-10-09T04:12:52+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">4</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:58:15+00:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">1812</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2011-02-02T18:43:29+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">5</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:58:16+00:00</created-at>
      <creator-id type="integer">19095</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">2691</number>
      <permalink>gem-plugin-does-not-load-railsinitrb-when-configgem-is-placed-in-developmentrb</permalink>
      <priority type="integer">1812</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>Gem Plugin does not load rails/init.rb when config.gem is placed in development.rb</title>
      <updated-at type="datetime">2011-02-02T18:42:50+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">6</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Brad Sumersford</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2691</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
