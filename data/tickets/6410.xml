<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19117</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-21T14:04:59+00:00</created-at>
  <creator-id type="integer">62352</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">6410</number>
  <permalink>dateyesterday-datetoday</permalink>
  <priority type="integer">2</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>active_support core_ext</tag>
  <title>Date.yesterday == Date.today</title>
  <updated-at type="datetime">2011-03-31T09:41:34+01:00</updated-at>
  <user-id type="integer">19117</user-id>
  <version type="integer">18</version>
  <user-name>Josh Kalderimis</user-name>
  <creator-name>ericp (at activestate)</creator-name>
  <assigned-user-name>Josh Kalderimis</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
  <priority-name>Medium</priority-name>
  <original-body>Using Ruby 1.9.2p0 and Rails 3.0.3 rails console:

Date.yesterday == Date.today
=&gt; true

This returned false with Rails 2.3.8

Date.tomorrow works correctly.</original-body>
  <latest-body>Using Ruby 1.9.2p0 and Rails 3.0.3 rails console:

Date.yesterday == Date.today
=&gt; true

This returned false with Rails 2.3.8

Date.tomorrow works correctly.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Using Ruby 1.9.2p0 and Rails 3.0.3 rails console:&lt;/p&gt;
&lt;p&gt;Date.yesterday == Date.today&lt;br&gt;
=&amp;gt; true&lt;/p&gt;
&lt;p&gt;This returned false with Rails 2.3.8&lt;/p&gt;
&lt;p&gt;Date.tomorrow works correctly.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Using Ruby 1.9.2p0 and Rails 3.0.3 rails console:

Date.yesterday == Date.today
=&gt; true

This returned false with Rails 2.3.8

Date.tomorrow works correctly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Using Ruby 1.9.2p0 and Rails 3.0.3 rails console:&lt;/p&gt;
&lt;p&gt;Date.yesterday == Date.today&lt;br&gt;
=&amp;gt; true&lt;/p&gt;
&lt;p&gt;This returned false with Rails 2.3.8&lt;/p&gt;
&lt;p&gt;Date.tomorrow works correctly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-11T02:24:38+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;date yesterday today and tomorrow&quot;</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-11T02:24:40+00:00</updated-at>
      <user-id type="integer">62352</user-id>
      <version type="integer">1</version>
      <user-name>ericp (at activestate)</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I cannot replicate this issue on 3-0-stable branch using 1.9.2p136.

This may of been a ruby bug, can you try a different ruby 1.9 patch level and see if you still get incorrect results.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I cannot replicate this issue on 3-0-stable branch using
1.9.2p136.&lt;/p&gt;
&lt;p&gt;This may of been a ruby bug, can you try a different ruby 1.9
patch level and see if you still get incorrect results.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-11T15:16:43+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;\&quot;date yesterday today and tomorrow\&quot;&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-11T15:16:47+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">2</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Bug not observed with
Ruby 1.9.2p0 &amp;&amp; Rails 3.0.4</body>
      <body-html>&lt;div&gt;&lt;p&gt;Bug not observed with&lt;br&gt;
Ruby 1.9.2p0 &amp;amp;&amp;amp; Rails 3.0.4&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-11T19:49:33+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-11T19:49:36+00:00</updated-at>
      <user-id type="integer">62352</user-id>
      <version type="integer">3</version>
      <user-name>ericp (at activestate)</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Like ericp
I cannot replicate this issue with Ruby 1.9.2p0 and Rails 3.04.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Like ericp&lt;br&gt;
I cannot replicate this issue with Ruby 1.9.2p0 and Rails 3.04.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-11T23:34:37+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-11T23:34:42+00:00</updated-at>
      <user-id type="integer">85496</user-id>
      <version type="integer">4</version>
      <user-name>Jon Atack</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>ruby-1.9.2-p0 :002 &gt; Date.yesterday == Date.today
 =&gt; false

ruby 1.9.2p0 (2010-08-18 revision 29036) [i686-linux]
Rails 3.0.3</body>
      <body-html>&lt;div&gt;&lt;p&gt;ruby-1.9.2-p0 :002 &amp;gt; Date.yesterday == Date.today&lt;br&gt;
=&amp;gt; false&lt;/p&gt;
&lt;p&gt;ruby 1.9.2p0 (2010-08-18 revision 29036) [i686-linux]&lt;br&gt;
Rails 3.0.3&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-11T23:42:07+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-11T23:42:13+00:00</updated-at>
      <user-id type="integer">136721</user-id>
      <version type="integer">5</version>
      <user-name>ouzo</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am still doubting its a rails issue.

`Date.yesterday` is very simple code and I don't see rails overriding any date equality methods.

Have you tried updating your ruby patch version?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am still doubting its a rails issue.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Date.yesterday&lt;/code&gt; is very simple code and I don't see
rails overriding any date equality methods.&lt;/p&gt;
&lt;p&gt;Have you tried updating your ruby patch version?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-13T12:56:15+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-13T12:56:24+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">6</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-13T13:59:24+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-13T13:59:33+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">7</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is a subtle one - Date.yesterday uses Date.current which will use the time zone whereas Date.today doesn't. If you set your time zone to one where it's tomorrow already (e.g. Europe/Berlin as I type this) then you can get Date.today == Date.yesterday:

@@@ ruby
&gt;&gt; Time.zone = &quot;Europe/London&quot;
=&gt; &quot;Europe/London&quot;
&gt;&gt; Date.today == Date.yesterday
=&gt; false

&gt;&gt; Time.zone = &quot;Europe/Berlin&quot;
=&gt; &quot;Europe/Berlin&quot;
&gt;&gt; Date.today == Date.yesterday
=&gt; true
@@@

Using Date.current == Date.yesterday works as expected.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is a subtle one - Date.yesterday uses Date.current which
will use the time zone whereas Date.today doesn't. If you set your
time zone to one where it's tomorrow already (e.g. Europe/Berlin as
I type this) then you can get Date.today == Date.yesterday:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Time.zone = &quot;Europe/London&quot;
=&amp;gt; &quot;Europe/London&quot;
&amp;gt;&amp;gt; Date.today == Date.yesterday
=&amp;gt; false

&amp;gt;&amp;gt; Time.zone = &quot;Europe/Berlin&quot;
=&amp;gt; &quot;Europe/Berlin&quot;
&amp;gt;&amp;gt; Date.today == Date.yesterday
=&amp;gt; true&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Using Date.current == Date.yesterday works as expected.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-13T23:55:24+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-13T23:56:18+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">8</version>
      <user-name>Andrew White</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hey Andrew,

Thank you for looking into this further.

It seems its a little bit more complicated than that. In AS date/calculations you will see:

    # Returns a new Date representing the date 1 day ago (i.e. yesterday's date).
    def yesterday
      ::Date.current.yesterday
    end

    # Returns Time.zone.today when config.time_zone is set, otherwise just returns Date.today.
    def current
      ::Time.zone_default ? ::Time.zone.today : ::Date.today
    end

What you will notice is `current` uses `zone_default` which means even if you change `Time.zone` it will have no effect on `current` eg.

   :060 &gt; ::Time.zone_default = nil
   =&gt; nil 
   :061 &gt; Time.zone = &quot;Pacific/Honolulu&quot;
   =&gt; &quot;Pacific/Honolulu&quot; 
   :062 &gt; Date.today
   =&gt; Mon, 14 Feb 2011 
   :063 &gt; Date.yesterday
   =&gt; Sun, 13 Feb 2011 
   :064 &gt; Date.today == Date.yesterday
   =&gt; false 

I am based in Amsterdam, so `today` and `yesterday` are both correct, which shouldn't be the case as I have changed my timezone. 

You are right that `Date.today` doesn't use timezone aware methods, this is part of the problem, the other part is that `Date.current` uses `Time.zone_default` and not `Time.zone` if it is available. A Rails Railtie sets `zone_default` on initialization, so this is why most people do not experience any issues. 

Jos&#233; suggested I get in contact with the creator of the tz_info gem as he added most of this code to Rails, so I will update this ticket when I have some more info.

Thanks for reporting this issue Ericp, and thanks Andrew for figuring out the issue.

Josh</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey Andrew,&lt;/p&gt;
&lt;p&gt;Thank you for looking into this further.&lt;/p&gt;
&lt;p&gt;It seems its a little bit more complicated than that. In AS
date/calculations you will see:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;# Returns a new Date representing the date 1 day ago (i.e. yesterday's date).
def yesterday
  ::Date.current.yesterday
end

# Returns Time.zone.today when config.time_zone is set, otherwise just returns Date.today.
def current
  ::Time.zone_default ? ::Time.zone.today : ::Date.today
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;What you will notice is &lt;code&gt;current&lt;/code&gt; uses
&lt;code&gt;zone_default&lt;/code&gt; which means even if you change
&lt;code&gt;Time.zone&lt;/code&gt; it will have no effect on
&lt;code&gt;current&lt;/code&gt; eg.&lt;/p&gt;
&lt;p&gt;:060 &amp;gt; ::Time.zone_default = nil =&amp;gt; nil :061 &amp;gt;
Time.zone = &quot;Pacific/Honolulu&quot; =&amp;gt; &quot;Pacific/Honolulu&quot; :062 &amp;gt;
Date.today =&amp;gt; Mon, 14 Feb 2011 :063 &amp;gt; Date.yesterday =&amp;gt;
Sun, 13 Feb 2011 :064 &amp;gt; Date.today == Date.yesterday =&amp;gt;
false&lt;/p&gt;
&lt;p&gt;I am based in Amsterdam, so &lt;code&gt;today&lt;/code&gt; and
&lt;code&gt;yesterday&lt;/code&gt; are both correct, which shouldn't be the
case as I have changed my timezone.&lt;/p&gt;
&lt;p&gt;You are right that &lt;code&gt;Date.today&lt;/code&gt; doesn't use timezone
aware methods, this is part of the problem, the other part is that
&lt;code&gt;Date.current&lt;/code&gt; uses &lt;code&gt;Time.zone_default&lt;/code&gt; and
not &lt;code&gt;Time.zone&lt;/code&gt; if it is available. A Rails Railtie sets
&lt;code&gt;zone_default&lt;/code&gt; on initialization, so this is why most
people do not experience any issues.&lt;/p&gt;
&lt;p&gt;Jos&amp;eacute; suggested I get in contact with the creator of the
tz_info gem as he added most of this code to Rails, so I will
update this ticket when I have some more info.&lt;/p&gt;
&lt;p&gt;Thanks for reporting this issue Ericp, and thanks Andrew for
figuring out the issue.&lt;/p&gt;
&lt;p&gt;Josh&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T10:33:30+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 3
:state: needs-more-info
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-14T10:33:41+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">9</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Setting the timezone does have an effect - the ternary operator is just checking for the presence of zone_default but actually uses Time.zone for the calculation, e.g:

@@@ ruby
&gt;&gt; Time.zone = &quot;Europe/London&quot;
=&gt; &quot;Europe/London&quot;
&gt;&gt; Date.current
=&gt; Mon, 14 Feb 2011
&gt;&gt; Date.today
=&gt; Mon, 14 Feb 2011
&gt;&gt; Date.yesterday
=&gt; Sun, 13 Feb 2011
&gt;&gt; Time.zone = &quot;Pacific/Kiritimati&quot;
=&gt; &quot;Pacific/Kiritimati&quot;
&gt;&gt; Date.current
=&gt; Tue, 15 Feb 2011
&gt;&gt; Date.today
=&gt; Mon, 14 Feb 2011
&gt;&gt; Date.yesterday
=&gt; Mon, 14 Feb 2011
@@@

The bug only exhibits itself when the timezone you've set is far enough away from the local time to be in a different day. Pacific/Honolulu is only 10 hours behind UTC, so was in today if you did the test in the preceding half an hour to posting your message.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Setting the timezone does have an effect - the ternary operator
is just checking for the presence of zone_default but actually uses
Time.zone for the calculation, e.g:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Time.zone = &quot;Europe/London&quot;
=&amp;gt; &quot;Europe/London&quot;
&amp;gt;&amp;gt; Date.current
=&amp;gt; Mon, 14 Feb 2011
&amp;gt;&amp;gt; Date.today
=&amp;gt; Mon, 14 Feb 2011
&amp;gt;&amp;gt; Date.yesterday
=&amp;gt; Sun, 13 Feb 2011
&amp;gt;&amp;gt; Time.zone = &quot;Pacific/Kiritimati&quot;
=&amp;gt; &quot;Pacific/Kiritimati&quot;
&amp;gt;&amp;gt; Date.current
=&amp;gt; Tue, 15 Feb 2011
&amp;gt;&amp;gt; Date.today
=&amp;gt; Mon, 14 Feb 2011
&amp;gt;&amp;gt; Date.yesterday
=&amp;gt; Mon, 14 Feb 2011&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The bug only exhibits itself when the timezone you've set is far
enough away from the local time to be in a different day.
Pacific/Honolulu is only 10 hours behind UTC, so was in today if
you did the test in the preceding half an hour to posting your
message.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T11:18:10+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-14T11:18:21+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">10</version>
      <user-name>Andrew White</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi Andrew,

You are right that in a normal app setup `current` would return the current specified zone. But if you are using ActiveSupport and do not set `zone_default` (which is done in a Railtie) then setting `Time.zone` would do nothing. So both of our examples are correct.

Although I need to confirm this, I think two changes need to occur, `Date.current` should check `Time.zone` and not `Time.zone_default`, and `Date.today` needs to be overridden to use use timezones.

Josh</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Andrew,&lt;/p&gt;
&lt;p&gt;You are right that in a normal app setup &lt;code&gt;current&lt;/code&gt;
would return the current specified zone. But if you are using
ActiveSupport and do not set &lt;code&gt;zone_default&lt;/code&gt; (which is
done in a Railtie) then setting &lt;code&gt;Time.zone&lt;/code&gt; would do
nothing. So both of our examples are correct.&lt;/p&gt;
&lt;p&gt;Although I need to confirm this, I think two changes need to
occur, &lt;code&gt;Date.current&lt;/code&gt; should check
&lt;code&gt;Time.zone&lt;/code&gt; and not &lt;code&gt;Time.zone_default&lt;/code&gt;, and
&lt;code&gt;Date.today&lt;/code&gt; needs to be overridden to use use
timezones.&lt;/p&gt;
&lt;p&gt;Josh&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T11:54:55+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-14T11:55:06+00:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">11</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Yes, it's probably safer to test Time.zone - however I don't think we should mess with Date.today as we don't mess with Time.now, e.g:

@@@ ruby
&gt;&gt; Time.zone = &quot;Europe/Berlin&quot;
=&gt; &quot;Europe/Berlin&quot;
&gt;&gt; Time.now
=&gt; Mon Feb 14 12:20:32 +0000 2011
&gt;&gt; Time.current
=&gt; Mon, 14 Feb 2011 13:20:37 CET +01:00
@@@

We probably should just add some documentation on using Time.current and Date.current instead of Time.now and Date.today if you're messing around with time zones.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, it's probably safer to test Time.zone - however I don't
think we should mess with Date.today as we don't mess with
Time.now, e.g:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Time.zone = &quot;Europe/Berlin&quot;
=&amp;gt; &quot;Europe/Berlin&quot;
&amp;gt;&amp;gt; Time.now
=&amp;gt; Mon Feb 14 12:20:32 +0000 2011
&amp;gt;&amp;gt; Time.current
=&amp;gt; Mon, 14 Feb 2011 13:20:37 CET +01:00&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;We probably should just add some documentation on using
Time.current and Date.current instead of Time.now and Date.today if
you're messing around with time zones.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T12:23:12+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-14T12:23:22+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">12</version>
      <user-name>Andrew White</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1 to checking &lt;code&gt;Time.zone&lt;/code&gt;. Otherwise, agree that this is a docs issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 to checking &lt;code&gt;Time.zone&lt;/code&gt;. Otherwise, agree that
this is a docs issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T21:56:24+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-14T22:19:38+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">13</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Replica Tag Watches sell at low prices. Buy Tag Heuer Replica Watches, Fake TAG Heuer Watches please come to our &lt;a href=&quot;http://www.replicawatchesi.com/tag-heuer-watches&quot;&gt;Replica Tag Heuer watches&lt;/a&gt;.Look no further for &lt;a href=&quot;http://www.replicawatchesi.com/&quot;&gt;replica watches&lt;/a&gt;, &lt;a href=&quot;http://www.replicawatchesi.com/&quot;&gt;replica rolex&lt;/a&gt;, &lt;a href=&quot;http://www.replicawatchesi.com/&quot;&gt;replica watches uk&lt;/a&gt;, &lt;a href=&quot;http://www.replicawatchesi.com/breitling-watches&quot;&gt;Replica Breitling watches&lt;/a&gt;, Swiss Replica Rolex, fake watch, and swiss replica watch.Buy Omega Watch, Omega Replicas, Alpha Omega Watches, Ladies Omega Replica Watches from our &lt;a href=&quot;http://www.replicawatchesi.com/omega-watches&quot;&gt;Replica Omega watches&lt;/a&gt; store.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Replica Tag Watches sell at low prices. Buy Tag Heuer Replica
Watches, Fake TAG Heuer Watches please come to our &lt;a href=
&quot;http://www.replicawatchesi.com/tag-heuer-watches&quot;&gt;Replica Tag
Heuer watches&lt;/a&gt;.Look no further for &lt;a href=
&quot;http://www.replicawatchesi.com/&quot;&gt;replica watches&lt;/a&gt;, &lt;a href=
&quot;http://www.replicawatchesi.com/&quot;&gt;replica rolex&lt;/a&gt;, &lt;a href=
&quot;http://www.replicawatchesi.com/&quot;&gt;replica watches uk&lt;/a&gt;, &lt;a href=
&quot;http://www.replicawatchesi.com/breitling-watches&quot;&gt;Replica
Breitling watches&lt;/a&gt;, Swiss Replica Rolex, fake watch, and swiss
replica watch.Buy Omega Watch, Omega Replicas, Alpha Omega Watches,
Ladies Omega Replica Watches from our &lt;a href=
&quot;http://www.replicawatchesi.com/omega-watches&quot;&gt;Replica Omega
watches&lt;/a&gt; store.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-21T14:02:03+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>verified</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-21T14:05:27+00:00</updated-at>
      <user-id type="integer">138022</user-id>
      <version type="integer">14</version>
      <user-name>benben</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [9ba0c7e2164e726b45955a87dfd1173bc4e9fa78]) updated Time, Date and DateTime current methods in AS to use Time.zone and not Time.zone_default.

[#6410 state:committed]
https://github.com/rails/rails/commit/9ba0c7e2164e726b45955a87dfd1173bc4e9fa78</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/9ba0c7e2164e726b45955a87dfd1173bc4e9fa78&quot;
title=
&quot;Changeset [9ba0c7e2164e726b45955a87dfd1173bc4e9fa78]&quot;&gt;[9ba0c7e2164e726b45955a87dfd1173bc4e9fa78]&lt;/a&gt;)
updated Time, Date and DateTime current methods in AS to use
Time.zone and not Time.zone_default.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/6410&quot; title=
&quot;Ticket #6410&quot;&gt;#6410&lt;/a&gt; state:committed] &lt;a href=
&quot;https://github.com/rails/rails/commit/9ba0c7e2164e726b45955a87dfd1173bc4e9fa78&quot;&gt;
https://github.com/rails/rails/commit/9ba0c7e2164e726b45955a87dfd11...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-28T22:07:48+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- 
:state: verified
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-28T22:08:01+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">15</version>
      <user-name>Repository</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [0f8d2794f229175447163d2b5e16d94d2cee5468]) updated Time, Date and DateTime current methods in AS to use Time.zone and not Time.zone_default.

[#6410 state:committed]
https://github.com/rails/rails/commit/0f8d2794f229175447163d2b5e16d94d2cee5468</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/0f8d2794f229175447163d2b5e16d94d2cee5468&quot;
title=
&quot;Changeset [0f8d2794f229175447163d2b5e16d94d2cee5468]&quot;&gt;[0f8d2794f229175447163d2b5e16d94d2cee5468]&lt;/a&gt;)
updated Time, Date and DateTime current methods in AS to use
Time.zone and not Time.zone_default.&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/6410&quot; title=
&quot;Ticket #6410&quot;&gt;#6410&lt;/a&gt; state:committed] &lt;a href=
&quot;https://github.com/rails/rails/commit/0f8d2794f229175447163d2b5e16d94d2cee5468&quot;&gt;
https://github.com/rails/rails/commit/0f8d2794f229175447163d2b5e16d...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-28T22:08:06+00:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-02-28T22:08:25+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">16</version>
      <user-name>Repository</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks for the clarification. I find to be totally unintuitive that we need to use Date.yesterday, Date.current and Date.tomorrow. &quot;Today&quot; seems to be a very good fit between &quot;yesterday&quot; and &quot;tomorrow&quot;. I guess that lot of people would expect that... I guess we will have to live with that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for the clarification. I find to be totally unintuitive
that we need to use Date.yesterday, Date.current and Date.tomorrow.
&quot;Today&quot; seems to be a very good fit between &quot;yesterday&quot; and
&quot;tomorrow&quot;. I guess that lot of people would expect that... I guess
we will have to live with that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-31T09:18:06+01:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-03-31T09:18:19+01:00</updated-at>
      <user-id type="integer">52024</user-id>
      <version type="integer">17</version>
      <user-name>Robert Pankowecki</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19117</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi Robert,

I do agree with you that its a bit confusing that you need to use `Date.current` with `Date.yesterday` instead of `Date.today`, but the general rule of thumb is Rails does not change how Ruby methods work, which `Date.today` is. All we can do is add better documentation and make sure people are aware of the subtle difference. 

Thanks,

Josh</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Robert,&lt;/p&gt;
&lt;p&gt;I do agree with you that its a bit confusing that you need to
use &lt;code&gt;Date.current&lt;/code&gt; with &lt;code&gt;Date.yesterday&lt;/code&gt;
instead of &lt;code&gt;Date.today&lt;/code&gt;, but the general rule of thumb
is Rails does not change how Ruby methods work, which
&lt;code&gt;Date.today&lt;/code&gt; is. All we can do is add better
documentation and make sure people are aware of the subtle
difference.&lt;/p&gt;
&lt;p&gt;Thanks,&lt;/p&gt;
&lt;p&gt;Josh&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-31T09:41:22+01:00</created-at>
      <creator-id type="integer">62352</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">6410</number>
      <permalink>dateyesterday-datetoday</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>active_support core_ext</tag>
      <title>Date.yesterday == Date.today</title>
      <updated-at type="datetime">2011-03-31T09:41:34+01:00</updated-at>
      <user-id type="integer">19117</user-id>
      <version type="integer">18</version>
      <user-name>Josh Kalderimis</user-name>
      <creator-name>ericp (at activestate)</creator-name>
      <assigned-user-name>Josh Kalderimis</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/6410</url>
      <priority-name>Medium</priority-name>
    </version>
  </versions>
</ticket>
