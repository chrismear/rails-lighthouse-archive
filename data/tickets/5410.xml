<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">15316</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-10-31T06:02:33+00:00</created-at>
  <creator-id type="integer">66381</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5410</number>
  <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>patch</tag>
  <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
  <updated-at type="datetime">2010-11-04T22:06:01+00:00</updated-at>
  <user-id type="integer">15316</user-id>
  <version type="integer">17</version>
  <user-name>Aaron Patterson</user-name>
  <creator-name>Jeremy Suriel</creator-name>
  <assigned-user-name>Aaron Patterson</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
  <priority-name>Low</priority-name>
  <original-body>I attached a sample project (testns) which demonstrates the following problem...  In ruby 1.8.7, when chaining named scopes, only 1 query is made as it should.  However, when using the same project under ruby 1.9.2, 2 queries are made for the same command.  Here is the output for both ruby versions:

###script/console output with ruby 1.8.7 (2009-06-12 patchlevel 174) and rails 2.3.8

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.2ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.3ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.0ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@

###script/console output with ruby-1.9.2-p0 and rails 2.3.8 (same output seen with ruby 1.9.2 rc2...not new to p0)

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.1ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.2ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.1ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) 
####TestModel Load (0.2ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  
TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@</original-body>
  <latest-body>I attached a sample project (testns) which demonstrates the following problem...  In ruby 1.8.7, when chaining named scopes, only 1 query is made as it should.  However, when using the same project under ruby 1.9.2, 2 queries are made for the same command.  Here is the output for both ruby versions:

###script/console output with ruby 1.8.7 (2009-06-12 patchlevel 174) and rails 2.3.8

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.2ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.3ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.0ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@

###script/console output with ruby-1.9.2-p0 and rails 2.3.8 (same output seen with ruby 1.9.2 rc2...not new to p0)

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.1ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.2ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.1ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) 
####TestModel Load (0.2ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  
TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I attached a sample project (testns) which demonstrates the
following problem... In ruby 1.8.7, when chaining named scopes,
only 1 query is made as it should. However, when using the same
project under ruby 1.9.2, 2 queries are made for the same command.
Here is the output for both ruby versions:&lt;/p&gt;
&lt;h3&gt;script/console output with ruby 1.8.7 (2009-06-12 patchlevel
174) and rails 2.3.8&lt;/h3&gt;
&lt;p&gt;&amp;gt;&amp;gt;ParentModel.first.test_models.high_priority.ordered SQL
(0.2ms) SET NAMES 'utf8'&lt;br&gt;
SQL (0.1ms) SET SQL_AUTO_IS_NULL=0&lt;br&gt;
ParentModel Load (0.3ms) SELECT * FROM &lt;code&gt;parent_models&lt;/code&gt;
LIMIT 1&lt;br&gt;
ParentModel Columns (1.0ms) SHOW FIELDS FROM
&lt;code&gt;parent_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;TestModel Load (0.3ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1) AND ((priority
&amp;gt; 5) AND (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)) ORDER
BY name asc&lt;/h4&gt;
&lt;p&gt;TestModel Columns (0.9ms) SHOW FIELDS FROM
&lt;code&gt;test_models&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[#&amp;lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;script/console output with ruby-1.9.2-p0 and rails 2.3.8 (same
output seen with ruby 1.9.2 rc2...not new to p0)&lt;/h3&gt;
&lt;p&gt;&amp;gt;&amp;gt;ParentModel.first.test_models.high_priority.ordered SQL
(0.1ms) SET NAMES 'utf8'&lt;br&gt;
SQL (0.1ms) SET SQL_AUTO_IS_NULL=0&lt;br&gt;
ParentModel Load (0.2ms) SELECT * FROM &lt;code&gt;parent_models&lt;/code&gt;
LIMIT 1&lt;br&gt;
ParentModel Columns (1.1ms) SHOW FIELDS FROM
&lt;code&gt;parent_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;TestModel Load (0.3ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)&lt;/h4&gt;
&lt;h4&gt;TestModel Load (0.2ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1) AND ((priority
&amp;gt; 5) AND (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)) ORDER
BY name asc&lt;/h4&gt;
&lt;p&gt;TestModel Columns (0.9ms) SHOW FIELDS FROM
&lt;code&gt;test_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[#&amp;lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I attached a sample project (testns) which demonstrates the following problem...  In ruby 1.8.7, when chaining named scopes, only 1 query is made as it should.  However, when using the same project under ruby 1.9.2, 2 queries are made for the same command.  Here is the output for both ruby versions:

###script/console output with ruby 1.8.7 (2009-06-12 patchlevel 174) and rails 2.3.8

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.2ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.3ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.0ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@

###script/console output with ruby-1.9.2-p0 and rails 2.3.8 (same output seen with ruby 1.9.2 rc2...not new to p0)

\&gt;\&gt;ParentModel.first.test_models.high_priority.ordered
SQL (0.1ms)   SET NAMES 'utf8'
SQL (0.1ms)   SET SQL_AUTO_IS_NULL=0
ParentModel Load (0.2ms)   SELECT * FROM `parent_models` LIMIT 1
ParentModel Columns (1.1ms)   SHOW FIELDS FROM `parent_models`
####TestModel Load (0.3ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) 
####TestModel Load (0.2ms)   SELECT * FROM `test_models` WHERE (`test_models`.parent_model_id = 1) AND ((priority &gt; 5) AND (`test_models`.parent_model_id = 1)) ORDER BY name asc
  
TestModel Columns (0.9ms)   SHOW FIELDS FROM `test_models`
@@@
[#&lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&gt;, #&lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&gt;]
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I attached a sample project (testns) which demonstrates the
following problem... In ruby 1.8.7, when chaining named scopes,
only 1 query is made as it should. However, when using the same
project under ruby 1.9.2, 2 queries are made for the same command.
Here is the output for both ruby versions:&lt;/p&gt;
&lt;h3&gt;script/console output with ruby 1.8.7 (2009-06-12 patchlevel
174) and rails 2.3.8&lt;/h3&gt;
&lt;p&gt;&amp;gt;&amp;gt;ParentModel.first.test_models.high_priority.ordered SQL
(0.2ms) SET NAMES 'utf8'&lt;br&gt;
SQL (0.1ms) SET SQL_AUTO_IS_NULL=0&lt;br&gt;
ParentModel Load (0.3ms) SELECT * FROM &lt;code&gt;parent_models&lt;/code&gt;
LIMIT 1&lt;br&gt;
ParentModel Columns (1.0ms) SHOW FIELDS FROM
&lt;code&gt;parent_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;TestModel Load (0.3ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1) AND ((priority
&amp;gt; 5) AND (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)) ORDER
BY name asc&lt;/h4&gt;
&lt;p&gt;TestModel Columns (0.9ms) SHOW FIELDS FROM
&lt;code&gt;test_models&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[#&amp;lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;script/console output with ruby-1.9.2-p0 and rails 2.3.8 (same
output seen with ruby 1.9.2 rc2...not new to p0)&lt;/h3&gt;
&lt;p&gt;&amp;gt;&amp;gt;ParentModel.first.test_models.high_priority.ordered SQL
(0.1ms) SET NAMES 'utf8'&lt;br&gt;
SQL (0.1ms) SET SQL_AUTO_IS_NULL=0&lt;br&gt;
ParentModel Load (0.2ms) SELECT * FROM &lt;code&gt;parent_models&lt;/code&gt;
LIMIT 1&lt;br&gt;
ParentModel Columns (1.1ms) SHOW FIELDS FROM
&lt;code&gt;parent_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;TestModel Load (0.3ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)&lt;/h4&gt;
&lt;h4&gt;TestModel Load (0.2ms) SELECT * FROM &lt;code&gt;test_models&lt;/code&gt;
WHERE (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1) AND ((priority
&amp;gt; 5) AND (&lt;code&gt;test_models&lt;/code&gt;.parent_model_id = 1)) ORDER
BY name asc&lt;/h4&gt;
&lt;p&gt;TestModel Columns (0.9ms) SHOW FIELDS FROM
&lt;code&gt;test_models&lt;/code&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;[#&amp;lt;TestModel id: 11, name: &quot;a11&quot;, priority: 11, created_at: &quot;2010-08-19 15:20:23&quot;, updated_at: &quot;2010-08-19 15:20:23&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 10, name: &quot;test10&quot;, priority: 10, created_at: &quot;2010-08-19 15:20:11&quot;, updated_at: &quot;2010-08-19 15:20:11&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 6, name: &quot;test6&quot;, priority: 6, created_at: &quot;2010-08-19 15:19:49&quot;, updated_at: &quot;2010-08-19 15:19:49&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 7, name: &quot;test7&quot;, priority: 7, created_at: &quot;2010-08-19 15:19:54&quot;, updated_at: &quot;2010-08-19 15:19:54&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 8, name: &quot;test8&quot;, priority: 8, created_at: &quot;2010-08-19 15:20:00&quot;, updated_at: &quot;2010-08-19 15:20:00&quot;, parent_model_id: 1&amp;gt;, #&amp;lt;TestModel id: 9, name: &quot;test9&quot;, priority: 9, created_at: &quot;2010-08-19 15:20:06&quot;, updated_at: &quot;2010-08-19 15:20:06&quot;, parent_model_id: 1&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-19T17:10:38+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-08-19T17:10:40+01:00</updated-at>
      <user-id type="integer">66381</user-id>
      <version type="integer">1</version>
      <user-name>Jeremy Suriel</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Same Problem here..  It also works fine under 1.9.1p243 but not 1.9.2...

I'm using Rails 2.3.9
----------------------
Group
 has_many :topics, :as =&gt; :discussable  (via a module)

Topic
  belongs_to :discussable, :polymorphic =&gt; true
  named_scope :unhidden,       { :conditions =&gt; ['hidden = ?', false] }

Under rails 1.9.2 without the named_scope this works properly:

&gt;&gt; reload! ; Group.find(56).topics.size

Reloading...
  ...snip show tables etc...
  Group Load (12.8ms)   SELECT * FROM `groups` WHERE (`groups`.`id` = 56)
  Topic Columns (13.6ms)   SHOW FIELDS FROM `topics`
  SQL (81.7ms)   SELECT count(*) AS count_all FROM `topics` WHERE
(`topics`.discussable_id = 56 AND `topics`.discussable_type = 'Group')

However with the named scope in there:

&gt;&gt; reload! ; Group.find(56).topics.unhidden.size

  Group Load (14.3ms)   SELECT * FROM `groups` WHERE (`groups`.`id` = 56)
  *Topic Load (40.1ms)   SELECT * FROM `topics` WHERE
(`topics`.discussable_id = 56 AND `topics`.discussable_type = 'Group') *
  Topic Columns (13.5ms)   SHOW FIELDS FROM `topics`
  SQL (11.8ms)   SELECT count(*) AS count_all FROM `topics` WHERE (((hidden
= 0) AND (`topics`.discussable_id = 56 AND `topics`.discussable_type =
'Group')) AND (`topics`.discussable_id = 56 AND `topics`.discussable_type =
'Group'))

So the problem is under the seond one, it selects all the topics and then
does select count(*).

Under rails 1.9.1p243 this worked correctly in both cases.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same Problem here.. It also works fine under 1.9.1p243 but not
1.9.2...&lt;/p&gt;
&lt;h2&gt;I'm using Rails 2.3.9&lt;/h2&gt;
&lt;p&gt;Group&lt;br&gt;
has_many :topics, :as =&amp;gt; :discussable (via a module)&lt;/p&gt;
&lt;p&gt;Topic&lt;br&gt;
belongs_to :discussable, :polymorphic =&amp;gt; true named_scope
:unhidden, { :conditions =&amp;gt; ['hidden = ?', false] }&lt;/p&gt;
&lt;p&gt;Under rails 1.9.2 without the named_scope this works
properly:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;reload! ; Group.find(56).topics.size&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Reloading...&lt;br&gt;
...snip show tables etc... Group Load (12.8ms) SELECT &lt;em&gt;FROM
&lt;code&gt;groups&lt;/code&gt; WHERE (&lt;code&gt;groups&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; =
56) Topic Columns (13.6ms) SHOW FIELDS FROM &lt;code&gt;topics&lt;/code&gt; SQL
(81.7ms) SELECT count(&lt;/em&gt;) AS count_all FROM &lt;code&gt;topics&lt;/code&gt;
WHERE (&lt;code&gt;topics&lt;/code&gt;.discussable_id = 56 AND
&lt;code&gt;topics&lt;/code&gt;.discussable_type = 'Group')&lt;/p&gt;
&lt;p&gt;However with the named scope in there:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;reload! ; Group.find(56).topics.unhidden.size&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Group Load (14.3ms) SELECT &lt;em&gt;FROM &lt;code&gt;groups&lt;/code&gt; WHERE
(&lt;code&gt;groups&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 56)&lt;/em&gt; Topic Load (40.1ms)
SELECT &lt;em&gt;FROM &lt;code&gt;topics&lt;/code&gt; WHERE
(&lt;code&gt;topics&lt;/code&gt;.discussable_id = 56 AND
&lt;code&gt;topics&lt;/code&gt;.discussable_type = 'Group')&lt;/em&gt; Topic Columns
(13.5ms) SHOW FIELDS FROM &lt;code&gt;topics&lt;/code&gt; SQL (11.8ms) SELECT
count(*) AS count_all FROM &lt;code&gt;topics&lt;/code&gt; WHERE (((hidden = 0)
AND (&lt;code&gt;topics&lt;/code&gt;.discussable_id = 56 AND
&lt;code&gt;topics&lt;/code&gt;.discussable_type = 'Group')) AND
(&lt;code&gt;topics&lt;/code&gt;.discussable_id = 56 AND
&lt;code&gt;topics&lt;/code&gt;.discussable_type = 'Group'))&lt;/p&gt;
&lt;p&gt;So the problem is under the seond one, it selects all the topics
and then&lt;br&gt;
does select count(*).&lt;/p&gt;
&lt;p&gt;Under rails 1.9.1p243 this worked correctly in both cases.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T21:56:50+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-19T21:56:54+01:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">2</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The problem appears to be when on line 146 in association proxy send gets called with &quot;current_scoped_methods&quot;.  This causes  proxy_respond_to to call respond_to? which causes a method missing which causes a load_target to be called by the association collection.  

/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:666:in `find_by_sql'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:1589:in `find_every'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:619:in `find'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:60:in `find'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:425:in `find_target'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:367:in `load_target'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_proxy.rb:219:in `method_missing'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:396:in `method_missing'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:343:in `respond_to?'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:343:in `proxy_respond_to?'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_proxy.rb:146:in `send'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:124:in `initialize'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:90:in `new'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:90:in `block in named_scope'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:399:in `call'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:399:in `method_missing'</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem appears to be when on line 146 in association proxy
send gets called with &quot;current_scoped_methods&quot;. This causes
proxy_respond_to to call respond_to? which causes a method missing
which causes a load_target to be called by the association
collection.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:666:in
&lt;code&gt;find_by_sql'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:1589:in&lt;/code&gt;find_every'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/base.rb:619:in
&lt;code&gt;find'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:60:in&lt;/code&gt;find'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:425:in
&lt;code&gt;find_target'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:367:in&lt;/code&gt;load_target'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_proxy.rb:219:in
&lt;code&gt;method_missing'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:396:in&lt;/code&gt;method_missing'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:343:in
&lt;code&gt;respond_to?'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:343:in&lt;/code&gt;proxy_respond_to?'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_proxy.rb:146:in
&lt;code&gt;send'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:124:in&lt;/code&gt;initialize'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:90:in
&lt;code&gt;new'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/named_scope.rb:90:in&lt;/code&gt;block
in named_scope'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:399:in
&lt;code&gt;call'
/usr/local/ruby19/lib/ruby/gems/1.9.1/gems/activerecord-2.3.9/lib/active_record/associations/association_collection.rb:399:in&lt;/code&gt;method_missing'&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-20T18:06:51+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-20T18:06:52+01:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">3</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sorry about the formatting above =)

The problem is that in association_collection, method missing is getting called with respond_to somewhere is calling respond_to_missing which is causing a new method_missing on the respond_to_missing which triggers the code path which causes the underlying collection to load.  

This doesn't solve the underlying issue (dealing with the new calls to respond_to_missing?) but does act as a workaround:

--- association_collection.rb	2010-10-20 13:22:58.629947001 -0400
+++ /root/association_collection.rb	2010-10-20 13:22:54.509947004 -0400
@@ -390,7 +390,7 @@
             if block_given?
               super { |*block_args| yield(*block_args) }
             else
-              super
+              super unless method.to_s == &quot;respond_to_missing?&quot;
             end
           elsif @reflection.klass.scopes.include?(method)
             @reflection.klass.scopes[method].call(self, *args)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry about the formatting above =)&lt;/p&gt;
&lt;p&gt;The problem is that in association_collection, method missing is
getting called with respond_to somewhere is calling
respond_to_missing which is causing a new method_missing on the
respond_to_missing which triggers the code path which causes the
underlying collection to load.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This doesn't solve the underlying issue (dealing with the new
calls to respond_to_missing?) but does act as a workaround:&lt;/p&gt;
&lt;p&gt;--- association_collection.rb 2010-10-20 13:22:58.629947001
-0400 +++ /root/association_collection.rb 2010-10-20
13:22:54.509947004 -0400 @@ -390,7 +390,7 @@&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;         if block_given?
           super { |*block_args| yield(*block_args) }
         else&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;pre&gt;
&lt;code&gt;       super&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;pre&gt;
&lt;code&gt;       super unless method.to_s == &quot;respond_to_missing?&quot;
     end
   elsif @reflection.klass.scopes.include?(method)
     @reflection.klass.scopes[method].call(self, *args)&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-20T18:31:54+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-20T18:31:57+01:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">4</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Stephen, thanks for the workaround.  I created the attached rails initializer file and the problem seems to be fixed.  I am still concerned however about the new calls to repsond_to_missing as you mentioned, and if this workaround causes issues elsewhere...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Stephen, thanks for the workaround. I created the attached rails
initializer file and the problem seems to be fixed. I am still
concerned however about the new calls to repsond_to_missing as you
mentioned, and if this workaround causes issues elsewhere...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-20T19:31:37+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-20T19:31:38+01:00</updated-at>
      <user-id type="integer">66381</user-id>
      <version type="integer">5</version>
      <user-name>Jeremy Suriel</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Jeremy - 

Most of the places where rails is using method_missing in this morass is guarded by things like:
if @target.respond_to?(method) || (!@reflection.klass.respond_to?(method) &amp;&amp; Class.respond_to?(method)

The only reason this slips through is because responds_to_missing? became a part of the underlying ruby class..

Attached is a proper patch off git.  This same fix should also backported into 2.3.9..</body>
      <body-html>&lt;div&gt;&lt;p&gt;Jeremy -&lt;/p&gt;
&lt;p&gt;Most of the places where rails is using method_missing in this
morass is guarded by things like:&lt;br&gt;
if @target.respond_to?(method) || (&lt;a href=
&quot;mailto:!@reflection.klass.respond&quot;&gt;!@reflection.klass.respond&lt;/a&gt;_to?(method)
&amp;amp;&amp;amp; Class.respond_to?(method)&lt;/p&gt;
&lt;p&gt;The only reason this slips through is because
responds_to_missing? became a part of the underlying ruby
class..&lt;/p&gt;
&lt;p&gt;Attached is a proper patch off git. This same fix should also
backported into 2.3.9..&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-20T19:48:04+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: named_scope &quot;rails 2.3.8&quot; ruby-1.9.2
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-20T19:48:06+01:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">6</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Got it, thanks for the info.  Any idea when/if this patch will be applied to 2.3?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Got it, thanks for the info. Any idea when/if this patch will be
applied to 2.3?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-20T19:56:58+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-20T19:57:00+01:00</updated-at>
      <user-id type="integer">66381</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Suriel</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-22T06:13:54+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-22T06:13:56+01:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">8</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Can anyone run the tests for ActiveRecord under 1.9.2? I can not, and created ticket 5887. I verified that this patch does somewhat speed up my app's testing under 1.9.2, but it's still slow and I would like to profile by running the tests and possibly find a few more places that need 1.9.2 help.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can anyone run the tests for ActiveRecord under 1.9.2? I can
not, and created ticket 5887. I verified that this patch does
somewhat speed up my app's testing under 1.9.2, but it's still slow
and I would like to profile by running the tests and possibly find
a few more places that need 1.9.2 help.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-29T15:12:06+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-29T15:12:08+01:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">9</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Link to ticket #5887
https://rails.lighthouseapp.com/projects/8994/tickets/5887</body>
      <body-html>&lt;div&gt;&lt;p&gt;Link to ticket &lt;a href=&quot;/projects/8994/tickets/5887&quot; title=
&quot;Ticket #5887&quot;&gt;#5887&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/5887&quot;&gt;https://rails.lighthouseapp.com/projects/8994/tickets/5887&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-29T15:12:31+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-29T15:12:33+01:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">10</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Are you looking for Designer Replica Handbags? My-Handbag.com is happy to offer you the best replicas handbags and watches made with high quality materials at lowest price you'll find anywhere.
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;bags replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;handbags fake&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;bags fake&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;Fake bags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;replica handbags Wholesale&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_31.html&quot;&gt;best Fendi handbags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_31.html&quot;&gt;best Fendi bags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_25.html&quot;&gt;Replica Miu miu handbags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_25.html&quot;&gt;Fake Miu miu handbags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_32.html&quot;&gt;Replica Hermes handbags&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_32.html&quot;&gt;Hermes handbags replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_12.html&quot;&gt;Louis Vuitton handbags Replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_15.html&quot;&gt;Chanel handbags Replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_19.html&quot;&gt;Gucci handbags Replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;watches replica&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;cheap watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;designer watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;Swiss watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;mens watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;ladies watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;fake watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;discounted watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;sport watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;wholesale replica watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica swiss watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;knockoff watches&lt;/a&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica watches on sale&lt;/a&gt;
replicasincn.com is dedicated to bring buyers the top grade replica handbags and watches at wholesale price. Here you can find a genuine pool of replica bags and watches with a wide range varieties.
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags fake&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags replica&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags cheap&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags cheap&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags discounted&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags discounted&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_19.html&quot;&gt;replica gucci handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_15.html&quot;&gt;replica chanel handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_12.html&quot;&gt;replica Louis Vuitton handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Cheap handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale replica handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale fake handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale cheap handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale designer handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;replica handbags reviews&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer replica handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer handbags reviews&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;high replica handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;replica handbags reviews&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer knockoff handbags&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;watches replica&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;cheap watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;designer watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;Swiss watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;mens watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;ladies watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;fake watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;discounted watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;sport watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;wholesale replica watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica swiss watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;knockoff watches&lt;/a&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica watches on sale&lt;/a&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;Are you looking for Designer Replica Handbags? My-Handbag.com is
happy to offer you the best replicas handbags and watches made with
high quality materials at lowest price you'll find anywhere.&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;bags replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;handbags fake&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;bags fake&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;Fake bags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/&quot;&gt;replica handbags
Wholesale&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_31.html&quot;&gt;best Fendi
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_31.html&quot;&gt;best Fendi
bags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_25.html&quot;&gt;Replica Miu miu
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_25.html&quot;&gt;Fake Miu miu
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_32.html&quot;&gt;Replica Hermes
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_32.html&quot;&gt;Hermes handbags
replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_12.html&quot;&gt;Louis Vuitton
handbags Replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_15.html&quot;&gt;Chanel handbags
Replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_19.html&quot;&gt;Gucci handbags
Replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;watches
replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;cheap
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;designer
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;Swiss
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;mens
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;ladies
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;fake
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;discounted
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;sport
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;wholesale
replica watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica swiss
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;knockoff
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.my-handbag.com/catalog_111.html&quot;&gt;replica
watches on sale&lt;/a&gt;&lt;br&gt;
replicasincn.com is dedicated to bring buyers the top grade replica
handbags and watches at wholesale price. Here you can find a
genuine pool of replica bags and watches with a wide range
varieties.&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags fake&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags cheap&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags cheap&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;handbags discounted&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;bags discounted&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_19.html&quot;&gt;replica gucci
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_15.html&quot;&gt;replica
chanel handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_12.html&quot;&gt;replica Louis
Vuitton handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Cheap handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale replica
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale fake
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale cheap
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;Wholesale designer
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;replica handbags
reviews&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer replica
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer handbags
reviews&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;high replica
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;replica handbags
reviews&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/&quot;&gt;designer knockoff
handbags&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;watches
replica&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;cheap
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;designer
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;Swiss
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;mens
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;ladies
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;fake
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;discounted
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;sport
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;wholesale
replica watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica
swiss watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;knockoff
watches&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;http://www.replicasincn.com/catalog_111.html&quot;&gt;replica
watches on sale&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-30T07:27:02+01:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-10-31T06:02:33+00:00</updated-at>
      <user-id type="integer">122552</user-id>
      <version type="integer">11</version>
      <user-name>fstory</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-01T17:03:11+00:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: named_scope patch &quot;rails 2.3.8&quot; ruby-1.9.2
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-11-01T17:03:16+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">13</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">94458</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Here's an updated patch that fixes the underlying problem rather than just covering it up.

AssociationProxy does this:
instance_methods.each { |m| undef_method m unless m.to_s =~ /^(?:nil\?|send|object_id|to_a)$|^__|proxy_/ }

Because of this, in Ruby 1.9.2 it will wipe out the default respond_to_missing?

Since the default is gone, it then sends the method call to method_missing

The patch just adds an exception to the regular exception so it preserves respond_to_missing if it exists.  This should be fully compatible with Ruby 1.8.6 since the method doesn't exist in the first place.  It should be trivial to also add the same line to the 2.3.10 codebase to fix the same problem.. (patch is off of git)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's an updated patch that fixes the underlying problem rather
than just covering it up.&lt;/p&gt;
&lt;p&gt;AssociationProxy does this:&lt;br&gt;
instance_methods.each { |m| undef_method m unless m.to_s =~
/^(?:nil\?|send|object_id|to_a)$|^&lt;em&gt;_|proxy&lt;/em&gt;/ }&lt;/p&gt;
&lt;p&gt;Because of this, in Ruby 1.9.2 it will wipe out the default
respond_to_missing?&lt;/p&gt;
&lt;p&gt;Since the default is gone, it then sends the method call to
method_missing&lt;/p&gt;
&lt;p&gt;The patch just adds an exception to the regular exception so it
preserves respond_to_missing if it exists. This should be fully
compatible with Ruby 1.8.6 since the method doesn't exist in the
first place. It should be trivial to also add the same line to the
2.3.10 codebase to fix the same problem.. (patch is off of git)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T18:23:38+00:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
:assigned_user: 14998
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-11-03T18:23:41+00:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">14</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Jeff Kreeftmeijer</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T19:12:32+00:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 94458
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-11-03T19:12:35+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">15</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T20:26:34+00:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-11-03T20:26:37+00:00</updated-at>
      <user-id type="integer">46484</user-id>
      <version type="integer">16</version>
      <user-name>Stephen Blackstone</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Applied.  Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Applied. Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-04T22:05:57+00:00</created-at>
      <creator-id type="integer">66381</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5410</number>
      <permalink>multiple-database-queries-when-chaining-named-scopes-with-rails-238-and-ruby-192</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>patch</tag>
      <title>Multiple database queries when chaining named scopes with rails 2.3.8 and ruby 1.9.2 </title>
      <updated-at type="datetime">2010-11-04T22:06:01+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">17</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Jeremy Suriel</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5410</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>fa6b02709526a8490314e4d80496405d771d2f5e</code>
      <content-type>application/zip</content-type>
      <created-at type="datetime">2010-08-19T17:10:38+01:00</created-at>
      <filename>testns.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">636509</id>
      <size type="integer">100440</size>
      <uploader-id type="integer">66381</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/636509/testns.zip</url>
    </attachment>
    <attachment type="Attachment">
      <code>2fc9e5a54010fc8e27e1c6a3177e82c9bcad845f</code>
      <content-type>text/x-ruby-script</content-type>
      <created-at type="datetime">2010-10-20T19:31:37+01:00</created-at>
      <filename>association_collection.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">729745</id>
      <size type="integer">1372</size>
      <uploader-id type="integer">66381</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/729745/association_collection.rb</url>
    </attachment>
    <attachment type="Attachment">
      <code>3393f631569a050103a683a9947fd72124634c09</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-03T18:23:38+00:00</created-at>
      <filename>5140-final.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">751821</id>
      <size type="integer">1208</size>
      <uploader-id type="integer">46484</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/751821/5140-final.diff</url>
    </attachment>
  </attachments>
</ticket>
