<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-02-21T12:51:14+00:00</created-at>
  <creator-id type="integer">12946</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">3978</number>
  <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag nil="true"></tag>
  <title>In generators #gsub_file should not silently alter files.</title>
  <updated-at type="datetime">2010-02-21T19:23:15+00:00</updated-at>
  <user-id type="integer">19965</user-id>
  <version type="integer">6</version>
  <user-name>Jos&#233; Valim</user-name>
  <creator-name>Sam Goldstein</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
  <priority-name nil="true"></priority-name>
  <original-body>This issue was originally filed in cucumber-rails, but it appears the root issue is actually in Rails' built in generators.  The use of #gsub_file in generator code will overwrite/alter files without providing any indication to the user that it has done so.  Possibly it should call #force_file_collision.

Here is a link to the original cucumber-rails ticket discussing this, and some excerpts from it:

http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15

=============

samg: Running script/generate cucumber rewrites my database.yml file, yet gives no indication that it has done this.

... which was difficult to track down since I had no indication that the generate script would touch database.yml. The resulting error was difficult to trace since database.yml is frequently ignored in SCM; you can't rely on git to tell you it has been altered.

... The generate script should ask before it touches database.yml ...

=============

aslakhellesoy: The generator is using Rails' generator API, more specifically #gsub_file. This method doesn't ask the user about overwrite [Ynaqdh] (the #force_file_collision? method) although I agree it should. The right place to address this is in Rails itself. Please send them a patch or create an issue for it (if it doesn't exist already).</original-body>
  <latest-body>This issue was originally filed in cucumber-rails, but it appears the root issue is actually in Rails' built in generators.  The use of #gsub_file in generator code will overwrite/alter files without providing any indication to the user that it has done so.  Possibly it should call #force_file_collision.

Here is a link to the original cucumber-rails ticket discussing this, and some excerpts from it:

http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15

=============

samg: Running script/generate cucumber rewrites my database.yml file, yet gives no indication that it has done this.

... which was difficult to track down since I had no indication that the generate script would touch database.yml. The resulting error was difficult to trace since database.yml is frequently ignored in SCM; you can't rely on git to tell you it has been altered.

... The generate script should ask before it touches database.yml ...

=============

aslakhellesoy: The generator is using Rails' generator API, more specifically #gsub_file. This method doesn't ask the user about overwrite [Ynaqdh] (the #force_file_collision? method) although I agree it should. The right place to address this is in Rails itself. Please send them a patch or create an issue for it (if it doesn't exist already).</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;This issue was originally filed in cucumber-rails, but it
appears the root issue is actually in Rails' built in generators.
The use of #gsub_file in generator code will overwrite/alter files
without providing any indication to the user that it has done so.
Possibly it should call #force_file_collision.&lt;/p&gt;
&lt;p&gt;Here is a link to the original cucumber-rails ticket discussing
this, and some excerpts from it:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15&quot;&gt;http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;=============&lt;/p&gt;
&lt;p&gt;samg: Running script/generate cucumber rewrites my database.yml
file, yet gives no indication that it has done this.&lt;/p&gt;
&lt;p&gt;... which was difficult to track down since I had no indication
that the generate script would touch database.yml. The resulting
error was difficult to trace since database.yml is frequently
ignored in SCM; you can't rely on git to tell you it has been
altered.&lt;/p&gt;
&lt;p&gt;... The generate script should ask before it touches
database.yml ...&lt;/p&gt;
&lt;p&gt;=============&lt;/p&gt;
&lt;p&gt;aslakhellesoy: The generator is using Rails' generator API, more
specifically #gsub_file. This method doesn't ask the user about
overwrite &lt;a href=&quot;/projects/8994/changesets/Ynaqdh&quot; title=
&quot;Changeset [Ynaqdh]&quot;&gt;[Ynaqdh]&lt;/a&gt; (the #force_file_collision?
method) although I agree it should. The right place to address this
is in Rails itself. Please send them a patch or create an issue for
it (if it doesn't exist already).&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue was originally filed in cucumber-rails, but it appears the root issue is actually in Rails' built in generators.  The use of #gsub_file in generator code will overwrite/alter files without providing any indication to the user that it has done so.  Possibly it should call #force_file_collision.

Here is a link to the original cucumber-rails ticket discussing this, and some excerpts from it:

http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15

=============

samg: Running script/generate cucumber rewrites my database.yml file, yet gives no indication that it has done this.

... which was difficult to track down since I had no indication that the generate script would touch database.yml. The resulting error was difficult to trace since database.yml is frequently ignored in SCM; you can't rely on git to tell you it has been altered.

... The generate script should ask before it touches database.yml ...

=============

aslakhellesoy: The generator is using Rails' generator API, more specifically #gsub_file. This method doesn't ask the user about overwrite [Ynaqdh] (the #force_file_collision? method) although I agree it should. The right place to address this is in Rails itself. Please send them a patch or create an issue for it (if it doesn't exist already).</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue was originally filed in cucumber-rails, but it
appears the root issue is actually in Rails' built in generators.
The use of #gsub_file in generator code will overwrite/alter files
without providing any indication to the user that it has done so.
Possibly it should call #force_file_collision.&lt;/p&gt;
&lt;p&gt;Here is a link to the original cucumber-rails ticket discussing
this, and some excerpts from it:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15&quot;&gt;http://github.com/aslakhellesoy/cucumber-rails/issues/issue/15&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;=============&lt;/p&gt;
&lt;p&gt;samg: Running script/generate cucumber rewrites my database.yml
file, yet gives no indication that it has done this.&lt;/p&gt;
&lt;p&gt;... which was difficult to track down since I had no indication
that the generate script would touch database.yml. The resulting
error was difficult to trace since database.yml is frequently
ignored in SCM; you can't rely on git to tell you it has been
altered.&lt;/p&gt;
&lt;p&gt;... The generate script should ask before it touches
database.yml ...&lt;/p&gt;
&lt;p&gt;=============&lt;/p&gt;
&lt;p&gt;aslakhellesoy: The generator is using Rails' generator API, more
specifically #gsub_file. This method doesn't ask the user about
overwrite &lt;a href=&quot;/projects/8994/changesets/Ynaqdh&quot; title=
&quot;Changeset [Ynaqdh]&quot;&gt;[Ynaqdh]&lt;/a&gt; (the #force_file_collision?
method) although I agree it should. The right place to address this
is in Rails itself. Please send them a patch or create an issue for
it (if it doesn't exist already).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-17T16:04:42+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-17T16:04:47+00:00</updated-at>
      <user-id type="integer">12946</user-id>
      <version type="integer">1</version>
      <user-name>Sam Goldstein</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>gsub_file should not ask for file collision. file_collision is done when you are creating a file in a place where another already exists. For instance, scaffold uses gsub_file to add routes to your config/routes.rb. If it asked every time if you want to modify it or not, it would be painful.

If Cucumber is going risky operation, they should ask their users before:

    if yes?(&quot;Do you want to change your database.yml?&quot;)
      gsub_file ...
    end

Does it make sense?</body>
      <body-html>&lt;div&gt;&lt;p&gt;gsub_file should not ask for file collision. file_collision is
done when you are creating a file in a place where another already
exists. For instance, scaffold uses gsub_file to add routes to your
config/routes.rb. If it asked every time if you want to modify it
or not, it would be painful.&lt;/p&gt;
&lt;p&gt;If Cucumber is going risky operation, they should ask their
users before:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;if yes?(&quot;Do you want to change your database.yml?&quot;)
  gsub_file ...
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Does it make sense?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-21T12:51:14+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-21T12:53:12+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">2</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks Jos&#233; - I wasn't aware of #yes? - I'll use that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Jos&amp;eacute; - I wasn't aware of #yes? - I'll use
that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-21T13:23:55+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-21T13:23:56+00:00</updated-at>
      <user-id type="integer">1302</user-id>
      <version type="integer">3</version>
      <user-name>Aslak Helles&#248;y</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You're welcome! Here is a list of methods that comes from Thor:

http://rdoc.info/rdoc/wycats/thor/blob/4f5da62d135aa10122e8c51f0c0dfa25fbfd293f/Thor/Actions.html

And here are the ones that Rails adds:

http://github.com/rails/rails/tree/master/railties/lib/rails/generators/actions.rb

Regards!</body>
      <body-html>&lt;div&gt;&lt;p&gt;You're welcome! Here is a list of methods that comes from
Thor:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://rdoc.info/rdoc/wycats/thor/blob/4f5da62d135aa10122e8c51f0c0dfa25fbfd293f/Thor/Actions.html&quot;&gt;
http://rdoc.info/rdoc/wycats/thor/blob/4f5da62d135aa10122e8c51f0c0d...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And here are the ones that Rails adds:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/tree/master/railties/lib/rails/generators/actions.rb&quot;&gt;
http://github.com/rails/rails/tree/master/railties/lib/rails/genera...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Regards!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-21T13:33:17+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-21T13:33:19+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">4</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I agree that users (e.g. cucumber) should deal with the prompt/confirmation logic for `gsub_file` since this logic may vary case to case.  It would be nice if `gsub_file` simply output that a change has taken place.  Something like:

`changed    config/database.yml`

This would help end users of generators know that a file had been changes, especially in cases (like database.yml) where it may be excluded from SCM.  It doesn't make sense for each generator to have to roll their own code to tell the user that a file has changed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree that users (e.g. cucumber) should deal with the
prompt/confirmation logic for &lt;code&gt;gsub_file&lt;/code&gt; since this
logic may vary case to case. It would be nice if
&lt;code&gt;gsub_file&lt;/code&gt; simply output that a change has taken place.
Something like:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;changed config/database.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This would help end users of generators know that a file had
been changes, especially in cases (like database.yml) where it may
be excluded from SCM. It doesn't make sense for each generator to
have to roll their own code to tell the user that a file has
changed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-21T18:24:48+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-21T18:24:49+00:00</updated-at>
      <user-id type="integer">12946</user-id>
      <version type="integer">5</version>
      <user-name>Sam Goldstein</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>gsub_file does output. Unless you ask not to.</body>
      <body-html>&lt;div&gt;&lt;p&gt;gsub_file does output. Unless you ask not to.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-02-21T19:23:14+00:00</created-at>
      <creator-id type="integer">12946</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3978</number>
      <permalink>in-generators-gsub_file-should-not-silently-alter-files</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>In generators #gsub_file should not silently alter files.</title>
      <updated-at type="datetime">2010-02-21T19:23:15+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">6</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Sam Goldstein</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3978</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
