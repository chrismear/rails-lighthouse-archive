<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-08T23:12:14+00:00</created-at>
  <creator-id type="integer">40279</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4168</number>
  <permalink>url_for-failing-with-singular-resource</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>url_for</tag>
  <title>url_for failing with singular resource</title>
  <updated-at type="datetime">2010-11-08T23:12:14+00:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">10</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Daniel Lopes</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>High</priority-name>
  <original-body>I'm not sure it's a bug but the behavior is very strange.

If we use some singular resource like:

  map.resource :account

And call form_for or link_to with an instance of Account it generate a very weird url. 

  &lt;%= url_for Account.first %&gt;

Generates something like: /account.%23%3Caccount:0x103629d60%3E

I should right some test for this bug and send a patch or it's desired behavior?</original-body>
  <latest-body>I'm not sure it's a bug but the behavior is very strange.

If we use some singular resource like:

  map.resource :account

And call form_for or link_to with an instance of Account it generate a very weird url. 

  &lt;%= url_for Account.first %&gt;

Generates something like: /account.%23%3Caccount:0x103629d60%3E

I should right some test for this bug and send a patch or it's desired behavior?</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I'm not sure it's a bug but the behavior is very strange.&lt;/p&gt;
&lt;p&gt;If we use some singular resource like:&lt;/p&gt;
&lt;p&gt;map.resource :account&lt;/p&gt;
&lt;p&gt;And call form_for or link_to with an instance of Account it
generate a very weird url.&lt;/p&gt;
&lt;p&gt;&amp;lt;%= url_for Account.first %&amp;gt;&lt;/p&gt;
&lt;p&gt;Generates something like:
/account.%23%3Caccount:0x103629d60%3E&lt;/p&gt;
&lt;p&gt;I should right some test for this bug and send a patch or it's
desired behavior?&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm not sure it's a bug but the behavior is very strange.

If we use some singular resource like:

  map.resource :account

And call form_for or link_to with an instance of Account it generate a very weird url. 

  &lt;%= url_for Account.first %&gt;

Generates something like: /account.%23%3Caccount:0x103629d60%3E

I should right some test for this bug and send a patch or it's desired behavior?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not sure it's a bug but the behavior is very strange.&lt;/p&gt;
&lt;p&gt;If we use some singular resource like:&lt;/p&gt;
&lt;p&gt;map.resource :account&lt;/p&gt;
&lt;p&gt;And call form_for or link_to with an instance of Account it
generate a very weird url.&lt;/p&gt;
&lt;p&gt;&amp;lt;%= url_for Account.first %&amp;gt;&lt;/p&gt;
&lt;p&gt;Generates something like:
/account.%23%3Caccount:0x103629d60%3E&lt;/p&gt;
&lt;p&gt;I should right some test for this bug and send a patch or it's
desired behavior?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-13T22:48:39+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-13T22:48:41+00:00</updated-at>
      <user-id type="integer">40279</user-id>
      <version type="integer">1</version>
      <user-name>Daniel Lopes</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I would suggest this is a bug as it is definitely surprising behaviour. I would expect this to return a similar result to `polymorphic_path`.

Please submit a test + patch if you could.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I would suggest this is a bug as it is definitely surprising
behaviour. I would expect this to return a similar result to
&lt;code&gt;polymorphic_path&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Please submit a test + patch if you could.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T02:09:31+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T02:09:33+00:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">2</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T08:05:58+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T08:06:03+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">3</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Why this bug was assigned to milestone 3.0? It shouldn't be released with Rails 2.3.6?

The problem is with url_for method, when we send a active record object that maps to a singleton resource the url_for try use the instance as format (that's why we have  /account.%23%3Caccount:0x103629d60%3E wich is escaped version of /account.&lt;account:object_id&gt;).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Why this bug was assigned to milestone 3.0? It shouldn't be
released with Rails 2.3.6?&lt;/p&gt;
&lt;p&gt;The problem is with url_for method, when we send a active record
object that maps to a singleton resource the url_for try use the
instance as format (that's why we have
/account.%23%3Caccount:0x103629d60%3E wich is escaped version of
/account.&amp;lt;account:object_id&amp;gt;).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T17:42:42+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T17:42:45+00:00</updated-at>
      <user-id type="integer">40279</user-id>
      <version type="integer">4</version>
      <user-name>Daniel Lopes</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>To be more specific the options passed to url_for is:

{:action=&gt;&quot;show&quot;, :controller=&gt;&quot;accounts&quot;, :format=&gt;#&lt;Account id: 1, name: &quot;minha conta&quot;, created_at: &quot;2010-03-14 00:00:58&quot;, updated_at: &quot;2010-03-14 00:00:58&quot;&gt;, :use_route=&gt;:account, :only_path=&gt;false}</body>
      <body-html>&lt;div&gt;&lt;p&gt;To be more specific the options passed to url_for is:&lt;/p&gt;
&lt;p&gt;{:action=&amp;gt;&quot;show&quot;, :controller=&amp;gt;&quot;accounts&quot;, :format=&amp;gt;#,
:use_route=&amp;gt;:account, :only_path=&amp;gt;false}&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T17:43:58+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T17:44:01+00:00</updated-at>
      <user-id type="integer">40279</user-id>
      <version type="integer">5</version>
      <user-name>Daniel Lopes</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You haven't told which Rails version the bug occurs. Anyway, since we are working in the 3.0 branch, we have higher priority in fixing it on 3.0. You/we could backport the fix later.</body>
      <body-html>&lt;div&gt;&lt;p&gt;You haven't told which Rails version the bug occurs. Anyway,
since we are working in the 3.0 branch, we have higher priority in
fixing it on 3.0. You/we could backport the fix later.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T17:47:21+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T17:47:22+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">6</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks Valim. 

About the bug, it happens because url_for call the named route when you send a record to it. In some context I don't think it's wrong, like this:
account_url #=&gt; &quot;http://www.example.com/account&quot;

and when you send a record (wich don't make sense in this context):
account_url Account.first #=&gt; &quot;http://www.example.com/account.%23%3Caccount:0x102bb9fb0%3E&quot;

But the problem is when you will try to use things like form_for in records that map to singleton resources:

&lt;% form_for @account do |f| %&gt;
 ...
&lt;% end %&gt;


I'm still not sure it's a bug. What do you think?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks Valim.&lt;/p&gt;
&lt;p&gt;About the bug, it happens because url_for call the named route
when you send a record to it. In some context I don't think it's
wrong, like this:&lt;br&gt;
account_url #=&amp;gt; &quot;&lt;a href=
&quot;http://www.example.com/account&quot;&gt;http://www.example.com/account&lt;/a&gt;&quot;&lt;/p&gt;
&lt;p&gt;and when you send a record (wich don't make sense in this
context):&lt;br&gt;
account_url Account.first #=&amp;gt; &quot;&lt;a href=
&quot;http://www.example.com/account.%23%3Caccount:0x102bb9fb0%3E&quot;&gt;http://www.example.com/account.%23%3Caccount:0x102bb9fb0%3E&lt;/a&gt;&quot;&lt;/p&gt;
&lt;p&gt;But the problem is when you will try to use things like form_for
in records that map to singleton resources:&lt;/p&gt;
&lt;p&gt;&amp;lt;% form_for @account do |f| %&amp;gt;&lt;br&gt;
... &amp;lt;% end %&amp;gt;&lt;/p&gt;
&lt;p&gt;I'm still not sure it's a bug. What do you think?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T20:28:28+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T20:28:32+00:00</updated-at>
      <user-id type="integer">40279</user-id>
      <version type="integer">7</version>
      <user-name>Daniel Lopes</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I would regard this is a bug, although this is a known bug. I guess there is not a simple fix for it on Rails 2.3, so the question really is if Rails 3.0 router can help us on this and if so, how hard would be to backport the fix for Rails 2.3.

Josh will be able to tell us.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I would regard this is a bug, although this is a known bug. I
guess there is not a simple fix for it on Rails 2.3, so the
question really is if Rails 3.0 router can help us on this and if
so, how hard would be to backport the fix for Rails 2.3.&lt;/p&gt;
&lt;p&gt;Josh will be able to tell us.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-14T21:03:42+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-14T21:03:46+00:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">8</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is a known limitation.

I don't think there is an easy to implement this either. Then we'd have to deal with the case where you have resources and resource :account.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is a known limitation.&lt;/p&gt;
&lt;p&gt;I don't think there is an easy to implement this either. Then
we'd have to deal with the case where you have resources and
resource :account.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-03-15T14:52:19+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-03-15T14:52:20+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">9</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:48+01:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-10-15T23:01:48+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">10</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is very helpful, but I don't think people who want to [buy meridia](http://www.shoppharmacycounter.com/t-buy-meridia-online.aspx &quot;buy meridia&quot;) agree with me</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is very helpful, but I don't think people who want to
&lt;a href=
&quot;http://www.shoppharmacycounter.com/t-buy-meridia-online.aspx&quot;
title=&quot;buy meridia&quot;&gt;buy meridia&lt;/a&gt; agree with me&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-05T12:02:03+00:00</created-at>
      <creator-id type="integer">40279</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4168</number>
      <permalink>url_for-failing-with-singular-resource</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>url_for</tag>
      <title>url_for failing with singular resource</title>
      <updated-at type="datetime">2010-11-08T23:12:14+00:00</updated-at>
      <user-id type="integer">123554</user-id>
      <version type="integer">11</version>
      <user-name>loco</user-name>
      <creator-name>Daniel Lopes</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4168</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
</ticket>
