<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">4</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-14T07:28:42+00:00</created-at>
  <creator-id type="integer">43149</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4547</number>
  <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
  <title>ActiveSupport #to_json doesn't work with DM</title>
  <updated-at type="datetime">2011-02-14T07:28:42+00:00</updated-at>
  <user-id type="integer">19965</user-id>
  <version type="integer">21</version>
  <user-name>Jos&#233; Valim</user-name>
  <creator-name>siplux</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
  <priority-name>Low</priority-name>
  <original-body>object#to_json will fail with &quot;ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself&quot;
This is due to the usage of &quot;instance_values&quot; in the #as_json method. DM objects carry a _@repository ivar which carries a reference to the original object.

This can be fixed by adding &quot;dm-serializer&quot; to the Gemfile, which implements its own #to_json method.

on line 137 of activesupport/lib/active_support/json/encoding
@@@ ruby
  def as_json(options = nil)
    if respond_to?(:to_hash)
      to_hash
    else
      instance_values
    end
  end
@@@

The following will reproduce the issue
@@@ ruby
require 'dm-core'
require 'active_support'
require 'active_support/json'
class Foo
  include DataMapper::Resource
  property :id, Serial
  property :name, String
end
DataMapper.setup(:default, 'sqlite3::memory:')
DataMapper.auto_migrate!
Foo.create(:name =&gt; &quot;foo&quot;).to_json
@@@</original-body>
  <latest-body>object#to_json will fail with &quot;ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself&quot;
This is due to the usage of &quot;instance_values&quot; in the #as_json method. DM objects carry a _@repository ivar which carries a reference to the original object.

This can be fixed by adding &quot;dm-serializer&quot; to the Gemfile, which implements its own #to_json method.

on line 137 of activesupport/lib/active_support/json/encoding
@@@ ruby
  def as_json(options = nil)
    if respond_to?(:to_hash)
      to_hash
    else
      instance_values
    end
  end
@@@

The following will reproduce the issue
@@@ ruby
require 'dm-core'
require 'active_support'
require 'active_support/json'
class Foo
  include DataMapper::Resource
  property :id, Serial
  property :name, String
end
DataMapper.setup(:default, 'sqlite3::memory:')
DataMapper.auto_migrate!
Foo.create(:name =&gt; &quot;foo&quot;).to_json
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;object#to_json will fail with
&quot;ActiveSupport::JSON::Encoding::CircularReferenceError: object
references itself&quot;&lt;br&gt;
This is due to the usage of &quot;instance_values&quot; in the #as_json
method. DM objects carry a _@repository ivar which carries a
reference to the original object.&lt;/p&gt;
&lt;p&gt;This can be fixed by adding &quot;dm-serializer&quot; to the Gemfile,
which implements its own #to_json method.&lt;/p&gt;
&lt;p&gt;on line 137 of
activesupport/lib/active_support/json/encoding&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  def as_json(options = nil)&lt;br&gt;
&lt;br&gt;


&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&lt;code&gt;if respond_to?(:to_hash)
  to_hash
else
  instance_values
end&lt;/code&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;


&lt;br&gt;
  end
&lt;/pre&gt;
&lt;p&gt;The following will reproduce the issue&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;require 'dm-core'
require 'active_support'
require 'active_support/json'
class Foo
  include DataMapper::Resource
  property :id, Serial
  property :name, String
end
DataMapper.setup(:default, 'sqlite3::memory:')
DataMapper.auto_migrate!
Foo.create(:name =&amp;gt; &quot;foo&quot;).to_json&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>object#to_json will fail with &quot;ActiveSupport::JSON::Encoding::CircularReferenceError: object references itself&quot;
This is due to the usage of &quot;instance_values&quot; in the #as_json method. DM objects carry a _@repository ivar which carries a reference to the original object.

This can be fixed by adding &quot;dm-serializer&quot; to the Gemfile, which implements its own #to_json method.

on line 137 of activesupport/lib/active_support/json/encoding
@@@ ruby
  def as_json(options = nil)
    if respond_to?(:to_hash)
      to_hash
    else
      instance_values
    end
  end
@@@

The following will reproduce the issue
@@@ ruby
require 'dm-core'
require 'active_support'
require 'active_support/json'
class Foo
  include DataMapper::Resource
  property :id, Serial
  property :name, String
end
DataMapper.setup(:default, 'sqlite3::memory:')
DataMapper.auto_migrate!
Foo.create(:name =&gt; &quot;foo&quot;).to_json
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;object#to_json will fail with
&quot;ActiveSupport::JSON::Encoding::CircularReferenceError: object
references itself&quot;&lt;br&gt;
This is due to the usage of &quot;instance_values&quot; in the #as_json
method. DM objects carry a _@repository ivar which carries a
reference to the original object.&lt;/p&gt;
&lt;p&gt;This can be fixed by adding &quot;dm-serializer&quot; to the Gemfile,
which implements its own #to_json method.&lt;/p&gt;
&lt;p&gt;on line 137 of
activesupport/lib/active_support/json/encoding&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;  def as_json(options = nil)&lt;br&gt;
&lt;br&gt;


&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&lt;code&gt;if respond_to?(:to_hash)
  to_hash
else
  instance_values
end&lt;/code&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;


&lt;br&gt;
  end
&lt;/pre&gt;
&lt;p&gt;The following will reproduce the issue&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;require 'dm-core'
require 'active_support'
require 'active_support/json'
class Foo
  include DataMapper::Resource
  property :id, Serial
  property :name, String
end
DataMapper.setup(:default, 'sqlite3::memory:')
DataMapper.auto_migrate!
Foo.create(:name =&amp;gt; &quot;foo&quot;).to_json&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-06T22:55:06+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-06T22:56:16+01:00</updated-at>
      <user-id type="integer">43149</user-id>
      <version type="integer">1</version>
      <user-name>siplux</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-08T23:46:09+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: datamapper rails3 &quot;rails3 compatibility&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-08T23:46:10+01:00</updated-at>
      <user-id type="integer">43149</user-id>
      <version type="integer">2</version>
      <user-name>siplux</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-09T18:36:20+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport datamapper rails3 &quot;rails3 compatibility&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-09T18:36:21+01:00</updated-at>
      <user-id type="integer">22242</user-id>
      <version type="integer">3</version>
      <user-name>Dan Pickett</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I also have this with ActiveRecord</body>
      <body-html>&lt;div&gt;&lt;p&gt;I also have this with ActiveRecord&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T12:09:44+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-11T12:09:46+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">4</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@lawrence  Can you provide an example where you are running into same problem with ActiveRecord.

I am able to reproduce this error with DM.

I guess if one of the instance variables refers back to the original object as is the case with the first example provided then I see two choices.

1) Let use pass an option :ignore_circular_reference =&gt; true. In this case in stead of raising an error, to_json method will ignore the circular reference and will move on.

2) Let user pass an option :ignore_items =&gt; _my_intance_variable. This will provide more control to user and rather than ignoring all circular references, user is asking to_json to ignore just this variable.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@lawrence Can you provide an example where you are running into
same problem with ActiveRecord.&lt;/p&gt;
&lt;p&gt;I am able to reproduce this error with DM.&lt;/p&gt;
&lt;p&gt;I guess if one of the instance variables refers back to the
original object as is the case with the first example provided then
I see two choices.&lt;/p&gt;
&lt;p&gt;1) Let use pass an option :ignore_circular_reference =&amp;gt; true.
In this case in stead of raising an error, to_json method will
ignore the circular reference and will move on.&lt;/p&gt;
&lt;p&gt;2) Let user pass an option :ignore_items =&amp;gt;
_my_intance_variable. This will provide more control to user and
rather than ignoring all circular references, user is asking
to_json to ignore just this variable.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-11T14:44:13+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-11T14:44:14+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">5</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I hit the same thing with my models. 
In my case, it fails if i attempt to call to_json on an activerelation object (i.e. church.where().to_json), but works if i do church.where().to_a.to_json

my model is:

class Church &lt; ActiveRecord::Base
  has_many :people
  has_many :groups
  validates_presence_of :name
end

The only property it has is name.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I hit the same thing with my models.&lt;br&gt;
In my case, it fails if i attempt to call to_json on an
activerelation object (i.e. church.where().to_json), but works if i
do church.where().to_a.to_json&lt;/p&gt;
&lt;p&gt;my model is:&lt;/p&gt;
&lt;p&gt;class Church &amp;lt; ActiveRecord::Base&lt;br&gt;
has_many :people has_many :groups validates_presence_of :name
end&lt;/p&gt;
&lt;p&gt;The only property it has is name.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-12T06:03:41+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-12T06:03:46+01:00</updated-at>
      <user-id type="integer">98737</user-id>
      <version type="integer">6</version>
      <user-name>blackgold9</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can someone provide a failing test using ActiveRecord? i've tried the thing that blackgold9 said but works for me ...
http://pastie.org/957044</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can someone provide a failing test using ActiveRecord? i've
tried the thing that blackgold9 said but works for me ...&lt;br&gt;
&lt;a href=&quot;http://pastie.org/957044&quot;&gt;http://pastie.org/957044&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-12T15:25:40+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-12T15:25:41+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Please provide a test case and patch for this issue.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Please provide a test case and patch for this issue.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-13T23:56:21+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-13T23:56:23+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">8</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The issue here is that ActiveSupport defines `Object#to_json`, and therefore `Post.where.to_json` tries to dump the ActiveRecord::Relation object instead of passing the method call on to it's internal collection. Note, this also applies to `Object#to_yaml`:

@@@ ruby
# script/rails console
include Test::Unit::Assertions

relation = Post.where # or Post.where(:author_id =&gt; 1), etc.

assert_nothing_raised(ActiveSupport::JSON::Encoding::CircularReferenceError) { relation.to_json } # fails
assert_nothing_raised(TypeError) { relation.to_yaml } # fails

ActiveRecord::Relation.send(:undef_method, :to_json)
ActiveRecord::Relation.send(:undef_method, :to_yaml)

assert_equal relation.to_a.to_json, relation.to_json # and now passes
assert_equal relation.to_a.to_yaml, relation.to_yaml # and now passes
@@@

This is important because it causes the following code to generate a 500 when requesting `/posts/mine.json`:

@@@ ruby
class PostsController &lt; ApplicationController
  respond_to :html, :xml, :json
  def mine
    @posts = Posts.where(:author_id =&gt; 1)
    respond_with(@clients)
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;The issue here is that ActiveSupport defines
&lt;code&gt;Object#to_json&lt;/code&gt;, and therefore
&lt;code&gt;Post.where.to_json&lt;/code&gt; tries to dump the
ActiveRecord::Relation object instead of passing the method call on
to it's internal collection. Note, this also applies to
&lt;code&gt;Object#to_yaml&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;# script/rails console
include Test::Unit::Assertions

relation = Post.where # or Post.where(:author_id =&amp;gt; 1), etc.

assert_nothing_raised(ActiveSupport::JSON::Encoding::CircularReferenceError) { relation.to_json } # fails
assert_nothing_raised(TypeError) { relation.to_yaml } # fails

ActiveRecord::Relation.send(:undef_method, :to_json)
ActiveRecord::Relation.send(:undef_method, :to_yaml)

assert_equal relation.to_a.to_json, relation.to_json # and now passes
assert_equal relation.to_a.to_yaml, relation.to_yaml # and now passes&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This is important because it causes the following code to
generate a 500 when requesting &lt;code&gt;/posts/mine.json&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class PostsController &amp;lt; ApplicationController
  respond_to :html, :xml, :json
  def mine
    @posts = Posts.where(:author_id =&amp;gt; 1)
    respond_with(@clients)
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-25T00:35:43+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-05-25T00:35:49+01:00</updated-at>
      <user-id type="integer">1832</user-id>
      <version type="integer">9</version>
      <user-name>Bernerd Schaefer</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Requiring &quot;json/pure&quot; solves the problem for DataMapper, you just need to implement to_json for your models (or for DataMapper::Model).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Requiring &quot;json/pure&quot; solves the problem for DataMapper, you
just need to implement to_json for your models (or for
DataMapper::Model).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-10T10:53:19+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-10T10:53:28+01:00</updated-at>
      <user-id type="integer">34912</user-id>
      <version type="integer">10</version>
      <user-name>Marcin Kulik</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>What Bernerd says.. exactly the issue I have. None of my controllers work when a json request is done. You'd think this workaround would work:

@@@ ruby
   def mine
     @posts = Posts.where(:author_id =&gt; 1).all
     respond_with(@posts)
   end
@@@

But that too fails in rails edge since a while, with &quot;ArgumentError: wrong number of arguments (2 for 1)&quot;. Posts.where(:author_id =&gt; 1).to_yaml does work, Posts.where(:author_id =&gt; 1).to_json doesn't. I attempted to create a patch, but for some reason the delegation of to_json to to_a in ActiveRecord::Relation doesn't work. Anybody else have an idea?

(see attached what I tried; I also tried what Bernerd did, undef_method of to_json, same result)</body>
      <body-html>&lt;div&gt;&lt;p&gt;What Bernerd says.. exactly the issue I have. None of my
controllers work when a json request is done. You'd think this
workaround would work:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;   def mine
     @posts = Posts.where(:author_id =&amp;gt; 1).all
     respond_with(@posts)
   end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;But that too fails in rails edge since a while, with
&quot;ArgumentError: wrong number of arguments (2 for 1)&quot;.
Posts.where(:author_id =&amp;gt; 1).to_yaml does work,
Posts.where(:author_id =&amp;gt; 1).to_json doesn't. I attempted to
create a patch, but for some reason the delegation of to_json to
to_a in ActiveRecord::Relation doesn't work. Anybody else have an
idea?&lt;/p&gt;
&lt;p&gt;(see attached what I tried; I also tried what Bernerd did,
undef_method of to_json, same result)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-10T12:28:45+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-10T12:28:53+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">11</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Attached is a patch along with test which makes it possible to have code like

@@@ ruby
User.where(:name =&gt; 'John').to_json
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is a patch along with test which makes it possible to
have code like&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;User.where(:name =&amp;gt; 'John').to_json&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-10T16:07:32+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport bugmash datamapper rails3 &quot;rails3 compatibility&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-10T16:07:46+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">12</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm not sure if we should allow Post.where(:omg).to_json. If so, what about to_xml? And to_yaml?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not sure if we should allow Post.where(:omg).to_json. If so,
what about to_xml? And to_yaml?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-10T18:59:40+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-10T18:59:48+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">13</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I am having this same issue with a named scope. 

Given this model:

    class Listing &lt; ActiveRecord::Base
      belongs_to :company
      scope :approved, lambda {
        where(&quot;approved = ?&quot;, true)
      }
    end

And this controller: 

    def index
      @listings = Listing.all
      @approved = Listing.approved
      ...
    end


This works: 

    respond_to do |format|
      format.json { render :json =&gt; @listings }
    end

Whereas using the named scope fails with a CircularReferenceError: 

    respond_to do |format|
      format.json { render :json =&gt; @approved }
    end

Note: this is in Rails3b3</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am having this same issue with a named scope.&lt;/p&gt;
&lt;p&gt;Given this model:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Listing &amp;lt; ActiveRecord::Base
  belongs_to :company
  scope :approved, lambda {
    where(&quot;approved = ?&quot;, true)
  }
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And this controller:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def index
  @listings = Listing.all
  @approved = Listing.approved
  ...
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This works:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;respond_to do |format|
  format.json { render :json =&amp;gt; @listings }
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Whereas using the named scope fails with a
CircularReferenceError:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;respond_to do |format|
  format.json { render :json =&amp;gt; @approved }
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Note: this is in Rails3b3&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-22T02:20:48+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activesupport bugmash datamapper patch rails3 &quot;rails3 compatibility&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-22T02:20:56+01:00</updated-at>
      <user-id type="integer">104141</user-id>
      <version type="integer">14</version>
      <user-name>Ola Tuvesson</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This is still an issue with DataMapper 1.0.0 and Rails3 beta4. The above work-arounds using json/pure or dm-serializers don't work for me.

The test script by the original poster still fails.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is still an issue with DataMapper 1.0.0 and Rails3 beta4.
The above work-arounds using json/pure or dm-serializers don't work
for me.&lt;/p&gt;
&lt;p&gt;The test script by the original poster still fails.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-22T23:22:53+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-22T23:23:00+01:00</updated-at>
      <user-id type="integer">18801</user-id>
      <version type="integer">15</version>
      <user-name>Dan Sully</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Attached is patch with test.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is patch with test.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-23T15:09:13+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-23T15:09:32+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">16</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Attached is patch with to_xml support. This patch needs be applied in addition to the patch previously mentioned.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attached is patch with to_xml support. This patch needs be
applied in addition to the patch previously mentioned.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-23T16:56:55+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-23T16:57:30+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">17</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>(from [eb04408a20628a49296e0859425940b39a83ec63]) ActiveRecord's relation object should respond to to_json and to_yaml

[#4547 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/eb04408a20628a49296e0859425940b39a83ec63</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/eb04408a20628a49296e0859425940b39a83ec63&quot;
title=
&quot;Changeset [eb04408a20628a49296e0859425940b39a83ec63]&quot;&gt;[eb04408a20628a49296e0859425940b39a83ec63]&lt;/a&gt;)
ActiveRecord's relation object should respond to to_json and
to_yaml&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/4547&quot; title=
&quot;Ticket #4547&quot;&gt;#4547&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a href=
&quot;mailto:jose.valim@gmail.com&quot;&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/eb04408a20628a49296e0859425940b39a83ec63&quot;&gt;
http://github.com/rails/rails/commit/eb04408a20628a49296e0859425940...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-23T17:17:37+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:state: incomplete
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-23T17:17:44+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">18</version>
      <user-name>Repository</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>How above ActiveRecord patch is supposed to solve serializing DataMapper objects??</body>
      <body-html>&lt;div&gt;&lt;p&gt;How above ActiveRecord patch is supposed to solve serializing
DataMapper objects??&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-23T19:20:18+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-23T19:20:38+01:00</updated-at>
      <user-id type="integer">34912</user-id>
      <version type="integer">19</version>
      <user-name>Marcin Kulik</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Hahahaha! The patch was not supposed to close this issue, it just solves another issue raise in this same thread. Reopening.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hahahaha! The patch was not supposed to close this issue, it
just solves another issue raise in this same thread. Reopening.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-23T19:25:01+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-23T19:25:09+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">20</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>About Datamapper: you need to define a as_json implementation for your models, otherwise Rails will use the default implementation causing the errors you mentioned. Maybe, dm-rails guys, could include a default as_json implementation. But I cannot see anything Rails could do here.</body>
      <body-html>&lt;div&gt;&lt;p&gt;About Datamapper: you need to define a as_json implementation
for your models, otherwise Rails will use the default
implementation causing the errors you mentioned. Maybe, dm-rails
guys, could include a default as_json implementation. But I cannot
see anything Rails could do here.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-26T10:49:59+01:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2010-06-26T10:50:06+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">21</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>thank you very much......&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/&quot;&gt;&#1605;&#1606;&#1578;&#1583;&#1610;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&#1605;&#1603;&#1610;&#1575;&#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1575;&#1586;&#1610;&#1575;&#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1601;&#1587;&#1575;&#1578;&#1610;&#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&#1585;&#1587;&#1575;&#1574;&#1604; 
- &#1605;&#1587;&#1580;&#1575;&#1578; - &#1608;&#1587;&#1575;&#1574;&#1591;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&#1578;&#1608;&#1576;&#1610;&#1603;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&#1608;&#1592;&#1575;&#1574;&#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&#1576;&#1585;&#1608;&#1603;&#1587;&#1610;&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=&quot;http://forum.line-sport.tv/&quot;&gt;&#1604;&#1575;&#1610;&#1606; &#1587;&#1576;&#1608;&#1585;&#1578;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;thank you very much......&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/&quot;&gt;&amp;#1605;&amp;#1606;&amp;#1578;&amp;#1583;&amp;#1610;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&amp;#1605;&amp;#1603;&amp;#1610;&amp;#1575;&amp;#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1575;&amp;#1586;&amp;#1610;&amp;#1575;&amp;#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1601;&amp;#1587;&amp;#1575;&amp;#1578;&amp;#1610;&amp;#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&amp;#1585;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1604;&lt;br&gt;
- &amp;#1605;&amp;#1587;&amp;#1580;&amp;#1575;&amp;#1578; -
&amp;#1608;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1591;&lt;/a&gt;&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&amp;#1578;&amp;#1608;&amp;#1576;&amp;#1610;&amp;#1603;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&amp;#1608;&amp;#1592;&amp;#1575;&amp;#1574;&amp;#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt;
&lt;a href=
&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&amp;#1576;&amp;#1585;&amp;#1608;&amp;#1603;&amp;#1587;&amp;#1610;&lt;/a&gt;
&lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=
&quot;http://forum.line-sport.tv/&quot;&gt;&amp;#1604;&amp;#1575;&amp;#1610;&amp;#1606;
&amp;#1587;&amp;#1576;&amp;#1608;&amp;#1585;&amp;#1578;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-08T11:26:34+00:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2011-02-08T12:16:10+00:00</updated-at>
      <user-id type="integer">136126</user-id>
      <version type="integer">22</version>
      <user-name>alasiri1</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You may also study the actual seems inside the Pandora charms as a result &lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;of add-on including cherished jewels, crimson along with amethyst,&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; whichever satisfies ones money your identity. In order a lot more solutions, it is best to look at silver charms provided simply by Pandora.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&#160;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; Couldn't everyone appearance great understand a majority of these &lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;earrings which can be created together with your manufacturer,&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; initials or simply brief?</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You
may also study the actual seems inside the Pandora charms as a
result &lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora
NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;of add-on including cherished jewels, crimson
along with amethyst,&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras
Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; whichever satisfies ones money your
identity. In order a lot more solutions, it is best to look at
silver charms provided simply by Pandora.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&amp;nbsp;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;
Couldn't everyone appearance great understand a majority of these
&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora
NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;earrings which can be created together with
your manufacturer,&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora
ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; initials or simply brief?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-14T06:09:38+00:00</created-at>
      <creator-id type="integer">43149</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4547</number>
      <permalink>activesupport-to_json-doesnt-work-with-dm</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>activesupport bugmash datamapper &quot;json to_json&quot; patch rails3 &quot;rails3 compatibility&quot;</tag>
      <title>ActiveSupport #to_json doesn't work with DM</title>
      <updated-at type="datetime">2011-02-14T07:28:42+00:00</updated-at>
      <user-id type="integer">136876</user-id>
      <version type="integer">23</version>
      <user-name>pandora jewellry</user-name>
      <creator-name>siplux</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4547</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>2514ee5fac2df8ebd8462de8e095c3e20922d5c8</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-10T12:28:45+01:00</created-at>
      <filename>relation_to_json.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">554115</id>
      <size type="integer">1588</size>
      <uploader-id type="integer">20836</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/554115/relation_to_json.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f446065325da9384d354763094cc47068ae46911</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-10T16:07:32+01:00</created-at>
      <filename>4547_fix_against_master.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">554442</id>
      <size type="integer">1457</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/554442/4547_fix_against_master.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>da109d3b46a3f05b4f952cb6d985af5dd987f418</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-23T15:09:13+01:00</created-at>
      <filename>4547_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">570448</id>
      <size type="integer">1733</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/570448/4547_fix.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>93c8ea378f412db0fedb1baf259592d17cfd1592</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-23T16:56:55+01:00</created-at>
      <filename>to_xml_fix.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">570685</id>
      <size type="integer">1601</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/570685/to_xml_fix.diff</url>
    </attachment>
  </attachments>
</ticket>
