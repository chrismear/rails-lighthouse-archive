<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-08-10T21:18:46+01:00</created-at>
  <creator-id type="integer">28618</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">796</number>
  <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
  <priority type="integer">257</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>activerecord patch tiny</tag>
  <title>A small modification at ActiveRecord's calculations.rb</title>
  <updated-at type="datetime">2008-10-22T11:50:42+01:00</updated-at>
  <user-id type="integer">3839</user-id>
  <version type="integer">12</version>
  <user-name>Raimonds Simanovskis</user-name>
  <creator-name>Michalis Polakis</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Hello,

by adding at calculations.rb

line 208 : sql &lt;&lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround

More legitimate sql code is generated, and a bug for the newly
developed and distributed MonetDB adapter is solved.

MonetDB prints this message :

!subquery table reference needs alias, use AS xxx in: &quot;select count(*)
as count_all from (select distinct &quot;accounts&quot;.id from &quot;accounts&quot;  left
outer join &quot;companies&quot; on &quot;companies&quot;.id = &quot;accounts&quot;.firm_id and
&quot;companies&quot;.&quot;type&quot; = 'Firm'   where (companies.id &gt; 1) );&quot;

Could this modification be added in the ActiveRecord code?


By the way, (this is not intended to be spam), I've developed an activerecord adapter for MonetDB.
MonetDB is an open source, high-performance column-store database management system with automatic index management, flexible optimizer infrastructure, and programmable backend functionality. It comes with functional complete SQL- and XQuery- frontends.

To find out more about MonetDB visit monetdb.cwi.nl and to get the adapter visit http://rubyforge.org/projects/monetdb-ror/


Thanks,
Michalis Polakis</original-body>
  <latest-body>Hello,

by adding at calculations.rb

line 208 : sql &lt;&lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround

More legitimate sql code is generated, and a bug for the newly
developed and distributed MonetDB adapter is solved.

MonetDB prints this message :

!subquery table reference needs alias, use AS xxx in: &quot;select count(*)
as count_all from (select distinct &quot;accounts&quot;.id from &quot;accounts&quot;  left
outer join &quot;companies&quot; on &quot;companies&quot;.id = &quot;accounts&quot;.firm_id and
&quot;companies&quot;.&quot;type&quot; = 'Firm'   where (companies.id &gt; 1) );&quot;

Could this modification be added in the ActiveRecord code?


By the way, (this is not intended to be spam), I've developed an activerecord adapter for MonetDB.
MonetDB is an open source, high-performance column-store database management system with automatic index management, flexible optimizer infrastructure, and programmable backend functionality. It comes with functional complete SQL- and XQuery- frontends.

To find out more about MonetDB visit monetdb.cwi.nl and to get the adapter visit http://rubyforge.org/projects/monetdb-ror/


Thanks,
Michalis Polakis</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;by adding at calculations.rb&lt;/p&gt;

&lt;p&gt;line 208 : sql &amp;lt;&amp;lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround&lt;/p&gt;

&lt;p&gt;More legitimate sql code is generated, and a bug for the newly
developed and distributed MonetDB adapter is solved.&lt;/p&gt;

&lt;p&gt;MonetDB prints this message :&lt;/p&gt;

&lt;p&gt;!subquery table reference needs alias, use AS xxx in: &quot;select count(*)
as count_all from (select distinct &quot;accounts&quot;.id from &quot;accounts&quot;  left
outer join &quot;companies&quot; on &quot;companies&quot;.id = &quot;accounts&quot;.firm_id and
&quot;companies&quot;.&quot;type&quot; = 'Firm'   where (companies.id &gt; 1) );&quot;&lt;/p&gt;

&lt;p&gt;Could this modification be added in the ActiveRecord code?&lt;/p&gt;

&lt;p&gt;By the way, (this is not intended to be spam), I've developed an activerecord adapter for MonetDB.
MonetDB is an open source, high-performance column-store database management system with automatic index management, flexible optimizer infrastructure, and programmable backend functionality. It comes with functional complete SQL- and XQuery- frontends.&lt;/p&gt;

&lt;p&gt;To find out more about MonetDB visit monetdb.cwi.nl and to get the adapter visit &lt;a href=&quot;http://rubyforge.org/projects/monetdb-ror/&quot;&gt;http://rubyforge.org/projects/mo...&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,
Michalis Polakis&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello,

by adding at calculations.rb

line 208 : sql &lt;&lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround

More legitimate sql code is generated, and a bug for the newly
developed and distributed MonetDB adapter is solved.

MonetDB prints this message :

!subquery table reference needs alias, use AS xxx in: &quot;select count(*)
as count_all from (select distinct &quot;accounts&quot;.id from &quot;accounts&quot;  left
outer join &quot;companies&quot; on &quot;companies&quot;.id = &quot;accounts&quot;.firm_id and
&quot;companies&quot;.&quot;type&quot; = 'Firm'   where (companies.id &gt; 1) );&quot;

Could this modification be added in the ActiveRecord code?


By the way, (this is not intended to be spam), I've developed an activerecord adapter for MonetDB.
MonetDB is an open source, high-performance column-store database management system with automatic index management, flexible optimizer infrastructure, and programmable backend functionality. It comes with functional complete SQL- and XQuery- frontends.

To find out more about MonetDB visit monetdb.cwi.nl and to get the adapter visit http://rubyforge.org/projects/monetdb-ror/


Thanks,
Michalis Polakis</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;by adding at calculations.rb&lt;/p&gt;

&lt;p&gt;line 208 : sql &amp;lt;&amp;lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround&lt;/p&gt;

&lt;p&gt;More legitimate sql code is generated, and a bug for the newly
developed and distributed MonetDB adapter is solved.&lt;/p&gt;

&lt;p&gt;MonetDB prints this message :&lt;/p&gt;

&lt;p&gt;!subquery table reference needs alias, use AS xxx in: &quot;select count(*)
as count_all from (select distinct &quot;accounts&quot;.id from &quot;accounts&quot;  left
outer join &quot;companies&quot; on &quot;companies&quot;.id = &quot;accounts&quot;.firm_id and
&quot;companies&quot;.&quot;type&quot; = 'Firm'   where (companies.id &gt; 1) );&quot;&lt;/p&gt;

&lt;p&gt;Could this modification be added in the ActiveRecord code?&lt;/p&gt;

&lt;p&gt;By the way, (this is not intended to be spam), I've developed an activerecord adapter for MonetDB.
MonetDB is an open source, high-performance column-store database management system with automatic index management, flexible optimizer infrastructure, and programmable backend functionality. It comes with functional complete SQL- and XQuery- frontends.&lt;/p&gt;

&lt;p&gt;To find out more about MonetDB visit monetdb.cwi.nl and to get the adapter visit &lt;a href=&quot;http://rubyforge.org/projects/monetdb-ror/&quot;&gt;http://rubyforge.org/projects/mo...&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,
Michalis Polakis&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-10T21:18:46+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-08-10T21:18:46+01:00</updated-at>
      <user-id type="integer">28618</user-id>
      <version type="integer">1</version>
      <user-name>Michalis Polakis</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi There,

Can you make the change and submit a patch:

http://rails.lighthouseapp.com/projects/8994/sending-patches

If you need help with using git the folks in #rails-contrib will probably be able to help.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi There,&lt;/p&gt;

&lt;p&gt;Can you make the change and submit a patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994/sending-patches&quot;&gt;http://rails.lighthouseapp.com/p...&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you need help with using git the folks in #rails-contrib will probably be able to help.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-11T08:48:48+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-08-11T08:48:48+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I've created a patch with Michalis' change (for which he should get the credit), and tested against sqlite3 and mysql.  As this fixes a problem in a non-core adapter, I can't see how best to add a test.  Any ideas?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've created a patch with Michalis' change (for which he should get the credit), and tested against sqlite3 and mysql.  As this fixes a problem in a non-core adapter, I can't see how best to add a test.  Any ideas?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-08-11T15:00:16+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-08-11T15:00:16+01:00</updated-at>
      <user-id type="integer">14288</user-id>
      <version type="integer">3</version>
      <user-name>Tom Ward</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [c7375d74d9fff3219d4ea389ba9e36a90afe9d33]) Alias subquery used in calculations, to provide better compatibility with databases such as MonetDB

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
Signed-off-by: Tom Ward &lt;tom@popdog.net&gt;
[#796 state:committed]
http://github.com/rails/rails/commit/c7375d74d9fff3219d4ea389ba9e36a90afe9d33</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [c7375d74d9fff3219d4ea389ba9e36a90afe9d33]) Alias subquery used in calculations, to provide better compatibility with databases such as MonetDB&lt;/p&gt;

&lt;p&gt;Signed-off-by: Michael Koziarski &lt;a href=&quot;&amp;amp;#109;&amp;amp;#97;&amp;amp;#x69;&amp;amp;#x6c;&amp;amp;#116;&amp;amp;#x6f;&amp;amp;#x3a;&amp;amp;#x6d;&amp;amp;#x69;&amp;amp;#x63;&amp;amp;#x68;&amp;amp;#x61;&amp;amp;#x65;&amp;amp;#x6c;&amp;amp;#x40;&amp;amp;#107;&amp;amp;#111;&amp;amp;#122;&amp;amp;#x69;&amp;amp;#x61;&amp;amp;#x72;&amp;amp;#115;&amp;amp;#107;&amp;amp;#105;&amp;amp;#46;&amp;amp;#x63;&amp;amp;#x6f;&amp;amp;#x6d;&quot;&gt;&amp;#x6d;&amp;#x69;&amp;#99;&amp;#x68;&amp;#x61;&amp;#x65;&amp;#x6c;&amp;#x40;&amp;#107;&amp;#111;&amp;#122;&amp;#105;&amp;#x61;&amp;#x72;&amp;#x73;&amp;#107;&amp;#105;&amp;#46;&amp;#x63;&amp;#111;&amp;#109;&lt;/a&gt;
Signed-off-by: Tom Ward &lt;a&gt;&amp;#116;&amp;#111;&amp;#x6d;&amp;#x40;&amp;#112;&amp;#111;&amp;#x70;&amp;#x64;&amp;#111;&amp;#x67;&amp;#46;&amp;#110;&amp;#x65;&amp;#116;&lt;/a&gt;
[&lt;a href=&quot;/projects/8994/tickets/796&quot; title=&quot;Ticket #796&quot;&gt;#796&lt;/a&gt; state:committed]
&lt;a href=&quot;http://github.com/rails/rails/commit/c7375d74d9fff3219d4ea389ba9e36a90afe9d33&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-11T15:49:43+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-08-11T15:49:43+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [b6ad9a75ccf0e8734312357a7ac9dd7c47fd4cf1]) Alias subquery used in calculations, to provide better compatibility with databases such as MonetDB

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
Signed-off-by: Tom Ward &lt;tom@popdog.net&gt;
[#796 state:committed]
http://github.com/rails/rails/commit/b6ad9a75ccf0e8734312357a7ac9dd7c47fd4cf1</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [b6ad9a75ccf0e8734312357a7ac9dd7c47fd4cf1]) Alias subquery used in calculations, to provide better compatibility with databases such as MonetDB&lt;/p&gt;

&lt;p&gt;Signed-off-by: Michael Koziarski &lt;a&gt;&amp;#x6d;&amp;#105;&amp;#99;&amp;#x68;&amp;#x61;&amp;#101;&amp;#108;&amp;#x40;&amp;#x6b;&amp;#111;&amp;#x7a;&amp;#105;&amp;#97;&amp;#114;&amp;#115;&amp;#x6b;&amp;#105;&amp;#x2e;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;
Signed-off-by: Tom Ward &lt;a&gt;&amp;#116;&amp;#111;&amp;#109;&amp;#64;&amp;#x70;&amp;#111;&amp;#112;&amp;#x64;&amp;#111;&amp;#103;&amp;#x2e;&amp;#x6e;&amp;#101;&amp;#x74;&lt;/a&gt;
[&lt;a href=&quot;/projects/8994/tickets/796&quot; title=&quot;Ticket #796&quot;&gt;#796&lt;/a&gt; state:committed]
&lt;a href=&quot;http://github.com/rails/rails/commit/b6ad9a75ccf0e8734312357a7ac9dd7c47fd4cf1&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-25T09:29:51+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-08-25T09:29:51+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">5</version>
      <user-name>Repository</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This change in Rails 2.1.1 broke Oracle database compatibility :(

See http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/994-activerecord-calculations-does-not-work-with-distinct

At first, there is bug that instead of using single quotes in
###
sql &lt;&lt; ') AS #{aggregate_alias}_subquery' if use_workaround
###
you should use double quotes:
###
sql &lt;&lt; &quot;) AS #{aggregate_alias}_subquery&quot; if use_workaround
###

And second, this &quot;AS table_alias&quot; syntax is not supported by Oracle database - see latest Oracle syntax specification at http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/statements_10002.htm#i2126863

So I think this change should be reverted and probably moved to database adapter where each adapter could specify correct way how to add table aliases in SQL queries.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This change in Rails 2.1.1 broke Oracle database compatibility
:(&lt;/p&gt;
&lt;p&gt;See &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/994-activerecord-calculations-does-not-work-with-distinct&quot;&gt;
http://rails.lighthouseapp.com/p...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;At first, there is bug that instead of using single quotes in
### sql &amp;lt;&amp;lt; ') AS #{aggregate_alias}&lt;em&gt;subquery' if
use_workaround ### you should use double quotes: ### sql &amp;lt;&amp;lt;
&quot;) AS #{aggregate_alias}&lt;/em&gt;subquery&quot; if use_workaround ###&lt;/p&gt;
&lt;p&gt;And second, this &quot;AS table_alias&quot; syntax is not supported by
Oracle database - see latest Oracle syntax specification at
&lt;a href=&quot;http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/statements_10002.htm#i2126863&quot;&gt;
http://download.oracle.com/docs/...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So I think this change should be reverted and probably moved to
database adapter where each adapter could specify correct way how
to add table aliases in SQL queries.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-08T16:06:43+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-09-08T16:06:54+01:00</updated-at>
      <user-id type="integer">3839</user-id>
      <version type="integer">6</version>
      <user-name>Raimonds Simanovskis</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Raimonds,

Do you have a suggested workaround for this in the mean time?  My oracle rails app broke :(</body>
      <body-html>&lt;div&gt;&lt;p&gt;Raimonds,&lt;/p&gt;
&lt;p&gt;Do you have a suggested workaround for this in the mean time? My
oracle rails app broke :(&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-02T17:01:32+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-02T17:01:36+01:00</updated-at>
      <user-id type="integer">23062</user-id>
      <version type="integer">7</version>
      <user-name>Ed Lebert</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>You can apply quick monkey patch from http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/994-activerecord-calculations-does-not-work-with-distinct

I am going to include similar monkey patch in my next version of oracle_enhanced adapter.

And I will also try to get this fixed for next release of Rails. Correct solution would be to remove &quot;AS&quot; keyword from line
http://github.com/rails/rails/tree/master/activerecord/lib/active_record/calculations.rb#L220
as &quot;AS&quot; keyword for table alias is not supported by Oracle and is optional for other databases (also for MonetDB which caused this problem :( )</body>
      <body-html>&lt;div&gt;&lt;p&gt;You can apply quick monkey patch from &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/994-activerecord-calculations-does-not-work-with-distinct&quot;&gt;
http://rails.lighthouseapp.com/p...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I am going to include similar monkey patch in my next version of
oracle_enhanced adapter.&lt;/p&gt;
&lt;p&gt;And I will also try to get this fixed for next release of Rails.
Correct solution would be to remove &quot;AS&quot; keyword from line &lt;a href=&quot;http://github.com/rails/rails/tree/master/activerecord/lib/active_record/calculations.rb#L220&quot;&gt;
http://github.com/rails/rails/tr...&lt;/a&gt; as &quot;AS&quot; keyword for table
alias is not supported by Oracle and is optional for other
databases (also for MonetDB which caused this problem :( )&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-03T08:29:33+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-03T08:29:35+01:00</updated-at>
      <user-id type="integer">3839</user-id>
      <version type="integer">8</version>
      <user-name>Raimonds Simanovskis</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I believe this: http://github.com/rails/rails/commit/7553a23c0a84424bdbc09cc81791f41bfebe1b25 should have fixed it now?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I believe this: &lt;a href=&quot;http://github.com/rails/rails/commit/7553a23c0a84424bdbc09cc81791f41bfebe1b25&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt; should have fixed it
now?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-03T20:44:32+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-03T20:44:36+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">9</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yes, now it's fine for Oracle. Thanks Michael.

Just one additional comment - Oracle allows max 30 characters in any identifier (table name, index name, column name, alias name etc.). Therefore for Oracle it would be better not to generate too long identifiers from Rails (like appending to column names long suffix &quot;_subquery&quot;). So if you can please use short prefixes and suffixes :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, now it's fine for Oracle. Thanks Michael.&lt;/p&gt;
&lt;p&gt;Just one additional comment - Oracle allows max 30 characters in
any identifier (table name, index name, column name, alias name
etc.). Therefore for Oracle it would be better not to generate too
long identifiers from Rails (like appending to column names long
suffix &quot;_subquery&quot;). So if you can please use short prefixes and
suffixes :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-03T21:41:03+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-03T21:41:07+01:00</updated-at>
      <user-id type="integer">3839</user-id>
      <version type="integer">10</version>
      <user-name>Raimonds Simanovskis</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Raimonds, even though this issue is solved and the monkey patch helped I just had a question. 

When the changes are made from version to version, no unit tests are performed?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Raimonds, even though this issue is solved and the monkey patch
helped I just had a question.&lt;/p&gt;
&lt;p&gt;When the changes are made from version to version, no unit tests
are performed?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-22T05:40:17+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-22T05:40:19+01:00</updated-at>
      <user-id type="integer">35328</user-id>
      <version type="integer">11</version>
      <user-name>john</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>John, 

As Oracle adapter is not anymore in core ActiveRecord, then ActiveRecord unit tests are not run on Oracle database during Rails continuous integration builds. Therefore such issues might appear when some changes are made which break compatibility with other non-core databases.

I tried to run all ActiveRecord unit tests on Oracle database but currently quite a lot are failing - because of too-long identifiers, because of some Oracle specific limitations etc. Probably in the future I together with Rails core team will manage that all ActiveRecord unit tests will run on Oracle database :) But now it's not so easy to identify new changes which break compatibility.</body>
      <body-html>&lt;div&gt;&lt;p&gt;John,&lt;/p&gt;
&lt;p&gt;As Oracle adapter is not anymore in core ActiveRecord, then
ActiveRecord unit tests are not run on Oracle database during Rails
continuous integration builds. Therefore such issues might appear
when some changes are made which break compatibility with other
non-core databases.&lt;/p&gt;
&lt;p&gt;I tried to run all ActiveRecord unit tests on Oracle database
but currently quite a lot are failing - because of too-long
identifiers, because of some Oracle specific limitations etc.
Probably in the future I together with Rails core team will manage
that all ActiveRecord unit tests will run on Oracle database :) But
now it's not so easy to identify new changes which break
compatibility.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-22T11:50:39+01:00</created-at>
      <creator-id type="integer">28618</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">796</number>
      <permalink>a-small-modification-at-activerecord-s-calculations-rb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>activerecord patch tiny</tag>
      <title>A small modification at ActiveRecord's calculations.rb</title>
      <updated-at type="datetime">2008-10-22T11:50:42+01:00</updated-at>
      <user-id type="integer">3839</user-id>
      <version type="integer">12</version>
      <user-name>Raimonds Simanovskis</user-name>
      <creator-name>Michalis Polakis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/796</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>8809a518b582d8bdb1ddb0e49193f8866ac34a88</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-08-11T15:00:16+01:00</created-at>
      <filename>alias-calculations-subquery.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">38367</id>
      <size type="integer">931</size>
      <uploader-id type="integer">14288</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/38367/alias-calculations-subquery.diff</url>
    </attachment>
  </attachments>
</ticket>
