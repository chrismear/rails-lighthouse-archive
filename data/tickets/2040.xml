<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-02-22T13:06:39+00:00</created-at>
  <creator-id type="integer">37708</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">2040</number>
  <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
  <priority type="integer">1274</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
  <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
  <updated-at type="datetime">2009-02-24T09:23:25+00:00</updated-at>
  <user-id type="integer">8406</user-id>
  <version type="integer">6</version>
  <user-name>Eloy Duran</user-name>
  <creator-name>Jens</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Hello,

I installed Rails 2.3.0 using &quot;gem install rails --source http://gems.rubyonrails.com&quot;.

Then I duplicated the example in http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes, only

a) using FudgeFormBuilder (http://github.com/JimNeath/fudge_form)

b) using ResourceController (http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)


With this setup, if I access child_form.object in a partial (or within a forms_for block), like detailed on jamesgolick.com, it is nil, regardless of whether I do @foo.child.build before to create child models.

Is this a bug in Rails, or is this a missing feature in FudgeFormBuilder (if so: what would I have to change?) or does ResourceController interfere?

In general: do custom FormBuilders which inherit from ActionView::Helpers::FormBuilder need to actively support the nested attributes display?

Thank you!


Jens

(PS: I'd like to evaluate this problem in more detail using the &quot;nested_attributes&quot; branch in git://github.com/alloy/complex-form-examples.git which allegedly includes a vendored current Rails 2.3 but I can't get a working checkout. Probably a problem between me and git. :-( Maybe somebody can tell me how to get a complete checkout of the right branch, including submodules etc? Thanks!)</original-body>
  <latest-body>Hello,

I installed Rails 2.3.0 using &quot;gem install rails --source http://gems.rubyonrails.com&quot;.

Then I duplicated the example in http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes, only

a) using FudgeFormBuilder (http://github.com/JimNeath/fudge_form)

b) using ResourceController (http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)


With this setup, if I access child_form.object in a partial (or within a forms_for block), like detailed on jamesgolick.com, it is nil, regardless of whether I do @foo.child.build before to create child models.

Is this a bug in Rails, or is this a missing feature in FudgeFormBuilder (if so: what would I have to change?) or does ResourceController interfere?

In general: do custom FormBuilders which inherit from ActionView::Helpers::FormBuilder need to actively support the nested attributes display?

Thank you!


Jens

(PS: I'd like to evaluate this problem in more detail using the &quot;nested_attributes&quot; branch in git://github.com/alloy/complex-form-examples.git which allegedly includes a vendored current Rails 2.3 but I can't get a working checkout. Probably a problem between me and git. :-( Maybe somebody can tell me how to get a complete checkout of the right branch, including submodules etc? Thanks!)</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;I installed Rails 2.3.0 using &quot;gem install rails --source
&lt;a href=&quot;http://gems.rubyonrails.com&quot;&gt;http://gems.rubyonrails.com&lt;/a&gt;&quot;.&lt;/p&gt;
&lt;p&gt;Then I duplicated the example in &lt;a href=&quot;http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes&quot;&gt;
http://ryandaigle.com/articles/2...&lt;/a&gt;, only&lt;/p&gt;
&lt;p&gt;a) using FudgeFormBuilder (&lt;a href=&quot;http://github.com/JimNeath/fudge_form)&quot;&gt;http://github.com/JimNeath/fudge...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;b) using ResourceController (&lt;a href=&quot;http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)&quot;&gt;http://jamesgolick.com/2007/10/1...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With this setup, if I access child_form.object in a partial (or
within a forms_for block), like detailed on jamesgolick.com, it is
nil, regardless of whether I do @foo.child.build before to create
child models.&lt;/p&gt;
&lt;p&gt;Is this a bug in Rails, or is this a missing feature in
FudgeFormBuilder (if so: what would I have to change?) or does
ResourceController interfere?&lt;/p&gt;
&lt;p&gt;In general: do custom FormBuilders which inherit from
ActionView::Helpers::FormBuilder need to actively support the
nested attributes display?&lt;/p&gt;
&lt;p&gt;Thank you!&lt;/p&gt;
&lt;p&gt;Jens&lt;/p&gt;
&lt;p&gt;(PS: I'd like to evaluate this problem in more detail using the
&quot;nested_attributes&quot; branch in
git://github.com/alloy/complex-form-examples.git which allegedly
includes a vendored current Rails 2.3 but I can't get a working
checkout. Probably a problem between me and git. :-( Maybe somebody
can tell me how to get a complete checkout of the right branch,
including submodules etc? Thanks!)&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello,

I installed Rails 2.3.0 using &quot;gem install rails --source http://gems.rubyonrails.com&quot;.

Then I duplicated the example in http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes, only

a) using FudgeFormBuilder (http://github.com/JimNeath/fudge_form)

b) using ResourceController (http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)


With this setup, if I access child_form.object in a partial (or within a forms_for block), like detailed on jamesgolick.com, it is nil, regardless of whether I do @foo.child.build before to create child models.

Is this a bug in Rails, or is this a missing feature in FudgeFormBuilder (if so: what would I have to change?) or does ResourceController interfere?

In general: do custom FormBuilders which inherit from ActionView::Helpers::FormBuilder need to actively support the nested attributes display?

Thank you!


Jens

(PS: I'd like to evaluate this problem in more detail using the &quot;nested_attributes&quot; branch in git://github.com/alloy/complex-form-examples.git which allegedly includes a vendored current Rails 2.3 but I can't get a working checkout. Probably a problem between me and git. :-( Maybe somebody can tell me how to get a complete checkout of the right branch, including submodules etc? Thanks!)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;I installed Rails 2.3.0 using &quot;gem install rails --source
&lt;a href=&quot;http://gems.rubyonrails.com&quot;&gt;http://gems.rubyonrails.com&lt;/a&gt;&quot;.&lt;/p&gt;
&lt;p&gt;Then I duplicated the example in &lt;a href=&quot;http://ryandaigle.com/articles/2009/2/1/what-s-new-in-edge-rails-nested-attributes&quot;&gt;
http://ryandaigle.com/articles/2...&lt;/a&gt;, only&lt;/p&gt;
&lt;p&gt;a) using FudgeFormBuilder (&lt;a href=&quot;http://github.com/JimNeath/fudge_form)&quot;&gt;http://github.com/JimNeath/fudge...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;b) using ResourceController (&lt;a href=&quot;http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)&quot;&gt;http://jamesgolick.com/2007/10/1...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With this setup, if I access child_form.object in a partial (or
within a forms_for block), like detailed on jamesgolick.com, it is
nil, regardless of whether I do @foo.child.build before to create
child models.&lt;/p&gt;
&lt;p&gt;Is this a bug in Rails, or is this a missing feature in
FudgeFormBuilder (if so: what would I have to change?) or does
ResourceController interfere?&lt;/p&gt;
&lt;p&gt;In general: do custom FormBuilders which inherit from
ActionView::Helpers::FormBuilder need to actively support the
nested attributes display?&lt;/p&gt;
&lt;p&gt;Thank you!&lt;/p&gt;
&lt;p&gt;Jens&lt;/p&gt;
&lt;p&gt;(PS: I'd like to evaluate this problem in more detail using the
&quot;nested_attributes&quot; branch in
git://github.com/alloy/complex-form-examples.git which allegedly
includes a vendored current Rails 2.3 but I can't get a working
checkout. Probably a problem between me and git. :-( Maybe somebody
can tell me how to get a complete checkout of the right branch,
including submodules etc? Thanks!)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-22T13:06:39+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-22T13:06:41+00:00</updated-at>
      <user-id type="integer">37708</user-id>
      <version type="integer">1</version>
      <user-name>Jens</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Unless the the custom form builder messes with fields_for, or other standard methods, it should just work. And I know others have in fact been using custom form builders.

I have no experience with ResourceController; please ask for specifics about it on the available support options for it or contact the author, this is not the right place for it. The same applies to working with git, there are plenty of pages on the web which explain how to do this, or join a irc channel like #github.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Unless the the custom form builder messes with fields_for, or
other standard methods, it should just work. And I know others have
in fact been using custom form builders.&lt;/p&gt;
&lt;p&gt;I have no experience with ResourceController; please ask for
specifics about it on the available support options for it or
contact the author, this is not the right place for it. The same
applies to working with git, there are plenty of pages on the web
which explain how to do this, or join a irc channel like
#github.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T16:49:40+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-22T16:49:43+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">2</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Thanks for your reply.

I did all that already - IRC, Github messages, mailing list searches, Git tutorials, manpages and so on. I have also been fighting git and Github for too long and just cannot get this to work. I'm problably missing something obvious.

I guess the bug will just have to wait until somebody else finds it, or until somebody has two minutes to explain how to do this checkout from Github so I can track the problem down.

I'm perfectly willing to help - otherwise I wouldn't have written this bug report. I'm just stuck.

Jens</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for your reply.&lt;/p&gt;
&lt;p&gt;I did all that already - IRC, Github messages, mailing list
searches, Git tutorials, manpages and so on. I have also been
fighting git and Github for too long and just cannot get this to
work. I'm problably missing something obvious.&lt;/p&gt;
&lt;p&gt;I guess the bug will just have to wait until somebody else finds
it, or until somebody has two minutes to explain how to do this
checkout from Github so I can track the problem down.&lt;/p&gt;
&lt;p&gt;I'm perfectly willing to help - otherwise I wouldn't have
written this bug report. I'm just stuck.&lt;/p&gt;
&lt;p&gt;Jens&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T17:27:17+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-22T17:27:20+00:00</updated-at>
      <user-id type="integer">37708</user-id>
      <version type="integer">3</version>
      <user-name>Jens</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Then please let us know what it is that you were trying and how it failed, otherwise the question is just a bit too ambiguous :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Then please let us know what it is that you were trying and how
it failed, otherwise the question is just a bit too ambiguous
:)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T17:51:05+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-22T17:51:07+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">4</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi,

I think I might have found the problem, but it might not be related to nested attributes alone.

action_view/helpers/form_helper.rb:form_for is defined as follows (taken from the Rails Github source):

 # ...
 case record_or_name_or_array
 when String, Symbol
  object_name = record_or_name_or_array
 when Array
  object = record_or_name_or_array.last
  object_name = ActionController::RecordIdentifier.singular_class_name(object)
 # ...

This means that if you use

 form_for(:user, ...) do |f|

you will not get an @object instance. But if you use

 form_for(@user, ...) do |f|

you _will_ get an @object instance.

At least, changing all my forms like this fixed the apparent problem I had with the custom FormBuilder.

Can you find out whether this is intentional and why? If it is not and can be changed so that @object is instantiated regardless of the parameter format, I will perform more tests using accepts_nested_parameters_for.

Thanks!

Jens</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;I think I might have found the problem, but it might not be
related to nested attributes alone.&lt;/p&gt;
&lt;p&gt;action_view/helpers/form_helper.rb:form_for is defined as
follows (taken from the Rails Github source):&lt;/p&gt;
&lt;p&gt;# ... case record_or_name_or_array when String, Symbol
object_name = record_or_name_or_array when Array object =
record_or_name_or_array.last object_name =
ActionController::RecordIdentifier.singular_class_name(object) #
...&lt;/p&gt;
&lt;p&gt;This means that if you use&lt;/p&gt;
&lt;p&gt;form_for(:user, ...) do |f|&lt;/p&gt;
&lt;p&gt;you will not get an @object instance. But if you use&lt;/p&gt;
&lt;p&gt;form_for(@user, ...) do |f|&lt;/p&gt;
&lt;p&gt;you &lt;em&gt;will&lt;/em&gt; get an @object instance.&lt;/p&gt;
&lt;p&gt;At least, changing all my forms like this fixed the apparent
problem I had with the custom FormBuilder.&lt;/p&gt;
&lt;p&gt;Can you find out whether this is intentional and why? If it is
not and can be changed so that @object is instantiated regardless
of the parameter format, I will perform more tests using
accepts_nested_parameters_for.&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;
&lt;p&gt;Jens&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-24T09:04:14+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-24T09:04:17+00:00</updated-at>
      <user-id type="integer">37708</user-id>
      <version type="integer">5</version>
      <user-name>Jens</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Ah, I understand. I don't think that it _should_ resolve the instance, I'd rather have the user specify the instance. I'd only use the symbol form when it's not a local resource, so when you're creating a form for an external resource. But you might want to double-check that on the mailing list.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ah, I understand. I don't think that it &lt;em&gt;should&lt;/em&gt; resolve
the instance, I'd rather have the user specify the instance. I'd
only use the symbol form when it's not a local resource, so when
you're creating a form for an external resource. But you might want
to double-check that on the mailing list.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-24T09:23:23+00:00</created-at>
      <creator-id type="integer">37708</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">2040</number>
      <permalink>v23-nested-attributes-forms_for-child_formobject-is-always-nil</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.3-rc1 2.3.0 accepts_nested_attributes_for actionview attributes fields_for formbuilder</tag>
      <title>v2.3 nested attributes, forms_for, child_form.object is always nil</title>
      <updated-at type="datetime">2009-02-24T09:23:25+00:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">6</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>Jens</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/2040</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
