<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">15316</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-03-19T22:21:05+00:00</created-at>
  <creator-id type="integer">88961</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4240</number>
  <permalink>migration-now-points-to-dbmigrate</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>bug migration patch rails3</tag>
  <title>Migration now points to db/migrate//</title>
  <updated-at type="datetime">2010-03-24T01:23:05+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">6</version>
  <user-name>Repository</user-name>
  <creator-name>Eric Koslow</creator-name>
  <assigned-user-name>Aaron Patterson</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
  <priority-name>Low</priority-name>
  <original-body>After this commit ( http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f47742d12ba ) when one runs rake db:migrate rails looks at db/migrate// instead of db/migrate/.

I am running Rail3 strait off of the git repo, ruby 1.9.2dev and running Mac 10.5.8.

I have gone into the source and changed it back to load(filename) and it fixes the problem.</original-body>
  <latest-body>After this commit ( http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f47742d12ba ) when one runs rake db:migrate rails looks at db/migrate// instead of db/migrate/.

I am running Rail3 strait off of the git repo, ruby 1.9.2dev and running Mac 10.5.8.

I have gone into the source and changed it back to load(filename) and it fixes the problem.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;After this commit ( &lt;a href=
&quot;http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f47742d12ba&quot;&gt;
http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f...&lt;/a&gt;
) when one runs rake db:migrate rails looks at db/migrate// instead
of db/migrate/.&lt;/p&gt;
&lt;p&gt;I am running Rail3 strait off of the git repo, ruby 1.9.2dev and
running Mac 10.5.8.&lt;/p&gt;
&lt;p&gt;I have gone into the source and changed it back to
load(filename) and it fixes the problem.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>After this commit ( http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f47742d12ba ) when one runs rake db:migrate rails looks at db/migrate// instead of db/migrate/.

I am running Rail3 strait off of the git repo, ruby 1.9.2dev and running Mac 10.5.8.

I have gone into the source and changed it back to load(filename) and it fixes the problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;After this commit ( &lt;a href=
&quot;http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f47742d12ba&quot;&gt;
http://github.com/rails/rails/commit/541194f641c960efe739b16f76999f...&lt;/a&gt;
) when one runs rake db:migrate rails looks at db/migrate// instead
of db/migrate/.&lt;/p&gt;
&lt;p&gt;I am running Rail3 strait off of the git repo, ruby 1.9.2dev and
running Mac 10.5.8.&lt;/p&gt;
&lt;p&gt;I have gone into the source and changed it back to
load(filename) and it fixes the problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-19T22:21:05+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug migration rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-19T22:21:08+00:00</updated-at>
      <user-id type="integer">88961</user-id>
      <version type="integer">1</version>
      <user-name>Eric Koslow</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Are you able to reproduce this with a new application?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Are you able to reproduce this with a new application?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-20T01:32:22+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug migration rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-20T01:32:27+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">2</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Also, could I possibly get a stack trace from when it had &quot;require&quot;?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Also, could I possibly get a stack trace from when it had
&quot;require&quot;?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-21T19:11:28+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug migration rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-21T19:11:29+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">3</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The problem was indeed introduced by the aforementioned commit, but the cause is that Kernel#require doesn't load relative paths on Ruby 1.9.2 Ruby, while Kernel#load does.

There is even ticket for that issue: http://redmine.ruby-lang.org/issues/show/2710

Backtrace:
@@@
&gt; rake --trace db:migrate
(in /mnt/hgfs/tourism_studies)
** Invoke db:migrate (first_time)
** Invoke environment (first_time)
** Execute environment
** Execute db:migrate
rake aborted!
no such file to load -- db/migrate//20100323145036_test_migration.rb
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:in `require'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:in `block in require'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:195:in `block in load_dependency'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:523:in `new_constants_in'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:195:in `load_dependency'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:in `require'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:377:in `load_migration'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:373:in `migration'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:373:in `migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:506:in `block (2 levels) in migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:582:in `call'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:582:in `ddl_transaction'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:505:in `block in migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:492:in `each'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:492:in `migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:402:in `up'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:387:in `migrate'
@@@

And my idea of fix:

@@@
diff --git a/activerecord/lib/active_record/migration.rb b/activerecord/lib/active_record/migration.rb
index 23e4505..4e7c24a 100644
--- a/activerecord/lib/active_record/migration.rb
+++ b/activerecord/lib/active_record/migration.rb
@@ -374,7 +374,7 @@ module ActiveRecord
       end

       def load_migration
-        require(filename)
+        require(Pathname(filename).relative? ? Rails.root + filename : filename)
         name.constantize
       end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;The problem was indeed introduced by the aforementioned commit,
but the cause is that Kernel#require doesn't load relative paths on
Ruby 1.9.2 Ruby, while Kernel#load does.&lt;/p&gt;
&lt;p&gt;There is even ticket for that issue: &lt;a href=
&quot;http://redmine.ruby-lang.org/issues/show/2710&quot;&gt;http://redmine.ruby-lang.org/issues/show/2710&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Backtrace:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt; rake --trace db:migrate
(in /mnt/hgfs/tourism_studies)
&lt;strong&gt; Invoke db:migrate (first_time)
&lt;/strong&gt; Invoke environment (first_time)
&lt;strong&gt; Execute environment
&lt;/strong&gt; Execute db:migrate
rake aborted!
no such file to load -- db/migrate//20100323145036_test_migration.rb
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:in &lt;/code&gt;require'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:inblock in require'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:195:in &lt;code&gt;block in load_dependency'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:523:in&lt;/code&gt;new_constants_in'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:195:in &lt;code&gt;load_dependency'
/mnt/hgfs/tourism_studies/vendor/rails/activesupport/lib/active_support/dependencies.rb:209:in&lt;/code&gt;require'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:377:in &lt;code&gt;load_migration'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:373:in&lt;/code&gt;migration'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:373:in &lt;code&gt;migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:506:in&lt;/code&gt;block (2 levels) in migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:582:in &lt;code&gt;call'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:582:in&lt;/code&gt;ddl_transaction'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:505:in &lt;code&gt;block in migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:492:in&lt;/code&gt;each'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:492:in &lt;code&gt;migrate'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:402:in&lt;/code&gt;up'
/mnt/hgfs/tourism_studies/vendor/rails/activerecord/lib/active_record/migration.rb:387:in &lt;code&gt;migrate'&amp;lt;/code&amp;gt;
&amp;lt;/pre&amp;gt;&lt;/code&gt;

&lt;br&gt;
And my idea of fix:

&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;diff --git a/activerecord/lib/active_record/migration.rb b/activerecord/lib/active_record/migration.rb
index 23e4505..4e7c24a 100644
--- a/activerecord/lib/active_record/migration.rb
+++ b/activerecord/lib/active_record/migration.rb
@@ -374,7 +374,7 @@ module ActiveRecord
       end

       def load_migration
-        require(filename)
+        require(Pathname(filename).relative? ? Rails.root + filename : filename)
         name.constantize
       end&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;


&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-23T15:14:45+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug migration rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-23T15:14:51+00:00</updated-at>
      <user-id type="integer">43210</user-id>
      <version type="integer">4</version>
      <user-name>Evgeniy Dolzhenko</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-24T01:21:06+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: bug migration rails3
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bug migration patch rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-24T01:21:10+00:00</updated-at>
      <user-id type="integer">15316</user-id>
      <version type="integer">5</version>
      <user-name>Aaron Patterson</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15316</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [ed21f0c50270139ddb6993acfdaea4586ffd09a3]) expand migration paths before requiring them. [#4240 state:resolved]

Signed-off-by: wycats &lt;wycats@gmail.com&gt;
http://github.com/rails/rails/commit/ed21f0c50270139ddb6993acfdaea4586ffd09a3</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/ed21f0c50270139ddb6993acfdaea4586ffd09a3&quot;
title=
&quot;Changeset [ed21f0c50270139ddb6993acfdaea4586ffd09a3]&quot;&gt;[ed21f0c50270139ddb6993acfdaea4586ffd09a3]&lt;/a&gt;)
expand migration paths before requiring them. [&lt;a href=
&quot;/projects/8994/tickets/4240&quot; title=&quot;Ticket #4240&quot;&gt;#4240&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: wycats &lt;a href=
&quot;mailto:wycats@gmail.com&quot;&gt;wycats@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/ed21f0c50270139ddb6993acfdaea4586ffd09a3&quot;&gt;
http://github.com/rails/rails/commit/ed21f0c50270139ddb6993acfdaea4...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-03-24T01:23:03+00:00</created-at>
      <creator-id type="integer">88961</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4240</number>
      <permalink>migration-now-points-to-dbmigrate</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bug migration patch rails3</tag>
      <title>Migration now points to db/migrate//</title>
      <updated-at type="datetime">2010-03-24T01:23:05+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">6</version>
      <user-name>Repository</user-name>
      <creator-name>Eric Koslow</creator-name>
      <assigned-user-name>Aaron Patterson</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4240</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>2a5c7506e037ea75350cf8588eabbc113866fd2a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-03-24T01:21:06+00:00</created-at>
      <filename>your-patch-file.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">457437</id>
      <size type="integer">1725</size>
      <uploader-id type="integer">15316</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/457437/your-patch-file.diff</url>
    </attachment>
  </attachments>
</ticket>
