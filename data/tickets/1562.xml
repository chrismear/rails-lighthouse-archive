<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">14890</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-09-16T11:34:59+01:00</created-at>
  <creator-id type="integer">40510</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">1562</number>
  <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
  <priority type="integer">915</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
  <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
  <updated-at type="datetime">2011-03-10T00:00:52+00:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">15</version>
  <user-name>rails</user-name>
  <creator-name>Suraj N. Kurapati</creator-name>
  <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
  <milestone-title>3.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When the time zone is not included in a quoted date (as was the case before this patch), we make the assumption that the database server resides in (or is configured as if it resides in) the same time zone as the application which is using the ActiveRecord library to quote SQL dates.

This patch removes the above assumption by including the time zone in quoted dates, so that ActiveRecord generates SQL queries that work regardless of whether your application happens to be running in the same time zone as your Postgres database server.</original-body>
  <latest-body>When the time zone is not included in a quoted date (as was the case before this patch), we make the assumption that the database server resides in (or is configured as if it resides in) the same time zone as the application which is using the ActiveRecord library to quote SQL dates.

This patch removes the above assumption by including the time zone in quoted dates, so that ActiveRecord generates SQL queries that work regardless of whether your application happens to be running in the same time zone as your Postgres database server.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When the time zone is not included in a quoted date (as was the
case before this patch), we make the assumption that the database
server resides in (or is configured as if it resides in) the same
time zone as the application which is using the ActiveRecord
library to quote SQL dates.&lt;/p&gt;
&lt;p&gt;This patch removes the above assumption by including the time
zone in quoted dates, so that ActiveRecord generates SQL queries
that work regardless of whether your application happens to be
running in the same time zone as your Postgres database server.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When the time zone is not included in a quoted date (which was the case before this patch), we make the assumption that the database server resides in (or is configured as if it resides in) the same time zone as the application which is using the ActiveRecord library to perform SQL queries.

This patch removes the above assumption by explicitly including the time zone in quoted dates, so that ActiveRecord generates SQL queries that work regardless of whether your application happens to be running in the same time zone as your Postgres database server.

See http://www.postgresql.org/docs/8.0/static/datatype-datetime.html for reference.</body>
      <body-html>&lt;div&gt;&lt;p&gt;When the time zone is not included in a quoted date (which was
the case before this patch), we make the assumption that the
database server resides in (or is configured as if it resides in)
the same time zone as the application which is using the
ActiveRecord library to perform SQL queries.&lt;/p&gt;
&lt;p&gt;This patch removes the above assumption by explicitly including
the time zone in quoted dates, so that ActiveRecord generates SQL
queries that work regardless of whether your application happens to
be running in the same time zone as your Postgres database
server.&lt;/p&gt;
&lt;p&gt;See &lt;a href=&quot;http://www.postgresql.org/docs/8.0/static/datatype-datetime.html&quot;&gt;http://www.postgresql.org/docs/8...&lt;/a&gt;
for reference.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T23:05:39+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2008-12-11T23:07:59+00:00</updated-at>
      <user-id type="integer">40510</user-id>
      <version type="integer">1</version>
      <user-name>Suraj N. Kurapati</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-17T19:01:12+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
:title: &quot;postgresql_adapter: Include time zone in result of quoted_date( )&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2008-12-17T19:01:14+00:00</updated-at>
      <user-id type="integer">40510</user-id>
      <version type="integer">2</version>
      <user-name>Suraj N. Kurapati</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Patch is missing tests.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Patch is missing tests.&lt;/p&gt;
&lt;p&gt;Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-21T23:02:43+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2008-12-21T23:02:47+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks for considering my patch.  I will add the tests and attach a new version of this patch this week.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for considering my patch. I will add the tests and attach
a new version of this patch this week.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-22T20:40:31+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2008-12-22T20:40:32+00:00</updated-at>
      <user-id type="integer">40510</user-id>
      <version type="integer">4</version>
      <user-name>Suraj N. Kurapati</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Just to clarify, this is only an issue with Postgres &quot;timestamp with time zone&quot; columns, correct? There shouldn't be an issue with the &quot;timestamp without time zone&quot; type, which is the type generated by ActiveRecord schema migrations.

WIth this proposed solution, we'd be sending the zone for every Postgres datetime column, whether or not it needs it (if you're following Rails conventions, you'll never need it.) I'm assuming Postgres will ignore the zone when it doesn't need it, but I'm not sure.

Your solution sends #zone, which returns a three-letter abbreviation -- this is ambiguous -- &quot;CST&quot;, for example, can represent any number of zones, for example: US Central Standard Time (which has a utc offset of -6 or -5 hours), Chinese Standard Time (which has a utc offset of +8), etc. Better to send the unambiguous #formatted_offset value, e.g. &quot;-06:00&quot;, and not rely on Postgres' interpretation of these three-letter abbreviations.

Finally, how will Rails handle data returned from these columns?  Will these columns be converted to ActiveRecord::Base.default_timezone, either in ActiveRecord code, or in Postgres (via a per-connection time zone setting, or something)?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just to clarify, this is only an issue with Postgres &quot;timestamp
with time zone&quot; columns, correct? There shouldn't be an issue with
the &quot;timestamp without time zone&quot; type, which is the type generated
by ActiveRecord schema migrations.&lt;/p&gt;
&lt;p&gt;WIth this proposed solution, we'd be sending the zone for every
Postgres datetime column, whether or not it needs it (if you're
following Rails conventions, you'll never need it.) I'm assuming
Postgres will ignore the zone when it doesn't need it, but I'm not
sure.&lt;/p&gt;
&lt;p&gt;Your solution sends #zone, which returns a three-letter
abbreviation -- this is ambiguous -- &quot;CST&quot;, for example, can
represent any number of zones, for example: US Central Standard
Time (which has a utc offset of -6 or -5 hours), Chinese Standard
Time (which has a utc offset of +8), etc. Better to send the
unambiguous #formatted_offset value, e.g. &quot;-06:00&quot;, and not rely on
Postgres' interpretation of these three-letter abbreviations.&lt;/p&gt;
&lt;p&gt;Finally, how will Rails handle data returned from these columns?
Will these columns be converted to
ActiveRecord::Base.default_timezone, either in ActiveRecord code,
or in Postgres (via a per-connection time zone setting, or
something)?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-22T23:07:36+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2008-12-22T23:07:41+00:00</updated-at>
      <user-id type="integer">15783</user-id>
      <version type="integer">5</version>
      <user-name>Geoff Buesing</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:37+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-05-04T18:48:37+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">6</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I've run into this issue yesterday.

Proper way of solving this is to **use utc time and format with time zone offset** for column with time zone and whatever to column without time zone.

Saving timestamp to column without time zone is also broken (when I have CEST timezone, adapter saves timestamp with timezone offset and Rails adds this offset again after reloading values). Postgres silently ignores time zone settings for columns without time zone.

I've fixed all these problems by using `timestamp with timezone` and this http://gist.github.com/574015</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've run into this issue yesterday.&lt;/p&gt;
&lt;p&gt;Proper way of solving this is to &lt;strong&gt;use utc time and format
with time zone offset&lt;/strong&gt; for column with time zone and
whatever to column without time zone.&lt;/p&gt;
&lt;p&gt;Saving timestamp to column without time zone is also broken
(when I have CEST timezone, adapter saves timestamp with timezone
offset and Rails adds this offset again after reloading values).
Postgres silently ignores time zone settings for columns without
time zone.&lt;/p&gt;
&lt;p&gt;I've fixed all these problems by using &lt;code&gt;timestamp with
timezone&lt;/code&gt; and this &lt;a href=
&quot;http://gist.github.com/574015&quot;&gt;http://gist.github.com/574015&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-10T18:15:34+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-09-10T18:15:37+01:00</updated-at>
      <user-id type="integer">99505</user-id>
      <version type="integer">7</version>
      <user-name>MikZ</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Here is a refactored version of MikZ's and my initial solution: http://gist.github.com/574080</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here is a refactored version of MikZ's and my initial solution:
&lt;a href=
&quot;http://gist.github.com/574080&quot;&gt;http://gist.github.com/574080&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-10T19:03:20+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-09-10T19:03:21+01:00</updated-at>
      <user-id type="integer">40510</user-id>
      <version type="integer">8</version>
      <user-name>Suraj N. Kurapati</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think there is one major problem with your solution. If its @config.active_record.default_timezone@ set to something different from UTC (which you need if you want correct values from db), then calling @super@ in @quoted_date@ will convert value to that timezone. But **when sending timezone offset**, PostgreSQL **needs UTC date**. Thats why I'm calling @value.to_s(:db)@ and why you can't just call @super@.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think there is one major problem with your solution. If its
&lt;code&gt;config.active_record.default_timezone&lt;/code&gt; set to something
different from UTC (which you need if you want correct values from
db), then calling &lt;code&gt;super&lt;/code&gt; in &lt;code&gt;quoted_date&lt;/code&gt;
will convert value to that timezone. But &lt;strong&gt;when sending
timezone offset&lt;/strong&gt;, PostgreSQL &lt;strong&gt;needs UTC
date&lt;/strong&gt;. Thats why I'm calling &lt;code&gt;value.to_s(:db)&lt;/code&gt;
and why you can't just call &lt;code&gt;super&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-15T06:56:25+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activerecord patch postgresql quoting
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-09-15T06:56:28+01:00</updated-at>
      <user-id type="integer">99505</user-id>
      <version type="integer">9</version>
      <user-name>MikZ</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks for catching (and explaining) that MikZ.  I have updated the solution accordingly:  http://gist.github.com/574080  Cheers.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks for catching (and explaining) that MikZ. I have updated
the solution accordingly: &lt;a href=
&quot;http://gist.github.com/574080&quot;&gt;http://gist.github.com/574080&lt;/a&gt;
Cheers.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-15T07:13:34+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-09-15T07:13:35+01:00</updated-at>
      <user-id type="integer">40510</user-id>
      <version type="integer">10</version>
      <user-name>Suraj N. Kurapati</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The [patch from MikZ](http://gist.github.com/574015) fixes this bug for me. Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;The &lt;a href=&quot;http://gist.github.com/574015&quot;&gt;patch from MikZ&lt;/a&gt;
fixes this bug for me. Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-18T13:12:26+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-09-18T13:12:29+01:00</updated-at>
      <user-id type="integer">39898</user-id>
      <version type="integer">11</version>
      <user-name>Espen Antonsen</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I was wrong. 
Postgres expects local date + time zone of date.

If you pass time without timezone to postgress and have set TIME ZONE its treated like with timezone in quoted date.

Problem is somewhere else.
ActiveRecord expects dates from DB in UTC (even if you set config.active_record.default_timezone) , but Postgres passes them in TIME ZONE.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I was wrong.&lt;br&gt;
Postgres expects local date + time zone of date.&lt;/p&gt;
&lt;p&gt;If you pass time without timezone to postgress and have set TIME
ZONE its treated like with timezone in quoted date.&lt;/p&gt;
&lt;p&gt;Problem is somewhere else.&lt;br&gt;
ActiveRecord expects dates from DB in UTC (even if you set
config.active_record.default_timezone) , but Postgres passes them
in TIME ZONE.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-06T15:27:05+01:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-10-06T15:27:06+01:00</updated-at>
      <user-id type="integer">99505</user-id>
      <version type="integer">12</version>
      <user-name>MikZ</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Any progress with this ticket?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any progress with this ticket?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-09T04:02:51+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2010-12-09T04:03:03+00:00</updated-at>
      <user-id type="integer">39898</user-id>
      <version type="integer">13</version>
      <user-name>Espen Antonsen</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-10T00:00:08+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:state: incomplete
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2011-03-10T00:00:42+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">14</version>
      <user-name>rails</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14890</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-10T00:00:08+00:00</created-at>
      <creator-id type="integer">40510</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1562</number>
      <permalink>postgresql_adapter-include-time-zone-in-result-of-quoted_date</permalink>
      <priority type="integer">915</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>activerecord patch postgresql quoting timewithzone timezone utc</tag>
      <title>ActiveRecord postgresql_adapter: Include time zone in result of quoted_date( )</title>
      <updated-at type="datetime">2011-03-10T00:00:52+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">15</version>
      <user-name>rails</user-name>
      <creator-name>Suraj N. Kurapati</creator-name>
      <assigned-user-name>Tarmo T&#228;nav</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1562</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>d66895a49d1f4088200b8bc17b8127f1504be139</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-11T23:05:39+00:00</created-at>
      <filename>0001-postgresql_adapter-Include-time-zone-in-result-of-q.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">70472</id>
      <size type="integer">2042</size>
      <uploader-id type="integer">40510</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/70472/0001-postgresql_adapter-Include-time-zone-in-result-of-q.patch</url>
    </attachment>
  </attachments>
</ticket>
