<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-03T12:52:36+00:00</created-at>
  <creator-id type="integer">19160</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">3696</number>
  <permalink>race-conditions-with-cookie-session-store</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>cookiestore race-conditions sessions</tag>
  <title>Race conditions with cookie session store</title>
  <updated-at type="datetime">2011-02-03T12:52:36+00:00</updated-at>
  <user-id type="integer">65556</user-id>
  <version type="integer">4</version>
  <user-name>Rizwan Reza</user-name>
  <creator-name>Gravis</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
  <priority-name nil="true"></priority-name>
  <original-body>Hello,

I'm having a problem avec race conditions with the cookie session store. I use the user session (=cookie) to store items of his/her cart until checkout.
items are adding through a very simple ajax action (cart_items/create). I have noticed that even though all items seem to be added the cart (they are displayed as a cart item, result from the create.rjs view), the cart total is sometimes wrong. If I reload the page, I understand the cart total is indeed OK, and some items disappear from the cart.
After logging a lot of thing related to my session cart, it appears I'm running into this problem :
http://www.paulbutcher.com/2007/05/race-conditions-in-rails-sessions-and-how-to-fix-them/

Some are saying cookie store should have solved the problem, I must say it has not. The race conditions problem occurs between the 2nd and 3rd click. 2nd click will add the item to cart, and display a line in my cart. 3rd click in the same time has copied the session before the 2nd click actually added the item, so after 3rd click, I have 3 items displayed, and a total for 2 items (1st and 3rd).

Unfortunately, I don't see any solution for this, but at least a ticket is created as a reminder.</original-body>
  <latest-body>Hello,

I'm having a problem avec race conditions with the cookie session store. I use the user session (=cookie) to store items of his/her cart until checkout.
items are adding through a very simple ajax action (cart_items/create). I have noticed that even though all items seem to be added the cart (they are displayed as a cart item, result from the create.rjs view), the cart total is sometimes wrong. If I reload the page, I understand the cart total is indeed OK, and some items disappear from the cart.
After logging a lot of thing related to my session cart, it appears I'm running into this problem :
http://www.paulbutcher.com/2007/05/race-conditions-in-rails-sessions-and-how-to-fix-them/

Some are saying cookie store should have solved the problem, I must say it has not. The race conditions problem occurs between the 2nd and 3rd click. 2nd click will add the item to cart, and display a line in my cart. 3rd click in the same time has copied the session before the 2nd click actually added the item, so after 3rd click, I have 3 items displayed, and a total for 2 items (1st and 3rd).

Unfortunately, I don't see any solution for this, but at least a ticket is created as a reminder.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;I'm having a problem avec race conditions with the cookie
session store. I use the user session (=cookie) to store items of
his/her cart until checkout.&lt;br&gt;
items are adding through a very simple ajax action
(cart_items/create). I have noticed that even though all items seem
to be added the cart (they are displayed as a cart item, result
from the create.rjs view), the cart total is sometimes wrong. If I
reload the page, I understand the cart total is indeed OK, and some
items disappear from the cart.&lt;br&gt;
After logging a lot of thing related to my session cart, it appears
I'm running into this problem :&lt;br&gt;
&lt;a href=
&quot;http://www.paulbutcher.com/2007/05/race-conditions-in-rails-sessions-and-how-to-fix-them/&quot;&gt;
http://www.paulbutcher.com/2007/05/race-conditions-in-rails-session...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Some are saying cookie store should have solved the problem, I
must say it has not. The race conditions problem occurs between the
2nd and 3rd click. 2nd click will add the item to cart, and display
a line in my cart. 3rd click in the same time has copied the
session before the 2nd click actually added the item, so after 3rd
click, I have 3 items displayed, and a total for 2 items (1st and
3rd).&lt;/p&gt;
&lt;p&gt;Unfortunately, I don't see any solution for this, but at least a
ticket is created as a reminder.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hello,

I'm having a problem avec race conditions with the cookie session store. I use the user session (=cookie) to store items of his/her cart until checkout.
items are adding through a very simple ajax action (cart_items/create). I have noticed that even though all items seem to be added the cart (they are displayed as a cart item, result from the create.rjs view), the cart total is sometimes wrong. If I reload the page, I understand the cart total is indeed OK, and some items disappear from the cart.
After logging a lot of thing related to my session cart, it appears I'm running into this problem :
http://www.paulbutcher.com/2007/05/race-conditions-in-rails-sessions-and-how-to-fix-them/

Some are saying cookie store should have solved the problem, I must say it has not. The race conditions problem occurs between the 2nd and 3rd click. 2nd click will add the item to cart, and display a line in my cart. 3rd click in the same time has copied the session before the 2nd click actually added the item, so after 3rd click, I have 3 items displayed, and a total for 2 items (1st and 3rd).

Unfortunately, I don't see any solution for this, but at least a ticket is created as a reminder.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;I'm having a problem avec race conditions with the cookie
session store. I use the user session (=cookie) to store items of
his/her cart until checkout.&lt;br&gt;
items are adding through a very simple ajax action
(cart_items/create). I have noticed that even though all items seem
to be added the cart (they are displayed as a cart item, result
from the create.rjs view), the cart total is sometimes wrong. If I
reload the page, I understand the cart total is indeed OK, and some
items disappear from the cart.&lt;br&gt;
After logging a lot of thing related to my session cart, it appears
I'm running into this problem :&lt;br&gt;
&lt;a href=
&quot;http://www.paulbutcher.com/2007/05/race-conditions-in-rails-sessions-and-how-to-fix-them/&quot;&gt;
http://www.paulbutcher.com/2007/05/race-conditions-in-rails-session...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Some are saying cookie store should have solved the problem, I
must say it has not. The race conditions problem occurs between the
2nd and 3rd click. 2nd click will add the item to cart, and display
a line in my cart. 3rd click in the same time has copied the
session before the 2nd click actually added the item, so after 3rd
click, I have 3 items displayed, and a total for 2 items (1st and
3rd).&lt;/p&gt;
&lt;p&gt;Unfortunately, I don't see any solution for this, but at least a
ticket is created as a reminder.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-15T10:47:15+00:00</created-at>
      <creator-id type="integer">19160</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3696</number>
      <permalink>race-conditions-with-cookie-session-store</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookiestore race-conditions sessions</tag>
      <title>Race conditions with cookie session store</title>
      <updated-at type="datetime">2010-01-15T10:47:19+00:00</updated-at>
      <user-id type="integer">19160</user-id>
      <version type="integer">1</version>
      <user-name>Gravis</user-name>
      <creator-name>Gravis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Notice : this issue can be solved using an ajax queue apparently (funny to have an asynchronous action synchronized :) )
http://github.com/nakajima/jquery-ajax-queue</body>
      <body-html>&lt;div&gt;&lt;p&gt;Notice : this issue can be solved using an ajax queue apparently
(funny to have an asynchronous action synchronized :) )&lt;br&gt;
&lt;a href=
&quot;http://github.com/nakajima/jquery-ajax-queue&quot;&gt;http://github.com/nakajima/jquery-ajax-queue&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-17T18:05:28+00:00</created-at>
      <creator-id type="integer">19160</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3696</number>
      <permalink>race-conditions-with-cookie-session-store</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookiestore race-conditions sessions</tag>
      <title>Race conditions with cookie session store</title>
      <updated-at type="datetime">2010-01-17T18:05:33+00:00</updated-at>
      <user-id type="integer">19160</user-id>
      <version type="integer">2</version>
      <user-name>Gravis</user-name>
      <creator-name>Gravis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Using the &quot;:type =&gt; :synchronous&quot; option of link_to_remove solved my problem, but the browser has to wait until the end of the ajax action. Not perfect, but at least no more issues with false total.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Using the &quot;:type =&amp;gt; :synchronous&quot; option of link_to_remove
solved my problem, but the browser has to wait until the end of the
ajax action. Not perfect, but at least no more issues with false
total.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-21T09:01:58+00:00</created-at>
      <creator-id type="integer">19160</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3696</number>
      <permalink>race-conditions-with-cookie-session-store</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>cookiestore race-conditions sessions</tag>
      <title>Race conditions with cookie session store</title>
      <updated-at type="datetime">2010-01-21T09:01:59+00:00</updated-at>
      <user-id type="integer">19160</user-id>
      <version type="integer">3</version>
      <user-name>Gravis</user-name>
      <creator-name>Gravis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Gravis, I'm updating this ticket as invalid, as you seem to have already found the solution. Though if you think I am wrong, please update the ticket with a failing test so I can dig in. Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Gravis, I'm updating this ticket as invalid, as you seem to have
already found the solution. Though if you think I am wrong, please
update the ticket with a failing test so I can dig in. Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-01-21T15:52:28+00:00</created-at>
      <creator-id type="integer">19160</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3696</number>
      <permalink>race-conditions-with-cookie-session-store</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>cookiestore race-conditions sessions</tag>
      <title>Race conditions with cookie session store</title>
      <updated-at type="datetime">2010-01-21T15:52:30+00:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">4</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Gravis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-red-sox-definition-headphones-p-7.html&quot;&gt;&lt;strong&gt;Beats by Dr. Dre Red Sox Edition Headphones from Monster&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-high-definition-powered-isolatio-p-5.html&quot;&gt;&lt;strong&gt;Monster beats dr dre headphones black&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-high-definition-powered-isolatio-white-p-6.html&quot;&gt;&lt;strong&gt;Limited Edition White Beats by Dr. Dre&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-lamboghini-studio-headphones-limited-yellow-p-15.html&quot;&gt;&lt;strong&gt;Monster Beats Studio by Dr .Dre Lamborghini Limited Edition In Yellow Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-studio-kobe-bryant-limited-edition-headphones-p-16.html&quot;&gt;&lt;strong&gt;Monster Beats Studio Kobe Bryant Limited Edition Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-tour-inear-headphones-with-controltalk-p-8.html&quot;&gt;&lt;strong&gt;Monster Beats Tour In-Ear Headphones W/ControlTalk Black/Red&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-butterfly-by-vivienne-tam-with-controltalk-high-performa-p-9.html&quot;&gt;&lt;strong&gt;Monster Butterfly by Tam ControlTalk Pe Ear&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dre-studio-headphones-ferrarilimited-edition-p-17.html&quot;&gt;&lt;strong&gt;Monster beats by dre studio Headphones Ferrari-Limited Edition&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-by-lady-gaga-high-performance-inear-headphon-p-10.html&quot;&gt;&lt;strong&gt;Monster Heartbeats by Lady Gaga High Performance In-Ear Headphone&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-by-lady-gaga-high-performance-inear-headphonred-p-11.html&quot;&gt;&lt;strong&gt;Monster Heartbeats by Lady Gaga High Performance In-Ear Headphone-red&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-miles-davis-tribute-high-performance-inear-speakers-p-13.html&quot;&gt;&lt;strong&gt;Monster Miles Davis Tribute Jazz In-Ear Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-lady-gaga-high-performance-inear-headphonesblack-p-12.html&quot;&gt;&lt;strong&gt;Lady Gaga Heartbeats In-Ear Headphones black Chrome&lt;/strong&gt;&lt;/a&gt;|&lt;br/&gt;
&lt;a href=&quot;http://www.beatsbydrdreheadphone.com/monster-turbine-pro-copper-professional-inear-speakers-p-14.html&quot;&gt;&lt;strong&gt;Monster Turbine PRO High-Performance In-Ear Speakers - Copper&lt;/strong&gt;&lt;/a&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-red-sox-definition-headphones-p-7.html&quot;&gt;
&lt;strong&gt;Beats by Dr. Dre Red Sox Edition Headphones from
Monster&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-high-definition-powered-isolatio-p-5.html&quot;&gt;
&lt;strong&gt;Monster beats dr dre headphones black&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dr-dre-studio-high-definition-powered-isolatio-white-p-6.html&quot;&gt;
&lt;strong&gt;Limited Edition White Beats by Dr. Dre&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-lamboghini-studio-headphones-limited-yellow-p-15.html&quot;&gt;
&lt;strong&gt;Monster Beats Studio by Dr .Dre Lamborghini Limited Edition
In Yellow Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-studio-kobe-bryant-limited-edition-headphones-p-16.html&quot;&gt;
&lt;strong&gt;Monster Beats Studio Kobe Bryant Limited Edition
Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-tour-inear-headphones-with-controltalk-p-8.html&quot;&gt;
&lt;strong&gt;Monster Beats Tour In-Ear Headphones W/ControlTalk
Black/Red&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-butterfly-by-vivienne-tam-with-controltalk-high-performa-p-9.html&quot;&gt;
&lt;strong&gt;Monster Butterfly by Tam ControlTalk Pe
Ear&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-beats-by-dre-studio-headphones-ferrarilimited-edition-p-17.html&quot;&gt;
&lt;strong&gt;Monster beats by dre studio Headphones Ferrari-Limited
Edition&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-by-lady-gaga-high-performance-inear-headphon-p-10.html&quot;&gt;
&lt;strong&gt;Monster Heartbeats by Lady Gaga High Performance In-Ear
Headphone&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-by-lady-gaga-high-performance-inear-headphonred-p-11.html&quot;&gt;
&lt;strong&gt;Monster Heartbeats by Lady Gaga High Performance In-Ear
Headphone-red&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-miles-davis-tribute-high-performance-inear-speakers-p-13.html&quot;&gt;
&lt;strong&gt;Monster Miles Davis Tribute Jazz In-Ear
Headphones&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-heartbeats-lady-gaga-high-performance-inear-headphonesblack-p-12.html&quot;&gt;
&lt;strong&gt;Lady Gaga Heartbeats In-Ear Headphones black
Chrome&lt;/strong&gt;&lt;/a&gt;|&lt;br&gt;
&lt;br&gt;
&lt;a href=
&quot;http://www.beatsbydrdreheadphone.com/monster-turbine-pro-copper-professional-inear-speakers-p-14.html&quot;&gt;
&lt;strong&gt;Monster Turbine PRO High-Performance In-Ear Speakers -
Copper&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-01-22T03:35:19+00:00</created-at>
      <creator-id type="integer">19160</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3696</number>
      <permalink>race-conditions-with-cookie-session-store</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>cookiestore race-conditions sessions</tag>
      <title>Race conditions with cookie session store</title>
      <updated-at type="datetime">2011-02-03T12:52:36+00:00</updated-at>
      <user-id type="integer">133735</user-id>
      <version type="integer">5</version>
      <user-name>jessicalam</user-name>
      <creator-name>Gravis</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3696</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
