<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-05-31T23:43:57+01:00</created-at>
  <creator-id type="integer">18068</creator-id>
  <milestone-due-on type="datetime">2009-03-18T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">9901</milestone-id>
  <number type="integer">287</number>
  <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
  <priority type="integer">11173</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activerecord association patch</tag>
  <title>Associations' dynamic finders fail with :order depends on :include</title>
  <updated-at type="datetime">2008-06-19T18:02:28+01:00</updated-at>
  <user-id type="integer">1</user-id>
  <version type="integer">11</version>
  <user-name>Rick</user-name>
  <creator-name>Brandon Keepers</creator-name>
  <assigned-user-name>Rick</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
  <milestone-title>2.1.1</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>This ticket was originally submitted &quot;on trac&quot;:http://dev.rubyonrails.org/ticket/11562

Dynamic finders generate invalid queries when they are called on an association like:  has_many :posts, :include =&gt; :comments, :order_by =&gt; 'comments.position' because :include is getting ignored. (using non-dynamic #find() works correctly)

I've attached test cases that cause this error and a patch to fix it. Tested against Trunk.</original-body>
  <latest-body>This ticket was originally submitted &quot;on trac&quot;:http://dev.rubyonrails.org/ticket/11562

Dynamic finders generate invalid queries when they are called on an association like:  has_many :posts, :include =&gt; :comments, :order_by =&gt; 'comments.position' because :include is getting ignored. (using non-dynamic #find() works correctly)

I've attached test cases that cause this error and a patch to fix it. Tested against Trunk.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
This ticket was originally submitted &lt;a href=&quot;http://dev.rubyonrails.org/ticket/11562&quot;&gt;on trac&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
Dynamic finders generate invalid queries when they are called on an association like:  has_many :posts, :include =&gt; :comments, :order_by =&gt; 'comments.position' because :include is getting ignored. (using non-dynamic #find() works correctly)
&lt;/p&gt;&lt;p&gt;
I've attached test cases that cause this error and a patch to fix it. Tested against Trunk.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This ticket was originally submitted &quot;on trac&quot;:http://dev.rubyonrails.org/ticket/11562

Dynamic finders generate invalid queries when they are called on an association like:  has_many :posts, :include =&gt; :comments, :order_by =&gt; 'comments.position' because :include is getting ignored. (using non-dynamic #find() works correctly)

I've attached test cases that cause this error and a patch to fix it. Tested against Trunk.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This ticket was originally submitted &lt;a href=&quot;http://dev.rubyonrails.org/ticket/11562&quot;&gt;on trac&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
Dynamic finders generate invalid queries when they are called on an association like:  has_many :posts, :include =&gt; :comments, :order_by =&gt; 'comments.position' because :include is getting ignored. (using non-dynamic #find() works correctly)
&lt;/p&gt;&lt;p&gt;
I've attached test cases that cause this error and a patch to fix it. Tested against Trunk.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-31T23:43:58+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-05-31T23:43:58+01:00</updated-at>
      <user-id type="integer">18068</user-id>
      <version type="integer">1</version>
      <user-name>Brandon Keepers</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;
+1
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T16:04:33+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T16:04:33+01:00</updated-at>
      <user-id type="integer">120</user-id>
      <version type="integer">2</version>
      <user-name>Daniel Morrison</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Can you create a git patch?  See the &quot;docs on contributing&quot;:http://rails.lighthouseapp.com/projects/8994/sending-patches.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Can you create a git patch?  See the &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994/sending-patches&quot;&gt;docs on contributing&lt;/a&gt;.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T16:17:42+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T16:17:42+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">3</version>
      <user-name>Rick</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Updated patch for latest changes in edge rails and exported using git-format-patch</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Updated patch for latest changes in edge rails and exported using git-format-patch
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T16:33:35+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T16:33:35+01:00</updated-at>
      <user-id type="integer">18068</user-id>
      <version type="integer">4</version>
      <user-name>Brandon Keepers</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Doh, just realized I committed the change to the mysql connection info. Path updated</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Doh, just realized I committed the change to the mysql connection info. Path updated
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T16:41:45+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T16:41:45+01:00</updated-at>
      <user-id type="integer">18068</user-id>
      <version type="integer">5</version>
      <user-name>Brandon Keepers</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Hey, I've got this pushed to &quot;my own fork&quot;:http://github.com/technoweenie/rails/tree/master.  I started pushing some config.gem tweaks there so others could play with them, before they were finalized in rails core.  If I was smart, I would've put them in a branch so that I don't have other patches like this one stuck in limbo.  We'll merge it back in for 2.1.1 though.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hey, I've got this pushed to &lt;a href=&quot;http://github.com/technoweenie/rails/tree/master&quot;&gt;my own fork&lt;/a&gt;.  I started pushing some config.gem tweaks there so others could play with them, before they were finalized in rails core.  If I was smart, I would've put them in a branch so that I don't have other patches like this one stuck in limbo.  We'll merge it back in for 2.1.1 though.
&lt;/p&gt;&lt;p&gt;
Thanks.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T17:11:47+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T17:11:47+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">6</version>
      <user-name>Rick</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Could you cherry-pick to master, Rick?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Could you cherry-pick to master, Rick?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-09T20:08:22+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-09T20:08:22+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">7</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Any way we can get this pushed or cherry-picked into the main repo?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Any way we can get this pushed or cherry-picked into the main repo?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-17T19:42:34+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-17T19:42:34+01:00</updated-at>
      <user-id type="integer">18068</user-id>
      <version type="integer">8</version>
      <user-name>Brandon Keepers</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>It should be cherry-picked to 2-1-stable as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
It should be cherry-picked to 2-1-stable as well.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-17T19:53:24+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-17T19:53:24+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">9</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Pushed, but I don't see a 2-1 stable branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Pushed, but I don't see a 2-1 stable branch.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-19T18:02:12+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-19T18:02:12+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">10</version>
      <user-name>Rick</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-19T18:02:28+01:00</created-at>
      <creator-id type="integer">18068</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">287</number>
      <permalink>associations-dynamic-finders-fail-with-order-depends-on-include</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Associations' dynamic finders fail with :order depends on :include</title>
      <updated-at type="datetime">2008-06-19T18:02:28+01:00</updated-at>
      <user-id type="integer">1</user-id>
      <version type="integer">11</version>
      <user-name>Rick</user-name>
      <creator-name>Brandon Keepers</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/287</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>89d1799cf413daa780edf45076f2f1c225fbbcba</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-31T23:43:58+01:00</created-at>
      <filename>dynamic_finders_on_associations_with_include_and_order.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">25287</id>
      <size type="integer">7479</size>
      <uploader-id type="integer">18068</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/25287/dynamic_finders_on_associations_with_include_and_order.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>80cfebe788cb6d3b8b4a3e280786a77f3bb48f4a</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-09T16:33:35+01:00</created-at>
      <filename>dynamic_finder_with_eager_loading.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">26483</id>
      <size type="integer">7459</size>
      <uploader-id type="integer">18068</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/26483/dynamic_finder_with_eager_loading.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>ff43262ee3e32ccceb7101fb9f180fa73e95e5f8</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-09T16:41:45+01:00</created-at>
      <filename>dynamic_finder_with_eager_loading.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">26487</id>
      <size type="integer">6745</size>
      <uploader-id type="integer">18068</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/26487/dynamic_finder_with_eager_loading.diff</url>
    </attachment>
  </attachments>
</ticket>
