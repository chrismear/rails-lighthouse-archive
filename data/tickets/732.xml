<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1366</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-07-31T03:47:31+01:00</created-at>
  <creator-id type="integer">27648</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">732</number>
  <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
  <priority type="integer">196</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>2.1 2.2 activerecord patch</tag>
  <title>Deprecation warning in xml_serializer.rb:308</title>
  <updated-at type="datetime">2009-01-16T17:30:08+00:00</updated-at>
  <user-id type="integer">1366</user-id>
  <version type="integer">15</version>
  <user-name>Pratik</user-name>
  <creator-name>Bill</creator-name>
  <assigned-user-name>Pratik</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>I stumbled across a bug here:
active_record/serializers/xml_serializer.rb:308

I believe type just needs to be changed to class, not really sure why it was type - I hope this is actually a bug =)

I get this error in my rails log:
@@@ ruby
/usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class
@@@

Patch attached</original-body>
  <latest-body>I stumbled across a bug here:
active_record/serializers/xml_serializer.rb:308

I believe type just needs to be changed to class, not really sure why it was type - I hope this is actually a bug =)

I get this error in my rails log:
@@@ ruby
/usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class
@@@

Patch attached</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
I stumbled across a bug here:
&lt;/p&gt;&lt;p&gt;
active_record/serializers/xml_serializer.rb:308
&lt;/p&gt;&lt;p&gt;
I believe type just needs to be changed to class, not really sure why it was type - I hope this is actually a bug =)
&lt;/p&gt;&lt;p&gt;
I get this error in my rails log:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;/usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Patch attached
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I stumbled across a bug here:
active_record/serializers/xml_serializer.rb:308

I believe type just needs to be changed to class, not really sure why it was type - I hope this is actually a bug =)

I get this error in my rails log:
@@@ ruby
/usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class
@@@

Patch attached</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I stumbled across a bug here:
&lt;/p&gt;&lt;p&gt;
active_record/serializers/xml_serializer.rb:308
&lt;/p&gt;&lt;p&gt;
I believe type just needs to be changed to class, not really sure why it was type - I hope this is actually a bug =)
&lt;/p&gt;&lt;p&gt;
I get this error in my rails log:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;/usr/lib/ruby/gems/1.8/gems/activerecord-2.1.0/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Patch attached
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-31T03:47:31+01:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-07-31T03:47:31+01:00</updated-at>
      <user-id type="integer">27648</user-id>
      <version type="integer">1</version>
      <user-name>Bill</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Assuming your description of the problem is correct, your patch is backward. Changes class -&gt; type rather than type -&gt; class.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Assuming your description of the problem is correct, your patch is backward. Changes class -&gt; type rather than type -&gt; class.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-31T05:29:16+01:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.1 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-07-31T05:29:16+01:00</updated-at>
      <user-id type="integer">16302</user-id>
      <version type="integer">2</version>
      <user-name>Brady Bouchard</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Tests missing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Tests missing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-22T14:24:47+01:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-08-22T14:24:47+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The current test (activerecord/test/cases/xml_serialization_test.rb) didn't need a change nor a new test is needed.

According to Ruby documentation the usage of Object#type is deprecated and Object#class shoud be used instead. So the provided patch fixes the annoying warning messages in tests and server logs ...

.../vendor/rails/activerecord/lib/active_record/serializers/xml_serializer.rb:308: warning: Object#type is deprecated; use Object#class

For me the patch works and didn't break anything. My tests and the Rails tests are all running fine.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The current test
(activerecord/test/cases/xml_serialization_test.rb) didn't need a
change nor a new test is needed.&lt;/p&gt;
&lt;p&gt;According to Ruby documentation the usage of Object#type is
deprecated and Object#class shoud be used instead. So the provided
patch fixes the annoying warning messages in tests and server logs
...&lt;/p&gt;
&lt;p&gt;
.../vendor/rails/activerecord/lib/active_record/serializers/xml_serializer.rb:308:
warning: Object#type is deprecated; use Object#class&lt;/p&gt;
&lt;p&gt;For me the patch works and didn't break anything. My tests and
the Rails tests are all running fine.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-30T16:08:53+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-11-30T16:08:58+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">4</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Just upgraded my project to Rails 2.2.2 ... warnings still there.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just upgraded my project to Rails 2.2.2 ... warnings still
there.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-01T19:40:35+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-01T19:40:38+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">5</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I tried your change and it caused multiple test failures because all of the type attributes end up being ActiveRecord::ConnectionAdapters::Column rather then integer/datetime/etc...

Object.type is deprecated, however the Column object has a type attribute. What's happening here is that the serializer is trying to compute the type for an attribute that has no matching column and so compute_type ends up calling type on nil (which is Object's deprecated type). I'd guess that this is actually an application error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I tried your change and it caused multiple test failures because
all of the type attributes end up being
ActiveRecord::ConnectionAdapters::Column rather then
integer/datetime/etc...&lt;/p&gt;
&lt;p&gt;Object.type is deprecated, however the Column object has a type
attribute. What's happening here is that the serializer is trying
to compute the type for an attribute that has no matching column
and so compute_type ends up calling type on nil (which is Object's
deprecated type). I'd guess that this is actually an application
error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-20T15:40:49+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.1 activerecord patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-20T15:40:52+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">6</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Sorry Frederick, you're right! The ActiveRecord tests really break, i was in a complete wrong branch :( My app also breaks, as you describes with type equal to ActiveRecord::ConnectionAdapters::Column. So the patch didn't work.

On the other hand the warning is still there in my app and can't figure out why. The warning pops up during a deep nested XML serialization with one HABTM relation (implemented with a join table). Seems that ActiveRecord can't resolve the column types of the join table in this case!?

I'm a noob in Rails, so I don't know how to fix this in my app or in the rails code. But what I've done is to add a ActiveRecord test that reproduces the ruby warning and fails if type==NilClass.

@@@ ruby
def test_to_xml_including_has_and_belongs_to_many_with_options
  xml = categories(:general).to_xml(
    :indent  =&gt; 0, :skip_instruct =&gt; true,
    :include =&gt; { :authors =&gt; {}, :posts =&gt; { :include =&gt; :comments } }
  )
  assert !xml.include?(%(&lt;post-id type=&quot;NilClass&quot;&gt;1&lt;/post-id&gt;))
end
@@@

Produces this XML:

@@@ xml
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;category&gt;
	&lt;categorizations-count type=&quot;integer&quot; nil=&quot;true&quot;/&gt;
	&lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
	&lt;name&gt;General&lt;/name&gt;
	&lt;posts type=&quot;array&quot;/&gt;
	&lt;authors type=&quot;array&quot;&gt;
		&lt;author&gt;
			&lt;author-address-extra-id type=&quot;integer&quot;&gt;2&lt;/author-address-extra-id&gt;
			&lt;author-address-id type=&quot;integer&quot;&gt;1&lt;/author-address-id&gt;
			&lt;id type=&quot;integer&quot;&gt;1&lt;/id&gt;
			&lt;name&gt;David&lt;/name&gt;
			&lt;post-id type=&quot;NilClass&quot;&gt;1&lt;/post-id&gt;
		&lt;/author&gt;
		&lt;author&gt;
			&lt;author-address-extra-id type=&quot;integer&quot; nil=&quot;true&quot;/&gt;
			&lt;author-address-id type=&quot;integer&quot; nil=&quot;true&quot;/&gt;
			&lt;id type=&quot;integer&quot;&gt;2&lt;/id&gt;
			&lt;name&gt;Mary&lt;/name&gt;
			&lt;post-id type=&quot;NilClass&quot;&gt;2&lt;/post-id&gt;
		&lt;/author&gt;
	&lt;/authors&gt;
&lt;/category&gt;
@@@

The test is like what I do in my app. Perhaps the include is wrong, or there is really a problem in xml_serializer.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry Frederick, you're right! The ActiveRecord tests really
break, i was in a complete wrong branch :( My app also breaks, as
you describes with type equal to
ActiveRecord::ConnectionAdapters::Column. So the patch didn't
work.&lt;/p&gt;
&lt;p&gt;On the other hand the warning is still there in my app and can't
figure out why. The warning pops up during a deep nested XML
serialization with one HABTM relation (implemented with a join
table). Seems that ActiveRecord can't resolve the column types of
the join table in this case!?&lt;/p&gt;
&lt;p&gt;I'm a noob in Rails, so I don't know how to fix this in my app
or in the rails code. But what I've done is to add a ActiveRecord
test that reproduces the ruby warning and fails if
type==NilClass.&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
def test_to_xml_including_has_and_belongs_to_many_with_options
  xml = categories(:general).to_xml(
    :indent  =&amp;gt; 0, :skip_instruct =&amp;gt; true,
    :include =&amp;gt; { :authors =&amp;gt; {}, :posts =&amp;gt; { :include =&amp;gt; :comments } }
  )
  assert !xml.include?(%(&amp;lt;post-id type=&amp;quot;NilClass&amp;quot;&amp;gt;1&amp;lt;/post-id&amp;gt;))
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Produces this XML:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;xml&quot;&gt;
&amp;lt;?xml version=&amp;quot;1.0&amp;quot;?&amp;gt;
&amp;lt;category&amp;gt;
	&amp;lt;categorizations-count type=&amp;quot;integer&amp;quot; nil=&amp;quot;true&amp;quot;/&amp;gt;
	&amp;lt;id type=&amp;quot;integer&amp;quot;&amp;gt;1&amp;lt;/id&amp;gt;
	&amp;lt;name&amp;gt;General&amp;lt;/name&amp;gt;
	&amp;lt;posts type=&amp;quot;array&amp;quot;/&amp;gt;
	&amp;lt;authors type=&amp;quot;array&amp;quot;&amp;gt;
		&amp;lt;author&amp;gt;
			&amp;lt;author-address-extra-id type=&amp;quot;integer&amp;quot;&amp;gt;2&amp;lt;/author-address-extra-id&amp;gt;
			&amp;lt;author-address-id type=&amp;quot;integer&amp;quot;&amp;gt;1&amp;lt;/author-address-id&amp;gt;
			&amp;lt;id type=&amp;quot;integer&amp;quot;&amp;gt;1&amp;lt;/id&amp;gt;
			&amp;lt;name&amp;gt;David&amp;lt;/name&amp;gt;
			&amp;lt;post-id type=&amp;quot;NilClass&amp;quot;&amp;gt;1&amp;lt;/post-id&amp;gt;
		&amp;lt;/author&amp;gt;
		&amp;lt;author&amp;gt;
			&amp;lt;author-address-extra-id type=&amp;quot;integer&amp;quot; nil=&amp;quot;true&amp;quot;/&amp;gt;
			&amp;lt;author-address-id type=&amp;quot;integer&amp;quot; nil=&amp;quot;true&amp;quot;/&amp;gt;
			&amp;lt;id type=&amp;quot;integer&amp;quot;&amp;gt;2&amp;lt;/id&amp;gt;
			&amp;lt;name&amp;gt;Mary&amp;lt;/name&amp;gt;
			&amp;lt;post-id type=&amp;quot;NilClass&amp;quot;&amp;gt;2&amp;lt;/post-id&amp;gt;
		&amp;lt;/author&amp;gt;
	&amp;lt;/authors&amp;gt;
&amp;lt;/category&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The test is like what I do in my app. Perhaps the include is
wrong, or there is really a problem in xml_serializer.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-26T12:37:11+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-26T12:37:13+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">7</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>What do the corresponding tables/relations look like ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;What do the corresponding tables/relations look like ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-26T13:03:03+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-26T13:03:08+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">8</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Sorry, don't know what you mean?

The patch to reproduce the warnings is against the current Rails master. I didn't change any tables/relations in the ActiveRecord test suite, so if you apply the patch and run the ActiveRecord tests you'll see what I mean.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry, don't know what you mean?&lt;/p&gt;
&lt;p&gt;The patch to reproduce the warnings is against the current Rails
master. I didn't change any tables/relations in the ActiveRecord
test suite, so if you apply the patch and run the ActiveRecord
tests you'll see what I mean.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-26T13:16:48+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-26T13:16:50+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">9</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Ah ok, I mistakenly assumed that test was from your app</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ah ok, I mistakenly assumed that test was from your app&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-26T14:32:09+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- 
:state: incomplete
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-26T14:32:11+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">10</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Figured this one out. If anything it's more of a habtm bug than xml_serialization: habtm does a join but (by default) does a select *, so you get the columns from the join table. When you get to the point where your serializing you're serializing these extra attributes but rails doesn't know what their column type is. You could fix this by making your habtms look like

@@@ ruby
class Foo
  has_and_belongs_to_many :bars, :select =&gt; &quot;#{table_name}.*&quot;
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Figured this one out. If anything it's more of a habtm bug than
xml_serialization: habtm does a join but (by default) does a select
*, so you get the columns from the join table. When you get to the
point where your serializing you're serializing these extra
attributes but rails doesn't know what their column type is. You
could fix this by making your habtms look like&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
class Foo
  has_and_belongs_to_many :bars, :select =&amp;gt; &amp;quot;#{table_name}.*&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-26T23:57:18+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-26T23:57:22+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">11</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>This helps to supress the warning messages, but the types in the XML are still wrong (NilClass). From my app:

@@@ xml
&lt;cmdb-applications type=&quot;array&quot;&gt;
  &lt;cmdb-application&gt;
    &lt;aid&gt;NTE07&lt;/aid&gt;
    &lt;cmdb-application-id type=&quot;NilClass&quot;&gt;33&lt;/cmdb-application-id&gt;
    &lt;created-at type=&quot;datetime&quot;&gt;2008-12-26T15:36:01+01:00&lt;/created-at&gt;
    &lt;id type=&quot;integer&quot;&gt;33&lt;/id&gt;
    &lt;partition-id type=&quot;NilClass&quot;&gt;343&lt;/partition-id&gt;
    &lt;updated-at type=&quot;datetime&quot;&gt;2008-12-26T15:36:01+01:00&lt;/updated-at&gt;
  &lt;/cmdb-application&gt;
  &lt;cmdb-application&gt;
    &lt;aid&gt;e42aa&lt;/aid&gt;
    &lt;cmdb-application-id type=&quot;NilClass&quot;&gt;34&lt;/cmdb-application-id&gt;
...
@@@

What I don't understand is that only the types of the IDs of the join table are wrong, the type of the column &quot;aid&quot; in this case string, is correct!?

As all the IDs are not really interesting and necessary in XML output, I can skip them like ...

@@@ ruby
Partition.to_xml(:except =&gt; [ :id, :cmdb_application_id, :cmdb_system_id ], :include =&gt; { :cmdb_cluster =&gt; {}, :cmdb_applications =&gt; {}, :cmdb_systems =&gt; {})
@@@

But this is only a workaround.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This helps to supress the warning messages, but the types in the
XML are still wrong (NilClass). From my app:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;xml&quot;&gt;
&amp;lt;cmdb-applications type=&amp;quot;array&amp;quot;&amp;gt;
  &amp;lt;cmdb-application&amp;gt;
    &amp;lt;aid&amp;gt;NTE07&amp;lt;/aid&amp;gt;
    &amp;lt;cmdb-application-id type=&amp;quot;NilClass&amp;quot;&amp;gt;33&amp;lt;/cmdb-application-id&amp;gt;
    &amp;lt;created-at type=&amp;quot;datetime&amp;quot;&amp;gt;2008-12-26T15:36:01+01:00&amp;lt;/created-at&amp;gt;
    &amp;lt;id type=&amp;quot;integer&amp;quot;&amp;gt;33&amp;lt;/id&amp;gt;
    &amp;lt;partition-id type=&amp;quot;NilClass&amp;quot;&amp;gt;343&amp;lt;/partition-id&amp;gt;
    &amp;lt;updated-at type=&amp;quot;datetime&amp;quot;&amp;gt;2008-12-26T15:36:01+01:00&amp;lt;/updated-at&amp;gt;
  &amp;lt;/cmdb-application&amp;gt;
  &amp;lt;cmdb-application&amp;gt;
    &amp;lt;aid&amp;gt;e42aa&amp;lt;/aid&amp;gt;
    &amp;lt;cmdb-application-id type=&amp;quot;NilClass&amp;quot;&amp;gt;34&amp;lt;/cmdb-application-id&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What I don't understand is that only the types of the IDs of the
join table are wrong, the type of the column &quot;aid&quot; in this case
string, is correct!?&lt;/p&gt;
&lt;p&gt;As all the IDs are not really interesting and necessary in XML
output, I can skip them like ...&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
Partition.to_xml(:except =&amp;gt; [ :id, :cmdb_application_id, :cmdb_system_id ], :include =&amp;gt; { :cmdb_cluster =&amp;gt; {}, :cmdb_applications =&amp;gt; {}, :cmdb_systems =&amp;gt; {})
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But this is only a workaround.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-27T11:35:48+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-27T11:35:53+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">12</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>The join table ids are the only ones wrong because if you ask CmdbApplication 'What's the type of Cmdb_application_id' it says 'I don't know' because the corresponding table has no such column.

A cleaner workaround (which should quite possibly just be the way things are) is to make the habtm not select those columns.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The join table ids are the only ones wrong because if you ask
CmdbApplication 'What's the type of Cmdb_application_id' it says 'I
don't know' because the corresponding table has no such column.&lt;/p&gt;
&lt;p&gt;A cleaner workaround (which should quite possibly just be the
way things are) is to make the habtm not select those columns.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-27T11:44:26+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-27T11:44:27+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">13</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Ahh OK, I understand. So we have two solutions to work around the problem: to_xml with :except and hbtm with :select.

If the rails default behaviour is &quot;works as designed&quot;, I think you can close the ticket now.

Thank you!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ahh OK, I understand. So we have two solutions to work around
the problem: to_xml with :except and hbtm with :select.&lt;/p&gt;
&lt;p&gt;If the rails default behaviour is &quot;works as designed&quot;, I think
you can close the ticket now.&lt;/p&gt;
&lt;p&gt;Thank you!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-27T12:23:23+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2008-12-27T12:23:25+00:00</updated-at>
      <user-id type="integer">39317</user-id>
      <version type="integer">14</version>
      <user-name>schlucke</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-16T17:30:04+00:00</created-at>
      <creator-id type="integer">27648</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">732</number>
      <permalink>deprecation-warning-in-xml_serializer-rb-308</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>2.1 2.2 activerecord patch</tag>
      <title>Deprecation warning in xml_serializer.rb:308</title>
      <updated-at type="datetime">2009-01-16T17:30:08+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">15</version>
      <user-name>Pratik</user-name>
      <creator-name>Bill</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/732</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>c4d203852f6042383a6f419057f3edcd398a59db</code>
      <content-type>application/octet-stream</content-type>
      <created-at type="datetime">2008-07-31T03:47:31+01:00</created-at>
      <filename>xml_serializer.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">36024</id>
      <size type="integer">10701</size>
      <uploader-id type="integer">27648</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/36024/xml_serializer.rb</url>
    </attachment>
    <attachment type="Attachment">
      <code>5a3cd914384fabce13c56b00430a2b5b846c2e0e</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-07-31T03:50:20+01:00</created-at>
      <filename>xml_serizlizer.rb.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">36026</id>
      <size type="integer">523</size>
      <uploader-id type="integer">27648</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/36026/xml_serizlizer.rb.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>e92fd9c7516092c40d56cd097bf20de46fb4f40b</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-26T12:37:11+00:00</created-at>
      <filename>test_to_xml_including_has_and_belongs_to_many_with_options.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">73928</id>
      <size type="integer">1250</size>
      <uploader-id type="integer">39317</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/73928/test_to_xml_including_has_and_belongs_to_many_with_options.diff</url>
    </attachment>
  </attachments>
</ticket>
