<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">11378</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-11-23T08:51:25+00:00</created-at>
  <creator-id type="integer">39040</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">71472</milestone-id>
  <number type="integer">1485</number>
  <permalink>json_escape-eats-away-double-quotes</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag nil="true"></tag>
  <title>json_escape eats away double quotes</title>
  <updated-at type="datetime">2011-03-17T00:02:06+00:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">39</version>
  <user-name>rails</user-name>
  <creator-name>Vlad R</creator-name>
  <assigned-user-name>Xavier Noria</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
  <milestone-title>3.x</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>json_escape(&quot;hello&quot;.to_json) will incorrectly produce 'hello' instead of '&quot;hello&quot;'

rails/actionpack/lib/action_view/template_handlers/erb.rb
 or
rails/actionpack/lib/action_view/erb/util.rb


    def json_escape(s)
      s.to_s.gsub(/[&amp;&quot;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end


should probably read:

    def json_escape(s)
      s.to_s.gsub(/[&amp;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end</original-body>
  <latest-body>json_escape(&quot;hello&quot;.to_json) will incorrectly produce 'hello' instead of '&quot;hello&quot;'

rails/actionpack/lib/action_view/template_handlers/erb.rb
 or
rails/actionpack/lib/action_view/erb/util.rb


    def json_escape(s)
      s.to_s.gsub(/[&amp;&quot;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end


should probably read:

    def json_escape(s)
      s.to_s.gsub(/[&amp;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;json_escape(&quot;hello&quot;.to_json) will incorrectly produce 'hello'
instead of '&quot;hello&quot;'&lt;/p&gt;
&lt;p&gt;rails/actionpack/lib/action_view/template_handlers/erb.rb or
rails/actionpack/lib/action_view/erb/util.rb&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def json_escape(s)
  s.to_s.gsub(/[&amp;amp;&quot;&amp;gt;&amp;lt;]/) { |special| JSON_ESCAPE[special] }
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;should probably read:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def json_escape(s)
  s.to_s.gsub(/[&amp;amp;&amp;gt;&amp;lt;]/) { |special| JSON_ESCAPE[special] }
end
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>json_escape(&quot;hello&quot;.to_json) will incorrectly produce 'hello' instead of '&quot;hello&quot;'

rails/actionpack/lib/action_view/template_handlers/erb.rb
 or
rails/actionpack/lib/action_view/erb/util.rb


    def json_escape(s)
      s.to_s.gsub(/[&amp;&quot;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end


should probably read:

    def json_escape(s)
      s.to_s.gsub(/[&amp;&gt;&lt;]/) { |special| JSON_ESCAPE[special] }
    end</body>
      <body-html>&lt;div&gt;&lt;p&gt;json_escape(&quot;hello&quot;.to_json) will incorrectly produce 'hello'
instead of '&quot;hello&quot;'&lt;/p&gt;
&lt;p&gt;rails/actionpack/lib/action_view/template_handlers/erb.rb or
rails/actionpack/lib/action_view/erb/util.rb&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def json_escape(s)
  s.to_s.gsub(/[&amp;amp;&quot;&amp;gt;&amp;lt;]/) { |special| JSON_ESCAPE[special] }
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;should probably read:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def json_escape(s)
  s.to_s.gsub(/[&amp;amp;&amp;gt;&amp;lt;]/) { |special| JSON_ESCAPE[special] }
end
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-26T20:53:04+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2008-11-26T20:53:09+00:00</updated-at>
      <user-id type="integer">39040</user-id>
      <version type="integer">1</version>
      <user-name>Vlad R</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Could you please make that a patch with a test case ? http://guides.rails.info/contributing_to_rails.html should be helpful.

Thanks!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could you please make that a patch with a test case ? &lt;a href=&quot;http://guides.rails.info/contributing_to_rails.html&quot;&gt;http://guides.rails.info/contrib...&lt;/a&gt;
should be helpful.&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-12T15:51:49+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-03-12T15:51:51+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">2</version>
      <user-name>Pratik</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Attaching a patch with a test case.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Attaching a patch with a test case.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-01T20:17:53+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag>patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-04-01T20:17:56+01:00</updated-at>
      <user-id type="integer">52719</user-id>
      <version type="integer">3</version>
      <user-name>ion</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-04-02T11:38:28+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: incomplete
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-04-02T11:38:30+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">4</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-06T12:55:42+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-06T12:55:45+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">5</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>verified

+1 The above patch works. Applied it to 2-3-stable and ran tests to see it working.</body>
      <body-html>&lt;div&gt;&lt;p&gt;verified&lt;/p&gt;
&lt;p&gt;+1 The above patch works. Applied it to 2-3-stable and ran tests
to see it working.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-07T21:18:03+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-07T21:18:07+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">6</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>verified</body>
      <body-html>&lt;div&gt;&lt;p&gt;verified&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-09T00:30:56+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-09T00:31:02+01:00</updated-at>
      <user-id type="integer">64574</user-id>
      <version type="integer">7</version>
      <user-name>Rajesh</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>-1  This is the expected behavior according to Michael Koziarski.</body>
      <body-html>&lt;div&gt;&lt;p&gt;-1 This is the expected behavior according to Michael
Koziarski.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-09T00:57:23+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>bugmash patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-09T00:57:29+01:00</updated-at>
      <user-id type="integer">45230</user-id>
      <version type="integer">8</version>
      <user-name>Matt Duncan</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is intended functionality of json_escape.  It returns the strings without dangerous characters, not escaped to be json values themselves.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is intended functionality of json_escape. It returns the
strings without dangerous characters, not escaped to be json values
themselves.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-09T00:58:36+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>bugmash patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-09T00:58:43+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">9</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-09T01:18:17+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: bugmash patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2009-08-09T01:18:20+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">10</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>In the example in the RDoc for `json_escape`, assuming `@person` was an Active Record object, `to_json` would serialize it into a JSON object in which the keys are quoted and string values are too, `json_escape` would make the JSON invalid.

From the documentation:
@@@ erb
  &lt;%=j @person.to_json %&gt;
@@@
The resulting JSON object for `@person` would become invalid after `json_escape`.

It would output something like this:
@@@ html
  {person:{name:John Doe,created_at:2010-04-28T00:15:24Z,updated_at:2010-04-28T00:19:30Z,id:1}}
@@@

The only use I can think of is (as long as you don't need quotes in the string):
@@@ erb
  &lt;script type=&quot;text/javascript&quot;&gt;
  var my_string = &quot;My templated JSON string within HTML &lt;%=j @ruby_string.to_json %&gt;&quot;;
  &lt;/script&gt;
@@@
But even then quotes would be stripped but to_json would have added the slash. So even in the above example, if @ruby_string ended in a quote you'd be still left with the backslash, causing problems. You can't omit the to_json because json_escape doesn't escape backslashes.

Is the output of json_escape intended to not output a complete JSON value? Just partial JSON string value without any backslash handling?

I guess I don't really understand when someone would use `json_escape`. At least, this ticket should not have been marked invalid without changing the RDoc.

Seems more useful if to_json could take an option to encode HTML special chars as it was generating the json.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In the example in the RDoc for &lt;code&gt;json_escape&lt;/code&gt;,
assuming &lt;code&gt;@person&lt;/code&gt; was an Active Record object,
&lt;code&gt;to_json&lt;/code&gt; would serialize it into a JSON object in which
the keys are quoted and string values are too,
&lt;code&gt;json_escape&lt;/code&gt; would make the JSON invalid.&lt;/p&gt;
&lt;p&gt;From the documentation:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;erb&quot;&gt;  &amp;lt;%=j @person.to_json %&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
The resulting JSON object for &lt;code&gt;@person&lt;/code&gt; would become
invalid after &lt;code&gt;json_escape&lt;/code&gt;.
&lt;p&gt;It would output something like this:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;html&quot;&gt;  {person:{name:John Doe,created_at:2010-04-28T00:15:24Z,updated_at:2010-04-28T00:19:30Z,id:1}}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The only use I can think of is (as long as you don't need quotes
in the string):&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;erb&quot;&gt;  &amp;lt;script type=&quot;text/javascript&quot;&amp;gt;
  var my_string = &quot;My templated JSON string within HTML &amp;lt;%=j @ruby_string.to_json %&amp;gt;&quot;;
  &amp;lt;/script&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
But even then quotes would be stripped but to_json would have added
the slash. So even in the above example, if @ruby_string ended in a
quote you'd be still left with the backslash, causing problems. You
can't omit the to_json because json_escape doesn't escape
backslashes.
&lt;p&gt;Is the output of json_escape intended to not output a complete
JSON value? Just partial JSON string value without any backslash
handling?&lt;/p&gt;
&lt;p&gt;I guess I don't really understand when someone would use
&lt;code&gt;json_escape&lt;/code&gt;. At least, this ticket should not have
been marked invalid without changing the RDoc.&lt;/p&gt;
&lt;p&gt;Seems more useful if to_json could take an option to encode HTML
special chars as it was generating the json.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-28T01:47:47+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>patch</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-04-28T01:47:50+01:00</updated-at>
      <user-id type="integer">51306</user-id>
      <version type="integer">11</version>
      <user-name>Kristofor Selden</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I fully agree with Kristofor Selden that json_escape documentation should explicitly mention that after that operation, the output is not a valid JSON.

Attached is a documentation patch which fixes that. Patch is against rails3 edge.

Also the doc should have an example of the most common way a JSON structure is used and what the value would be after json_escape.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I fully agree with Kristofor Selden that json_escape
documentation should explicitly mention that after that operation,
the output is not a valid JSON.&lt;/p&gt;
&lt;p&gt;Attached is a documentation patch which fixes that. Patch is
against rails3 edge.&lt;/p&gt;
&lt;p&gt;Also the doc should have an example of the most common way a
JSON structure is used and what the value would be after
json_escape.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-28T03:00:56+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-04-28T03:01:00+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">12</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I don't follow why `json_escape('&quot;') == ''` in the first place and the old commits don't reveal why. Rick?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I don't follow why &lt;code&gt;json_escape('&quot;') == ''&lt;/code&gt; in the
first place and the old commits don't reveal why. Rick?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-28T06:04:53+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-04-28T06:04:55+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">13</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20088)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20088&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-16T02:41:08+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: doc documenation patch rails3
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-05-16T02:41:08+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">14</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20606)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20606&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T17:54:42+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 50064
</diffable-attributes>
      <milestone-id type="integer">73241</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-05-23T17:54:42+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">15</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.7</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20631)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20631&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-24T09:40:50+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73241
</diffable-attributes>
      <milestone-id type="integer">73273</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-05-24T09:40:50+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.8</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20816)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20816&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-25T23:45:37+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73273
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-05-25T23:45:37+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">17</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Was this doc patch applied?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Was this doc patch applied?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-19T02:09:46+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-06-19T02:09:55+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">18</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 
why is not this ticket  applied? 

You should use escape_javascript if you want to escape double quotes.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 why is not this ticket applied?&lt;/p&gt;
&lt;p&gt;You should use escape_javascript if you want to escape double
quotes.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-27T03:02:26+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-08-27T03:02:31+01:00</updated-at>
      <user-id type="integer">99514</user-id>
      <version type="integer">19</version>
      <user-name>Tohru Hashimoto</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27613)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27613&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T02:28:48+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-08-30T02:28:48+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">20</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 to Neeraj's patch, but I guess you should reroll it to only include this change (it contains an unrelated patch that has already been committed).</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 to Neeraj's patch, but I guess you should reroll it to only
include this change (it contains an unrelated patch that has
already been committed).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-09T18:15:23+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-09T18:15:25+01:00</updated-at>
      <user-id type="integer">81551</user-id>
      <version type="integer">21</version>
      <user-name>Andrea Campi</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Rick</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Neeraj, could you please make the necessary changes? :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj, could you please make the necessary changes? :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-14T10:30:58+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 1
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-14T10:31:03+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">22</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Andrea Since it is a documentation patch go ahead and make the necessary changes and apply it. :-)

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Andrea Since it is a documentation patch go ahead and make the
necessary changes and apply it. :-)&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-14T15:22:15+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 40263
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-14T15:22:20+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">23</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Andrea, You can make changes directly here: http://github.com/lifo/docrails the changes are later merged into the main Rails repo after review. Also remember to follow the guidelines provided here &amp;mdash; http://guides.rubyonrails.org/api_documentation_guidelines.html &amp;mdash; and do report back so that this ticket can be closed. Thanks! :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Andrea, You can make changes directly here: &lt;a href=
&quot;http://github.com/lifo/docrails&quot;&gt;http://github.com/lifo/docrails&lt;/a&gt;
the changes are later merged into the main Rails repo after review.
Also remember to follow the guidelines provided here &amp;mdash;
&lt;a href=
&quot;http://guides.rubyonrails.org/api_documentation_guidelines.html&quot;&gt;http://guides.rubyonrails.org/api_documentation_guidelines.html&lt;/a&gt;
&amp;mdash; and do report back so that this ticket can be closed.
Thanks! :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-14T15:29:55+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash doc documenation patch rails3</tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-14T15:29:59+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">24</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T07:15:11+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: bugmash doc documenation patch rails3
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-15T07:15:14+01:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">26</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Committed in a38e653a6d512de3d221</body>
      <body-html>&lt;div&gt;&lt;p&gt;Committed in a38e653a6d512de3d221&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-16T21:20:38+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-16T21:20:43+01:00</updated-at>
      <user-id type="integer">81551</user-id>
      <version type="integer">27</version>
      <user-name>Andrea Campi</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>In the example in the RDoc for json_escape, assuming @person was an Active Record &lt;a href=&quot;http://www.weddinginthebox.com/blog/lace-designer-wedding-dresses.html&quot;&gt;lace designer wedding dresses&lt;/a&gt;, to_json would serialize it into a JSON object in which the keys are quoted and string values are too, json_escape would make the JSON invalid.</body>
      <body-html>&lt;div&gt;&lt;p&gt;In the example in the RDoc for json_escape, assuming @person was
an Active Record &lt;a href=
&quot;http://www.weddinginthebox.com/blog/lace-designer-wedding-dresses.html&quot;&gt;
lace designer wedding dresses&lt;/a&gt;, to_json would serialize it into
a JSON object in which the keys are quoted and string values are
too, json_escape would make the JSON invalid.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T06:31:13+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-19T17:52:54+01:00</updated-at>
      <user-id type="integer">120610</user-id>
      <version type="integer">28</version>
      <user-name>koukou</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T22:00:20+01:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-10-19T22:00:24+01:00</updated-at>
      <user-id type="integer">81551</user-id>
      <version type="integer">29</version>
      <user-name>Andrea Campi</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-10T22:21:13+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-10T22:21:17+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">30</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">40263</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The incorrect behaviour is still in Rails 3.0.3. So  &lt;%=j @person.to_json %&gt; is still in the 3.0.3 docs and still produces invalid output. Do we need a new ticket for this?</body>
      <body-html>&lt;div&gt;&lt;p&gt;The incorrect behaviour is still in Rails 3.0.3. So &amp;lt;%=j
@person.to_json %&amp;gt; is still in the 3.0.3 docs and still produces
invalid output. Do we need a new ticket for this?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-20T11:22:54+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-20T11:22:56+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">31</version>
      <user-name>Fjan</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Neeraj Singh</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Commit https://github.com/rails/rails/commit/a38e653a6d512de3d221 is present in rails master but for some reason it is not present in rails-3-0-stable branch. 

Someone from rails core need to cherry-pick this commit.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Commit &lt;a href=
&quot;https://github.com/rails/rails/commit/a38e653a6d512de3d221&quot;&gt;https://github.com/rails/rails/commit/a38e653a6d512de3d221&lt;/a&gt;
is present in rails master but for some reason it is not present in
rails-3-0-stable branch.&lt;/p&gt;
&lt;p&gt;Someone from rails core need to cherry-pick this commit.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T13:29:56+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 82855
:assigned_user: 40263
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-20T13:30:02+00:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">32</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [54828a17034d6ffd3a5b203d1b4233c18e818030]) json_escape makes json invalid doc change [#1485 state:resolved]
https://github.com/rails/rails/commit/54828a17034d6ffd3a5b203d1b4233c18e818030</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/54828a17034d6ffd3a5b203d1b4233c18e818030&quot;
title=
&quot;Changeset [54828a17034d6ffd3a5b203d1b4233c18e818030]&quot;&gt;[54828a17034d6ffd3a5b203d1b4233c18e818030]&lt;/a&gt;)
json_escape makes json invalid doc change [&lt;a href=
&quot;/projects/8994/tickets/1485&quot; title=&quot;Ticket #1485&quot;&gt;#1485&lt;/a&gt;
state:resolved] &lt;a href=
&quot;https://github.com/rails/rails/commit/54828a17034d6ffd3a5b203d1b4233c18e818030&quot;&gt;
https://github.com/rails/rails/commit/54828a17034d6ffd3a5b203d1b423...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-20T14:07:21+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">849</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-20T14:07:52+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">33</version>
      <user-name>Repository</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Docs are more complete now regarding how the helper works. That is, describing what it does.

Nevertheless, if the behavior of this helper is correct, I think we should document why it is helpful. Does anybody have a use case for it? Why are quotes removed? Why are characters escaped using JavaScript \uXXXX literals?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Docs are more complete now regarding how the helper works. That
is, describing what it does.&lt;/p&gt;
&lt;p&gt;Nevertheless, if the behavior of this helper is correct, I think
we should document why it is helpful. Does anybody have a use case
for it? Why are quotes removed? Why are characters escaped using
JavaScript \uXXXX literals?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T15:30:51+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 849
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-20T15:31:22+00:00</updated-at>
      <user-id type="integer">11378</user-id>
      <version type="integer">34</version>
      <user-name>Xavier Noria</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I can't think of any prominent use case for an escape helper that eats double quotes. It even eats quotes when they are escaped with \&quot; and then leaves the \ which results in odd control characters in your JSON string that potentially do more harm then good.

I think it should be fixed to leave the quotes. The use case in the docs &lt;%= j @person.to_json %&gt; is not covered by any of the other escape helpers right now. I went back to setting ActiveSupport.escape_html_entities_in_json = true in the initializers and removing the j altogether.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can't think of any prominent use case for an escape helper
that eats double quotes. It even eats quotes when they are escaped
with &quot; and then leaves the \ which results in odd control
characters in your JSON string that potentially do more harm then
good.&lt;/p&gt;
&lt;p&gt;I think it should be fixed to leave the quotes. The use case in
the docs &amp;lt;%= j @person.to_json %&amp;gt; is not covered by any of
the other escape helpers right now. I went back to setting
ActiveSupport.escape_html_entities_in_json = true in the
initializers and removing the j altogether.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-20T15:39:17+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-11-20T15:39:19+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">35</version>
      <user-name>Fjan</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This is STILL a fail for me.  Is there ANY point to json_escape at all?  It seems completely useless to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is STILL a fail for me. Is there ANY point to json_escape
at all? It seems completely useless to me.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-16T01:47:05+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-12-16T01:47:39+00:00</updated-at>
      <user-id type="integer">67112</user-id>
      <version type="integer">36</version>
      <user-name>Preston Marshall</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Michael Koziarski &quot;It returns the strings without dangerous characters&quot;

That's not quite true:
   `json_escape('hi \&quot;now\&quot;') # =&gt; 'hi \now\'`

This will insert a spurious new line, but you can insert any other control character this way, typically breaking stuff.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Michael Koziarski &quot;It returns the strings without dangerous
characters&quot;&lt;/p&gt;
&lt;p&gt;That's not quite true:&lt;br&gt;
&lt;code&gt;json_escape('hi \&quot;now\&quot;') # =&amp;gt; 'hi \now\'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This will insert a spurious new line, but you can insert any
other control character this way, typically breaking stuff.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-16T10:59:12+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2010-12-16T10:59:48+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">37</version>
      <user-name>Fjan</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-17T00:00:10+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2011-03-17T00:00:45+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">38</version>
      <user-name>rails</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">11378</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-17T00:00:11+00:00</created-at>
      <creator-id type="integer">39040</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1485</number>
      <permalink>json_escape-eats-away-double-quotes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>json_escape eats away double quotes</title>
      <updated-at type="datetime">2011-03-17T00:02:06+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">39</version>
      <user-name>rails</user-name>
      <creator-name>Vlad R</creator-name>
      <assigned-user-name>Xavier Noria</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1485</url>
      <milestone-title>3.x</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ee3a13add88d3bba5fa09c7f8278f9894c93bb31</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-04-01T20:17:53+01:00</created-at>
      <filename>json_escape-quotation-marks.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">106781</id>
      <size type="integer">2426</size>
      <uploader-id type="integer">52719</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/106781/json_escape-quotation-marks.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>4034ff1bfe2fde2178cf266634a4bd991d14c98c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-28T03:00:56+01:00</created-at>
      <filename>doc_patch_for_json_escape_against_rails3_edge.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">500830</id>
      <size type="integer">2777</size>
      <uploader-id type="integer">40263</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/500830/doc_patch_for_json_escape_against_rails3_edge.diff</url>
    </attachment>
  </attachments>
</ticket>
