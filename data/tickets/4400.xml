<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-06-22T16:07:10+01:00</created-at>
  <creator-id type="integer">52029</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4400</number>
  <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>invalid</state>
  <tag>engines generators routing</tag>
  <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
  <updated-at type="datetime">2010-06-24T20:35:58+01:00</updated-at>
  <user-id type="integer">19965</user-id>
  <version type="integer">9</version>
  <user-name>Jos&#233; Valim</user-name>
  <creator-name>phs</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
  <priority-name>Low</priority-name>
  <original-body>The app generator's config/routes.rb template draws it routes with &lt;%= app_const %&gt;.routes.draw.

If the application intent is to become an engine, then the app_const (== AppName::Application) would probably need to be changed to at least AppName::Engine.

An alternative that seems to work for both apps and engines is to call Rails.application.routes.draw.  Assuming there's no subtle consequences, here (soon) is a patch tweaking the generator to do that.</original-body>
  <latest-body>The app generator's config/routes.rb template draws it routes with &lt;%= app_const %&gt;.routes.draw.

If the application intent is to become an engine, then the app_const (== AppName::Application) would probably need to be changed to at least AppName::Engine.

An alternative that seems to work for both apps and engines is to call Rails.application.routes.draw.  Assuming there's no subtle consequences, here (soon) is a patch tweaking the generator to do that.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;The app generator's config/routes.rb template draws it routes
with &amp;lt;%= app_const %&amp;gt;.routes.draw.&lt;/p&gt;
&lt;p&gt;If the application intent is to become an engine, then the
app_const (== AppName::Application) would probably need to be
changed to at least AppName::Engine.&lt;/p&gt;
&lt;p&gt;An alternative that seems to work for both apps and engines is
to call Rails.application.routes.draw. Assuming there's no subtle
consequences, here (soon) is a patch tweaking the generator to do
that.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The app generator's config/routes.rb template draws it routes with &lt;%= app_const %&gt;.routes.draw.

If the application intent is to become an engine, then the app_const (== AppName::Application) would probably need to be changed to at least AppName::Engine.

An alternative that seems to work for both apps and engines is to call Rails.application.routes.draw.  Assuming there's no subtle consequences, here (soon) is a patch tweaking the generator to do that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The app generator's config/routes.rb template draws it routes
with &amp;lt;%= app_const %&amp;gt;.routes.draw.&lt;/p&gt;
&lt;p&gt;If the application intent is to become an engine, then the
app_const (== AppName::Application) would probably need to be
changed to at least AppName::Engine.&lt;/p&gt;
&lt;p&gt;An alternative that seems to work for both apps and engines is
to call Rails.application.routes.draw. Assuming there's no subtle
consequences, here (soon) is a patch tweaking the generator to do
that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-15T07:02:34+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-04-15T07:02:36+01:00</updated-at>
      <user-id type="integer">52029</user-id>
      <version type="integer">1</version>
      <user-name>phs</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>And the patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;And the patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-15T07:07:33+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-04-15T07:07:43+01:00</updated-at>
      <user-id type="integer">52029</user-id>
      <version type="integer">2</version>
      <user-name>phs</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1

There should be at least a &quot;--engine&quot; switch for the &quot;rails xy&quot; generator.</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;
&lt;p&gt;There should be at least a &quot;--engine&quot; switch for the &quot;rails xy&quot;
generator.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-09T08:40:27+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-09T08:40:33+01:00</updated-at>
      <user-id type="integer">22073</user-id>
      <version type="integer">3</version>
      <user-name>Robert Glaser</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Engine will have their own routes soon. So you may want it to have its own routes... or not.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Engine will have their own routes soon. So you may want it to
have its own routes... or not.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-22T16:07:07+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-22T16:07:16+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">4</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Engines will have their own routes soon. So you may want to use Module::Engine.routes.draw... or still manipulate Rails.application directly. That said, it does not really makes sense applying your patch because your assertion won't be necessarily valid soon.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Engines will have their own routes soon. So you may want to use
Module::Engine.routes.draw... or still manipulate Rails.application
directly. That said, it does not really makes sense applying your
patch because your assertion won't be necessarily valid soon.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-22T16:07:10+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-22T16:10:33+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">5</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>That's a reasonable stance.

As a related question, suppose the engine author wants to run her engine as a standalone app (i.e. by using a config/application.rb instead of an Engine subclass) without having to change or have multiple routes.rb files around.  One way is to always draw from Rails.application.routes like above, another is to explicitly check for some known types first a la

(MyHotNewApp::Application rescue MyHotNewApp::Engine).routes.draw { ... }

Have any preferences for one over the other?  I'm totally fine having the engine author (or a support tool) introduce the needed change from the stock routes.rb.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That's a reasonable stance.&lt;/p&gt;
&lt;p&gt;As a related question, suppose the engine author wants to run
her engine as a standalone app (i.e. by using a
config/application.rb instead of an Engine subclass) without having
to change or have multiple routes.rb files around. One way is to
always draw from Rails.application.routes like above, another is to
explicitly check for some known types first a la&lt;/p&gt;
&lt;p&gt;(MyHotNewApp::Application rescue
MyHotNewApp::Engine).routes.draw { ... }&lt;/p&gt;
&lt;p&gt;Have any preferences for one over the other? I'm totally fine
having the engine author (or a support tool) introduce the needed
change from the stock routes.rb.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-24T20:19:44+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-24T20:19:50+01:00</updated-at>
      <user-id type="integer">52029</user-id>
      <version type="integer">6</version>
      <user-name>phs</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Yes, today you will need to resort to hacks in order to have a Rails application working as engine too. But there is a Ruby Summer of Code project to make this easier. :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yes, today you will need to resort to hacks in order to have a
Rails application working as engine too. But there is a Ruby Summer
of Code project to make this easier. :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-24T20:28:23+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-24T20:28:30+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">7</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Cool! Incidentally I'd love to be involved in that.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Cool! Incidentally I'd love to be involved in that.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-24T20:31:23+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-24T20:31:33+01:00</updated-at>
      <user-id type="integer">52029</user-id>
      <version type="integer">8</version>
      <user-name>phs</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think his project already have primary and secondary mentors, but you can of course follow him on twitter (http://twitter.com/drogus) and follow his fork (github.com/drogus/rails).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think his project already have primary and secondary mentors,
but you can of course follow him on twitter (&lt;a href=
&quot;http://twitter.com/drogus&quot;&gt;http://twitter.com/drogus&lt;/a&gt;) and
follow his fork (github.com/drogus/rails).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-24T20:35:38+01:00</created-at>
      <creator-id type="integer">52029</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4400</number>
      <permalink>patch-avoid-app_const-when-drawing-routes-in-app-generator</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>engines generators routing</tag>
      <title>[PATCH] Avoid app_const when drawing routes in app generator</title>
      <updated-at type="datetime">2010-06-24T20:35:58+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">9</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>phs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4400</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>f1e941fe025d76c4416bcac4b4817c21e0777fe1</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-04-15T07:07:33+01:00</created-at>
      <filename>avoid_app_const_when_drawing_routes_in_generator.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">483425</id>
      <size type="integer">884</size>
      <uploader-id type="integer">52029</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/483425/avoid_app_const_when_drawing_routes_in_generator.diff</url>
    </attachment>
  </attachments>
</ticket>
