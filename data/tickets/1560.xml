<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-06-21T21:27:25+01:00</created-at>
  <creator-id type="integer">22242</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">82855</milestone-id>
  <number type="integer">1560</number>
  <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>bugmash</tag>
  <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
  <updated-at type="datetime">2011-02-24T00:01:15+00:00</updated-at>
  <user-id type="integer">136779</user-id>
  <version type="integer">21</version>
  <user-name>rails</user-name>
  <creator-name>Dan Pickett</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
  <milestone-title>2.3.10</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>I'm not sure if I'm omitting something from my test that I should be, but I couldn't find documentation around how to resolve this issue.

@@@
class SomeHelperTest &lt; ActionView::TestCase
  def test_a_link
    link_to &quot;Home&quot;, root_url
  end
end
@@@

Stack trace will return

@@@
TypeError: can't convert String into Hash
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `merge'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `url_for'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/url_helper.rb:228:in `link_to'
@@@

Shouldn't it be using the more robust url_for in ActionView::Helpers::UrlHelper?

Thanks</original-body>
  <latest-body>I'm not sure if I'm omitting something from my test that I should be, but I couldn't find documentation around how to resolve this issue.

@@@
class SomeHelperTest &lt; ActionView::TestCase
  def test_a_link
    link_to &quot;Home&quot;, root_url
  end
end
@@@

Stack trace will return

@@@
TypeError: can't convert String into Hash
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `merge'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `url_for'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/url_helper.rb:228:in `link_to'
@@@

Shouldn't it be using the more robust url_for in ActionView::Helpers::UrlHelper?

Thanks</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I'm not sure if I'm omitting something from my test that I
should be, but I couldn't find documentation around how to resolve
this issue.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
class SomeHelperTest &amp;lt; ActionView::TestCase
  def test_a_link
    link_to &amp;quot;Home&amp;quot;, root_url
  end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Stack trace will return&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
TypeError: can't convert String into Hash
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `merge'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `url_for'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/url_helper.rb:228:in `link_to'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Shouldn't it be using the more robust url_for in
ActionView::Helpers::UrlHelper?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm not sure if I'm omitting something from my test that I should be, but I couldn't find documentation around how to resolve this issue.

@@@
class SomeHelperTest &lt; ActionView::TestCase
  def test_a_link
    link_to &quot;Home&quot;, root_url
  end
end
@@@

Stack trace will return

@@@
TypeError: can't convert String into Hash
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `merge'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `url_for'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/url_helper.rb:228:in `link_to'
@@@

Shouldn't it be using the more robust url_for in ActionView::Helpers::UrlHelper?

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not sure if I'm omitting something from my test that I
should be, but I couldn't find documentation around how to resolve
this issue.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
class SomeHelperTest &amp;lt; ActionView::TestCase
  def test_a_link
    link_to &amp;quot;Home&amp;quot;, root_url
  end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Stack trace will return&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
TypeError: can't convert String into Hash
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `merge'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/url_rewriter.rb:130:in `url_for'
/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/url_helper.rb:228:in `link_to'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Shouldn't it be using the more robust url_for in
ActionView::Helpers::UrlHelper?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T13:28:52+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2008-12-11T13:28:54+00:00</updated-at>
      <user-id type="integer">22242</user-id>
      <version type="integer">1</version>
      <user-name>Dan Pickett</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>close this ticket please, I had some old code in my test_helper.

Thanks,
Dan</body>
      <body-html>&lt;div&gt;&lt;p&gt;close this ticket please, I had some old code in my
test_helper.&lt;/p&gt;
&lt;p&gt;Thanks, Dan&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T14:11:17+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2008-12-11T14:11:18+00:00</updated-at>
      <user-id type="integer">22242</user-id>
      <version type="integer">2</version>
      <user-name>Dan Pickett</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>cheers :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;cheers :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-12T00:32:53+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2008-12-12T00:32:55+00:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">3</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm having problems with this and haven't found a way to work around it in all cases.

In earlier versions of Rails (I'm coming from 2.1) link_to did this:

@@@ ruby
url = case options
  when String
    options
  when :back
    @controller.request.env[&quot;HTTP_REFERER&quot;] || 'javascript:history.back()'
  else
    self.url_for(options)
  end
@@@

whereas now it just does a unconditional

@@@ ruby
url = url_for(options)
@@@

So, if you include

ActionController::UrlWriter

somewhere and do a link_to with a named route you get the nice &quot;TypeError: can't convert String into Hash&quot; exception, because url_for in UrlWriter doesn't know how to handle Strings.

Would love to work on a patch, but I have no idea how this is supposed to work:

 - just change the link_to implementation?
 - change UrlWriter#url_for to handle Strings as options?
 - I'm doing something wrong?

thanks,
Florian</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm having problems with this and haven't found a way to work
around it in all cases.&lt;/p&gt;
&lt;p&gt;In earlier versions of Rails (I'm coming from 2.1) link_to did
this:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;url = case options
  when String
    options
  when :back
    @controller.request.env[&quot;HTTP_REFERER&quot;] || 'javascript:history.back()'
  else
    self.url_for(options)
  end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;whereas now it just does a unconditional&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;url = url_for(options)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So, if you include&lt;/p&gt;
&lt;p&gt;ActionController::UrlWriter&lt;/p&gt;
&lt;p&gt;somewhere and do a link_to with a named route you get the nice
&quot;TypeError: can't convert String into Hash&quot; exception, because
url_for in UrlWriter doesn't know how to handle Strings.&lt;/p&gt;
&lt;p&gt;Would love to work on a patch, but I have no idea how this is
supposed to work:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;just change the link_to implementation?&lt;/li&gt;
&lt;li&gt;change UrlWriter#url_for to handle Strings as options?&lt;/li&gt;
&lt;li&gt;I'm doing something wrong?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;thanks,&lt;br&gt;
Florian&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-07-02T17:05:07+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2009-07-02T17:05:09+01:00</updated-at>
      <user-id type="integer">9088</user-id>
      <version type="integer">4</version>
      <user-name>theflow</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>change UrlWriter#url_for to handle Strings as options?

This seems like the right place to handle this for me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;change UrlWriter#url_for to handle Strings as options?&lt;/p&gt;
&lt;p&gt;This seems like the right place to handle this for me.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-05T03:57:41+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-21T09:04:34+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">5</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>At the same time it could be worthwhile attempting to rationalise the 3 different implementations of url_for to make sure that they code they share, isn't repeated.

I don't expect that you'll avoid having a few different implementations of url_for but the implementations should only differ in the ways that matter.</body>
      <body-html>&lt;div&gt;&lt;p&gt;At the same time it could be worthwhile attempting to
rationalise the 3 different implementations of url_for to make sure
that they code they share, isn't repeated.&lt;/p&gt;
&lt;p&gt;I don't expect that you'll avoid having a few different
implementations of url_for but the implementations should only
differ in the ways that matter.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-07-05T03:58:56+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2009-07-05T03:58:58+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">6</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm seeing this too. Basically it means you can't use named/restful routes in your own classes (say, a presenter class).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm seeing this too. Basically it means you can't use
named/restful routes in your own classes (say, a presenter
class).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-25T01:54:42+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2009-08-25T01:54:46+01:00</updated-at>
      <user-id type="integer">13</user-id>
      <version type="integer">7</version>
      <user-name>court3nay</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/19097)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/19097&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-04T18:48:37+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-05-04T18:48:37+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-09T17:23:19+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-05-09T17:23:21+01:00</updated-at>
      <user-id type="integer">22242</user-id>
      <version type="integer">9</version>
      <user-name>Dan Pickett</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>not reproducible , in master UrlWriter#url_for is currently supporting String as options.

actionpack/lib/action_dispatch/routing/url_for.rb:126

@@@ ruby
def url_for(options = nil)
  case options
  when String
    options
  when nil, Hash
    _router.url_for(url_options.merge((options || {}).symbolize_keys))
  else
    polymorphic_url(options)
  end
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;not reproducible , in master UrlWriter#url_for is currently
supporting String as options.&lt;/p&gt;
&lt;p&gt;actionpack/lib/action_dispatch/routing/url_for.rb:126&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;def url_for(options = nil)
  case options
  when String
    options
  when nil, Hash
    _router.url_for(url_options.merge((options || {}).symbolize_keys))
  else
    polymorphic_url(options)
  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-15T21:56:01+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-05-15T21:56:03+01:00</updated-at>
      <user-id type="integer">99412</user-id>
      <version type="integer">10</version>
      <user-name>elcuervo</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>+1, not reproducible in master.

The `url_for` method in `ActionView::Helpers::UrlHelper` also handles strings (complete with new auto-escaping functionality):
(actionpack/lib/action_view/helpers/url_helper.rb:98)

@@@ ruby
def url_for(options = {})
  options ||= {}
  url = case options
  when String
    escape = true
    options
  when Hash
    options = { :only_path =&gt; options[:host].nil? }.update(options.symbolize_keys)
    escape  = options.key?(:escape) ? options.delete(:escape) : false
    super
  when :back
    escape = false
    controller.request.env[&quot;HTTP_REFERER&quot;] || 'javascript:history.back()'
  else
    escape = false
    polymorphic_path(options)
  end

  escape ? escape_once(url).html_safe : url
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1, not reproducible in master.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;url_for&lt;/code&gt; method in
&lt;code&gt;ActionView::Helpers::UrlHelper&lt;/code&gt; also handles strings
(complete with new auto-escaping functionality):&lt;br&gt;
(actionpack/lib/action_view/helpers/url_helper.rb:98)&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;def url_for(options = {})
  options ||= {}
  url = case options
  when String
    escape = true
    options
  when Hash
    options = { :only_path =&amp;gt; options[:host].nil? }.update(options.symbolize_keys)
    escape  = options.key?(:escape) ? options.delete(:escape) : false
    super
  when :back
    escape = false
    controller.request.env[&quot;HTTP_REFERER&quot;] || 'javascript:history.back()'
  else
    escape = false
    polymorphic_path(options)
  end

  escape ? escape_once(url).html_safe : url
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-16T00:07:21+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-05-16T00:07:22+01:00</updated-at>
      <user-id type="integer">54225</user-id>
      <version type="integer">11</version>
      <user-name>Enrico Bianco</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can somebody verify if this issue is still reproducible? Or else the ticket can be closed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can somebody verify if this issue is still reproducible? Or else
the ticket can be closed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-15T11:57:33+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-15T11:57:40+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">12</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-15T12:01:53+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-15T12:02:01+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">13</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can't reproduce it in master either. Closing ticket assuming resolved.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can't reproduce it in master either. Closing ticket assuming
resolved.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-21T09:06:06+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-21T09:06:13+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">14</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>in rails 2.3.5

If I do:

@@@ ruby
class Test
  
  include ActionView::Helpers
  include ActionController::UrlWriter
  
  default_url_options[:host] = &quot;localhost:3000&quot;
  
  def foo
    link_to &quot;click me&quot;, &quot;www.google.com&quot;
  end
  
end

...

Test.new.foo
@@@

I get:

can't convert String into Hash

&lt;em&gt;Edited by Rohit Arondekar to fix formating.&lt;/em&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;in rails 2.3.5&lt;/p&gt;
&lt;p&gt;If I do:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class Test
  
  include ActionView::Helpers
  include ActionController::UrlWriter
  
  default_url_options[:host] = &quot;localhost:3000&quot;
  
  def foo
    link_to &quot;click me&quot;, &quot;www.google.com&quot;
  end
  
end

...

Test.new.foo&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;I get:&lt;/p&gt;
&lt;p&gt;can't convert String into Hash&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Edited by Rohit Arondekar to fix formating.&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-21T21:27:25+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">71472</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-22T02:14:57+01:00</updated-at>
      <user-id type="integer">41991</user-id>
      <version type="integer">15</version>
      <user-name>patrick collins</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>3.x</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Patrick, can you please try this on Rails 2.3.8 or even the 2-3-stable branch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Patrick, can you please try this on Rails 2.3.8 or even the
2-3-stable branch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-22T02:16:35+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 71472
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-06-22T02:16:44+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">16</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-29T21:22:41+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-07-29T21:22:45+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">17</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27613)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27613&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T02:28:48+01:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-08-30T02:28:48+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">18</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can reproduce this bug on a clean 2.3.9 app adding Patrick's Test class to lib/test.rb and calling &lt;%= Test.new.foo %&gt; from a view.

Found this bug after trying to use link_to in a Presenter like court3nay alluded to.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can reproduce this bug on a clean 2.3.9 app adding Patrick's
Test class to lib/test.rb and calling &amp;lt;%= Test.new.foo %&amp;gt;
from a view.&lt;/p&gt;
&lt;p&gt;Found this bug after trying to use link_to in a Presenter like
court3nay alluded to.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-23T11:56:36+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>needs-more-info</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2010-11-23T11:56:39+00:00</updated-at>
      <user-id type="integer">40219</user-id>
      <version type="integer">19</version>
      <user-name>Christopher Dell</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-24T00:00:12+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: needs-more-info
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2011-02-24T00:01:15+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">20</version>
      <user-name>rails</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-24T00:00:12+00:00</created-at>
      <creator-id type="integer">22242</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">1560</number>
      <permalink>link_to-in-actionviewtestcase-uses-actioncontrollerurlrewriters-url_for-instead-of-actionviewhelpersurlhelper</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>bugmash</tag>
      <title>link_to in ActionView::TestCase uses ActionController::UrlRewriter's url_for instead of ActionView::Helpers::UrlHelper</title>
      <updated-at type="datetime">2011-02-24T00:00:47+00:00</updated-at>
      <user-id type="integer">136779</user-id>
      <version type="integer">21</version>
      <user-name>rails</user-name>
      <creator-name>Dan Pickett</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1560</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
  </versions>
</ticket>
