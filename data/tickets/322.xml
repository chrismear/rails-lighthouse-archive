<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-06-03T20:28:20+01:00</created-at>
  <creator-id type="integer">22128</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">322</number>
  <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
  <priority type="integer">15143</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag nil="true"></tag>
  <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
  <updated-at type="datetime">2011-03-26T02:43:07+00:00</updated-at>
  <user-id type="integer">142823</user-id>
  <version type="integer">24</version>
  <user-name>bingbing</user-name>
  <creator-name>Mark Imbriaco</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
  <priority-name nil="true"></priority-name>
  <original-body>If Client-IP and X-Forwarded-For are both set, a 500 is returned regardless of what they're set to.  If they're both set but they agree, we can safely use either value.</original-body>
  <latest-body>If Client-IP and X-Forwarded-For are both set, a 500 is returned regardless of what they're set to.  If they're both set but they agree, we can safely use either value.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
If Client-IP and X-Forwarded-For are both set, a 500 is returned regardless of what they're set to.  If they're both set but they agree, we can safely use either value.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>If Client-IP and X-Forwarded-For are both set, a 500 is returned regardless of what they're set to.  If they're both set but they agree, we can safely use either value.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
If Client-IP and X-Forwarded-For are both set, a 500 is returned regardless of what they're set to.  If they're both set but they agree, we can safely use either value.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T20:28:20+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-03T20:28:20+01:00</updated-at>
      <user-id type="integer">22128</user-id>
      <version type="integer">1</version>
      <user-name>Mark Imbriaco</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is due to
@@@ ruby
      if @env.include? 'HTTP_CLIENT_IP'
        if @env.include? 'HTTP_X_FORWARDED_FOR'
          # We don't know which came from the proxy, and which from the user
          raise ActionControllerError.new(&lt;&lt;EOM)
IP spoofing attack?!
HTTP_CLIENT_IP=#{@env['HTTP_CLIENT_IP'].inspect}
HTTP_X_FORWARDED_FOR=#{@env['HTTP_X_FORWARDED_FOR'].inspect}
EOM
        end
@@@
but I'm not sure about its motivation.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This is due to
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;      if @env.include? 'HTTP_CLIENT_IP'
        if @env.include? 'HTTP_X_FORWARDED_FOR'
          # We don't know which came from the proxy, and which from the user
          raise ActionControllerError.new(&amp;lt;&amp;lt;EOM)
IP spoofing attack?!
HTTP_CLIENT_IP=#{@env['HTTP_CLIENT_IP'].inspect}
HTTP_X_FORWARDED_FOR=#{@env['HTTP_X_FORWARDED_FOR'].inspect}
EOM
        end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
but I'm not sure about its motivation.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T20:35:43+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-03T20:35:43+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">2</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm not sure about the motivation either but if we use the comment as a guide, it seems safe to skip the 500 if they match since we can determine the remote IP.  That's all my tiny little patch does.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I'm not sure about the motivation either but if we use the comment as a guide, it seems safe to skip the 500 if they match since we can determine the remote IP.  That's all my tiny little patch does.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T20:38:26+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-03T20:38:26+01:00</updated-at>
      <user-id type="integer">22128</user-id>
      <version type="integer">3</version>
      <user-name>Mark Imbriaco</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I like that patch, but let's get a test in there to ensure that we have this functionality tested in general.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I like that patch, but let's get a test in there to ensure that we have this functionality tested in general.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T22:10:19+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-03T22:10:19+01:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">4</version>
      <user-name>DHH</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Had this issue this morning with Yahoo's Slurp! bot with the following case:

HTTP_CLIENT_IP=&quot;74.6.29.94&quot;
HTTP_X_FORWARDED_FOR=&quot;74.6.29.94, 74.6.8.122&quot;

So, patch updated to reflect this (and test added too).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Had this issue this morning with Yahoo's Slurp! bot with the following case:
&lt;/p&gt;&lt;p&gt;
HTTP_CLIENT_IP=&quot;74.6.29.94&quot;
&lt;/p&gt;&lt;p&gt;
HTTP_X_FORWARDED_FOR=&quot;74.6.29.94, 74.6.8.122&quot;
&lt;/p&gt;&lt;p&gt;
So, patch updated to reflect this (and test added too).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-03T23:13:51+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-03T23:13:51+01:00</updated-at>
      <user-id type="integer">20082</user-id>
      <version type="integer">5</version>
      <user-name>Brad Folkens</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Closed by edfa195e2ace7b4fb8195333c6e44e6bf8986c11</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Closed by edfa195e2ace7b4fb8195333c6e44e6bf8986c11
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-04T00:16:03+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-04T00:16:03+01:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">6</version>
      <user-name>DHH</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>DHH,

This is is NOT fixed yet. I am running an application from edge rails, and it is returning 500 for Yahoo Slurp.

Thanks</body>
      <body-html>&lt;div&gt;&lt;p&gt;
DHH,
&lt;/p&gt;&lt;p&gt;
This is is NOT fixed yet. I am running an application from edge rails, and it is returning 500 for Yahoo Slurp.
&lt;/p&gt;&lt;p&gt;
Thanks
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-07T21:12:24+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-07T21:12:24+01:00</updated-at>
      <user-id type="integer">22625</user-id>
      <version type="integer">7</version>
      <user-name>adi_azar</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>adi_azar, please provide a failing test case.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
adi_azar, please provide a failing test case.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-07T21:26:19+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-07T21:26:19+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I have my server logs:

74.6.18.216 - - [07/Jun/2008:20:40:55 +0000] &quot;www.onlinecityflorist.com/LA/baskin-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:40:59 +0000] &quot;www.onlinecityflorist.com/GA/macon-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:41:10 +0000] &quot;www.onlinecityflorist.com/FL/dade-city-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:41:41 +0000] &quot;www.onlinecityflorist.com/LA/iota-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:41:43 +0000] &quot;www.onlinecityflorist.com/LA/baskin-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:41:47 +0000] &quot;www.onlinecityflorist.com/GA/macon-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;
74.6.18.216 - - [07/Jun/2008:20:41:58 +0000] &quot;www.onlinecityflorist.com/FL/dade-city-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; http://help.yahoo.com/help/us/ysearch/slurp)&quot;

It returns 500 only for Yahoo slurp! 


Is that helpful?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I have my server logs:
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:40:55 +0000] &quot;www.onlinecityflorist.com/LA/baskin-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:40:59 +0000] &quot;www.onlinecityflorist.com/GA/macon-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:41:10 +0000] &quot;www.onlinecityflorist.com/FL/dade-city-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:41:41 +0000] &quot;www.onlinecityflorist.com/LA/iota-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:41:43 +0000] &quot;www.onlinecityflorist.com/LA/baskin-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:41:47 +0000] &quot;www.onlinecityflorist.com/GA/macon-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
74.6.18.216 - - [07/Jun/2008:20:41:58 +0000] &quot;www.onlinecityflorist.com/FL/dade-city-flowers/&quot; 500 60 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Yahoo! Slurp; &lt;a href=&quot;http://help.yahoo.com/help/us/ysearch/slurp&quot;&gt;http://help.yahoo.com/help/us/ys...&lt;/a&gt;)&quot;
&lt;/p&gt;&lt;p&gt;
It returns 500 only for Yahoo slurp!
&lt;/p&gt;&lt;p&gt;
Is that helpful?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-07T21:44:08+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-07T21:44:08+01:00</updated-at>
      <user-id type="integer">22625</user-id>
      <version type="integer">9</version>
      <user-name>adi_azar</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>adi_azar, are you using Edge? This patch did not make it into 2.1. I had this problem with 2.1 but it works for me when applying the attached patch (which is now in Edge).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
adi_azar, are you using Edge? This patch did not make it into 2.1. I had this problem with 2.1 but it works for me when applying the attached patch (which is now in Edge).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-16T08:21:34+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-16T08:21:34+01:00</updated-at>
      <user-id type="integer">478</user-id>
      <version type="integer">10</version>
      <user-name>Sebastian Friedrich</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I'm running into this problem as well. Hoping 2.1.1 will be released soon and will include this patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I'm running into this problem as well. Hoping 2.1.1 will be released soon and will include this patch.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-06-28T06:49:42+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-06-28T06:49:42+01:00</updated-at>
      <user-id type="integer">5701</user-id>
      <version type="integer">11</version>
      <user-name>Ryan Bates</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This patch doesn't resolve it for me. I'm doing testing where the client is a mobile phone on the DeviceAnywhere system. I get HTTP_X_FORWARDED_FOR=&quot;66.94.9.52, ::1&quot; and HTTP_CLIENT_IP=&quot;10.176.38.35&quot; and it gives me the &quot;IP spoofing attack&quot; error (with or without the patch). If I return @env['HTTP_X_FORWARDED_FOR'][0] instead of raising the error, it works fine.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This patch doesn't resolve it for me. I'm doing testing where the client is a mobile phone on the DeviceAnywhere system. I get HTTP_X_FORWARDED_FOR=&quot;66.94.9.52, ::1&quot; and HTTP_CLIENT_IP=&quot;10.176.38.35&quot; and it gives me the &quot;IP spoofing attack&quot; error (with or without the patch). If I return @env['HTTP_X_FORWARDED_FOR'][0] instead of raising the error, it works fine.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-11T05:46:51+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-08-11T05:46:51+01:00</updated-at>
      <user-id type="integer">28640</user-id>
      <version type="integer">12</version>
      <user-name>sbwoodside</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I can confirm that sbwoodside's suggestion worked for me when the patch alone did not.  Standard Apache to mongrel proxying behind a hardware load balancer.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that sbwoodside's suggestion worked for me when the patch alone did not.  Standard Apache to mongrel proxying behind a hardware load balancer.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-13T22:46:49+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-08-13T22:46:49+01:00</updated-at>
      <user-id type="integer">17641</user-id>
      <version type="integer">13</version>
      <user-name>Sean Hussey</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The IP spoofing test here doesn't make sense. Both HTTP_X_FORWARDED_FOR and HTTP_CLIENT_IP are proxy headers, both equally untrustworthy. If they differ, it's probably just the proxy being either clever or wrong. (Or a dumb spoofer.)

There doesn't seem to be any sure way to tell if X-Forwarded-For is being spoofed or legit. The only real solution is to add a mechanism for the users to know if the result of remote_ip is trustable or not. Then they can make their own decisions. For example, you could add a method unspoofable_remote_ip which only returns REMOTE_ADDR. Or perhaps some kind of configuration variable to set whether you want to be trusting or not. Mainly you'd only care about spoofing if you're using the method to authenticate users by IP white-listing.

As for knowing which value to use to respond to the user, according to &quot;Wikipedia&quot;:http://en.wikipedia.org/wiki/X-Forwarded-For the first address in X-Forwarded-For is always the original machine, so that would be the correct address to use when there's ambiguity. So, @env['HTTP_X_FORWARDED_FOR'].first is I think the correct action.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The IP spoofing test here doesn't make sense. Both HTTP_X_FORWARDED_FOR and HTTP_CLIENT_IP are proxy headers, both equally untrustworthy. If they differ, it's probably just the proxy being either clever or wrong. (Or a dumb spoofer.)&lt;/p&gt;

&lt;p&gt;There doesn't seem to be any sure way to tell if X-Forwarded-For is being spoofed or legit. The only real solution is to add a mechanism for the users to know if the result of remote_ip is trustable or not. Then they can make their own decisions. For example, you could add a method unspoofable_remote_ip which only returns REMOTE_ADDR. Or perhaps some kind of configuration variable to set whether you want to be trusting or not. Mainly you'd only care about spoofing if you're using the method to authenticate users by IP white-listing.&lt;/p&gt;

&lt;p&gt;As for knowing which value to use to respond to the user, according to &lt;a href=&quot;http://en.wikipedia.org/wiki/X-Forwarded-For&quot;&gt;Wikipedia&lt;/a&gt; the first address in X-Forwarded-For is always the original machine, so that would be the correct address to use when there's ambiguity. So, @env['HTTP_X_FORWARDED_FOR'].first is I think the correct action.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-14T01:10:47+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-08-14T01:10:47+01:00</updated-at>
      <user-id type="integer">28640</user-id>
      <version type="integer">14</version>
      <user-name>sbwoodside</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>The patch here seems to rely on a certain subset of real-world behavior to determine what's valid.

It assumes that
a) there is a trusted proxy or load balancer immediately upstream
b) that said proxy uses X-Forwarded-For
c) that Client-IP was legitimately added by some other, more upstream proxy

Given that X-Forwarded-For is the more popular header and is used by Apache, and rails apps are often behind a proxy of some sort, it's not bad.

However, when the deployment situation is outside the above, a spoofed address or a 500 Server Error are both possibilities.

A better approach might be to rely on the sysadmin or developer to explicitly help Rails know something about the environment so Rails can trust the right data.

A few possibilities (all variants on the same idea):

a) Have yet another header, Rails-specific, trump the others and configure the proxy or load balancer to use it. X-Rails-Remote-IP or something. Con: Could still be spoofed when not configured on a given deployment box.

b) Have an environment variable set locally to tell Rails which header to use. This is similar to the approach of how to tell Rails when it is inside an https connection.

c) Let the proxy forcibly remove the non-used header. Apache example: add this line to the virtual host config: RequestHeader unset Client-IP

B or C seem like better choices to me. The IP spoofing exception message could include language pointing the admin to info on how to resolve it.

They have the added benefit of not being clever but instead relying on specific information about which header Rails should consider trustworthy.

C is what I'm trying now and preliminary tests suggest it will work although I'm still waiting on Slurp to come by and actually load a page.

--

As an aside, the IP spoofing attack message may generate a server error, but it's still reporting Status: 200 OK to apache. A review of Apache's log would not suggest there is any problem at all.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The patch here seems to rely on a certain subset of real-world behavior to determine what's valid.&lt;/p&gt;

&lt;p&gt;It assumes that
a) there is a trusted proxy or load balancer immediately upstream
b) that said proxy uses X-Forwarded-For
c) that Client-IP was legitimately added by some other, more upstream proxy&lt;/p&gt;

&lt;p&gt;Given that X-Forwarded-For is the more popular header and is used by Apache, and rails apps are often behind a proxy of some sort, it's not bad.&lt;/p&gt;

&lt;p&gt;However, when the deployment situation is outside the above, a spoofed address or a 500 Server Error are both possibilities.&lt;/p&gt;

&lt;p&gt;A better approach might be to rely on the sysadmin or developer to explicitly help Rails know something about the environment so Rails can trust the right data.&lt;/p&gt;

&lt;p&gt;A few possibilities (all variants on the same idea):&lt;/p&gt;

&lt;p&gt;a) Have yet another header, Rails-specific, trump the others and configure the proxy or load balancer to use it. X-Rails-Remote-IP or something. Con: Could still be spoofed when not configured on a given deployment box.&lt;/p&gt;

&lt;p&gt;b) Have an environment variable set locally to tell Rails which header to use. This is similar to the approach of how to tell Rails when it is inside an https connection.&lt;/p&gt;

&lt;p&gt;c) Let the proxy forcibly remove the non-used header. Apache example: add this line to the virtual host config: RequestHeader unset Client-IP&lt;/p&gt;

&lt;p&gt;B or C seem like better choices to me. The IP spoofing exception message could include language pointing the admin to info on how to resolve it.&lt;/p&gt;

&lt;p&gt;They have the added benefit of not being clever but instead relying on specific information about which header Rails should consider trustworthy.&lt;/p&gt;

&lt;p&gt;C is what I'm trying now and preliminary tests suggest it will work although I'm still waiting on Slurp to come by and actually load a page.&lt;/p&gt;

&lt;p&gt;--&lt;/p&gt;

&lt;p&gt;As an aside, the IP spoofing attack message may generate a server error, but it's still reporting Status: 200 OK to apache. A review of Apache's log would not suggest there is any problem at all.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-08-16T04:53:54+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-08-16T04:53:54+01:00</updated-at>
      <user-id type="integer">24494</user-id>
      <version type="integer">15</version>
      <user-name>thomas morgan</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Apparently T-Mobile's WAP gateway (apn.voicestream.com) makes the mistake of setting HTTP_CLIENT_IP and HTTP_X_FORWARDED_FOR to different values. This means that I am unable to access my site from any phone on the T-Zones internet plan. Correct behavior?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Apparently T-Mobile's WAP gateway (apn.voicestream.com) makes
the mistake of setting HTTP_CLIENT_IP and HTTP_X_FORWARDED_FOR to
different values. This means that I am unable to access my site
from any phone on the T-Zones internet plan. Correct behavior?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-09-11T13:12:10+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-09-11T13:12:16+01:00</updated-at>
      <user-id type="integer">21159</user-id>
      <version type="integer">16</version>
      <user-name>Eric Allen</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I also have a site that T-mobile phones need to hit.  This fix will not work for T-Mo phones</body>
      <body-html>&lt;div&gt;&lt;p&gt;I also have a site that T-mobile phones need to hit. This fix
will not work for T-Mo phones&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-09T19:04:28+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-10-09T19:04:31+01:00</updated-at>
      <user-id type="integer">29017</user-id>
      <version type="integer">17</version>
      <user-name>Orion Delwaterman</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've opened a new bug #1200 for the mobile issue, since this bug has been marked resolved (and deals with a different issue).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've opened a new bug &lt;a href=&quot;/projects/8994/tickets/1200&quot; title=&quot;Ticket #1200&quot;&gt;#1200&lt;/a&gt; for the mobile issue, since this bug
has been marked resolved (and deals with a different issue).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-10-11T00:18:54+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2008-10-11T00:18:59+01:00</updated-at>
      <user-id type="integer">28640</user-id>
      <version type="integer">18</version>
      <user-name>sbwoodside</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Both X-Forwarded-For and Client-IP are non-standard (i.e., implementation-specific) headers, so relying on them to have consistent syntax and semantics is risky. 

In particular, Squid was the first implementation to use X-Forwarded-For, but it's been copied to other implementations, and some may behave differently. 

As a result, it's very possible -- and legitimate -- to get a request with both headers present but containing different values. This isn't &quot;IP spoofing,&quot; and rails should NOT refuse such requests. 

As has been noted, it's pretty much impossible to determine whether these headers are legitimate or faked; at best they're a hint that indicates what part of the request chain might have been.

I think the real problem here is that remote_ip is called as part of the logging code (AFAICT; I'm not really a ruby person), so that ANY request with both headers will be effectively refused by Rails. 

Most Web servers log the actual, on-wire next-hop client IP address by default, with the ability to log the address from headers if explicitly configured. I'd suggest that this is also what Rails should do (while at the same time making the logic more resilient; e.g., if it can't determine the address from headers, fall back to the on-wire address).</body>
      <body-html>&lt;div&gt;&lt;p&gt;Both X-Forwarded-For and Client-IP are non-standard (i.e.,
implementation-specific) headers, so relying on them to have
consistent syntax and semantics is risky.&lt;/p&gt;
&lt;p&gt;In particular, Squid was the first implementation to use
X-Forwarded-For, but it's been copied to other implementations, and
some may behave differently.&lt;/p&gt;
&lt;p&gt;As a result, it's very possible -- and legitimate -- to get a
request with both headers present but containing different values.
This isn't &quot;IP spoofing,&quot; and rails should NOT refuse such
requests.&lt;/p&gt;
&lt;p&gt;As has been noted, it's pretty much impossible to determine
whether these headers are legitimate or faked; at best they're a
hint that indicates what part of the request chain might have
been.&lt;/p&gt;
&lt;p&gt;I think the real problem here is that remote_ip is called as
part of the logging code (AFAICT; I'm not really a ruby person), so
that ANY request with both headers will be effectively refused by
Rails.&lt;/p&gt;
&lt;p&gt;Most Web servers log the actual, on-wire next-hop client IP
address by default, with the ability to log the address from
headers if explicitly configured. I'd suggest that this is also
what Rails should do (while at the same time making the logic more
resilient; e.g., if it can't determine the address from headers,
fall back to the on-wire address).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-06T18:04:03+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>patch</tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2009-08-06T18:04:08+01:00</updated-at>
      <user-id type="integer">54254</user-id>
      <version type="integer">19</version>
      <user-name>mnot (at mnot)</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-09T21:46:52+01:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: patch
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">15143</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2010-10-09T21:46:58+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">21</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-07T16:51:43+00:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">15143</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2010-11-07T16:51:47+00:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">23</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton watches&lt;/a&gt;&lt;/b&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton
watches&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-26T02:13:35+00:00</created-at>
      <creator-id type="integer">22128</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">322</number>
      <permalink>don-t-return-500-if-client-ip-and-x-forwarded-for-agree</permalink>
      <priority type="integer">15143</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Don't return 500 if Client-IP and X-Forwarded-For agree.</title>
      <updated-at type="datetime">2011-03-26T02:43:07+00:00</updated-at>
      <user-id type="integer">142823</user-id>
      <version type="integer">24</version>
      <user-name>bingbing</user-name>
      <creator-name>Mark Imbriaco</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/322</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>0f6ecf6d99561acfa3fc520d7ebefc04b1c54315</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-03T20:28:20+01:00</created-at>
      <filename>forwarded_client_ip.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">25725</id>
      <size type="integer">1004</size>
      <uploader-id type="integer">22128</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/25725/forwarded_client_ip.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>e1f450ef4b08e7b633fbe9d18af44d0fe0c94380</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-03T23:13:51+01:00</created-at>
      <filename>forwarded_client_ip_with_test.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">25763</id>
      <size type="integer">2143</size>
      <uploader-id type="integer">20082</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/25763/forwarded_client_ip_with_test.patch</url>
    </attachment>
  </attachments>
</ticket>
