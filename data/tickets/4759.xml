<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2011-02-14T07:28:36+00:00</created-at>
  <creator-id type="integer">1998</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4759</number>
  <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>new</state>
  <tag>rails3</tag>
  <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
  <updated-at type="datetime">2011-03-03T14:42:11+00:00</updated-at>
  <user-id type="integer">131154</user-id>
  <version type="integer">10</version>
  <user-name>Roger Leite</user-name>
  <creator-name>August Lilleaas</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
  <priority-name nil="true"></priority-name>
  <original-body>Here's the current flow.

@@@
** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
==&gt; [config/environments/development.rb loads here] &lt;==
** ultrasphinx: configuration file not found for &quot;development&quot; environment
** ultrasphinx: please run 'rake ultrasphinx:configure'
** ultrasphinx: spelling support not available (raspell configuration raised &quot;uninitialized constant Ultrasphinx::Spell::Aspell&quot;)
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
==&gt; [config/environment.rb loads here] &lt;==
==&gt; [config/environments/test.rb loads here] &lt;==
Loaded suite /home/augustl/.rvm/gems/ruby-1.8.7-p249@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
......................................
@@@

The data for the bracketed annotations were found by adding `puts` statements to those files.

This becomes more of a problem the longer the environment takes to load. For example, [the rails3 branch of gitorious.org](http://gitorious.org/gitorious/mainline/commits/rails3) takes 20-25 seconds to load because of the high number of routes (which I will probably file a separate issue for - that's a long time!). [Here](http://ditrw.com/_dump/gitorious_rake_routes.txt) (and attached) is the output of `rake routes`. Having to wait about a minute for the tests to start running makes TDD rather tedious.</original-body>
  <latest-body>Here's the current flow.

@@@
** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
==&gt; [config/environments/development.rb loads here] &lt;==
** ultrasphinx: configuration file not found for &quot;development&quot; environment
** ultrasphinx: please run 'rake ultrasphinx:configure'
** ultrasphinx: spelling support not available (raspell configuration raised &quot;uninitialized constant Ultrasphinx::Spell::Aspell&quot;)
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
==&gt; [config/environment.rb loads here] &lt;==
==&gt; [config/environments/test.rb loads here] &lt;==
Loaded suite /home/augustl/.rvm/gems/ruby-1.8.7-p249@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
......................................
@@@

The data for the bracketed annotations were found by adding `puts` statements to those files.

This becomes more of a problem the longer the environment takes to load. For example, [the rails3 branch of gitorious.org](http://gitorious.org/gitorious/mainline/commits/rails3) takes 20-25 seconds to load because of the high number of routes (which I will probably file a separate issue for - that's a long time!). [Here](http://ditrw.com/_dump/gitorious_rake_routes.txt) (and attached) is the output of `rake routes`. Having to wait about a minute for the tests to start running makes TDD rather tedious.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Here's the current flow.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
==&amp;gt; [config/environments/development.rb loads here] &amp;lt;==
** ultrasphinx: configuration file not found for &quot;development&quot; environment
** ultrasphinx: please run 'rake ultrasphinx:configure'
** ultrasphinx: spelling support not available (raspell configuration raised &quot;uninitialized constant Ultrasphinx::Spell::Aspell&quot;)
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
==&amp;gt; [config/environment.rb loads here] &amp;lt;==
==&amp;gt; [config/environments/test.rb loads here] &amp;lt;==
Loaded suite /home/augustl/.rvm/gems/ruby-1.8.7-p249@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
......................................&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The data for the bracketed annotations were found by adding
&lt;code&gt;puts&lt;/code&gt; statements to those files.&lt;/p&gt;
&lt;p&gt;This becomes more of a problem the longer the environment takes
to load. For example, &lt;a href=
&quot;http://gitorious.org/gitorious/mainline/commits/rails3&quot;&gt;the rails3
branch of gitorious.org&lt;/a&gt; takes 20-25 seconds to load because of
the high number of routes (which I will probably file a separate
issue for - that's a long time!). &lt;a href=
&quot;http://ditrw.com/_dump/gitorious_rake_routes.txt&quot;&gt;Here&lt;/a&gt; (and
attached) is the output of &lt;code&gt;rake routes&lt;/code&gt;. Having to wait
about a minute for the tests to start running makes TDD rather
tedious.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Here's the current flow.

@@@
** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
==&gt; [config/environments/development.rb loads here] &lt;==
** ultrasphinx: configuration file not found for &quot;development&quot; environment
** ultrasphinx: please run 'rake ultrasphinx:configure'
** ultrasphinx: spelling support not available (raspell configuration raised &quot;uninitialized constant Ultrasphinx::Spell::Aspell&quot;)
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
==&gt; [config/environment.rb loads here] &lt;==
==&gt; [config/environments/test.rb loads here] &lt;==
Loaded suite /home/augustl/.rvm/gems/ruby-1.8.7-p249@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
......................................
@@@

The data for the bracketed annotations were found by adding `puts` statements to those files.

This becomes more of a problem the longer the environment takes to load. For example, [the rails3 branch of gitorious.org](http://gitorious.org/gitorious/mainline/commits/rails3) takes 20-25 seconds to load because of the high number of routes (which I will probably file a separate issue for - that's a long time!). [Here](http://ditrw.com/_dump/gitorious_rake_routes.txt) (and attached) is the output of `rake routes`. Having to wait about a minute for the tests to start running makes TDD rather tedious.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here's the current flow.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
==&amp;gt; [config/environments/development.rb loads here] &amp;lt;==
** ultrasphinx: configuration file not found for &quot;development&quot; environment
** ultrasphinx: please run 'rake ultrasphinx:configure'
** ultrasphinx: spelling support not available (raspell configuration raised &quot;uninitialized constant Ultrasphinx::Spell::Aspell&quot;)
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
==&amp;gt; [config/environment.rb loads here] &amp;lt;==
==&amp;gt; [config/environments/test.rb loads here] &amp;lt;==
Loaded suite /home/augustl/.rvm/gems/ruby-1.8.7-p249@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
......................................&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The data for the bracketed annotations were found by adding
&lt;code&gt;puts&lt;/code&gt; statements to those files.&lt;/p&gt;
&lt;p&gt;This becomes more of a problem the longer the environment takes
to load. For example, &lt;a href=
&quot;http://gitorious.org/gitorious/mainline/commits/rails3&quot;&gt;the rails3
branch of gitorious.org&lt;/a&gt; takes 20-25 seconds to load because of
the high number of routes (which I will probably file a separate
issue for - that's a long time!). &lt;a href=
&quot;http://ditrw.com/_dump/gitorious_rake_routes.txt&quot;&gt;Here&lt;/a&gt; (and
attached) is the output of &lt;code&gt;rake routes&lt;/code&gt;. Having to wait
about a minute for the tests to start running makes TDD rather
tedious.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T16:16:33+01:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2010-06-03T16:17:19+01:00</updated-at>
      <user-id type="integer">1998</user-id>
      <version type="integer">1</version>
      <user-name>August Lilleaas</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm facing the same issue with running my tests, due to the double loading of the environment.What is the reason that the environment is loaded twice?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm facing the same issue with running my tests, due to the
double loading of the environment.What is the reason that the
environment is loaded twice?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-12-16T11:27:14+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2010-12-16T11:27:20+00:00</updated-at>
      <user-id type="integer">109149</user-id>
      <version type="integer">2</version>
      <user-name>Daniel Abrahamsson</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>thank you very much......&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/&quot;&gt;&#1605;&#1606;&#1578;&#1583;&#1610;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&#1605;&#1603;&#1610;&#1575;&#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1575;&#1586;&#1610;&#1575;&#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1601;&#1587;&#1575;&#1578;&#1610;&#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&#1585;&#1587;&#1575;&#1574;&#1604; 
- &#1605;&#1587;&#1580;&#1575;&#1578; - &#1608;&#1587;&#1575;&#1574;&#1591;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&#1578;&#1608;&#1576;&#1610;&#1603;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&#1608;&#1592;&#1575;&#1574;&#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&#1576;&#1585;&#1608;&#1603;&#1587;&#1610;&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=&quot;http://forum.line-sport.tv/&quot;&gt;&#1604;&#1575;&#1610;&#1606; &#1587;&#1576;&#1608;&#1585;&#1578;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;thank you very much......&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/&quot;&gt;&amp;#1605;&amp;#1606;&amp;#1578;&amp;#1583;&amp;#1610;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&amp;#1605;&amp;#1603;&amp;#1610;&amp;#1575;&amp;#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1575;&amp;#1586;&amp;#1610;&amp;#1575;&amp;#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1601;&amp;#1587;&amp;#1575;&amp;#1578;&amp;#1610;&amp;#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&amp;#1585;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1604;&lt;br&gt;
- &amp;#1605;&amp;#1587;&amp;#1580;&amp;#1575;&amp;#1578; -
&amp;#1608;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1591;&lt;/a&gt;&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&amp;#1578;&amp;#1608;&amp;#1576;&amp;#1610;&amp;#1603;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&amp;#1608;&amp;#1592;&amp;#1575;&amp;#1574;&amp;#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt;
&lt;a href=
&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&amp;#1576;&amp;#1585;&amp;#1608;&amp;#1603;&amp;#1587;&amp;#1610;&lt;/a&gt;
&lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt; &lt;a href=
&quot;http://forum.line-sport.tv/&quot;&gt;&amp;#1604;&amp;#1575;&amp;#1610;&amp;#1606;
&amp;#1587;&amp;#1576;&amp;#1608;&amp;#1585;&amp;#1578;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-08T11:27:33+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-02-08T12:16:11+00:00</updated-at>
      <user-id type="integer">136126</user-id>
      <version type="integer">3</version>
      <user-name>alasiri1</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;In which is because their own magnificent kinds easily obtainable in a great plethora. Other than which will,&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora jewellery ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; ought to have this kind of charms that's generally personal in line with your really want? &lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&#160;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;In reality, you are able to consider numerous varieties related to Pandora drops&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; along with develop ones personal confidential types.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; These kind of expensive jewelry have probably always been exceptional reveals regarding instances as well as special birthday festivities&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;In
which is because their own magnificent kinds easily obtainable in a
great plethora. Other than which will,&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora jewellery
ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; ought to have this kind of charms that's
generally personal in line with your really want? &lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;
Pandora&amp;nbsp;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;In reality, you are able to
consider numerous varieties related to Pandora
drops&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras
Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; along with develop ones personal
confidential types.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora
ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; These kind of expensive jewelry have
probably always been exceptional reveals regarding instances as
well as special birthday festivities&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora
NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T05:45:34+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-02-14T07:28:36+00:00</updated-at>
      <user-id type="integer">136876</user-id>
      <version type="integer">4</version>
      <user-name>pandora jewellry</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I tested with rails 3.0.4, created an empty application and scaffold of users.
With a &quot;puts&quot; in *config/environment.rb*, i did:

`rake test -t`
&lt;code&gt;
(in /home/roger/dev/trivial/temp/raketest)
** Invoke test (first_time)
** Execute test
** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
ENV LOADED !
** Execute db:abort_if_pending_migrations
** Execute db:test:prepare
** Invoke db:test:load (first_time)
** Invoke db:test:purge (first_time)
** Invoke environment 
** Execute db:test:purge
** Execute db:test:load
** Invoke db:schema:load (first_time)
** Invoke environment 
** Execute db:schema:load
** Execute test:prepare
** Execute test:units
ENV LOADED !
Loaded suite /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
.
Finished in 0.027144 seconds.

1 tests, 1 assertions, 0 failures, 0 errors
** Invoke test:functionals (first_time)
** Invoke test:prepare 
** Execute test:functionals
ENV LOADED !
Loaded suite /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
.......
Finished in 0.171518 seconds.

7 tests, 10 assertions, 0 failures, 0 errors
** Invoke test:integration (first_time)
** Invoke test:prepare 
** Execute test:integration
&lt;/code&gt;

I tried to test with rails edge too (changing Gemfile to use `gem 'rails', :git =&gt; 'git://github.com/rails/rails.git'`), and i got an error:

&lt;code&gt;
(in /home/roger/dev/trivial/temp/raketest)
** Invoke test (first_time)
** Execute test
** Invoke test:units (first_time)
** Invoke test:prepare (first_time)
** Invoke db:test:prepare (first_time)
** Invoke db:abort_if_pending_migrations (first_time)
** Invoke environment (first_time)
** Execute environment
** Invoke test:functionals (first_time)
** Invoke test:prepare 
** Execute test:functionals
/home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/actionpack/lib/action_dispatch/middleware/session/abstract_store.rb:23: uninitialized constant Rack::Session::Abstract::SessionHash (NameError)
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/actionpack/lib/action_dispatch/middleware/session/cookie_store.rb:3
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application/configuration.rb:116:in `const_get'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application/configuration.rb:116:in `session_store'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application.rb:166:in `default_middleware_stack'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application.rb:146:in `tap'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application.rb:146:in `default_middleware_stack'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/engine.rb:412:in `build_middleware_stack'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application/finisher.rb:37
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/initializable.rb:25:in `instance_exec'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/initializable.rb:25:in `run'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/initializable.rb:50:in `run_initializers'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/initializable.rb:49:in `each'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/initializable.rb:49:in `run_initializers'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/application.rb:93:in `initialize!'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/railtie/configurable.rb:28:in `send'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/railties/lib/rails/railtie/configurable.rb:28:in `method_missing'
	from /home/roger/dev/trivial/temp/raketest/config/environment.rb:5
	from ./test/test_helper.rb:2:in `require'
	from ./test/test_helper.rb:2
	from ./test/functional/users_controller_test.rb:1:in `require'
	from ./test/functional/users_controller_test.rb:1
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
	from /home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
** Invoke test:integration (first_time)
** Invoke test:prepare 
** Execute test:integration
Errors running test:units, test:functionals!
&lt;/code&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;I tested with rails 3.0.4, created an empty application and
scaffold of users.&lt;br&gt;
With a &quot;puts&quot; in &lt;em&gt;config/environment.rb&lt;/em&gt;, i did:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rake test -t&lt;/code&gt; &lt;code&gt;&lt;br&gt;
(in /home/roger/dev/trivial/temp/raketest) &lt;strong&gt;Invoke test
(first_time)&lt;/strong&gt; Execute test &lt;strong&gt;Invoke test:units
(first_time)&lt;/strong&gt; Invoke test:prepare (first_time)
&lt;strong&gt;Invoke db:test:prepare (first_time)&lt;/strong&gt; Invoke
db:abort_if_pending_migrations (first_time) &lt;strong&gt;Invoke
environment (first_time)&lt;/strong&gt; Execute environment ENV LOADED
!&lt;br&gt;
&lt;strong&gt;Execute db:abort_if_pending_migrations&lt;/strong&gt; Execute
db:test:prepare &lt;strong&gt;Invoke db:test:load (first_time)&lt;/strong&gt;
Invoke db:test:purge (first_time) &lt;strong&gt;Invoke
environment&lt;/strong&gt; Execute db:test:purge &lt;strong&gt;Execute
db:test:load&lt;/strong&gt; Invoke db:schema:load (first_time)
&lt;strong&gt;Invoke environment&lt;/strong&gt; Execute db:schema:load
&lt;strong&gt;Execute test:prepare&lt;/strong&gt; Execute test:units ENV LOADED
!&lt;br&gt;
Loaded suite
/home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader&lt;br&gt;
Started&lt;br&gt;
. Finished in 0.027144 seconds.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;1 tests, 1 assertions, 0 failures, 0 errors&lt;br&gt;
&lt;strong&gt;Invoke test:functionals (first_time)&lt;/strong&gt; Invoke
test:prepare ** Execute test:functionals ENV LOADED !&lt;br&gt;
Loaded suite
/home/roger/.rvm/gems/ruby-1.8.7-p330@global/gems/rake-0.8.7/lib/rake/rake_test_loader&lt;br&gt;
Started&lt;br&gt;
....... Finished in 0.171518 seconds.&lt;/p&gt;
&lt;p&gt;7 tests, 10 assertions, 0 failures, 0 errors&lt;br&gt;
&lt;strong&gt;Invoke test:integration (first_time)&lt;/strong&gt; Invoke
test:prepare ** Execute test:integration&lt;/p&gt;
&lt;p&gt;I tried to test with rails edge too (changing Gemfile to use
&lt;code&gt;gem 'rails', :git =&amp;gt;
'git://github.com/rails/rails.git'&lt;/code&gt;), and i got an error:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;br&gt;
(in /home/roger/dev/trivial/temp/raketest) &lt;strong&gt;Invoke test
(first_time)&lt;/strong&gt; Execute test &lt;strong&gt;Invoke test:units
(first_time)&lt;/strong&gt; Invoke test:prepare (first_time)
&lt;strong&gt;Invoke db:test:prepare (first_time)&lt;/strong&gt; Invoke
db:abort_if_pending_migrations (first_time) &lt;strong&gt;Invoke
environment (first_time)&lt;/strong&gt; Execute environment
&lt;strong&gt;Invoke test:functionals (first_time)&lt;/strong&gt; Invoke
test:prepare ** Execute test:functionals
/home/roger/.rvm/gems/ruby-1.8.7-p330@rails-edge/bundler/gems/rails-8276a240207a/actionpack/lib/action_dispatch/middleware/session/abstract_store.rb:23:
uninitialized constant Rack::Session::Abstract::SessionHash
(NameError)&lt;/code&gt;&lt;/p&gt;
{mkd-extraction-a95f96cb27b5f9de47f004b440afe16e}
&lt;p&gt;&lt;strong&gt;Invoke test:integration (first_time)&lt;/strong&gt; Invoke
test:prepare ** Execute test:integration Errors running test:units,
test:functionals!&lt;br&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T10:36:12+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-02-16T10:36:19+00:00</updated-at>
      <user-id type="integer">131154</user-id>
      <version type="integer">5</version>
      <user-name>Roger Leite</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>**Trying to clean the previous message**

I tested with rails 3.0.4, created an empty application and scaffold of users.
With a &quot;puts&quot; in config/environment.rb, i did:

`rake test -t`

I tried to test with rails edge too (changing Gemfile to use gem 'rails', :git =&gt; 'git://github.com/rails/rails.git'), and i got an error.

Put the output at gist: https://gist.github.com/829168</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;strong&gt;Trying to clean the previous message&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I tested with rails 3.0.4, created an empty application and
scaffold of users.&lt;br&gt;
With a &quot;puts&quot; in config/environment.rb, i did:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rake test -t&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I tried to test with rails edge too (changing Gemfile to use gem
'rails', :git =&amp;gt; 'git://github.com/rails/rails.git'), and i got
an error.&lt;/p&gt;
&lt;p&gt;Put the output at gist: &lt;a href=
&quot;https://gist.github.com/829168&quot;&gt;https://gist.github.com/829168&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T10:43:07+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-02-16T10:43:13+00:00</updated-at>
      <user-id type="integer">131154</user-id>
      <version type="integer">6</version>
      <user-name>Roger Leite</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looking at source, i realized two things:
1. https://github.com/rails/rails/blob/master/railties/lib/rails/application.rb#L91 Rails, raises exception if application is already initialized.
2. Task test ( https://github.com/rails/rails/blob/master/railties/lib/rails/test_unit/testing.rake#L75 ) invokes &quot;test:units test:functionals test:integration&quot;. I think they are running in different process.

Somebody can help me ?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looking at source, i realized two things:&lt;br&gt;
1. &lt;a href=
&quot;https://github.com/rails/rails/blob/master/railties/lib/rails/application.rb#L91&quot;&gt;
https://github.com/rails/rails/blob/master/railties/lib/rails/appli...&lt;/a&gt;
Rails, raises exception if application is already initialized.&lt;br&gt;
2. Task test ( &lt;a href=
&quot;https://github.com/rails/rails/blob/master/railties/lib/rails/test_unit/testing.rake#L75&quot;&gt;
https://github.com/rails/rails/blob/master/railties/lib/rails/test_...&lt;/a&gt;
) invokes &quot;test:units test:functionals test:integration&quot;. I think
they are running in different process.&lt;/p&gt;
&lt;p&gt;Somebody can help me ?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T10:56:15+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-02-16T10:56:20+00:00</updated-at>
      <user-id type="integer">131154</user-id>
      <version type="integer">7</version>
      <user-name>Roger Leite</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hi Roger,

I'm not running into any problems running the test suite on the rails master branch -- can you try doing this again? 

Thanks,
Chris</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi Roger,&lt;/p&gt;
&lt;p&gt;I'm not running into any problems running the test suite on the
rails master branch -- can you try doing this again?&lt;/p&gt;
&lt;p&gt;Thanks,&lt;br&gt;
Chris&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-03T04:37:05+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-03-03T04:37:14+00:00</updated-at>
      <user-id type="integer">139613</user-id>
      <version type="integer">8</version>
      <user-name>Christopher Meiklejohn</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Roger, 

Keep in mind if you are running edge rails, you need to be running edge rack as well, which is probably why you are getting the SessionHash error.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Roger,&lt;/p&gt;
&lt;p&gt;Keep in mind if you are running edge rails, you need to be
running edge rack as well, which is probably why you are getting
the SessionHash error.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-03T05:18:54+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-03-03T05:19:02+00:00</updated-at>
      <user-id type="integer">139613</user-id>
      <version type="integer">9</version>
      <user-name>Christopher Meiklejohn</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I didn't know about edge rack ...
Sorry for the false positive.

Thanks for the tip Christopher! It worked.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I didn't know about edge rack ...&lt;br&gt;
Sorry for the false positive.&lt;/p&gt;
&lt;p&gt;Thanks for the tip Christopher! It worked.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-03T14:42:03+00:00</created-at>
      <creator-id type="integer">1998</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4759</number>
      <permalink>rake-testfunctionalsunits-loads-the-environment-twice</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>rails3</tag>
      <title>`rake test(:functionals|:units|....)` loads the environment twice</title>
      <updated-at type="datetime">2011-03-03T14:42:11+00:00</updated-at>
      <user-id type="integer">131154</user-id>
      <version type="integer">10</version>
      <user-name>Roger Leite</user-name>
      <creator-name>August Lilleaas</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4759</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>f38a8326aacf4a5a72b089825b95a8be1c6acbc4</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-03T16:16:33+01:00</created-at>
      <filename>routes.txt</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">545990</id>
      <size type="integer">147636</size>
      <uploader-id type="integer">1998</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/545990/routes.txt</url>
    </attachment>
  </attachments>
</ticket>
