<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">17477</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-12-10T21:27:42+00:00</created-at>
  <creator-id type="integer">39674</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">1553</number>
  <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
  <priority type="integer">911</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
  <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
  <updated-at type="datetime">2009-03-10T11:07:50+00:00</updated-at>
  <user-id type="integer">1366</user-id>
  <version type="integer">10</version>
  <user-name>Pratik</user-name>
  <creator-name>MCW BBC</creator-name>
  <assigned-user-name>Frederick Cheung</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>When I deploy my application, the first POST request causes the javascript_include_tag to fail with a nil object error for expand_sources. Additional requests do not trigger the error.

&lt;code&gt;
On line #5 of app/views/layouts/application.html.erb
2: &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
3: &lt;title&gt;SNPlotyper&lt;/title&gt;
4: &lt;%= stylesheet_link_tag :all, :cache =&gt; true %&gt;
5: &lt;%= javascript_include_tag :all, :cache =&gt; true %&gt;
6: &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
7: var $jq = jQuery.noConflict();
8: &lt;/script&gt;

gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:744:in `tag_sources'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
app/views/layouts/application.html.erb:5
&lt;/code&gt;</original-body>
  <latest-body>When I deploy my application, the first POST request causes the javascript_include_tag to fail with a nil object error for expand_sources. Additional requests do not trigger the error.

&lt;code&gt;
On line #5 of app/views/layouts/application.html.erb
2: &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
3: &lt;title&gt;SNPlotyper&lt;/title&gt;
4: &lt;%= stylesheet_link_tag :all, :cache =&gt; true %&gt;
5: &lt;%= javascript_include_tag :all, :cache =&gt; true %&gt;
6: &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
7: var $jq = jQuery.noConflict();
8: &lt;/script&gt;

gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:744:in `tag_sources'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
app/views/layouts/application.html.erb:5
&lt;/code&gt;</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;When I deploy my application, the first POST request causes the
javascript_include_tag to fail with a nil object error for
expand_sources. Additional requests do not trigger the error.&lt;/p&gt;
&lt;p&gt;On line &lt;a href=&quot;/projects/8994/tickets/5&quot; title=&quot;Ticket #5&quot;&gt;#5&lt;/a&gt; of app/views/layouts/application.html.erb 2: 3:
SNPlotyper 4: &amp;lt;%= stylesheet_link_tag :all, :cache =&amp;gt; true
%&amp;gt; 5: &amp;lt;%= javascript_include_tag :all, :cache =&amp;gt; true
%&amp;gt; 6: 7: var $jq = jQuery.noConflict(); 8:&lt;/p&gt;
&lt;p&gt;
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:744:in
&lt;code&gt;tag_sources'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in&lt;/code&gt;joined_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in
&lt;code&gt;write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in&lt;/code&gt;open'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in
&lt;code&gt;write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in&lt;/code&gt;javascript_include_tag'
app/views/layouts/application.html.erb:5&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>When I deploy my application, the first POST request causes the javascript_include_tag to fail with a nil object error for expand_sources. Additional requests do not trigger the error.

@@@
On line #5 of app/views/layouts/application.html.erb
2: &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
3: &lt;title&gt;SNPlotyper&lt;/title&gt;
4: &lt;%= stylesheet_link_tag :all, :cache =&gt; true %&gt;
5: &lt;%= javascript_include_tag :all, :cache =&gt; true %&gt;
6: &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;
7: var $jq = jQuery.noConflict();
8: &lt;/script&gt;

gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:744:in `tag_sources'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
app/views/layouts/application.html.erb:5
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;When I deploy my application, the first POST request causes the
javascript_include_tag to fail with a nil object error for
expand_sources. Additional requests do not trigger the error.&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
On line #5 of app/views/layouts/application.html.erb
2: &amp;lt;html xmlns=&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&amp;gt;
3: &amp;lt;title&amp;gt;SNPlotyper&amp;lt;/title&amp;gt;
4: &amp;lt;%= stylesheet_link_tag :all, :cache =&amp;gt; true %&amp;gt;
5: &amp;lt;%= javascript_include_tag :all, :cache =&amp;gt; true %&amp;gt;
6: &amp;lt;script type=&amp;quot;text/javascript&amp;quot; charset=&amp;quot;utf-8&amp;quot;&amp;gt;
7: var $jq = jQuery.noConflict();
8: &amp;lt;/script&amp;gt;

gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:744:in `tag_sources'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
app/views/layouts/application.html.erb:5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-10T21:27:43+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 asset_tag_helper expand_sources javascript_include_tag</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-10T21:28:33+00:00</updated-at>
      <user-id type="integer">39674</user-id>
      <version type="integer">1</version>
      <user-name>MCW BBC</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think this should fix it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think this should fix it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T00:07:07+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.2.2 asset_tag_helper expand_sources javascript_include_tag
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 asset_tag_helper expand_sources javascript_include_tag patch</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-11T00:07:09+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">2</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This doesn't fix the issue, but it did lead me to do some more testing.

If I run it on my dev box in production mode, the first GET request works properly, and will create /public/javascripts/all.js and /public/stylesheets/all.js

The first POST request will fail with the following error:

@@@
Errno::ENOENT in Analyses#visualize
Showing app/views/layouts/application.html.erb where line #4 raised:
No such file or directory - ./public/stylesheets/standard.css

/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `read'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `collect'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:393:in `stylesheet_link_tag'
/Users/me/workspace/webapp/app/views/layouts/application.html.erb:4
@@@

This will also now create the new file:&lt;br /&gt;
/public/images/public/stylesheets/all.css&lt;br /&gt;

Run the same POST request again, and it creates:&lt;br /&gt;
/public/images/public/javascripts/all.js&lt;br /&gt;

It also throws this error/trace:
@@@
Errno::ENOENT in Analyses#visualize
Showing app/views/layouts/application.html.erb where line #5 raised:
No such file or directory - ./public/javascripts/prototype.js

/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `read'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `collect'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
/Users/me/workspace/webapp/app/views/layouts/application.html.erb:5
@@@

The third POST request is then successful.

It seems that somewhere along the way ASSETS_DIR or Rails.public_path are getting messed up and it's redefined on the POST requests, which cause the cached stylesheets and javascripts to be placed in a weird area.

line 104 of asset_tag_helper.rb
@@@
ASSETS_DIR      = defined?(Rails.public_path) ? Rails.public_path : &quot;public&quot;
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;This doesn't fix the issue, but it did lead me to do some more
testing.&lt;/p&gt;
&lt;p&gt;If I run it on my dev box in production mode, the first GET
request works properly, and will create /public/javascripts/all.js
and /public/stylesheets/all.js&lt;/p&gt;
&lt;p&gt;The first POST request will fail with the following error:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
Errno::ENOENT in Analyses#visualize
Showing app/views/layouts/application.html.erb where line #4 raised:
No such file or directory - ./public/stylesheets/standard.css

/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `read'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `collect'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:393:in `stylesheet_link_tag'
/Users/me/workspace/webapp/app/views/layouts/application.html.erb:4
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will also now create the new file:&lt;br&gt;
/public/images/public/stylesheets/all.css&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Run the same POST request again, and it creates:&lt;br&gt;
/public/images/public/javascripts/all.js&lt;br&gt;&lt;/p&gt;
&lt;p&gt;It also throws this error/trace:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
Errno::ENOENT in Analyses#visualize
Showing app/views/layouts/application.html.erb where line #5 raised:
No such file or directory - ./public/javascripts/prototype.js

/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `read'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:561:in `contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `collect'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:748:in `joined_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `open'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:717:in `write_asset_file_contents'
/opt/local/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/asset_tag_helper.rb:253:in `javascript_include_tag'
/Users/me/workspace/webapp/app/views/layouts/application.html.erb:5
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The third POST request is then successful.&lt;/p&gt;
&lt;p&gt;It seems that somewhere along the way ASSETS_DIR or
Rails.public_path are getting messed up and it's redefined on the
POST requests, which cause the cached stylesheets and javascripts
to be placed in a weird area.&lt;/p&gt;
&lt;p&gt;line 104 of asset_tag_helper.rb&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
ASSETS_DIR      = defined?(Rails.public_path) ? Rails.public_path : &amp;quot;public&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T14:59:17+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.2.2 asset_tag_helper expand_sources javascript_include_tag patch
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-11T14:59:22+00:00</updated-at>
      <user-id type="integer">30336</user-id>
      <version type="integer">3</version>
      <user-name>jgeiger</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>So what i did was change a uniq! to a uniq (because the return value of uniq! is nil if nothing as removed).

A separate issue it would seem is that :all tries to collect all the js that rails assume are there (ie prototype, scriptaculous etc...) and which I'm guessing you;re not using and may even have removed</body>
      <body-html>&lt;div&gt;&lt;p&gt;So what i did was change a uniq! to a uniq (because the return
value of uniq! is nil if nothing as removed).&lt;/p&gt;
&lt;p&gt;A separate issue it would seem is that :all tries to collect all
the js that rails assume are there (ie prototype, scriptaculous
etc...) and which I'm guessing you;re not using and may even have
removed&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T15:25:21+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-11T15:25:23+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">4</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm using all of the default js files, and some others as well. What my further research showed above is that there is something wrong with where the cached files are being created on my POST request. It looks like the ASSETS_DIR is being set to public from inside the images directory, which is odd. It's like Rails.public_path is being reset in some way.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm using all of the default js files, and some others as well.
What my further research showed above is that there is something
wrong with where the cached files are being created on my POST
request. It looks like the ASSETS_DIR is being set to public from
inside the images directory, which is odd. It's like
Rails.public_path is being reset in some way.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-11T17:54:13+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-11T17:54:18+00:00</updated-at>
      <user-id type="integer">30336</user-id>
      <version type="integer">5</version>
      <user-name>jgeiger</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17477</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-22T03:49:27+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-22T03:49:30+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">6</version>
      <user-name>Pratik</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name>Frederick Cheung</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17477</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Can you condense this into a small example (ie actual code)?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can you condense this into a small example (ie actual code)?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-23T00:45:19+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2008-12-23T00:45:21+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">7</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name>Frederick Cheung</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17477</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>A lot of the asset tag stuff was changed in [104898f](http://rails.lighthouseapp.com/projects/8994/changesets/104898fcb7958bcb69ba0239d6de8aa37f2da9ba). Has that changed anything for you?</body>
      <body-html>&lt;div&gt;&lt;p&gt;A lot of the asset tag stuff was changed in &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994/changesets/104898fcb7958bcb69ba0239d6de8aa37f2da9ba&quot;&gt;
104898f&lt;/a&gt;. Has that changed anything for you?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-04T18:36:50+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2009-01-04T18:38:25+00:00</updated-at>
      <user-id type="integer">17477</user-id>
      <version type="integer">8</version>
      <user-name>Frederick Cheung</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name>Frederick Cheung</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17477</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm not using edge, but I would have to believe this will fix it.

This line that was removed is very telling to me since my all.js and all.css ended up getting stuck into the images folder after requests.

- module ImageAsset
- DIRECTORY = 'images'.freeze</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not using edge, but I would have to believe this will fix
it.&lt;/p&gt;
&lt;p&gt;This line that was removed is very telling to me since my all.js
and all.css ended up getting stuck into the images folder after
requests.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;module ImageAsset&lt;/li&gt;
&lt;li&gt;DIRECTORY = 'images'.freeze&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-05T14:28:11+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2009-01-05T14:28:12+00:00</updated-at>
      <user-id type="integer">30336</user-id>
      <version type="integer">9</version>
      <user-name>jgeiger</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name>Frederick Cheung</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">17477</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Putting on &quot;stale&quot;. Please reopen if it's still an issue.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Putting on &quot;stale&quot;. Please reopen if it's still an issue.&lt;/p&gt;
&lt;p&gt;Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-10T11:07:45+00:00</created-at>
      <creator-id type="integer">39674</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1553</number>
      <permalink>javascript_include_tag-throwing-nil-object-error-on-first-load-after-deploy-when-used-with-cache-in-production</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>2.2.2 assets_dir asset_tag_helper patch rails.public_path</tag>
      <title>javascript_include_tag throwing nil object error on first load after deploy when used with cache in production</title>
      <updated-at type="datetime">2009-03-10T11:07:50+00:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">10</version>
      <user-name>Pratik</user-name>
      <creator-name>MCW BBC</creator-name>
      <assigned-user-name>Frederick Cheung</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1553</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>f764c85b9ec0f8029d714b371b5a1605fa036b9e</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-12-11T00:07:08+00:00</created-at>
      <filename>fix_nil_error.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">70058</id>
      <size type="integer">2348</size>
      <uploader-id type="integer">17477</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/70058/fix_nil_error.patch</url>
    </attachment>
  </attachments>
</ticket>
