<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">22589</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2011-02-14T05:41:57+00:00</created-at>
  <creator-id type="integer">17102</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">82855</milestone-id>
  <number type="integer">3766</number>
  <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>open</state>
  <tag>named_scope</tag>
  <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
  <updated-at type="datetime">2011-03-26T02:30:08+00:00</updated-at>
  <user-id type="integer">142823</user-id>
  <version type="integer">22</version>
  <user-name>bingbing</user-name>
  <creator-name>Stephan Kaag</creator-name>
  <assigned-user-name>Matt Jones</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
  <milestone-title>2.3.10</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>Summary:

I create a named_scope at runtime (a pattern that searchlogic (http://github.com/binarylogic/searchlogic) also relies on). When the named-scope is first called on the super class an error is raised when I call that same scope in the subclass. I am not familiar enough with the codebase to provide a solution myself.

This error occurs in both Rails 2.3.5 and 3.0pre.


To reproduce:


@@@ ruby
Rails3::Application.configure do
  config.cache_classes = true
end

class Candidate &lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&gt; {}
  end
end

class Admin::Candidate &lt; Candidate
end
@@@


Error trigger:
@@@ ruby
Candidate.create_second_order_scope
Candidate.second_order
Admin::Candidate.create_second_order_scope
Admin::Candidate.second_order
@@@

@@@
&gt;&gt; undefined method `call' for nil:NilClass
@@@</original-body>
  <latest-body>Summary:

I create a named_scope at runtime (a pattern that searchlogic (http://github.com/binarylogic/searchlogic) also relies on). When the named-scope is first called on the super class an error is raised when I call that same scope in the subclass. I am not familiar enough with the codebase to provide a solution myself.

This error occurs in both Rails 2.3.5 and 3.0pre.


To reproduce:


@@@ ruby
Rails3::Application.configure do
  config.cache_classes = true
end

class Candidate &lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&gt; {}
  end
end

class Admin::Candidate &lt; Candidate
end
@@@


Error trigger:
@@@ ruby
Candidate.create_second_order_scope
Candidate.second_order
Admin::Candidate.create_second_order_scope
Admin::Candidate.second_order
@@@

@@@
&gt;&gt; undefined method `call' for nil:NilClass
@@@</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Summary:&lt;/p&gt;
&lt;p&gt;I create a named_scope at runtime (a pattern that searchlogic
(&lt;a href=
&quot;http://github.com/binarylogic/searchlogic&quot;&gt;http://github.com/binarylogic/searchlogic&lt;/a&gt;)
also relies on). When the named-scope is first called on the super
class an error is raised when I call that same scope in the
subclass. I am not familiar enough with the codebase to provide a
solution myself.&lt;/p&gt;
&lt;p&gt;This error occurs in both Rails 2.3.5 and 3.0pre.&lt;/p&gt;
&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Rails3::Application.configure do
  config.cache_classes = true
end

class Candidate &amp;lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&amp;gt; {}
  end
end

class Admin::Candidate &amp;lt; Candidate
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Error trigger:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Candidate.create_second_order_scope
Candidate.second_order
Admin::Candidate.create_second_order_scope
Admin::Candidate.second_order&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt; undefined method `call' for nil:NilClass&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Summary:

I create a named_scope at runtime (a pattern that searchlogic (http://github.com/binarylogic/searchlogic) also relies on). When the named-scope is first called on the super class an error is raised when I call that same scope in the subclass. I am not familiar enough with the codebase to provide a solution myself.

This error occurs in both Rails 2.3.5 and 3.0pre.


To reproduce:


@@@ ruby
Rails3::Application.configure do
  config.cache_classes = true
end

class Candidate &lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&gt; {}
  end
end

class Admin::Candidate &lt; Candidate
end
@@@


Error trigger:
@@@ ruby
Candidate.create_second_order_scope
Candidate.second_order
Admin::Candidate.create_second_order_scope
Admin::Candidate.second_order
@@@

@@@
&gt;&gt; undefined method `call' for nil:NilClass
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Summary:&lt;/p&gt;
&lt;p&gt;I create a named_scope at runtime (a pattern that searchlogic
(&lt;a href=
&quot;http://github.com/binarylogic/searchlogic&quot;&gt;http://github.com/binarylogic/searchlogic&lt;/a&gt;)
also relies on). When the named-scope is first called on the super
class an error is raised when I call that same scope in the
subclass. I am not familiar enough with the codebase to provide a
solution myself.&lt;/p&gt;
&lt;p&gt;This error occurs in both Rails 2.3.5 and 3.0pre.&lt;/p&gt;
&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Rails3::Application.configure do
  config.cache_classes = true
end

class Candidate &amp;lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&amp;gt; {}
  end
end

class Admin::Candidate &amp;lt; Candidate
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Error trigger:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;Candidate.create_second_order_scope
Candidate.second_order
Admin::Candidate.create_second_order_scope
Admin::Candidate.second_order&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt; undefined method `call' for nil:NilClass&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-21T16:42:20+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-01-21T16:42:23+00:00</updated-at>
      <user-id type="integer">17102</user-id>
      <version type="integer">1</version>
      <user-name>Stephan Kaag</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Is anyone experiencing this same problem?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Is anyone experiencing this same problem?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-01T09:36:45+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-02-01T09:36:50+00:00</updated-at>
      <user-id type="integer">17102</user-id>
      <version type="integer">2</version>
      <user-name>Stephan Kaag</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've experienced this EXACT problem, in the Hobo project which does automatic scope generation much like this.

See [this ticket](https://hobo.lighthouseapp.com/projects/8324/tickets/492) for more info, and the commit at the end of the ticket for a tweak that may help your case. As you can see in the ticket, I was *supposed* to have already made a ticket for this here... :)

If it works for you, I'll see about writing up a patch + some tests (you're welcome to give it a try as well).</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've experienced this EXACT problem, in the Hobo project which
does automatic scope generation much like this.&lt;/p&gt;
&lt;p&gt;See &lt;a href=
&quot;https://hobo.lighthouseapp.com/projects/8324/tickets/492&quot;&gt;this
ticket&lt;/a&gt; for more info, and the commit at the end of the ticket
for a tweak that may help your case. As you can see in the ticket,
I was &lt;em&gt;supposed&lt;/em&gt; to have already made a ticket for this
here... :)&lt;/p&gt;
&lt;p&gt;If it works for you, I'll see about writing up a patch + some
tests (you're welcome to give it a try as well).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-02-04T21:27:58+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-02-04T21:32:15+00:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">3</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Same problem here. Rails 2.3.5. Using STI.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same problem here. Rails 2.3.5. Using STI.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-15T19:16:48+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-04-15T19:16:52+01:00</updated-at>
      <user-id type="integer">39898</user-id>
      <version type="integer">4</version>
      <user-name>Espen Antonsen</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Can someone create a test case following https://rails.lighthouseapp.com/projects/8994/sending-patches
Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Can someone create a test case following &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/sending-patches&quot;&gt;https://rails.lighthouseapp.com/projects/8994/sending-patches&lt;/a&gt;&lt;br&gt;
Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-24T22:22:05+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-24T22:22:22+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">5</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am not able to reproduce this problem with rails3 edge.

@@@ ruby
ActiveRecord::Schema.define(:version =&gt; 20100624220122) do

  create_table &quot;users&quot;, :force =&gt; true do |t|
    t.string   &quot;name&quot;
    t.datetime &quot;created_at&quot;
    t.datetime &quot;updated_at&quot;
  end

end
class User &lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&gt; {}
  end

  def self.lab
    User.create_second_order_scope
    puts User.second_order.all.inspect
  end
end

class Admin::User &lt; User
  def self.lab
    Admin::User.create_second_order_scope
    puts Admin::User.second_order.all.inspect
  end
end

# User.lab #=&gt; produces sql query
# Admin::User.lab #=&gt; produces sql query
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am not able to reproduce this problem with rails3 edge.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;ActiveRecord::Schema.define(:version =&amp;gt; 20100624220122) do

  create_table &quot;users&quot;, :force =&amp;gt; true do |t|
    t.string   &quot;name&quot;
    t.datetime &quot;created_at&quot;
    t.datetime &quot;updated_at&quot;
  end

end
class User &amp;lt; ActiveRecord::Base
  def self.create_second_order_scope
    return if respond_to?(:second_order)
    named_scope :second_order, :conditions =&amp;gt; {}
  end

  def self.lab
    User.create_second_order_scope
    puts User.second_order.all.inspect
  end
end

class Admin::User &amp;lt; User
  def self.lab
    Admin::User.create_second_order_scope
    puts Admin::User.second_order.all.inspect
  end
end

# User.lab #=&amp;gt; produces sql query
# Admin::User.lab #=&amp;gt; produces sql query&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T01:44:50+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T01:44:58+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">6</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Neeraj did you do config.cache_classes = true? What about 2-3-stable?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Neeraj did you do config.cache_classes = true? What about
2-3-stable?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T02:56:12+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T02:56:22+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">7</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Santiago I just did User.lab and Admin::User.lab in production environment and I get the same result. 

will try with 2-3 and will let you know.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Santiago I just did User.lab and Admin::User.lab in production
environment and I get the same result.&lt;/p&gt;
&lt;p&gt;will try with 2-3 and will let you know.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T03:54:14+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T03:54:24+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">8</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@Neeraj: at least in Rails 2.3.x, the issue is caused by the scope's method being propagated up the inheritance chain, while the scope conditions are not. The trick is that the scopes are stored in an inheritable attribute - not a big deal for 3.0, since the methods are defined in-place without an actual reference to the array (see around line 89 in named_scopes.rb on master). On 2.3.x, the method that's defined only references the array:

@@@ ruby
define_method name do |*args|
  scopes[name].call(self, *args)
end
@@@

Thus, in Admin::User above, you end up with a `second_order` method inherited from the parent, but scopes[:second_order] returns nil since the subclass has an empty hash which was inherited from the parent at definition time.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Neeraj: at least in Rails 2.3.x, the issue is caused by the
scope's method being propagated up the inheritance chain, while the
scope conditions are not. The trick is that the scopes are stored
in an inheritable attribute - not a big deal for 3.0, since the
methods are defined in-place without an actual reference to the
array (see around line 89 in named_scopes.rb on master). On 2.3.x,
the method that's defined only references the array:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;define_method name do |*args|
  scopes[name].call(self, *args)
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Thus, in Admin::User above, you end up with a
&lt;code&gt;second_order&lt;/code&gt; method inherited from the parent, but
scopes[:second_order] returns nil since the subclass has an empty
hash which was inherited from the parent at definition time.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T04:04:16+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T04:04:25+01:00</updated-at>
      <user-id type="integer">22589</user-id>
      <version type="integer">9</version>
      <user-name>Matt Jones</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can confirm that it is indeed and error with 2-3-stable. But it works fine on rails3 edge.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can confirm that it is indeed and error with 2-3-stable. But
it works fine on rails3 edge.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T22:10:34+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 3.0pre named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T22:10:42+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">10</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T22:10:49+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 3.0pre named_scope
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.3.5 named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T22:10:58+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">11</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T22:13:29+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 2.3.5 named_scope
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-06-25T22:13:44+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">12</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27613)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27613&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T02:28:50+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-08-30T02:28:50+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">13</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I put together some code based on the Hobo link placed here.  I am still testing it, but it seems to work so far.  Once I am sure that it works, I will put together the patch.

Here is the change to lib/active_record/named_scope.rb against 2.3.10

def named_scope(name, options = {}, &amp;block)
        name = name.to_sym

        scopes[name] = lambda do |parent_scope, *args|
          Scope.new(parent_scope, case options
            when Hash
              options
            when Proc
              if self.model_name != parent_scope.model_name
                options.bind(parent_scope).call(*args)
              else
                options.call(*args)
              end
          end, &amp;block)
        end

        singleton_class.send :define_method, name do |*args|
          scopes[name].call(self, *args)
        end

        _name = name.to_sym
        _scope = scopes[_name]
        subclasses.each do |s|
          s.scopes[_name] = _scope
        end

      end
    end</body>
      <body-html>&lt;div&gt;&lt;p&gt;I put together some code based on the Hobo link placed here. I
am still testing it, but it seems to work so far. Once I am sure
that it works, I will put together the patch.&lt;/p&gt;
&lt;p&gt;Here is the change to lib/active_record/named_scope.rb against
2.3.10&lt;/p&gt;
&lt;p&gt;def named_scope(name, options = {}, &amp;amp;block)&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    name = name.to_sym

    scopes[name] = lambda do |parent_scope, *args|
      Scope.new(parent_scope, case options
        when Hash
          options
        when Proc
          if self.model_name != parent_scope.model_name
            options.bind(parent_scope).call(*args)
          else
            options.call(*args)
          end
      end, &amp;amp;block)
    end

    singleton_class.send :define_method, name do |*args|
      scopes[name].call(self, *args)
    end

    _name = name.to_sym
    _scope = scopes[_name]
    subclasses.each do |s|
      s.scopes[_name] = _scope
    end

  end
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-18T23:36:34+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-10-18T23:36:40+01:00</updated-at>
      <user-id type="integer">14554</user-id>
      <version type="integer">14</version>
      <user-name>mrcsparker</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Cartier Dead Ringer, whose chic watches are &lt;a href=&quot;http://www.hotuggbootuk.com&quot;&gt;ugg boots uk sale&lt;/a&gt; stylish, is a claim of the most unusual define in the render smartphones. You can turn all these tips and you're convinced to have an untrue priceless &lt;a href=&quot;http://www.uggmalluk.com&quot;&gt;cheap ugg boots&lt;/a&gt; from in keep posted to woebegone all account that were turned &lt;a href=&quot;http://www.genuineuggbootuk.com&quot;&gt;ugg boots uk&lt;/a&gt; on as the transmit reached its revenge within cities leveled.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Cartier Dead Ringer, whose chic watches are &lt;a href=
&quot;http://www.hotuggbootuk.com&quot;&gt;ugg boots uk sale&lt;/a&gt; stylish, is a
claim of the most unusual define in the render smartphones. You can
turn all these tips and you're convinced to have an untrue
priceless &lt;a href=&quot;http://www.uggmalluk.com&quot;&gt;cheap ugg boots&lt;/a&gt;
from in keep posted to woebegone all account that were turned
&lt;a href=&quot;http://www.genuineuggbootuk.com&quot;&gt;ugg boots uk&lt;/a&gt; on as
the transmit reached its revenge within cities leveled.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T02:58:14+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-10-19T17:51:47+01:00</updated-at>
      <user-id type="integer">120603</user-id>
      <version type="integer">15</version>
      <user-name>littlebaby</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>while the scope conditions are not. The trick is that the scopes are stored in an inheritable attribute - not a big deal for 3.0, since the &lt;a href=&quot;http://www.weddinginthebox.com/blog/western-wedding-dresses.html&quot;&gt;classic and traditional western wedding dress&lt;/a&gt; are defined in-place without an actual reference to the array (see around line 89 in named_scopes.rb on master).</body>
      <body-html>&lt;div&gt;&lt;p&gt;while the scope conditions are not. The trick is that the scopes
are stored in an inheritable attribute - not a big deal for 3.0,
since the &lt;a href=
&quot;http://www.weddinginthebox.com/blog/western-wedding-dresses.html&quot;&gt;classic
and traditional western wedding dress&lt;/a&gt; are defined in-place
without an actual reference to the array (see around line 89 in
named_scopes.rb on master).&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T06:13:53+01:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2010-10-19T17:52:52+01:00</updated-at>
      <user-id type="integer">120610</user-id>
      <version type="integer">16</version>
      <user-name>koukou</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:29:32+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-02-02T16:38:41+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">17</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:29:33+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-02-02T16:39:08+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">18</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Good &lt;a href=http://www.sale-puma.com&gt;Puma shoes sale&lt;/a&gt; information for &lt;a href=http://www.sale-puma.com&gt;Puma shoes&lt;/a&gt; fans: Yesterday, German sportswear maker Cheap Running Shoes purchased effectively lot of money Brands. The transaction entails the Cobra brand, too as linked inventory, intellectual house and endorsement contracts. It also helps make &lt;a href=http://www.sale-puma.com&gt;puma speed cat&lt;/a&gt; Shoes . They provide you with the utmost game and support all through the feet.You can happen around several types of basketball sneakers such as high-top,low-top and mid-top.The &lt;a href=http://www.sale-puma.com&gt;Puma shoes online&lt;/a&gt; and boots give you best ankle support will support want you to obtain steadiness.
As we konw,Trail &lt;a href=http://www.sale-puma.com&gt;Puma Drift Cat&lt;/a&gt; Shoes black, Trail &lt;a href=http://www.sale-puma.com&gt;Puma future cat&lt;/a&gt; ShoesWhite Black? 50 many years backshore are actually released within a great accomplishment. Trail Running Shoes speed cat shoes?go in add-on to King Pele into planet tournament finals, bottom tennis discs matchrs within pasture inhabit an vital area in hold out in Wimbledon Dun; Its working firms have premier manufacturers and major marketplace positions in distilled spirits, residence and security, and golf products. The reply go all through the &lt;a href=http://www.sale-puma.com&gt;Cheap puma shoes&lt;/a&gt; on sale-here you are able to happen around several distcoun.&lt;a href=http://www.sale-puma.com&gt;puma shoes on sale &lt;/a&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Good &lt;a href=&quot;http:&quot;&gt;Puma shoes sale information for &lt;a href=
&quot;http:&quot;&gt;Puma shoes fans: Yesterday, German sportswear maker Cheap
Running Shoes purchased effectively lot of money Brands. The
transaction entails the Cobra brand, too as linked inventory,
intellectual house and endorsement contracts. It also helps make
&lt;a href=&quot;http:&quot;&gt;puma speed cat Shoes . They provide you with the
utmost game and support all through the feet.You can happen around
several types of basketball sneakers such as high-top,low-top and
mid-top.The &lt;a href=&quot;http:&quot;&gt;Puma shoes online and boots give you
best ankle support will support want you to obtain steadiness.&lt;br&gt;
As we konw,Trail &lt;a href=&quot;http:&quot;&gt;Puma Drift Cat Shoes black, Trail
&lt;a href=&quot;http:&quot;&gt;Puma future cat ShoesWhite Black? 50 many years
backshore are actually released within a great accomplishment.
Trail Running Shoes speed cat shoes?go in add-on to King Pele into
planet tournament finals, bottom tennis discs matchrs within
pasture inhabit an vital area in hold out in Wimbledon Dun; Its
working firms have premier manufacturers and major marketplace
positions in distilled spirits, residence and security, and golf
products. The reply go all through the &lt;a href=&quot;http:&quot;&gt;Cheap puma
shoes on sale-here you are able to happen around several
distcoun.&lt;a href=&quot;http:&quot;&gt;puma shoes on sale .&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-14T02:55:38+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-02-14T05:41:57+00:00</updated-at>
      <user-id type="integer">136860</user-id>
      <version type="integer">19</version>
      <user-name>xixi</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I just ran into this today on Rails 2.3.10 uses searchlogic.

I've attached a patch with a test that exposes the bug on Rails 2.3 stable and a fix for the issue. The fix is basically mrcsparker's fix above.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just ran into this today on Rails 2.3.10 uses searchlogic.&lt;/p&gt;
&lt;p&gt;I've attached a patch with a test that exposes the bug on Rails
2.3 stable and a fix for the issue. The fix is basically
mrcsparker's fix above.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-14T21:08:00+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-02-14T21:08:16+00:00</updated-at>
      <user-id type="integer">136999</user-id>
      <version type="integer">20</version>
      <user-name>Ryan Burrows</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Forgot to open the ticket

[state:open]</body>
      <body-html>&lt;div&gt;&lt;p&gt;Forgot to open the ticket&lt;/p&gt;
&lt;p&gt;[state:open]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-14T21:23:20+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- 
:state: stale
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-02-14T21:23:39+00:00</updated-at>
      <user-id type="integer">72046</user-id>
      <version type="integer">21</version>
      <user-name>Ryan Burrows</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">22589</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton watches&lt;/a&gt;&lt;/b&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton
watches&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-03-26T02:08:03+00:00</created-at>
      <creator-id type="integer">17102</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3766</number>
      <permalink>on-the-fly-created-named-scope-raises-undefined-method-call-when-called-from-subclass-with-cache_classes-true</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>named_scope</tag>
      <title>On-the-fly created named-scope raises 'undefined method `call' when called from subclass with cache_classes = true</title>
      <updated-at type="datetime">2011-03-26T02:30:08+00:00</updated-at>
      <user-id type="integer">142823</user-id>
      <version type="integer">22</version>
      <user-name>bingbing</user-name>
      <creator-name>Stephan Kaag</creator-name>
      <assigned-user-name>Matt Jones</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3766</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>3eb381de16966eb5bfd7c48748611838a8606cb3</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-02-14T21:08:00+00:00</created-at>
      <filename>inherit_named_scopes.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">911913</id>
      <size type="integer">1555</size>
      <uploader-id type="integer">136999</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/911913/inherit_named_scopes.diff</url>
    </attachment>
  </attachments>
</ticket>
