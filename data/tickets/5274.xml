<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">7697</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-02T17:06:17+01:00</created-at>
  <creator-id type="integer">33887</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">5274</number>
  <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>constraints exception regexp routes</tag>
  <title>better error messages when incorrect regexp is passed to constraints in routes</title>
  <updated-at type="datetime">2011-03-26T02:20:55+00:00</updated-at>
  <user-id type="integer">142823</user-id>
  <version type="integer">10</version>
  <user-name>bingbing</user-name>
  <creator-name>Jakub Suder</creator-name>
  <assigned-user-name>Andrew White</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>The :constraints parameter in routes expects a regexp without the start/end markers (which is the opposite to e.g. the regexps passed to validation methods in ActiveModel). If you pass a full regexp like /^\w+$/, you get a strange exception message &quot;undefined method `include?' for #&lt;Anchor &quot;^&quot;&gt;&quot; coming from rack-mount.

It would be more consistent if the regexp style was the same in routes and in ActiveModel, but if that's not possible, then maybe Rails could print more meaningful error messages when incorrect regexp is passed to :constraints instead of that exception.</original-body>
  <latest-body>The :constraints parameter in routes expects a regexp without the start/end markers (which is the opposite to e.g. the regexps passed to validation methods in ActiveModel). If you pass a full regexp like /^\w+$/, you get a strange exception message &quot;undefined method `include?' for #&lt;Anchor &quot;^&quot;&gt;&quot; coming from rack-mount.

It would be more consistent if the regexp style was the same in routes and in ActiveModel, but if that's not possible, then maybe Rails could print more meaningful error messages when incorrect regexp is passed to :constraints instead of that exception.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;The :constraints parameter in routes expects a regexp without
the start/end markers (which is the opposite to e.g. the regexps
passed to validation methods in ActiveModel). If you pass a full
regexp like /^\w+$/, you get a strange exception message &quot;undefined
method &lt;code&gt;include?' for #&amp;lt;Anchor &quot;^&quot;&amp;gt;&quot; coming from
rack-mount.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;It would be more consistent if the regexp style was the same in
routes and in ActiveModel, but if that's not possible, then maybe
Rails could print more meaningful error messages when incorrect
regexp is passed to :constraints instead of that exception.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The :constraints parameter in routes expects a regexp without the start/end markers (which is the opposite to e.g. the regexps passed to validation methods in ActiveModel). If you pass a full regexp like /^\w+$/, you get a strange exception message &quot;undefined method `include?' for #&lt;Anchor &quot;^&quot;&gt;&quot; coming from rack-mount.

It would be more consistent if the regexp style was the same in routes and in ActiveModel, but if that's not possible, then maybe Rails could print more meaningful error messages when incorrect regexp is passed to :constraints instead of that exception.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The :constraints parameter in routes expects a regexp without
the start/end markers (which is the opposite to e.g. the regexps
passed to validation methods in ActiveModel). If you pass a full
regexp like /^\w+$/, you get a strange exception message &quot;undefined
method &lt;code&gt;include?' for #&amp;lt;Anchor &quot;^&quot;&amp;gt;&quot; coming from
rack-mount.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;It would be more consistent if the regexp style was the same in
routes and in ActiveModel, but if that's not possible, then maybe
Rails could print more meaningful error messages when incorrect
regexp is passed to :constraints instead of that exception.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-02T17:06:17+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-08-02T17:06:21+01:00</updated-at>
      <user-id type="integer">33887</user-id>
      <version type="integer">1</version>
      <user-name>Jakub Suder</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>According to the docs you can use normal regexp's with the start/end markes: http://guides.rubyonrails.org/routing.html#specifying-constraints

Am I missing something? Maybe this was fixed along the way. I'm closing the ticket, however if this is still an issue just leave a comment with steps to reproduce the problem, or a patch and I'll reopen.</body>
      <body-html>&lt;div&gt;&lt;p&gt;According to the docs you can use normal regexp's with the
start/end markes: &lt;a href=
&quot;http://guides.rubyonrails.org/routing.html#specifying-constraints&quot;&gt;
http://guides.rubyonrails.org/routing.html#specifying-constraints&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Am I missing something? Maybe this was fixed along the way. I'm
closing the ticket, however if this is still an issue just leave a
comment with steps to reproduce the problem, or a patch and I'll
reopen.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-07T06:38:26+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-07T06:38:29+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">2</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Well, the guide you linked to shows examples with regexps *without* start/end markers...

Example from that link:

    constraints(:id =&gt; /[A-Z][A-Z][0-9]+/) do

And if you do this:

    constraints(:id =&gt; /^[A-Z][A-Z][0-9]+$/) do

you get a confusing error and you waste half an hour trying to figure out what may be wrong (it's not just me, someone else from my team had this last week too). This happens on Rails 3.0.0 final, I'm not sure about latest development version.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Well, the guide you linked to shows examples with regexps
&lt;em&gt;without&lt;/em&gt; start/end markers...&lt;/p&gt;
&lt;p&gt;Example from that link:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;constraints(:id =&amp;gt; /[A-Z][A-Z][0-9]+/) do&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And if you do this:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;constraints(:id =&amp;gt; /^[A-Z][A-Z][0-9]+$/) do&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;you get a confusing error and you waste half an hour trying to
figure out what may be wrong (it's not just me, someone else from
my team had this last week too). This happens on Rails 3.0.0 final,
I'm not sure about latest development version.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-07T19:51:30+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-07T19:51:32+01:00</updated-at>
      <user-id type="integer">33887</user-id>
      <version type="integer">3</version>
      <user-name>Jakub Suder</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sorry for that!

Well I think I've seen something similar. And iirc, it's not possible/easy to allow use of start/end markers in constraints.

Assigning to Andrew for clarification.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry for that!&lt;/p&gt;
&lt;p&gt;Well I think I've seen something similar. And iirc, it's not
possible/easy to allow use of start/end markers in constraints.&lt;/p&gt;
&lt;p&gt;Assigning to Andrew for clarification.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-08T02:07:14+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-08T02:07:16+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">4</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>There's a commit on master which raises an ArgumentError when an anchor is used in a constraint:
http://github.com/rails/rails/commit/ca3936dbd691538d97d8dbe2bc1d64c21dc7db0e

It's impossible to add anchor support to routing constraints since each regexp is assembled into a larger regexp with it's own anchors. Validations are different because there you are specifying the whole regexp rather than just a fragment so it's perfectly valid that you might want to use an anchor.

I'll backport the above commit to the 3-0-stable branch - I believe something similar already exists in the 2-3-stable branch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There's a commit on master which raises an ArgumentError when an
anchor is used in a constraint:&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/ca3936dbd691538d97d8dbe2bc1d64c21dc7db0e&quot;&gt;
http://github.com/rails/rails/commit/ca3936dbd691538d97d8dbe2bc1d64...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It's impossible to add anchor support to routing constraints
since each regexp is assembled into a larger regexp with it's own
anchors. Validations are different because there you are specifying
the whole regexp rather than just a fragment so it's perfectly
valid that you might want to use an anchor.&lt;/p&gt;
&lt;p&gt;I'll backport the above commit to the 3-0-stable branch - I
believe something similar already exists in the 2-3-stable
branch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-08T07:02:52+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-08T07:02:53+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">5</version>
      <user-name>Andrew White</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Fixed on `master` and will be backported to `3-0-stable`.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Fixed on &lt;code&gt;master&lt;/code&gt; and will be backported to
&lt;code&gt;3-0-stable&lt;/code&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-08T08:41:25+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-08T08:41:31+01:00</updated-at>
      <user-id type="integer">65050</user-id>
      <version type="integer">6</version>
      <user-name>David Trasbo</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>That should be enough, thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That should be enough, thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-08T09:23:08+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-08T09:23:11+01:00</updated-at>
      <user-id type="integer">33887</user-id>
      <version type="integer">7</version>
      <user-name>Jakub Suder</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>(from [981942a326d5cc3b7ae0639d1d8c793ae8010a74]) Backport ca3936d to 3-0-stable [#5274]
http://github.com/rails/rails/commit/981942a326d5cc3b7ae0639d1d8c793ae8010a74</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/981942a326d5cc3b7ae0639d1d8c793ae8010a74&quot;
title=
&quot;Changeset [981942a326d5cc3b7ae0639d1d8c793ae8010a74]&quot;&gt;[981942a326d5cc3b7ae0639d1d8c793ae8010a74]&lt;/a&gt;)
Backport ca3936d to 3-0-stable [&lt;a href=
&quot;/projects/8994/tickets/5274&quot; title=&quot;Ticket #5274&quot;&gt;#5274&lt;/a&gt;]
&lt;a href=
&quot;http://github.com/rails/rails/commit/981942a326d5cc3b7ae0639d1d8c793ae8010a74&quot;&gt;
http://github.com/rails/rails/commit/981942a326d5cc3b7ae0639d1d8c79...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-08T11:21:08+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-08T11:21:10+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">8</version>
      <user-name>Repository</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:02:00+01:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2010-10-15T23:02:00+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">9</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton watches&lt;/a&gt;&lt;/b&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;louis vuitton
watches&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-26T02:04:20+00:00</created-at>
      <creator-id type="integer">33887</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">5274</number>
      <permalink>better-error-messages-when-incorrect-regexp-is-passed-to-constraints-in-routes</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>constraints exception regexp routes</tag>
      <title>better error messages when incorrect regexp is passed to constraints in routes</title>
      <updated-at type="datetime">2011-03-26T02:20:55+00:00</updated-at>
      <user-id type="integer">142823</user-id>
      <version type="integer">10</version>
      <user-name>bingbing</user-name>
      <creator-name>Jakub Suder</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5274</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
