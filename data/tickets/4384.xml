<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">14998</assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-14T07:28:43+00:00</created-at>
  <creator-id type="integer">42916</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">4384</number>
  <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>active_record belongs_to primary_key</tag>
  <title>belongs_to with :primary_key fails to preload</title>
  <updated-at type="datetime">2011-02-14T07:28:43+00:00</updated-at>
  <user-id type="integer">111223</user-id>
  <version type="integer">15</version>
  <user-name>Jamison Wilde</user-name>
  <creator-name>Greg Hazel</creator-name>
  <assigned-user-name>Ryan Bigg</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
  <priority-name>Low</priority-name>
  <original-body>Using Rails 2.3.5

with something like this:

    class Foo &lt; ActiveRecord::Base
      belongs_to :bar, :foreign_key =&gt; 'some_id', :primary_key =&gt; 'guid'
    end

    create_table &quot;foos&quot;, :force =&gt; true do |t|
      t.string   &quot;some_id&quot;
    end

    create_table &quot;bars&quot;, :force =&gt; true do |t|
      t.string   &quot;guid&quot;,         :limit =&gt; 36,                  :null =&gt; false
    end


These queries are fine:
@@@ ruby
&gt;&gt; Foo.find(567158)
  Foo Load (0.1ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
=&gt; #&lt;Foo id: 567158, some_id: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
&gt;&gt; Foo.find(567158).bar
  Bar Load (0.4ms)   SELECT * FROM `bars` WHERE (`bars`.`guid` = '9917de13-99a5-45b9-a032-45d8c0ac4a81') LIMIT 1
=&gt; #&lt;Bar id: 3823066, guid: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
@@@

But this query fails:
@@@ ruby
&gt;&gt; Foo.find(567158, :include =&gt; bar)
  Foo Load (0.2ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
  Bar Load (0.1ms)   SELECT * FROM `bars` WHERE (`bars`.`id` = 9917)
NoMethodError: undefined method `each' for nil:NilClass
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:154:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:344:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `send'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:114:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:91:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1550:in `find_every'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1583:in `find_one'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1569:in `find_from_ids'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:616:in `find'
        from (irb):2
@@@

Notice that it's looking up by id=9917, which is the wrong column and the wrong value. You do get 9917 if you run '9917de13-99a5-45b9-a032-45d8c0ac4a81'.to_i, so the error here seems obvious.

I believe the bug is in preload_belongs_to_association where it uses &quot;primary_key&quot; which in this case is &quot;id&quot;, instead of reflection.options[:primary_key], which would be 'guid'.

This patch seems to work for me, but as I'm not familiar with the code I would not call it complete: http://pastie.org/917089

Edit: boy, the markup language on this ticket system is bad.</original-body>
  <latest-body>Using Rails 2.3.5

with something like this:

    class Foo &lt; ActiveRecord::Base
      belongs_to :bar, :foreign_key =&gt; 'some_id', :primary_key =&gt; 'guid'
    end

    create_table &quot;foos&quot;, :force =&gt; true do |t|
      t.string   &quot;some_id&quot;
    end

    create_table &quot;bars&quot;, :force =&gt; true do |t|
      t.string   &quot;guid&quot;,         :limit =&gt; 36,                  :null =&gt; false
    end


These queries are fine:
@@@ ruby
&gt;&gt; Foo.find(567158)
  Foo Load (0.1ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
=&gt; #&lt;Foo id: 567158, some_id: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
&gt;&gt; Foo.find(567158).bar
  Bar Load (0.4ms)   SELECT * FROM `bars` WHERE (`bars`.`guid` = '9917de13-99a5-45b9-a032-45d8c0ac4a81') LIMIT 1
=&gt; #&lt;Bar id: 3823066, guid: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
@@@

But this query fails:
@@@ ruby
&gt;&gt; Foo.find(567158, :include =&gt; bar)
  Foo Load (0.2ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
  Bar Load (0.1ms)   SELECT * FROM `bars` WHERE (`bars`.`id` = 9917)
NoMethodError: undefined method `each' for nil:NilClass
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:154:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:344:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `send'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:114:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:91:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1550:in `find_every'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1583:in `find_one'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1569:in `find_from_ids'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:616:in `find'
        from (irb):2
@@@

Notice that it's looking up by id=9917, which is the wrong column and the wrong value. You do get 9917 if you run '9917de13-99a5-45b9-a032-45d8c0ac4a81'.to_i, so the error here seems obvious.

I believe the bug is in preload_belongs_to_association where it uses &quot;primary_key&quot; which in this case is &quot;id&quot;, instead of reflection.options[:primary_key], which would be 'guid'.

This patch seems to work for me, but as I'm not familiar with the code I would not call it complete: http://pastie.org/917089

Edit: boy, the markup language on this ticket system is bad.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Using Rails 2.3.5&lt;/p&gt;
&lt;p&gt;with something like this:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Foo &amp;lt; ActiveRecord::Base
  belongs_to :bar, :foreign_key =&amp;gt; 'some_id', :primary_key =&amp;gt; 'guid'
end

create_table &quot;foos&quot;, :force =&amp;gt; true do |t|
  t.string   &quot;some_id&quot;
end

create_table &quot;bars&quot;, :force =&amp;gt; true do |t|
  t.string   &quot;guid&quot;,         :limit =&amp;gt; 36,                  :null =&amp;gt; false
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;These queries are fine:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Foo.find(567158)
  Foo Load (0.1ms)   SELECT * FROM &lt;/code&gt;foos WHERE (&lt;code&gt;foos&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 567158)
=&amp;gt; #&amp;lt;Foo id: 567158, some_id: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&amp;gt;
&amp;gt;&amp;gt; Foo.find(567158).bar
  Bar Load (0.4ms)   SELECT * FROM &lt;code&gt;bars&lt;/code&gt; WHERE (&lt;code&gt;bars&lt;/code&gt;.&lt;code&gt;guid&lt;/code&gt; = '9917de13-99a5-45b9-a032-45d8c0ac4a81') LIMIT 1
=&amp;gt; #&amp;lt;Bar id: 3823066, guid: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&amp;gt;
&lt;/pre&gt;
&lt;p&gt;But this query fails:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Foo.find(567158, :include =&amp;gt; bar)
  Foo Load (0.2ms)   SELECT * FROM &lt;/code&gt;foos WHERE (&lt;code&gt;foos&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 567158)
  Bar Load (0.1ms)   SELECT * FROM &lt;code&gt;bars&lt;/code&gt; WHERE (&lt;code&gt;bars&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 9917)
NoMethodError: undefined method &lt;code&gt;each' for nil:NilClass&lt;/code&gt;

&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:154:in `set_association_single_records'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `set_association_single_records'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:344:in `preload_belongs_to_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `preload_belongs_to_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `send'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `preload_one_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:114:in `preload_one_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:91:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1550:in `find_every'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1583:in `find_one'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1569:in `find_from_ids'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:616:in `find'
    from (irb):2&amp;lt;/code&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;


&lt;br&gt;
&lt;/pre&gt;
&lt;p&gt;Notice that it's looking up by id=9917, which is the wrong
column and the wrong value. You do get 9917 if you run
'9917de13-99a5-45b9-a032-45d8c0ac4a81'.to_i, so the error here
seems obvious.&lt;/p&gt;
&lt;p&gt;I believe the bug is in preload_belongs_to_association where it
uses &quot;primary_key&quot; which in this case is &quot;id&quot;, instead of
reflection.options[:primary_key], which would be 'guid'.&lt;/p&gt;
&lt;p&gt;This patch seems to work for me, but as I'm not familiar with
the code I would not call it complete: &lt;a href=
&quot;http://pastie.org/917089&quot;&gt;http://pastie.org/917089&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Edit: boy, the markup language on this ticket system is bad.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Using Rails 2.3.5

with something like this:

    class Foo &lt; ActiveRecord::Base
      belongs_to :bar, :foreign_key =&gt; 'some_id', :primary_key =&gt; 'guid'
    end

    create_table &quot;foos&quot;, :force =&gt; true do |t|
      t.string   &quot;some_id&quot;
    end

    create_table &quot;bars&quot;, :force =&gt; true do |t|
      t.string   &quot;guid&quot;,         :limit =&gt; 36,                  :null =&gt; false
    end


These queries are fine:
@@@ ruby
&gt;&gt; Foo.find(567158)
  Foo Load (0.1ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
=&gt; #&lt;Foo id: 567158, some_id: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
&gt;&gt; Foo.find(567158).bar
  Bar Load (0.4ms)   SELECT * FROM `bars` WHERE (`bars`.`guid` = '9917de13-99a5-45b9-a032-45d8c0ac4a81') LIMIT 1
=&gt; #&lt;Bar id: 3823066, guid: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&gt;
@@@

But this query fails:
@@@ ruby
&gt;&gt; Foo.find(567158, :include =&gt; bar)
  Foo Load (0.2ms)   SELECT * FROM `foos` WHERE (`foos`.`id` = 567158)
  Bar Load (0.1ms)   SELECT * FROM `bars` WHERE (`bars`.`id` = 9917)
NoMethodError: undefined method `each' for nil:NilClass
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:154:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `set_association_single_records'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:344:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `preload_belongs_to_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `send'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:114:in `preload_one_association'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:91:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `each'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1550:in `find_every'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1583:in `find_one'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1569:in `find_from_ids'
        from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:616:in `find'
        from (irb):2
@@@

Notice that it's looking up by id=9917, which is the wrong column and the wrong value. You do get 9917 if you run '9917de13-99a5-45b9-a032-45d8c0ac4a81'.to_i, so the error here seems obvious.

I believe the bug is in preload_belongs_to_association where it uses &quot;primary_key&quot; which in this case is &quot;id&quot;, instead of reflection.options[:primary_key], which would be 'guid'.

This patch seems to work for me, but as I'm not familiar with the code I would not call it complete: http://pastie.org/917089

Edit: boy, the markup language on this ticket system is bad.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Using Rails 2.3.5&lt;/p&gt;
&lt;p&gt;with something like this:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Foo &amp;lt; ActiveRecord::Base
  belongs_to :bar, :foreign_key =&amp;gt; 'some_id', :primary_key =&amp;gt; 'guid'
end

create_table &quot;foos&quot;, :force =&amp;gt; true do |t|
  t.string   &quot;some_id&quot;
end

create_table &quot;bars&quot;, :force =&amp;gt; true do |t|
  t.string   &quot;guid&quot;,         :limit =&amp;gt; 36,                  :null =&amp;gt; false
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;These queries are fine:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Foo.find(567158)
  Foo Load (0.1ms)   SELECT * FROM &lt;/code&gt;foos WHERE (&lt;code&gt;foos&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 567158)
=&amp;gt; #&amp;lt;Foo id: 567158, some_id: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&amp;gt;
&amp;gt;&amp;gt; Foo.find(567158).bar
  Bar Load (0.4ms)   SELECT * FROM &lt;code&gt;bars&lt;/code&gt; WHERE (&lt;code&gt;bars&lt;/code&gt;.&lt;code&gt;guid&lt;/code&gt; = '9917de13-99a5-45b9-a032-45d8c0ac4a81') LIMIT 1
=&amp;gt; #&amp;lt;Bar id: 3823066, guid: &quot;9917de13-99a5-45b9-a032-45d8c0ac4a81&quot;&amp;gt;
&lt;/pre&gt;
&lt;p&gt;But this query fails:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;&amp;gt;&amp;gt; Foo.find(567158, :include =&amp;gt; bar)
  Foo Load (0.2ms)   SELECT * FROM &lt;/code&gt;foos WHERE (&lt;code&gt;foos&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 567158)
  Bar Load (0.1ms)   SELECT * FROM &lt;code&gt;bars&lt;/code&gt; WHERE (&lt;code&gt;bars&lt;/code&gt;.&lt;code&gt;id&lt;/code&gt; = 9917)
NoMethodError: undefined method &lt;code&gt;each' for nil:NilClass&lt;/code&gt;

&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:154:in `set_association_single_records'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:147:in `set_association_single_records'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:344:in `preload_belongs_to_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:318:in `preload_belongs_to_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `send'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:120:in `preload_one_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activesupport-2.3.5/lib/active_support/ordered_hash.rb:97:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:114:in `preload_one_association'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:91:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `each'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/association_preload.rb:90:in `preload_associations'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1550:in `find_every'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1583:in `find_one'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:1569:in `find_from_ids'
    from /usr/local/ruby/lib/ruby/gems/1.8/gems/activerecord-2.3.5/lib/active_record/base.rb:616:in `find'
    from (irb):2&amp;lt;/code&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;


&lt;br&gt;
&lt;/pre&gt;
&lt;p&gt;Notice that it's looking up by id=9917, which is the wrong
column and the wrong value. You do get 9917 if you run
'9917de13-99a5-45b9-a032-45d8c0ac4a81'.to_i, so the error here
seems obvious.&lt;/p&gt;
&lt;p&gt;I believe the bug is in preload_belongs_to_association where it
uses &quot;primary_key&quot; which in this case is &quot;id&quot;, instead of
reflection.options[:primary_key], which would be 'guid'.&lt;/p&gt;
&lt;p&gt;This patch seems to work for me, but as I'm not familiar with
the code I would not call it complete: &lt;a href=
&quot;http://pastie.org/917089&quot;&gt;http://pastie.org/917089&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Edit: boy, the markup language on this ticket system is bad.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-13T08:46:47+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with non-integer :foreign_key fails to preload</title>
      <updated-at type="datetime">2010-04-15T22:55:59+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">1</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Rails is not supposed to support foreign key columns of other types than integer. This ticket can be marked as invalid.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Rails is not supposed to support foreign key columns of other
types than integer. This ticket can be marked as invalid.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-15T20:09:13+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with non-integer :foreign_key fails to preload</title>
      <updated-at type="datetime">2010-04-15T20:09:14+01:00</updated-at>
      <user-id type="integer">65050</user-id>
      <version type="integer">2</version>
      <user-name>David Trasbo</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I agree, this seems like an edge-case better suited to a plugin.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree, this seems like an edge-case better suited to a
plugin.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-15T22:57:16+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with non-integer :foreign_key fails to preload</title>
      <updated-at type="datetime">2010-04-15T22:57:19+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">3</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>What? This would also be broken if the key were an integer.</body>
      <body-html>&lt;div&gt;&lt;p&gt;What? This would also be broken if the key were an integer.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-16T00:31:22+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with non-integer :foreign_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T00:31:24+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">4</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Leaving it open for discussion. OP has indicated he does not want to submit a patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Leaving it open for discussion. OP has indicated he does not
want to submit a patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T00:47:54+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:state: wontfix
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with non-integer :foreign_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T00:47:55+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">5</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T10:53:28+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:title: belongs_to with non-integer :foreign_key fails to preload
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T10:53:31+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">6</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Looks like this was fixed recently:

http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737</body>
      <body-html>&lt;div&gt;&lt;p&gt;Looks like this was fixed recently:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737&quot;&gt;
http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b8...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T11:13:29+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T11:13:31+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">7</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>And, guys, if &quot;Rails is not supposed to support foreign key columns of other types than integer&quot;, why are they used in the ActiveRecord unit tests themselves?

@@@ ruby
class Reply &lt; Topic
  ...
  belongs_to :topic_with_primary_key, :class_name =&gt; &quot;Topic&quot;, :primary_key =&gt; &quot;title&quot;, :foreign_key =&gt; &quot;parent_title&quot;, :counter_cache =&gt; &quot;replies_count&quot;
  ...
end

...

create_table :topics, :force =&gt; true do |t|
  t.string   :title
  ...
  t.string   :parent_title
  ...
end
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;And, guys, if &quot;Rails is not supposed to support foreign key
columns of other types than integer&quot;, why are they used in the
ActiveRecord unit tests themselves?&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;class Reply &amp;lt; Topic
  ...
  belongs_to :topic_with_primary_key, :class_name =&amp;gt; &quot;Topic&quot;, :primary_key =&amp;gt; &quot;title&quot;, :foreign_key =&amp;gt; &quot;parent_title&quot;, :counter_cache =&amp;gt; &quot;replies_count&quot;
  ...
end

...

create_table :topics, :force =&amp;gt; true do |t|
  t.string   :title
  ...
  t.string   :parent_title
  ...
end&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T11:17:26+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T11:17:28+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">8</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I did a little test on 2.3.5 with the `Foo` and `Bar` models you described (I only changed the `some_id` and `guid` fields to be integers). I'm not getting any `NilClass` errors, it seems to work perfectly:

@@@
&gt;&gt; Foo.find(2)
=&gt; #&lt;Foo id: 2, some_id: 123, created_at: &quot;2010-04-16 10:18:32&quot;, updated_at: &quot;2010-04-16 10:18:32&quot;&gt;
&gt;&gt; Foo.find(2).bar
=&gt; #&lt;Bar id: 1, guid: 123, created_at: &quot;2010-04-16 10:19:58&quot;, updated_at: &quot;2010-04-16 10:19:58&quot;&gt;
&gt;&gt; Foo.find(2, :include =&gt; :bar)
=&gt; #&lt;Foo id: 2, some_id: 123, created_at: &quot;2010-04-16 10:18:32&quot;, updated_at: &quot;2010-04-16 10:18:32&quot;&gt;
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;I did a little test on 2.3.5 with the &lt;code&gt;Foo&lt;/code&gt; and
&lt;code&gt;Bar&lt;/code&gt; models you described (I only changed the
&lt;code&gt;some_id&lt;/code&gt; and &lt;code&gt;guid&lt;/code&gt; fields to be integers).
I'm not getting any &lt;code&gt;NilClass&lt;/code&gt; errors, it seems to work
perfectly:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;gt;&amp;gt; Foo.find(2)
=&amp;gt; #&amp;lt;Foo id: 2, some_id: 123, created_at: &quot;2010-04-16 10:18:32&quot;, updated_at: &quot;2010-04-16 10:18:32&quot;&amp;gt;
&amp;gt;&amp;gt; Foo.find(2).bar
=&amp;gt; #&amp;lt;Bar id: 1, guid: 123, created_at: &quot;2010-04-16 10:19:58&quot;, updated_at: &quot;2010-04-16 10:19:58&quot;&amp;gt;
&amp;gt;&amp;gt; Foo.find(2, :include =&amp;gt; :bar)
=&amp;gt; #&amp;lt;Foo id: 2, some_id: 123, created_at: &quot;2010-04-16 10:18:32&quot;, updated_at: &quot;2010-04-16 10:18:32&quot;&amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T11:26:47+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T11:26:48+01:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">9</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Jeff: Is id the primary_key for Bar? Can you show the sql queries it is submitting? According to line 324 and 335 of associtation_preload.rb in Rails 2.3.5 it should be submitting:

primary_key = klass.primary_key

&quot;#{table_name}.#{connection.quote_column_name(primary_key)} #{in_or_equals_for_ids(ids)}&quot;

which in your case would be:

Bar.id = 123


So, I'm not sure why you can't reproduce it exactly, but the bug certainly existed for integer columns, and was fixed by http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737</body>
      <body-html>&lt;div&gt;&lt;p&gt;Jeff: Is id the primary_key for Bar? Can you show the sql
queries it is submitting? According to line 324 and 335 of
associtation_preload.rb in Rails 2.3.5 it should be submitting:&lt;/p&gt;
&lt;p&gt;primary_key = klass.primary_key&lt;/p&gt;
&lt;p&gt;&quot;#{table_name}.#{connection.quote_column_name(primary_key)}
#{in_or_equals_for_ids(ids)}&quot;&lt;/p&gt;
&lt;p&gt;which in your case would be:&lt;/p&gt;
&lt;p&gt;Bar.id = 123&lt;/p&gt;
&lt;p&gt;So, I'm not sure why you can't reproduce it exactly, but the bug
certainly existed for integer columns, and was fixed by &lt;a href=
&quot;http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737&quot;&gt;
http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b8...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T11:36:16+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T11:36:17+01:00</updated-at>
      <user-id type="integer">42916</user-id>
      <version type="integer">10</version>
      <user-name>Greg Hazel</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>`Foo`:

@@@
class Foo &lt; ActiveRecord::Base
  belongs_to :bar, :foreign_key =&gt; 'some_id', :primary_key =&gt; 'guid'
end
@@@

`FoosController`:

@@@
class FoosController &lt; ApplicationController
  def index
    @foo = Foo.find(1, :include =&gt; :bar)
  end
end
@@@

`foos/index.html.erb`:

@@@
&lt;%= @foo.bar.to_yaml %&gt;
@@@

queries:

@@@
Processing FoosController#index (for 127.0.0.1 at 2010-04-16 12:50:15) [GET]
  Foo Load (0.2ms)   SELECT * FROM &quot;foos&quot; WHERE (&quot;foos&quot;.&quot;id&quot; = 1) 
  Bar Load (0.2ms)   SELECT * FROM &quot;bars&quot; WHERE (&quot;bars&quot;.&quot;id&quot; = 123) 
Rendering foos/index
  Bar Load (0.3ms)   SELECT * FROM &quot;bars&quot; WHERE (&quot;bars&quot;.&quot;guid&quot; = 123) LIMIT 1
Completed in 16ms (View: 4, DB: 1) | 200 OK [http://localhost/foos]
@@@

So I think you're right. It's not properly preloading in 2.3.5 when using integers if you ask me...</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;code&gt;Foo&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class Foo &amp;lt; ActiveRecord::Base
  belongs_to :bar, :foreign_key =&amp;gt; 'some_id', :primary_key =&amp;gt; 'guid'
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;FoosController&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class FoosController &amp;lt; ApplicationController
  def index
    @foo = Foo.find(1, :include =&amp;gt; :bar)
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;foos/index.html.erb&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;%= @foo.bar.to_yaml %&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;queries:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Processing FoosController#index (for 127.0.0.1 at 2010-04-16 12:50:15) [GET]
  Foo Load (0.2ms)   SELECT * FROM &quot;foos&quot; WHERE (&quot;foos&quot;.&quot;id&quot; = 1) 
  Bar Load (0.2ms)   SELECT * FROM &quot;bars&quot; WHERE (&quot;bars&quot;.&quot;id&quot; = 123) 
Rendering foos/index
  Bar Load (0.3ms)   SELECT * FROM &quot;bars&quot; WHERE (&quot;bars&quot;.&quot;guid&quot; = 123) LIMIT 1
Completed in 16ms (View: 4, DB: 1) | 200 OK [http://localhost/foos]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So I think you're right. It's not properly preloading in 2.3.5
when using integers if you ask me...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T11:58:49+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T11:58:51+01:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">11</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Damn, missed the link. Like Greg said: fixed by http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Damn, missed the link. Like Greg said: fixed by &lt;a href=
&quot;http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b89d1e437737&quot;&gt;
http://github.com/rails/rails/commit/63026541b209cc11ffd74cf3ca04b8...&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-04-16T12:14:45+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-16T12:14:48+01:00</updated-at>
      <user-id type="integer">94458</user-id>
      <version type="integer">12</version>
      <user-name>Jeff Kreeftmeijer</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-04-19T22:14:42+01:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-04-19T22:14:44+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">13</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>There is a additional bug exposed with this fix, in that if you use intern'd column names as your primary key, the comparison then fails.

:primary_key =&gt; :my_column fails while :primary_key =&gt; 'my_column' succeeds.

The patch is to use to_s:
options[:primary_key].to_s

Obviously the workaround is to not use intern'd column names.

Putting this here since this is the first place people will find in a search engine presumably.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There is a additional bug exposed with this fix, in that if you
use intern'd column names as your primary key, the comparison then
fails.&lt;/p&gt;
&lt;p&gt;:primary_key =&amp;gt; :my_column fails while :primary_key =&amp;gt;
'my_column' succeeds.&lt;/p&gt;
&lt;p&gt;The patch is to use to_s:&lt;br&gt;
options[:primary_key].to_s&lt;/p&gt;
&lt;p&gt;Obviously the workaround is to not use intern'd column
names.&lt;/p&gt;
&lt;p&gt;Putting this here since this is the first place people will find
in a search engine presumably.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-12T22:40:27+00:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-11-12T22:40:30+00:00</updated-at>
      <user-id type="integer">111223</user-id>
      <version type="integer">14</version>
      <user-name>Jamison Wilde</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Also, some more background:
This fails silently in Ruby 1.8.

In Ruby 1.9 it fails loudly with:

NoMethodError: undefined method `type' for nil:NilClass
	from /home/slain/.rvm/gems/ruby-1.9.2-p0/gems/activesupport-2.3.8/lib/active_support/whiny_nil.rb:52:in `method_missing'

Since the columns.detect fails and Ruby 1.9 no longer supports type as a method on NilClass.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Also, some more background:&lt;br&gt;
This fails silently in Ruby 1.8.&lt;/p&gt;
&lt;p&gt;In Ruby 1.9 it fails loudly with:&lt;/p&gt;
&lt;p&gt;NoMethodError: undefined method &lt;code&gt;type' for
nil:NilClass&amp;lt;br/&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;from /home/slain/.rvm/gems/ruby-1.9.2-p0/gems/activesupport-2.3.8/lib/active_support/whiny_nil.rb:52:in `method_missing'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Since the columns.detect fails and Ruby 1.9 no longer supports
type as a method on NilClass.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-12T23:09:11+00:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2010-11-12T23:09:13+00:00</updated-at>
      <user-id type="integer">111223</user-id>
      <version type="integer">15</version>
      <user-name>Jamison Wilde</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>thank you very much......&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/&quot;&gt;&#1605;&#1606;&#1578;&#1583;&#1610;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&#1605;&#1603;&#1610;&#1575;&#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1575;&#1586;&#1610;&#1575;&#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&#1601;&#1587;&#1575;&#1578;&#1610;&#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&#1585;&#1587;&#1575;&#1574;&#1604; 
- &#1605;&#1587;&#1580;&#1575;&#1578; - &#1608;&#1587;&#1575;&#1574;&#1591;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&#1578;&#1608;&#1576;&#1610;&#1603;&#1575;&#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&#1608;&#1592;&#1575;&#1574;&#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&#1576;&#1585;&#1608;&#1603;&#1587;&#1610;&lt;/a&gt; &lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt;&lt;a href=&quot;http://forum.line-sport.tv/&quot;&gt;&#1604;&#1575;&#1610;&#1606; &#1587;&#1576;&#1608;&#1585;&#1578;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;thank you very much......&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/&quot;&gt;&amp;#1605;&amp;#1606;&amp;#1578;&amp;#1583;&amp;#1610;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f86.html&quot;&gt;&amp;#1605;&amp;#1603;&amp;#1610;&amp;#1575;&amp;#1580;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1575;&amp;#1586;&amp;#1610;&amp;#1575;&amp;#1569;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f84.html&quot;&gt;&amp;#1601;&amp;#1587;&amp;#1575;&amp;#1578;&amp;#1610;&amp;#1606;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f17.html&quot;&gt;&amp;#1585;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1604;&lt;br&gt;
- &amp;#1605;&amp;#1587;&amp;#1580;&amp;#1575;&amp;#1578; -
&amp;#1608;&amp;#1587;&amp;#1575;&amp;#1574;&amp;#1591;&lt;/a&gt;&lt;span class=
&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=
&quot;http://www.tran33m.com/vb/f18.html&quot;&gt;&amp;#1578;&amp;#1608;&amp;#1576;&amp;#1610;&amp;#1603;&amp;#1575;&amp;#1578;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;&amp;#1608;&amp;#1592;&amp;#1575;&amp;#1574;&amp;#1601;&lt;/a&gt;&lt;span class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a href=&quot;http://www.tran33m.com/vb/f76.html&quot;&gt;jobs&lt;/a&gt;
&lt;a href=
&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;&amp;#1576;&amp;#1585;&amp;#1608;&amp;#1603;&amp;#1587;&amp;#1610;&lt;/a&gt;
&lt;a href=&quot;http://www.tran33m.com/vb/t31874.html&quot;&gt;proxy&lt;/a&gt;&lt;a href=
&quot;http://forum.line-sport.tv/&quot;&gt;&amp;#1604;&amp;#1575;&amp;#1610;&amp;#1606;
&amp;#1587;&amp;#1576;&amp;#1608;&amp;#1585;&amp;#1578;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-08T11:12:37+00:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2011-02-08T12:16:00+00:00</updated-at>
      <user-id type="integer">136126</user-id>
      <version type="integer">16</version>
      <user-name>alasiri1</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">14998</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You possibly can buy beauty drops you can aquire with many different patterns similar to the triangular as well as rectangle-shaped varieties.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; To help while recognize touch available practically expression along with damaged in almost any necklace around your neck.&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&#160;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; Just in case alphabets will never get that promotion using a man, &lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;use those who obtain out of all kinds of other communities as an example food including cakes,&lt;strong&gt;&lt;a href=&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; crops and so forth</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;You
possibly can buy beauty drops you can aquire with many different
patterns similar to the triangular as well as rectangle-shaped
varieties.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-bracelets-c-3.html&quot;&gt;&lt;em&gt;Pandoras
Bracelets&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; To help while recognize touch available
practically expression along with damaged in almost any necklace
around your neck.&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/pandora-charms-c-9.html&quot;&gt;&lt;em&gt;Pandora&amp;nbsp;Charms&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;
Just in case alphabets will never get that promotion using a man,
&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;pandora
ireland&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt;use those who obtain out of all kinds of
other communities as an example food including
cakes,&lt;strong&gt;&lt;a href=
&quot;http://www.onlinepandorajewellery.com/&quot;&gt;&lt;em&gt;Pandora
NZ&lt;/em&gt;&lt;/a&gt;&lt;/strong&gt; crops and so forth&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-14T06:15:06+00:00</created-at>
      <creator-id type="integer">42916</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4384</number>
      <permalink>belongs_to-with-non-integer-foreign_key-fails-to-preload</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>active_record belongs_to primary_key</tag>
      <title>belongs_to with :primary_key fails to preload</title>
      <updated-at type="datetime">2011-02-14T07:28:43+00:00</updated-at>
      <user-id type="integer">136876</user-id>
      <version type="integer">17</version>
      <user-name>pandora jewellry</user-name>
      <creator-name>Greg Hazel</creator-name>
      <assigned-user-name>Ryan Bigg</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4384</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
</ticket>
