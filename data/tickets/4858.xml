<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">12714</assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2010-11-08T23:12:12+00:00</created-at>
  <creator-id type="integer">36009</creator-id>
  <milestone-due-on type="datetime">2011-03-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">103410</milestone-id>
  <number type="integer">4858</number>
  <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>open</state>
  <tag>actionview escaping formats html_safe safe_buffer xss</tag>
  <title>[PATCH] ActionMailer is html escaping plain text messages</title>
  <updated-at type="datetime">2011-04-29T08:16:42+01:00</updated-at>
  <user-id type="integer">8551</user-id>
  <version type="integer">34</version>
  <user-name>Fjan</user-name>
  <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
  <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
  <milestone-title>3.0.6</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>A view views/mailer/message.text.erb with this content:

http://ab.cd/e?f=1&amp;g=2 (read an ampersand only, cause LightHouse will mess with it)

is sent as a plain text message with this link:

http://ab.cd/e?f=1&amp;amp;g=2</original-body>
  <latest-body>A view views/mailer/message.text.erb with this content:

http://ab.cd/e?f=1&amp;g=2 (read an ampersand only, cause LightHouse will mess with it)

is sent as a plain text message with this link:

http://ab.cd/e?f=1&amp;amp;g=2</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;A view views/mailer/message.text.erb with this content:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://ab.cd/e?f=1&amp;amp;g=2&quot;&gt;http://ab.cd/e?f=1&amp;amp;amp;g=2&lt;/a&gt;
(read an ampersand only, cause LightHouse will mess with it)&lt;/p&gt;
&lt;p&gt;is sent as a plain text message with this link:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://ab.cd/e?f=1&amp;amp;g=2&quot;&gt;http://ab.cd/e?f=1&amp;amp;amp;g=2&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>A view views/mailer/message.text.erb with this content:

http://ab.cd/e?f=1&amp;g=2 (read an ampersand only, cause LightHouse will mess with it)

is sent as a plain text message with this link:

http://ab.cd/e?f=1&amp;amp;g=2</body>
      <body-html>&lt;div&gt;&lt;p&gt;A view views/mailer/message.text.erb with this content:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://ab.cd/e?f=1&amp;amp;g=2&quot;&gt;http://ab.cd/e?f=1&amp;amp;amp;g=2&lt;/a&gt;
(read an ampersand only, cause LightHouse will mess with it)&lt;/p&gt;
&lt;p&gt;is sent as a plain text message with this link:&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://ab.cd/e?f=1&amp;amp;g=2&quot;&gt;http://ab.cd/e?f=1&amp;amp;amp;g=2&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-14T13:17:37+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-06-14T13:17:39+01:00</updated-at>
      <user-id type="integer">36009</user-id>
      <version type="integer">1</version>
      <user-name>Rodrigo Rosenfeld Rosas</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is probably as a result of unifying the AM and AC use of AV,  it's a regression and should be fixed before 3.0</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is probably as a result of unifying the AM and AC use of
AV, it's a regression and should be fixed before 3.0&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-14T21:17:12+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
:milestone: 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-06-14T21:17:21+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I can't reproduce this issue with the latest. Can I get an example so I can tackle this.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I can't reproduce this issue with the latest. Can I get an
example so I can tackle this.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-15T03:41:25+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-06-15T03:41:31+01:00</updated-at>
      <user-id type="integer">21653</user-id>
      <version type="integer">3</version>
      <user-name>Amos King</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've just found the root cause. url_for is not marking the url as html_safe and the ERB template used by the plain text templating is sanitizing the text by default as the other ERB templates.

This mean that now the plain text ERB template should be something like:

Please, visit &lt;%= raw @confirmation_url %&gt;

I think plain text templates should not be sanitized in favor of the least surprise principle...

What do you think?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've just found the root cause. url_for is not marking the url
as html_safe and the ERB template used by the plain text templating
is sanitizing the text by default as the other ERB templates.&lt;/p&gt;
&lt;p&gt;This mean that now the plain text ERB template should be
something like:&lt;/p&gt;
&lt;p&gt;Please, visit &amp;lt;%= raw @confirmation_url %&amp;gt;&lt;/p&gt;
&lt;p&gt;I think plain text templates should not be sanitized in favor of
the least surprise principle...&lt;/p&gt;
&lt;p&gt;What do you think?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-15T03:57:26+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-06-15T03:57:31+01:00</updated-at>
      <user-id type="integer">36009</user-id>
      <version type="integer">4</version>
      <user-name>Rodrigo Rosenfeld Rosas</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>on chain &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com/products/tag-heuer-wab2011-ba0803-replica-644.html&quot;&gt;Aquaracer 2000 Mens WAB2011.BA0803-1582&lt;/a&gt;&lt;/b&gt; international criminals that worth &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega brand&lt;/a&gt;&lt;/b&gt; the illegally acquired bankroll &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com/products/longines-l5-158-4-76-6-replica-2217.html&quot;&gt;Dolce Vita Ladies L5.158.4.76.6-2999&lt;/a&gt;&lt;/b&gt; to important inhumane activities &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com/products/tag-heuer-watch-replica-551.html&quot;&gt;Classic 16 mens-1494&lt;/a&gt;&lt;/b&gt; revel in disturbance besides &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com/products/rolex-16234j-replica-3626.html&quot;&gt;Oyster Perpetual Datejust Two-Tone 18kt Yellow Gold and Steel Mens 16234J-58&lt;/a&gt;&lt;/b&gt; drug trafficking. This object &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega replica&lt;/a&gt;&lt;/b&gt; is witting to educate &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega&lt;/a&gt;&lt;/b&gt; an powwow that has &lt;b&gt;&lt;a href=&quot;http://www.discountwatchmvp.com/categories/vacheron-constantin.html&quot;&gt;replica Vacheron Constantin&lt;/a&gt;&lt;/b&gt; the markedly manage in &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com/products/glashutte-698-replica-3353.html&quot;&gt;Mens Black Strap 698-4020&lt;/a&gt;&lt;/b&gt; that stopping this assumed &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega man&lt;/a&gt;&lt;/b&gt; movement. The bogus purses that are bough</body>
      <body-html>&lt;div&gt;&lt;p&gt;on chain &lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com/products/tag-heuer-wab2011-ba0803-replica-644.html&quot;&gt;
Aquaracer 2000 Mens WAB2011.BA0803-1582&lt;/a&gt;&lt;/b&gt; international
criminals that worth &lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com&quot;&gt;omega brand&lt;/a&gt;&lt;/b&gt; the illegally
acquired bankroll &lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com/products/longines-l5-158-4-76-6-replica-2217.html&quot;&gt;
Dolce Vita Ladies L5.158.4.76.6-2999&lt;/a&gt;&lt;/b&gt; to important inhumane
activities &lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com/products/tag-heuer-watch-replica-551.html&quot;&gt;
Classic 16 mens-1494&lt;/a&gt;&lt;/b&gt; revel in disturbance besides
&lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com/products/rolex-16234j-replica-3626.html&quot;&gt;
Oyster Perpetual Datejust Two-Tone 18kt Yellow Gold and Steel Mens
16234J-58&lt;/a&gt;&lt;/b&gt; drug trafficking. This object &lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com&quot;&gt;omega replica&lt;/a&gt;&lt;/b&gt; is witting to
educate &lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega&lt;/a&gt;&lt;/b&gt; an
powwow that has &lt;b&gt;&lt;a href=
&quot;http://www.discountwatchmvp.com/categories/vacheron-constantin.html&quot;&gt;
replica Vacheron Constantin&lt;/a&gt;&lt;/b&gt; the markedly manage in
&lt;b&gt;&lt;a href=
&quot;http://www.brandwatchmvp.com/products/glashutte-698-replica-3353.html&quot;&gt;
Mens Black Strap 698-4020&lt;/a&gt;&lt;/b&gt; that stopping this assumed
&lt;b&gt;&lt;a href=&quot;http://www.brandwatchmvp.com&quot;&gt;omega man&lt;/a&gt;&lt;/b&gt;
movement. The bogus purses that are bough&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-07-19T11:05:36+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-07-19T11:06:23+01:00</updated-at>
      <user-id type="integer">107783</user-id>
      <version type="integer">5</version>
      <user-name>LYN</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I also got stuck on this problem.

&gt; I think plain text templates should not be sanitized in favor of the least surprise principle...
&gt; What do you think?

+1. Plain text template should better not be html_escaped.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I also got stuck on this problem.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I think plain text templates should not be sanitized in favor of
the least surprise principle... What do you think?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Plain text template should better not be html_escaped.&lt;/li&gt;
&lt;/ol&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-23T08:00:17+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-08-23T08:00:20+01:00</updated-at>
      <user-id type="integer">17407</user-id>
      <version type="integer">6</version>
      <user-name>Akira Matsuda</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sorry, I meant, +1</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry, I meant, +1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-23T08:01:13+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-08-23T08:01:16+01:00</updated-at>
      <user-id type="integer">17407</user-id>
      <version type="integer">7</version>
      <user-name>Akira Matsuda</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:33+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-08-30T04:10:33+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">15159</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-01T02:00:10+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:priority: 0
:assigned_user: 12714
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-09-01T02:00:14+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">9</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Mikel Lindsaar</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is not related to the mail gem, but the ActionView bit. Assigning it back to Mr. Katz.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is not related to the mail gem, but the ActionView bit.
Assigning it back to Mr. Katz.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-01T23:11:52+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 15159
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-09-01T23:11:58+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">10</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've had to use `raw` in a few places in my non-HTML templates for this reason.

It's not limited to templates with the `.text.erb` extension. I've also had to do it in `.js.erb` templates. I imagine that if I had other non-HTML ERB templates it would behave the same way too.

No idea if this is limited to ERB, seeing as the only other template format I use is Haml, which is obviously always producing HTML output only.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've had to use &lt;code&gt;raw&lt;/code&gt; in a few places in my non-HTML
templates for this reason.&lt;/p&gt;
&lt;p&gt;It's not limited to templates with the &lt;code&gt;.text.erb&lt;/code&gt;
extension. I've also had to do it in &lt;code&gt;.js.erb&lt;/code&gt;
templates. I imagine that if I had other non-HTML ERB templates it
would behave the same way too.&lt;/p&gt;
&lt;p&gt;No idea if this is limited to ERB, seeing as the only other
template format I use is Haml, which is obviously always producing
HTML output only.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-04T14:07:37+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-09-04T14:07:41+01:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">11</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:56+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>regression</tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">12</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T08:34:58+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: regression
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-10-19T08:35:06+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">14</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I just wanted to point out that the it's not just URLs and not just ampersands: any text gets HTML escaped. This is going to trip people up who accidentally use &lt; and &gt; characters in an e-mail address for example. My plain text e-mail templates are now littered with .html_safe everywhere to prevent this.

As far as I can tell from the code this is going to be pretty hard to fix without ruining the nice unification of the mailer views with the regular views we just had. My suggestion is to define a new erb character sequence such as &lt;%== to mean a &quot;raw concat&quot;. That will beatify the code a little and make sure that we can upgrade old templates with a simple search/replace, mailer or regular view.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I just wanted to point out that the it's not just URLs and not
just ampersands: any text gets HTML escaped. This is going to trip
people up who accidentally use &amp;lt; and &amp;gt; characters in an
e-mail address for example. My plain text e-mail templates are now
littered with .html_safe everywhere to prevent this.&lt;/p&gt;
&lt;p&gt;As far as I can tell from the code this is going to be pretty
hard to fix without ruining the nice unification of the mailer
views with the regular views we just had. My suggestion is to
define a new erb character sequence such as &amp;lt;%== to mean a &quot;raw
concat&quot;. That will beatify the code a little and make sure that we
can upgrade old templates with a simple search/replace, mailer or
regular view.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T19:08:39+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-11-03T19:08:42+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">15</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Just a quick follow up to myself, I looked at the code and all that is needed to make &quot;&lt;%== ...&quot; behave as &quot;&lt;%= raw ...&quot;  is this snippet in an initializer:

    module ActionView
      class Template
        module Handlers
          class Erubis &lt; ::Erubis::Eruby
            def add_expr_escaped(src, code)
              src &lt;&lt; &quot;@output_buffer.safe_concat(&quot; &lt;&lt; escape_text(code.html_safe) &lt;&lt; &quot;);&quot;
            end
          end
        end
      end
    end

It can be made more efficient by adding to the string directly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Just a quick follow up to myself, I looked at the code and all
that is needed to make &quot;&amp;lt;%== ...&quot; behave as &quot;&amp;lt;%= raw ...&quot; is
this snippet in an initializer:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;module ActionView
  class Template
    module Handlers
      class Erubis &amp;lt; ::Erubis::Eruby
        def add_expr_escaped(src, code)
          src &amp;lt;&amp;lt; &quot;@output_buffer.safe_concat(&quot; &amp;lt;&amp;lt; escape_text(code.html_safe) &amp;lt;&amp;lt; &quot;);&quot;
        end
      end
    end
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;It can be made more efficient by adding to the string
directly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T20:51:04+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-11-03T20:51:08+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">16</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I think adding new syntax is a non-solution to this problem which just wall-papers over the underlying issue.

The fact is that it doesn't make sense to HTML-escape content which is not HTML.

Merely adding a short-cut syntax for avoiding the undesired escaping is just giving us a more concise means of doing something that we shouldn't have to do in the first place, and IMO it would be worse than just ignoring the problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think adding new syntax is a non-solution to this problem
which just wall-papers over the underlying issue.&lt;/p&gt;
&lt;p&gt;The fact is that it doesn't make sense to HTML-escape content
which is not HTML.&lt;/p&gt;
&lt;p&gt;Merely adding a short-cut syntax for avoiding the undesired
escaping is just giving us a more concise means of doing something
that we shouldn't have to do in the first place, and IMO it would
be worse than just ignoring the problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T20:57:14+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-11-03T20:57:25+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">17</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I agree a proper fix where plain text templates do net get escaped would be better.

However, I still like that new syntax for the regular views. I just did a quick count for &quot;html_safe&quot; and I came up with 390 in my views and helpers. So it would sure save a lot of typing and it can also make the templates more efficient by not converting to an output_buffer and back to a string (as I did above).

I simply like to use some like without all the html_safe stuff:
    &lt;%= &quot;&lt;b&gt;Alert&lt;/b&gt;&quot;.html_safe if level&lt;0 %&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree a proper fix where plain text templates do net get
escaped would be better.&lt;/p&gt;
&lt;p&gt;However, I still like that new syntax for the regular views. I
just did a quick count for &quot;html_safe&quot; and I came up with 390 in my
views and helpers. So it would sure save a lot of typing and it can
also make the templates more efficient by not converting to an
output_buffer and back to a string (as I did above).&lt;/p&gt;
&lt;p&gt;I simply like to use some like without all the html_safe
stuff:&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;%= &quot;&amp;lt;b&amp;gt;Alert&amp;lt;/b&amp;gt;&quot;.html_safe if level&amp;lt;0 %&amp;gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T21:07:29+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-11-03T21:07:35+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">18</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Oops, that method in my first posts should have read:

    def add_expr_escaped(src, code)
      src &lt;&lt; &quot;@output_buffer.safe_concat((&quot; &lt;&lt; code &lt;&lt; &quot;).to_s);&quot;
    end

Also apologies for the lack of proofreading in the second post. I'm actually tempted to override the XSS escaping when upgrading from Rails 2 projects by doing a global search/replace of &lt;%= with &lt;%== now. The on-by-default escaping idea is sound in theory but it's just introducing more problems than it solves when upgrading an old and stable code base.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Oops, that method in my first posts should have read:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;def add_expr_escaped(src, code)
  src &amp;lt;&amp;lt; &quot;@output_buffer.safe_concat((&quot; &amp;lt;&amp;lt; code &amp;lt;&amp;lt; &quot;).to_s);&quot;
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Also apologies for the lack of proofreading in the second post.
I'm actually tempted to override the XSS escaping when upgrading
from Rails 2 projects by doing a global search/replace of &amp;lt;%=
with &amp;lt;%== now. The on-by-default escaping idea is sound in
theory but it's just introducing more problems than it solves when
upgrading an old and stable code base.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T23:16:42+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages</title>
      <updated-at type="datetime">2010-11-03T23:16:47+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">19</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T23:17:37+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:title: ActionMailer is html escaping ampersand (&amp;) in Urls in plain text messages
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-03T23:17:41+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">20</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&gt; I agree a proper fix where plain text templates do net get escaped would be better.
&gt; 
&gt; However, I still like that new syntax for the regular views.

Fjan, your proposed shortcut syntax probably belongs in a separate ticket.</body>
      <body-html>&lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;I agree a proper fix where plain text templates do net get
escaped would be better.&lt;/p&gt;
&lt;p&gt;However, I still like that new syntax for the regular views.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Fjan, your proposed shortcut syntax probably belongs in a
separate ticket.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T23:21:41+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-03T23:21:47+00:00</updated-at>
      <user-id type="integer">12845</user-id>
      <version type="integer">21</version>
      <user-name>Wincent Colaiuta</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>You are right. Sorry for the spam here, not thinking to clearly after typing 390 html_safes. I'll put in a new ticket tomorrow.</body>
      <body-html>&lt;div&gt;&lt;p&gt;You are right. Sorry for the spam here, not thinking to clearly
after typing 390 html_safes. I'll put in a new ticket tomorrow.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-03T23:24:47+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-03T23:24:53+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">22</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>We have been investigating this issue, and it goes beyond ActionMailer. 

We have detected this happening when rendering csv files, ical compatible files etc.. Basically html escaping is happening all the time in ActionView regardless of format.

Templates and Handlers always choose a ActionView::SafeBuffer or a subclass of it. This is desired behaviour in case of html (or alike, e.g.: xml) but not in any other context like plain text emails or csv.

The template should be smart enough to choose the correct buffer based on the format passed to it. E.g.: when the extension of a template is .text.haml it should not be doing any escaping, i.e. not be using the safe buffer.

We do think the priority of this bug should be high, as it's influencing all formats besides html, and thus breaking these.

The impact is probably going to be beyond rails, but in any rails3 compatible handler, like haml.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We have been investigating this issue, and it goes beyond
ActionMailer.&lt;/p&gt;
&lt;p&gt;We have detected this happening when rendering csv files, ical
compatible files etc.. Basically html escaping is happening all the
time in ActionView regardless of format.&lt;/p&gt;
&lt;p&gt;Templates and Handlers always choose a ActionView::SafeBuffer or
a subclass of it. This is desired behaviour in case of html (or
alike, e.g.: xml) but not in any other context like plain text
emails or csv.&lt;/p&gt;
&lt;p&gt;The template should be smart enough to choose the correct buffer
based on the format passed to it. E.g.: when the extension of a
template is .text.haml it should not be doing any escaping, i.e.
not be using the safe buffer.&lt;/p&gt;
&lt;p&gt;We do think the priority of this bug should be high, as it's
influencing all formats besides html, and thus breaking these.&lt;/p&gt;
&lt;p&gt;The impact is probably going to be beyond rails, but in any
rails3 compatible handler, like haml.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-05T19:53:12+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-05T19:53:16+00:00</updated-at>
      <user-id type="integer">17424</user-id>
      <version type="integer">23</version>
      <user-name>Bertg</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were inspired by   baseball glove design and they created discount handbags with similar qualities.&lt;strong&gt;&lt;a href=&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come along until years later. The original handbag collection   had twelve designs, and they were made from supple, tan, top-quality leathers,   and showed the same excellent craftsmanship and stitching that we still expect   today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought new looks to   Coach bags. She used many new fabrics and organic materials like jersey and   wool. She created the brass hardware that is symbolic of &lt;strong&gt;&lt;a href=&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;. When   Lew Frankfort came aboard in 1979, he brought Coach to the next level, and they   became a name known the world over. Affordable luxury was not a concept that   many people knew, but now they would. Soon after Frankfort joined Coach, they   came out with a catalog, and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought its brand   relevance and strength. They designed watches starting in 1988, and also   expanded their company to Tokyo. Japan still counts among the leading purchasers   of &lt;strong&gt;&lt;a href=&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach heels. The manufacture of Coach shoes began in the mid   90's, and Reed Krakoff, the lead designer, loaned his talents to help put Coach   heels and &lt;a href=&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as their   handbags, but they are well worth the money invested in their purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that don't have   this height. &lt;strong&gt;&lt;a href=&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to style and   pizzazz. Coach platforms come in many styles, from gold loafers to slingbacks   with open toes. You may be able to find Coach shoes at discount prices online,   but be sure that you are buying genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous, Coach   shoes and &lt;a href=&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will make you   feel sporty, too. When selecting pumps or sandals to wear, you'll be happy to   count on the long-standing quality and service of the Coach company. They have   many styles to choose from, including chic and glamorous Coach boots and Coach   heels. Whether you are looking for sports shoes like Coach sneakers or sexy   shoes like Coach boots, the Coach name will never let you down.&lt;/p&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;When Coach began as Manhattan Leather Bags in 1941, they were
inspired by baseball glove design and they created discount
handbags with similar qualities.&lt;strong&gt;&lt;a href=
&quot;http://www.uk-supra.com&quot;&gt;supra shoes&lt;/a&gt;&lt;/strong&gt; didn't come
along until years later. The original handbag collection had twelve
designs, and they were made from supple, tan, top-quality leathers,
and showed the same excellent craftsmanship and stitching that we
still expect today.&lt;/p&gt;
&lt;p&gt;Coach hired a woman named Bonnie Cashin in 1962, and she brought
new looks to Coach bags. She used many new fabrics and organic
materials like jersey and wool. She created the brass hardware that
is symbolic of &lt;strong&gt;&lt;a href=
&quot;http://www.menstimberlandshoes.com&quot;&gt;timberland boots&lt;/a&gt;&lt;/strong&gt;.
When Lew Frankfort came aboard in 1979, he brought Coach to the
next level, and they became a name known the world over. Affordable
luxury was not a concept that many people knew, but now they would.
Soon after Frankfort joined Coach, they came out with a catalog,
and opened their flagship store in New York City.&lt;/p&gt;
&lt;p&gt;In the 1980's, Coach expanded and made innovations that brought
its brand relevance and strength. They designed watches starting in
1988, and also expanded their company to Tokyo. Japan still counts
among the leading purchasers of &lt;strong&gt;&lt;a href=
&quot;http://www.allofcoach.com&quot;&gt;coach purses&lt;/a&gt;&lt;/strong&gt; and Coach
heels. The manufacture of Coach shoes began in the mid 90's, and
Reed Krakoff, the lead designer, loaned his talents to help put
Coach heels and &lt;a href=
&quot;http://www.louisvuittonbagoutlet.com&quot;&gt;&lt;strong&gt;louis vuitton bags
outlet&lt;/strong&gt;&lt;/a&gt; on the map. Their shoes aren't as popular as
their handbags, but they are well worth the money invested in their
purchase.&lt;/p&gt;
&lt;p&gt;Women love heels, but at times you may want to wear shoes that
don't have this height. &lt;strong&gt;&lt;a href=
&quot;http://www.truereligionjeans-outlet.com&quot;&gt;true religion jeans
outlet&lt;/a&gt;&lt;/strong&gt; are as dedicated to comfort as they are to
style and pizzazz. Coach platforms come in many styles, from gold
loafers to slingbacks with open toes. You may be able to find Coach
shoes at discount prices online, but be sure that you are buying
genuine Coach products.&lt;/p&gt;
&lt;p&gt;If you're looking for &lt;a href=
&quot;http://www.womenmonclerjackets.com&quot;&gt;&lt;strong&gt;moncler
jackets&lt;/strong&gt;&lt;/a&gt; that will make you feel and look glamorous,
Coach shoes and &lt;a href=
&quot;http://www.chanelpursesbags.com&quot;&gt;&lt;strong&gt;chanel
purses&lt;/strong&gt;&lt;/a&gt; can do that well. Coach sneakers and heels will
make you feel sporty, too. When selecting pumps or sandals to wear,
you'll be happy to count on the long-standing quality and service
of the Coach company. They have many styles to choose from,
including chic and glamorous Coach boots and Coach heels. Whether
you are looking for sports shoes like Coach sneakers or sexy shoes
like Coach boots, the Coach name will never let you down.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-08T01:24:21+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-08T23:12:12+00:00</updated-at>
      <user-id type="integer">123546</user-id>
      <version type="integer">24</version>
      <user-name>jim123456</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Now that my [patch to add a non-escaping option to Erubis](https://rails.lighthouseapp.com/projects/8994/tickets/5918-fix-erubis-non-escaping-sequence-patch) has been committed to 3.0 stable this problem can be fixed by simply letting the handler check if the template identifier contains &quot;html&quot; and disabling escape otherwise. Attached is a monkey patch that adds one line to the template setup:

@@@ ruby
   :escape =&gt; template.identifier !~ /\.html/   # Note: :escape =&gt; true disables escaping
@@@

Note that this patch will only work if the patch mentioned above is also applied.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Now that my &lt;a href=
&quot;https://rails.lighthouseapp.com/projects/8994/tickets/5918-fix-erubis-non-escaping-sequence-patch&quot;&gt;
patch to add a non-escaping option to Erubis&lt;/a&gt; has been committed
to 3.0 stable this problem can be fixed by simply letting the
handler check if the template identifier contains &quot;html&quot; and
disabling escape otherwise. Attached is a monkey patch that adds
one line to the template setup:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;   :escape =&amp;gt; template.identifier !~ /\.html/   # Note: :escape =&amp;gt; true disables escaping&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Note that this patch will only work if the patch mentioned above
is also applied.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-11T15:25:22+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-11T15:25:26+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">25</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Worth noting that this monkey patch will only work on ERB templates but won't work for HAML for instance...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Worth noting that this monkey patch will only work on ERB
templates but won't work for HAML for instance...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-11T15:52:31+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-11T15:52:38+00:00</updated-at>
      <user-id type="integer">36009</user-id>
      <version type="integer">26</version>
      <user-name>Rodrigo Rosenfeld Rosas</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Here is the one-line patch that can be applied to edge. Sorry, I have no idea how to add a test for this, I'm kind of new to all this.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Here is the one-line patch that can be applied to edge. Sorry, I
have no idea how to add a test for this, I'm kind of new to all
this.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-11T16:40:19+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:title: ActionMailer is html escaping plain text messages
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-11T16:40:24+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">27</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/34349)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/34349&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:04:51+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2010-11-15T21:04:51+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">28</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/42275)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/42275&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-12T21:58:21+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 92071
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-02-12T21:58:21+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">29</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/43692)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/43692&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-27T03:15:38+00:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 101623
</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-02-27T03:15:38+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">30</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Does anyone know if this issue has been fixed yet? It looks like things have changed a lot in Rails3 since the patch was submitted. We're experiencing the problem currently where our users are getting their emails with escaped characters. Anyone know a workaround?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Does anyone know if this issue has been fixed yet? It looks like
things have changed a lot in Rails3 since the patch was submitted.
We're experiencing the problem currently where our users are
getting their emails with escaped characters. Anyone know a
workaround?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T20:38:49+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-04-28T20:39:36+01:00</updated-at>
      <user-id type="integer">142684</user-id>
      <version type="integer">31</version>
      <user-name>Matthew Stopa</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I have no idea what the status on this ticket is, but the work around we used is to indicate EACH string as html safe manually. That works great :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have no idea what the status on this ticket is, but the work
around we used is to indicate EACH string as html safe manually.
That works great :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T21:19:25+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-04-28T21:20:07+01:00</updated-at>
      <user-id type="integer">17424</user-id>
      <version type="integer">32</version>
      <user-name>Bertg</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>That hasn't worked for me at all. Even with a basic ActionMailer where I specify the body as body =&gt; &quot;blah &lt;a&gt; blah&quot;.html_safe I am still seeing escaped characters in the emails it sends.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That hasn't worked for me at all. Even with a basic ActionMailer
where I specify the body as body =&amp;gt; &quot;blah &lt;a&gt;blah&quot;.html_safe I
am still seeing escaped characters in the emails it sends.&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-28T22:08:42+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-04-28T22:09:28+01:00</updated-at>
      <user-id type="integer">142684</user-id>
      <version type="integer">33</version>
      <user-name>Matthew Stopa</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@Matthew: I've been using the monkey patch I provided in the November 11th post in production for quite some time now and it works great. Just drop it in the config/initializers directory.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@Matthew: I've been using the monkey patch I provided in the
November 11th post in production for quite some time now and it
works great. Just drop it in the config/initializers directory.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-04-29T08:15:57+01:00</created-at>
      <creator-id type="integer">36009</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4858</number>
      <permalink>actionmailer-is-html-escaping-ampersand-in-urls-in-plain-text-messages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionview escaping formats html_safe safe_buffer xss</tag>
      <title>[PATCH] ActionMailer is html escaping plain text messages</title>
      <updated-at type="datetime">2011-04-29T08:16:42+01:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">34</version>
      <user-name>Fjan</user-name>
      <creator-name>Rodrigo Rosenfeld Rosas</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4858</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>51038c889040eaf2d8eec3777d28f526fc57f309</code>
      <content-type>text/x-ruby-script</content-type>
      <created-at type="datetime">2010-11-11T15:25:22+00:00</created-at>
      <filename>only_escape_html_templates.rb</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">765931</id>
      <size type="integer">1059</size>
      <uploader-id type="integer">8551</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/765931/only_escape_html_templates.rb</url>
    </attachment>
    <attachment type="Attachment">
      <code>ed55a26414ca1bf39b1827a3d5233d79543fbdff</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-11-11T16:40:19+00:00</created-at>
      <filename>0003-disable-erb-escaping-non-html-templates.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">766102</id>
      <size type="integer">919</size>
      <uploader-id type="integer">8551</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/766102/0003-disable-erb-escaping-non-html-templates.patch</url>
    </attachment>
  </attachments>
</ticket>
