<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-11-24T05:54:05+00:00</created-at>
  <creator-id type="integer">16063</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">1453</number>
  <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
  <priority type="integer">827</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>2.2 2.2-stable bug integration_test sessions</tag>
  <title>'get's in integration test unless you are using cookie sessions</title>
  <updated-at type="datetime">2009-04-18T17:08:01+01:00</updated-at>
  <user-id type="integer">53891</user-id>
  <version type="integer">18</version>
  <user-name>Chris Wilson</user-name>
  <creator-name>Mark</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>Hi All,

When you run an integration test that does some sort of http operation (such as get '/') and you are not running cookie sessions ( the key is not having config.action_controller.session = ... line in your environment.rb ) you get the integration test failing with the following exception:
@@@ ruby
NoMethodError: You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]=
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `__send__'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `get'
    ./test/integration/index_test.rb:8:in `test_the_truth'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `__send__'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `run'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'
@@@

Hunting a little further I discovered that this exception is the real culprit:
@@@ ruby
(rdb:1) exception
#&lt;ArgumentError: A secret is required to generate an integrity hash for cookie session data. Use config.action_controller.session = { :session_key =&gt; &quot;_myapp_session&quot;, :secret =&gt; &quot;some secret phrase of at least 30 characters&quot; } in config/environment.rb&gt;
@@@
This should only be required when using cookie store.</original-body>
  <latest-body>Hi All,

When you run an integration test that does some sort of http operation (such as get '/') and you are not running cookie sessions ( the key is not having config.action_controller.session = ... line in your environment.rb ) you get the integration test failing with the following exception:
@@@ ruby
NoMethodError: You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]=
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `__send__'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `get'
    ./test/integration/index_test.rb:8:in `test_the_truth'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `__send__'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `run'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'
@@@

Hunting a little further I discovered that this exception is the real culprit:
@@@ ruby
(rdb:1) exception
#&lt;ArgumentError: A secret is required to generate an integrity hash for cookie session data. Use config.action_controller.session = { :session_key =&gt; &quot;_myapp_session&quot;, :secret =&gt; &quot;some secret phrase of at least 30 characters&quot; } in config/environment.rb&gt;
@@@
This should only be required when using cookie store.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hi All,&lt;/p&gt;
&lt;p&gt;When you run an integration test that does some sort of http
operation (such as get '/') and you are not running cookie sessions
( the key is not having config.action_controller.session = ... line
in your environment.rb ) you get the integration test failing with
the following exception:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
NoMethodError: You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]=
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `__send__'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `get'
    ./test/integration/index_test.rb:8:in `test_the_truth'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `__send__'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `run'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hunting a little further I discovered that this exception is the
real culprit:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
(rdb:1) exception
#&amp;lt;ArgumentError: A secret is required to generate an integrity hash for cookie session data. Use config.action_controller.session = { :session_key =&amp;gt; &amp;quot;_myapp_session&amp;quot;, :secret =&amp;gt; &amp;quot;some secret phrase of at least 30 characters&amp;quot; } in config/environment.rb&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This should only be required when using cookie store.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi All,

When you run an integration test that does some sort of http operation (such as get '/') and you are not running cookie sessions ( the key is not having config.action_controller.session = ... line in your environment.rb ) you get the integration test failing with the following exception:
@@@ ruby
NoMethodError: You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]=
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `__send__'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `get'
    ./test/integration/index_test.rb:8:in `test_the_truth'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `__send__'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `run'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'
@@@

Hunting a little further I discovered that this exception is the real culprit:
@@@ ruby
(rdb:1) exception
#&lt;ArgumentError: A secret is required to generate an integrity hash for cookie session data. Use config.action_controller.session = { :session_key =&gt; &quot;_myapp_session&quot;, :secret =&gt; &quot;some secret phrase of at least 30 characters&quot; } in config/environment.rb&gt;
@@@
This should only be required when using cookie store.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi All,&lt;/p&gt;
&lt;p&gt;When you run an integration test that does some sort of http
operation (such as get '/') and you are not running cookie sessions
( the key is not having config.action_controller.session = ... line
in your environment.rb ) you get the integration test failing with
the following exception:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
NoMethodError: You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]=
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `__send__'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:447:in `get'
    ./test/integration/index_test.rb:8:in `test_the_truth'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `__send__'
    /Library/Ruby/Gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:94:in `run'
    /Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hunting a little further I discovered that this exception is the
real culprit:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
(rdb:1) exception
#&amp;lt;ArgumentError: A secret is required to generate an integrity hash for cookie session data. Use config.action_controller.session = { :session_key =&amp;gt; &amp;quot;_myapp_session&amp;quot;, :secret =&amp;gt; &amp;quot;some secret phrase of at least 30 characters&amp;quot; } in config/environment.rb&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This should only be required when using cookie store.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-24T05:54:06+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-11-24T05:54:11+00:00</updated-at>
      <user-id type="integer">16063</user-id>
      <version type="integer">1</version>
      <user-name>Mark</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>It looks like the integration test is actually using the cookie store instead of the configured store, because cookies[SESSION_KEY] changes on every request (even though ApplicationController::session_store reports otherwise)

I have a bunch of test failing because my app assumes a new sessions starts when it gets a new value for cookies[SESSION_KEY]</body>
      <body-html>&lt;div&gt;&lt;p&gt;It looks like the integration test is actually using the cookie
store instead of the configured store, because cookies[SESSION_KEY]
changes on every request (even though
ApplicationController::session_store reports otherwise)&lt;/p&gt;
&lt;p&gt;I have a bunch of test failing because my app assumes a new
sessions starts when it gets a new value for
cookies[SESSION_KEY]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-25T17:42:29+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-11-25T17:42:35+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">2</version>
      <user-name>Fjan</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Are you on edge? Can you please make a failing unit test?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Are you on edge? Can you please make a failing unit test?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-15T21:27:22+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-12-15T21:27:25+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">3</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I'm not on edge, but in Rails 2.2 you will see almost any test fail as soon as you remove this line from your environment.rb. 

&quot;config.action_controller.session = {:sesion_key...&quot;

(A test with just get '/' in it should do.)</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm not on edge, but in Rails 2.2 you will see almost any test
fail as soon as you remove this line from your environment.rb.&lt;/p&gt;
&lt;p&gt;&quot;config.action_controller.session = {:sesion_key...&quot;&lt;/p&gt;
&lt;p&gt;(A test with just get '/' in it should do.)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-12-15T22:32:30+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-12-15T22:32:32+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">4</version>
      <user-name>Fjan</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Yeah, if you are going use cookie sessions you do need to give a key.

If you mean to use a different store, try

@@@ ruby
config.action_controller.session_store = :mem_cache_store
# or
config.action_controller.session_store = nil
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Yeah, if you are going use cookie sessions you do need to give a
key.&lt;/p&gt;
&lt;p&gt;If you mean to use a different store, try&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
config.action_controller.session_store = :mem_cache_store
# or
config.action_controller.session_store = nil
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-15T23:03:04+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-12-15T23:03:06+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Uhm, no, that's the point of this ticket. We DON'T want to use the cookie store, and yet it gives us errors for not supplying a key (only when testing, rails runs fine otherwise)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Uhm, no, that's the point of this ticket. We DON'T want to use
the cookie store, and yet it gives us errors for not supplying a
key (only when testing, rails runs fine otherwise)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-15T23:53:45+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-12-15T23:53:50+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">6</version>
      <user-name>Fjan</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I too am seeing this behavior.  I tried to specify a different session store but it still complains about, &quot;...A secret is required to generate an integrity hash for cookie session data.&quot;  Furthermore, when I do try to use the cookie session store I receive a CGI::Session::CookieStore::CookieOverflow exception.  This is only an issue with integration testing.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I too am seeing this behavior. I tried to specify a different
session store but it still complains about, &quot;...A secret is
required to generate an integrity hash for cookie session data.&quot;
Furthermore, when I do try to use the cookie session store I
receive a CGI::Session::CookieStore::CookieOverflow exception. This
is only an issue with integration testing.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-12-18T20:22:50+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2008-12-18T20:22:52+00:00</updated-at>
      <user-id type="integer">31606</user-id>
      <version type="integer">7</version>
      <user-name>jfoxny</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>same for me, I use config.action_controller.session_store = :active_record_store in my app and the integration tests fails with &quot;CGI::Session::CookieStore::CookieOverflow (CGI::Session::CookieStore::CookieOverflow)&quot; message ... You have an temporary solution ?!</body>
      <body-html>&lt;div&gt;&lt;p&gt;same for me, I use config.action_controller.session_store =
:active_record_store in my app and the integration tests fails with
&quot;CGI::Session::CookieStore::CookieOverflow
(CGI::Session::CookieStore::CookieOverflow)&quot; message ... You have
an temporary solution ?!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-05T15:08:09+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-05T15:08:14+00:00</updated-at>
      <user-id type="integer">35608</user-id>
      <version type="integer">8</version>
      <user-name>Jo&#235;l AZEMAR</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Could you guys create a failing unit test to apply to AP</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could you guys create a failing unit test to apply to AP&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-05T18:15:38+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-05T18:15:44+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">9</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Pretty much any integration test will fail as soon as you set the session store to active record and remove the cookie session key. (Which shouldn't be cause for failure, of course).

 So as a unit test you can just do get '/'</body>
      <body-html>&lt;div&gt;&lt;p&gt;Pretty much any integration test will fail as soon as you set
the session store to active record and remove the cookie session
key. (Which shouldn't be cause for failure, of course).&lt;/p&gt;
&lt;p&gt;So as a unit test you can just do get '/'&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-05T18:21:12+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-05T18:21:15+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">10</version>
      <user-name>Fjan</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Simple and minimalist sample.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Simple and minimalist sample.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-06T11:24:40+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-06T11:24:44+00:00</updated-at>
      <user-id type="integer">35608</user-id>
      <version type="integer">11</version>
      <user-name>Jo&#235;l AZEMAR</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>What new ??!</body>
      <body-html>&lt;div&gt;&lt;p&gt;What new ??!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-13T09:14:11+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-13T09:14:17+00:00</updated-at>
      <user-id type="integer">35608</user-id>
      <version type="integer">12</version>
      <user-name>Jo&#235;l AZEMAR</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>When is it going to be fixed? I'm receiving errors for my integration tests after upgrading from 2.1.x to 2.2.2:

117   1) Error:
118 test_logging_into_account1(StoriesTest):
119 NoMethodError: You have a nil object when you didn't expect it!
120 You might have expected an instance of ActiveRecord::Base.
121 The error occurred while evaluating nil.[]=
122     /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in `process'
123     /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in `get'
124     /home/admin/sites/&lt;removed&gt;/test/integration/stories_test.rb:30:in `is_logging_in_as'
125     /home/admin/sites/&lt;removed&gt;/test/integration/stories_test.rb:132:in `test_logging_into_account1'
126     /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:60:in `__send__'
127     /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:60:in `run'
128     /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in `run'</body>
      <body-html>&lt;div&gt;&lt;p&gt;When is it going to be fixed? I'm receiving errors for my
integration tests after upgrading from 2.1.x to 2.2.2:&lt;/p&gt;
&lt;p&gt;117 1) Error: 118 test_logging_into_account1(StoriesTest): 119
NoMethodError: You have a nil object when you didn't expect it! 120
You might have expected an instance of ActiveRecord::Base. 121 The
error occurred while evaluating nil.[]= 122
/usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:294:in
&lt;code&gt;process' 123
/usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:185:in&lt;/code&gt;get'
124 /home/admin/sites//test/integration/stories_test.rb:30:in
&lt;code&gt;is_logging_in_as' 125
/home/admin/sites/&amp;lt;removed&amp;gt;/test/integration/stories_test.rb:132:in&lt;/code&gt;test_logging_into_account1'
126
/usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:60:in
&lt;code&gt;__send__' 127
/usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/testing/setup_and_teardown.rb:60:in&lt;/code&gt;run'
128
/usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/integration.rb:597:in
&lt;code&gt;run'&lt;/code&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-18T10:23:05+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-18T10:23:09+00:00</updated-at>
      <user-id type="integer">44067</user-id>
      <version type="integer">13</version>
      <user-name>Joe</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>There's a temporary solution here:

http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/5519ca7fd4dde3c1</body>
      <body-html>&lt;div&gt;&lt;p&gt;There's a temporary solution here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/5519ca7fd4dde3c1&quot;&gt;
http://groups.google.com/group/r...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-20T13:27:21+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-20T13:27:25+00:00</updated-at>
      <user-id type="integer">44281</user-id>
      <version type="integer">14</version>
      <user-name>sdawara</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I left my session_key and secret in environment.rb despite that fact that I'm NOT using cookie store for my sessions and I'm still getting integration test failures:  CGI::Session::CookieStore::CookieOverflow.

As previously pointed out, it seems like integration tests don't honor the ActionController::Base.session_store setting.

Here's a (tiny) test case:

app/controllers/foo_controller.rb
http://pastie.org/372912

test/integration/foo_test.rb
http://pastie.org/372914</body>
      <body-html>&lt;div&gt;&lt;p&gt;I left my session_key and secret in environment.rb despite that
fact that I'm NOT using cookie store for my sessions and I'm still
getting integration test failures:
CGI::Session::CookieStore::CookieOverflow.&lt;/p&gt;
&lt;p&gt;As previously pointed out, it seems like integration tests don't
honor the ActionController::Base.session_store setting.&lt;/p&gt;
&lt;p&gt;Here's a (tiny) test case:&lt;/p&gt;
&lt;p&gt;app/controllers/foo_controller.rb &lt;a href=&quot;http://pastie.org/372912&quot;&gt;http://pastie.org/372912&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;test/integration/foo_test.rb &lt;a href=&quot;http://pastie.org/372914&quot;&gt;http://pastie.org/372914&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-01-28T04:45:58+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-01-28T04:46:02+00:00</updated-at>
      <user-id type="integer">25655</user-id>
      <version type="integer">15</version>
      <user-name>Christopher J. Bottaro</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I'm currently upgrading from 2.0.2 to 2.2.2 and came across this same problem. I'm using active_record_store as my session_store.

sdawara's link was helpful, quoting a block from there: *&quot;It looks like the database_manager is hardcoded to be a CookieStore in rack_process.rb. Is there any plan on getting integration tests to use the actual configured cookie store?&quot;*

Before this, I did not have any cookie session info in my environment.rb, but adding *&quot;config.action_controller.session = {:session_key =&gt; ..., :secret =&gt; ...}&quot;* removed the problem for now.

Still the integration test wont actually test the session database, i.e. interation tests would pass even if I would not have session table in my database (in which case the server would crash if I would try to run it.)

same issue happens when using script/console &gt;&gt; *&quot;app.get '/'&quot;*

Is this ticket really going to be 'notfixed'?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I'm currently upgrading from 2.0.2 to 2.2.2 and came across this
same problem. I'm using active_record_store as my
session_store.&lt;/p&gt;
&lt;p&gt;sdawara's link was helpful, quoting a block from there: &lt;em&gt;&quot;It
looks like the database_manager is hardcoded to be a CookieStore in
rack_process.rb. Is there any plan on getting integration tests to
use the actual configured cookie store?&quot;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Before this, I did not have any cookie session info in my
environment.rb, but adding &lt;em&gt;&quot;config.action_controller.session =
{:session_key =&amp;gt; ..., :secret =&amp;gt; ...}&quot;&lt;/em&gt; removed the
problem for now.&lt;/p&gt;
&lt;p&gt;Still the integration test wont actually test the session
database, i.e. interation tests would pass even if I would not have
session table in my database (in which case the server would crash
if I would try to run it.)&lt;/p&gt;
&lt;p&gt;same issue happens when using script/console &amp;gt;&amp;gt;
&lt;em&gt;&quot;app.get '/'&quot;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Is this ticket really going to be 'notfixed'?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-26T20:54:29+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-02-26T20:54:33+00:00</updated-at>
      <user-id type="integer">48866</user-id>
      <version type="integer">16</version>
      <user-name>holli</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is fixed in 2.3.2</body>
      <body-html>&lt;div&gt;&lt;p&gt;This is fixed in 2.3.2&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-03-18T16:49:48+00:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-03-18T16:49:54+00:00</updated-at>
      <user-id type="integer">8551</user-id>
      <version type="integer">17</version>
      <user-name>Fjan</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Upgrading to 2.3.x brings its own set of problems. If you don't want to upgrade, you can do this in your test setup or test environment instead:

    ActionController::RackRequest::DEFAULT_SESSION_OPTIONS[:database_manager] = CGI::Session::ActiveRecordStore</body>
      <body-html>&lt;div&gt;&lt;p&gt;Upgrading to 2.3.x brings its own set of problems. If you don't
want to upgrade, you can do this in your test setup or test
environment instead:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ActionController::RackRequest::DEFAULT_SESSION_OPTIONS[:database_manager] = CGI::Session::ActiveRecordStore
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-04-18T17:07:58+01:00</created-at>
      <creator-id type="integer">16063</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1453</number>
      <permalink>gets-in-integration-test-unless-you-are-using-cookie-sessions</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>2.2 2.2-stable bug integration_test sessions</tag>
      <title>'get's in integration test unless you are using cookie sessions</title>
      <updated-at type="datetime">2009-04-18T17:08:01+01:00</updated-at>
      <user-id type="integer">53891</user-id>
      <version type="integer">18</version>
      <user-name>Chris Wilson</user-name>
      <creator-name>Mark</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1453</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>d205d9d5d047cf83c585034e0835d7e2e8caba3e</code>
      <content-type>application/zip</content-type>
      <created-at type="datetime">2009-01-06T11:24:40+00:00</created-at>
      <filename>integration_test_fail.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">75676</id>
      <size type="integer">118481</size>
      <uploader-id type="integer">35608</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/75676/integration_test_fail.zip</url>
    </attachment>
  </attachments>
</ticket>
