<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">85</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-05-07T05:58:26+01:00</created-at>
  <creator-id type="integer">1841</creator-id>
  <milestone-due-on type="datetime">2009-03-18T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">9901</milestone-id>
  <number type="integer">130</number>
  <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
  <priority type="integer">11912</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack bug edge patch tests</tag>
  <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
  <updated-at type="datetime">2008-05-13T18:54:30+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">16</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>Rich Cavanaugh</creator-name>
  <assigned-user-name>Jeremy Kemper</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
  <milestone-title>2.1.1</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>CookieStore is currently escaping and unescaping while this is handled in other places in ActionController. This means double the work which does, in some cases result in different output.

CGI::Cookie had a bug in it's handling of a Hash parameter. It handled a string value with newlines in it differently depending on whether it was handed a Hash or not. Given a Hash with a string value containing newlines, the value would be split into multiple values. This resulted in '&amp;' being inserted into the CookieStore values due to how multiple cookie values get concatenated.

Both of these issues caused interoperability bugs with my Merb application that shared the CookieStore with the Rails app.

All existing Rails tests pass with these patches. I've added tests where appropriate. These minor fixes did correct all related issues with my applications.</original-body>
  <latest-body>CookieStore is currently escaping and unescaping while this is handled in other places in ActionController. This means double the work which does, in some cases result in different output.

CGI::Cookie had a bug in it's handling of a Hash parameter. It handled a string value with newlines in it differently depending on whether it was handed a Hash or not. Given a Hash with a string value containing newlines, the value would be split into multiple values. This resulted in '&amp;' being inserted into the CookieStore values due to how multiple cookie values get concatenated.

Both of these issues caused interoperability bugs with my Merb application that shared the CookieStore with the Rails app.

All existing Rails tests pass with these patches. I've added tests where appropriate. These minor fixes did correct all related issues with my applications.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
CookieStore is currently escaping and unescaping while this is handled in other places in ActionController. This means double the work which does, in some cases result in different output.
&lt;/p&gt;&lt;p&gt;
CGI::Cookie had a bug in it's handling of a Hash parameter. It handled a string value with newlines in it differently depending on whether it was handed a Hash or not. Given a Hash with a string value containing newlines, the value would be split into multiple values. This resulted in '&amp;' being inserted into the CookieStore values due to how multiple cookie values get concatenated.
&lt;/p&gt;&lt;p&gt;
Both of these issues caused interoperability bugs with my Merb application that shared the CookieStore with the Rails app.
&lt;/p&gt;&lt;p&gt;
All existing Rails tests pass with these patches. I've added tests where appropriate. These minor fixes did correct all related issues with my applications.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>CookieStore is currently escaping and unescaping while this is handled in other places in ActionController. This means double the work which does, in some cases result in different output.

CGI::Cookie had a bug in it's handling of a Hash parameter. It handled a string value with newlines in it differently depending on whether it was handed a Hash or not. Given a Hash with a string value containing newlines, the value would be split into multiple values. This resulted in '&amp;' being inserted into the CookieStore values due to how multiple cookie values get concatenated.

Both of these issues caused interoperability bugs with my Merb application that shared the CookieStore with the Rails app.

All existing Rails tests pass with these patches. I've added tests where appropriate. These minor fixes did correct all related issues with my applications.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
CookieStore is currently escaping and unescaping while this is handled in other places in ActionController. This means double the work which does, in some cases result in different output.
&lt;/p&gt;&lt;p&gt;
CGI::Cookie had a bug in it's handling of a Hash parameter. It handled a string value with newlines in it differently depending on whether it was handed a Hash or not. Given a Hash with a string value containing newlines, the value would be split into multiple values. This resulted in '&amp;' being inserted into the CookieStore values due to how multiple cookie values get concatenated.
&lt;/p&gt;&lt;p&gt;
Both of these issues caused interoperability bugs with my Merb application that shared the CookieStore with the Rails app.
&lt;/p&gt;&lt;p&gt;
All existing Rails tests pass with these patches. I've added tests where appropriate. These minor fixes did correct all related issues with my applications.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-07T05:58:26+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-07T05:58:26+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">1</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This is not a backward compatible change and will cause all existing cookie sessions to raise CGI::Session::CookieStore::TamperedWithCookie exception.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This is not a backward compatible change and will cause all existing cookie sessions to raise CGI::Session::CookieStore::TamperedWithCookie exception.
&lt;/p&gt;&lt;p&gt;
Thanks.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-11T22:33:53+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-11T22:33:53+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">2</version>
      <user-name>Pratik</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>It would be simple enough to make this work with existing cookies. Would a patch implementing this be likely to be accepted?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
It would be simple enough to make this work with existing cookies. Would a patch implementing this be likely to be accepted?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-11T23:19:31+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-11T23:19:31+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">3</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-11T23:23:09+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-11T23:23:09+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">4</version>
      <user-name>Pratik</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Here's a patch that passes all of rails' tests, my application specific tests and is backwards compatible (with tests for that too).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Here's a patch that passes all of rails' tests, my application specific tests and is backwards compatible (with tests for that too).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-12T19:27:02+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>invalid</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T19:27:02+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">5</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@@@ ruby
-        @value = Array(name['value'])
+        @value = name['value'].kind_of?(String) ? [name['value']] : Array(name['value'])
@@@

Why? Array('foo') == ['foo']</body>
      <body-html>&lt;div&gt;&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;-        @value = Array(name['value'])
+        @value = name['value'].kind_of?(String) ? [name['value']] : Array(name['value'])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Why? Array('foo') == ['foo']
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T21:28:33+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- 
:state: invalid
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T21:28:33+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">6</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>@value is expected to be an array but if you pass &quot;one\ntwo&quot; to Array you get:

Array(&quot;one\ntwo&quot;) # =&gt; [&quot;one\n&quot;, &quot;two&quot;]

Which gets written out in the cookie header to &quot;one%0A&amp;two&quot; (notice the &amp; used for joining the separate elements). This issue, when used with other systems without this behavior (in my case merb), causes digest mis-matches.

Array(&quot;one\ntwo&quot;) != [&quot;one\ntwo&quot;] # =&gt; true</body>
      <body-html>&lt;div&gt;&lt;p&gt;
@value is expected to be an array but if you pass &quot;one\ntwo&quot; to Array you get:
&lt;/p&gt;&lt;p&gt;
Array(&quot;one\ntwo&quot;) # =&gt; [&quot;one\n&quot;, &quot;two&quot;]
&lt;/p&gt;&lt;p&gt;
Which gets written out in the cookie header to &quot;one%0A&amp;two&quot; (notice the &amp; used for joining the separate elements). This issue, when used with other systems without this behavior (in my case merb), causes digest mis-matches.
&lt;/p&gt;&lt;p&gt;
Array(&quot;one\ntwo&quot;) != [&quot;one\ntwo&quot;] # =&gt; true
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T21:55:07+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T21:55:07+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">7</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Ah, I see. Could you include a test for that case? The patch looks good, otherwise.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Ah, I see. Could you include a test for that case? The patch looks good, otherwise.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T22:03:35+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T22:03:35+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">8</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I actually did, it's called test_cookies_should_not_be_split_on_values_with_newlines</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I actually did, it's called test_cookies_should_not_be_split_on_values_with_newlines
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T22:05:30+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T22:05:30+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">9</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Sorry, I missed that. I have mixed feelings about changing this behavior for all cookie values. Backward compatibility applies to the cookie store only.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Sorry, I missed that. I have mixed feelings about changing this behavior for all cookie values. Backward compatibility applies to the cookie store only.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T22:39:34+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T22:39:34+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">10</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Yeah, I agree but, taken in context CGI::Cookie is plainly broken and acting differently depending on how you initialize.

When name is a string the value is already an array so:

CGI::Cookie.new(&quot;avar&quot;, &quot;one\ntwo&quot;).value # =&gt; [&quot;one\ntwo&quot;]

While:

CGI::Cookie.new(:name =&gt; &quot;avar&quot;, :value =&gt; &quot;one\ntwo&quot;).value # =&gt; [&quot;one\n&quot;, &quot;two&quot;]

That's why I didn't make the same change to the String path in CGI::Cookie#initialize because the variable argument *value is always an array and Array doesn't mangle an array's values the same way it does strings.

So the behavior is already inconsistent and this patch simply makes the initializer act consistently.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Yeah, I agree but, taken in context CGI::Cookie is plainly broken and acting differently depending on how you initialize.
&lt;/p&gt;&lt;p&gt;
When name is a string the value is already an array so:
&lt;/p&gt;&lt;p&gt;
CGI::Cookie.new(&quot;avar&quot;, &quot;one\ntwo&quot;).value # =&gt; [&quot;one\ntwo&quot;]
&lt;/p&gt;&lt;p&gt;
While:
&lt;/p&gt;&lt;p&gt;
CGI::Cookie.new(:name =&gt; &quot;avar&quot;, :value =&gt; &quot;one\ntwo&quot;).value # =&gt; [&quot;one\n&quot;, &quot;two&quot;]
&lt;/p&gt;&lt;p&gt;
That's why I didn't make the same change to the String path in CGI::Cookie#initialize because the variable argument *value is always an array and Array doesn't mangle an array's values the same way it does strings.
&lt;/p&gt;&lt;p&gt;
So the behavior is already inconsistent and this patch simply makes the initializer act consistently.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T22:52:31+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T22:52:31+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">11</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I buy that. Thanks for clarifying, Rich.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I buy that. Thanks for clarifying, Rich.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-12T23:14:27+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T23:14:27+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">12</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [a425cd147363a0e8d7e17177ef252dd760197f15]) Don't double-escape cookie store data. Don't split cookie values with newlines into an array. [#130 state:resolved]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/a425cd147363a0e8d7e17177ef252dd760197f15</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [a425cd147363a0e8d7e17177ef252dd760197f15]) Don't double-escape cookie store data. Don't split cookie values with newlines into an array. [#130 state:resolved]
&lt;/p&gt;&lt;p&gt;
Signed-off-by: Jeremy Kemper 
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/a425cd147363a0e8d7e17177ef252dd760197f15&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-12T23:27:40+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-12T23:27:40+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">13</version>
      <user-name>Repository</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This change seems to change the behavior of deleting a cookie. When a cookie is deleted it's value is set to an empty string. Previously that would have meant:
Array('') =&gt; []
but now it is turned into: ['']

I'm not really familiar with how cookies are supposed to behave so I'm not sure where the bug is, but for example with the restful_authentication plugin generated code what happens is:

1. action does 'cookies.delete :auth_token'
2. test fails on 'assert_equal @response.cookies[&quot;auth_token&quot;], []' with [&quot;&quot;] not being equal to []


Is this expected?</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This change seems to change the behavior of deleting a cookie. When a cookie is deleted it's value is set to an empty string. Previously that would have meant:
&lt;/p&gt;&lt;p&gt;
Array('') =&gt; []
&lt;/p&gt;&lt;p&gt;
but now it is turned into: ['']
&lt;/p&gt;&lt;p&gt;
I'm not really familiar with how cookies are supposed to behave so I'm not sure where the bug is, but for example with the restful_authentication plugin generated code what happens is:
&lt;/p&gt;&lt;p&gt;
1. action does 'cookies.delete :auth_token'
&lt;/p&gt;&lt;p&gt;
2. test fails on 'assert_equal @response.cookies[&quot;auth_token&quot;], []' with [&quot;&quot;] not being equal to []
&lt;/p&gt;&lt;p&gt;
Is this expected?
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-13T17:04:47+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-13T17:04:47+01:00</updated-at>
      <user-id type="integer">14890</user-id>
      <version type="integer">14</version>
      <user-name>Tarmo T&#228;nav</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've attached a new patch addressing this issue along with a test for it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I've attached a new patch addressing this issue along with a test for it.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-13T17:21:52+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-13T17:21:52+01:00</updated-at>
      <user-id type="integer">1841</user-id>
      <version type="integer">15</version>
      <user-name>Rich Cavanaugh</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">85</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>http://github.com/rails/rails/commit/d8bcec6ce6b48f271af5c566791417a58b8a617d</body>
      <body-html>&lt;div&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/d8bcec6ce6b48f271af5c566791417a58b8a617d&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-13T18:54:30+01:00</created-at>
      <creator-id type="integer">1841</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">130</number>
      <permalink>cgi-cookie-and-cookiestore-performing-unnecessary-work-causing-interoperability-bug-with-merb</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>CGI::Cookie and CookieStore performing unnecessary work causing interoperability bug with Merb</title>
      <updated-at type="datetime">2008-05-13T18:54:30+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Rich Cavanaugh</creator-name>
      <assigned-user-name>Jeremy Kemper</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/130</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>403aea2f1ebcee6bf2d25bc6b7d7f7e15772bb97</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-07T05:58:26+01:00</created-at>
      <filename>cookie_store_cleanups.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">21843</id>
      <size type="integer">4958</size>
      <uploader-id type="integer">1841</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/21843/cookie_store_cleanups.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>cac1218ca37ce6f8a273b9d9b4e6c4852c2734e7</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-12T01:31:42+01:00</created-at>
      <filename>backwards_compat_cookie_store.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">22453</id>
      <size type="integer">5147</size>
      <uploader-id type="integer">1841</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/22453/backwards_compat_cookie_store.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>3c011eedb1edf56d73abfb694678e6071cc79337</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-13T17:21:52+01:00</created-at>
      <filename>handle_empty_cookie.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">22740</id>
      <size type="integer">1700</size>
      <uploader-id type="integer">1841</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/22740/handle_empty_cookie.patch</url>
    </attachment>
  </attachments>
</ticket>
