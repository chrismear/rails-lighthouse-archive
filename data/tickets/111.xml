<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-05-04T22:10:42+01:00</created-at>
  <creator-id type="integer">7046</creator-id>
  <milestone-due-on type="datetime">2009-03-18T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">9901</milestone-id>
  <number type="integer">111</number>
  <permalink>default-path-names-ignored</permalink>
  <priority type="integer">12771</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack bug patch routing</tag>
  <title>Default path names ignored</title>
  <updated-at type="datetime">2008-05-06T11:01:14+01:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">5</version>
  <user-name>Repository</user-name>
  <creator-name>Mark&#250;s</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
  <milestone-title>2.1.1</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>In changes &quot;063c393bf0a2eb762770c97f925b7c2867361ad4&quot;:http://github.com/rails/rails/commit/063c393bf0a2eb762770c97f925b7c2867361ad4 and &quot;e6a3ce3392812f707b78d64ffb04ee52f4517d20&quot;:http://github.com/rails/rails/commit/e6a3ce3392812f707b78d64ffb04ee52f4517d20 a condition in map_member_action make Base.resources_path_names (default path names) being ignored:

in resources.rb (line 527):
@@@ ruby
action_path = action
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   action_path ||= Base.resources_path_names[action] || action
end
@@@

That &quot;if resource.options[:path_names]&quot; should not be there, it should be like this...

@@@ ruby
action_path = resource.options[:path_names][action] if resource.options[:path_names]
action_path ||= Base.resources_path_names[action] || action
@@@

...which whould make default path names work properly.</original-body>
  <latest-body>In changes &quot;063c393bf0a2eb762770c97f925b7c2867361ad4&quot;:http://github.com/rails/rails/commit/063c393bf0a2eb762770c97f925b7c2867361ad4 and &quot;e6a3ce3392812f707b78d64ffb04ee52f4517d20&quot;:http://github.com/rails/rails/commit/e6a3ce3392812f707b78d64ffb04ee52f4517d20 a condition in map_member_action make Base.resources_path_names (default path names) being ignored:

in resources.rb (line 527):
@@@ ruby
action_path = action
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   action_path ||= Base.resources_path_names[action] || action
end
@@@

That &quot;if resource.options[:path_names]&quot; should not be there, it should be like this...

@@@ ruby
action_path = resource.options[:path_names][action] if resource.options[:path_names]
action_path ||= Base.resources_path_names[action] || action
@@@

...which whould make default path names work properly.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
In changes &lt;a href=&quot;http://github.com/rails/rails/commit/063c393bf0a2eb762770c97f925b7c2867361ad4&quot;&gt;063c393bf0a2eb762770c97f925b7c2867361ad4&lt;/a&gt; and &lt;a href=&quot;http://github.com/rails/rails/commit/e6a3ce3392812f707b78d64ffb04ee52f4517d20&quot;&gt;e6a3ce3392812f707b78d64ffb04ee52f4517d20&lt;/a&gt; a condition in map_member_action make Base.resources_path_names (default path names) being ignored:
&lt;/p&gt;&lt;p&gt;
in resources.rb (line 527):
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;action_path = action
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   action_path ||= Base.resources_path_names[action] || action
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
That &quot;if resource.options[:path_names]&quot; should not be there, it should be like this...
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;action_path = resource.options[:path_names][action] if resource.options[:path_names]
action_path ||= Base.resources_path_names[action] || action&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
...which whould make default path names work properly.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>In changes &quot;063c393bf0a2eb762770c97f925b7c2867361ad4&quot;:http://github.com/rails/rails/commit/063c393bf0a2eb762770c97f925b7c2867361ad4 and &quot;e6a3ce3392812f707b78d64ffb04ee52f4517d20&quot;:http://github.com/rails/rails/commit/e6a3ce3392812f707b78d64ffb04ee52f4517d20 a condition in map_member_action make Base.resources_path_names (default path names) being ignored:

in resources.rb (line 527):
@@@ ruby
action_path = action
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   action_path ||= Base.resources_path_names[action] || action
end
@@@

That &quot;if resource.options[:path_names]&quot; should not be there, it should be like this...

@@@ ruby
action_path = resource.options[:path_names][action] if resource.options[:path_names]
action_path ||= Base.resources_path_names[action] || action
@@@

...which whould make default path names work properly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
In changes &lt;a href=&quot;http://github.com/rails/rails/commit/063c393bf0a2eb762770c97f925b7c2867361ad4&quot;&gt;063c393bf0a2eb762770c97f925b7c2867361ad4&lt;/a&gt; and &lt;a href=&quot;http://github.com/rails/rails/commit/e6a3ce3392812f707b78d64ffb04ee52f4517d20&quot;&gt;e6a3ce3392812f707b78d64ffb04ee52f4517d20&lt;/a&gt; a condition in map_member_action make Base.resources_path_names (default path names) being ignored:
&lt;/p&gt;&lt;p&gt;
in resources.rb (line 527):
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;action_path = action
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   action_path ||= Base.resources_path_names[action] || action
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
That &quot;if resource.options[:path_names]&quot; should not be there, it should be like this...
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;action_path = resource.options[:path_names][action] if resource.options[:path_names]
action_path ||= Base.resources_path_names[action] || action&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
...which whould make default path names work properly.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-04T22:10:42+01:00</created-at>
      <creator-id type="integer">7046</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">111</number>
      <permalink>default-path-names-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Default path names ignored</title>
      <updated-at type="datetime">2008-05-04T22:10:42+01:00</updated-at>
      <user-id type="integer">7046</user-id>
      <version type="integer">1</version>
      <user-name>Mark&#250;s</user-name>
      <creator-name>Mark&#250;s</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Could you include a test case too please?  otherwise we run the risk of breaking it again.

Also if you follow the guide &quot;here&quot;:http://rails.lighthouseapp.com/projects/8994/sending-patches it'll make it easier to get your the credits in the history.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Could you include a test case too please?  otherwise we run the risk of breaking it again.
&lt;/p&gt;&lt;p&gt;
Also if you follow the guide &lt;a href=&quot;http://rails.lighthouseapp.com/projects/8994/sending-patches&quot;&gt;here&lt;/a&gt; it'll make it easier to get your the credits in the history.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-04T22:58:13+01:00</created-at>
      <creator-id type="integer">7046</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">111</number>
      <permalink>default-path-names-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Default path names ignored</title>
      <updated-at type="datetime">2008-05-04T22:58:13+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">2</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Mark&#250;s</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Well Michael, I think this little change do not need a indiviual test case in the rails tests. This change is a refactoring, not an addition of features. As you see in the example in this ticket, the &quot;if&quot; statement is redundant and make something like this:

@@@ ruby
# considering as resources_path_names = { :new =&gt; 'nuevo', :edit =&gt; 'editar' } and
# the resource definition is map.resources :things, :as =&gt; 'cosas'

# if action here is, for example, 'edit', it is asigned to action_path
action_path = action
# options[:path_names] is not defined in the resource declaration, threrefore the action_path remains as 'edit'
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   # Here resides the bug
   # The apperance of &quot;action&quot; here is redundant, since it was asigned to action_path before
   # Base.resource_path_names[action] is not evaluated unless the resource declaration has the :path_names parameter defined directly, 
   action_path ||= Base.resources_path_names[action] || action
end

# in rake:routes the route appears as 'cosas/thing_id/edit'
@@@

Well, now, with my refactorization:

@@@ ruby
# Only evalue resource.options[:path_names] if exists
action_path = resource.options[:path_names][action] if resource.options[:path_names]
# Perform default asignment
# If previous line was evaluated, this line do nothing
# If previous line was not evaluated and exists a Base.resources_path_names for this action, the value is asigned
# If none of the previous examples were evaluated, then the action_path is the action itslef (as ocurrs with the first line the original code)
action_path ||= Base.resources_path_names[action] || action

# considering the same definitions in the previous example, here the rake:routes shows 'cosa/thing_id/editar' as spected
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Well Michael, I think this little change do not need a indiviual test case in the rails tests. This change is a refactoring, not an addition of features. As you see in the example in this ticket, the &quot;if&quot; statement is redundant and make something like this:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;# considering as resources_path_names = { :new =&amp;gt; 'nuevo', :edit =&amp;gt; 'editar' } and
# the resource definition is map.resources :things, :as =&amp;gt; 'cosas'

# if action here is, for example, 'edit', it is asigned to action_path
action_path = action
# options[:path_names] is not defined in the resource declaration, threrefore the action_path remains as 'edit'
if resource.options[:path_names]
   action_path = resource.options[:path_names][action]
   # Here resides the bug
   # The apperance of &amp;quot;action&amp;quot; here is redundant, since it was asigned to action_path before
   # Base.resource_path_names[action] is not evaluated unless the resource declaration has the :path_names parameter defined directly, 
   action_path ||= Base.resources_path_names[action] || action
end

# in rake:routes the route appears as 'cosas/thing_id/edit'&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Well, now, with my refactorization:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;# Only evalue resource.options[:path_names] if exists
action_path = resource.options[:path_names][action] if resource.options[:path_names]
# Perform default asignment
# If previous line was evaluated, this line do nothing
# If previous line was not evaluated and exists a Base.resources_path_names for this action, the value is asigned
# If none of the previous examples were evaluated, then the action_path is the action itslef (as ocurrs with the first line the original code)
action_path ||= Base.resources_path_names[action] || action

# considering the same definitions in the previous example, here the rake:routes shows 'cosa/thing_id/editar' as spected&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-04T23:29:08+01:00</created-at>
      <creator-id type="integer">7046</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">111</number>
      <permalink>default-path-names-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Default path names ignored</title>
      <updated-at type="datetime">2008-05-04T23:29:08+01:00</updated-at>
      <user-id type="integer">7046</user-id>
      <version type="integer">3</version>
      <user-name>Mark&#250;s</user-name>
      <creator-name>Mark&#250;s</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I've created a new patch with a new test reflecting the bug I've found and ensuring the correct use of ActionController::Base.resources_path_names. I've followed the guide for contributing to rails.

If you finally apply this patch and you want to reference me, my GitHub profile is &quot;yizzreel&quot;:http://github.com/yizzreel

Cheers</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I've created a new patch with a new test reflecting the bug I've found and ensuring the correct use of ActionController::Base.resources_path_names. I've followed the guide for contributing to rails.
&lt;/p&gt;&lt;p&gt;
If you finally apply this patch and you want to reference me, my GitHub profile is &lt;a href=&quot;http://github.com/yizzreel&quot;&gt;yizzreel&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
Cheers
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-05T09:05:47+01:00</created-at>
      <creator-id type="integer">7046</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">111</number>
      <permalink>default-path-names-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Default path names ignored</title>
      <updated-at type="datetime">2008-05-05T09:05:47+01:00</updated-at>
      <user-id type="integer">7046</user-id>
      <version type="integer">4</version>
      <user-name>Mark&#250;s</user-name>
      <creator-name>Mark&#250;s</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [2c39836dc3c06813fce031d1bb390149b53ebd1c]) Refactored and fixed Resources.map_member_actions to make use of custom ActionController::Base.resources_path_names when the option :path_names is not directly specified. Added a specific test for this functionality and fixed assert_restful_routes_for test helper to make use of ActionController::Base.resources_path_names instead of just &quot;new&quot; or &quot;edit&quot;.

Signed-off-by: Michael Koziarski &lt;michael@koziarski.com&gt;
[#111 state:resolved]
http://github.com/rails/rails/commit/2c39836dc3c06813fce031d1bb390149b53ebd1c</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [2c39836dc3c06813fce031d1bb390149b53ebd1c]) Refactored and fixed Resources.map_member_actions to make use of custom ActionController::Base.resources_path_names when the option :path_names is not directly specified. Added a specific test for this functionality and fixed assert_restful_routes_for test helper to make use of ActionController::Base.resources_path_names instead of just &quot;new&quot; or &quot;edit&quot;.
&lt;/p&gt;&lt;p&gt;
Signed-off-by: Michael Koziarski 
&lt;/p&gt;&lt;p&gt;
[#111 state:resolved]
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/2c39836dc3c06813fce031d1bb390149b53ebd1c&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-06T11:01:14+01:00</created-at>
      <creator-id type="integer">7046</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9901</milestone-id>
      <number type="integer">111</number>
      <permalink>default-path-names-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Default path names ignored</title>
      <updated-at type="datetime">2008-05-06T11:01:14+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">5</version>
      <user-name>Repository</user-name>
      <creator-name>Mark&#250;s</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/111</url>
      <milestone-title>2.1.1</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>8548b2b449a2651e7c37726e3bba06a1e87f8e78</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-05T09:05:47+01:00</created-at>
      <filename>refactored-and-fixed-Resources.map_member_actions.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">21441</id>
      <size type="integer">4170</size>
      <uploader-id type="integer">7046</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/21441/refactored-and-fixed-Resources.map_member_actions.patch</url>
    </attachment>
  </attachments>
</ticket>
