<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-07-08T18:28:57+01:00</created-at>
  <creator-id type="integer">25655</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">9903</milestone-id>
  <number type="integer">575</number>
  <permalink>callbacks-don-t-work-from-extended-modules</permalink>
  <priority type="integer">69</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>activesupport callbacks patch</tag>
  <title>callbacks don't work from extended modules</title>
  <updated-at type="datetime">2008-07-22T16:30:03+01:00</updated-at>
  <user-id type="integer">424</user-id>
  <version type="integer">9</version>
  <user-name>Joshua Peek</user-name>
  <creator-name>Christopher J. Bottaro</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
  <milestone-title>2.x</milestone-title>
  <priority-name nil="true"></priority-name>
  <original-body>If an AR instance extends a module that adds callbacks to the object's metaclass, then those callbacks do not get called when the callback chain is invoked.

I have included a patch that fixes the problem as well as adds a test case.  All tests pass in activesupport after the patch.

Please see the test case included in the patch for a very clear description of the problem.</original-body>
  <latest-body>If an AR instance extends a module that adds callbacks to the object's metaclass, then those callbacks do not get called when the callback chain is invoked.

I have included a patch that fixes the problem as well as adds a test case.  All tests pass in activesupport after the patch.

Please see the test case included in the patch for a very clear description of the problem.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
If an AR instance extends a module that adds callbacks to the object's metaclass, then those callbacks do not get called when the callback chain is invoked.
&lt;/p&gt;&lt;p&gt;
I have included a patch that fixes the problem as well as adds a test case.  All tests pass in activesupport after the patch.
&lt;/p&gt;&lt;p&gt;
Please see the test case included in the patch for a very clear description of the problem.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>If an AR instance extends a module that adds callbacks to the instance's metaclass, then those callbacks do not get called when the callback chain is invoked.

I have included a patch that fixes the problem as well as adds a test case.  All tests pass in activesupport after the patch.

Please see the test case included in the patch for a very clear description of the problem.

This patch is meant to be applied from SRC_ROOT/activesupport with -p0.

This patch is for Rails 2.1.0.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
If an AR instance extends a module that adds callbacks to the instance's metaclass, then those callbacks do not get called when the callback chain is invoked.
&lt;/p&gt;&lt;p&gt;
I have included a patch that fixes the problem as well as adds a test case.  All tests pass in activesupport after the patch.
&lt;/p&gt;&lt;p&gt;
Please see the test case included in the patch for a very clear description of the problem.
&lt;/p&gt;&lt;p&gt;
This patch is meant to be applied from SRC_ROOT/activesupport with -p0.
&lt;/p&gt;&lt;p&gt;
This patch is for Rails 2.1.0.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-08T18:32:26+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-08T18:32:26+01:00</updated-at>
      <user-id type="integer">25655</user-id>
      <version type="integer">1</version>
      <user-name>Christopher J. Bottaro</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I forgot to mention, this patch is for Rails 2.1.0.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I forgot to mention, this patch is for Rails 2.1.0.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-08T18:29:57+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-08T18:29:57+01:00</updated-at>
      <user-id type="integer">25655</user-id>
      <version type="integer">2</version>
      <user-name>Christopher J. Bottaro</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-14T14:49:48+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-14T14:49:48+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [be078ee162fcae883a5621a30929879cd783a238]) Run callbacks from object's metaclass [#575 state:resolved]
http://github.com/rails/rails/commit/be078ee162fcae883a5621a30929879cd783a238</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [be078ee162fcae883a5621a30929879cd783a238]) Run callbacks from object's metaclass [#575 state:resolved]
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/be078ee162fcae883a5621a30929879cd783a238&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-16T03:58:14+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-16T03:58:14+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>We had to revert this. Apparently it broke a ton of shit.

Maybe we don't want callbacks on the metaclass, but a set of callbacks for objects as well as classes.

Lets try a new API

@@@ ruby
module ModuleWithCallbacks
  def self.extended(obj)
    obj.before_save :module_callback
  end

  def module_callback
    # ...
  end
end

p = Person.new
p.extend(ModuleWithCallbacks)

# or also do
p.before_save :module_callback
def p.module_callback
  ...
end
@@@

We could have a instance variable on the object that tracks its callbacks</body>
      <body-html>&lt;div&gt;&lt;p&gt;
We had to revert this. Apparently it broke a ton of shit.
&lt;/p&gt;&lt;p&gt;
Maybe we don't want callbacks on the metaclass, but a set of callbacks for objects as well as classes.
&lt;/p&gt;&lt;p&gt;
Lets try a new API
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;module ModuleWithCallbacks
  def self.extended(obj)
    obj.before_save :module_callback
  end

  def module_callback
    # ...
  end
end

p = Person.new
p.extend(ModuleWithCallbacks)

# or also do
p.before_save :module_callback
def p.module_callback
  ...
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
We could have a instance variable on the object that tracks its callbacks
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-17T03:26:32+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-17T03:26:32+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">5</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Just out of curiosity, what did it break?

It broke our webapp because we try to serialize AR instances and it complained about not being able to serialize the object's metaclass.  We just decided that we shouldn't have been serializing AR instances in the first place, heh.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Just out of curiosity, what did it break?
&lt;/p&gt;&lt;p&gt;
It broke our webapp because we try to serialize AR instances and it complained about not being able to serialize the object's metaclass.  We just decided that we shouldn't have been serializing AR instances in the first place, heh.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-17T03:55:34+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-17T03:55:34+01:00</updated-at>
      <user-id type="integer">25655</user-id>
      <version type="integer">6</version>
      <user-name>Christopher J. Bottaro</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Btw, your solution of having callback chains on classes as well as instances of classes (objects) sounds great.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Btw, your solution of having callback chains on classes as well as instances of classes (objects) sounds great.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-17T03:59:52+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-17T03:59:52+01:00</updated-at>
      <user-id type="integer">25655</user-id>
      <version type="integer">7</version>
      <user-name>Christopher J. Bottaro</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Check out the latest Memoizable stuff for reference.

http://github.com/rails/rails/tree/master/activesupport/lib/active_support/memoizable.rb

I've been playing around with a pattern that works for Classes and Objects.

I don't have time to work on this right now, but I do plan to get back to in in the next coming weeks.

(BTW, I'm getting obsessed with &quot;object-oriented&quot;/prototype driven development)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Check out the latest Memoizable stuff for reference.
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/tree/master/activesupport/lib/active_support/memoizable.rb&quot;&gt;http://github.com/rails/rails/tr...&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
I've been playing around with a pattern that works for Classes and Objects.
&lt;/p&gt;&lt;p&gt;
I don't have time to work on this right now, but I do plan to get back to in in the next coming weeks.
&lt;/p&gt;&lt;p&gt;
(BTW, I'm getting obsessed with &quot;object-oriented&quot;/prototype driven development)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-07-19T01:30:49+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-19T01:30:49+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">8</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>It looks like this is going take alot more work. If you ever decide its worth pursuing, open and new ticket for refactoring Callbacks and assign it to me.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
It looks like this is going take alot more work. If you ever decide its worth pursuing, open and new ticket for refactoring Callbacks and assign it to me.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-22T16:30:03+01:00</created-at>
      <creator-id type="integer">25655</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">575</number>
      <permalink>callbacks-don-t-work-from-extended-modules</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>activesupport callbacks patch</tag>
      <title>callbacks don't work from extended modules</title>
      <updated-at type="datetime">2008-07-22T16:30:03+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">9</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Christopher J. Bottaro</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/575</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>f89ee4d5172b60953d626262ab677394199f7a55</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-07-08T18:28:57+01:00</created-at>
      <filename>metaclass_callbacks_patch.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">31439</id>
      <size type="integer">1774</size>
      <uploader-id type="integer">25655</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/31439/metaclass_callbacks_patch.diff</url>
    </attachment>
  </attachments>
</ticket>
