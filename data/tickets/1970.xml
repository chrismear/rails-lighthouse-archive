<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2011-02-17T06:48:22+00:00</created-at>
  <creator-id type="integer">11904</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1970</number>
  <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>2.3 engines routing</tag>
  <title>App routes.rb not loaded when both engine and inflections present</title>
  <updated-at type="datetime">2011-03-26T01:43:46+00:00</updated-at>
  <user-id type="integer">142823</user-id>
  <version type="integer">6</version>
  <user-name>bingbing</user-name>
  <creator-name>Thijs</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
  <priority-name nil="true"></priority-name>
  <original-body>config/routes.rb is not loaded in an app where an engine plugin with a config/routes.rb is present and config/initializers/inflections.rb contains a ActiveSupport::Inflector.inflections block.

In development mode the plugin routes always get loaded and the application routes only if the app routes.rb has a higher modification date then the plugin file.

In production mode the app routes never get loaded at all.

I've attached a test project, this problem occur with 2.3 RC1 and the current master.

To see this in action:
* open test project
* run touch vendor/plugins/testplugin/config/routes.rb
* run script/server and open http://localhost:3000, a Routing Error occurs.
* run touch config/routes.rb
* open http://localhost:3000, and the map.root in the app routes is used.

Then without inflections:
* comment the contents of config/initializers/inflections.rb
* run touch vendor/plugins/testplugin/config/routes.rb
* open http://localhost:3000, and the map.root in the app routes is used.</original-body>
  <latest-body>config/routes.rb is not loaded in an app where an engine plugin with a config/routes.rb is present and config/initializers/inflections.rb contains a ActiveSupport::Inflector.inflections block.

In development mode the plugin routes always get loaded and the application routes only if the app routes.rb has a higher modification date then the plugin file.

In production mode the app routes never get loaded at all.

I've attached a test project, this problem occur with 2.3 RC1 and the current master.

To see this in action:
* open test project
* run touch vendor/plugins/testplugin/config/routes.rb
* run script/server and open http://localhost:3000, a Routing Error occurs.
* run touch config/routes.rb
* open http://localhost:3000, and the map.root in the app routes is used.

Then without inflections:
* comment the contents of config/initializers/inflections.rb
* run touch vendor/plugins/testplugin/config/routes.rb
* open http://localhost:3000, and the map.root in the app routes is used.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;config/routes.rb is not loaded in an app where an engine plugin
with a config/routes.rb is present and
config/initializers/inflections.rb contains a
ActiveSupport::Inflector.inflections block.&lt;/p&gt;
&lt;p&gt;In development mode the plugin routes always get loaded and the
application routes only if the app routes.rb has a higher
modification date then the plugin file.&lt;/p&gt;
&lt;p&gt;In production mode the app routes never get loaded at all.&lt;/p&gt;
&lt;p&gt;I've attached a test project, this problem occur with 2.3 RC1
and the current master.&lt;/p&gt;
&lt;p&gt;To see this in action: * open test project * run touch
vendor/plugins/testplugin/config/routes.rb * run script/server and
open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, a
Routing Error occurs. * run touch config/routes.rb * open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, and the map.root
in the app routes is used.&lt;/p&gt;
&lt;p&gt;Then without inflections: * comment the contents of
config/initializers/inflections.rb * run touch
vendor/plugins/testplugin/config/routes.rb * open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, and the map.root
in the app routes is used.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>config/routes.rb is not loaded in an app where an engine plugin with a config/routes.rb is present and config/initializers/inflections.rb contains a ActiveSupport::Inflector.inflections block.

In development mode the plugin routes always get loaded and the application routes only if the app routes.rb has a higher modification date then the plugin file.

In production mode the app routes never get loaded at all.

I've attached a test project, this problem occur with 2.3 RC1 and the current master.

To see this in action:
 * open test project
 * run touch vendor/plugins/testplugin/config/routes.rb
 * run script/server and open http://localhost:3000, a Routing Error occurs.
 * run touch config/routes.rb
 * open http://localhost:3000, and the map.root in the app routes is used.

Then without inflections:
 * comment the contents of config/initializers/inflections.rb
 * run touch vendor/plugins/testplugin/config/routes.rb
 * open http://localhost:3000, and the map.root in the app routes is used.</body>
      <body-html>&lt;div&gt;&lt;p&gt;config/routes.rb is not loaded in an app where an engine plugin
with a config/routes.rb is present and
config/initializers/inflections.rb contains a
ActiveSupport::Inflector.inflections block.&lt;/p&gt;
&lt;p&gt;In development mode the plugin routes always get loaded and the
application routes only if the app routes.rb has a higher
modification date then the plugin file.&lt;/p&gt;
&lt;p&gt;In production mode the app routes never get loaded at all.&lt;/p&gt;
&lt;p&gt;I've attached a test project, this problem occur with 2.3 RC1
and the current master.&lt;/p&gt;
&lt;p&gt;To see this in action: * open test project * run touch
vendor/plugins/testplugin/config/routes.rb * run script/server and
open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, a
Routing Error occurs. * run touch config/routes.rb * open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, and the map.root
in the app routes is used.&lt;/p&gt;
&lt;p&gt;Then without inflections: * comment the contents of
config/initializers/inflections.rb * run touch
vendor/plugins/testplugin/config/routes.rb * open &lt;a href=&quot;http://localhost:3000&quot;&gt;http://localhost:3000&lt;/a&gt;, and the map.root
in the app routes is used.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-14T13:06:05+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2009-02-14T13:06:49+00:00</updated-at>
      <user-id type="integer">11904</user-id>
      <version type="integer">1</version>
      <user-name>Thijs</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I digged in a little deeper and found the cause of this issue: initialize_routing in railties/lib/initializer.rb calls the reload method without a bang.

The reload method in ActionController::Routing::RouteSet checks the last modification date of the route files and this halts the reloading of the routes if they're older than @routes_last_modified.

Because the inflections calls the reload! method, I think before initialize_routing is called, initialize_routing messes up the routes in this scenario.

I don't think I fully understand what's causing this exactly, but this problem can be fixed by changing line 495 of railties/lib/initializer.rb from:

ActionController::Routing::Routes.reload

to:

ActionController::Routing::Routes.reload!</body>
      <body-html>&lt;div&gt;&lt;p&gt;I digged in a little deeper and found the cause of this issue:
initialize_routing in railties/lib/initializer.rb calls the reload
method without a bang.&lt;/p&gt;
&lt;p&gt;The reload method in ActionController::Routing::RouteSet checks
the last modification date of the route files and this halts the
reloading of the routes if they're older than
@routes_last_modified.&lt;/p&gt;
&lt;p&gt;Because the inflections calls the reload! method, I think before
initialize_routing is called, initialize_routing messes up the
routes in this scenario.&lt;/p&gt;
&lt;p&gt;I don't think I fully understand what's causing this exactly,
but this problem can be fixed by changing line 495 of
railties/lib/initializer.rb from:&lt;/p&gt;
&lt;p&gt;ActionController::Routing::Routes.reload&lt;/p&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;p&gt;ActionController::Routing::Routes.reload!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-14T14:20:40+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: engines routing
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2009-02-14T14:20:43+00:00</updated-at>
      <user-id type="integer">11904</user-id>
      <version type="integer">2</version>
      <user-name>Thijs</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-02-14T14:54:05+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.3 engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2009-02-14T14:54:09+00:00</updated-at>
      <user-id type="integer">83</user-id>
      <version type="integer">3</version>
      <user-name>DHH</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [b61cad6ae140bc71c6a74b22c75e886b41154b0a]) Ensure that the app routes file is loaded even when engines are in play (Thjis) [#1970 state:committed]
http://github.com/rails/rails/commit/b61cad6ae140bc71c6a74b22c75e886b41154b0a</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [b61cad6ae140bc71c6a74b22c75e886b41154b0a]) Ensure that
the app routes file is loaded even when engines are in play (Thjis)
[&lt;a href=&quot;/projects/8994/tickets/1970&quot; title=&quot;Ticket #1970&quot;&gt;#1970&lt;/a&gt; state:committed] &lt;a href=&quot;http://github.com/rails/rails/commit/b61cad6ae140bc71c6a74b22c75e886b41154b0a&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-02-22T15:04:19+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>2.3 engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2009-02-22T15:04:20+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">4</version>
      <user-name>Repository</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Good &lt;a href=http://www.sale-puma.com&gt;Puma shoes sale&lt;/a&gt; information for &lt;a href=http://www.sale-puma.com&gt;Puma shoes&lt;/a&gt; fans: Yesterday, German sportswear maker Cheap Running Shoes purchased effectively lot of money Brands. The transaction entails the Cobra brand, too as linked inventory, intellectual house and endorsement contracts. It also helps make &lt;a href=http://www.sale-puma.com&gt;puma speed cat&lt;/a&gt; Shoes . They provide you with the utmost game and support all through the feet.You can happen around several types of basketball sneakers such as high-top,low-top and mid-top.The &lt;a href=http://www.sale-puma.com&gt;Puma shoes online&lt;/a&gt; and boots give you best ankle support will support want you to obtain steadiness.
As we konw,Trail &lt;a href=http://www.sale-puma.com&gt;Puma Drift Cat&lt;/a&gt; Shoes black, Trail &lt;a href=http://www.sale-puma.com&gt;Puma future cat&lt;/a&gt; ShoesWhite Black? 50 many years backshore are actually released within a great accomplishment. Trail Running Shoes speed cat shoes?go in add-on to King Pele into planet tournament finals, bottom tennis discs matchrs within pasture inhabit an vital area in hold out in Wimbledon Dun; Its working firms have premier manufacturers and major marketplace positions in distilled spirits, residence and security, and golf products. The reply go all through the &lt;a href=http://www.sale-puma.com&gt;Cheap puma shoes&lt;/a&gt; on sale-here you are able to happen around several distcoun.&lt;a href=http://www.sale-puma.com&gt;puma shoes on sale &lt;/a&gt;.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Good &lt;a href=&quot;http:&quot;&gt;Puma shoes sale information for &lt;a href=
&quot;http:&quot;&gt;Puma shoes fans: Yesterday, German sportswear maker Cheap
Running Shoes purchased effectively lot of money Brands. The
transaction entails the Cobra brand, too as linked inventory,
intellectual house and endorsement contracts. It also helps make
&lt;a href=&quot;http:&quot;&gt;puma speed cat Shoes . They provide you with the
utmost game and support all through the feet.You can happen around
several types of basketball sneakers such as high-top,low-top and
mid-top.The &lt;a href=&quot;http:&quot;&gt;Puma shoes online and boots give you
best ankle support will support want you to obtain steadiness.&lt;br&gt;
As we konw,Trail &lt;a href=&quot;http:&quot;&gt;Puma Drift Cat Shoes black, Trail
&lt;a href=&quot;http:&quot;&gt;Puma future cat ShoesWhite Black? 50 many years
backshore are actually released within a great accomplishment.
Trail Running Shoes speed cat shoes?go in add-on to King Pele into
planet tournament finals, bottom tennis discs matchrs within
pasture inhabit an vital area in hold out in Wimbledon Dun; Its
working firms have premier manufacturers and major marketplace
positions in distilled spirits, residence and security, and golf
products. The reply go all through the &lt;a href=&quot;http:&quot;&gt;Cheap puma
shoes on sale-here you are able to happen around several
distcoun.&lt;a href=&quot;http:&quot;&gt;puma shoes on sale .&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-17T06:42:36+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>2.3 engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2011-02-17T06:48:22+00:00</updated-at>
      <user-id type="integer">137442</user-id>
      <version type="integer">5</version>
      <user-name>gfh</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;gucci watches&lt;/a&gt;&lt;/b&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;b&gt;&lt;a href=&quot;http://www.watcheseshop.com/&quot;&gt;gucci
watches&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-03-26T01:31:14+00:00</created-at>
      <creator-id type="integer">11904</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1970</number>
      <permalink>app-routesrb-not-loaded-when-both-engine-and-inflections-present</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>2.3 engines routing</tag>
      <title>App routes.rb not loaded when both engine and inflections present</title>
      <updated-at type="datetime">2011-03-26T01:43:46+00:00</updated-at>
      <user-id type="integer">142823</user-id>
      <version type="integer">6</version>
      <user-name>bingbing</user-name>
      <creator-name>Thijs</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1970</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>eac4ccbe5614d01b6fb54036eedc64a298f082d2</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-02-14T13:06:05+00:00</created-at>
      <filename>routestest.zip</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">88861</id>
      <size type="integer">266518</size>
      <uploader-id type="integer">11904</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/88861/routestest.zip</url>
    </attachment>
  </attachments>
</ticket>
