<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">12714</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2010-10-31T05:57:56+00:00</created-at>
  <creator-id type="integer">85</creator-id>
  <milestone-due-on type="datetime">2011-03-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">103410</milestone-id>
  <number type="integer">4554</number>
  <permalink>render-text-proc-regression</permalink>
  <priority type="integer">2</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>open</state>
  <tag nil="true"></tag>
  <title>render :text =&gt; proc { ... } regression</title>
  <updated-at type="datetime">2011-02-27T03:15:38+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">19</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Jeremy Kemper</creator-name>
  <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
  <milestone-title>3.0.6</milestone-title>
  <priority-name>Medium</priority-name>
  <original-body>`render :text =&gt; someproc` used to serve a streaming response. Now it calls `to_s` on the proc.

Should deprecate in favor of setting `self.response_body = ...` directly.</original-body>
  <latest-body>`render :text =&gt; someproc` used to serve a streaming response. Now it calls `to_s` on the proc.

Should deprecate in favor of setting `self.response_body = ...` directly.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;&lt;code&gt;render :text =&amp;gt; someproc&lt;/code&gt; used to serve a
streaming response. Now it calls &lt;code&gt;to_s&lt;/code&gt; on the proc.&lt;/p&gt;
&lt;p&gt;Should deprecate in favor of setting &lt;code&gt;self.response_body =
...&lt;/code&gt; directly.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>`render :text =&gt; someproc` used to serve a streaming response. Now it calls `to_s` on the proc.

Should deprecate in favor of setting `self.response_body = ...` directly.</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;code&gt;render :text =&amp;gt; someproc&lt;/code&gt; used to serve a
streaming response. Now it calls &lt;code&gt;to_s&lt;/code&gt; on the proc.&lt;/p&gt;
&lt;p&gt;Should deprecate in favor of setting &lt;code&gt;self.response_body =
...&lt;/code&gt; directly.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-07T23:29:59+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-05-07T23:30:03+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">1</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27625)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27625&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T04:10:32+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 27004
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-08-30T04:10:32+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">2</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>We (Sean Grieve and myself) _think_ we fixed this in the way you want. We made the patch on the 3-0-stable branch. If that's incorrect, let us know and we'll make it work on master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We (Sean Grieve and myself) &lt;em&gt;think&lt;/em&gt; we fixed this in the
way you want. We made the patch on the 3-0-stable branch. If that's
incorrect, let us know and we'll make it work on master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-14T01:08:24+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-09-14T01:08:25+01:00</updated-at>
      <user-id type="integer">9751</user-id>
      <version type="integer">3</version>
      <user-name>Trotter Cashion</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Your patch applies cleanly to master and the tests are passing.

+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;Your patch applies cleanly to master and the tests are
passing.&lt;/p&gt;
&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-17T04:10:18+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-09-17T04:10:21+01:00</updated-at>
      <user-id type="integer">44801</user-id>
      <version type="integer">4</version>
      <user-name>Lake</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I definitely need streaming response behavior in Rails3. If this is the patch neccessary to get it again, would be awesome if someone committed it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I definitely need streaming response behavior in Rails3. If this
is the patch neccessary to get it again, would be awesome if
someone committed it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-27T16:21:03+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-09-27T16:21:08+01:00</updated-at>
      <user-id type="integer">30482</user-id>
      <version type="integer">5</version>
      <user-name>jrochkind</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-15T23:01:53+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 82861
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-15T23:01:53+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">6</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Automatic cleanup of spam.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Automatic cleanup of spam.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T08:34:44+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-19T08:34:47+01:00</updated-at>
      <user-id type="integer">14998</user-id>
      <version type="integer">8</version>
      <user-name>Ryan Bigg</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-21T19:28:02+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-21T19:28:07+01:00</updated-at>
      <user-id type="integer">36009</user-id>
      <version type="integer">9</version>
      <user-name>Rodrigo Rosenfeld Rosas</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sorry, I need to be more specific. We need to remove the mention &quot;Tip: if you want to stream large amounts of on-the-fly generated data to the browser, then use render :text =&gt; proc { ... } instead. See ActionController::Base#render for more information.&quot;

http://api.rubyonrails.org/classes/ActionController/Streaming.html

And we need some alternative to data streaming. Unfortunately, just using &quot;self.response_body = proc {|response, output| 5.times{output.write 'Testing&lt;br/&gt;'; sleep 1} }&quot; won't flush, until the end, for instance.

So, the deprecation warning for the proposed patch is not correct enough yet...</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry, I need to be more specific. We need to remove the mention
&quot;Tip: if you want to stream large amounts of on-the-fly generated
data to the browser, then use render :text =&amp;gt; proc { ... }
instead. See ActionController::Base#render for more
information.&quot;&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://api.rubyonrails.org/classes/ActionController/Streaming.html&quot;&gt;
http://api.rubyonrails.org/classes/ActionController/Streaming.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And we need some alternative to data streaming. Unfortunately,
just using &quot;self.response_body = proc {|response, output|
5.times{output.write 'Testing&lt;br&gt;
'; sleep 1} }&quot; won't flush, until the end, for instance.&lt;/p&gt;
&lt;p&gt;So, the deprecation warning for the proposed patch is not
correct enough yet...&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-21T19:35:12+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-21T19:35:17+01:00</updated-at>
      <user-id type="integer">36009</user-id>
      <version type="integer">10</version>
      <user-name>Rodrigo Rosenfeld Rosas</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Rodrigo's point is very good.  I'd go so far as to say the deprecation message is just flat out wrong.  It's not deprecated if the expected behavior is already removed.  And currently there isn't a real way to stream large amounts of generated data.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Rodrigo's point is very good. I'd go so far as to say the
deprecation message is just flat out wrong. It's not deprecated if
the expected behavior is already removed. And currently there isn't
a real way to stream large amounts of generated data.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-30T23:27:20+01:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-30T23:27:23+01:00</updated-at>
      <user-id type="integer">22233</user-id>
      <version type="integer">11</version>
      <user-name>Kevin Menard</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>For a while, but also the mother of expertise. &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london wholesale&lt;/a&gt; I just want to each month deposits could run much and can only use one word portray,  &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london UK&lt;/a&gt;  &quot;&quot; in this way, the adapt graduating, routine, but it is more important friends.In my recall, not to go. Remember, elementary prepare graduation, with the links and we assemble &lt;a href=&quot;http://www.linksoflondonoutlet.com/friendship-bracelets&quot;&gt;links of london friendship bracelet&lt;/a&gt;  every little of everyone of the time for us to change our life. If you want, relations of the mistrust of time is abruptly &#65307; have to sigh and let my high school, &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london&lt;/a&gt;  i can achieve their goals. The two living of the pecuniary crisis happened,Efficiency of the factory, and it is not too much of it, when a circle, to shenzhen,  &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;london links&lt;/a&gt;  like his brother lives together. My monthly gross chart, father said, my mother had died not do the funeral, &lt;a href=&quot;http://www.linksoflondonoutlet.com/charms/heart-charm-p-370&quot;&gt;links of london heart charm&lt;/a&gt;  three being of limitless, he remembered that i should help mother to do something, &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links&lt;/a&gt;  even more profit, and her dress and earn money. Look cheeky to the university came,Although agreed into university, is not good or bad, but in &#65306; &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links of london sale&lt;/a&gt;  You will not be work very simply, and a little bit silly, and doubtless will, since there is a family of london love.</body>
      <body-html>&lt;div&gt;&lt;p&gt;For a while, but also the mother of expertise. &lt;a href=
&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london wholesale&lt;/a&gt; I
just want to each month deposits could run much and can only use
one word portray, &lt;a href=
&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london UK&lt;/a&gt; &quot;&quot; in this
way, the adapt graduating, routine, but it is more important
friends.In my recall, not to go. Remember, elementary prepare
graduation, with the links and we assemble &lt;a href=
&quot;http://www.linksoflondonoutlet.com/friendship-bracelets&quot;&gt;links of
london friendship bracelet&lt;/a&gt; every little of everyone of the time
for us to change our life. If you want, relations of the mistrust
of time is abruptly &amp;#65307; have to sigh and let my high school,
&lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links london&lt;/a&gt; i can
achieve their goals. The two living of the pecuniary crisis
happened,Efficiency of the factory, and it is not too much of it,
when a circle, to shenzhen, &lt;a href=
&quot;http://www.linksoflondonoutlet.com&quot;&gt;london links&lt;/a&gt; like his
brother lives together. My monthly gross chart, father said, my
mother had died not do the funeral, &lt;a href=
&quot;http://www.linksoflondonoutlet.com/charms/heart-charm-p-370&quot;&gt;links
of london heart charm&lt;/a&gt; three being of limitless, he remembered
that i should help mother to do something, &lt;a href=
&quot;http://www.linksoflondonoutlet.com&quot;&gt;links&lt;/a&gt; even more profit,
and her dress and earn money. Look cheeky to the university
came,Although agreed into university, is not good or bad, but in
&amp;#65306; &lt;a href=&quot;http://www.linksoflondonoutlet.com&quot;&gt;links of
london sale&lt;/a&gt; You will not be work very simply, and a little bit
silly, and doubtless will, since there is a family of london
love.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-31T03:12:40+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-10-31T05:57:56+00:00</updated-at>
      <user-id type="integer">122613</user-id>
      <version type="integer">12</version>
      <user-name>wangxindan</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Rodrigo, adding `output.flush` or `output.write &quot;Testing\n&quot;` you should get the response in the client without any wait.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Rodrigo, adding &lt;code&gt;output.flush&lt;/code&gt; or &lt;code&gt;output.write
&quot;Testing\n&quot;&lt;/code&gt; you should get the response in the client
without any wait.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-08T18:14:33+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-11-08T18:14:37+00:00</updated-at>
      <user-id type="integer">17453</user-id>
      <version type="integer">13</version>
      <user-name>blaxter</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@blaxter

I tried adding @@@ output.flush @@@ but I got an error @@@ undefined method 'flush' for #&lt;ActionDispatch::Response ...&gt; @@@

Actually *format* and *response* seem to be the **same** object. Isn't this wrong?

I also tried @@@ output.write &quot;Something\n&quot; @@@ but it also didn't flush and returned the response at the end.

I used wireshark to sniff whether any packets are being sent meanwhile and there was no activity before the final response got sent back. I'm using Webrick but I read that I should try Mongrel to make this work so that's what I'm trying now.

Martin</body>
      <body-html>&lt;div&gt;&lt;p&gt;@blaxter&lt;/p&gt;
&lt;p&gt;I tried adding @@@ output.flush @@@ but I got an error @@@
undefined method 'flush' for #&amp;lt;ActionDispatch::Response ...&amp;gt;
@@@&lt;/p&gt;
&lt;p&gt;Actually &lt;em&gt;format&lt;/em&gt; and &lt;em&gt;response&lt;/em&gt; seem to be the
&lt;strong&gt;same&lt;/strong&gt; object. Isn't this wrong?&lt;/p&gt;
&lt;p&gt;I also tried @@@ output.write &quot;Something\n&quot; @@@ but it also
didn't flush and returned the response at the end.&lt;/p&gt;
&lt;p&gt;I used wireshark to sniff whether any packets are being sent
meanwhile and there was no activity before the final response got
sent back. I'm using Webrick but I read that I should try Mongrel
to make this work so that's what I'm trying now.&lt;/p&gt;
&lt;p&gt;Martin&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-09T11:14:42+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-11-09T11:14:48+00:00</updated-at>
      <user-id type="integer">124142</user-id>
      <version type="integer">14</version>
      <user-name>Martin Gogov</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Sorry for the misformatted previous post.

Just wasted some more hours on checking this:

The *self.response_body = proc { |resp, output| ... }* approach with mongrel (webrick didn't work) worked almost fine for me (no need to *output.flush*, there's no such method in my case anyways).
I'm using *ruby 1.9.2p35* with *rails 3*.

One side problem I still haven't worked around though is that with this approach the code in the proc gets executed twice so I have to put an if which skips every other execution to avoid double execution.

And still, the *resp* and *output* variables point to the **same** object. No idea why.

Martin</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry for the misformatted previous post.&lt;/p&gt;
&lt;p&gt;Just wasted some more hours on checking this:&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;self.response_body = proc { |resp, output| ... }&lt;/em&gt;
approach with mongrel (webrick didn't work) worked almost fine for
me (no need to &lt;em&gt;output.flush&lt;/em&gt;, there's no such method in my
case anyways).&lt;br&gt;
I'm using &lt;em&gt;ruby 1.9.2p35&lt;/em&gt; with &lt;em&gt;rails 3&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;One side problem I still haven't worked around though is that
with this approach the code in the proc gets executed twice so I
have to put an if which skips every other execution to avoid double
execution.&lt;/p&gt;
&lt;p&gt;And still, the &lt;em&gt;resp&lt;/em&gt; and &lt;em&gt;output&lt;/em&gt; variables point
to the &lt;strong&gt;same&lt;/strong&gt; object. No idea why.&lt;/p&gt;
&lt;p&gt;Martin&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-09T14:06:00+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-11-09T14:08:12+00:00</updated-at>
      <user-id type="integer">124142</user-id>
      <version type="integer">15</version>
      <user-name>Martin Gogov</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/34349)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/34349&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-15T21:04:51+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 88038
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-11-15T21:04:51+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">16</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>As Martin alludes to, the proc assigned to `response_body` is mistakenly executed twice. This is because `ActionDispatch::Response` overrides `#body` (defined in `Rack::Response` with `attr_accessor`), and enumerates the body. Thus when `Rack::Response#close` calls `body.close`, a second execution is triggered.

I think that `ActionDispatch::Response` should not override `body`. If it needs to force a string it should define `#body_text` or some other method with a name that makes it clear that it disables streaming.

On the subject of when or if response data is flushed, as far as I can tell it's entirely up to the Rack handler being used. I can confirm that Mongrel does flush automatically.</body>
      <body-html>&lt;div&gt;&lt;p&gt;As Martin alludes to, the proc assigned to
&lt;code&gt;response_body&lt;/code&gt; is mistakenly executed twice. This is
because &lt;code&gt;ActionDispatch::Response&lt;/code&gt; overrides
&lt;code&gt;#body&lt;/code&gt; (defined in &lt;code&gt;Rack::Response&lt;/code&gt; with
&lt;code&gt;attr_accessor&lt;/code&gt;), and enumerates the body. Thus when
&lt;code&gt;Rack::Response#close&lt;/code&gt; calls &lt;code&gt;body.close&lt;/code&gt;, a
second execution is triggered.&lt;/p&gt;
&lt;p&gt;I think that &lt;code&gt;ActionDispatch::Response&lt;/code&gt; should not
override &lt;code&gt;body&lt;/code&gt;. If it needs to force a string it should
define &lt;code&gt;#body_text&lt;/code&gt; or some other method with a name
that makes it clear that it disables streaming.&lt;/p&gt;
&lt;p&gt;On the subject of when or if response data is flushed, as far as
I can tell it's entirely up to the Rack handler being used. I can
confirm that Mongrel does flush automatically.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-11-30T21:41:44+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2010-11-30T21:42:10+00:00</updated-at>
      <user-id type="integer">72273</user-id>
      <version type="integer">17</version>
      <user-name>John Firebaugh</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/42275)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/42275&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-12T21:58:21+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 92071
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2011-02-12T21:58:21+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">18</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/43692)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/43692&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-27T03:15:38+00:00</created-at>
      <creator-id type="integer">85</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 101623
</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4554</number>
      <permalink>render-text-proc-regression</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>render :text =&gt; proc { ... } regression</title>
      <updated-at type="datetime">2011-02-27T03:15:38+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">19</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jeremy Kemper</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4554</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>88dde597304453b1f2b3d58f7d7dce39757acb00</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-09-14T01:08:24+01:00</created-at>
      <filename>deprecate_render_text_with_proc.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">671780</id>
      <size type="integer">2066</size>
      <uploader-id type="integer">9751</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/671780/deprecate_render_text_with_proc.diff</url>
    </attachment>
  </attachments>
</ticket>
