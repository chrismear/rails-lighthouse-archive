<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">19965</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-06-16T11:34:07+01:00</created-at>
  <creator-id type="integer">103473</creator-id>
  <milestone-due-on type="datetime">2010-11-15T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">88038</milestone-id>
  <number type="integer">4870</number>
  <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>actionpack html patch</tag>
  <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
  <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
  <user-id type="integer">85</user-id>
  <version type="integer">12</version>
  <user-name>Jeremy Kemper</user-name>
  <creator-name>&#321;ukasz</creator-name>
  <assigned-user-name>Jos&#233; Valim</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
  <milestone-title>3.0.2</milestone-title>
  <priority-name>Low</priority-name>
  <original-body>There is a bug in ActionView::Helpers::SanitizeHelper.strip_tags.

For example: 

When I tried remove all tags from string :

&quot;&lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;strong&gt;Charakterystyka produktu:&lt;/strong&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;

using ActionView::Helpers::SanitizeHelper.strip_tags, I got TypeError: 'can't convert nil into String'.</original-body>
  <latest-body>There is a bug in ActionView::Helpers::SanitizeHelper.strip_tags.

For example: 

When I tried remove all tags from string :

&quot;&lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;strong&gt;Charakterystyka produktu:&lt;/strong&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;

using ActionView::Helpers::SanitizeHelper.strip_tags, I got TypeError: 'can't convert nil into String'.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;There is a bug in
ActionView::Helpers::SanitizeHelper.strip_tags.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;p&gt;When I tried remove all tags from string :&lt;/p&gt;
&lt;p&gt;&quot;&lt;/p&gt;
&lt;p&gt;using ActionView::Helpers::SanitizeHelper.strip_tags, I got
TypeError: 'can't convert nil into String'.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>There is a bug in ActionView::Helpers::SanitizeHelper.strip_tags.

For example: 

When I tried remove all tags from string :

&quot;&lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; &lt;p&gt;&lt;strong&gt;Charakterystyka produktu:&lt;/strong&gt;&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;

using ActionView::Helpers::SanitizeHelper.strip_tags, I got TypeError: 'can't convert nil into String'.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There is a bug in
ActionView::Helpers::SanitizeHelper.strip_tags.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;p&gt;When I tried remove all tags from string :&lt;/p&gt;
&lt;p&gt;&quot;&lt;/p&gt;
&lt;p&gt;using ActionView::Helpers::SanitizeHelper.strip_tags, I got
TypeError: 'can't convert nil into String'.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-16T11:34:07+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-16T11:34:08+01:00</updated-at>
      <user-id type="integer">103473</user-id>
      <version type="integer">1</version>
      <user-name>&#321;ukasz</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The string:

@@@
&quot;\&lt;p&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; \&lt;p&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; \&lt;p&gt;\&lt;strong&gt;Charakterystyka produktu:\&lt;/strong&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;
@@@

&lt;em&gt;Edited by Rohit Arondekar to fix formating.&lt;/em&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;The string:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&quot;\&amp;lt;p&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&amp;gt; \&amp;lt;p&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&amp;gt; \&amp;lt;p&amp;gt;\&amp;lt;strong&amp;gt;Charakterystyka produktu:\&amp;lt;/strong&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;Edited by Rohit Arondekar to fix formating.&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-16T11:37:31+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-20T11:00:09+01:00</updated-at>
      <user-id type="integer">103473</user-id>
      <version type="integer">2</version>
      <user-name>&#321;ukasz</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hej &#321;ukasz,

can you provide more information about your environment and rails version.
Also it would be helpful if you provide a code example in which the problem occurs.

Note: Please always wrap code in a ticket in a code-block. [see](http://help.lighthouseapp.com/faqs/getting-started/how-do-i-format-text)
You can use the &quot;Preview&quot;-button on the right hand side to see if the code is displayed right in your ticket.

Best,
Sebastian</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hej &amp;#321;ukasz,&lt;/p&gt;
&lt;p&gt;can you provide more information about your environment and
rails version.&lt;br&gt;
Also it would be helpful if you provide a code example in which the
problem occurs.&lt;/p&gt;
&lt;p&gt;Note: Please always wrap code in a ticket in a code-block.
&lt;a href=
&quot;http://help.lighthouseapp.com/faqs/getting-started/how-do-i-format-text&quot;&gt;
see&lt;/a&gt;&lt;br&gt;
You can use the &quot;Preview&quot;-button on the right hand side to see if
the code is displayed right in your ticket.&lt;/p&gt;
&lt;p&gt;Best,&lt;br&gt;
Sebastian&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-20T09:54:16+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-20T09:54:20+01:00</updated-at>
      <user-id type="integer">1203</user-id>
      <version type="integer">3</version>
      <user-name>Sebastian Gr&#228;&#223;l</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sebastian, &#321;ukasz: I have fixed the formating of the string.

Confirmed on Rails master.

@@@
ruby-1.9.2-head &gt; helper.strip_tags(&quot;\&lt;p&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; \&lt;p&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&gt; \&lt;p&gt;\&lt;strong&gt;Charakterystyka produktu:\&lt;/strong&gt;\&lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;)
TypeError: can't convert nil into String
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:99:in `block in consume_quoted_regions'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:83:in `loop'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:83:in `consume_quoted_regions'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:63:in `scan_tag'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:40:in `next'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:19:in `tokenize'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:8:in `sanitize'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:33:in `sanitize'
	from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_view/helpers/sanitize_helper.rb:76:in `strip_tags'
	from (irb):11
	from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands/console.rb:47:in `start'
	from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands/console.rb:8:in `start'
	from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands.rb:23:in `&lt;top (required)&gt;'
	from script/rails:6:in `require'
	from script/rails:6:in `&lt;main&gt;'
@@@

This looks like a html parsing problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sebastian, &amp;#321;ukasz: I have fixed the formating of the
string.&lt;/p&gt;
&lt;p&gt;Confirmed on Rails master.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ruby-1.9.2-head &amp;gt; helper.strip_tags(&quot;\&amp;lt;p&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&amp;gt; \&amp;lt;p&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;grejborder2\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\&quot;\\\\\&quot;\\\&quot;\\``&amp;gt; \&amp;lt;p&amp;gt;\&amp;lt;strong&amp;gt;Charakterystyka produktu:\&amp;lt;/strong&amp;gt;\&amp;lt;span class=\\``\\\&quot;\\\\\&quot;\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\&quot;)
TypeError: can't convert nil into String
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:99:in `block in consume_quoted_regions'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:83:in `loop'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:83:in `consume_quoted_regions'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:63:in `scan_tag'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/tokenizer.rb:40:in `next'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:19:in `tokenize'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:8:in `sanitize'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_controller/vendor/html-scanner/html/sanitizer.rb:33:in `sanitize'
    from /home/rohit/remote-repos/rails_patches/working4/actionpack/lib/action_view/helpers/sanitize_helper.rb:76:in `strip_tags'
    from (irb):11
    from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands/console.rb:47:in `start'
    from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands/console.rb:8:in `start'
    from /home/rohit/remote-repos/rails_patches/working4/railties/lib/rails/commands.rb:23:in `&amp;lt;top (required)&amp;gt;'
    from script/rails:6:in `require'
    from script/rails:6:in `&amp;lt;main&amp;gt;'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This looks like a html parsing problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-20T11:09:18+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-20T11:09:24+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">4</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Sorry for invalid code sample, Im newbie here, next tickets will be better :).
Sebastian, Rohit thanks for notes and replies.
Fixing this bug would help me finish sth important in my project. 

Best,

Lukasz</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sorry for invalid code sample, Im newbie here, next tickets will
be better :).&lt;br&gt;
Sebastian, Rohit thanks for notes and replies.&lt;br&gt;
Fixing this bug would help me finish sth important in my
project.&lt;/p&gt;
&lt;p&gt;Best,&lt;/p&gt;
&lt;p&gt;Lukasz&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-21T08:43:03+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-21T08:43:11+01:00</updated-at>
      <user-id type="integer">103473</user-id>
      <version type="integer">5</version>
      <user-name>&#321;ukasz</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've made a patch to fix this bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've made a patch to fix this bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-26T18:02:59+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: actionpack html
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-26T18:03:21+01:00</updated-at>
      <user-id type="integer">14798</user-id>
      <version type="integer">6</version>
      <user-name>Bruno Michel</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Jos&#233;, do you have the time to look at this patch before the release candidate?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Jos&amp;eacute;, do you have the time to look at this patch before
the release candidate?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-28T09:41:43+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-28T09:41:51+01:00</updated-at>
      <user-id type="integer">14798</user-id>
      <version type="integer">7</version>
      <user-name>Bruno Michel</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Changing vendored gems is not a good practice. So there are a few questions:

1) Is the html-scanner available somewhere as a gem?

2) If so, can't we fix it in the gem? Shouldn't we add test cases straight to the html-scanner code?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Changing vendored gems is not a good practice. So there are a
few questions:&lt;/p&gt;
&lt;p&gt;1) Is the html-scanner available somewhere as a gem?&lt;/p&gt;
&lt;p&gt;2) If so, can't we fix it in the gem? Shouldn't we add test
cases straight to the html-scanner code?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-28T09:58:48+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-28T09:58:57+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">8</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I don't think that html-scanner is available as a gem. In fact, I didn't find html-scanner, except in Rails. Maybe, it's time to move it out of vendor.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I don't think that html-scanner is available as a gem. In fact,
I didn't find html-scanner, except in Rails. Maybe, it's time to
move it out of vendor.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-28T10:29:19+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-28T10:29:29+01:00</updated-at>
      <user-id type="integer">14798</user-id>
      <version type="integer">9</version>
      <user-name>Bruno Michel</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>According to JK: &quot;html-scanner was added as a utility lib just for rails&quot;. That said, I'm going to apply the patch soon!</body>
      <body-html>&lt;div&gt;&lt;p&gt;According to JK: &quot;html-scanner was added as a utility lib just
for rails&quot;. That said, I'm going to apply the patch soon!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-28T10:39:49+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-28T10:39:56+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">10</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [2002e5877efa40b336b70b707670e734c6389958]) Strip_tags never ending attribute should not raise a TypeError [#4870 state:resolved]

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/2002e5877efa40b336b70b707670e734c6389958</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/2002e5877efa40b336b70b707670e734c6389958&quot;
title=
&quot;Changeset [2002e5877efa40b336b70b707670e734c6389958]&quot;&gt;[2002e5877efa40b336b70b707670e734c6389958]&lt;/a&gt;)
Strip_tags never ending attribute should not raise a TypeError
[&lt;a href=&quot;/projects/8994/tickets/4870&quot; title=
&quot;Ticket #4870&quot;&gt;#4870&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/2002e5877efa40b336b70b707670e734c6389958&quot;&gt;
http://github.com/rails/rails/commit/2002e5877efa40b336b70b707670e7...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-28T10:40:48+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-06-28T10:40:54+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">11</version>
      <user-name>Repository</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/31647)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/31647&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-10-15T23:01:56+01:00</created-at>
      <creator-id type="integer">103473</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer">88038</milestone-id>
      <number type="integer">4870</number>
      <permalink>a-bug-in-actionviewhelperssanitizehelperstrip_tags</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>actionpack html patch</tag>
      <title>A bug in ActionView::Helpers::SanitizeHelper.strip_tags</title>
      <updated-at type="datetime">2010-10-15T23:01:56+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">12</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>&#321;ukasz</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4870</url>
      <milestone-title>3.0.2</milestone-title>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>957676f6c0013e192ac774403c0483b8cbd94687</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-26T18:02:59+01:00</created-at>
      <filename>strip_tags_neverending_attribute.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">577599</id>
      <size type="integer">2439</size>
      <uploader-id type="integer">14798</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/577599/strip_tags_neverending_attribute.diff</url>
    </attachment>
  </attachments>
</ticket>
