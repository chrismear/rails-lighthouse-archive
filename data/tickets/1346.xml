<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">424</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-11-07T20:35:06+00:00</created-at>
  <creator-id type="integer">15346</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1346</number>
  <permalink>coerce-0-average-calculation-to-float</permalink>
  <priority type="integer">21</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>2.2.rc1 activerecord sqlserver</tag>
  <title>Coerce 0 Average Calculation To Float</title>
  <updated-at type="datetime">2008-11-11T13:54:22+00:00</updated-at>
  <user-id type="integer">15346</user-id>
  <version type="integer">9</version>
  <user-name>Ken Collins</user-name>
  <creator-name>Ken Collins</creator-name>
  <assigned-user-name>Joshua Peek</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
  <priority-name nil="true"></priority-name>
  <original-body>Some databases return 0 for a #average calculation. For instance:

Topic.average(:replies_count)

Returns 0 from SQL Server and will bomb when #type_cast_calculated_value is run. I am submitting this patch with high hopes that it can be done in 2.2 release. We are trying to finish the new SQL Server adapter to that release and having all the tests pass would without monkey patching rails would be great!

Cheers.</original-body>
  <latest-body>Some databases return 0 for a #average calculation. For instance:

Topic.average(:replies_count)

Returns 0 from SQL Server and will bomb when #type_cast_calculated_value is run. I am submitting this patch with high hopes that it can be done in 2.2 release. We are trying to finish the new SQL Server adapter to that release and having all the tests pass would without monkey patching rails would be great!

Cheers.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Some databases return 0 for a #average calculation. For
instance:&lt;/p&gt;
&lt;p&gt;Topic.average(:replies_count)&lt;/p&gt;
&lt;p&gt;Returns 0 from SQL Server and will bomb when
#type_cast_calculated_value is run. I am submitting this patch with
high hopes that it can be done in 2.2 release. We are trying to
finish the new SQL Server adapter to that release and having all
the tests pass would without monkey patching rails would be
great!&lt;/p&gt;
&lt;p&gt;Cheers.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Some databases return 0 for a #average calculation. For instance:

Topic.average(:replies_count)

Returns 0 from SQL Server and will bomb when #type_cast_calculated_value is run. I am submitting this patch with high hopes that it can be done in 2.2 release. We are trying to finish the new SQL Server adapter to that release and having all the tests pass would without monkey patching rails would be great!

Cheers.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Some databases return 0 for a #average calculation. For
instance:&lt;/p&gt;
&lt;p&gt;Topic.average(:replies_count)&lt;/p&gt;
&lt;p&gt;Returns 0 from SQL Server and will bomb when
#type_cast_calculated_value is run. I am submitting this patch with
high hopes that it can be done in 2.2 release. We are trying to
finish the new SQL Server adapter to that release and having all
the tests pass would without monkey patching rails would be
great!&lt;/p&gt;
&lt;p&gt;Cheers.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-07T20:35:06+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-07T20:35:11+00:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">1</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-08T02:40:50+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-08T02:40:52+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">2</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [a7f920f674d234f281d2491ebe6d74710a79e663]) If average value from DB is 0, make sure to convert it to a 0.0 float before calling #to_d on it [#1346 state:resolved]

Signed-off-by: Joshua Peek &lt;josh@joshpeek.com&gt;
http://github.com/rails/rails/commit/a7f920f674d234f281d2491ebe6d74710a79e663</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [a7f920f674d234f281d2491ebe6d74710a79e663]) If average
value from DB is 0, make sure to convert it to a 0.0 float before
calling #to_d on it [&lt;a href=&quot;/projects/8994/tickets/1346&quot; title=&quot;Ticket #1346&quot;&gt;#1346&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Joshua Peek &lt;a href=&quot;mailto:josh@joshpeek.com&quot;&gt;josh@joshpeek.com&lt;/a&gt; &lt;a href=&quot;http://github.com/rails/rails/commit/a7f920f674d234f281d2491ebe6d74710a79e663&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-08T02:47:56+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-08T02:47:58+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">3</version>
      <user-name>Repository</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Wow! Thanks alot! :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Wow! Thanks alot! :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-08T02:56:52+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-08T02:56:56+00:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">4</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>What's the point of using BigDecimal at all if we're first converting to float?, the bigdecimal is certainly not going to be any more precise than the float it is made from.

Seems to me that the special case should only be used if the value actually is 0, in which case to_f wouldn't really be needed, one could just use: value &amp;&amp; (value == 0 ? 0.0.to_d : value.to_d)</body>
      <body-html>&lt;div&gt;&lt;p&gt;What's the point of using BigDecimal at all if we're first
converting to float?, the bigdecimal is certainly not going to be
any more precise than the float it is made from.&lt;/p&gt;
&lt;p&gt;Seems to me that the special case should only be used if the
value actually is 0, in which case to_f wouldn't really be needed,
one could just use: value &amp;amp;&amp;amp; (value == 0 ? 0.0.to_d :
value.to_d)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-08T23:02:58+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-08T23:03:00+00:00</updated-at>
      <user-id type="integer">14890</user-id>
      <version type="integer">5</version>
      <user-name>Tarmo T&#228;nav</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>That looks just fine to me. I'll put together another patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;That looks just fine to me. I'll put together another patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-10T05:17:32+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-10T05:17:35+00:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">6</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-11-10T18:35:38+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-10T18:35:43+00:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">7</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [335a31524055c7dd79618ea79b3c18d827e25d3d]) Add simple case when DB calculations returns 0 instead of 0.0 [#1346 state:resolved]
http://github.com/rails/rails/commit/335a31524055c7dd79618ea79b3c18d827e25d3d</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from [335a31524055c7dd79618ea79b3c18d827e25d3d]) Add simple
case when DB calculations returns 0 instead of 0.0 [&lt;a href=&quot;/projects/8994/tickets/1346&quot; title=&quot;Ticket #1346&quot;&gt;#1346&lt;/a&gt;
state:resolved] &lt;a href=&quot;http://github.com/rails/rails/commit/335a31524055c7dd79618ea79b3c18d827e25d3d&quot;&gt;
http://github.com/rails/rails/co...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-10T20:17:29+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-10T20:17:30+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">8</version>
      <user-name>Repository</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Thanks again! My Monday was crushed with bugs from co-workers. Cheers!</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thanks again! My Monday was crushed with bugs from co-workers.
Cheers!&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-11-11T13:54:19+00:00</created-at>
      <creator-id type="integer">15346</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1346</number>
      <permalink>coerce-0-average-calculation-to-float</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>2.2.rc1 activerecord sqlserver</tag>
      <title>Coerce 0 Average Calculation To Float</title>
      <updated-at type="datetime">2008-11-11T13:54:22+00:00</updated-at>
      <user-id type="integer">15346</user-id>
      <version type="integer">9</version>
      <user-name>Ken Collins</user-name>
      <creator-name>Ken Collins</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1346</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>3b9a3d9270fb83d3a38e2bea4d9647bc2422ce10</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-11-07T20:35:06+00:00</created-at>
      <filename>calculations_average.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">60356</id>
      <size type="integer">1007</size>
      <uploader-id type="integer">15346</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/60356/calculations_average.patch</url>
    </attachment>
  </attachments>
</ticket>
