<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">0</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-09-13T21:56:29+01:00</created-at>
  <creator-id type="integer">115675</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5628</number>
  <permalink>integrationtest-of-rails-app-does-not-see-rack-middleware-updates</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag nil="true"></tag>
  <title>IntegrationTest of rails app does not see rack middleware updates</title>
  <updated-at type="datetime">2011-02-02T16:51:14+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">3</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>apmonkey</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5628</url>
  <priority-name nil="true"></priority-name>
  <original-body>I am currently trying to integration test a rails 2.3.8 app that uses the open_id_authentication plugin, which in turn uses the rack-openid middleware to detect a 401 unauthorized response and turn it into a redirect to the openid provider for validation.

In the integration test, I would like to use an assert_response 303 for the openid redirect, but currently it fails as the assert_response sees the 401 response of the rails app, rather than the modified 303 response from the rack middleware.

After changing http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/integration.rb#L341 to drop through to the else clause, the integration test works again. However, I don't have enough knowledge of rails to know what the correct fix is, or indeed if I am doing something wrong and this is the intended way of working.

However, the fact that there are a couple of inconsistencies with some parts of the testing framework seeing the rack responses and some the rails responses, I suspect this is an error in rails and thus I would like to raise the issue here for someone more knowledgeable to have a look

Thank you</original-body>
  <latest-body>I am currently trying to integration test a rails 2.3.8 app that uses the open_id_authentication plugin, which in turn uses the rack-openid middleware to detect a 401 unauthorized response and turn it into a redirect to the openid provider for validation.

In the integration test, I would like to use an assert_response 303 for the openid redirect, but currently it fails as the assert_response sees the 401 response of the rails app, rather than the modified 303 response from the rack middleware.

After changing http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/integration.rb#L341 to drop through to the else clause, the integration test works again. However, I don't have enough knowledge of rails to know what the correct fix is, or indeed if I am doing something wrong and this is the intended way of working.

However, the fact that there are a couple of inconsistencies with some parts of the testing framework seeing the rack responses and some the rails responses, I suspect this is an error in rails and thus I would like to raise the issue here for someone more knowledgeable to have a look

Thank you</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;I am currently trying to integration test a rails 2.3.8 app that
uses the open_id_authentication plugin, which in turn uses the
rack-openid middleware to detect a 401 unauthorized response and
turn it into a redirect to the openid provider for validation.&lt;/p&gt;
&lt;p&gt;In the integration test, I would like to use an assert_response
303 for the openid redirect, but currently it fails as the
assert_response sees the 401 response of the rails app, rather than
the modified 303 response from the rack middleware.&lt;/p&gt;
&lt;p&gt;After changing &lt;a href=
&quot;http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/integration.rb#L341&quot;&gt;
http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action...&lt;/a&gt;
to drop through to the else clause, the integration test works
again. However, I don't have enough knowledge of rails to know what
the correct fix is, or indeed if I am doing something wrong and
this is the intended way of working.&lt;/p&gt;
&lt;p&gt;However, the fact that there are a couple of inconsistencies
with some parts of the testing framework seeing the rack responses
and some the rails responses, I suspect this is an error in rails
and thus I would like to raise the issue here for someone more
knowledgeable to have a look&lt;/p&gt;
&lt;p&gt;Thank you&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I am currently trying to integration test a rails 2.3.8 app that uses the open_id_authentication plugin, which in turn uses the rack-openid middleware to detect a 401 unauthorized response and turn it into a redirect to the openid provider for validation.

In the integration test, I would like to use an assert_response 303 for the openid redirect, but currently it fails as the assert_response sees the 401 response of the rails app, rather than the modified 303 response from the rack middleware.

After changing http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/integration.rb#L341 to drop through to the else clause, the integration test works again. However, I don't have enough knowledge of rails to know what the correct fix is, or indeed if I am doing something wrong and this is the intended way of working.

However, the fact that there are a couple of inconsistencies with some parts of the testing framework seeing the rack responses and some the rails responses, I suspect this is an error in rails and thus I would like to raise the issue here for someone more knowledgeable to have a look

Thank you</body>
      <body-html>&lt;div&gt;&lt;p&gt;I am currently trying to integration test a rails 2.3.8 app that
uses the open_id_authentication plugin, which in turn uses the
rack-openid middleware to detect a 401 unauthorized response and
turn it into a redirect to the openid provider for validation.&lt;/p&gt;
&lt;p&gt;In the integration test, I would like to use an assert_response
303 for the openid redirect, but currently it fails as the
assert_response sees the 401 response of the rails app, rather than
the modified 303 response from the rack middleware.&lt;/p&gt;
&lt;p&gt;After changing &lt;a href=
&quot;http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/integration.rb#L341&quot;&gt;
http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action...&lt;/a&gt;
to drop through to the else clause, the integration test works
again. However, I don't have enough knowledge of rails to know what
the correct fix is, or indeed if I am doing something wrong and
this is the intended way of working.&lt;/p&gt;
&lt;p&gt;However, the fact that there are a couple of inconsistencies
with some parts of the testing framework seeing the rack responses
and some the rails responses, I suspect this is an error in rails
and thus I would like to raise the issue here for someone more
knowledgeable to have a look&lt;/p&gt;
&lt;p&gt;Thank you&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-13T21:56:29+01:00</created-at>
      <creator-id type="integer">115675</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5628</number>
      <permalink>integrationtest-of-rails-app-does-not-see-rack-middleware-updates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>IntegrationTest of rails app does not see rack middleware updates</title>
      <updated-at type="datetime">2010-09-13T21:56:31+01:00</updated-at>
      <user-id type="integer">115675</user-id>
      <version type="integer">1</version>
      <user-name>apmonkey</user-name>
      <creator-name>apmonkey</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5628</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:31:45+00:00</created-at>
      <creator-id type="integer">115675</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5628</number>
      <permalink>integrationtest-of-rails-app-does-not-see-rack-middleware-updates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>IntegrationTest of rails app does not see rack middleware updates</title>
      <updated-at type="datetime">2011-02-02T16:51:14+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">2</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>apmonkey</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5628</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:31:46+00:00</created-at>
      <creator-id type="integer">115675</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5628</number>
      <permalink>integrationtest-of-rails-app-does-not-see-rack-middleware-updates</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag nil="true"></tag>
      <title>IntegrationTest of rails app does not see rack middleware updates</title>
      <updated-at type="datetime">2011-02-02T16:50:40+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">3</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>apmonkey</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5628</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
</ticket>
