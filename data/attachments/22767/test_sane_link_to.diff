From 61aaf9dac0037ead084dab76990d4ea35a00f6a1 Mon Sep 17 00:00:00 2001
From: Amol Hatwar <amol@hatwar.org>
Date: Wed, 14 May 2008 00:13:01 +0530
Subject: [PATCH] Wrote test that demonstartes failing behavior...

---
 actionpack/test/template/.url_helper_test.rb.swp |  Bin 0 -> 40960 bytes
 actionpack/test/template/url_helper_test.rb      |   18 +++++++++++++++++-
 2 files changed, 17 insertions(+), 1 deletions(-)
 create mode 100644 actionpack/test/template/.url_helper_test.rb.swp

diff --git a/actionpack/test/template/.url_helper_test.rb.swp b/actionpack/test/template/.url_helper_test.rb.swp
new file mode 100644
index 0000000000000000000000000000000000000000..60ec0b6df5f831fc1b14e50eb99330a47fb23dd3
GIT binary patch
literal 40960
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

literal 0
HcmV?d00001

diff --git a/actionpack/test/template/url_helper_test.rb b/actionpack/test/template/url_helper_test.rb
index d45ea08..d1779e2 100644
--- a/actionpack/test/template/url_helper_test.rb
+++ b/actionpack/test/template/url_helper_test.rb
@@ -80,7 +80,23 @@ class UrlHelperTest < ActionView::TestCase
   def test_link_tag_with_straight_url
     assert_dom_equal "<a href=\"http://www.example.com\">Hello</a>", link_to("Hello", "http://www.example.com")
   end
-  
+
+  def test_sane_link_tag_with_controller_module
+    ActionController::Base.class_eval { attr_accessor :url }
+    url1 = {:controller => 'weblog/post', :action => 'show'}
+    @controller1 = ActionController::Base.new
+    @controller1.request = ActionController::TestRequest.new
+    @controller1.url = ActionController::UrlRewriter.new(@controller1.request, url1)
+
+    url2 = {:controller => 'blog', :action => 'show'}
+    @controller2 = ActionController::Base.new
+    @controller2.request = ActionController::TestRequest.new
+    @controller2.url = ActionController::UrlRewriter.new(@controller2.request, url2)
+
+    assert_dom_equal(%q{<a href="/weblog/post/show">Test Link</a>}, link_to('Test Link', url1))
+    assert_dom_equal(%q{<a href="/blog/show">Test Link</a>}, link_to('Test Link', url2))
+  end
+
   def test_link_tag_without_host_option
     ActionController::Base.class_eval { attr_accessor :url }
     url = {:controller => 'weblog', :action => 'show'}
-- 
1.5.4.3

