<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1366</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-05-22T15:32:26+01:00</created-at>
  <creator-id type="integer">7697</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">239</number>
  <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
  <priority type="integer">15749</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>activerecord bug edge patch</tag>
  <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
  <updated-at type="datetime">2008-05-29T14:26:04+01:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">6</version>
  <user-name>Repository</user-name>
  <creator-name>Andrew White</creator-name>
  <assigned-user-name>Pratik</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
  <priority-name nil="true"></priority-name>
  <original-body>Currently construct_finder_sql gives precedence to the :select from the current scope over :select passed in the options parameter. Not only is this counterintuitive it makes it harder to optimize performance by reducing the columns returned or to construct sql within the context of one model and then feed it into find_by_sql in another model.

The attached patch simply switches the order in construct_finder_sql and adds a couple of tests to check that construct_finder_sql respects the :select option</original-body>
  <latest-body>Currently construct_finder_sql gives precedence to the :select from the current scope over :select passed in the options parameter. Not only is this counterintuitive it makes it harder to optimize performance by reducing the columns returned or to construct sql within the context of one model and then feed it into find_by_sql in another model.

The attached patch simply switches the order in construct_finder_sql and adds a couple of tests to check that construct_finder_sql respects the :select option</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
Currently construct_finder_sql gives precedence to the :select from the current scope over :select passed in the options parameter. Not only is this counterintuitive it makes it harder to optimize performance by reducing the columns returned or to construct sql within the context of one model and then feed it into find_by_sql in another model.
&lt;/p&gt;&lt;p&gt;
The attached patch simply switches the order in construct_finder_sql and adds a couple of tests to check that construct_finder_sql respects the :select option
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Currently construct_finder_sql gives precedence to the :select from the current scope over :select passed in the options parameter. Not only is this counterintuitive it makes it harder to optimize performance by reducing the columns returned or to construct sql within the context of one model and then feed it into find_by_sql in another model.

The attached patch simply switches the order in construct_finder_sql and adds a couple of tests to check that construct_finder_sql respects the :select option</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Currently construct_finder_sql gives precedence to the :select from the current scope over :select passed in the options parameter. Not only is this counterintuitive it makes it harder to optimize performance by reducing the columns returned or to construct sql within the context of one model and then feed it into find_by_sql in another model.
&lt;/p&gt;&lt;p&gt;
The attached patch simply switches the order in construct_finder_sql and adds a couple of tests to check that construct_finder_sql respects the :select option
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-22T15:32:27+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>[Patch] Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-22T15:32:27+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">1</version>
      <user-name>Andrew White</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-22T20:06:59+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- 
:title: &quot;[Patch] Change :select precedence in construct_finder_sql to favor options[:select]&quot;
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-22T20:06:59+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">2</version>
      <user-name>Pratik</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Looks good.

Could you please change tests to check both : 

1) Query fired ( as you've already done )
2) Assert result of a find. For example Developer.find(:all, :select =&gt; 'developers.not_in_scope')

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Looks good.
&lt;/p&gt;&lt;p&gt;
Could you please change tests to check both :
&lt;/p&gt;&lt;p&gt;
1) Query fired ( as you've already done )
&lt;/p&gt;&lt;p&gt;
2) Assert result of a find. For example Developer.find(:all, :select =&gt; 'developers.not_in_scope')
&lt;/p&gt;&lt;p&gt;
Thanks.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-29T11:44:36+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag nil="true"></tag>
      <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-29T11:44:36+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">3</version>
      <user-name>Pratik</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Okay I've modified the patch to check both the sql generated and whether attributes are/are not present in the attributes hash after doing a find.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Okay I've modified the patch to check both the sql generated and whether attributes are/are not present in the attributes hash after doing a find.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-29T13:06:56+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>incomplete</state>
      <tag nil="true"></tag>
      <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-29T13:06:56+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">4</version>
      <user-name>Andrew White</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-05-29T13:35:26+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- 
:state: incomplete
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-29T13:35:26+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">5</version>
      <user-name>Pratik</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [235d635708dd72bee0828457af5397c79750483a]) Ensure :select passed in options overrides the one from the scope. [#239 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/235d635708dd72bee0828457af5397c79750483a</body>
      <body-html>&lt;div&gt;&lt;p&gt;
(from [235d635708dd72bee0828457af5397c79750483a]) Ensure :select passed in options overrides the one from the scope. [#239 state:resolved]
&lt;/p&gt;&lt;p&gt;
Signed-off-by: Pratik Naik 
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://github.com/rails/rails/commit/235d635708dd72bee0828457af5397c79750483a&quot;&gt;http://github.com/rails/rails/co...&lt;/a&gt;
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-05-29T14:26:04+01:00</created-at>
      <creator-id type="integer">7697</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">239</number>
      <permalink>patch-change-select-precedence-in-construct_finder_sql-to-favor-options-select</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag nil="true"></tag>
      <title>Change :select precedence in construct_finder_sql to favor options[:select]</title>
      <updated-at type="datetime">2008-05-29T14:26:04+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">6</version>
      <user-name>Repository</user-name>
      <creator-name>Andrew White</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/239</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ee5e871e05a16fb4c9b749f8a280ec44d57be525</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-05-29T13:06:56+01:00</created-at>
      <filename>change_select_precedence.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">24948</id>
      <size type="integer">2593</size>
      <uploader-id type="integer">7697</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/24948/change_select_precedence.diff</url>
    </attachment>
  </attachments>
</ticket>
