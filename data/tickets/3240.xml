<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">141</assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-09-21T13:37:46+01:00</created-at>
  <creator-id type="integer">8407</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer">82855</milestone-id>
  <number type="integer">3240</number>
  <permalink>internet-explorer-accept-header</permalink>
  <priority type="integer">2</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>stale</state>
  <tag>bugmash</tag>
  <title>Internet Explorer Accept header</title>
  <updated-at type="datetime">2011-02-02T16:40:04+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">22</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Manfred Stienstra</creator-name>
  <assigned-user-name>Michael Koziarski</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
  <milestone-title>2.3.10</milestone-title>
  <priority-name>Medium</priority-name>
  <original-body>Internet Explorer sends a rather retarded accept header, this causes Rails to respond with a whole slew of mime types before the sensible defaults: HTML and XML. For example:

@@@ ruby
repond_to do |format|
  format.html
  format.jpg do
    send_file @photo.public_path, :type =&gt; 'image/jpeg'
  end
end
@@@

Will return the JPEG instead of the HTML version on a regular request. 

Attached is a patch which prepends HTML and XML to ActionController::Request#accepts when the user agent suggests Internet Explorer.</original-body>
  <latest-body>Internet Explorer sends a rather retarded accept header, this causes Rails to respond with a whole slew of mime types before the sensible defaults: HTML and XML. For example:

@@@ ruby
repond_to do |format|
  format.html
  format.jpg do
    send_file @photo.public_path, :type =&gt; 'image/jpeg'
  end
end
@@@

Will return the JPEG instead of the HTML version on a regular request. 

Attached is a patch which prepends HTML and XML to ActionController::Request#accepts when the user agent suggests Internet Explorer.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Internet Explorer sends a rather retarded accept header, this
causes Rails to respond with a whole slew of mime types before the
sensible defaults: HTML and XML. For example:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;repond_to do |format|
  format.html
  format.jpg do
    send_file @photo.public_path, :type =&amp;gt; 'image/jpeg'
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Will return the JPEG instead of the HTML version on a regular
request.&lt;/p&gt;
&lt;p&gt;Attached is a patch which prepends HTML and XML to
ActionController::Request#accepts when the user agent suggests
Internet Explorer.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Internet Explorer sends a rather retarded accept header, this causes Rails to respond with a whole slew of mime types before the sensible defaults: HTML and XML. For example:

@@@ ruby
repond_to do |format|
  format.html
  format.jpg do
    send_file @photo.public_path, :type =&gt; 'image/jpeg'
  end
end
@@@

Will return the JPEG instead of the HTML version on a regular request. 

Attached is a patch which prepends HTML and XML to ActionController::Request#accepts when the user agent suggests Internet Explorer.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Internet Explorer sends a rather retarded accept header, this
causes Rails to respond with a whole slew of mime types before the
sensible defaults: HTML and XML. For example:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;repond_to do |format|
  format.html
  format.jpg do
    send_file @photo.public_path, :type =&amp;gt; 'image/jpeg'
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Will return the JPEG instead of the HTML version on a regular
request.&lt;/p&gt;
&lt;p&gt;Attached is a patch which prepends HTML and XML to
ActionController::Request#accepts when the user agent suggests
Internet Explorer.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-21T13:37:46+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-21T13:37:52+01:00</updated-at>
      <user-id type="integer">8407</user-id>
      <version type="integer">1</version>
      <user-name>Manfred Stienstra</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Some examples of people running into this problem, primarily with serving XML feeds.

http://log.maniacalrage.net/post/56019689/tip-avoid-ie-issues-with-rails-respond-to-for
http://ianma.wordpress.com/2009/05/06/ruby-on-rails-respond_to-bug-on-ie7/
http://garrickvanburen.com/archive/workaround-for-ie-overly-accepting-in-rails-respond_to-format
http://info.michael-simons.eu/2007/08/06/rails-respond_to-method/</body>
      <body-html>&lt;div&gt;&lt;p&gt;Some examples of people running into this problem, primarily
with serving XML feeds.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://log.maniacalrage.net/post/56019689/tip-avoid-ie-issues-with-rails-respond-to-for&quot;&gt;
http://log.maniacalrage.net/post/56019689/tip-avoid-ie-issues-with-...&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://ianma.wordpress.com/2009/05/06/ruby-on-rails-respond_to-bug-on-ie7/&quot;&gt;
http://ianma.wordpress.com/2009/05/06/ruby-on-rails-respond_to-bug-...&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://garrickvanburen.com/archive/workaround-for-ie-overly-accepting-in-rails-respond_to-format&quot;&gt;
http://garrickvanburen.com/archive/workaround-for-ie-overly-accepti...&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://info.michael-simons.eu/2007/08/06/rails-respond_to-method/&quot;&gt;
http://info.michael-simons.eu/2007/08/06/rails-respond_to-method/&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-22T08:56:04+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-22T08:56:08+01:00</updated-at>
      <user-id type="integer">8407</user-id>
      <version type="integer">2</version>
      <user-name>Manfred Stienstra</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.x</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Ouch!

+1 to apply.

I known Yehuda made some changes to Accepts in 3.x so I'm not sure if its affected as well.

Do you think something similar should be applied to Rack core?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Ouch!&lt;/p&gt;
&lt;p&gt;+1 to apply.&lt;/p&gt;
&lt;p&gt;I known Yehuda made some changes to Accepts in 3.x so I'm not
sure if its affected as well.&lt;/p&gt;
&lt;p&gt;Do you think something similar should be applied to Rack
core?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-22T16:28:05+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 9903
:assigned_user: 424
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-22T16:28:13+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">3</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>There is nothing in Rails 3 addressing this issue as far as I can see. I don't think this belongs in Rack, it's coupled with the way Rails does content negotiation.</body>
      <body-html>&lt;div&gt;&lt;p&gt;There is nothing in Rails 3 addressing this issue as far as I
can see. I don't think this belongs in Rack, it's coupled with the
way Rails does content negotiation.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-22T22:16:19+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-22T22:17:25+01:00</updated-at>
      <user-id type="integer">8407</user-id>
      <version type="integer">4</version>
      <user-name>Manfred Stienstra</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">12714</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The fix in 3.0 is to reject Accept header usage if more than one MIME is specified.

This means that:

@@@
Accept: text/html
@@@

will work, but:

@@@
Accept: rather/retarded, ie/header
@@@

will fall back to text/html.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The fix in 3.0 is to reject Accept header usage if more than one
MIME is specified.&lt;/p&gt;
&lt;p&gt;This means that:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Accept: text/html&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;will work, but:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Accept: rather/retarded, ie/header&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;will fall back to text/html.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-24T05:50:12+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-24T05:50:16+01:00</updated-at>
      <user-id type="integer">12714</user-id>
      <version type="integer">5</version>
      <user-name>Yehuda Katz (wycats)</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Yehuda Katz (wycats)</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">424</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-24T05:51:10+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 12714
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-24T05:51:16+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">6</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Joshua Peek</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Koz, can you weigh in.

(Sorry for all the handoffs)</body>
      <body-html>&lt;div&gt;&lt;p&gt;Koz, can you weigh in.&lt;/p&gt;
&lt;p&gt;(Sorry for all the handoffs)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-09-24T05:52:43+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 424
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-24T05:52:46+01:00</updated-at>
      <user-id type="integer">424</user-id>
      <version type="integer">7</version>
      <user-name>Joshua Peek</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Commited: http://github.com/rails/rails/commit/c680f2372e2d4081597bb130715ee79daaf80576</body>
      <body-html>&lt;div&gt;&lt;p&gt;Commited: &lt;a href=
&quot;http://github.com/rails/rails/commit/c680f2372e2d4081597bb130715ee79daaf80576&quot;&gt;
http://github.com/rails/rails/commit/c680f2372e2d4081597bb130715ee7...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-09-26T00:08:54+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-26T00:08:57+01:00</updated-at>
      <user-id type="integer">8407</user-id>
      <version type="integer">8</version>
      <user-name>Manfred Stienstra</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>fwiw, this is why I added use_accept_header = false.  It's a nice science experiment, but the header's basically junk in the wild.</body>
      <body-html>&lt;div&gt;&lt;p&gt;fwiw, this is why I added use_accept_header = false. It's a nice
science experiment, but the header's basically junk in the
wild.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-09-29T04:18:42+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2009-09-29T04:18:46+01:00</updated-at>
      <user-id type="integer">141</user-id>
      <version type="integer">9</version>
      <user-name>Michael Koziarski</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I tested applying this patch to rails 2.3.5 and this causes Internet Explorer to fail to respond to certain requests, for example:

def update_chat
  @shouts = Shout.recent

  respond_to do |format|
    format.js
  end
end

This method, which only responds to javascript, fails with Internet Explorer once this patch is applied, as Internet Explorer responds to the first mime type, which is text/html with this patch, which does not exist in this method..</body>
      <body-html>&lt;div&gt;&lt;p&gt;I tested applying this patch to rails 2.3.5 and this causes
Internet Explorer to fail to respond to certain requests, for
example:&lt;/p&gt;
&lt;p&gt;def update_chat&lt;br&gt;
@shouts = Shout.recent&lt;/p&gt;
&lt;p&gt;respond_to do |format|&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;format.js&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;end end&lt;/p&gt;
&lt;p&gt;This method, which only responds to javascript, fails with
Internet Explorer once this patch is applied, as Internet Explorer
responds to the first mime type, which is text/html with this
patch, which does not exist in this method..&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-01-05T17:05:54+00:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-01-05T17:05:57+00:00</updated-at>
      <user-id type="integer">4114</user-id>
      <version type="integer">10</version>
      <user-name>eight toes</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>The patch was applied and reverted for specifically that reason. I guess we should reopen it and take another look.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The patch was applied and reverted for specifically that reason.
I guess we should reopen it and take another look.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-01-07T08:00:30+00:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-01-07T08:00:34+00:00</updated-at>
      <user-id type="integer">8407</user-id>
      <version type="integer">11</version>
      <user-name>Manfred Stienstra</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Could this be improved by adopting some kind of qs (quality of source) parameter to the format.* call, in the same way as [Apache's content negotiation](http://httpd.apache.org/docs/2.0/content-negotiation.html#methods) works?

@@@ ruby
repond_to do |format|
  format.html
  format.jpg :qs =&gt; 0.8 do
    send_file @photo.public_path, :type =&gt; 'image/jpeg'
  end
end
@@@

You would have to ensure that
- A MIME type match by extension would automatically match its exact format block
- A request without an extension would be matched by a q/qs algorithm like that in Apache's content negotiation
- Suitable default qs values were set for different MIME types to reflect that
  a) Rails prefers serving HTML documents
  b) Some browsers aren't very good at specifying their Accept header

By this logic, a UA wanting to get a non-HTML response to an extensionless URI would have to either
- Supply a q&lt;1 value for text/html, text/* or */*
- Supply an explicit q=1 value for an alternate MIME type and not supply an explicit q=1 value for text/html

For example, Firefox supplies a different Accepts header for resources loaded through an &lt;img&gt; tag

Is this heading in the wrong direction? It seems to me that the Accept header is at most a guideline, so there shouldn't be any problem with using our own values to fudge the browser's requested quality values. The only problem would be doing the maths to work out the best possible 'fudge' values</body>
      <body-html>&lt;div&gt;&lt;p&gt;Could this be improved by adopting some kind of qs (quality of
source) parameter to the format.* call, in the same way as &lt;a href=
&quot;http://httpd.apache.org/docs/2.0/content-negotiation.html#methods&quot;&gt;
Apache's content negotiation&lt;/a&gt; works?&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;repond_to do |format|
  format.html
  format.jpg :qs =&amp;gt; 0.8 do
    send_file @photo.public_path, :type =&amp;gt; 'image/jpeg'
  end
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;You would have to ensure that&lt;br&gt;
- A MIME type match by extension would automatically match its
exact format block - A request without an extension would be
matched by a q/qs algorithm like that in Apache's content
negotiation - Suitable default qs values were set for different
MIME types to reflect that a) Rails prefers serving HTML documents
b) Some browsers aren't very good at specifying their Accept
header&lt;/p&gt;
&lt;p&gt;By this logic, a UA wanting to get a non-HTML response to an
extensionless URI would have to either&lt;br&gt;
- Supply a q&lt;/p&gt;
&lt;p&gt;For example, Firefox supplies a different Accepts header for
resources loaded through an &lt;img&gt; tag&lt;/p&gt;
&lt;p&gt;Is this heading in the wrong direction? It seems to me that the
Accept header is at most a guideline, so there shouldn't be any
problem with using our own values to fudge the browser's requested
quality values. The only problem would be doing the maths to work
out the best possible 'fudge' values&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-03-08T16:38:28+00:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag nil="true"></tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-03-08T16:38:33+00:00</updated-at>
      <user-id type="integer">17466</user-id>
      <version type="integer">12</version>
      <user-name>Gareth Adams</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20088)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20088&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-16T02:41:11+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer">50064</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-05-16T02:41:11+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">13</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.6</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20606)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20606&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-23T17:54:44+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 50064
</diffable-attributes>
      <milestone-id type="integer">73241</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-05-23T17:54:44+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">14</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.7</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20631)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20631&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-24T09:40:52+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73241
</diffable-attributes>
      <milestone-id type="integer">73273</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-05-24T09:40:52+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">15</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.8</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/20816)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/20816&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-05-25T23:45:39+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 73273
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-05-25T23:45:39+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">16</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Any updates to this ticket? Is somebody working on a new patch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Any updates to this ticket? Is somebody working on a new
patch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-17T06:38:48+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-06-17T06:38:54+01:00</updated-at>
      <user-id type="integer">89656</user-id>
      <version type="integer">17</version>
      <user-name>Rohit Arondekar</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/27613)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/27613&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T02:28:50+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-08-30T02:28:50+01:00</updated-at>
      <user-id type="integer">85</user-id>
      <version type="integer">18</version>
      <user-name>Jeremy Kemper</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I have the same issue, but &quot;IE Accept header related bugs&quot; been fixed be remove this chunk of js code:
  $(&quot;form&quot;).submit(function(){
    $('input[type=submit]').attr('disabled', 'disabled');
    return true;
  });

It's weird for me, because I was looking for an issue in server-side code. 
please be ensure that all is ok with your client-side scripts.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I have the same issue, but &quot;IE Accept header related bugs&quot; been
fixed be remove this chunk of js code:&lt;br&gt;
$(&quot;form&quot;).submit(function(){&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;$('input[type=submit]').attr('disabled', 'disabled');
return true;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;});&lt;/p&gt;
&lt;p&gt;It's weird for me, because I was looking for an issue in
server-side code.&lt;br&gt;
please be ensure that all is ok with your client-side scripts.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-04T15:40:25+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-09-04T15:40:30+01:00</updated-at>
      <user-id type="integer">44539</user-id>
      <version type="integer">19</version>
      <user-name>mikhailov</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Same problem in rails 3 with IE if having an action that can return the data in .xls format.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Same problem in rails 3 with IE if having an action that can
return the data in .xls format.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-10-19T14:37:55+01:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2010-10-19T14:37:57+01:00</updated-at>
      <user-id type="integer">46044</user-id>
      <version type="integer">20</version>
      <user-name>sunkencity</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>This issue has been automatically marked as stale because it has not been commented on for at least three months.

The resources of the Rails core team are limited, and so we are asking for your help. If you can still reproduce this error on the 3-0-stable branch or on master, please reply with all of the information you have about it and add &quot;[state:open]&quot; to your comment. This will reopen the ticket for review. Likewise, if you feel that this is a very important feature for Rails to include, please reply with your explanation so we can consider it.

Thank you for all your contributions, and we hope you will understand this step to focus our efforts where they are most helpful.</body>
      <body-html>&lt;div&gt;&lt;p&gt;This issue has been automatically marked as stale because it has
not been commented on for at least three months.&lt;/p&gt;
&lt;p&gt;The resources of the Rails core team are limited, and so we are
asking for your help. If you can still reproduce this error on the
3-0-stable branch or on master, please reply with all of the
information you have about it and add &quot;[state:open]&quot; to your
comment. This will reopen the ticket for review. Likewise, if you
feel that this is a very important feature for Rails to include,
please reply with your explanation so we can consider it.&lt;/p&gt;
&lt;p&gt;Thank you for all your contributions, and we hope you will
understand this step to focus our efforts where they are most
helpful.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-02T16:29:35+00:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2011-02-02T16:40:04+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">21</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body nil="true"></body>
      <body-html nil="true"></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-02T16:29:36+00:00</created-at>
      <creator-id type="integer">8407</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">82855</milestone-id>
      <number type="integer">3240</number>
      <permalink>internet-explorer-accept-header</permalink>
      <priority type="integer">2</priority>
      <project-id type="integer">8994</project-id>
      <state>stale</state>
      <tag>bugmash</tag>
      <title>Internet Explorer Accept header</title>
      <updated-at type="datetime">2011-02-02T16:39:31+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">22</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Manfred Stienstra</creator-name>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/3240</url>
      <milestone-title>2.3.10</milestone-title>
      <priority-name>Medium</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>ec0cabb865ad83eedf0f88145f1a0155302dd249</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-09-21T13:37:46+01:00</created-at>
      <filename>prefix-internet-explorers-accepted-mime-types.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">273791</id>
      <size type="integer">4418</size>
      <uploader-id type="integer">8407</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/273791/prefix-internet-explorers-accepted-mime-types.patch</url>
    </attachment>
  </attachments>
</ticket>
