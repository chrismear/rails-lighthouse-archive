<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">1</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2010-08-30T22:08:07+01:00</created-at>
  <creator-id type="integer">17407</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">5503</number>
  <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
  <priority type="integer">3</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>committed</state>
  <tag>auto_link edge patch tested</tag>
  <title>trivial regression on auto_link for non-western languages</title>
  <updated-at type="datetime">2011-02-01T16:06:20+00:00</updated-at>
  <user-id type="integer">17393</user-id>
  <version type="integer">7</version>
  <user-name>Repository</user-name>
  <creator-name>Akira Matsuda</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
  <priority-name>Low</priority-name>
  <original-body>As auto_link are supporting arbitrary URI schemes since [this commit](http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e), it now recognizes all the preceding full width characters as a part of URI.
This might not be a *bug*, but at least a minor specification change for those who read/write languages that don't usually separate words by a space character.

Attached a patch avoiding this tiny regression, with a possible case for eastern people.</original-body>
  <latest-body>As auto_link are supporting arbitrary URI schemes since [this commit](http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e), it now recognizes all the preceding full width characters as a part of URI.
This might not be a *bug*, but at least a minor specification change for those who read/write languages that don't usually separate words by a space character.

Attached a patch avoiding this tiny regression, with a possible case for eastern people.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;As auto_link are supporting arbitrary URI schemes since &lt;a href=
&quot;http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e&quot;&gt;
this commit&lt;/a&gt;, it now recognizes all the preceding full width
characters as a part of URI.&lt;br&gt;
This might not be a &lt;em&gt;bug&lt;/em&gt;, but at least a minor
specification change for those who read/write languages that don't
usually separate words by a space character.&lt;/p&gt;
&lt;p&gt;Attached a patch avoiding this tiny regression, with a possible
case for eastern people.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>As auto_link are supporting arbitrary URI schemes since [this commit](http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e), it now recognizes all the preceding full width characters as a part of URI.
This might not be a *bug*, but at least a minor specification change for those who read/write languages that don't usually separate words by a space character.

Attached a patch avoiding this tiny regression, with a possible case for eastern people.</body>
      <body-html>&lt;div&gt;&lt;p&gt;As auto_link are supporting arbitrary URI schemes since &lt;a href=
&quot;http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e&quot;&gt;
this commit&lt;/a&gt;, it now recognizes all the preceding full width
characters as a part of URI.&lt;br&gt;
This might not be a &lt;em&gt;bug&lt;/em&gt;, but at least a minor
specification change for those who read/write languages that don't
usually separate words by a space character.&lt;/p&gt;
&lt;p&gt;Attached a patch avoiding this tiny regression, with a possible
case for eastern people.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-30T22:08:07+01:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2010-08-30T22:09:36+01:00</updated-at>
      <user-id type="integer">17407</user-id>
      <version type="integer">1</version>
      <user-name>Akira Matsuda</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>But tnough it can never happen to words like e.g, &lt;a href=&quot;http://www.shoppharmacycounter.com/&quot;&gt;cheap ephedra&lt;/a&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;But tnough it can never happen to words like e.g, &lt;a href=
&quot;http://www.shoppharmacycounter.com/&quot;&gt;cheap ephedra&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-08-31T16:36:16+01:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2010-08-31T16:36:18+01:00</updated-at>
      <user-id type="integer">113905</user-id>
      <version type="integer">2</version>
      <user-name>bhf</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>In RFC3986, scheme syntax of URI is:

    scheme      = ALPHA *( ALPHA / DIGIT / &quot;+&quot; / &quot;-&quot; / &quot;.&quot; )

http://tools.ietf.org/html/rfc3986#section-3.1

So regexp in the patch should be:

            (?: ([A-Za-z][0-9A-Za-z+.-]*:)// | www\. )</body>
      <body-html>&lt;div&gt;&lt;p&gt;In RFC3986, scheme syntax of URI is:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;scheme      = ALPHA *( ALPHA / DIGIT / &quot;+&quot; / &quot;-&quot; / &quot;.&quot; )&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=
&quot;http://tools.ietf.org/html/rfc3986#section-3.1&quot;&gt;http://tools.ietf.org/html/rfc3986#section-3.1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So regexp in the patch should be:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;        (?: ([A-Za-z][0-9A-Za-z+.-]*:)// | www\. )&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-09-11T06:24:56+01:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2010-09-11T06:25:00+01:00</updated-at>
      <user-id type="integer">33823</user-id>
      <version type="integer">3</version>
      <user-name>Masayoshi Takahashi</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Akira can you update your ticket according to the RFC?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Akira can you update your ticket according to the RFC?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-31T22:55:08+00:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2011-01-31T22:55:32+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">4</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>No.
I actually tried that regexp but the &quot;view-source:http://en.wikipedia.org/wiki/URI_scheme&quot; one didn't pass the test.
It is obvious that &quot;view-source:http://...&quot; does not follow the RFC, so I think there are two options.

1) strictly follow the RFC
Revert the previous commit and drop support for &quot;view-source:http://...&quot;, then implement the RFC3986 regexp as Takahashi-san suggested.

2) support the RFC + much more schemes
This was the intent of my patch.

What do you think?</body>
      <body-html>&lt;div&gt;&lt;p&gt;No.&lt;br&gt;
I actually tried that regexp but the &quot;view-source:&lt;a href=
&quot;http://en.wikipedia.org/wiki/URI_scheme&quot;&gt;http://en.wikipedia.org/wiki/URI_scheme&lt;/a&gt;&quot;
one didn't pass the test.&lt;br&gt;
It is obvious that &quot;view-source:&lt;a href=
&quot;http://...&quot;&gt;http://...&lt;/a&gt;&quot; does not follow the RFC, so I think
there are two options.&lt;/p&gt;
&lt;p&gt;1) strictly follow the RFC&lt;br&gt;
Revert the previous commit and drop support for
&quot;view-source:&lt;a href=&quot;http://...&amp;quot;&quot;&gt;http://...&quot;&lt;/a&gt;, then
implement the RFC3986 regexp as Takahashi-san suggested.&lt;/p&gt;
&lt;p&gt;2) support the RFC + much more schemes&lt;br&gt;
This was the intent of my patch.&lt;/p&gt;
&lt;p&gt;What do you think?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-01-31T23:39:04+00:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>auto_link edge patch tested</tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2011-01-31T23:39:13+00:00</updated-at>
      <user-id type="integer">17407</user-id>
      <version type="integer">5</version>
      <user-name>Akira Matsuda</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I understand Akira's intent. It's OK to support URI format loosely, IMHO.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I understand Akira's intent. It's OK to support URI format
loosely, IMHO.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-01T12:39:08+00:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>auto_link edge patch tested</tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2011-02-01T12:39:19+00:00</updated-at>
      <user-id type="integer">33823</user-id>
      <version type="integer">6</version>
      <user-name>Masayoshi Takahashi</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name>Low</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [cb9fa5283239e649483ea31ca372e99aaac2ca07]) auto_link: avoid recognizing full width chars as a part of URI scheme

fixes regression by http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e

[#5503 state:committed]

Signed-off-by: Santiago Pastorino &lt;santiago@wyeworks.com&gt;
https://github.com/rails/rails/commit/cb9fa5283239e649483ea31ca372e99aaac2ca07</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/cb9fa5283239e649483ea31ca372e99aaac2ca07&quot;
title=
&quot;Changeset [cb9fa5283239e649483ea31ca372e99aaac2ca07]&quot;&gt;[cb9fa5283239e649483ea31ca372e99aaac2ca07]&lt;/a&gt;)
auto_link: avoid recognizing full width chars as a part of URI
scheme&lt;/p&gt;
&lt;p&gt;fixes regression by &lt;a href=
&quot;http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2d5bc6b964e&quot;&gt;
http://github.com/rails/rails/commit/133ada6ab0f0cb7bef2bd40dbc18f2...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/5503&quot; title=
&quot;Ticket #5503&quot;&gt;#5503&lt;/a&gt; state:committed]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Santiago Pastorino &lt;a href=
&quot;mailto:santiago@wyeworks.com&quot;&gt;santiago@wyeworks.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;https://github.com/rails/rails/commit/cb9fa5283239e649483ea31ca372e99aaac2ca07&quot;&gt;
https://github.com/rails/rails/commit/cb9fa5283239e649483ea31ca372e...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-01T16:06:11+00:00</created-at>
      <creator-id type="integer">17407</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">5503</number>
      <permalink>trivial-regression-on-auto_link-for-non-western-languages</permalink>
      <priority type="integer">3</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>auto_link edge patch tested</tag>
      <title>trivial regression on auto_link for non-western languages</title>
      <updated-at type="datetime">2011-02-01T16:06:20+00:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">7</version>
      <user-name>Repository</user-name>
      <creator-name>Akira Matsuda</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/5503</url>
      <priority-name>Low</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>b729f682b7b2e4cd4924419d2882187e4938864c</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-08-30T22:08:07+01:00</created-at>
      <filename>rails3_auto_link_full_width_char.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">651694</id>
      <size type="integer">1988</size>
      <uploader-id type="integer">17407</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/651694/rails3_auto_link_full_width_char.diff</url>
    </attachment>
  </attachments>
</ticket>
