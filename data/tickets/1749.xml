<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer" nil="true"></assigned-user-id>
  <attachments-count type="integer">2</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2009-01-13T16:35:22+00:00</created-at>
  <creator-id type="integer">43483</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">1749</number>
  <permalink>has_one-through-not-working</permalink>
  <priority type="integer">0</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>resolved</state>
  <tag>:through has_one patch</tag>
  <title>has_one :through not working?</title>
  <updated-at type="datetime">2009-08-10T02:15:52+01:00</updated-at>
  <user-id type="integer">7211</user-id>
  <version type="integer">22</version>
  <user-name>CancelProfileIsBroken</user-name>
  <creator-name>jreiss</creator-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
  <priority-name nil="true"></priority-name>
  <original-body>Hi all! I'm having the strangest problem, here's the code, using Rails 2.2.2:

    class User &lt; ActiveRecord::Base
        has_one :profile
        has_one :contact, :through =&gt; :profile
    end

    class Contact &lt; ActiveRecord::Base
        has_one :profile
        has_one :user, :through =&gt; :profile
    end

    class Profile &lt; ActiveRecord::Base
        belongs_to :contact
        belongs_to :user
    end

and the migrations:

    create_table :users do |t|
      t.string :username, :null =&gt; false
      t.string :encrypted_password, :null =&gt; false
      t.string :salt, :null =&gt; false
      t.timestamps
    end

    create_table :contacts do |t|
      t.string :first, :last, :null =&gt; false
      t.string :address, :address2, :locality, :region, :country, :postal_code
      t.string :website, :email, :company
      t.timestamps
    end

    create_table :profiles do |t|
      t.integer :user_id
      t.integer :contact_id
      t.timestamps
    end

Now, if that's all correct (which i believe it is) then i dont understand why this happens:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil
&gt;&gt; u.profile = Profile.new
=&gt; #&lt;Profile id: nil, user_id: nil, contact_id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil

BUT, if i do:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.save
=&gt; true
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.save
=&gt; true
&gt;&gt; u.contact = c
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;
&gt;&gt; u.contact
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;

Why do I need to save the records before assigning them? What's going on here?</original-body>
  <latest-body>Hi all! I'm having the strangest problem, here's the code, using Rails 2.2.2:

    class User &lt; ActiveRecord::Base
        has_one :profile
        has_one :contact, :through =&gt; :profile
    end

    class Contact &lt; ActiveRecord::Base
        has_one :profile
        has_one :user, :through =&gt; :profile
    end

    class Profile &lt; ActiveRecord::Base
        belongs_to :contact
        belongs_to :user
    end

and the migrations:

    create_table :users do |t|
      t.string :username, :null =&gt; false
      t.string :encrypted_password, :null =&gt; false
      t.string :salt, :null =&gt; false
      t.timestamps
    end

    create_table :contacts do |t|
      t.string :first, :last, :null =&gt; false
      t.string :address, :address2, :locality, :region, :country, :postal_code
      t.string :website, :email, :company
      t.timestamps
    end

    create_table :profiles do |t|
      t.integer :user_id
      t.integer :contact_id
      t.timestamps
    end

Now, if that's all correct (which i believe it is) then i dont understand why this happens:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil
&gt;&gt; u.profile = Profile.new
=&gt; #&lt;Profile id: nil, user_id: nil, contact_id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil

BUT, if i do:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.save
=&gt; true
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.save
=&gt; true
&gt;&gt; u.contact = c
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;
&gt;&gt; u.contact
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;

Why do I need to save the records before assigning them? What's going on here?</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;Hi all! I'm having the strangest problem, here's the code, using
Rails 2.2.2:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class User &amp;lt; ActiveRecord::Base
    has_one :profile
    has_one :contact, :through =&amp;gt; :profile
end

class Contact &amp;lt; ActiveRecord::Base
    has_one :profile
    has_one :user, :through =&amp;gt; :profile
end

class Profile &amp;lt; ActiveRecord::Base
    belongs_to :contact
    belongs_to :user
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;and the migrations:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;create_table :users do |t|
  t.string :username, :null =&amp;gt; false
  t.string :encrypted_password, :null =&amp;gt; false
  t.string :salt, :null =&amp;gt; false
  t.timestamps
end

create_table :contacts do |t|
  t.string :first, :last, :null =&amp;gt; false
  t.string :address, :address2, :locality, :region, :country, :postal_code
  t.string :website, :email, :company
  t.timestamps
end

create_table :profiles do |t|
  t.integer :user_id
  t.integer :contact_id
  t.timestamps
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now, if that's all correct (which i believe it is) then i dont
understand why this happens:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;u = User.new =&amp;gt; # u.contact = Contact.new =&amp;gt; # u.contact
=&amp;gt; nil u.profile = Profile.new =&amp;gt; # u.profile.contact =
Contact.new =&amp;gt; # u.profile.contact =&amp;gt; # u.contact =&amp;gt;
nil&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;BUT, if i do:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;u = User.new =&amp;gt; # u.save =&amp;gt; true c = Contact.new =&amp;gt; #
c.save =&amp;gt; true u.contact = c =&amp;gt; # u.contact =&amp;gt; #&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Why do I need to save the records before assigning them? What's
going on here?&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Hi all! I'm having the strangest problem, here's the code, using Rails 2.2.2:

    class User &lt; ActiveRecord::Base
        has_one :profile
        has_one :contact, :through =&gt; :profile
    end

    class Contact &lt; ActiveRecord::Base
        has_one :profile
        has_one :user, :through =&gt; :profile
    end

    class Profile &lt; ActiveRecord::Base
        belongs_to :contact
        belongs_to :user
    end

and the migrations:

    create_table :users do |t|
      t.string :username, :null =&gt; false
      t.string :encrypted_password, :null =&gt; false
      t.string :salt, :null =&gt; false
      t.timestamps
    end

    create_table :contacts do |t|
      t.string :first, :last, :null =&gt; false
      t.string :address, :address2, :locality, :region, :country, :postal_code
      t.string :website, :email, :company
      t.timestamps
    end

    create_table :profiles do |t|
      t.integer :user_id
      t.integer :contact_id
      t.timestamps
    end

Now, if that's all correct (which i believe it is) then i dont understand why this happens:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil
&gt;&gt; u.profile = Profile.new
=&gt; #&lt;Profile id: nil, user_id: nil, contact_id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.profile.contact
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.contact
=&gt; nil

BUT, if i do:

&gt;&gt; u = User.new
=&gt; #&lt;User id: nil, username: nil, encrypted_password: nil, salt: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; u.save
=&gt; true
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.save
=&gt; true
&gt;&gt; u.contact = c
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;
&gt;&gt; u.contact
=&gt; #&lt;Contact id: 1, first: nil, last: nil, address: nil, address2: nil, locality: nil, region: nil, country: nil, postal_code: nil, website: nil, email: nil, company: nil, created_at: &quot;2009-01-13 06:26:31&quot;, updated_at: &quot;2009-01-13 06:26:31&quot;&gt;

Why do I need to save the records before assigning them? What's going on here?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hi all! I'm having the strangest problem, here's the code, using
Rails 2.2.2:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;class User &amp;lt; ActiveRecord::Base
    has_one :profile
    has_one :contact, :through =&amp;gt; :profile
end

class Contact &amp;lt; ActiveRecord::Base
    has_one :profile
    has_one :user, :through =&amp;gt; :profile
end

class Profile &amp;lt; ActiveRecord::Base
    belongs_to :contact
    belongs_to :user
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;and the migrations:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;create_table :users do |t|
  t.string :username, :null =&amp;gt; false
  t.string :encrypted_password, :null =&amp;gt; false
  t.string :salt, :null =&amp;gt; false
  t.timestamps
end

create_table :contacts do |t|
  t.string :first, :last, :null =&amp;gt; false
  t.string :address, :address2, :locality, :region, :country, :postal_code
  t.string :website, :email, :company
  t.timestamps
end

create_table :profiles do |t|
  t.integer :user_id
  t.integer :contact_id
  t.timestamps
end
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now, if that's all correct (which i believe it is) then i dont
understand why this happens:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;u = User.new =&amp;gt; #u.contact = Contact.new =&amp;gt; #u.contact
=&amp;gt; nil u.profile = Profile.new =&amp;gt; #u.profile.contact =
Contact.new =&amp;gt; #u.profile.contact =&amp;gt; #u.contact =&amp;gt; nil&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;BUT, if i do:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;u = User.new =&amp;gt; #u.save =&amp;gt; true c = Contact.new =&amp;gt;
#c.save =&amp;gt; true u.contact = c =&amp;gt; #u.contact =&amp;gt; #&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Why do I need to save the records before assigning them? What's
going on here?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-01-13T16:35:22+00:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-01-13T16:35:25+00:00</updated-at>
      <user-id type="integer">43483</user-id>
      <version type="integer">1</version>
      <user-name>jreiss</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I've been having the same problem with my models. Is this correct behavior?

It's quite annoying to have to set associations after the original model has been saved. I understand why this might be necessary, but I also believe that the :through association should be taking care of updating the record after the original model is saved.

Another time that this becomes a problem is in HABTM relationships that specify a :join_model.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I've been having the same problem with my models. Is this
correct behavior?&lt;/p&gt;
&lt;p&gt;It's quite annoying to have to set associations after the
original model has been saved. I understand why this might be
necessary, but I also believe that the :through association should
be taking care of updating the record after the original model is
saved.&lt;/p&gt;
&lt;p&gt;Another time that this becomes a problem is in HABTM
relationships that specify a :join_model.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-13T20:46:57+00:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-03-13T20:47:01+00:00</updated-at>
      <user-id type="integer">50611</user-id>
      <version type="integer">2</version>
      <user-name>Altair</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Correction, HABTM still works in a test case I wrote up. It must be an application peculiarity of my own.

Still, has_one :through remains a problem.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Correction, HABTM still works in a test case I wrote up. It must
be an application peculiarity of my own.&lt;/p&gt;
&lt;p&gt;Still, has_one :through remains a problem.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-13T22:54:35+00:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-03-13T22:54:40+00:00</updated-at>
      <user-id type="integer">50611</user-id>
      <version type="integer">3</version>
      <user-name>Altair</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Basically this is just the way Rails works. What you want to do is probably something like:

@@@
u = User.new
u.build_profile
u.profile.build_contact
u.save
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;Basically this is just the way Rails works. What you want to do
is probably something like:&lt;/p&gt;


&lt;pre&gt;&lt;code&gt;
u = User.new
u.build_profile
u.profile.build_contact
u.save
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-15T13:40:56+00:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-03-15T13:40:58+00:00</updated-at>
      <user-id type="integer">19819</user-id>
      <version type="integer">4</version>
      <user-name>Jacob Atzen</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I misread the original ticket, but there is, however, still a problem with has_one :through. Note that this issue is non-existent in a has_many :through.

Suppose that you have the same schema as outlined above. Executing the following results in incorrect behavior:

@@@ ruby
&gt;&gt; Profile.all
=&gt; []
&gt;&gt; u = User.create
=&gt; #&lt;User id: 1, created_at: &quot;2009-03-15 18:08:52&quot;, updated_at: &quot;2009-03-15 18:08:52&quot;&gt;
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.user = u
=&gt; #&lt;User id: 1, created_at: &quot;2009-03-15 18:08:52&quot;, updated_at: &quot;2009-03-15 18:08:52&quot;&gt;
&gt;&gt; Profile.all
=&gt; [#&lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-03-15 18:09:21&quot;, updated_at: &quot;2009-03-15 18:09:21&quot;&gt;]
&gt;&gt; c.save
=&gt; true
&gt;&gt; c.user
=&gt; nil
&gt;&gt; Profile.all
=&gt; [#&lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-03-15 18:09:21&quot;, updated_at: &quot;2009-03-15 18:09:21&quot;&gt;]
@@@

What's happening here is that when you assign a :user to a :contact that has not yet been saved, an entry in :profile is created before the :contact even has an id (hence the nil for contact_id). With a has_many :through association, this is not an issue; entries in the association we are traversing :through are created only on the save. Clearly, the association we are going :through should not be creating records before a save on the parent model.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I misread the original ticket, but there is, however, still a
problem with has_one :through. Note that this issue is non-existent
in a has_many :through.&lt;/p&gt;
&lt;p&gt;Suppose that you have the same schema as outlined above.
Executing the following results in incorrect behavior:&lt;/p&gt;


&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;
&amp;gt;&amp;gt; Profile.all
=&amp;gt; []
&amp;gt;&amp;gt; u = User.create
=&amp;gt; #&amp;lt;User id: 1, created_at: &amp;quot;2009-03-15 18:08:52&amp;quot;, updated_at: &amp;quot;2009-03-15 18:08:52&amp;quot;&amp;gt;
&amp;gt;&amp;gt; c = Contact.new
=&amp;gt; #&amp;lt;Contact id: nil, created_at: nil, updated_at: nil&amp;gt;
&amp;gt;&amp;gt; c.user = u
=&amp;gt; #&amp;lt;User id: 1, created_at: &amp;quot;2009-03-15 18:08:52&amp;quot;, updated_at: &amp;quot;2009-03-15 18:08:52&amp;quot;&amp;gt;
&amp;gt;&amp;gt; Profile.all
=&amp;gt; [#&amp;lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &amp;quot;2009-03-15 18:09:21&amp;quot;, updated_at: &amp;quot;2009-03-15 18:09:21&amp;quot;&amp;gt;]
&amp;gt;&amp;gt; c.save
=&amp;gt; true
&amp;gt;&amp;gt; c.user
=&amp;gt; nil
&amp;gt;&amp;gt; Profile.all
=&amp;gt; [#&amp;lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &amp;quot;2009-03-15 18:09:21&amp;quot;, updated_at: &amp;quot;2009-03-15 18:09:21&amp;quot;&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What's happening here is that when you assign a :user to a
:contact that has not yet been saved, an entry in :profile is
created before the :contact even has an id (hence the nil for
contact_id). With a has_many :through association, this is not an
issue; entries in the association we are traversing :through are
created only on the save. Clearly, the association we are going
:through should not be creating records before a save on the parent
model.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-03-15T18:19:15+00:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-03-15T18:19:21+00:00</updated-at>
      <user-id type="integer">50611</user-id>
      <version type="integer">5</version>
      <user-name>Altair</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>I ran into this same problem.  has_one :through isn't honoring the contract of a normal has_one association.  from the current documentation:

Assigning an object to a has_one association automatically saves that object and the object being replaced (if there is one), in order to update their primary keys - except if the parent object is unsaved (new_record? == true).

I've attached a test and a working patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I ran into this same problem. has_one :through isn't honoring
the contract of a normal has_one association. from the current
documentation:&lt;/p&gt;
&lt;p&gt;Assigning an object to a has_one association automatically saves
that object and the object being replaced (if there is one), in
order to update their primary keys - except if the parent object is
unsaved (new_record? == true).&lt;/p&gt;
&lt;p&gt;I've attached a test and a working patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-12T00:55:19+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-12T00:55:19+01:00</updated-at>
      <user-id type="integer">20720</user-id>
      <version type="integer">6</version>
      <user-name>visnu</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-12T01:16:09+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:through has_one&quot;
</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-12T01:16:09+01:00</updated-at>
      <user-id type="integer">20720</user-id>
      <version type="integer">7</version>
      <user-name>visnu</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>can anyone verify or give me feedback on my patch?</body>
      <body-html>&lt;div&gt;&lt;p&gt;can anyone verify or give me feedback on my patch?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-15T23:55:09+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-15T23:55:09+01:00</updated-at>
      <user-id type="integer">20720</user-id>
      <version type="integer">8</version>
      <user-name>visnu</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>what else can I do to draw more attention to this issue?</body>
      <body-html>&lt;div&gt;&lt;p&gt;what else can I do to draw more attention to this issue?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-23T05:48:47+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-23T05:48:50+01:00</updated-at>
      <user-id type="integer">20720</user-id>
      <version type="integer">9</version>
      <user-name>visnu</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I haven't had a chance to apply your patch; I've moved on to other things.

Unfortunately I don't really think you can do much to draw more attention to the issue. The thing is that there are a couple ways you can work around the problem. What I ended up doing just as a short-term solution was using a has_many, and just enforcing that the &quot;many&quot; was only one.

You could try directly emailing some of the core developers, but I imagine they get all sorts of email every day, and you'll probably get lost in the shuffle. My guess is that this might have been caught already anyway, and will probably be fixed at least by the time 3.0 is released.

That all said, I'll see if I can scrounge up some time to take a look at testing your patch. After all, you did put the effort in. Which is appreciated, by the way.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I haven't had a chance to apply your patch; I've moved on to
other things.&lt;/p&gt;
&lt;p&gt;Unfortunately I don't really think you can do much to draw more
attention to the issue. The thing is that there are a couple ways
you can work around the problem. What I ended up doing just as a
short-term solution was using a has_many, and just enforcing that
the &quot;many&quot; was only one.&lt;/p&gt;
&lt;p&gt;You could try directly emailing some of the core developers, but
I imagine they get all sorts of email every day, and you'll
probably get lost in the shuffle. My guess is that this might have
been caught already anyway, and will probably be fixed at least by
the time 3.0 is released.&lt;/p&gt;
&lt;p&gt;That all said, I'll see if I can scrounge up some time to take a
look at testing your patch. After all, you did put the effort in.
Which is appreciated, by the way.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-23T06:03:05+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">9903</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-23T06:03:11+01:00</updated-at>
      <user-id type="integer">50611</user-id>
      <version type="integer">10</version>
      <user-name>Altair</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.x</milestone-title>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I think Michael is the person for this one.

And indeed, tickets with fixes like these will definitely be taken care of. It's just hard to put a date on it. Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I think Michael is the person for this one.&lt;/p&gt;
&lt;p&gt;And indeed, tickets with fixes like these will definitely be
taken care of. It's just hard to put a date on it. Thanks.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-23T07:11:40+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 9903
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-23T07:11:45+01:00</updated-at>
      <user-id type="integer">8406</user-id>
      <version type="integer">11</version>
      <user-name>Eloy Duran</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Has anyone tries setting :autosave =&gt; true?  Would this fix it?  I haven't tried this but from reading the issue this is what I'd try.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Has anyone tries setting :autosave =&amp;gt; true? Would this fix
it? I haven't tried this but from reading the issue this is what
I'd try.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-06-29T22:54:05+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-06-29T22:54:07+01:00</updated-at>
      <user-id type="integer">25923</user-id>
      <version type="integer">12</version>
      <user-name>Wolfram Arnold</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>sneaking this into the bugmash spotlight</body>
      <body-html>&lt;div&gt;&lt;p&gt;sneaking this into the bugmash spotlight&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T21:26:57+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:through has_one patch&quot;
</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-08T21:27:00+01:00</updated-at>
      <user-id type="integer">20720</user-id>
      <version type="integer">13</version>
      <user-name>visnu</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>verified

+1 This patch works in 2-3-stable, all tests pass. Does not work in master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;verified&lt;/p&gt;
&lt;p&gt;+1 This patch works in 2-3-stable, all tests pass. Does not work
in master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T21:45:48+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-08T21:45:51+01:00</updated-at>
      <user-id type="integer">65556</user-id>
      <version type="integer">14</version>
      <user-name>Rizwan Reza</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1 verified

has_one_through_for_new_records.diff patch applied and tests pass for 2-3-stable

patch fails to apply to master</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified&lt;/p&gt;
&lt;p&gt;has_one_through_for_new_records.diff patch applied and tests
pass for 2-3-stable&lt;/p&gt;
&lt;p&gt;patch fails to apply to master&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-08T23:16:19+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-08T23:16:25+01:00</updated-at>
      <user-id type="integer">31101</user-id>
      <version type="integer">15</version>
      <user-name>Greg Sterndale</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>+1 verified, +1 patch fixes on 2-3-stable with tests passing 


on master, same issue and patch fails.
@@@ plain
Loading development environment (Rails 3.0.pre)
&gt;&gt; Profile.all
=&gt; []
&gt;&gt; u = User.create
=&gt; #&lt;User id: 1, created_at: &quot;2009-08-09 23:08:47&quot;, updated_at: &quot;2009-08-09 23:08:47&quot;&gt;
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.user = u
=&gt; #&lt;User id: 1, created_at: &quot;2009-08-09 23:08:47&quot;, updated_at: &quot;2009-08-09 23:08:47&quot;&gt;
&gt;&gt; Profile.all
=&gt; [#&lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-08-09 23:08:57&quot;, updated_at: &quot;2009-08-09 23:08:57&quot;&gt;]
&gt;&gt; c.save
=&gt; true
&gt;&gt; c.user
=&gt; nil
&gt;&gt; Profile.all
=&gt; [#&lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-08-09 23:08:57&quot;, updated_at: &quot;2009-08-09 23:08:57&quot;&gt;]
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 verified, +1 patch fixes on 2-3-stable with tests passing&lt;/p&gt;
&lt;p&gt;on master, same issue and patch fails.&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;plain&quot;&gt;Loading development environment (Rails 3.0.pre)
&amp;gt;&amp;gt; Profile.all
=&amp;gt; []
&amp;gt;&amp;gt; u = User.create
=&amp;gt; #&amp;lt;User id: 1, created_at: &quot;2009-08-09 23:08:47&quot;, updated_at: &quot;2009-08-09 23:08:47&quot;&amp;gt;
&amp;gt;&amp;gt; c = Contact.new
=&amp;gt; #&amp;lt;Contact id: nil, created_at: nil, updated_at: nil&amp;gt;
&amp;gt;&amp;gt; c.user = u
=&amp;gt; #&amp;lt;User id: 1, created_at: &quot;2009-08-09 23:08:47&quot;, updated_at: &quot;2009-08-09 23:08:47&quot;&amp;gt;
&amp;gt;&amp;gt; Profile.all
=&amp;gt; [#&amp;lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-08-09 23:08:57&quot;, updated_at: &quot;2009-08-09 23:08:57&quot;&amp;gt;]
&amp;gt;&amp;gt; c.save
=&amp;gt; true
&amp;gt;&amp;gt; c.user
=&amp;gt; nil
&amp;gt;&amp;gt; Profile.all
=&amp;gt; [#&amp;lt;Profile id: 1, user_id: 1, contact_id: nil, created_at: &quot;2009-08-09 23:08:57&quot;, updated_at: &quot;2009-08-09 23:08:57&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-10T00:21:41+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:21:45+01:00</updated-at>
      <user-id type="integer">10379</user-id>
      <version type="integer">16</version>
      <user-name>Elad Meidar</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>We need a patch for the master branch too.</body>
      <body-html>&lt;div&gt;&lt;p&gt;We need a patch for the master branch too.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-10T00:25:53+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:25:54+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">17</version>
      <user-name>Pratik</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I verified the failure on master and I've attached a patch for master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;I verified the failure on master and I've attached a patch for
master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-10T00:41:13+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:41:20+01:00</updated-at>
      <user-id type="integer">17315</user-id>
      <version type="integer">18</version>
      <user-name>Tristan Dunn</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>+1 Verified patch on master, applies cleanly and tests run

@@@ plain
Loading development environment (Rails 3.0.pre)
&gt;&gt; Profile.all
=&gt; []
&gt;&gt; u = User.create
=&gt; #&lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:33&quot;&gt;
&gt;&gt; c = Contact.new
=&gt; #&lt;Contact id: nil, created_at: nil, updated_at: nil&gt;
&gt;&gt; c.user = u
=&gt; #&lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:33&quot;&gt;
&gt;&gt; Profile.all
=&gt; []
&gt;&gt; c.save
=&gt; true
&gt;&gt; c.user
=&gt; #&lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:48&quot;&gt;
&gt;&gt; Profile.all
=&gt; [#&lt;Profile id: 1, user_id: 1, contact_id: 1, created_at: &quot;2009-08-09 23:41:48&quot;, updated_at: &quot;2009-08-09 23:41:48&quot;&gt;]

@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 Verified patch on master, applies cleanly and tests run&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;plain&quot;&gt;Loading development environment (Rails 3.0.pre)
&amp;gt;&amp;gt; Profile.all
=&amp;gt; []
&amp;gt;&amp;gt; u = User.create
=&amp;gt; #&amp;lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:33&quot;&amp;gt;
&amp;gt;&amp;gt; c = Contact.new
=&amp;gt; #&amp;lt;Contact id: nil, created_at: nil, updated_at: nil&amp;gt;
&amp;gt;&amp;gt; c.user = u
=&amp;gt; #&amp;lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:33&quot;&amp;gt;
&amp;gt;&amp;gt; Profile.all
=&amp;gt; []
&amp;gt;&amp;gt; c.save
=&amp;gt; true
&amp;gt;&amp;gt; c.user
=&amp;gt; #&amp;lt;User id: 1, created_at: &quot;2009-08-09 23:41:33&quot;, updated_at: &quot;2009-08-09 23:41:48&quot;&amp;gt;
&amp;gt;&amp;gt; Profile.all
=&amp;gt; [#&amp;lt;Profile id: 1, user_id: 1, contact_id: 1, created_at: &quot;2009-08-09 23:41:48&quot;, updated_at: &quot;2009-08-09 23:41:48&quot;&amp;gt;]&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2009-08-10T00:45:15+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:45:20+01:00</updated-at>
      <user-id type="integer">10379</user-id>
      <version type="integer">19</version>
      <user-name>Elad Meidar</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [ecc9b705d7d12f853c794ca564b8e72995563eae]) Allow ho:through#build when the owner is a new record [#1749 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/ecc9b705d7d12f853c794ca564b8e72995563eae</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/ecc9b705d7d12f853c794ca564b8e72995563eae&quot;
title=
&quot;Changeset [ecc9b705d7d12f853c794ca564b8e72995563eae]&quot;&gt;[ecc9b705d7d12f853c794ca564b8e72995563eae]&lt;/a&gt;)
Allow ho:through#build when the owner is a new record [&lt;a href=
&quot;/projects/8994/tickets/1749&quot; title=&quot;Ticket #1749&quot;&gt;#1749&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a&gt;pratiknaik@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/ecc9b705d7d12f853c794ca564b8e72995563eae&quot;&gt;
http://github.com/rails/rails/commit/ecc9b705d7d12f853c794ca564b8e7...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-10T00:53:01+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:53:02+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">20</version>
      <user-name>Repository</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">141</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [a0f69722be00cd546558b067054e9e7ae2564274]) Allow ho:through#build when the owner is a new record [#1749 state:resolved]

Signed-off-by: Pratik Naik &lt;pratiknaik@gmail.com&gt;
http://github.com/rails/rails/commit/a0f69722be00cd546558b067054e9e7ae2564274</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/a0f69722be00cd546558b067054e9e7ae2564274&quot;
title=
&quot;Changeset [a0f69722be00cd546558b067054e9e7ae2564274]&quot;&gt;[a0f69722be00cd546558b067054e9e7ae2564274]&lt;/a&gt;)
Allow ho:through#build when the owner is a new record [&lt;a href=
&quot;/projects/8994/tickets/1749&quot; title=&quot;Ticket #1749&quot;&gt;#1749&lt;/a&gt;
state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Pratik Naik &lt;a&gt;pratiknaik@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/a0f69722be00cd546558b067054e9e7ae2564274&quot;&gt;
http://github.com/rails/rails/commit/a0f69722be00cd546558b067054e9e...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-10T00:53:03+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">41987</milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>:through bugmash has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T00:53:04+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">21</version>
      <user-name>Repository</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title>2.3.4</milestone-title>
      <assigned-user-name>Michael Koziarski</assigned-user-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body nil="true"></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-08-10T02:15:47+01:00</created-at>
      <creator-id type="integer">43483</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: &quot;:through bugmash has_one patch&quot;
:milestone: 41987
:assigned_user: 141
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">1749</number>
      <permalink>has_one-through-not-working</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>:through has_one patch</tag>
      <title>has_one :through not working?</title>
      <updated-at type="datetime">2009-08-10T02:15:52+01:00</updated-at>
      <user-id type="integer">7211</user-id>
      <version type="integer">22</version>
      <user-name>CancelProfileIsBroken</user-name>
      <creator-name>jreiss</creator-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/1749</url>
      <priority-name nil="true"></priority-name>
      <milestone-title nil="true"></milestone-title>
      <assigned-user-name nil="true"></assigned-user-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>6bbdc7f198e3ae917775a26f6055fd0555bfef91</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-06-12T01:16:06+01:00</created-at>
      <filename>has_one_through_for_new_records.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">132467</id>
      <size type="integer">3542</size>
      <uploader-id type="integer">20720</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/132467/has_one_through_for_new_records.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>48c977e80171a0c293f5609dcfcc1a67e0dd12c9</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2009-08-10T00:41:13+01:00</created-at>
      <filename>has_one_through_for_new_records_master.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">239473</id>
      <size type="integer">2827</size>
      <uploader-id type="integer">17315</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/239473/has_one_through_for_new_records_master.patch</url>
    </attachment>
  </attachments>
</ticket>
