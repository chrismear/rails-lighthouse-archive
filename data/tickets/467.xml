<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">1366</assigned-user-id>
  <attachments-count type="integer">3</attachments-count>
  <closed type="boolean">true</closed>
  <created-at type="datetime">2008-06-22T12:29:46+01:00</created-at>
  <creator-id type="integer">24156</creator-id>
  <milestone-due-on type="datetime" nil="true"></milestone-due-on>
  <milestone-id type="integer" nil="true"></milestone-id>
  <number type="integer">467</number>
  <permalink>hash-conditions-belongs_to-sugar</permalink>
  <priority type="integer">19157</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>wontfix</state>
  <tag>activerecord edge patch tests</tag>
  <title>Hash Conditions belongs_to sugar</title>
  <updated-at type="datetime">2009-10-20T16:16:27+01:00</updated-at>
  <user-id type="integer">43210</user-id>
  <version type="integer">21</version>
  <user-name>Evgeniy Dolzhenko</user-name>
  <creator-name>nikz</creator-name>
  <assigned-user-name>Pratik</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
  <priority-name nil="true"></priority-name>
  <original-body>This is just a small patch that enables you to do:

@@@
 Person.find(:all, :conditions =&gt; { :university =&gt; victoria_wellington })
@@@

As opposed to:

@@@
 Person.find(:all, :conditions =&gt; { :university_id =&gt; victoria_wellington })
@@@

Just a little bit of syntactic sugar for belongs_to associations :)

There are tests + a little bit of documentation.</original-body>
  <latest-body>This is just a small patch that enables you to do:

@@@
 Person.find(:all, :conditions =&gt; { :university =&gt; victoria_wellington })
@@@

As opposed to:

@@@
 Person.find(:all, :conditions =&gt; { :university_id =&gt; victoria_wellington })
@@@

Just a little bit of syntactic sugar for belongs_to associations :)

There are tests + a little bit of documentation.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;
This is just a small patch that enables you to do:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt; Person.find(:all, :conditions =&amp;gt; { :university =&amp;gt; victoria_wellington })&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
As opposed to:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt; Person.find(:all, :conditions =&amp;gt; { :university_id =&amp;gt; victoria_wellington })&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Just a little bit of syntactic sugar for belongs_to associations :)
&lt;/p&gt;&lt;p&gt;
There are tests + a little bit of documentation.
&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>This is just a small patch that enables you to do:

@@@
 Person.find(:all, :conditions =&gt; { :university =&gt; victoria_wellington })
@@@

As opposed to:

@@@
 Person.find(:all, :conditions =&gt; { :university_id =&gt; victoria_wellington })
@@@

Just a little bit of syntactic sugar for belongs_to associations :)

There are tests + a little bit of documentation.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
This is just a small patch that enables you to do:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt; Person.find(:all, :conditions =&amp;gt; { :university =&amp;gt; victoria_wellington })&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
As opposed to:
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt; Person.find(:all, :conditions =&amp;gt; { :university_id =&amp;gt; victoria_wellington })&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
Just a little bit of syntactic sugar for belongs_to associations :)
&lt;/p&gt;&lt;p&gt;
There are tests + a little bit of documentation.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T12:29:46+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T12:29:46+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">1</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>Hummm... Lighthouse won't let me upload a diff :(</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hummm... Lighthouse won't let me upload a diff :(
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T12:30:49+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T12:30:49+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">2</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>hey there nikz,
your diff did upload,
but looking at it,
seems it reverts a whole load of new changes.

like &quot;merge conditions&quot; becoming public.

I imagine the only code change you intended to do was

@@@ ruby
@@ -2015,7 +2012,14 @@ module ActiveRecord #:nodoc:
             else
               table_name = quoted_table_name
             end
-
+            
+            unless column_names.include?(attr) 
+              # Lookup the foreign key for belongs_to associations
+              if reflection = reflect_on_all_associations(:belongs_to).find { |a| a.name.to_s == attr }
+                attr = reflection.association_foreign_key
+              end
+            end
+          
             &quot;#{table_name}.#{connection.quote_column_name(attr)} #{attribute_condition(value)}&quot;
           end.join(' AND ')
@@@

but you should probably clean up your diff.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
hey there nikz,
&lt;/p&gt;&lt;p&gt;
your diff did upload,
&lt;/p&gt;&lt;p&gt;
but looking at it,
&lt;/p&gt;&lt;p&gt;
seems it reverts a whole load of new changes.
&lt;/p&gt;&lt;p&gt;
like &quot;merge conditions&quot; becoming public.
&lt;/p&gt;&lt;p&gt;
I imagine the only code change you intended to do was
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;@@ -2015,7 +2012,14 @@ module ActiveRecord #:nodoc:
             else
               table_name = quoted_table_name
             end
-
+            
+            unless column_names.include?(attr) 
+              # Lookup the foreign key for belongs_to associations
+              if reflection = reflect_on_all_associations(:belongs_to).find { |a| a.name.to_s == attr }
+                attr = reflection.association_foreign_key
+              end
+            end
+          
             &amp;quot;#{table_name}.#{connection.quote_column_name(attr)} #{attribute_condition(value)}&amp;quot;
           end.join(' AND ')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
but you should probably clean up your diff.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T15:11:35+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T15:11:35+01:00</updated-at>
      <user-id type="integer">18469</user-id>
      <version type="integer">3</version>
      <user-name>MatthewRudy</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I like this, but you should look at the case when the belongs_to association is polymorphic. I'd expect that to set both the x_id and x_type conditions.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I like this, but you should look at the case when the belongs_to association is polymorphic. I'd expect that to set both the x_id and x_type conditions.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T16:20:57+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T16:20:57+01:00</updated-at>
      <user-id type="integer">11372</user-id>
      <version type="integer">4</version>
      <user-name>Josh Susser</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>@MatthewRudY: Hummm, that diff stuff is weird... Guess I'm not using git format-patch correctly (although I followed the guide).

Anyway, here's a clean diff.

@Josh: Working on it, give me a couple hours :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
@MatthewRudY: Hummm, that diff stuff is weird... Guess I'm not using git format-patch correctly (although I followed the guide).
&lt;/p&gt;&lt;p&gt;
Anyway, here's a clean diff.
&lt;/p&gt;&lt;p&gt;
@Josh: Working on it, give me a couple hours :)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T23:16:12+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T23:16:12+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">5</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>I had created a similar patch a couple of weeks ago, but never uploaded. I've uploaded it now, maybe it's of some use. My take was different. Instead of the example given I was looking for this:

  Person.find_all_by_university(victoria_wellington)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I had created a similar patch a couple of weeks ago, but never uploaded. I've uploaded it now, maybe it's of some use. My take was different. Instead of the example given I was looking for this:
&lt;/p&gt;&lt;p&gt;
Person.find_all_by_university(victoria_wellington)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-22T23:53:18+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-22T23:53:18+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">6</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I've added the code + tests for polymorphic associations too.

Didn't think it needed any doc changes, as like Josh says, seems pretty much along the lines of what you'd expect.

Hopefully this diff is clean :s</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I've added the code + tests for polymorphic associations too.
&lt;/p&gt;&lt;p&gt;
Didn't think it needed any doc changes, as like Josh says, seems pretty much along the lines of what you'd expect.
&lt;/p&gt;&lt;p&gt;
Hopefully this diff is clean :s
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T00:12:40+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T00:12:40+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">7</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>yeah,
diff looks clean... nice.

like Lawrence's change also.
surely these should be merged together?
@@@ ruby
class Model
  belongs_to :association
end

Model.find_by_association(@association).should ==
Model.find(:first, :conditions =&gt; {:association =&gt; @association}
@@@</body>
      <body-html>&lt;div&gt;&lt;p&gt;
yeah,
&lt;/p&gt;&lt;p&gt;
diff looks clean... nice.
&lt;/p&gt;&lt;p&gt;
like Lawrence's change also.
&lt;/p&gt;&lt;p&gt;
surely these should be merged together?
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;class Model
  belongs_to :association
end

Model.find_by_association(@association).should ==
Model.find(:first, :conditions =&amp;gt; {:association =&amp;gt; @association}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T00:22:58+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T00:22:58+01:00</updated-at>
      <user-id type="integer">18469</user-id>
      <version type="integer">8</version>
      <user-name>MatthewRudy</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I'd also like to point out that I'd support has_one associations as well.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I'd also like to point out that I'd support has_one associations as well.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T00:33:35+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T00:33:35+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">9</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Lawrence:  didn't see your patch for the find_by_whatever change, but I did that a while ago.  I never submitted it as a patch to Rails since it was pretty ugly to get the polymorphic flavor working. If you want to look at what I did (nearly 2 years ago), here's the link:

http://blog.hasmanythrough.com/2006/7/2/patch-test-plugin-dynamic-finders-with-belongs_to-names

I'd love to see this get into AR, but I think it should support polymorphic associations or things could get crazy.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Lawrence:  didn't see your patch for the find_by_whatever change, but I did that a while ago.  I never submitted it as a patch to Rails since it was pretty ugly to get the polymorphic flavor working. If you want to look at what I did (nearly 2 years ago), here's the link:
&lt;/p&gt;&lt;p&gt;
&lt;a href=&quot;http://blog.hasmanythrough.com/2006/7/2/patch-test-plugin-dynamic-finders-with-belongs_to-names&quot;&gt;http://blog.hasmanythrough.com/2...&lt;/a&gt;
&lt;/p&gt;&lt;p&gt;
I'd love to see this get into AR, but I think it should support polymorphic associations or things could get crazy.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T01:10:23+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T01:10:23+01:00</updated-at>
      <user-id type="integer">11372</user-id>
      <version type="integer">10</version>
      <user-name>Josh Susser</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>What's the best way to integrate everything?

I agree with MatthewRudy that 

@@@
Model.find_by_association(@association).should ==
Model.find(:first, :conditions =&gt; {:association =&gt; @association}
@@@

But, is it best to do both at once? Perhaps the simpler case (the Hash conditions IMHO), then we can tackle the dynamic polymorphic finders (!).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
What's the best way to integrate everything?
&lt;/p&gt;&lt;p&gt;
I agree with MatthewRudy that
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt;Model.find_by_association(@association).should ==
Model.find(:first, :conditions =&amp;gt; {:association =&amp;gt; @association}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
But, is it best to do both at once? Perhaps the simpler case (the Hash conditions IMHO), then we can tackle the dynamic polymorphic finders (!).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T01:14:45+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T01:14:45+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">11</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Nik: agreed.  keep this ticket scoped to the :conditions changed.  I only piled on the dynamic finders here cause I couldn't find the other ticket (sorry!).</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Nik: agreed.  keep this ticket scoped to the :conditions changed.  I only piled on the dynamic finders here cause I couldn't find the other ticket (sorry!).
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T01:42:24+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T01:42:24+01:00</updated-at>
      <user-id type="integer">11372</user-id>
      <version type="integer">12</version>
      <user-name>Josh Susser</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>@Josh: Sweet, I'll see what I can do about merging yours and Lawrence's changes, and the :conditions changes. After I (hopefully) get this accepted.

@Lawrence: Yeah, I'm giving has_one a go. The conditions aren't that hard, the only problem is you've got to include the foreign table too (i.e you have to select * from people, universities ...)

Unless I'm missing something, of course :) I can upload what I've got, which sets the conditions correctly, and has a failing test, if someone feels like fixing that problem :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
@Josh: Sweet, I'll see what I can do about merging yours and Lawrence's changes, and the :conditions changes. After I (hopefully) get this accepted.
&lt;/p&gt;&lt;p&gt;
@Lawrence: Yeah, I'm giving has_one a go. The conditions aren't that hard, the only problem is you've got to include the foreign table too (i.e you have to select * from people, universities ...)
&lt;/p&gt;&lt;p&gt;
Unless I'm missing something, of course :) I can upload what I've got, which sets the conditions correctly, and has a failing test, if someone feels like fixing that problem :)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-23T01:52:09+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag nil="true"></tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-23T01:52:09+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">13</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>I'm -1 on syntactic sugar. I'd like it if :conditions always refer to the actual column names in the db, or table names. find_by_association and find_all_by_association idea sounds good though.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
I'm -1 on syntactic sugar. I'd like it if :conditions always refer to the actual column names in the db, or table names. find_by_association and find_all_by_association idea sounds good though.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-27T13:55:26+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord doc edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-27T13:55:26+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">14</version>
      <user-name>Pratik</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Removing &quot;doc&quot; keyword.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Removing &quot;doc&quot; keyword.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-27T15:36:06+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- 
:tag: activerecord doc edge patch tests
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-27T15:36:06+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">15</version>
      <user-name>Pratik</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>@Pratik: awww, but &quot;this changeset&quot;:http://github.com/rails/rails/commit/cd994eff9a343df376bfaec59de5b24a2ab51256 is everything I need to get has_one working :(

Are we certain we don't want the alias working for the hash conditions? 

If so, I'll work on getting Josh's patch up with the play (assuming Josh is cool with that) :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;
@Pratik: awww, but &lt;a href=&quot;http://github.com/rails/rails/commit/cd994eff9a343df376bfaec59de5b24a2ab51256&quot;&gt;this changeset&lt;/a&gt; is everything I need to get has_one working :(
&lt;/p&gt;&lt;p&gt;
Are we certain we don't want the alias working for the hash conditions?
&lt;/p&gt;&lt;p&gt;
If so, I'll work on getting Josh's patch up with the play (assuming Josh is cool with that) :)
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-28T02:09:54+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-28T02:09:54+01:00</updated-at>
      <user-id type="integer">24156</user-id>
      <version type="integer">16</version>
      <user-name>nikz</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Hey nikz,

This is just my opinion :) I think it's better to send an email to core mailing list and see what everyone else thinks. I was planning to do that cd994eff9a343df376bfaec59de5b24a2ab51256 for a while, which was one of the reason why I was/am -1 on this patch. 

We can also easily support association names inside condition hash, in which case, we'd break our current rule that everything inside :conditions refers to table name/alias and columns. So if we do end up having that, your original patch would be a nice addition.

Need to hear more opinions.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Hey nikz,
&lt;/p&gt;&lt;p&gt;
This is just my opinion :) I think it's better to send an email to core mailing list and see what everyone else thinks. I was planning to do that cd994eff9a343df376bfaec59de5b24a2ab51256 for a while, which was one of the reason why I was/am -1 on this patch.
&lt;/p&gt;&lt;p&gt;
We can also easily support association names inside condition hash, in which case, we'd break our current rule that everything inside :conditions refers to table name/alias and columns. So if we do end up having that, your original patch would be a nice addition.
&lt;/p&gt;&lt;p&gt;
Need to hear more opinions.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-28T02:20:46+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-28T02:20:46+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">17</version>
      <user-name>Pratik</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Now that Pratik mentions it, I agree with what he's saying. The things within a condition hash should always refer to actual table and column names.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Now that Pratik mentions it, I agree with what he's saying. The things within a condition hash should always refer to actual table and column names.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-29T00:40:37+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-29T00:40:37+01:00</updated-at>
      <user-id type="integer">20836</user-id>
      <version type="integer">18</version>
      <user-name>Lawrence Pit</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>don't know if I agree with that.

if I wanted to be rigidly tied to the db structure I'd write everything as SQL strings

the hash :conditions already brings a little bit of magic;
@@@ ruby
&quot;#{key} &quot; + if value.is_a? Array
  &quot;IN (...)&quot;
elsif value.nil?
  &quot;IS NULL&quot;
else
  &quot;= ...&quot;
end
@@@
I don't see why it shouldn't extend to the provided keys.
@@@ ruby
if has_association(key)
  &quot;#{association.foreign_key} = ...&quot;
else
  &quot;#{key} = ...&quot;
end
@@@

could use the same thing to make :conditions =&gt; {:id =&gt; 5} into a magic alias for &quot;#{Model.primary_key} = 5&quot;, so it'd work when mixed into a legacy Model from a plugin perhaps.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
don't know if I agree with that.
&lt;/p&gt;&lt;p&gt;
if I wanted to be rigidly tied to the db structure I'd write everything as SQL strings
&lt;/p&gt;&lt;p&gt;
the hash :conditions already brings a little bit of magic;
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;&amp;quot;#{key} &amp;quot; + if value.is_a? Array
  &amp;quot;IN (...)&amp;quot;
elsif value.nil?
  &amp;quot;IS NULL&amp;quot;
else
  &amp;quot;= ...&amp;quot;
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
I don't see why it shouldn't extend to the provided keys.
&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;if has_association(key)
  &amp;quot;#{association.foreign_key} = ...&amp;quot;
else
  &amp;quot;#{key} = ...&amp;quot;
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;
could use the same thing to make :conditions =&gt; {:id =&gt; 5} into a magic alias for &quot;#{Model.primary_key} = 5&quot;, so it'd work when mixed into a legacy Model from a plugin perhaps.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2008-06-29T01:38:52+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-06-29T01:38:52+01:00</updated-at>
      <user-id type="integer">18469</user-id>
      <version type="integer">19</version>
      <user-name>MatthewRudy</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>Closing this ticket for timebeing. It'd be nice to continue the discussion in mailing list. And if there is enough interest in this, will roll it in.

Thanks.</body>
      <body-html>&lt;div&gt;&lt;p&gt;
Closing this ticket for timebeing. It'd be nice to continue the discussion in mailing list. And if there is enough interest in this, will roll it in.
&lt;/p&gt;&lt;p&gt;
Thanks.
&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2008-07-12T14:20:00+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2008-07-12T14:20:00+01:00</updated-at>
      <user-id type="integer">1366</user-id>
      <version type="integer">20</version>
      <user-name>Pratik</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">1366</assigned-user-id>
      <attachments-count type="integer">3</attachments-count>
      <body>+1 on this patch.

Another place where conditions magic takes place is `expand_hash_conditions_for_aggregates` method, which makes the following conditions translation possible (from docs):

@@@
# And for value objects on a composed_of relationship:
#   { :address =&gt; Address.new(&quot;123 abc st.&quot;, &quot;chicago&quot;) }
#     # =&gt; &quot;address_street='123 abc st.' and address_city='chicago'&quot;
@@@

Which creates precedent IMO for merging this in :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;+1 on this patch.&lt;/p&gt;
&lt;p&gt;Another place where conditions magic takes place is
&lt;code&gt;expand_hash_conditions_for_aggregates&lt;/code&gt; method, which
makes the following conditions translation possible (from
docs):&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;# And for value objects on a composed_of relationship:
#   { :address =&amp;gt; Address.new(&quot;123 abc st.&quot;, &quot;chicago&quot;) }
#     # =&amp;gt; &quot;address_street='123 abc st.' and address_city='chicago'&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Which creates precedent IMO for merging this in :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2009-10-20T16:16:23+01:00</created-at>
      <creator-id type="integer">24156</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">467</number>
      <permalink>hash-conditions-belongs_to-sugar</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>wontfix</state>
      <tag>activerecord edge patch tests</tag>
      <title>Hash Conditions belongs_to sugar</title>
      <updated-at type="datetime">2009-10-20T16:16:27+01:00</updated-at>
      <user-id type="integer">43210</user-id>
      <version type="integer">21</version>
      <user-name>Evgeniy Dolzhenko</user-name>
      <creator-name>nikz</creator-name>
      <assigned-user-name>Pratik</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/467</url>
      <priority-name nil="true"></priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>f62d49c408880c051d8c01e956998e6a37bd9187</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-22T23:16:12+01:00</created-at>
      <filename>hash_conditions_sugar.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">28768</id>
      <size type="integer">3073</size>
      <uploader-id type="integer">24156</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/28768/hash_conditions_sugar.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>621285901d4c16cce15e0f35b435de14a8ebbac8</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-22T23:53:18+01:00</created-at>
      <filename>dynfind.patch</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">28771</id>
      <size type="integer">2313</size>
      <uploader-id type="integer">20836</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/28771/dynfind.patch</url>
    </attachment>
    <attachment type="Attachment">
      <code>d446998a453e48ec7aed8dcef360b9fef6561fe8</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2008-06-23T00:12:40+01:00</created-at>
      <filename>hash_conditions_sugar_with_polymorphic_sprinkles.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">28774</id>
      <size type="integer">8052</size>
      <uploader-id type="integer">24156</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/28774/hash_conditions_sugar_with_polymorphic_sprinkles.diff</url>
    </attachment>
  </attachments>
</ticket>
