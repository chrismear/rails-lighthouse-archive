<?xml version="1.0" encoding="UTF-8"?>
<ticket>
  <assigned-user-id type="integer">7697</assigned-user-id>
  <attachments-count type="integer">6</attachments-count>
  <closed type="boolean">false</closed>
  <created-at type="datetime">2011-01-13T06:52:10+00:00</created-at>
  <creator-id type="integer">84792</creator-id>
  <milestone-due-on type="datetime">2011-03-27T00:00:00+00:00</milestone-due-on>
  <milestone-id type="integer">103410</milestone-id>
  <number type="integer">4762</number>
  <permalink>url_for-escape-parameter-is-ignored</permalink>
  <priority type="integer">1</priority>
  <project-id type="integer">8994</project-id>
  <raw-data type="binary" nil="true" encoding="base64"></raw-data>
  <state>open</state>
  <tag>&quot;url_for rdoc documentation&quot;</tag>
  <title>url_for :escape parameter is ignored </title>
  <updated-at type="datetime">2011-02-27T03:15:38+00:00</updated-at>
  <user-id type="integer">40272</user-id>
  <version type="integer">26</version>
  <user-name>Santiago Pastorino</user-name>
  <creator-name>Jan Berkel</creator-name>
  <assigned-user-name>Andrew White</assigned-user-name>
  <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
  <milestone-title>3.0.6</milestone-title>
  <priority-name>High</priority-name>
  <original-body>The rdoc for url_for in actionpack/lib/action_view/helpers/url_helper.rb states:

@@@ ruby
   url_for(:action =&gt; 'checkout', :anchor =&gt; 'tax&amp;ship', :escape =&gt; false) 
   =&gt; /testing/jump/#tax&amp;ship
@@@

http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M002141

however anchors always get url escaped, the :escape parameter is completely ignored. Is this intended behaviour? It would be nice to make the escaping optional.

if it is intended behaviour the documentation should be updated.</original-body>
  <latest-body>The rdoc for url_for in actionpack/lib/action_view/helpers/url_helper.rb states:

@@@ ruby
   url_for(:action =&gt; 'checkout', :anchor =&gt; 'tax&amp;ship', :escape =&gt; false) 
   =&gt; /testing/jump/#tax&amp;ship
@@@

http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M002141

however anchors always get url escaped, the :escape parameter is completely ignored. Is this intended behaviour? It would be nice to make the escaping optional.

if it is intended behaviour the documentation should be updated.</latest-body>
  <original-body-html>&lt;div&gt;&lt;p&gt;The rdoc for url_for in
actionpack/lib/action_view/helpers/url_helper.rb states:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;   url_for(:action =&amp;gt; 'checkout', :anchor =&amp;gt; 'tax&amp;amp;ship', :escape =&amp;gt; false) 
   =&amp;gt; /testing/jump/#tax&amp;amp;ship&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=
&quot;http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M002141&quot;&gt;
http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.htm...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;however anchors always get url escaped, the :escape parameter is
completely ignored. Is this intended behaviour? It would be nice to
make the escaping optional.&lt;/p&gt;
&lt;p&gt;if it is intended behaviour the documentation should be
updated.&lt;/p&gt;&lt;/div&gt;</original-body-html>
  <versions type="array">
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The rdoc for url_for in actionpack/lib/action_view/helpers/url_helper.rb states:

@@@ ruby
   url_for(:action =&gt; 'checkout', :anchor =&gt; 'tax&amp;ship', :escape =&gt; false) 
   =&gt; /testing/jump/#tax&amp;ship
@@@

http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M002141

however anchors always get url escaped, the :escape parameter is completely ignored. Is this intended behaviour? It would be nice to make the escaping optional.

if it is intended behaviour the documentation should be updated.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The rdoc for url_for in
actionpack/lib/action_view/helpers/url_helper.rb states:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;   url_for(:action =&amp;gt; 'checkout', :anchor =&amp;gt; 'tax&amp;amp;ship', :escape =&amp;gt; false) 
   =&amp;gt; /testing/jump/#tax&amp;amp;ship&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a href=
&quot;http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M002141&quot;&gt;
http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.htm...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;however anchors always get url escaped, the :escape parameter is
completely ignored. Is this intended behaviour? It would be nice to
make the escaping optional.&lt;/p&gt;
&lt;p&gt;if it is intended behaviour the documentation should be
updated.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T18:42:08+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-03T18:42:12+01:00</updated-at>
      <user-id type="integer">84792</user-id>
      <version type="integer">1</version>
      <user-name>Jan Berkel</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>While this maybe isn't the exact issue Jan encountered, I noticed something similar, where #content_tag_as_string completely ignores the escape param on the content. This leads to errors with the engineyard/rails_metrics plugin for example, and basically, for every call to #content_tag where the 2nd param is given as a String.

Patch can be found at: http://github.com/snusnu/rails/commit/7f1b5bc6452cd1ca65dae3283c4af5297e4e00c2

I'll keep on looking if there's already another ticket for that specific issue, or maybe it's even the same issue as this ticket describes anyway. If not, I'll probably open another ticket and link it back to this one too</body>
      <body-html>&lt;div&gt;&lt;p&gt;While this maybe isn't the exact issue Jan encountered, I
noticed something similar, where #content_tag_as_string completely
ignores the escape param on the content. This leads to errors with
the engineyard/rails_metrics plugin for example, and basically, for
every call to #content_tag where the 2nd param is given as a
String.&lt;/p&gt;
&lt;p&gt;Patch can be found at: &lt;a href=
&quot;http://github.com/snusnu/rails/commit/7f1b5bc6452cd1ca65dae3283c4af5297e4e00c2&quot;&gt;
http://github.com/snusnu/rails/commit/7f1b5bc6452cd1ca65dae3283c4af...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I'll keep on looking if there's already another ticket for that
specific issue, or maybe it's even the same issue as this ticket
describes anyway. If not, I'll probably open another ticket and
link it back to this one too&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T22:09:36+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-03T22:09:42+01:00</updated-at>
      <user-id type="integer">16008</user-id>
      <version type="integer">2</version>
      <user-name>Martin Gamsjaeger (snusnu)</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>that issue is unrelated. the problem is in actionpack/lib/action_dispatch/routing/route_set.rb:

@@@ ruby

# route_set.rb
def url_for(options)
  ...
  rewritten_url &lt;&lt; &quot;##{Rack::Utils.escape(options[:anchor].to_param.to_s)}&quot; if options[:anchor]
end

# actionpack/lib/action_view/helpers/url_helper.rb
def url_for(option)
  ...
  escape  = options.key?(:escape) ? options.delete(:escape) : false
  super
end

@@@

So what happens is that while url_for in url_helper.rb accepts an escape option, it doesn't get passed through route_set.rb (the key is deleted).

I could fix this but wanted to check first if it the desired behaviour, to me it looks like a bug.</body>
      <body-html>&lt;div&gt;&lt;p&gt;that issue is unrelated. the problem is in
actionpack/lib/action_dispatch/routing/route_set.rb:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
# route_set.rb
def url_for(options)
  ...
  rewritten_url &amp;lt;&amp;lt; &quot;##{Rack::Utils.escape(options[:anchor].to_param.to_s)}&quot; if options[:anchor]
end

# actionpack/lib/action_view/helpers/url_helper.rb
def url_for(option)
  ...
  escape  = options.key?(:escape) ? options.delete(:escape) : false
  super
end&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;So what happens is that while url_for in url_helper.rb accepts
an escape option, it doesn't get passed through route_set.rb (the
key is deleted).&lt;/p&gt;
&lt;p&gt;I could fix this but wanted to check first if it the desired
behaviour, to me it looks like a bug.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-03T22:33:42+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-03T22:33:51+01:00</updated-at>
      <user-id type="integer">84792</user-id>
      <version type="integer">3</version>
      <user-name>Jan Berkel</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The culprit is following code

@@@ ruby
rewritten_url &lt;&lt; &quot;##{Rack::Utils.escape(options[:anchor].to_param.to_s)}&quot; if options[:anchor]
@@@ 

As you can see anchor tag is *always* escaped. And it does not depend on options that is passed to this method.

http://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/routing/route_set.rb#L447

I tried to look at HTTP RFC and could not find any reference that anchor tag should always be escaped. If no such reference is found then it should be considered a bug. The patch and test can be generated easily.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The culprit is following code&lt;/p&gt;
&lt;pre&gt;
&lt;code class=
&quot;ruby&quot;&gt;rewritten_url &amp;lt;&amp;lt; &quot;##{Rack::Utils.escape(options[:anchor].to_param.to_s)}&quot; if options[:anchor]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;As you can see anchor tag is &lt;em&gt;always&lt;/em&gt; escaped. And it
does not depend on options that is passed to this method.&lt;/p&gt;
&lt;p&gt;&lt;a href=
&quot;http://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/routing/route_set.rb#L447&quot;&gt;
http://github.com/rails/rails/blob/master/actionpack/lib/action_dis...&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I tried to look at HTTP RFC and could not find any reference
that anchor tag should always be escaped. If no such reference is
found then it should be considered a bug. The patch and test can be
generated easily.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-04T01:04:36+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-04T01:04:41+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">4</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer" nil="true"></assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>@neeraj: anchor tags are not even sent to the server, they are purely local. it still makes sense to escape the anchor tag to produce valid urls, but the content is more free form than for example the query string, so it should be possible to have that part not escaped automatically.

my concrete use case is google analytics tracking. there's an option to append tracking parameters to the anchor instead of having them as query parameters.

@@@
http://example.com?utm_campaign=bar
http://example.com/#utm_campaign=bar
@@@

However if the content of the anchor gets escaped the tracking stops working.</body>
      <body-html>&lt;div&gt;&lt;p&gt;@neeraj: anchor tags are not even sent to the server, they are
purely local. it still makes sense to escape the anchor tag to
produce valid urls, but the content is more free form than for
example the query string, so it should be possible to have that
part not escaped automatically.&lt;/p&gt;
&lt;p&gt;my concrete use case is google analytics tracking. there's an
option to append tracking parameters to the anchor instead of
having them as query parameters.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;http://example.com?utm_campaign=bar
http://example.com/#utm_campaign=bar&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;However if the content of the anchor gets escaped the tracking
stops working.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-04T01:41:00+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-04T01:41:04+01:00</updated-at>
      <user-id type="integer">84792</user-id>
      <version type="integer">5</version>
      <user-name>Jan Berkel</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name nil="true"></assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>Assigning it to rails core team member to get a verdict on whether anchor value should be escaped or not?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Assigning it to rails core team member to get a verdict on
whether anchor value should be escaped or not?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T21:42:48+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-25T21:42:57+01:00</updated-at>
      <user-id type="integer">40263</user-id>
      <version type="integer">6</version>
      <user-name>Neeraj Singh</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>:anchor (as everything else on url_for) should respect the :escape parameter. Patches please! :)</body>
      <body-html>&lt;div&gt;&lt;p&gt;:anchor (as everything else on url_for) should respect the
:escape parameter. Patches please! :)&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-25T23:22:22+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>new</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-25T23:22:32+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">7</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">0</attachments-count>
      <body>The :escape option is only for HTML entity escaping and not URL escaping which is what's happening here. However there is a bug in that the :anchor is being over-escaped. The attached patch fixes this issue and you won't need to pass :escape =&gt; false to get your Google Analytics use case working.</body>
      <body-html>&lt;div&gt;&lt;p&gt;The :escape option is only for HTML entity escaping and not URL
escaping which is what's happening here. However there is a bug in
that the :anchor is being over-escaped. The attached patch fixes
this issue and you won't need to pass :escape =&amp;gt; false to get
your Google Analytics use case working.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-26T02:02:42+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: new
:milestone: 
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-26T02:03:05+01:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">8</version>
      <user-name>Andrew White</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>(from [bba19603c27e0439eb22a9bce7e3adf6924b224b]) URL fragments should not have safe characters escaped. Ref: Appendix A, http://tools.ietf.org/rfc/rfc3986.txt

[#4762 state:resolved]

Signed-off-by: Jeremy Kemper &lt;jeremy@bitsweat.net&gt;
http://github.com/rails/rails/commit/bba19603c27e0439eb22a9bce7e3adf6924b224b</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/bba19603c27e0439eb22a9bce7e3adf6924b224b&quot;
title=
&quot;Changeset [bba19603c27e0439eb22a9bce7e3adf6924b224b]&quot;&gt;[bba19603c27e0439eb22a9bce7e3adf6924b224b]&lt;/a&gt;)
URL fragments should not have safe characters escaped. Ref:
Appendix A, &lt;a href=
&quot;http://tools.ietf.org/rfc/rfc3986.txt&quot;&gt;http://tools.ietf.org/rfc/rfc3986.txt&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[&lt;a href=&quot;/projects/8994/tickets/4762&quot; title=
&quot;Ticket #4762&quot;&gt;#4762&lt;/a&gt; state:resolved]&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jeremy Kemper &lt;a&gt;jeremy@bitsweat.net&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/bba19603c27e0439eb22a9bce7e3adf6924b224b&quot;&gt;
http://github.com/rails/rails/commit/bba19603c27e0439eb22a9bce7e3ad...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-26T02:06:11+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">0</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-26T02:06:19+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">9</version>
      <user-name>Repository</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name nil="true"></priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">1</attachments-count>
      <body>thanks! i backported the fix to 2-3-stable. any chance this can be applied? we're not ready for 3.x yet.</body>
      <body-html>&lt;div&gt;&lt;p&gt;thanks! i backported the fix to 2-3-stable. any chance this can
be applied? we're not ready for 3.x yet.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-29T11:07:57+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:priority: 0
</diffable-attributes>
      <milestone-id type="integer" nil="true"></milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>resolved</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-29T11:08:12+01:00</updated-at>
      <user-id type="integer">84792</user-id>
      <version type="integer">10</version>
      <user-name>Jan Berkel</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title nil="true"></milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-29T18:35:36+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: resolved
:milestone: 74033
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-29T18:36:03+01:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">11</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>(from [f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986]) Backported patch from [#4762]

URL fragments should not have safe characters escaped. Ref: Appendix A,
  http://tools.ietf.org/rfc/rfc3986.txt

Signed-off-by: Jos&#233; Valim &lt;jose.valim@gmail.com&gt;
http://github.com/rails/rails/commit/f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986</body>
      <body-html>&lt;div&gt;&lt;p&gt;(from &lt;a href=
&quot;/projects/8994/changesets/f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986&quot;
title=
&quot;Changeset [f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986]&quot;&gt;[f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986]&lt;/a&gt;)
Backported patch from [&lt;a href=&quot;/projects/8994/tickets/4762&quot; title=
&quot;Ticket #4762&quot;&gt;#4762&lt;/a&gt;]&lt;/p&gt;
&lt;p&gt;URL fragments should not have safe characters escaped. Ref:
Appendix A,&lt;br&gt;
&lt;a href=
&quot;http://tools.ietf.org/rfc/rfc3986.txt&quot;&gt;http://tools.ietf.org/rfc/rfc3986.txt&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Signed-off-by: Jos&amp;eacute; Valim &lt;a href=
&quot;mailto:jose.valim@gmail.com&quot;&gt;jose.valim@gmail.com&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://github.com/rails/rails/commit/f8f4872fccbc6ba2b4970e4e9eab9ce7f0d19986&quot;&gt;
http://github.com/rails/rails/commit/f8f4872fccbc6ba2b4970e4e9eab9c...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2010-06-30T12:27:41+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-30T12:28:05+01:00</updated-at>
      <user-id type="integer">17393</user-id>
      <version type="integer">12</version>
      <user-name>Repository</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-06-30T12:27:43+01:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: open
</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-06-30T12:27:55+01:00</updated-at>
      <user-id type="integer">19965</user-id>
      <version type="integer">13</version>
      <user-name>Jos&#233; Valim</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>From http://tools.ietf.org/html/rfc3986#section-3.5, &quot;/&quot; and &quot;?&quot; should also be considered &quot;safe&quot; characters for the anchor. The patch doesn't look like it handles those characters. Also it looks like '%' should not be allowed.</body>
      <body-html>&lt;div&gt;&lt;p&gt;From &lt;a href=
&quot;http://tools.ietf.org/html/rfc3986#section-3.5&quot;&gt;http://tools.ietf.org/html/rfc3986#section-3.5&lt;/a&gt;,
&quot;/&quot; and &quot;?&quot; should also be considered &quot;safe&quot; characters for the
anchor. The patch doesn't look like it handles those characters.
Also it looks like '%' should not be allowed.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-04T21:55:41+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-11-04T21:55:44+00:00</updated-at>
      <user-id type="integer">123490</user-id>
      <version type="integer">14</version>
      <user-name>Shayan Guha</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>This fix also needs to be applied to the rewrite_url function on the 2.3 branch. The :anchor option is still being escaped using CGI.escape. https://github.com/rails/rails/blob/v2.3.10/actionpack/lib/action_controller/url_rewriter.rb#L200</body>
      <body-html>&lt;div&gt;&lt;p&gt;This fix also needs to be applied to the rewrite_url function on
the 2.3 branch. The :anchor option is still being escaped using
CGI.escape. &lt;a href=
&quot;https://github.com/rails/rails/blob/v2.3.10/actionpack/lib/action_controller/url_rewriter.rb#L200&quot;&gt;
https://github.com/rails/rails/blob/v2.3.10/actionpack/lib/action_c...&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-11-04T23:15:37+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2010-11-04T23:15:39+00:00</updated-at>
      <user-id type="integer">123490</user-id>
      <version type="integer">15</version>
      <user-name>Shayan Guha</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>&lt;a href=&quot;http://www.mp4converter.jp/dvd-creator-mac.html&quot;&gt;DVD&#20316;&#25104;Mac &lt;/a&gt;
&lt;a href=&quot;http://www.mp4converter.jp/dvd-ripper-mac.html&quot;&gt;DVD&#12522;&#12483;&#12500;&#12531;&#12464;Mac&lt;/a&gt;
&lt;a href=&quot;http://www.mp4converter.jp/dvd-copy-mac.html&quot;&gt; DVD&#12467;&#12500;&#12540;Mac &lt;/a&gt;
&lt;a href=&quot;http://www.mp4converter.jp/avi-to-dvd-converter-mac.html&quot;&gt;AVI DVD&#22793;&#25563; Mac&lt;/a&gt;
&lt;a href=&quot;http://www.mp4converter.jp/video-to-dvd-converter-mac.html&quot;&gt;&#21205;&#30011; DVD&#22793;&#25563; Mac &lt;/a&gt;
&lt;a href=&quot;http://www.mp4converter.jp/dvd-audio-ripper-mac.html&quot;&gt;DVD&#38899;&#22768;&#12522;&#12483;&#12500;&#12531;&#12464; Mac&lt;/a&gt;</body>
      <body-html>&lt;div&gt;&lt;p&gt;&lt;a href=
&quot;http://www.mp4converter.jp/dvd-creator-mac.html&quot;&gt;DVD&amp;#20316;&amp;#25104;Mac&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://www.mp4converter.jp/dvd-ripper-mac.html&quot;&gt;DVD&amp;#12522;&amp;#12483;&amp;#12500;&amp;#12531;&amp;#12464;Mac&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://www.mp4converter.jp/dvd-copy-mac.html&quot;&gt;DVD&amp;#12467;&amp;#12500;&amp;#12540;Mac&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://www.mp4converter.jp/avi-to-dvd-converter-mac.html&quot;&gt;AVI
DVD&amp;#22793;&amp;#25563; Mac&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://www.mp4converter.jp/video-to-dvd-converter-mac.html&quot;&gt;&amp;#21205;&amp;#30011;
DVD&amp;#22793;&amp;#25563; Mac&lt;/a&gt;&lt;br&gt;
&lt;a href=
&quot;http://www.mp4converter.jp/dvd-audio-ripper-mac.html&quot;&gt;DVD&amp;#38899;&amp;#22768;&amp;#12522;&amp;#12483;&amp;#12500;&amp;#12531;&amp;#12464;
Mac&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2010-12-06T06:31:52+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-01-13T06:52:10+00:00</updated-at>
      <user-id type="integer">127909</user-id>
      <version type="integer">16</version>
      <user-name>xiangxiang</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>I agree with Shayan: / and ? shouldn't be escaped. I would like to use URLs like www.server.com/controller/action#tab=controller/action, but Rails 3.0.3 escapes the /. Any chance to reopen this ticket?</body>
      <body-html>&lt;div&gt;&lt;p&gt;I agree with Shayan: / and ? shouldn't be escaped. I would like
to use URLs like &lt;a href=
&quot;http://www.server.com/controller/action#tab=controller/action&quot;&gt;www.server.com/controller/action#tab=controller/action&lt;/a&gt;,
but Rails 3.0.3 escapes the /. Any chance to reopen this
ticket?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-16T16:17:02+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T16:17:20+00:00</updated-at>
      <user-id type="integer">18453</user-id>
      <version type="integer">17</version>
      <user-name>iGEL</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>is this an issue in 3-0-stable and/or master?</body>
      <body-html>&lt;div&gt;&lt;p&gt;is this an issue in 3-0-stable and/or master?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-16T16:32:44+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T16:33:01+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">18</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>It's an issue in 2-3-stable, 3-0-stable and master. 3-0-stable and master use Rack::Mount::Utils.escape_uri which doesn't have '/' and '?' in the list since those need escaping for routes. 2-3-stable uses URI.escape directly which Rack::Mount::Util.escape_uri does as well, so we might as well use URI.escape directly in 3-0-stable and master.</body>
      <body-html>&lt;div&gt;&lt;p&gt;It's an issue in 2-3-stable, 3-0-stable and master. 3-0-stable
and master use Rack::Mount::Utils.escape_uri which doesn't have '/'
and '?' in the list since those need escaping for routes.
2-3-stable uses URI.escape directly which
Rack::Mount::Util.escape_uri does as well, so we might as well use
URI.escape directly in 3-0-stable and master.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">true</closed>
      <created-at type="datetime">2011-02-16T16:43:37+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">73534</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>committed</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T16:43:57+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">19</version>
      <user-name>Andrew White</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>2.3.9</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body></body>
      <body-html></body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T16:55:53+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:state: committed
:milestone: 73534
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T16:56:11+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">20</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">2</attachments-count>
      <body>Thank you. It's an issue on 3-0-stable and master. I've modified the tests, so it fails, if / or ? are escaped, but I don't dare to write a patch.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Thank you. It's an issue on 3-0-stable and master. I've modified
the tests, so it fails, if / or ? are escaped, but I don't dare to
write a patch.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T17:36:31+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T17:36:53+00:00</updated-at>
      <user-id type="integer">18453</user-id>
      <version type="integer">21</version>
      <user-name>iGEL</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">4</attachments-count>
      <body>Well, I dared after all, and put Andrews suggestion into a patch. Hope, everything is alright the way I did it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Well, I dared after all, and put Andrews suggestion into a
patch. Hope, everything is alright the way I did it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T18:41:53+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T18:42:15+00:00</updated-at>
      <user-id type="integer">18453</user-id>
      <version type="integer">22</version>
      <user-name>iGEL</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>You need to double check the unsafe char list you are escaping - the default for URI.escape is UNSAFE, which includes anything not in the UNRESERVED and RESERVED list. The spec says it should be PCHAR + '/?' - this means #,[ &amp; ] should be escaped but the default URI.escape doesn't encode them.</body>
      <body-html>&lt;div&gt;&lt;p&gt;You need to double check the unsafe char list you are escaping -
the default for URI.escape is UNSAFE, which includes anything not
in the UNRESERVED and RESERVED list. The spec says it should be
PCHAR + '/?' - this means #,[ &amp;amp; ] should be escaped but the
default URI.escape doesn't encode them.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-16T21:32:17+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-16T21:32:36+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">23</version>
      <user-name>Andrew White</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">19965</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Hey Andrew, can I leave the ticket for you to push when you think the fix is ready?</body>
      <body-html>&lt;div&gt;&lt;p&gt;Hey Andrew, can I leave the ticket for you to push when you
think the fix is ready?&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-17T01:29:28+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- {}

</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-17T01:29:47+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">24</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Jos&#233; Valim</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>Sure, I'll handle it.</body>
      <body-html>&lt;div&gt;&lt;p&gt;Sure, I'll handle it.&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-17T05:35:05+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:assigned_user: 19965
</diffable-attributes>
      <milestone-id type="integer">101623</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-17T05:35:25+00:00</updated-at>
      <user-id type="integer">7697</user-id>
      <version type="integer">25</version>
      <user-name>Andrew White</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.5</milestone-title>
      <priority-name>High</priority-name>
    </version>
    <version type="Ticket::Version">
      <assigned-user-id type="integer">7697</assigned-user-id>
      <attachments-count type="integer">6</attachments-count>
      <body>[[bulk edit](/projects/8994/bulk_edits/43692)]</body>
      <body-html>&lt;div&gt;&lt;p&gt;[&lt;a href=&quot;/projects/8994/bulk_edits/43692&quot;&gt;bulk edit&lt;/a&gt;]&lt;/p&gt;&lt;/div&gt;</body-html>
      <closed type="boolean">false</closed>
      <created-at type="datetime">2011-02-27T03:15:38+00:00</created-at>
      <creator-id type="integer">84792</creator-id>
      <diffable-attributes type="yaml">--- 
:milestone: 101623
</diffable-attributes>
      <milestone-id type="integer">103410</milestone-id>
      <number type="integer">4762</number>
      <permalink>url_for-escape-parameter-is-ignored</permalink>
      <priority type="integer">1</priority>
      <project-id type="integer">8994</project-id>
      <state>open</state>
      <tag>&quot;url_for rdoc documentation&quot;</tag>
      <title>url_for :escape parameter is ignored </title>
      <updated-at type="datetime">2011-02-27T03:15:38+00:00</updated-at>
      <user-id type="integer">40272</user-id>
      <version type="integer">26</version>
      <user-name>Santiago Pastorino</user-name>
      <creator-name>Jan Berkel</creator-name>
      <assigned-user-name>Andrew White</assigned-user-name>
      <url>http://rails.lighthouseapp.com/projects/8994/tickets/4762</url>
      <milestone-title>3.0.6</milestone-title>
      <priority-name>High</priority-name>
    </version>
  </versions>
  <attachments type="array">
    <attachment type="Attachment">
      <code>dbb44355bd4caaa8651cf321ead8fa0df250bbea</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-26T02:02:42+01:00</created-at>
      <filename>0001-dont-escape-safe-chars-in-fragment.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">577453</id>
      <size type="integer">2290</size>
      <uploader-id type="integer">7697</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/577453/0001-dont-escape-safe-chars-in-fragment.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>7a09716947990274a216ee6831ddc524c7349e13</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2010-06-29T11:07:57+01:00</created-at>
      <filename>4762-2_3_stable_backport.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">579848</id>
      <size type="integer">2949</size>
      <uploader-id type="integer">84792</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/579848/4762-2_3_stable_backport.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>1819c2cf0d83d144a328d52ee38fd9cbe6b09c57</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-02-16T17:36:31+00:00</created-at>
      <filename>dont_escape_safe_chars.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">915663</id>
      <size type="integer">1188</size>
      <uploader-id type="integer">18453</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/915663/dont_escape_safe_chars.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>c897f00fade794845c6405079a204141623b8768</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-02-16T17:36:31+00:00</created-at>
      <filename>dont_escape_safe_chars_3-0.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">915664</id>
      <size type="integer">1188</size>
      <uploader-id type="integer">18453</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/915664/dont_escape_safe_chars_3-0.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>881e8e88c6dd265fcb092df2e53a9b3a5493c6f0</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-02-16T18:41:53+00:00</created-at>
      <filename>dont_escape_safe_chars_3-0.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">915823</id>
      <size type="integer">2804</size>
      <uploader-id type="integer">18453</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/915823/dont_escape_safe_chars_3-0.diff</url>
    </attachment>
    <attachment type="Attachment">
      <code>f8e95bfe863b5dca19c0d60838cf62f44c06a7fe</code>
      <content-type>text/plain</content-type>
      <created-at type="datetime">2011-02-16T18:41:54+00:00</created-at>
      <filename>dont_escape_safe_chars.diff</filename>
      <height type="integer" nil="true"></height>
      <id type="integer">915824</id>
      <size type="integer">2733</size>
      <uploader-id type="integer">18453</uploader-id>
      <width type="integer" nil="true"></width>
      <url>http://rails.lighthouseapp.com/attachments/915824/dont_escape_safe_chars.diff</url>
    </attachment>
  </attachments>
</ticket>
